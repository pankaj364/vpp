cscope 15 $HOME/vpp/src/vlib               0001369395
	@buffer.c

46 
	~<vlib/vlib.h
>

47 
	~<vlib/unix/unix.h
>

49 
vlib_buf„r_ˇŒbacks_t
 *
	gvlib_buf„r_ˇŒbacks
 = 0;

50 
u32
 
	gvlib_buf„r_physmem_sz
 = 32 << 20;

52 
uw‹d


53 
	$vlib_buf„r_Àngth_ö_chaö_¶ow_∑th
 (
vlib_maö_t
 * 
vm
,

54 
vlib_buf„r_t
 * 
b_fú°
)

56 
vlib_buf„r_t
 *
b
 = 
b_fú°
;

57 
uw‹d
 
l_fú°
 = 
b_fú°
->
cuºít_Àngth
;

58 
uw‹d
 
l
 = 0;

59 
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

61 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

62 
l
 +
b
->
cuºít_Àngth
;

64 
b_fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 = 
l
;

65 
b_fú°
->
Êags
 |
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

66  
l
 + 
l_fú°
;

67 
	}
}

69 
u8
 *

70 
	$f‹m©_vlib_buf„r
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

72 
vlib_buf„r_t
 *
b
 = 
	`va_¨g
 (*
¨gs
, vlib_buffer_t *);

73 
u32
 
ödít
 = 
	`f‹m©_gë_ödít
 (
s
);

74 
u8
 *
a
 = 0;

76 
	#_
(
bô
, 
«me
, 
v
) \

77 i‡(
v
 && (
b
->
Êags
 & 
VLIB_BUFFER_
##
«me
)) \

78 
a
 = 
	`f‹m©
 (a, "%†", 
v
);

	)

79 
f‹óch_vlib_buf„r_Êag


80 #unde‡
_


81 
s
 = 
	`f‹m©
 (s, "current data %d,Üength %d, free-list %d, clone-count %u",

82 
b
->
cuºít_d©a
, b->
cuºít_Àngth
,

83 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
), b->
n_add_ªfs
);

85 i‡(
b
->
Êags
 & 
VLIB_BUFFER_TOTAL_LENGTH_VALID
)

86 
s
 = 
	`f‹m©
 (s, ",Åotlen-nifb %d",

87 
b
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
);

89 i‡(
b
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
)

90 
s
 = 
	`f‹m©
 (s, ",Åø˚ 0x%x", 
b
->
åa˚_ödex
);

92 i‡(
a
)

93 
s
 = 
	`f‹m©
 (s, "\n%U%v", 
f‹m©_whôe_•a˚
, 
ödít
, 
a
);

94 
	`vec_‰ì
 (
a
);

96 
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

98 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

99 
u32
 
√xt_buf„r
 = 
b
->next_buffer;

100 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
√xt_buf„r
);

102 
s
 =

103 
	`f‹m©
 (
s
, "\n%Unext-buffer 0x%x, segmentÜength %d, clone-count %u",

104 
f‹m©_whôe_•a˚
, 
ödít
, 
√xt_buf„r
, 
b
->
cuºít_Àngth
,

105 
b
->
n_add_ªfs
);

108  
s
;

109 
	}
}

111 
u8
 *

112 
	$f‹m©_vlib_buf„r_™d_d©a
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

114 
vlib_buf„r_t
 *
b
 = 
	`va_¨g
 (*
¨gs
, vlib_buffer_t *);

116 
s
 = 
	`f‹m©
 (s, "%U, %U",

117 
f‹m©_vlib_buf„r
, 
b
,

118 
f‹m©_hex_byãs
, 
	`vlib_buf„r_gë_cuºít
 (
b
), 64);

120  
s
;

121 
	}
}

123 
u8
 *

124 
	$f‹m©_vlib_buf„r_known_°©e
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

126 
vlib_buf„r_known_°©e_t
 
°©e
 = 
	`va_¨g
 (*
¨gs
, vlib_buffer_known_state_t);

127 *
t
;

129 
°©e
)

131 
VLIB_BUFFER_UNKNOWN
:

132 
t
 = "unknown";

135 
VLIB_BUFFER_KNOWN_ALLOCATED
:

136 
t
 = "known-allocated";

139 
VLIB_BUFFER_KNOWN_FREE
:

140 
t
 = "known-free";

144 
t
 = "invalid";

148  
	`f‹m©
 (
s
, "%s", 
t
);

149 
	}
}

151 
u8
 *

152 
	$f‹m©_vlib_buf„r_c⁄ã¡s
 (
u8
 * 
s
, 
va_li°
 * 
va
)

154 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

155 
vlib_buf„r_t
 *
b
 = 
	`va_¨g
 (*
va
, vlib_buffer_t *);

159 
	`vec_add
 (
s
, 
	`vlib_buf„r_gë_cuºít
 (
b
), b->
cuºít_Àngth
);

160 i‡(!(
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

162 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

165  
s
;

166 
	}
}

168 
u8
 *

169 
	$vlib_vÆid©e_buf„r_hñ≥r
 (
vlib_maö_t
 * 
vm
,

170 
u32
 
bi
,

171 
uw‹d
 
fﬁlow_buf„r_√xt
, uw‹d ** 
unique_hash
)

173 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

174 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

175 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

177 i‡(
poﬁ_is_‰ì_ödex


178 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
)))

179  
	`f‹m©
 (0, "unknown freeÜist 0x%x",

180 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
));

182 
Ê
 =

183 
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
,

184 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
));

186 i‡((sig√dË
b
->
cuºít_d©a
 < (sig√dË-
VLIB_BUFFER_PRE_DATA_SIZE
)

187  
	`f‹m©
 (0, "cuºíàd©®%d bef‹ê¥e-d©a", 
b
->
cuºít_d©a
);

189 i‡(
b
->
cuºít_d©a
 + b->
cuºít_Àngth
 > 
Ê
->
n_d©a_byãs
)

190  
	`f‹m©
 (0, "%d-%d beyondÉnd of buffer %d",

191 
b
->
cuºít_d©a
, b->
cuºít_Àngth
, 
Ê
->
n_d©a_byãs
);

193 i‡(
fﬁlow_buf„r_√xt
 && (
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

195 
vlib_buf„r_known_°©e_t
 
k
;

196 
u8
 *
msg
, *
ªsu…
;

198 
k
 = 
	`vlib_buf„r_is_known
 (
b
->
√xt_buf„r
);

199 i‡(
k
 !
VLIB_BUFFER_KNOWN_ALLOCATED
)

200  
	`f‹m©
 (0, "next 0x%x: %U",

201 
b
->
√xt_buf„r
, 
f‹m©_vlib_buf„r_known_°©e
, 
k
);

203 i‡(
unique_hash
)

205 i‡(
	`hash_gë
 (*
unique_hash
, 
b
->
√xt_buf„r
))

206  
	`f‹m©
 (0, "du∂iˇã buf„∏0x%x", 
b
->
√xt_buf„r
);

208 
	`hash_£t1
 (*
unique_hash
, 
b
->
√xt_buf„r
);

211 
msg
 = 
	`vlib_vÆid©e_buf„r
 (
vm
, 
b
->
√xt_buf„r
, 
fﬁlow_buf„r_√xt
);

212 i‡(
msg
)

214 
ªsu…
 = 
	`f‹m©
 (0, "√xà0x%x: %v", 
b
->
√xt_buf„r
, 
msg
);

215 
	`vec_‰ì
 (
msg
);

216  
ªsu…
;

221 
	}
}

223 
u8
 *

224 
	$vlib_vÆid©e_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
bi
, 
uw‹d
 
fﬁlow_buf„r_√xt
)

226  
	`vlib_vÆid©e_buf„r_hñ≥r
 (
vm
, 
bi
, 
fﬁlow_buf„r_√xt
,

228 
	}
}

230 
u8
 *

231 
	$vlib_vÆid©e_buf„rs
 (
vlib_maö_t
 * 
vm
,

232 
u32
 * 
buf„rs
,

233 
uw‹d
 
√xt_buf„r_°ride
,

234 
uw‹d
 
n_buf„rs
,

235 
vlib_buf„r_known_°©e_t
 
known_°©e
,

236 
uw‹d
 
fﬁlow_buf„r_√xt
)

238 
uw‹d
 
i
, *
hash
;

239 
u32
 
bi
, *
b
 = 
buf„rs
;

240 
vlib_buf„r_known_°©e_t
 
k
;

241 
u8
 *
msg
 = 0, *
ªsu…
 = 0;

243 
hash
 = 
	`hash_¸óã
 (0, 0);

244 
i
 = 0; i < 
n_buf„rs
; i++)

246 
bi
 = 
b
[0];

247 
b
 +
√xt_buf„r_°ride
;

250 i‡(
	`hash_gë
 (
hash
, 
bi
))

252 
msg
 = 
	`f‹m©
 (0, "not unique");

253 
d⁄e
;

256 
k
 = 
	`vlib_buf„r_is_known
 (
bi
);

257 i‡(
k
 !
known_°©e
)

259 
msg
 = 
	`f‹m©
 (0, "is %U;Éxpected %U",

260 
f‹m©_vlib_buf„r_known_°©e
, 
k
,

261 
f‹m©_vlib_buf„r_known_°©e
, 
known_°©e
);

262 
d⁄e
;

265 
msg
 = 
	`vlib_vÆid©e_buf„r_hñ≥r
 (
vm
, 
bi
, 
fﬁlow_buf„r_√xt
, &
hash
);

266 i‡(
msg
)

267 
d⁄e
;

269 
	`hash_£t1
 (
hash
, 
bi
);

272 
d⁄e
:

273 i‡(
msg
)

275 
ªsu…
 = 
	`f‹m©
 (0, "0x%x: %v", 
bi
, 
msg
);

276 
	`vec_‰ì
 (
msg
);

278 
	`hash_‰ì
 (
hash
);

279  
ªsu…
;

280 
	}
}

292 
vec_hódî_t
 
	mh
;

293 
vlib_maö_t
 *
	mvm
;

294 } 
__©åibuã__
 ((
∑cked
)Ë
__boŸ°øp_vlib_maö_ve˘‹


295 
__©åibuã__
 ((
Æig√d
 (
CLIB_CACHE_LINE_BYTES
))) =

297 .
h
.
Àn
 = 1,

298 .
	gvm
 = &
vlib_globÆ_maö
,

302 
vlib_maö_t
 **
	gvlib_maös
 = &
__boŸ°øp_vlib_maö_ve˘‹
.
vm
;

308 
	$vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vlib_maö_t
 * 
vm
,

309 
u32
 * 
buf„rs
,

310 
uw‹d
 
n_buf„rs
,

311 
vlib_buf„r_known_°©e_t
 
ex≥˘ed_°©e
)

313 
u32
 *
b
;

314 
uw‹d
 
i
, 
bi
, 
is_‰ì
;

316 i‡(
CLIB_DEBUG
 == 0)

319 i‡(
vlib_buf„r_ˇŒbacks
)

322 
is_‰ì
 = 
ex≥˘ed_°©e
 =
VLIB_BUFFER_KNOWN_ALLOCATED
;

323 
b
 = 
buf„rs
;

324 
i
 = 0; i < 
n_buf„rs
; i++)

326 
vlib_buf„r_known_°©e_t
 
known
;

328 
bi
 = 
b
[0];

329 
b
 += 1;

330 
known
 = 
	`vlib_buf„r_is_known
 (
bi
);

331 i‡(
known
 !
ex≥˘ed_°©e
)

333 
	`ASSERT
 (0);

334 
vlib_∑nic_wôh_msg


335 (
vm
, "%s %U buffer 0x%x",

336 
is_‰ì
 ? "freeing" : "allocating",

337 
f‹m©_vlib_buf„r_known_°©e
, 
known
, 
bi
);

340 
vlib_buf„r_£t_known_°©e


341 (
bi
, 
is_‰ì
 ? 
VLIB_BUFFER_KNOWN_FREE
 : 
VLIB_BUFFER_KNOWN_ALLOCATED
);

343 
	}
}

346 
	$vlib_buf„r_mîge_‰ì_li°s
 (
vlib_buf„r_‰ì_li°_t
 * 
d°
,

347 
vlib_buf„r_‰ì_li°_t
 * 
§c
)

349 
uw‹d
 
l
;

350 
u32
 *
d
;

352 
l
 = 
	`vec_Àn
 (
§c
->
buf„rs
);

353 i‡(
l
 > 0)

355 
	`vec_add2_Æig√d
 (
d°
->
buf„rs
, 
d
, 
l
, 
CLIB_CACHE_LINE_BYTES
);

356 
	`˛ib_mem˝y
 (
d
, 
§c
->
buf„rs
, 
l
 *  (d[0]));

357 
	`vec_‰ì
 (
§c
->
buf„rs
);

359 
	}
}

362 
vlib_buf„r_‰ì_li°_ödex_t


363 
	$vlib_buf„r_¸óã_‰ì_li°_hñ≥r
 (
vlib_maö_t
 * 
vm
,

364 
u32
 
n_d©a_byãs
,

365 
u32
 
is_public
, u32 
is_deÁu…
, 
u8
 * 
«me
)

367 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

368 
vlib_buf„r_‰ì_li°_t
 *
f
;

369 
i
;

371 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

373 i‡(!
is_deÁu…
 && 
	`poﬁ_ñts
 (
bm
->
buf„r_‰ì_li°_poﬁ
) == 0)

375 
vlib_buf„r_‰ì_li°_ödex_t
 
deÁu…_‰ì_‰ì_li°_ödex
;

378 
deÁu…_‰ì_‰ì_li°_ödex
 =

379 
vlib_buf„r_¸óã_‰ì_li°_hñ≥r


380 (
vm
,

381  
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
,

384 (
u8
 *) "default");

386 
	`ASSERT
 (
deÁu…_‰ì_‰ì_li°_ödex
 ==

387 
VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
);

389 i‡(
n_d©a_byãs
 =
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
 && 
is_public
)

390  
deÁu…_‰ì_‰ì_li°_ödex
;

393 
	`poﬁ_gë_Æig√d
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
f
, 
CLIB_CACHE_LINE_BYTES
);

395 
	`mem£t
 (
f
, 0,  (f[0]));

396 
f
->
ödex
 = f - 
bm
->
buf„r_‰ì_li°_poﬁ
;

397 
f
->
n_d©a_byãs
 = 
	`vlib_buf„r_round_size
 (n_data_bytes);

398 
f
->
mö_n_buf„rs_óch_physmem_Æloc
 = 
VLIB_FRAME_SIZE
;

399 
f
->
«me
 = 
	`˛ib_mem_is_vec
 («meË?Çamê: 
	`f‹m©
 (0, "%s",Çame);

402 
	`vlib_buf„r_£t_‰ì_li°_ödex
 (&
f
->
buf„r_öô_ãm∂©e
, f->
ödex
);

403 
f
->
buf„r_öô_ãm∂©e
.
n_add_ªfs
 = 0;

405 i‡(
is_public
)

407 
uw‹d
 *
p
 = 
	`hash_gë
 (
bm
->
‰ì_li°_by_size
, 
f
->
n_d©a_byãs
);

408 i‡(!
p
)

409 
	`hash_£t
 (
bm
->
‰ì_li°_by_size
, 
f
->
n_d©a_byãs
, f->
ödex
);

412 
	`˛ib_•ölock_öô
 (&
f
->
globÆ_buf„rs_lock
);

414 
i
 = 1; i < 
	`vec_Àn
 (
vlib_maös
); i++)

416 
vlib_buf„r_maö_t
 *
wbm
 = 
vlib_maös
[
i
]->
buf„r_maö
;

417 
vlib_buf„r_‰ì_li°_t
 *
wf
;

418 
	`poﬁ_gë_Æig√d
 (
wbm
->
buf„r_‰ì_li°_poﬁ
,

419 
wf
, 
CLIB_CACHE_LINE_BYTES
);

420 
	`ASSERT
 (
f
 - 
bm
->
buf„r_‰ì_li°_poﬁ
 ==

421 
wf
 - 
wbm
->
buf„r_‰ì_li°_poﬁ
);

422 
wf
[0] = 
f
[0];

423 
wf
->
buf„rs
 = 0;

424 
wf
->
n_Æloc
 = 0;

427  
f
->
ödex
;

428 
	}
}

430 
vlib_buf„r_‰ì_li°_ödex_t


431 
	$vlib_buf„r_¸óã_‰ì_li°
 (
vlib_maö_t
 * 
vm
, 
u32
 
n_d©a_byãs
,

432 *
fmt
, ...)

434 
va_li°
 
va
;

435 
u8
 *
«me
;

437 
	`va_°¨t
 (
va
, 
fmt
);

438 
«me
 = 
	`va_f‹m©
 (0, 
fmt
, &
va
);

439 
	`va_íd
 (
va
);

441  
	`vlib_buf„r_¸óã_‰ì_li°_hñ≥r
 (
vm
, 
n_d©a_byãs
,

444 
«me
);

445 
	}
}

447 
vlib_buf„r_‰ì_li°_ödex_t


448 
	$vlib_buf„r_gë_‹_¸óã_‰ì_li°
 (
vlib_maö_t
 * 
vm
, 
u32
 
n_d©a_byãs
,

449 *
fmt
, ...)

451 
u32
 
i
 = 
	`vlib_buf„r_gë_‰ì_li°_wôh_size
 (
vm
, 
n_d©a_byãs
);

453 i‡(
i
 == ~0)

455 
va_li°
 
va
;

456 
u8
 *
«me
;

458 
	`va_°¨t
 (
va
, 
fmt
);

459 
«me
 = 
	`va_f‹m©
 (0, 
fmt
, &
va
);

460 
	`va_íd
 (
va
);

462 
i
 = 
	`vlib_buf„r_¸óã_‰ì_li°_hñ≥r
 (
vm
, 
n_d©a_byãs
,

465 
«me
);

468  
i
;

469 
	}
}

472 
	$dñ_‰ì_li°
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_‰ì_li°_t
 * 
f
)

474 
u32
 
i
;

476 
i
 = 0; i < 
	`vec_Àn
 (
f
->
buf„r_mem‹y_Æloˇãd
); i++)

477 
vm
->
	`os_physmem_‰ì
 (vm, vm->
buf„r_maö
->
buf„r_poﬁs
[0].
physmem_ªgi⁄
,

478 
f
->
buf„r_mem‹y_Æloˇãd
[
i
]);

479 
	`vec_‰ì
 (
f
->
«me
);

480 
	`vec_‰ì
 (
f
->
buf„r_mem‹y_Æloˇãd
);

481 
	`vec_‰ì
 (
f
->
buf„rs
);

482 
	}
}

486 
	$vlib_buf„r_dñëe_‰ì_li°_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

487 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

489 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

490 
vlib_buf„r_‰ì_li°_t
 *
f
;

491 
vlib_buf„r_‰ì_li°_ödex_t
 
mîge_ödex
;

492 
i
;

494 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

496 
f
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vm
, 
ödex
);

498 
	`ASSERT
 (
	`vec_Àn
 (
f
->
buf„rs
Ë=f->
n_Æloc
);

499 
mîge_ödex
 = 
	`vlib_buf„r_gë_‰ì_li°_wôh_size
 (
vm
, 
f
->
n_d©a_byãs
);

500 i‡(
mîge_ödex
 !(
vlib_buf„r_‰ì_li°_ödex_t
) ~ 0

501 && 
mîge_ödex
 !
ödex
)

503 
	`vlib_buf„r_mîge_‰ì_li°s
 (
poﬁ_ñt_©_ödex


504 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
mîge_ödex
),

505 
f
);

508 
	`dñ_‰ì_li°
 (
vm
, 
f
);

511 
	`mem£t
 (
f
, 0xab,  (f[0]));

513 
	`poﬁ_put
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
f
);

515 
i
 = 1; i < 
	`vec_Àn
 (
vlib_maös
); i++)

517 
bm
 = 
vlib_maös
[
i
]->
buf„r_maö
;

518 
f
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vlib_maös
[
i
], 
ödex
);;

519 
	`mem£t
 (
f
, 0xab,  (f[0]));

520 
	`poﬁ_put
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
f
);

522 
	}
}

525 
uw‹d


526 
	$vlib_buf„r_fûl_‰ì_li°_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

527 
vlib_buf„r_‰ì_li°_t
 * 
Ê
,

528 
uw‹d
 
mö_‰ì_buf„rs
)

530 
vlib_buf„r_t
 *
buf„rs
, *
b
;

531 
vlib_buf„r_‰ì_li°_t
 *
mÊ
;

532 
n
, 
n_byãs
, 
i
;

533 
u32
 *
bi
;

534 
u32
 
n_ªmaöög
, 
n_Æloc
, 
n_this_chunk
;

537 
n
 = 
mö_‰ì_buf„rs
 - 
	`vec_Àn
 (
Ê
->
buf„rs
);

538 i‡(
n
 <= 0)

539  
mö_‰ì_buf„rs
;

541 
mÊ
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vlib_maös
[0], 
Ê
->
ödex
);

542 i‡(
	`vec_Àn
 (
mÊ
->
globÆ_buf„rs
) > 0)

544 
n_c›y
, 
n_À·
;

545 
	`˛ib_•ölock_lock
 (&
mÊ
->
globÆ_buf„rs_lock
);

546 
n_c›y
 = 
	`˛ib_mö
 (
	`vec_Àn
 (
mÊ
->
globÆ_buf„rs
), 
n
);

547 
n_À·
 = 
	`vec_Àn
 (
mÊ
->
globÆ_buf„rs
Ë- 
n_c›y
;

548 
	`vec_add_Æig√d
 (
Ê
->
buf„rs
, 
mÊ
->
globÆ_buf„rs
 + 
n_À·
, 
n_c›y
,

549 
CLIB_CACHE_LINE_BYTES
);

550 
	`_vec_Àn
 (
mÊ
->
globÆ_buf„rs
Ë
n_À·
;

551 
	`˛ib_•ölock_u∆ock
 (&
mÊ
->
globÆ_buf„rs_lock
);

552 
n
 = 
mö_‰ì_buf„rs
 - 
	`vec_Àn
 (
Ê
->
buf„rs
);

553 i‡(
n
 <= 0)

554  
mö_‰ì_buf„rs
;

558 
n
 = 
	`round_pow2
 (n, 
CLIB_CACHE_LINE_BYTES
 /  (
u32
));

561 
n
 = 
	`˛ib_max
 (n, 
Ê
->
mö_n_buf„rs_óch_physmem_Æloc
);

563 
n_ªmaöög
 = 
n
;

564 
n_Æloc
 = 0;

565 
n_ªmaöög
 > 0)

567 
vlib_buf„r_poﬁ_t
 *
bp
 = &
vm
->
buf„r_maö
->
buf„r_poﬁs
[0];

568 
n_this_chunk
 = 
	`˛ib_mö
 (
n_ªmaöög
, 
bp
->
Æloc_chunk_size
);

570 
n_byãs
 = 
n_this_chunk
 * ( (
b
[0]Ë+ 
Ê
->
n_d©a_byãs
);

573 
buf„rs
 =

574 
vm
->
	`os_physmem_Æloc_Æig√d
 (vm, 
bp
->
physmem_ªgi⁄
, 
n_byãs
,

575  (
vlib_buf„r_t
));

576 i‡(!
buf„rs
)

577  
n_Æloc
;

580 
	`vec_add1
 (
Ê
->
buf„r_mem‹y_Æloˇãd
, 
buf„rs
);

582 
Ê
->
n_Æloc
 +
n_this_chunk
;

583 
n_Æloc
 +
n_this_chunk
;

584 
n_ªmaöög
 -
n_this_chunk
;

586 
b
 = 
buf„rs
;

587 
	`vec_add2_Æig√d
 (
Ê
->
buf„rs
, 
bi
, 
n_this_chunk
, 
CLIB_CACHE_LINE_BYTES
);

588 
i
 = 0; i < 
n_this_chunk
; i++)

590 
bi
[
i
] = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
b
);

592 i‡(
CLIB_DEBUG
 > 0)

593 
	`vlib_buf„r_£t_known_°©e
 (
bi
[
i
], 
VLIB_BUFFER_KNOWN_FREE
);

594 
b
 = 
	`vlib_buf„r_√xt_c⁄tiguous
 (b, 
Ê
->
n_d©a_byãs
);

597 
	`mem£t
 (
buf„rs
, 0, 
n_byãs
);

600 
b
 = 
buf„rs
;

601 
i
 = 0; i < 
n_this_chunk
; i++)

603 
	`vlib_buf„r_öô_f‹_‰ì_li°
 (
b
, 
Ê
);

604 
b
 = 
	`vlib_buf„r_√xt_c⁄tiguous
 (b, 
Ê
->
n_d©a_byãs
);

607 i‡(
Ê
->
buf„r_öô_fun˘i⁄
)

608 
Ê
->
	`buf„r_öô_fun˘i⁄
 (
vm
, fl, 
bi
, 
n_this_chunk
);

610  
n_Æloc
;

611 
	}
}

614 
	$vlib_£t_buf„r_‰ì_ˇŒback
 (
vlib_maö_t
 * 
vm
, *
Â
)

616 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

617 *
rv
 = 
bm
->
buf„r_‰ì_ˇŒback
;

619 
bm
->
buf„r_‰ì_ˇŒback
 = 
Â
;

620  
rv
;

621 
	}
}

623 
°©ic_Æways_ölöe
 

624 
	$ªcy˛e_‹_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_maö_t
 * 
bm
, 
u32
 
bi
,

625 
vlib_buf„r_t
 * 
b
, 
u32
 
fﬁlow_buf„r_√xt
)

627 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

628 
vlib_buf„r_‰ì_li°_ödex_t
 
fi
;

629 
Ê
 = 
	`vlib_buf„r_gë_buf„r_‰ì_li°
 (
vm
, 
b
, &
fi
);

633 i‡(
	`PREDICT_FALSE
 (
Ê
->
buf„rs_added_to_‰ìli°_fun˘i⁄
 != 0))

635 
j
;

637 
	`vlib_buf„r_add_to_‰ì_li°
 (
vm
, 
Ê
, 
bi
,

638 (
b
->
Êags
 & 
VLIB_BUFFER_RECYCLE
) == 0);

639 
j
 = 0; j < 
	`vec_Àn
 (
bm
->
™noun˚_li°
); j++)

641 i‡(
Ê
 =
bm
->
™noun˚_li°
[
j
])

642 
Æªady_™noun˚d
;

644 
	`vec_add1
 (
bm
->
™noun˚_li°
, 
Ê
);

645 
Æªady_™noun˚d
:

650 i‡(
	`PREDICT_TRUE
 ((
b
->
Êags
 & 
VLIB_BUFFER_RECYCLE
) == 0))

652 
u32
 
Êags
, 
√xt
;

656 
vlib_buf„r_t
 *
nb
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

657 
Êags
 = 
nb
->flags;

658 
√xt
 = 
nb
->
√xt_buf„r
;

659 i‡(
nb
->
n_add_ªfs
)

660 
nb
->
n_add_ªfs
--;

663 
	`vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vm
, &
bi
, 1,

664 
VLIB_BUFFER_KNOWN_ALLOCATED
);

665 
	`vlib_buf„r_add_to_‰ì_li°
 (
vm
, 
Ê
, 
bi
, 1);

667 
bi
 = 
√xt
;

669 
fﬁlow_buf„r_√xt
 && (
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
));

673 
	}
}

675 
°©ic_Æways_ölöe
 

676 
	$vlib_buf„r_‰ì_ölöe
 (
vlib_maö_t
 * 
vm
,

677 
u32
 * 
buf„rs
, u32 
n_buf„rs
, u32 
fﬁlow_buf„r_√xt
)

679 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

680 
vlib_buf„r_t
 *
p
, *
b0
, *
b1
, *
b2
, *
b3
;

681 
i
 = 0;

682 
	`u32
 (*
cb
Ë(
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
, u32 
n_buf„rs
,

683 
u32
 
fﬁlow_buf„r_√xt
);

685 
cb
 = 
bm
->
buf„r_‰ì_ˇŒback
;

687 i‡(
	`PREDICT_FALSE
 (
cb
 != 0))

688 
n_buf„rs
 = (*
cb
Ë(
vm
, 
buf„rs
,Ç_buf„rs, 
fﬁlow_buf„r_√xt
);

690 i‡(!
n_buf„rs
)

693 
i
 + 11 < 
n_buf„rs
)

695 
p
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 8]);

696 
	`vlib_¥e„tch_buf„r_hódî
 (
p
, 
LOAD
);

697 
p
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 9]);

698 
	`vlib_¥e„tch_buf„r_hódî
 (
p
, 
LOAD
);

699 
p
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 10]);

700 
	`vlib_¥e„tch_buf„r_hódî
 (
p
, 
LOAD
);

701 
p
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 11]);

702 
	`vlib_¥e„tch_buf„r_hódî
 (
p
, 
LOAD
);

704 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
]);

705 
b1
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 1]);

706 
b2
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 2]);

707 
b3
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
 + 3]);

709 
	`VLIB_BUFFER_TRACE_TRAJECTORY_INIT
 (
b0
);

710 
	`VLIB_BUFFER_TRACE_TRAJECTORY_INIT
 (
b1
);

711 
	`VLIB_BUFFER_TRACE_TRAJECTORY_INIT
 (
b2
);

712 
	`VLIB_BUFFER_TRACE_TRAJECTORY_INIT
 (
b3
);

714 
	`ªcy˛e_‹_‰ì
 (
vm
, 
bm
, 
buf„rs
[
i
], 
b0
, 
fﬁlow_buf„r_√xt
);

715 
	`ªcy˛e_‹_‰ì
 (
vm
, 
bm
, 
buf„rs
[
i
 + 1], 
b1
, 
fﬁlow_buf„r_√xt
);

716 
	`ªcy˛e_‹_‰ì
 (
vm
, 
bm
, 
buf„rs
[
i
 + 2], 
b2
, 
fﬁlow_buf„r_√xt
);

717 
	`ªcy˛e_‹_‰ì
 (
vm
, 
bm
, 
buf„rs
[
i
 + 3], 
b3
, 
fﬁlow_buf„r_√xt
);

719 
i
 += 4;

722 
i
 < 
n_buf„rs
)

724 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
]);

725 
	`VLIB_BUFFER_TRACE_TRAJECTORY_INIT
 (
b0
);

726 
	`ªcy˛e_‹_‰ì
 (
vm
, 
bm
, 
buf„rs
[
i
], 
b0
, 
fﬁlow_buf„r_√xt
);

727 
i
++;

730 i‡(
	`vec_Àn
 (
bm
->
™noun˚_li°
))

732 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

733 
i
 = 0; i < 
	`vec_Àn
 (
bm
->
™noun˚_li°
); i++)

735 
Ê
 = 
bm
->
™noun˚_li°
[
i
];

736 
Ê
->
	`buf„rs_added_to_‰ìli°_fun˘i⁄
 (
vm
, fl);

738 
	`_vec_Àn
 (
bm
->
™noun˚_li°
) = 0;

740 
	}
}

743 
	$vlib_buf„r_‰ì_öã∫Æ
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
, u32 
n_buf„rs
)

745 
	`vlib_buf„r_‰ì_ölöe
 (
vm
, 
buf„rs
, 
n_buf„rs
,

747 
	}
}

750 
	$vlib_buf„r_‰ì_no_√xt_öã∫Æ
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
,

751 
u32
 
n_buf„rs
)

753 
	`vlib_buf„r_‰ì_ölöe
 (
vm
, 
buf„rs
, 
n_buf„rs
,

755 
	}
}

758 
__©åibuã__
 ((
unu£d
))

759 
	$vlib_∑ckë_ãm∂©e_buf„r_öô
 (
vlib_maö_t
 * 
vm
,

760 
vlib_buf„r_‰ì_li°_t
 * 
Ê
,

761 
u32
 * 
buf„rs
, u32 
n_buf„rs
)

763 
vlib_∑ckë_ãm∂©e_t
 *
t
 =

764 
	`uw‹d_to_poöãr
 (
Ê
->
buf„r_öô_fun˘i⁄_›aque
,

765 
vlib_∑ckë_ãm∂©e_t
 *);

766 
uw‹d
 
i
;

768 
i
 = 0; i < 
n_buf„rs
; i++)

770 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
]);

771 
	`ASSERT
 (
b
->
cuºít_Àngth
 =
	`vec_Àn
 (
t
->
∑ckë_d©a
));

772 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
b
), 
t
->
∑ckë_d©a
,

773 
b
->
cuºít_Àngth
);

775 
	}
}

778 
	$vlib_∑ckë_ãm∂©e_öô
 (
vlib_maö_t
 * 
vm
,

779 
vlib_∑ckë_ãm∂©e_t
 * 
t
,

780 *
∑ckë_d©a
,

781 
uw‹d
 
n_∑ckë_d©a_byãs
,

782 
uw‹d
 
mö_n_buf„rs_óch_physmem_Æloc
,

783 *
fmt
, ...)

785 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

786 
va_li°
 
va
;

787 
u8
 *
«me
;

788 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

790 
	`va_°¨t
 (
va
, 
fmt
);

791 
«me
 = 
	`va_f‹m©
 (0, 
fmt
, &
va
);

792 
	`va_íd
 (
va
);

794 i‡(
bm
->
cb
.
vlib_∑ckë_ãm∂©e_öô_cb
)

795 
bm
->
cb
.
	`vlib_∑ckë_ãm∂©e_öô_cb
 (
vm
, (*Ë
t
, 
∑ckë_d©a
,

796 
n_∑ckë_d©a_byãs
,

797 
mö_n_buf„rs_óch_physmem_Æloc
,

798 
«me
);

800 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

802 
	`mem£t
 (
t
, 0,  (t[0]));

804 
	`vec_add
 (
t
->
∑ckë_d©a
,Öackë_d©a, 
n_∑ckë_d©a_byãs
);

805 
t
->
mö_n_buf„rs_óch_physmem_Æloc
 = min_n_buffers_each_physmem_alloc;

807 
t
->
‰ì_li°_ödex
 = 
vlib_buf„r_¸óã_‰ì_li°_hñ≥r


808 (
vm
, 
n_∑ckë_d©a_byãs
,

811 
«me
);

813 
	`ASSERT
 (
t
->
‰ì_li°_ödex
 != 0);

814 
Ê
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vm
, 
t
->
‰ì_li°_ödex
);

815 
Ê
->
mö_n_buf„rs_óch_physmem_Æloc
 = 
t
->min_n_buffers_each_physmem_alloc;

817 
Ê
->
buf„r_öô_fun˘i⁄
 = 
vlib_∑ckë_ãm∂©e_buf„r_öô
;

818 
Ê
->
buf„r_öô_fun˘i⁄_›aque
 = 
	`poöãr_to_uw‹d
 (
t
);

820 
Ê
->
buf„r_öô_ãm∂©e
.
cuºít_d©a
 = 0;

821 
Ê
->
buf„r_öô_ãm∂©e
.
cuºít_Àngth
 = 
n_∑ckë_d©a_byãs
;

822 
Ê
->
buf„r_öô_ãm∂©e
.
Êags
 = 0;

823 
Ê
->
buf„r_öô_ãm∂©e
.
n_add_ªfs
 = 0;

824 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

825 
	}
}

828 
	$vlib_∑ckë_ãm∂©e_gë_∑ckë
 (
vlib_maö_t
 * 
vm
,

829 
vlib_∑ckë_ãm∂©e_t
 * 
t
, 
u32
 * 
bi_ªsu…
)

831 
u32
 
bi
;

832 
vlib_buf„r_t
 *
b
;

834 i‡(
	`vlib_buf„r_Æloc
 (
vm
, &
bi
, 1) != 1)

837 *
bi_ªsu…
 = 
bi
;

839 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

840 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
b
),

841 
t
->
∑ckë_d©a
, 
	`vec_Àn
 (t->packet_data));

842 
b
->
cuºít_Àngth
 = 
	`vec_Àn
 (
t
->
∑ckë_d©a
);

844  
b
->
d©a
;

845 
	}
}

848 
	$vlib_∑ckë_ãm∂©e_gë_∑ckë_hñ≥r
 (
vlib_maö_t
 * 
vm
,

849 
vlib_∑ckë_ãm∂©e_t
 * 
t
)

851 
w‹d
 
n
 = 
t
->
mö_n_buf„rs_óch_physmem_Æloc
;

852 
w‹d
 
l
 = 
	`vec_Àn
 (
t
->
∑ckë_d©a
);

853 
w‹d
 
n_Æloc
;

855 
	`ASSERT
 (
l
 > 0);

856 
	`ASSERT
 (
	`vec_Àn
 (
t
->
‰ì_buf„rs
) == 0);

858 
	`vec_vÆid©e
 (
t
->
‰ì_buf„rs
, 
n
 - 1);

859 
n_Æloc
 = 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, 
t
->
‰ì_buf„rs
,

860 
n
, 
t
->
‰ì_li°_ödex
);

861 
	`_vec_Àn
 (
t
->
‰ì_buf„rs
Ë
n_Æloc
;

862 
	}
}

865 
u32


866 
	$vlib_buf„r_add_d©a
 (
vlib_maö_t
 * 
vm
,

867 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
,

868 
u32
 
buf„r_ödex
, *
d©a
, u32 
n_d©a_byãs
)

870 
u32
 
n_buf„r_byãs
, 
n_À·
, 
n_À·_this_buf„r
, 
bi
;

871 
vlib_buf„r_t
 *
b
;

872 *
d
;

874 
bi
 = 
buf„r_ödex
;

875 i‡(
bi
 == 0

876 && 1 !
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, &
bi
, 1, 
‰ì_li°_ödex
))

877 
out_of_buf„rs
;

879 
d
 = 
d©a
;

880 
n_À·
 = 
n_d©a_byãs
;

881 
n_buf„r_byãs
 = 
	`vlib_buf„r_‰ì_li°_buf„r_size
 (
vm
, 
‰ì_li°_ödex
);

883 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

884 
b
->
Êags
 &~
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

887 
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

888 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

892 
u32
 
n
;

894 
	`ASSERT
 (
n_buf„r_byãs
 >
b
->
cuºít_Àngth
);

895 
n_À·_this_buf„r
 =

896 
n_buf„r_byãs
 - (
b
->
cuºít_d©a
 + b->
cuºít_Àngth
);

897 
n
 = 
	`˛ib_mö
 (
n_À·_this_buf„r
, 
n_À·
);

898 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
b
Ë+ b->
cuºít_Àngth
, 
d
, 
n
);

899 
b
->
cuºít_Àngth
 +
n
;

900 
n_À·
 -
n
;

901 i‡(
n_À·
 == 0)

904 
d
 +
n
;

906 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, &
b
->
√xt_buf„r
, 1,

907 
‰ì_li°_ödex
))

908 
out_of_buf„rs
;

910 
b
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

912 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

915  
bi
;

917 
out_of_buf„rs
:

918 
	`˛ib_îr‹
 ("out of buffers");

919  
bi
;

920 
	}
}

922 
u16


923 
	$vlib_buf„r_chaö_≠≥nd_d©a_wôh_Æloc
 (
vlib_maö_t
 * 
vm
,

924 
vlib_buf„r_‰ì_li°_ödex_t


925 
‰ì_li°_ödex
,

926 
vlib_buf„r_t
 * 
fú°
,

927 
vlib_buf„r_t
 ** 
œ°
, *
d©a
,

928 
u16
 
d©a_Àn
)

930 
vlib_buf„r_t
 *
l
 = *
œ°
;

931 
u32
 
n_buf„r_byãs
 =

932 
	`vlib_buf„r_‰ì_li°_buf„r_size
 (
vm
, 
‰ì_li°_ödex
);

933 
u16
 
c›õd
 = 0;

934 
	`ASSERT
 (
n_buf„r_byãs
 >
l
->
cuºít_Àngth
 +Ü->
cuºít_d©a
);

935 
d©a_Àn
)

937 
u16
 
max
 = 
n_buf„r_byãs
 - 
l
->
cuºít_Àngth
 -Ü->
cuºít_d©a
;

938 i‡(
max
 == 0)

941 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, &
l
->
√xt_buf„r
, 1,

942 
‰ì_li°_ödex
))

943  
c›õd
;

944 *
œ°
 = 
l
 = 
	`vlib_buf„r_chaö_buf„r
 (
vm
, 
fú°
,Ü,Ü->
√xt_buf„r
);

945 
max
 = 
n_buf„r_byãs
 - 
l
->
cuºít_Àngth
 -Ü->
cuºít_d©a
;

948 
u16
 
Àn
 = (
d©a_Àn
 > 
max
) ? max : data_len;

949 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
l
Ë+Ü->
cuºít_Àngth
,

950 
d©a
 + 
c›õd
, 
Àn
);

951 
	`vlib_buf„r_chaö_ö¸ó£_Àngth
 (
fú°
, 
l
, 
Àn
);

952 
d©a_Àn
 -
Àn
;

953 
c›õd
 +
Àn
;

955  
c›õd
;

956 
	}
}

958 
u8


959 
	$vlib_buf„r_add_physmem_ªgi⁄
 (
vlib_maö_t
 * 
vm
,

960 
vlib_physmem_ªgi⁄_ödex_t
 
¥i
)

962 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

963 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
¥i
);

964 
vlib_buf„r_poﬁ_t
 *
p
;

965 
uw‹d
 
°¨t
 = 
	`poöãr_to_uw‹d
 (
¥
->
mem
);

966 
uw‹d
 
size
 = 
¥
->size;

968 i‡(
bm
->
buf„r_mem_size
 == 0)

970 
bm
->
buf„r_mem_°¨t
 = 
°¨t
;

971 
bm
->
buf„r_mem_size
 = 
size
;

973 i‡(
°¨t
 < 
bm
->
buf„r_mem_°¨t
)

975 
bm
->
buf„r_mem_size
 +bm->
buf„r_mem_°¨t
 - 
°¨t
;

976 
bm
->
buf„r_mem_°¨t
 = 
°¨t
;

977 i‡(
size
 > 
bm
->
buf„r_mem_size
)

978 
bm
->
buf„r_mem_size
 = 
size
;

980 i‡(
°¨t
 > 
bm
->
buf„r_mem_°¨t
)

982 
uw‹d
 
√w_size
 = 
°¨t
 - 
bm
->
buf„r_mem_°¨t
 + 
size
;

983 i‡(
√w_size
 > 
bm
->
buf„r_mem_size
)

984 
bm
->
buf„r_mem_size
 = 
√w_size
;

987 i‡((
u64
Ë
bm
->
buf„r_mem_size
 >

988 ((
u64
Ë1 << (32 + 
CLIB_LOG2_CACHE_LINE_BYTES
)))

990 
	`˛ib_∑nic
 ("buffer memory size out ofÑange!");

993 
	`vec_add2
 (
bm
->
buf„r_poﬁs
, 
p
, 1);

994 
p
->
°¨t
 = start;

995 
p
->
size
 = size;

996 
p
->
physmem_ªgi⁄
 = 
¥i
;

997 
p
->
Æloc_chunk_size
 = (
¥
->
log2_∑ge_size
 > 18) ? 16 : 1;

998  
p
 - 
bm
->
buf„r_poﬁs
;

999 
	}
}

1001 
u8
 *

1002 
	$f‹m©_vlib_buf„r_‰ì_li°
 (
u8
 * 
s
, 
va_li°
 * 
va
)

1004 
vlib_buf„r_‰ì_li°_t
 *
f
 = 
	`va_¨g
 (*
va
, vlib_buffer_free_list_t *);

1005 
u32
 
thªadnum
 = 
	`va_¨g
 (*
va
, u32);

1006 
uw‹d
 
byãs_Æloc
, 
byãs_‰ì
, 
n_‰ì
, 
size
;

1008 i‡(!
f
)

1009  
	`f‹m©
 (
s
, "%=7s%=30s%=12s%=12s%=12s%=12s%=12s%=12s",

1013 
size
 =  (
vlib_buf„r_t
Ë+ 
f
->
n_d©a_byãs
;

1014 
n_‰ì
 = 
	`vec_Àn
 (
f
->
buf„rs
);

1015 
byãs_Æloc
 = 
size
 * 
f
->
n_Æloc
;

1016 
byãs_‰ì
 = 
size
 * 
n_‰ì
;

1018 
s
 = 
	`f‹m©
 (s, "%7d%30v%12d%12d%=12U%=12U%=12d%=12d", 
thªadnum
,

1019 
f
->
«me
, f->
ödex
, f->
n_d©a_byãs
,

1020 
f‹m©_mem‹y_size
, 
byãs_Æloc
,

1021 
f‹m©_mem‹y_size
, 
byãs_‰ì
, 
f
->
n_Æloc
, 
n_‰ì
);

1023  
s
;

1024 
	}
}

1026 
˛ib_îr‹_t
 *

1027 
	$show_buf„rs
 (
vlib_maö_t
 * 
vm
,

1028 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

1030 
vlib_buf„r_maö_t
 *
bm
;

1031 
vlib_buf„r_‰ì_li°_t
 *
f
;

1032 
vlib_maö_t
 *
cuº_vm
;

1033 
u32
 
vm_ödex
 = 0;

1035 
	`vlib_˛i_ouçut
 (
vm
, "%U", 
f‹m©_vlib_buf„r_‰ì_li°
, 0, 0);

1039 
cuº_vm
 = 
vlib_maös
[
vm_ödex
];

1040 
bm
 = 
cuº_vm
->
buf„r_maö
;

1043 
	`poﬁ_f‹óch
 (
f
, 
bm
->
buf„r_‰ì_li°_poﬁ
, ({

1044 
	`vlib_˛i_ouçut
 (
vm
, "%U", 
f‹m©_vlib_buf„r_‰ì_li°
, 
f
, 
vm_ödex
);

1048 
vm_ödex
++;

1050 
vm_ödex
 < 
	`vec_Àn
 (
vlib_maös
));

1053 
	}
}

1056 
VLIB_CLI_COMMAND
 (
show_buf„rs_comm™d
, ) = {

1057 .
∑th
 = "show buffers",

1058 .
	gsh‹t_hñp
 = "ShowÖacket bufferállocation",

1059 .
	gfun˘i⁄
 = 
show_buf„rs
,

1063 
˛ib_îr‹_t
 *

1064 
	$vlib_buf„r_maö_öô
 (
vlib_maö_t
 * 
vm
)

1066 
vlib_buf„r_maö_t
 *
bm
;

1067 
vlib_physmem_ªgi⁄_ödex_t
 
¥i
;

1068 
˛ib_îr‹_t
 *
îr‹
;

1070 
	`vec_vÆid©e
 (
vm
->
buf„r_maö
, 0);

1071 
bm
 = 
vm
->
buf„r_maö
;

1073 i‡(
vlib_buf„r_ˇŒbacks
)

1077 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

1078 
	`˛ib_mem˝y
 (&
bm
->
cb
, 
vlib_buf„r_ˇŒbacks
,

1079  (
vlib_buf„r_ˇŒbacks_t
));

1080 
bm
->
ˇŒbacks_ªgi°îed
 = 1;

1084 
bm
->
cb
.
vlib_buf„r_fûl_‰ì_li°_cb
 = &
vlib_buf„r_fûl_‰ì_li°_öã∫Æ
;

1085 
bm
->
cb
.
vlib_buf„r_‰ì_cb
 = &
vlib_buf„r_‰ì_öã∫Æ
;

1086 
bm
->
cb
.
vlib_buf„r_‰ì_no_√xt_cb
 = &
vlib_buf„r_‰ì_no_√xt_öã∫Æ
;

1087 
bm
->
cb
.
vlib_buf„r_dñëe_‰ì_li°_cb
 =

1088 &
vlib_buf„r_dñëe_‰ì_li°_öã∫Æ
;

1089 
	`˛ib_•ölock_öô
 (&
bm
->
buf„r_known_hash_lockp
);

1092 
îr‹
 = 
	`vlib_physmem_ªgi⁄_Æloc
 (
vm
, "buffers",

1093 
vlib_buf„r_physmem_sz
, 0,

1094 
VLIB_PHYSMEM_F_SHARED
 |

1095 
VLIB_PHYSMEM_F_HUGETLB
 |

1096 
VLIB_PHYSMEM_F_INIT_MHEAP
, &
¥i
);

1098 i‡(
îr‹
 == 0)

1099 
d⁄e
;

1101 
	`˛ib_îr‹_‰ì
 (
îr‹
);

1103 
îr‹
 = 
	`vlib_physmem_ªgi⁄_Æloc
 (
vm
, "buffers",

1104 
vlib_buf„r_physmem_sz
, 0,

1105 
VLIB_PHYSMEM_F_SHARED
 |

1106 
VLIB_PHYSMEM_F_INIT_MHEAP
, &
¥i
);

1107 
d⁄e
:

1108 i‡(
îr‹
 == 0)

1109 
	`vlib_buf„r_add_physmem_ªgi⁄
 (
vm
, 
¥i
);

1110  
îr‹
;

1111 
	}
}

1113 
˛ib_îr‹_t
 *

1114 
	$vlib_buf„rs_c⁄figuª
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

1116 
u32
 
size_ö_mb
;

1118 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

1120 i‡(
	`unf‹m©
 (
öput
, "mem‹y-size-ö-mb %d", &
size_ö_mb
))

1121 
vlib_buf„r_physmem_sz
 = 
size_ö_mb
 << 20;

1123  
	`unf‹m©_∑r£_îr‹
 (
öput
);

1126 
	`unf‹m©_‰ì
 (
öput
);

1128 
	}
}

1130 
VLIB_EARLY_CONFIG_FUNCTION
 (
vlib_buf„rs_c⁄figuª
, "buffers");

	@buffer.h

40 #i‚de‡
ö˛uded_vlib_buf„r_h


41 
	#ö˛uded_vlib_buf„r_h


	)

43 
	~<vµö‰a/ty≥s.h
>

44 
	~<vµö‰a/ˇche.h
>

45 
	~<vµö‰a/£rülize.h
>

46 
	~<vµö‰a/ve˘‹.h
>

47 
	~<vµö‰a/lock.h
>

48 
	~<vlib/îr‹.h
>

50 
	~<vlib/c⁄fig.h
>

51 
	#VLIB_BUFFER_DATA_SIZE
 (2048)

	)

52 
	#VLIB_BUFFER_PRE_DATA_SIZE
 
__PRE_DATA_SIZE


	)

54 
u8
 
	tvlib_buf„r_‰ì_li°_ödex_t
;

66 
	#f‹óch_vlib_buf„r_Êag
 \

67 
	`_
–0, 
NON_DEFAULT_FREELIST
, "non-default-fl") \

68 
	`_
–1, 
IS_TRACED
, 0) \

69 
	`_
–2, 
NEXT_PRESENT
, 0) \

70 
	`_
–3, 
IS_RECYCLED
, "is-recycled") \

71 
	`_
–4, 
TOTAL_LENGTH_VALID
, 0) \

72 
	`_
–5, 
REPL_FAIL
, "repl-fail") \

73 
	`_
–6, 
RECYCLE
, "recycle") \

74 
	`_
–7, 
EXT_HDR_VALID
, "ext-hdr-vÆid")

	)

81 
	#_
(
bô
, 
«me
, 
v
Ë
VLIB_BUFFER_
##«mê(1 << (bô)),

	)

82 
	mf‹óch_vlib_buf„r_Êag


83 #unde‡
_


88 
	#_
(
bô
, 
«me
, 
v
Ë
VLIB_BUFFER_LOG2_
##«mê(bô),

	)

89 
	mf‹óch_vlib_buf„r_Êag


90 #unde‡
_


94 
	#LOG2_VLIB_BUFFER_FLAG_USER
(
n
Ë(32 - (n))

	)

95 
	#VLIB_BUFFER_FLAG_USER
(
n
Ë(1 << 
	`LOG2_VLIB_BUFFER_FLAG_USER
“))

	)

100 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

101 
STRUCT_MARK
 (
ãm∂©e_°¨t
);

104 
i16
 
	mcuºít_d©a
;

108 
u16
 
	mcuºít_Àngth
;

111 
u32
 
	mÊags
;

124 
STRUCT_MARK
 (
ãm∂©e_íd
);

126 
u32
 
	m√xt_buf„r
;

130 
vlib_îr‹_t
 
	mîr‹
;

133 
u32
 
	mcuºít_c⁄fig_ödex
;

137 
u8
 
	m„©uª_¨c_ödex
;

141 
u8
 
	mn_add_ªfs
;

143 
u8
 
	mbuf„r_poﬁ_ödex
;

144 
u8
 
	md⁄t_wa°e_me
[1];

149 
u32
 
	m›aque
[10];

152 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

154 
u32
 
	måa˚_ödex
;

157 
u32
 
	mªcy˛e_cou¡
;

159 
u32
 
	mtŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

163 
vlib_buf„r_‰ì_li°_ödex_t
 
	m‰ì_li°_ödex
;

166 
u8
 
	mÆign_∑d
[3];

167 
u32
 
	m›aque2
[12];

170 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe2
);

171 
u8
 
	m¥e_d©a
[
VLIB_BUFFER_PRE_DATA_SIZE
];

179 
u8
 
	md©a
[0];

180 } 
	tvlib_buf„r_t
;

182 
	#VLIB_BUFFER_HDR_SIZE
 ((
vlib_buf„r_t
Ë- 
VLIB_BUFFER_PRE_DATA_SIZE
)

	)

191 
	#vlib_¥e„tch_buf„r_hódî
(
b
,
ty≥
Ë
	`CLIB_PREFETCH
 (b, 64,Åy≥)

	)

193 
Æways_ölöe
 
vlib_buf„r_t
 *

194 
	$vlib_buf„r_√xt_c⁄tiguous
 (
vlib_buf„r_t
 * 
b
, 
u32
 
buf„r_byãs
)

196  (*Ë(
b
 + 1Ë+ 
buf„r_byãs
;

197 
	}
}

199 
Æways_ölöe
 

200 
	$vlib_buf„r_°ru˘_is_ß√
 (
vlib_buf„r_t
 * 
b
)

202 
	`ASSERT
 ( (
b
[0]) % 64 == 0);

205 
	`ASSERT
 (
b
->
¥e_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 =b->
d©a
);

206 
	}
}

214 
Æways_ölöe
 *

215 
	$vlib_buf„r_gë_cuºít
 (
vlib_buf„r_t
 * 
b
)

218 
	`ASSERT
 ((sig√dË
b
->
cuºít_d©a
 >(sig√dË-
VLIB_BUFFER_PRE_DATA_SIZE
);

219  
b
->
d©a
 + b->
cuºít_d©a
;

220 
	}
}

227 
Æways_ölöe
 

228 
	$vlib_buf„r_adv™˚
 (
vlib_buf„r_t
 * 
b
, 
w‹d
 
l
)

230 
	`ASSERT
 (
b
->
cuºít_Àngth
 >
l
);

231 
b
->
cuºít_d©a
 +
l
;

232 
b
->
cuºít_Àngth
 -
l
;

233 
	}
}

241 
Æways_ölöe
 
u8


242 
	$vlib_buf„r_has_•a˚
 (
vlib_buf„r_t
 * 
b
, 
w‹d
 
l
)

244  
b
->
cuºít_Àngth
 >
l
;

245 
	}
}

253 
Æways_ölöe
 

254 
	$vlib_buf„r_ª£t
 (
vlib_buf„r_t
 * 
b
)

256 
b
->
cuºít_Àngth
 +
	`˛ib_max
 (b->
cuºít_d©a
, 0);

257 
b
->
cuºít_d©a
 = 0;

258 
	}
}

265 
Æways_ölöe
 *

266 
	$vlib_gë_buf„r_›aque
 (
vlib_buf„r_t
 * 
b
)

268  (*Ë
b
->
›aque
;

269 
	}
}

276 
Æways_ölöe
 *

277 
	$vlib_gë_buf„r_›aque2
 (
vlib_buf„r_t
 * 
b
)

279  (*Ë
b
->
›aque2
;

280 
	}
}

286 
Æways_ölöe
 
u8
 *

287 
	$vlib_buf„r_gë_èû
 (
vlib_buf„r_t
 * 
b
)

289  
b
->
d©a
 + b->
cuºít_d©a
 + b->
cuºít_Àngth
;

290 
	}
}

297 
Æways_ölöe
 *

298 
	$vlib_buf„r_put_unöô
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

300 *
p
 = 
	`vlib_buf„r_gë_èû
 (
b
);

302 
b
->
cuºít_Àngth
 +
size
;

303  
p
;

304 
	}
}

311 
Æways_ölöe
 *

312 
	$vlib_buf„r_push_unöô
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

314 
	`ASSERT
 (
b
->
cuºít_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 >
size
);

315 
b
->
cuºít_d©a
 -
size
;

316 
b
->
cuºít_Àngth
 +
size
;

318  
	`vlib_buf„r_gë_cuºít
 (
b
);

319 
	}
}

326 
Æways_ölöe
 *

327 
	$vlib_buf„r_make_hódroom
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

329 
	`ASSERT
 (
b
->
cuºít_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 >
size
);

330 
b
->
cuºít_d©a
 +
size
;

331  
	`vlib_buf„r_gë_cuºít
 (
b
);

332 
	}
}

339 
Æways_ölöe
 *

340 
	$vlib_buf„r_puŒ
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

342 i‡(
b
->
cuºít_Àngth
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 < 
size
)

345 *
d©a
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

346 
	`vlib_buf„r_adv™˚
 (
b
, 
size
);

347  
d©a
;

348 
	}
}

351 
	gvlib_maö_t
;

353 
	svlib_buf„r_‰ì_li°_t


357 
vlib_buf„r_t
 
	mbuf„r_öô_ãm∂©e
;

360 
vlib_buf„r_‰ì_li°_ödex_t
 
	mödex
;

363 
u32
 
	mn_d©a_byãs
;

367 
u32
 
	mmö_n_buf„rs_óch_physmem_Æloc
;

370 
u32
 
	mn_Æloc
;

373 
u32
 *
	mbuf„rs
;

378 
u32
 *
	mglobÆ_buf„rs
;

379 
˛ib_•ölock_t
 
	mglobÆ_buf„rs_lock
;

384 **
	mbuf„r_mem‹y_Æloˇãd
;

387 
u8
 *
	m«me
;

391 (*
	mbuf„r_öô_fun˘i⁄
Ë(
vlib_maö_t
 * 
	mvm
,

392 
vlib_buf„r_‰ì_li°_t
 * 
	mÊ
,

393 
u32
 * 
	mbuf„rs
, u32 
	mn_buf„rs
);

397 (*
	mbuf„rs_added_to_‰ìli°_fun˘i⁄
)

398 (
vlib_maö_t
 * 
	mvm
, 
vlib_buf„r_‰ì_li°_t
 * 
	mÊ
);

400 
uw‹d
 
	mbuf„r_öô_fun˘i⁄_›aque
;

401 } 
	t__©åibuã__
 ((
	tÆig√d
 (16))Ë
	tvlib_buf„r_‰ì_li°_t
;

403 
	$uw‹d
 (
	tvlib_buf„r_fûl_‰ì_li°_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

404 
	tvlib_buf„r_‰ì_li°_t
 * 
	tÊ
,

405 
	tuw‹d
 
	tmö_‰ì_buf„rs
);

406 (
	tvlib_buf„r_‰ì_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
, 
	tu32
 * 
	tbuf„rs
,

407 
	tu32
 
	tn_buf„rs
);

408 (
	tvlib_buf„r_‰ì_no_√xt_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

409 
	tu32
 * 
	tbuf„rs
, u32 
	tn_buf„rs
);

413 
vlib_buf„r_fûl_‰ì_li°_cb_t
 *
vlib_buf„r_fûl_‰ì_li°_cb
;

414 
vlib_buf„r_‰ì_cb_t
 *
vlib_buf„r_‰ì_cb
;

415 
vlib_buf„r_‰ì_no_√xt_cb_t
 *
vlib_buf„r_‰ì_no_√xt_cb
;

416 (*
vlib_∑ckë_ãm∂©e_öô_cb
Ë(
vlib_maö_t
 * 
vm
, *
t
,

417 *
∑ckë_d©a
,

418 
uw‹d
 
n_∑ckë_d©a_byãs
,

419 
uw‹d


420 
mö_n_buf„rs_óch_physmem_Æloc
,

421 
u8
 * 
«me
);

422 (*
vlib_buf„r_dñëe_‰ì_li°_cb
Ë(
vlib_maö_t
 * 
vm
,

423 
vlib_buf„r_‰ì_li°_ödex_t


424 
‰ì_li°_ödex
);

425 } 
	tvlib_buf„r_ˇŒbacks_t
;

427 
vlib_buf„r_ˇŒbacks_t
 *
vlib_buf„r_ˇŒbacks
;

431 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

432 
uw‹d
 
°¨t
;

433 
uw‹d
 
size
;

434 
vlib_physmem_ªgi⁄_ödex_t
 
physmem_ªgi⁄
;

435 
Æloc_chunk_size
;

436 } 
	tvlib_buf„r_poﬁ_t
;

440 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

443 
uw‹d
 
buf„r_mem_°¨t
;

444 
uw‹d
 
buf„r_mem_size
;

445 
vlib_buf„r_poﬁ_t
 *
buf„r_poﬁs
;

448 
	`u32
 (*
buf„r_‰ì_ˇŒback
Ë(
vlib_maö_t
 * 
vm
,

449 
u32
 * 
buf„rs
,

450 
u32
 
n_buf„rs
, u32 
fﬁlow_buf„r_√xt
);

455 
vlib_buf„r_‰ì_li°_t
 *
buf„r_‰ì_li°_poﬁ
;

456 
	#VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
 (0)

	)

457 
	#VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
 
VLIB_BUFFER_DATA_SIZE


	)

461 
uw‹d
 *
‰ì_li°_by_size
;

467 
uw‹d
 *
buf„r_known_hash
;

468 
˛ib_•ölock_t
 
buf„r_known_hash_lockp
;

471 
vlib_buf„r_‰ì_li°_t
 **
™noun˚_li°
;

474 
vlib_buf„r_ˇŒbacks_t
 
cb
;

475 
ˇŒbacks_ªgi°îed
;

476 } 
	tvlib_buf„r_maö_t
;

478 
u8
 
	`vlib_buf„r_add_physmem_ªgi⁄
 (
vlib_maö_t
 *
vm
,

479 
vlib_physmem_ªgi⁄_ödex_t
 
ªgi⁄
);

481 
˛ib_îr‹_t
 *
	`vlib_buf„r_maö_öô
 (
vlib_maö_t
 *
vm
);

485 
vlib_maö_t
 *
vlib_maö
;

487 
u32
 
fú°_buf„r
, 
œ°_buf„r
;

494 
u32
 
n_tŸÆ_d©a_byãs
;

498 
u32
 
max_n_d©a_byãs_≥r_chaö
;

501 
u32
 
√xt_ödex
;

504 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
;

505 } 
tx
;

510 
u32
 *
buf„r_fifo
;

513 
uw‹d
 
ªady_⁄e_time_evít
;

514 } 
rx
;

516 } 
	tvlib_£rülize_buf„r_maö_t
;

518 
	`£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
, 
vlib_maö_t
 *
vm
,

519 
vlib_£rülize_buf„r_maö_t
 * 
sm
);

520 
	`un£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
,

521 
vlib_maö_t
 *
vm
,

522 
vlib_£rülize_buf„r_maö_t
 * 
sm
);

524 
u32
 
	`£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
);

525 
	`un£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
);

526 *
	`vlib_£t_buf„r_‰ì_ˇŒback
 (
vlib_maö_t
 *
vm
, *
Â
);

528 
Æways_ölöe
 
u32


529 
	$£rülize_vlib_buf„r_n_byãs
 (
£rülize_maö_t
 * 
m
)

531 
£rülize_°ªam_t
 *
s
 = &
m
->
°ªam
;

532 
vlib_£rülize_buf„r_maö_t
 *
sm


533 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

534 
vlib_£rülize_buf„r_maö_t
 *);

535  
sm
->
tx
.
n_tŸÆ_d©a_byãs
 + 
s
->
cuºít_buf„r_ödex
 +

536 
	`vec_Àn
 (
s
->
ovîÊow_buf„r
);

537 
	}
}

547 
	#VLIB_BUFFER_TRACE_TRAJECTORY
 0

	)

549 #i‡
VLIB_BUFFER_TRACE_TRAJECTORY
 > 0

550 (*
vlib_buf„r_åa˚_åaje˘‹y_cb
Ë(
vlib_buf„r_t
 * 
b
, 
u32
 
ödex
);

551 (*
vlib_buf„r_åa˚_åaje˘‹y_öô_cb
Ë(
vlib_buf„r_t
 * 
b
);

552 
	`vlib_buf„r_åa˚_åaje˘‹y_öô
 (
vlib_buf„r_t
 * 
b
);

553 
	#VLIB_BUFFER_TRACE_TRAJECTORY_INIT
(
b
) \

554 
	`vlib_buf„r_åa˚_åaje˘‹y_öô
 (
b
);

	)

556 
	#VLIB_BUFFER_TRACE_TRAJECTORY_INIT
(
b
)

	)

561 
	#VLIB_BUFFER_REGISTER_CALLBACKS
(
x
,...) \

562 
__VA_ARGS__
 
vlib_buf„r_ˇŒbacks_t
 
__
##
x
##
_buf„r_ˇŒbacks
; \

563 
__vlib_add_buf„r_ˇŒbacks_t_
##
	`x
 () \

564 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

565 
__vlib_add_buf„r_ˇŒbacks_t_
##
	`x
 () \

567 i‡(
vlib_buf„r_ˇŒbacks
) \

568 
	`˛ib_∑nic
 ("vlib buffer callbacksálreadyÑegistered"); \

569 
vlib_buf„r_ˇŒbacks
 = &
__
##
x
##
_buf„r_ˇŒbacks
; \

570 
	}
} \

571 
__VA_ARGS__
 
vlib_buf„r_ˇŒbacks_t
 
__
##
x
##
_buf„r_ˇŒbacks


	)

	@buffer_funcs.h

40 #i‚de‡
ö˛uded_vlib_buf„r_funcs_h


41 
	#ö˛uded_vlib_buf„r_funcs_h


	)

43 
	~<vµö‰a/hash.h
>

56 
Æways_ölöe
 
vlib_buf„r_t
 *

57 
	$vlib_gë_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

59 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

60 
uw‹d
 
off£t
 = ((uw‹dË
buf„r_ödex
Ë<< 
CLIB_LOG2_CACHE_LINE_BYTES
;

61 
	`ASSERT
 (
off£t
 < 
bm
->
buf„r_mem_size
);

63  
	`uw‹d_to_poöãr
 (
bm
->
buf„r_mem_°¨t
 + 
off£t
, *);

64 
	}
}

73 
Æways_ölöe
 
u32


74 
	$vlib_gë_buf„r_ödex
 (
vlib_maö_t
 * 
vm
, *
p
)

76 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

77 
uw‹d
 
off£t
 = 
	`poöãr_to_uw‹d
 (
p
Ë- 
bm
->
buf„r_mem_°¨t
;

78 
	`ASSERT
 (
	`poöãr_to_uw‹d
 (
p
Ë>
bm
->
buf„r_mem_°¨t
);

79 
	`ASSERT
 (
off£t
 < 
bm
->
buf„r_mem_size
);

80 
	`ASSERT
 ((
off£t
 % (1 << 
CLIB_LOG2_CACHE_LINE_BYTES
)) == 0);

81  
off£t
 >> 
CLIB_LOG2_CACHE_LINE_BYTES
;

82 
	}
}

90 
Æways_ölöe
 
vlib_buf„r_t
 *

91 
	$vlib_gë_√xt_buf„r
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

93  (
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT


94 ? 
	`vlib_gë_buf„r
 (
vm
, 
b
->
√xt_buf„r
) : 0);

95 
	}
}

97 
uw‹d
 
vlib_buf„r_Àngth_ö_chaö_¶ow_∑th
 (
vlib_maö_t
 * 
vm
,

98 
vlib_buf„r_t
 * 
b_fú°
);

106 
Æways_ölöe
 
uw‹d


107 
	$vlib_buf„r_Àngth_ö_chaö
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

109 
uw‹d
 
Àn
 = 
b
->
cuºít_Àngth
;

111 i‡(
	`PREDICT_TRUE
 ((
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
) == 0))

112  
Àn
;

114 i‡(
	`PREDICT_TRUE
 (
b
->
Êags
 & 
VLIB_BUFFER_TOTAL_LENGTH_VALID
))

115  
Àn
 + 
b
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

117  
	`vlib_buf„r_Àngth_ö_chaö_¶ow_∑th
 (
vm
, 
b
);

118 
	}
}

126 
Æways_ölöe
 
uw‹d


127 
	$vlib_buf„r_ödex_Àngth_ö_chaö
 (
vlib_maö_t
 * 
vm
, 
u32
 
bi
)

129 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

130  
	`vlib_buf„r_Àngth_ö_chaö
 (
vm
, 
b
);

131 
	}
}

140 
Æways_ölöe
 
uw‹d


141 
	$vlib_buf„r_c⁄ã¡s
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
, 
u8
 * 
c⁄ã¡s
)

143 
uw‹d
 
c⁄ã¡_Àn
 = 0;

144 
uw‹d
 
l
;

145 
vlib_buf„r_t
 *
b
;

149 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

150 
l
 = 
b
->
cuºít_Àngth
;

151 
	`˛ib_mem˝y
 (
c⁄ã¡s
 + 
c⁄ã¡_Àn
, 
b
->
d©a
 + b->
cuºít_d©a
, 
l
);

152 
c⁄ã¡_Àn
 +
l
;

153 i‡(!(
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

155 
buf„r_ödex
 = 
b
->
√xt_buf„r
;

158  
c⁄ã¡_Àn
;

159 
	}
}

162 
Æways_ölöe
 
u64


163 
	$vlib_gë_buf„r_d©a_physiˇl_addªss
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

165 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

166 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

167 
vlib_buf„r_poﬁ_t
 *
poﬁ
 = 
	`vec_ñt_©_ödex
 (
bm
->
buf„r_poﬁs
,

168 
b
->
buf„r_poﬁ_ödex
);

170  
	`vlib_physmem_vútuÆ_to_physiˇl
 (
vm
, 
poﬁ
->
physmem_ªgi⁄
, 
b
->
d©a
);

171 
	}
}

181 
	#vlib_¥e„tch_buf„r_wôh_ödex
(
vm
,
bi
,
ty≥
) \

183 
vlib_buf„r_t
 * 
_b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
); \

184 
	`vlib_¥e„tch_buf„r_hódî
 (
_b
, 
ty≥
); \

185 } 0)

	)

195 
	#vlib_buf„r_f‹óch_Æloˇãd
(
vm
,
bi
,
body
) \

197 
vlib_maö_t
 * 
_vmaö
 = (
vm
); \

198 
vlib_buf„r_maö_t
 * 
_bmaö
 = &
_vmaö
->
buf„r_maö
; \

199 
hash_∑ú_t
 * 
_vb∑ú
; \

200 
	`hash_f‹óch_∑ú
(
_vb∑ú
, 
_bmaö
->
buf„r_known_hash
, ({ \

201 i‡(
VLIB_BUFFER_KNOWN_ALLOCATED
 =
_vb∑ú
->
vÆue
[0]) { \

202 (
bi
Ë
_vb∑ú
->
key
; \

203 
body
; \

206 } 0)

	)

212 
	mVLIB_BUFFER_UNKNOWN
,

215 
	mVLIB_BUFFER_KNOWN_FREE
,

216 
	mVLIB_BUFFER_KNOWN_ALLOCATED
,

217 } 
	tvlib_buf„r_known_°©e_t
;

219 
vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
,

220 
uw‹d
 
n_buf„rs
,

221 
vlib_buf„r_known_°©e_t


222 
ex≥˘ed_°©e
);

224 
Æways_ölöe
 
vlib_buf„r_known_°©e_t


225 
	$vlib_buf„r_is_known
 (
u32
 
buf„r_ödex
)

227 
vlib_buf„r_maö_t
 *
bm
 = 
vlib_globÆ_maö
.
buf„r_maö
;

229 
	`˛ib_•ölock_lock
 (&
bm
->
buf„r_known_hash_lockp
);

230 
uw‹d
 *
p
 = 
	`hash_gë
 (
bm
->
buf„r_known_hash
, 
buf„r_ödex
);

231 
	`˛ib_•ölock_u∆ock
 (&
bm
->
buf„r_known_hash_lockp
);

232  
p
 ?Ö[0] : 
VLIB_BUFFER_UNKNOWN
;

233 
	}
}

235 
Æways_ölöe
 

236 
	$vlib_buf„r_£t_known_°©e
 (
u32
 
buf„r_ödex
,

237 
vlib_buf„r_known_°©e_t
 
°©e
)

239 
vlib_buf„r_maö_t
 *
bm
 = 
vlib_globÆ_maö
.
buf„r_maö
;

241 
	`˛ib_•ölock_lock
 (&
bm
->
buf„r_known_hash_lockp
);

242 
	`hash_£t
 (
bm
->
buf„r_known_hash
, 
buf„r_ödex
, 
°©e
);

243 
	`˛ib_•ölock_u∆ock
 (&
bm
->
buf„r_known_hash_lockp
);

244 
	}
}

248 
u8
 *
vlib_vÆid©e_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
,

249 
uw‹d
 
fﬁlow_chaö
);

251 
Æways_ölöe
 
u32


252 
	$vlib_buf„r_round_size
 (
u32
 
size
)

254  
	`round_pow2
 (
size
,  (
vlib_buf„r_t
));

255 
	}
}

257 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_ödex_t


258 
	$vlib_buf„r_gë_‰ì_li°_ödex
 (
vlib_buf„r_t
 * 
b
)

260 i‡(
	`PREDICT_FALSE
 (
b
->
Êags
 & 
VLIB_BUFFER_NON_DEFAULT_FREELIST
))

261  
b
->
‰ì_li°_ödex
;

264 
	}
}

266 
Æways_ölöe
 

267 
	$vlib_buf„r_£t_‰ì_li°_ödex
 (
vlib_buf„r_t
 * 
b
,

268 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

270 i‡(
	`PREDICT_FALSE
 (
ödex
))

272 
b
->
Êags
 |
VLIB_BUFFER_NON_DEFAULT_FREELIST
;

273 
b
->
‰ì_li°_ödex
 = 
ödex
;

276 
b
->
Êags
 &~
VLIB_BUFFER_NON_DEFAULT_FREELIST
;

277 
	}
}

287 
Æways_ölöe
 
u32


288 
	$vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

289 
u32
 * 
buf„rs
,

290 
u32
 
n_buf„rs
,

291 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

293 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

294 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

295 
u32
 *
§c
;

296 
uw‹d
 
Àn
;

298 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_fûl_‰ì_li°_cb
);

300 
Ê
 = 
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
ödex
);

302 
Àn
 = 
	`vec_Àn
 (
Ê
->
buf„rs
);

304 i‡(
	`PREDICT_FALSE
 (
Àn
 < 
n_buf„rs
))

306 
bm
->
cb
.
	`vlib_buf„r_fûl_‰ì_li°_cb
 (
vm
, 
Ê
, 
n_buf„rs
);

307 i‡(
	`PREDICT_FALSE
 ((
Àn
 = 
	`vec_Àn
 (
Ê
->
buf„rs
)) == 0))

312 
n_buf„rs
 = 
	`˛ib_mö
 (
Àn
,Ç_buffers);

316 
§c
 = 
Ê
->
buf„rs
 + 
Àn
 - 
n_buf„rs
;

317 
	`˛ib_mem˝y
 (
buf„rs
, 
§c
, 
n_buf„rs
 *  (
u32
));

318 
	`_vec_Àn
 (
Ê
->
buf„rs
Ë-
n_buf„rs
;

321 
	`vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vm
, 
buf„rs
, 
n_buf„rs
,

322 
VLIB_BUFFER_KNOWN_FREE
);

324  
n_buf„rs
;

327 
§c
 = 
Ê
->
buf„rs
 + 
Àn
 - 
n_buf„rs
;

328 
	`˛ib_mem˝y
 (
buf„rs
, 
§c
, 
n_buf„rs
 *  (
u32
));

329 
	`_vec_Àn
 (
Ê
->
buf„rs
Ë-
n_buf„rs
;

332 
	`vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vm
, 
buf„rs
, 
n_buf„rs
,

333 
VLIB_BUFFER_KNOWN_FREE
);

335  
n_buf„rs
;

336 
	}
}

346 
Æways_ölöe
 
u32


347 
	$vlib_buf„r_Æloc
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
, u32 
n_buf„rs
)

349  
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, 
buf„rs
, 
n_buf„rs
,

350 
VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
);

351 
	}
}

363 
Æways_ölöe
 
u32


364 
	$vlib_buf„r_Æloc_to_rög
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
rög
, u32 
°¨t
,

365 
u32
 
rög_size
, u32 
n_buf„rs
)

367 
u32
 
n_Æloc
;

369 
	`ASSERT
 (
n_buf„rs
 <
rög_size
);

371 i‡(
	`PREDICT_TRUE
 (
°¨t
 + 
n_buf„rs
 <
rög_size
))

372  
	`vlib_buf„r_Æloc
 (
vm
, 
rög
 + 
°¨t
, 
n_buf„rs
);

374 
n_Æloc
 = 
	`vlib_buf„r_Æloc
 (
vm
, 
rög
 + 
°¨t
, 
rög_size
 - start);

376 i‡(
	`PREDICT_TRUE
 (
n_Æloc
 =
rög_size
 - 
°¨t
))

377 
n_Æloc
 +
	`vlib_buf„r_Æloc
 (
vm
, 
rög
, 
n_buf„rs
 -Ç_alloc);

379  
n_Æloc
;

380 
	}
}

390 
Æways_ölöe
 

391 
	$vlib_buf„r_‰ì
 (
vlib_maö_t
 * 
vm
,

393 
u32
 * 
buf„rs
,

395 
u32
 
n_buf„rs
)

397 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

399 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_‰ì_cb
);

401  
bm
->
cb
.
	`vlib_buf„r_‰ì_cb
 (
vm
, 
buf„rs
, 
n_buf„rs
);

402 
	}
}

411 
Æways_ölöe
 

412 
	$vlib_buf„r_‰ì_no_√xt
 (
vlib_maö_t
 * 
vm
,

414 
u32
 * 
buf„rs
,

416 
u32
 
n_buf„rs
)

418 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

420 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_‰ì_no_√xt_cb
);

422  
bm
->
cb
.
	`vlib_buf„r_‰ì_no_√xt_cb
 (
vm
, 
buf„rs
, 
n_buf„rs
);

423 
	}
}

431 
Æways_ölöe
 

432 
	$vlib_buf„r_‰ì_⁄e
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

434 
	`vlib_buf„r_‰ì
 (
vm
, &
buf„r_ödex
, 1);

435 
	}
}

445 
Æways_ölöe
 

446 
	$vlib_buf„r_‰ì_‰om_rög
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
rög
, u32 
°¨t
,

447 
u32
 
rög_size
, u32 
n_buf„rs
)

449 
	`ASSERT
 (
n_buf„rs
 <
rög_size
);

451 i‡(
	`PREDICT_TRUE
 (
°¨t
 + 
n_buf„rs
 <
rög_size
))

453 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
 + 
°¨t
, 
n_buf„rs
);

457 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
 + 
°¨t
, 
rög_size
 - start);

458 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
, 
n_buf„rs
 - (
rög_size
 - 
°¨t
));

460 
	}
}

464 
vlib_buf„r_‰ì_li°_ödex_t
 
vlib_buf„r_¸óã_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

465 
u32
 
n_d©a_byãs
,

466 *
fmt
, ...);

467 
Æways_ölöe
 

468 
	$vlib_buf„r_dñëe_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

469 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
)

471 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

473 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_dñëe_‰ì_li°_cb
);

475 
bm
->
cb
.
	`vlib_buf„r_dñëe_‰ì_li°_cb
 (
vm
, 
‰ì_li°_ödex
);

476 
	}
}

479 
vlib_buf„r_‰ì_li°_ödex_t
 
vlib_buf„r_gë_‹_¸óã_‰ì_li°
 (
vlib_maö_t


480 * 
vm
,

481 
u32


482 
n_d©a_byãs
,

483 *
fmt
,

487 
vlib_buf„r_mîge_‰ì_li°s
 (
vlib_buf„r_‰ì_li°_t
 * 
d°
,

488 
vlib_buf„r_‰ì_li°_t
 * 
§c
);

491 
vlib_buf„r_‰ì_li°_fûl_u«lig√d
 (
vlib_maö_t
 * 
vm
,

492 
vlib_buf„r_‰ì_li°_t
 *

493 
‰ì_li°
,

494 
uw‹d
 
n_u«lig√d_buf„rs
);

496 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_ödex_t


497 
	$vlib_buf„r_gë_‰ì_li°_wôh_size
 (
vlib_maö_t
 * 
vm
, 
u32
 
size
)

499 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

501 
size
 = 
	`vlib_buf„r_round_size
 (size);

502 
uw‹d
 *
p
 = 
	`hash_gë
 (
bm
->
‰ì_li°_by_size
, 
size
);

503  
p
 ?Ö[0] : ~0;

504 
	}
}

506 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_t
 *

507 
	$vlib_buf„r_gë_buf„r_‰ì_li°
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
,

508 
vlib_buf„r_‰ì_li°_ödex_t
 * 
ödex
)

510 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

511 
vlib_buf„r_‰ì_li°_ödex_t
 
i
;

513 *
ödex
 = 
i
 = 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
);

514  
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
i
);

515 
	}
}

517 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_t
 *

518 
	$vlib_buf„r_gë_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

519 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
)

521 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

522 
vlib_buf„r_‰ì_li°_t
 *
f
;

524 
f
 = 
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
‰ì_li°_ödex
);

527 
	`ASSERT
 (
f
->
ödex
 =
‰ì_li°_ödex
);

529  
f
;

530 
	}
}

532 
Æways_ölöe
 
u32


533 
	$vlib_buf„r_‰ì_li°_buf„r_size
 (
vlib_maö_t
 * 
vm
,

534 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

536 
vlib_buf„r_‰ì_li°_t
 *
f
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vm
, 
ödex
);

537  
f
->
n_d©a_byãs
;

538 
	}
}

540 
vlib_Æig√d_mem˝y
 (*
_d°
, *
_§c
, 
n_byãs
);

543 
Æways_ölöe
 

544 
	$vlib_c›y_buf„rs
 (
u32
 * 
d°
, u32 * 
§c
, u32 
n
)

546 
n
 >= 4)

548 
d°
[0] = 
§c
[0];

549 
d°
[1] = 
§c
[1];

550 
d°
[2] = 
§c
[2];

551 
d°
[3] = 
§c
[3];

552 
d°
 += 4;

553 
§c
 += 4;

554 
n
 -= 4;

556 
n
 > 0)

558 
d°
[0] = 
§c
[0];

559 
d°
 += 1;

560 
§c
 += 1;

561 
n
 -= 1;

563 
	}
}

566 
u32
 
vlib_buf„r_add_d©a
 (
vlib_maö_t
 * 
vm
,

567 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
,

568 
u32
 
buf„r_ödex
, *
d©a
, u32 
n_d©a_byãs
);

571 
Æways_ölöe
 
vlib_buf„r_t
 *

572 
	$vlib_buf„r_c›y
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

574 
vlib_buf„r_t
 *
s
, *
d
, *
fd
;

575 
uw‹d
 
n_Æloc
, 
n_buf„rs
 = 1;

576 
u32
 
Êag_mask
 = 
VLIB_BUFFER_NEXT_PRESENT
 | 
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

577 
i
;

579 
s
 = 
b
;

580 
s
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

582 
n_buf„rs
++;

583 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

585 
u32
 
√w_buf„rs
[
n_buf„rs
];

587 
n_Æloc
 = 
	`vlib_buf„r_Æloc
 (
vm
, 
√w_buf„rs
, 
n_buf„rs
);

590 i‡(
	`PREDICT_FALSE
 (
n_Æloc
 < 
n_buf„rs
))

592 i‡(
n_Æloc
 > 0)

593 
	`vlib_buf„r_‰ì
 (
vm
, 
√w_buf„rs
, 
n_Æloc
);

598 
s
 = 
b
;

599 
fd
 = 
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
√w_buf„rs
[0]);

600 
d
->
cuºít_d©a
 = 
s
->current_data;

601 
d
->
cuºít_Àngth
 = 
s
->current_length;

602 
d
->
Êags
 = 
s
->Êag†& 
Êag_mask
;

603 
d
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 =

604 
s
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

605 
	`˛ib_mem˝y
 (
d
->
›aque
, 
s
->opaque,  (s->opaque));

606 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
),

607 
	`vlib_buf„r_gë_cuºít
 (
s
), s->
cuºít_Àngth
);

610 
i
 = 1; i < 
n_buf„rs
; i++)

613 
d
->
√xt_buf„r
 = 
√w_buf„rs
[
i
];

615 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

616 
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
√w_buf„rs
[
i
]);

617 
d
->
cuºít_d©a
 = 
s
->current_data;

618 
d
->
cuºít_Àngth
 = 
s
->current_length;

619 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
),

620 
	`vlib_buf„r_gë_cuºít
 (
s
), s->
cuºít_Àngth
);

621 
d
->
Êags
 = 
s
->Êag†& 
Êag_mask
;

624  
fd
;

625 
	}
}

639 
Æways_ölöe
 
u16


640 
	$vlib_buf„r_˛⁄e_256
 (
vlib_maö_t
 * 
vm
, 
u32
 
§c_buf„r
, u32 * 
buf„rs
,

641 
u16
 
n_buf„rs
, u16 
hód_íd_off£t
)

643 
u16
 
i
;

644 
vlib_buf„r_t
 *
s
 = 
	`vlib_gë_buf„r
 (
vm
, 
§c_buf„r
);

646 
	`ASSERT
 (
s
->
n_add_ªfs
 == 0);

647 
	`ASSERT
 (
n_buf„rs
);

648 
	`ASSERT
 (
n_buf„rs
 <= 256);

650 i‡(
s
->
cuºít_Àngth
 <
hód_íd_off£t
 + 
CLIB_CACHE_LINE_BYTES
 * 2)

652 
buf„rs
[0] = 
§c_buf„r
;

653 
i
 = 1; i < 
n_buf„rs
; i++)

655 
vlib_buf„r_t
 *
d
;

656 
d
 = 
	`vlib_buf„r_c›y
 (
vm
, 
s
);

657 i‡(
d
 == 0)

658  
i
;

659 
buf„rs
[
i
] = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
d
);

662  
n_buf„rs
;

665 i‡(
	`PREDICT_FALSE
 (
n_buf„rs
 == 1))

667 
buf„rs
[0] = 
§c_buf„r
;

671 
n_buf„rs
 = 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, 
buf„rs
,Ç_buffers,

672 
vlib_buf„r_gë_‰ì_li°_ödex


673 (
s
));

675 
i
 = 0; i < 
n_buf„rs
; i++)

677 
vlib_buf„r_t
 *
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
]);

678 
d
->
cuºít_d©a
 = 
s
->current_data;

679 
d
->
cuºít_Àngth
 = 
hód_íd_off£t
;

680 
	`vlib_buf„r_£t_‰ì_li°_ödex
 (
d
,

681 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
s
));

682 
d
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 =

683 
s
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 + s->
cuºít_Àngth
 -

684 
hód_íd_off£t
;

685 
d
->
Êags
 = 
s
->Êag†| 
VLIB_BUFFER_NEXT_PRESENT
;

686 
d
->
Êags
 &~
VLIB_BUFFER_EXT_HDR_VALID
;

687 
	`˛ib_mem˝y
 (
d
->
›aque
, 
s
->opaque,  (s->opaque));

688 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
), vlib_buf„r_gë_cuºíà(
s
),

689 
hód_íd_off£t
);

690 
d
->
√xt_buf„r
 = 
§c_buf„r
;

692 
	`vlib_buf„r_adv™˚
 (
s
, 
hód_íd_off£t
);

693 
s
->
n_add_ªfs
 = 
n_buf„rs
 - 1;

694 
s
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

696 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

697 
s
->
n_add_ªfs
 = 
n_buf„rs
 - 1;

700  
n_buf„rs
;

701 
	}
}

715 
Æways_ölöe
 
u16


716 
	$vlib_buf„r_˛⁄e
 (
vlib_maö_t
 * 
vm
, 
u32
 
§c_buf„r
, u32 * 
buf„rs
,

717 
u16
 
n_buf„rs
, u16 
hód_íd_off£t
)

719 
vlib_buf„r_t
 *
s
 = 
	`vlib_gë_buf„r
 (
vm
, 
§c_buf„r
);

720 
u16
 
n_˛⁄ed
 = 0;

722 
n_buf„rs
 > 256)

724 
vlib_buf„r_t
 *
c›y
;

725 
c›y
 = 
	`vlib_buf„r_c›y
 (
vm
, 
s
);

726 
n_˛⁄ed
 +
	`vlib_buf„r_˛⁄e_256
 (
vm
,

727 
	`vlib_gë_buf„r_ödex
 (
vm
, 
c›y
),

728 (
buf„rs
 + 
n_˛⁄ed
),

729 256, 
hód_íd_off£t
);

730 
n_buf„rs
 -= 256;

732 
n_˛⁄ed
 +
	`vlib_buf„r_˛⁄e_256
 (
vm
, 
§c_buf„r
,

733 
buf„rs
 + 
n_˛⁄ed
,

734 
n_buf„rs
, 
hód_íd_off£t
);

736  
n_˛⁄ed
;

737 
	}
}

746 
Æways_ölöe
 

747 
	$vlib_buf„r_©èch_˛⁄e
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
hód
,

748 
vlib_buf„r_t
 * 
èû
)

750 
	`ASSERT
 ((
hód
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
) == 0);

751 
	`ASSERT
 (
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
hód
) ==

752 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
èû
));

754 
hód
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

755 
hód
->
Êags
 &~
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

756 
hód
->
Êags
 &~
VLIB_BUFFER_EXT_HDR_VALID
;

757 
hód
->
Êags
 |(
èû
->Êag†& 
VLIB_BUFFER_TOTAL_LENGTH_VALID
);

758 
hód
->
√xt_buf„r
 = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
èû
);

759 
hód
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 = 
èû
->
cuºít_Àngth
 +

760 
èû
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

762 
√xt_£gmít
:

763 
	`__sync_add_™d_„tch
 (&
èû
->
n_add_ªfs
, 1);

765 i‡(
èû
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

767 
èû
 = 
	`vlib_gë_buf„r
 (
vm
,Åaû->
√xt_buf„r
);

768 
√xt_£gmít
;

770 
	}
}

773 
Æways_ölöe
 

774 
	$vlib_buf„r_chaö_öô
 (
vlib_buf„r_t
 * 
fú°
)

776 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 = 0;

777 
fú°
->
cuºít_Àngth
 = 0;

778 
fú°
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

779 
fú°
->
Êags
 |
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

780 
	}
}

783 
Æways_ölöe
 
vlib_buf„r_t
 *

784 
	$vlib_buf„r_chaö_buf„r
 (
vlib_maö_t
 * 
vm
,

785 
vlib_buf„r_t
 * 
fú°
,

786 
vlib_buf„r_t
 * 
œ°
, 
u32
 
√xt_bi
)

788 
vlib_buf„r_t
 *
√xt_buf„r
 = 
	`vlib_gë_buf„r
 (
vm
, 
√xt_bi
);

789 
œ°
->
√xt_buf„r
 = 
√xt_bi
;

790 
œ°
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

791 
√xt_buf„r
->
cuºít_Àngth
 = 0;

792 
√xt_buf„r
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

793  
√xt_buf„r
;

794 
	}
}

800 
Æways_ölöe
 

801 
	$vlib_buf„r_chaö_ö¸ó£_Àngth
 (
vlib_buf„r_t
 * 
fú°
,

802 
vlib_buf„r_t
 * 
œ°
, 
i32
 
Àn
)

804 
œ°
->
cuºít_Àngth
 +
Àn
;

805 i‡(
fú°
 !
œ°
)

806 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 +
Àn
;

807 
	}
}

812 
Æways_ölöe
 
u16


813 
	$vlib_buf„r_chaö_≠≥nd_d©a
 (
vlib_maö_t
 * 
vm
,

814 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
,

815 
vlib_buf„r_t
 * 
fú°
,

816 
vlib_buf„r_t
 * 
œ°
, *
d©a
, 
u16
 
d©a_Àn
)

818 
u32
 
n_buf„r_byãs
 =

819 
	`vlib_buf„r_‰ì_li°_buf„r_size
 (
vm
, 
‰ì_li°_ödex
);

820 
	`ASSERT
 (
n_buf„r_byãs
 >
œ°
->
cuºít_Àngth
 +Üa°->
cuºít_d©a
);

821 
u16
 
Àn
 = 
	`˛ib_mö
 (
d©a_Àn
,

822 
n_buf„r_byãs
 - 
œ°
->
cuºít_Àngth
 -

823 
œ°
->
cuºít_d©a
);

824 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
œ°
Ë+Üa°->
cuºít_Àngth
, 
d©a
,

825 
Àn
);

826 
	`vlib_buf„r_chaö_ö¸ó£_Àngth
 (
fú°
, 
œ°
, 
Àn
);

827  
Àn
;

828 
	}
}

835 
u16


836 
vlib_buf„r_chaö_≠≥nd_d©a_wôh_Æloc
 (
vlib_maö_t
 * 
vm
,

837 
vlib_buf„r_‰ì_li°_ödex_t


838 
‰ì_li°_ödex
,

839 
vlib_buf„r_t
 * 
fú°
,

840 
vlib_buf„r_t
 ** 
œ°
, *
d©a
,

841 
u16
 
d©a_Àn
);

842 
vlib_buf„r_chaö_vÆid©e
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
fú°
);

844 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_buf„r
, 
	gf‹m©_vlib_buf„r_™d_d©a
,

845 
	gf‹m©_vlib_buf„r_c⁄ã¡s
;

850 
u8
 *
	m∑ckë_d©a
;

854 
u32
 
	mmö_n_buf„rs_óch_physmem_Æloc
;

857 
vlib_buf„r_‰ì_li°_ödex_t
 
	m‰ì_li°_ödex
;

859 
u32
 *
	m‰ì_buf„rs
;

860 } 
	tvlib_∑ckë_ãm∂©e_t
;

862 
vlib_∑ckë_ãm∂©e_gë_∑ckë_hñ≥r
 (
vlib_maö_t
 * 
vm
,

863 
vlib_∑ckë_ãm∂©e_t
 * 
t
);

865 
vlib_∑ckë_ãm∂©e_öô
 (
vlib_maö_t
 * 
vm
,

866 
vlib_∑ckë_ãm∂©e_t
 * 
t
,

867 *
∑ckë_d©a
,

868 
uw‹d
 
n_∑ckë_d©a_byãs
,

869 
uw‹d
 
mö_n_buf„rs_óch_physmem_Æloc
,

870 *
fmt
, ...);

872 *
vlib_∑ckë_ãm∂©e_gë_∑ckë
 (
vlib_maö_t
 * 
vm
,

873 
vlib_∑ckë_ãm∂©e_t
 * 
t
,

874 
u32
 * 
bi_ªsu…
);

876 
Æways_ölöe
 

877 
	$vlib_∑ckë_ãm∂©e_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_∑ckë_ãm∂©e_t
 * 
t
)

879 
	`vec_‰ì
 (
t
->
∑ckë_d©a
);

880 
	}
}

882 
Æways_ölöe
 
u32


883 
	$un£rülize_vlib_buf„r_n_byãs
 (
£rülize_maö_t
 * 
m
)

885 
£rülize_°ªam_t
 *
s
 = &
m
->
°ªam
;

886 
vlib_£rülize_buf„r_maö_t
 *
sm


887 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

888 
vlib_£rülize_buf„r_maö_t
 *);

889 
vlib_maö_t
 *
vm
 = 
sm
->
vlib_maö
;

890 
u32
 
n
, *
f
;

892 
n
 = 
s
->
n_buf„r_byãs
 - s->
cuºít_buf„r_ödex
;

893 i‡(
sm
->
œ°_buf„r
 != ~0)

895 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

896 
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

898 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

899 
n
 +
b
->
cuºít_Àngth
;

904 
	`˛ib_fifo_f‹óch
 (
f
, 
sm
->
rx
.
buf„r_fifo
, ({

905 
n
 +
	`vlib_buf„r_ödex_Àngth_ö_chaö
 (
vm
, 
f
[0]);

909  
n
;

910 
	}
}

915 
Æways_ölöe
 

916 
	$vlib_buf„r_öô_f‹_‰ì_li°
 (
vlib_buf„r_t
 * 
d°
,

917 
vlib_buf„r_‰ì_li°_t
 * 
Ê
)

919 
vlib_buf„r_t
 *
§c
 = &
Ê
->
buf„r_öô_ãm∂©e
;

922 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe0
) == 0);

923 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe1
) ==

924 
CLIB_CACHE_LINE_BYTES
);

925 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe2
) ==

926 
CLIB_CACHE_LINE_BYTES
 * 2);

929 
	`ASSERT
 (
Ê
->
ödex
 =
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
§c
));

931 
	`˛ib_mem˝y
 (
	`STRUCT_MARK_PTR
 (
d°
, 
ãm∂©e_°¨t
),

932 
	`STRUCT_MARK_PTR
 (
§c
, 
ãm∂©e_°¨t
),

933 
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ãm∂©e_íd
) -

934 
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ãm∂©e_°¨t
));

937 
d°
->
n_add_ªfs
 = 
§c
->n_add_refs;

938 
	`vlib_buf„r_£t_‰ì_li°_ödex
 (
d°
, 
Ê
->
ödex
);

941 
	#_
(
f
Ë
	`ASSERT
 (
d°
->‡=
§c
->f);

	)

942 
	`_
(
cuºít_d©a
);

943 
	`_
(
cuºít_Àngth
);

944 
	`_
(
Êags
);

945 #unde‡
_


952 
	`ASSERT
 (
d°
->
n_add_ªfs
 == 0);

953 
	}
}

955 
Æways_ölöe
 

956 
	$vlib_buf„r_add_to_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

957 
vlib_buf„r_‰ì_li°_t
 * 
f
,

958 
u32
 
buf„r_ödex
, 
u8
 
do_öô
)

960 
vlib_buf„r_t
 *
b
;

961 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

962 i‡(
	`PREDICT_TRUE
 (
do_öô
))

963 
	`vlib_buf„r_öô_f‹_‰ì_li°
 (
b
, 
f
);

964 
	`vec_add1_Æig√d
 (
f
->
buf„rs
, 
buf„r_ödex
, 
CLIB_CACHE_LINE_BYTES
);

966 i‡(
	`vec_Àn
 (
f
->
buf„rs
Ë> 4 * 
VLIB_FRAME_SIZE
)

968 
vlib_buf„r_‰ì_li°_t
 *
mf
;

969 
mf
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vlib_maös
[0], 
f
->
ödex
);

970 
	`˛ib_•ölock_lock
 (&
mf
->
globÆ_buf„rs_lock
);

972 
	`vec_add_Æig√d
 (
mf
->
globÆ_buf„rs
, 
f
->
buf„rs
, 
VLIB_FRAME_SIZE
,

973 
CLIB_CACHE_LINE_BYTES
);

974 
	`vec_dñëe
 (
f
->
buf„rs
, 
VLIB_FRAME_SIZE
, 0);

975 
f
->
n_Æloc
 -
VLIB_FRAME_SIZE
;

976 
	`˛ib_•ölock_u∆ock
 (&
mf
->
globÆ_buf„rs_lock
);

978 
	}
}

980 #i‡
CLIB_DEBUG
 > 0

981 
u32
 *
vlib_buf„r_°©e_vÆid©i⁄_lock
;

982 
uw‹d
 *
vlib_buf„r_°©e_vÆid©i⁄_hash
;

983 *
vlib_buf„r_°©e_hóp
;

986 
ölöe
 

987 
	$vlib_vÆid©e_buf„r_ö_u£
 (
vlib_buf„r_t
 * 
b
, 
u32
 
ex≥˘ed
)

989 #i‡
CLIB_DEBUG
 > 0

990 
uw‹d
 *
p
;

991 *
ﬁdhóp
;

993 
ﬁdhóp
 = 
	`˛ib_mem_£t_hóp
 (
vlib_buf„r_°©e_hóp
);

995 
	`__sync_lock_ã°_™d_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_lock
, 1))

998 
p
 = 
	`hash_gë
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
);

1001 i‡(!
p
)

1003 
	`hash_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
, 
ex≥˘ed
);

1004 
out
;

1007 i‡(
p
[0] !
ex≥˘ed
)

1009 
	`cj_°›
 ();

1010 
u32
 
bi
;

1011 
vlib_maö_t
 *
vm
 = &
vlib_globÆ_maö
;

1013 
	`cj_°›
 ();

1015 
bi
 = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
b
);

1017 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1018 
	`˛ib_w¨nög
 ("%.6f buffer %llx (%d): %s,Çot %s",

1019 
	`vlib_time_now
 (
vm
), 
bi
,

1020 
p
[0] ? "busy" : "‰ì", 
ex≥˘ed
 ? "busy" : "free");

1021 
	`os_∑nic
 ();

1023 
out
:

1024 
	`CLIB_MEMORY_BARRIER
 ();

1025 *
vlib_buf„r_°©e_vÆid©i⁄_lock
 = 0;

1026 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1028 
	}
}

1030 
ölöe
 

1031 
	$vlib_vÆid©e_buf„r_£t_ö_u£
 (
vlib_buf„r_t
 * 
b
, 
u32
 
ex≥˘ed
)

1033 #i‡
CLIB_DEBUG
 > 0

1034 *
ﬁdhóp
;

1036 
ﬁdhóp
 = 
	`˛ib_mem_£t_hóp
 (
vlib_buf„r_°©e_hóp
);

1038 
	`__sync_lock_ã°_™d_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_lock
, 1))

1041 
	`hash_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
, 
ex≥˘ed
);

1043 
	`CLIB_MEMORY_BARRIER
 ();

1044 *
vlib_buf„r_°©e_vÆid©i⁄_lock
 = 0;

1045 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1047 
	}
}

1050 
	#VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
 (256)

	)

1061 
Æways_ölöe
 

1062 
	$vlib_buf„r_chaö_com¥ess
 (
vlib_maö_t
 * 
vm
,

1063 
vlib_buf„r_t
 * 
fú°
, 
u32
 ** 
disˇrd_ve˘‹
)

1065 i‡(
fú°
->
cuºít_Àngth
 >
VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
 ||

1066 !(
fú°
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

1072 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
;

1073 
vlib_buf„r_‰ì_li°_t
 *
‰ì_li°
 =

1074 
	`vlib_buf„r_gë_buf„r_‰ì_li°
 (
vm
, 
fú°
, &
ödex
);

1076 
u32
 
w™t_fú°_size
 = 
	`˛ib_mö
 (
VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
,

1077 
‰ì_li°
->
n_d©a_byãs
 -

1078 
fú°
->
cuºít_d©a
);

1081 
vlib_buf„r_t
 *
£c⁄d
 = 
	`vlib_gë_buf„r
 (
vm
, 
fú°
->
√xt_buf„r
);

1082 
u32
 
√ed
 = 
w™t_fú°_size
 - 
fú°
->
cuºít_Àngth
;

1083 
u32
 
amou¡_to_c›y
 = 
	`˛ib_mö
 (
√ed
, 
£c⁄d
->
cuºít_Àngth
);

1084 
	`˛ib_mem˝y
 (((
u8
 *Ë
	`vlib_buf„r_gë_cuºít
 (
fú°
)) +

1085 
fú°
->
cuºít_Àngth
,

1086 
	`vlib_buf„r_gë_cuºít
 (
£c⁄d
), 
amou¡_to_c›y
);

1087 
fú°
->
cuºít_Àngth
 +
amou¡_to_c›y
;

1088 
	`vlib_buf„r_adv™˚
 (
£c⁄d
, 
amou¡_to_c›y
);

1089 i‡(
fú°
->
Êags
 & 
VLIB_BUFFER_TOTAL_LENGTH_VALID
)

1091 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 -
amou¡_to_c›y
;

1093 i‡(!
£c⁄d
->
cuºít_Àngth
)

1095 
	`vec_add1
 (*
disˇrd_ve˘‹
, 
fú°
->
√xt_buf„r
);

1096 i‡(
£c⁄d
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

1098 
fú°
->
√xt_buf„r
 = 
£c⁄d
->next_buffer;

1102 
fú°
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

1104 
£c⁄d
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

1107 (
fú°
->
cuºít_Àngth
 < 
w™t_fú°_size
) &&

1108 (
fú°
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
));

1109 
	}
}

	@buffer_node.h

40 #i‚de‡
ö˛uded_vlib_buf„r_node_h


41 
	#ö˛uded_vlib_buf„r_node_h


	)

70 
	#vlib_vÆid©e_buf„r_íqueue_x2
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
bi1
,
√xt0
,
√xt1
) \

72 
íqueue_code
 = (
√xt0
 !
√xt_ödex
Ë+ 2*(
√xt1
 !=Çext_index); \

74 i‡(
	`PREDICT_FALSE
 (
íqueue_code
 != 0)) \

76 
íqueue_code
) \

80 
to_√xt
[-2] = 
bi1
; \

81 
to_√xt
 -= 1; \

82 
n_À·_to_√xt
 += 1; \

83 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

88 
to_√xt
 -= 1; \

89 
n_À·_to_√xt
 += 1; \

90 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

95 
to_√xt
 -= 2; \

96 
n_À·_to_√xt
 += 2; \

97 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

98 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

99 i‡(
√xt0
 =
√xt1
) \

101 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, \

102 
n_À·_to_√xt
); \

103 
√xt_ödex
 = 
√xt1
; \

104 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

108 } 0)

	)

138 
	#vlib_vÆid©e_buf„r_íqueue_x4
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
bi1
,
bi2
,
bi3
,
√xt0
,
√xt1
,
√xt2
,
√xt3
) \

141 
u32
 
fix_•ecuœti⁄
 = (
√xt_ödex
 ^ 
√xt0
Ë| (√xt_ödex ^ 
√xt1
) \

142 | (
√xt_ödex
 ^ 
√xt2
Ë| (√xt_ödex ^ 
√xt3
); \

143 i‡(
	`PREDICT_FALSE
(
fix_•ecuœti⁄
)) \

146 
to_√xt
 -= 4; \

147 
n_À·_to_√xt
 += 4; \

150 i‡(
√xt_ödex
 =
√xt0
) \

152 
to_√xt
[0] = 
bi0
; \

153 
to_√xt
++; \

154 
n_À·_to_√xt
 --; \

157 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

159 i‡(
√xt_ödex
 =
√xt1
) \

161 
to_√xt
[0] = 
bi1
; \

162 
to_√xt
++; \

163 
n_À·_to_√xt
 --; \

166 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

168 i‡(
√xt_ödex
 =
√xt2
) \

170 
to_√xt
[0] = 
bi2
; \

171 
to_√xt
++; \

172 
n_À·_to_√xt
 --; \

175 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt2
, 
bi2
); \

177 i‡(
√xt_ödex
 =
√xt3
) \

179 
to_√xt
[0] = 
bi3
; \

180 
to_√xt
++; \

181 
n_À·_to_√xt
 --; \

185 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt3
, 
bi3
); \

188 i‡(
√xt2
 =
√xt3
) \

190 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
); \

191 
√xt_ödex
 = 
√xt3
; \

192 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

196 } 0);

	)

218 
	#vlib_vÆid©e_buf„r_íqueue_x1
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
√xt0
) \

220 i‡(
	`PREDICT_FALSE
 (
√xt0
 !
√xt_ödex
)) \

222 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
 + 1); \

223 
√xt_ödex
 = 
√xt0
; \

224 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

226 
to_√xt
[0] = 
bi0
; \

227 
to_√xt
 += 1; \

228 
n_À·_to_√xt
 -= 1; \

230 } 0)

	)

232 
Æways_ölöe
 
uw‹d


233 
	$gíîic_buf„r_node_ölöe
 (
vlib_maö_t
 * 
vm
,

234 
vlib_node_ru¡ime_t
 * 
node
,

235 
vlib_‰ame_t
 * 
‰ame
,

236 
uw‹d
 
sizeof_åa˚
,

237 *
›aque1
,

238 
uw‹d
 
›aque2
,

239 (*
two_buf„rs
Ë(
vlib_maö_t
 * 
vm
,

240 *
›aque1
,

241 
uw‹d
 
›aque2
,

242 
vlib_buf„r_t
 * 
b0
,

243 
vlib_buf„r_t
 * 
b1
,

244 
u32
 * 
√xt0
, u32 * 
√xt1
),

245 (*
⁄e_buf„r
Ë(
vlib_maö_t
 * 
vm
,

246 *
›aque1
, 
uw‹d
 
›aque2
,

247 
vlib_buf„r_t
 * 
b0
,

248 
u32
 * 
√xt0
))

250 
u32
 
n_À·_‰om
, *
‰om
, *
to_√xt
;

251 
u32
 
√xt_ödex
;

253 
‰om
 = 
	`vlib_‰ame_ve˘‹_¨gs
 (
‰ame
);

254 
n_À·_‰om
 = 
‰ame
->
n_ve˘‹s
;

255 
√xt_ödex
 = 
node
->
ˇched_√xt_ödex
;

257 i‡(
node
->
Êags
 & 
VLIB_NODE_FLAG_TRACE
)

258 
	`vlib_åa˚_‰ame_buf„rs_⁄ly
 (
vm
, 
node
, 
‰om
, 
‰ame
->
n_ve˘‹s
,

259  1, 
sizeof_åa˚
);

261 
n_À·_‰om
 > 0)

263 
u32
 
n_À·_to_√xt
;

265 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
);

267 
n_À·_‰om
 >4 && 
n_À·_to_√xt
 >= 2)

269 
vlib_buf„r_t
 *
p0
, *
p1
;

270 
u32
 
pi0
, 
√xt0
;

271 
u32
 
pi1
, 
√xt1
;

275 
vlib_buf„r_t
 *
p2
, *
p3
;

277 
p2
 = 
	`vlib_gë_buf„r
 (
vm
, 
‰om
[2]);

278 
p3
 = 
	`vlib_gë_buf„r
 (
vm
, 
‰om
[3]);

280 
	`vlib_¥e„tch_buf„r_hódî
 (
p2
, 
LOAD
);

281 
	`vlib_¥e„tch_buf„r_hódî
 (
p3
, 
LOAD
);

283 
	`CLIB_PREFETCH
 (
p2
->
d©a
, 64, 
LOAD
);

284 
	`CLIB_PREFETCH
 (
p3
->
d©a
, 64, 
LOAD
);

287 
pi0
 = 
to_√xt
[0] = 
‰om
[0];

288 
pi1
 = 
to_√xt
[1] = 
‰om
[1];

289 
‰om
 += 2;

290 
to_√xt
 += 2;

291 
n_À·_‰om
 -= 2;

292 
n_À·_to_√xt
 -= 2;

294 
p0
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi0
);

295 
p1
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi1
);

297 
	`two_buf„rs
 (
vm
, 
›aque1
, 
›aque2
, 
p0
, 
p1
, &
√xt0
, &
√xt1
);

299 
	`vlib_vÆid©e_buf„r_íqueue_x2
 (
vm
, 
node
, 
√xt_ödex
,

300 
to_√xt
, 
n_À·_to_√xt
,

301 
pi0
, 
pi1
, 
√xt0
, 
√xt1
);

304 
n_À·_‰om
 > 0 && 
n_À·_to_√xt
 > 0)

306 
vlib_buf„r_t
 *
p0
;

307 
u32
 
pi0
, 
√xt0
;

309 
pi0
 = 
‰om
[0];

310 
to_√xt
[0] = 
pi0
;

311 
‰om
 += 1;

312 
to_√xt
 += 1;

313 
n_À·_‰om
 -= 1;

314 
n_À·_to_√xt
 -= 1;

316 
p0
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi0
);

318 
	`⁄e_buf„r
 (
vm
, 
›aque1
, 
›aque2
, 
p0
, &
√xt0
);

320 
	`vlib_vÆid©e_buf„r_íqueue_x1
 (
vm
, 
node
, 
√xt_ödex
,

321 
to_√xt
, 
n_À·_to_√xt
,

322 
pi0
, 
√xt0
);

325 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
);

328  
‰ame
->
n_ve˘‹s
;

329 
	}
}

	@buffer_serialize.c

40 
	~<vlib/vlib.h
>

43 
	$vlib_£rülize_tx
 (
£rülize_maö_hódî_t
 * 
m
, 
£rülize_°ªam_t
 * 
s
)

45 
vlib_maö_t
 *
vm
;

46 
vlib_£rülize_buf„r_maö_t
 *
sm
;

47 
uw‹d
 
n
, 
n_byãs_to_wrôe
;

48 
vlib_buf„r_t
 *
œ°
;

50 
n_byãs_to_wrôe
 = 
s
->
cuºít_buf„r_ödex
;

51 
sm
 =

52 
	`uw‹d_to_poöãr
 (
s
->
d©a_fun˘i⁄_›aque
,

53 
vlib_£rülize_buf„r_maö_t
 *);

54 
vm
 = 
sm
->
vlib_maö
;

56 
	`ASSERT
 (
sm
->
tx
.
max_n_d©a_byãs_≥r_chaö
 > 0);

57 i‡(
	`£rülize_°ªam_is_íd_of_°ªam
 (
s
)

58 || 
sm
->
tx
.
n_tŸÆ_d©a_byãs
 + 
n_byãs_to_wrôe
 >

59 
sm
->
tx
.
max_n_d©a_byãs_≥r_chaö
)

61 
vlib_¥o˚ss_t
 *
p
 = 
	`vlib_gë_cuºít_¥o˚ss
 (
vm
);

63 
œ°
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

64 
œ°
->
cuºít_Àngth
 = 
n_byãs_to_wrôe
;

66 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, &
p
->
node_ru¡ime
, 
sm
->
tx
.
√xt_ödex
,

67 
sm
->
fú°_buf„r
);

69 
sm
->
fú°_buf„r
 = sm->
œ°_buf„r
 = ~0;

70 
sm
->
tx
.
n_tŸÆ_d©a_byãs
 = 0;

73 i‡(
n_byãs_to_wrôe
 =0 && 
s
->
n_buf„r_byãs
 == 0)

75 
	`ASSERT
 (
sm
->
fú°_buf„r
 == ~0);

76 
	`ASSERT
 (
sm
->
œ°_buf„r
 == ~0);

77 
n
 =

78 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, &
sm
->
fú°_buf„r
, 1,

79 
sm
->
tx
.
‰ì_li°_ödex
);

80 i‡(
n
 != 1)

81 
	`£rülize_îr‹
 (
m
,

82 
˛ib_îr‹_¸óã


84 
sm
->
œ°_buf„r
 = sm->
fú°_buf„r
;

85 
s
->
n_buf„r_byãs
 =

86 
	`vlib_buf„r_‰ì_li°_buf„r_size
 (
vm
, 
sm
->
tx
.
‰ì_li°_ödex
);

89 i‡(
n_byãs_to_wrôe
 > 0)

91 
vlib_buf„r_t
 *
¥ev
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

92 
n
 =

93 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, &
sm
->
œ°_buf„r
, 1,

94 
sm
->
tx
.
‰ì_li°_ödex
);

95 i‡(
n
 != 1)

96 
	`£rülize_îr‹
 (
m
,

97 
˛ib_îr‹_¸óã


99 
sm
->
tx
.
n_tŸÆ_d©a_byãs
 +
n_byãs_to_wrôe
;

100 
¥ev
->
cuºít_Àngth
 = 
n_byãs_to_wrôe
;

101 
¥ev
->
√xt_buf„r
 = 
sm
->
œ°_buf„r
;

102 
¥ev
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

105 i‡(
sm
->
œ°_buf„r
 != ~0)

107 
œ°
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

108 
s
->
buf„r
 = 
	`vlib_buf„r_gë_cuºít
 (
œ°
);

109 
s
->
cuºít_buf„r_ödex
 = 0;

110 
	`ASSERT
 (
œ°
->
cuºít_d©a
 =
s
->
cuºít_buf„r_ödex
);

112 
	}
}

115 
	$vlib_£rülize_rx
 (
£rülize_maö_hódî_t
 * 
m
, 
£rülize_°ªam_t
 * 
s
)

117 
vlib_maö_t
 *
vm
;

118 
vlib_£rülize_buf„r_maö_t
 *
sm
;

119 
vlib_buf„r_t
 *
œ°
;

121 
sm
 =

122 
	`uw‹d_to_poöãr
 (
s
->
d©a_fun˘i⁄_›aque
,

123 
vlib_£rülize_buf„r_maö_t
 *);

124 
vm
 = 
sm
->
vlib_maö
;

126 i‡(
	`£rülize_°ªam_is_íd_of_°ªam
 (
s
))

129 i‡(
sm
->
œ°_buf„r
 != ~0)

131 
œ°
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

133 i‡(
œ°
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

134 
sm
->
œ°_buf„r
 = 
œ°
->
√xt_buf„r
;

137 
	`vlib_buf„r_‰ì
 (
vm
, &
sm
->
fú°_buf„r
, 1);

138 
sm
->
fú°_buf„r
 = sm->
œ°_buf„r
 = ~0;

142 i‡(
sm
->
œ°_buf„r
 == ~0)

144 
	`˛ib_fifo_ñts
 (
sm
->
rx
.
buf„r_fifo
) == 0)

146 
sm
->
rx
.
ªady_⁄e_time_evít
 =

147 
	`vlib_¥o˚ss_¸óã_⁄e_time_evít
 (
vm
, 
	`vlib_cuºít_¥o˚ss
 (vm),

149 
	`vlib_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
, 0,

150 
sm
->
rx
.
ªady_⁄e_time_evít
);

153 
	`˛ib_fifo_sub1
 (
sm
->
rx
.
buf„r_fifo
, sm->
fú°_buf„r
);

154 
sm
->
œ°_buf„r
 = sm->
fú°_buf„r
;

157 
	`ASSERT
 (
sm
->
œ°_buf„r
 != ~0);

159 
œ°
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

160 
s
->
cuºít_buf„r_ödex
 = 0;

161 
s
->
buf„r
 = 
	`vlib_buf„r_gë_cuºít
 (
œ°
);

162 
s
->
n_buf„r_byãs
 = 
œ°
->
cuºít_Àngth
;

163 
	}
}

166 
	$£rülize_›í_vlib_hñ≥r
 (
£rülize_maö_t
 * 
m
,

167 
vlib_maö_t
 * 
vm
,

168 
vlib_£rülize_buf„r_maö_t
 * 
sm
, 
uw‹d
 
is_ªad
)

172 
u8
 *
ßve
 = 
m
->
°ªam
.
ovîÊow_buf„r
;

173 
	`mem£t
 (
m
, 0,  (m[0]));

174 
m
->
°ªam
.
ovîÊow_buf„r
 = 
ßve
;

175 i‡(
ßve
)

176 
	`_vec_Àn
 (
ßve
) = 0;

179 
sm
->
fú°_buf„r
 = sm->
œ°_buf„r
 = ~0;

180 i‡(
is_ªad
)

181 
	`˛ib_fifo_ª£t
 (
sm
->
rx
.
buf„r_fifo
);

183 
sm
->
tx
.
n_tŸÆ_d©a_byãs
 = 0;

184 
sm
->
vlib_maö
 = 
vm
;

185 
m
->
hódî
.
d©a_fun˘i⁄
 = 
is_ªad
 ? 
vlib_£rülize_rx
 : 
vlib_£rülize_tx
;

186 
m
->
°ªam
.
d©a_fun˘i⁄_›aque
 = 
	`poöãr_to_uw‹d
 (
sm
);

187 
	}
}

190 
	$£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
, 
vlib_maö_t
 * 
vm
,

191 
vlib_£rülize_buf„r_maö_t
 * 
sm
)

193 
	`£rülize_›í_vlib_hñ≥r
 (
m
, 
vm
, 
sm
, 0);

194 
	}
}

197 
	$un£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
, 
vlib_maö_t
 * 
vm
,

198 
vlib_£rülize_buf„r_maö_t
 * 
sm
)

200 
	`£rülize_›í_vlib_hñ≥r
 (
m
, 
vm
, 
sm
, 1);

201 
	}
}

203 
u32


204 
	$£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
)

206 
vlib_£rülize_buf„r_maö_t
 *
sm


207 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

208 
vlib_£rülize_buf„r_maö_t
 *);

209 
vlib_buf„r_t
 *
œ°
;

210 
£rülize_°ªam_t
 *
s
 = &
m
->
°ªam
;

212 
œ°
 = 
	`vlib_gë_buf„r
 (
sm
->
vlib_maö
, sm->
œ°_buf„r
);

213 
œ°
->
cuºít_Àngth
 = 
s
->
cuºít_buf„r_ödex
;

215 i‡(
	`vec_Àn
 (
s
->
ovîÊow_buf„r
) > 0)

217 
sm
->
œ°_buf„r


218 
	`vlib_buf„r_add_d©a
 (
sm
->
vlib_maö
, sm->
tx
.
‰ì_li°_ödex
,

219 
sm
->
œ°_buf„r
 == ~0 ? 0 : sm->last_buffer,

220 
s
->
ovîÊow_buf„r
,

221 
	`vec_Àn
 (
s
->
ovîÊow_buf„r
));

222 
	`_vec_Àn
 (
s
->
ovîÊow_buf„r
) = 0;

225  
sm
->
fú°_buf„r
;

226 
	}
}

229 
	$un£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
)

231 
vlib_£rülize_buf„r_maö_t
 *
sm


232 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

233 
vlib_£rülize_buf„r_maö_t
 *);

234 i‡(
sm
->
fú°_buf„r
 != ~0)

235 
	`vlib_buf„r_‰ì_⁄e
 (
sm
->
vlib_maö
, sm->
fú°_buf„r
);

236 
	`˛ib_fifo_ª£t
 (
sm
->
rx
.
buf„r_fifo
);

237 i‡(
m
->
°ªam
.
ovîÊow_buf„r
)

238 
	`_vec_Àn
 (
m
->
°ªam
.
ovîÊow_buf„r
) = 0;

239 
	}
}

	@cli.c

40 
	~<vlib/vlib.h
>

41 
	~<vµö‰a/˝u.h
>

42 
	~<uni°d.h
>

43 
	~<˘y≥.h
>

47 
VLIB_CLI_COMMAND
 (
vlib_˛i_show_comm™d
, ) = {

48 .
∑th
 = "show",

49 .
	gsh‹t_hñp
 = "Show commands",

55 
VLIB_CLI_COMMAND
 (
vlib_˛i_˛ór_comm™d
, ) = {

56 .
∑th
 = "clear",

57 .
	gsh‹t_hñp
 = "Clear commands",

63 
VLIB_CLI_COMMAND
 (
vlib_˛i_£t_comm™d
, ) = {

64 .
∑th
 = "set",

65 .
	gsh‹t_hñp
 = "Set commands",

71 
VLIB_CLI_COMMAND
 (
vlib_˛i_ã°_comm™d
, ) = {

72 .
∑th
 = "test",

73 .
	gsh‹t_hñp
 = "Test commands",

78 
uw‹d
 *

79 
	$vlib_˛i_sub_comm™d_m©ch
 (
vlib_˛i_comm™d_t
 * 
c
, 
unf‹m©_öput_t
 * 
öput
)

81 
i
, 
n
;

82 
uw‹d
 *
m©ch
 = 0;

83 
vlib_˛i_∑r£_posôi⁄_t
 *
p
;

85 
	`unf‹m©_skù_whôe_•a˚
 (
öput
);

87 
i
 = 0;; i++)

89 
uw‹d
 
k
;

91 
k
 = 
	`unf‹m©_gë_öput
 (
öput
);

92 
k
)

105 
UNFORMAT_END_OF_INPUT
:

108 i‡(
i
 < 
	`vec_Àn
 (
c
->
sub_comm™d_posôi⁄s
)

109 && 
	`˛ib_bôm≠_cou¡_£t_bôs
 (
m©ch
) > 1)

111 
p
 = 
	`vec_ñt_©_ödex
 (
c
->
sub_comm™d_posôi⁄s
, 
i
);

112 
n
 = 0;Ç < 
	`vec_Àn
 (
p
->
bôm≠s
);Ç++)

113 
m©ch
 = 
	`˛ib_bôm≠_™dnŸ
 (m©ch, 
p
->
bôm≠s
[
n
]);

115 
d⁄e
;

118 
	`unf‹m©_put_öput
 (
öput
);

119 
d⁄e
;

122 i‡(
i
 >
	`vec_Àn
 (
c
->
sub_comm™d_posôi⁄s
))

124 
no_m©ch
:

125 
	`˛ib_bôm≠_‰ì
 (
m©ch
);

129 
p
 = 
	`vec_ñt_©_ödex
 (
c
->
sub_comm™d_posôi⁄s
, 
i
);

130 i‡(
	`vec_Àn
 (
p
->
bôm≠s
) == 0)

131 
no_m©ch
;

133 
n
 = 
k
 - 
p
->
mö_ch¨
;

134 i‡(
n
 < 0 ||Ç >
	`vec_Àn
 (
p
->
bôm≠s
))

135 
no_m©ch
;

137 i‡(
i
 == 0)

138 
m©ch
 = 
	`˛ib_bôm≠_dup
 (
p
->
bôm≠s
[
n
]);

140 
m©ch
 = 
	`˛ib_bôm≠_™d
 (m©ch, 
p
->
bôm≠s
[
n
]);

142 i‡(
	`˛ib_bôm≠_is_zîo
 (
m©ch
))

143 
no_m©ch
;

146 
d⁄e
:

147  
m©ch
;

148 
	}
}

151 
uw‹d


152 
	$unf‹m©_vlib_˛i_sub_öput
 (
unf‹m©_öput_t
 * 
i
, 
va_li°
 * 
¨gs
)

154 
unf‹m©_öput_t
 *
sub_öput
 = 
	`va_¨g
 (*
¨gs
, unformat_input_t *);

155 
u8
 *
s
;

156 
uw‹d
 
c
;

160 
c
 = 
	`unf‹m©_gë_öput
 (
i
);

161 
c
)

173 i‡(
c
 !
UNFORMAT_END_OF_INPUT
)

174 
	`unf‹m©_put_öput
 (
i
);

176 i‡(
c
 ='{' && 
	`unf‹m©
 (
i
, "%v", &
s
))

178 
	`unf‹m©_öô_ve˘‹
 (
sub_öput
, 
s
);

185 
	}
}

187 
vlib_˛i_comm™d_t
 *

188 
	$gë_sub_comm™d
 (
vlib_˛i_maö_t
 * 
cm
, 
vlib_˛i_comm™d_t
 * 
∑ª¡
, 
u32
 
si
)

190 
vlib_˛i_sub_comm™d_t
 *
s
 = 
	`vec_ñt_©_ödex
 (
∑ª¡
->
sub_comm™ds
, 
si
);

191  
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
s
->
ödex
);

192 
	}
}

194 
uw‹d


195 
	$unf‹m©_vlib_˛i_sub_comm™d
 (
unf‹m©_öput_t
 * 
i
, 
va_li°
 * 
¨gs
)

197 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
¨gs
, vlib_main_t *);

198 
vlib_˛i_comm™d_t
 *
c
 = 
	`va_¨g
 (*
¨gs
, vlib_cli_command_t *);

199 
vlib_˛i_comm™d_t
 **
ªsu…
 = 
	`va_¨g
 (*
¨gs
, vlib_cli_command_t **);

200 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

201 
uw‹d
 *
m©ch_bôm≠
, 
is_unique
, 
ödex
;

204 
vlib_˛i_sub_ruÀ_t
 *
§
;

205 
vlib_˛i_∑r£_ruÀ_t
 *
r
;

206 
	`vec_f‹óch
 (
§
, 
c
->
sub_ruÀs
)

208 **
d
;

209 
r
 = 
	`vec_ñt_©_ödex
 (
cm
->
∑r£_ruÀs
, 
§
->
ruÀ_ödex
);

210 
	`vec_add2
 (
cm
->
∑r£_ruÀ_d©a
, 
d
, 1);

211 
	`vec_ª£t_Àngth
 (
d
[0]);

212 i‡(
r
->
d©a_size
)

213 
d
[0] = 
	`_vec_ªsize
 (d[0],

215 
r
->
d©a_size
,

217   (
uw‹d
));

218 i‡(
	`unf‹m©_u£r
 (
i
, 
r
->
unf‹m©_fun˘i⁄
, 
vm
, 
d
[0]))

220 *
ªsu…
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
§
->
comm™d_ödex
);

226 
m©ch_bôm≠
 = 
	`vlib_˛i_sub_comm™d_m©ch
 (
c
, 
i
);

227 
is_unique
 = 
	`˛ib_bôm≠_cou¡_£t_bôs
 (
m©ch_bôm≠
) == 1;

228 
ödex
 = ~0;

229 i‡(
is_unique
)

231 
ödex
 = 
	`˛ib_bôm≠_fú°_£t
 (
m©ch_bôm≠
);

232 *
ªsu…
 = 
	`gë_sub_comm™d
 (
cm
, 
c
, 
ödex
);

234 
	`˛ib_bôm≠_‰ì
 (
m©ch_bôm≠
);

236  
is_unique
;

237 
	}
}

240 
	$vlib_˛i_cmp_°rögs
 (*
a1
, *
a2
)

242 
u8
 *
c1
 = *(u8 **Ë
a1
;

243 
u8
 *
c2
 = *(u8 **Ë
a2
;

245  
	`vec_cmp
 (
c1
, 
c2
);

246 
	}
}

248 
u8
 **

249 
	$vlib_˛i_gë_possibÀ_com∂ëi⁄s
 (
u8
 * 
°r
)

251 
vlib_˛i_comm™d_t
 *
c
;

252 
vlib_˛i_sub_comm™d_t
 *
sc
;

253 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

254 
vlib_˛i_maö_t
 *
vcm
 = &
vm
->
˛i_maö
;

255 
uw‹d
 *
m©ch_bôm≠
 = 0;

256 
uw‹d
 
ödex
, 
is_unique
, 
hñp_√xt_Àvñ
;

257 
u8
 **
ªsu…
 = 0;

258 
unf‹m©_öput_t
 
öput
;

259 
	`unf‹m©_öô_ve˘‹
 (&
öput
, 
	`vec_dup
 (
°r
));

260 
c
 = 
	`vec_ñt_©_ödex
 (
vcm
->
comm™ds
, 0);

263 
	`vec_Àn
 (
öput
.
buf„r
) >= 2 &&

264 
	`is•a˚
 (
öput
.
buf„r
[
	`vec_Àn
 (input.buffer) - 1]) &&

265 
	`is•a˚
 (
öput
.
buf„r
[
	`vec_Àn
 (input.buffer) - 2]))

267 
	`vec_dñ1
 (
öput
.
buf„r
, 
	`vec_Àn
 (input.buffer) - 1);

271 i‡(
	`vec_Àn
 (
öput
.
buf„r
) == 0 ||

272 (
	`vec_Àn
 (
öput
.
buf„r
Ë=1 && 
	`is•a˚
 (input.buffer[0])))

274 
	`vec_f‹óch
 (
sc
, 
c
->
sub_comm™ds
)

276 
	`vec_add1
 (
ªsu…
, (
u8
 *Ë
sc
->
«me
);

278 
d⁄e
;

283 
	`vec_add1
 (
öput
.
buf„r
, '?');

287 
m©ch_bôm≠
 = 
	`vlib_˛i_sub_comm™d_m©ch
 (
c
, &
öput
);

289 i‡(
m©ch_bôm≠
 == 0)

291 
d⁄e
;

293 
is_unique
 = 
	`˛ib_bôm≠_cou¡_£t_bôs
 (
m©ch_bôm≠
) == 1;

295 i‡(
is_unique
)

298 i‡(
öput
.
ödex
 >
	`vec_Àn
 (öput.
buf„r
) - 1)

303 
ödex
 = 
	`˛ib_bôm≠_fú°_£t
 (
m©ch_bôm≠
);

304 
c
 = 
	`gë_sub_comm™d
 (
vcm
, c, 
ödex
);

305 
	`˛ib_bôm≠_‰ì
 (
m©ch_bôm≠
);

313 
	`vec_dñ1
 (
öput
.
buf„r
, 
	`vec_Àn
 (input.buffer) - 1);

317 
hñp_√xt_Àvñ
 = (
	`vec_Àn
 (
°r
Ë=0Ë|| 
	`is•a˚
 (str[vec_len (str) - 1]);

319 
	`˛ib_bôm≠_f‹óch
(
ödex
, 
m©ch_bôm≠
, {

320 i‡(
hñp_√xt_Àvñ
 && 
is_unique
) {

321 
c
 = 
	`gë_sub_comm™d
 (
vcm
, c, 
ödex
);

322 
	`vec_f‹óch
 (
sc
, 
c
->
sub_comm™ds
) {

323 
	`vec_add1
 (
ªsu…
, (
u8
*Ë
sc
->
«me
);

325 
d⁄e
;

327 
sc
 = &
c
->
sub_comm™ds
[
ödex
];

328 
	`vec_add1
(
ªsu…
, (
u8
*Ë
sc
->
«me
);

332 
d⁄e
:

333 
	`˛ib_bôm≠_‰ì
 (
m©ch_bôm≠
);

334 
	`unf‹m©_‰ì
 (&
öput
);

336 i‡(
ªsu…
)

337 
	`vec_s‹t_wôh_fun˘i⁄
 (
ªsu…
, 
vlib_˛i_cmp_°rögs
);

338  
ªsu…
;

339 
	}
}

341 
u8
 *

342 
	$f‹m©_vlib_˛i_comm™d_hñp
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

344 
vlib_˛i_comm™d_t
 *
c
 = 
	`va_¨g
 (*
¨gs
, vlib_cli_command_t *);

345 
is_l⁄g
 = 
	`va_¨g
 (*
¨gs
, );

346 i‡(
is_l⁄g
 && 
c
->
l⁄g_hñp
)

347 
s
 = 
	`f‹m©
 (s, "%s", 
c
->
l⁄g_hñp
);

348 i‡(
c
->
sh‹t_hñp
)

349 
s
 = 
	`f‹m©
 (s, "%s", 
c
->
sh‹t_hñp
);

351 
s
 = 
	`f‹m©
 (s, "%v comm™ds", 
c
->
∑th
);

352  
s
;

353 
	}
}

355 
u8
 *

356 
	$f‹m©_vlib_˛i_∑r£_ruÀ_«me
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

358 
vlib_˛i_∑r£_ruÀ_t
 *
r
 = 
	`va_¨g
 (*
¨gs
, vlib_cli_parse_rule_t *);

359  
	`f‹m©
 (
s
, "<%U>", 
f‹m©_c_idítifõr
, 
r
->
«me
);

360 
	}
}

362 
u8
 *

363 
	$f‹m©_vlib_˛i_∑th
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

365 
u8
 *
∑th
 = 
	`va_¨g
 (*
¨gs
, u8 *);

366 
i
, 
ö_ruÀ
;

367 
ö_ruÀ
 = 0;

368 
i
 = 0; i < 
	`vec_Àn
 (
∑th
); i++)

370 
∑th
[
i
])

373 
ö_ruÀ
 = 1;

374 
	`vec_add1
 (
s
, '<');

379 
	`vec_add1
 (
s
, 
ö_ruÀ
 ? ' ' : '_');

383 i‡(
ö_ruÀ
)

385 
	`vec_add1
 (
s
, '>');

386 
ö_ruÀ
 = 0;

388 
	`vec_add1
 (
s
, ' ');

392 
	`vec_add1
 (
s
, 
∑th
[
i
]);

397 i‡(
ö_ruÀ
)

398 
	`vec_add1
 (
s
, '>');

400  
s
;

401 
	}
}

403 
vlib_˛i_comm™d_t
 *

404 
	$Æl_subs
 (
vlib_˛i_maö_t
 * 
cm
, 
vlib_˛i_comm™d_t
 * 
subs
, 
u32
 
comm™d_ödex
)

406 
vlib_˛i_comm™d_t
 *
c
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
comm™d_ödex
);

407 
vlib_˛i_sub_comm™d_t
 *
sc
;

408 
vlib_˛i_sub_ruÀ_t
 *
§
;

410 i‡(
c
->
fun˘i⁄
)

411 
	`vec_add1
 (
subs
, 
c
[0]);

413 
	`vec_f‹óch
 (
§
, 
c
->
sub_ruÀs
)

414 
subs
 = 
	`Æl_subs
 (
cm
, subs, 
§
->
comm™d_ödex
);

415 
	`vec_f‹óch
 (
sc
, 
c
->
sub_comm™ds
Ë
subs
 = 
	`Æl_subs
 (
cm
, subs, sc->
ödex
);

417  
subs
;

418 
	}
}

421 
	$vlib_˛i_cmp_ruÀ
 (*
a1
, *
a2
)

423 
vlib_˛i_sub_ruÀ_t
 *
r1
 = 
a1
;

424 
vlib_˛i_sub_ruÀ_t
 *
r2
 = 
a2
;

426  
	`vec_cmp
 (
r1
->
«me
, 
r2
->name);

427 
	}
}

430 
	$vlib_˛i_cmp_comm™d
 (*
a1
, *
a2
)

432 
vlib_˛i_comm™d_t
 *
c1
 = 
a1
;

433 
vlib_˛i_comm™d_t
 *
c2
 = 
a2
;

435  
	`vec_cmp
 (
c1
->
∑th
, 
c2
->path);

436 
	}
}

438 
˛ib_îr‹_t
 *

439 
	$vlib_˛i_di•©ch_sub_comm™ds
 (
vlib_maö_t
 * 
vm
,

440 
vlib_˛i_maö_t
 * 
cm
,

441 
unf‹m©_öput_t
 * 
öput
,

442 
uw‹d
 
∑ª¡_comm™d_ödex
)

444 
vlib_˛i_comm™d_t
 *
∑ª¡
, *
c
;

445 
˛ib_îr‹_t
 *
îr‹
 = 0;

446 
unf‹m©_öput_t
 
sub_öput
;

447 
u8
 *
°rög
;

448 
uw‹d
 
is_maö_di•©ch
 = 
cm
 =&
vm
->
˛i_maö
;

450 
∑ª¡
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
∑ª¡_comm™d_ödex
);

451 i‡(
is_maö_di•©ch
 && 
	`unf‹m©
 (
öput
, "help"))

453 
uw‹d
 
hñp_©_íd_of_löe
, 
i
;

455 
hñp_©_íd_of_löe
 =

456 
	`unf‹m©_check_öput
 (
öput
Ë=
UNFORMAT_END_OF_INPUT
;

459 
c
 = 
∑ª¡
;

460 i‡(
unf‹m©_u£r


461 (
öput
, 
unf‹m©_vlib_˛i_sub_comm™d
, 
vm
, 
c
, &
∑ª¡
))

464 i‡(!(
	`unf‹m©_check_öput
 (
öput
Ë=
UNFORMAT_END_OF_INPUT
))

465 
unknown
;

473 i‡(!
hñp_©_íd_of_löe
)

474 
	`vlib_˛i_ouçut
 (
vm
, "%U", 
f‹m©_vlib_˛i_comm™d_hñp
, 
c
,

477 i‡(
	`vec_Àn
 (
c
->
sub_comm™ds
Ë+ vec_À¿(c->
sub_ruÀs
) == 0)

478 
	`vlib_˛i_ouçut
 (
vm
, "%v:Çÿsub-comm™ds", 
c
->
∑th
);

482 
vlib_˛i_sub_comm™d_t
 *
sc
;

483 
vlib_˛i_sub_ruÀ_t
 *
§
, *
subs
;

485 
subs
 = 
	`vec_dup
 (
c
->
sub_ruÀs
);

488 
	`vec_f‹óch
 (
sc
, 
c
->
sub_comm™ds
)

490 
	`vec_add2
 (
subs
, 
§
, 1);

491 
§
->
«me
 = 
sc
->name;

492 
§
->
comm™d_ödex
 = 
sc
->
ödex
;

493 
§
->
ruÀ_ödex
 = ~0;

496 
	`vec_s‹t_wôh_fun˘i⁄
 (
subs
, 
vlib_˛i_cmp_ruÀ
);

498 
i
 = 0; i < 
	`vec_Àn
 (
subs
); i++)

500 
vlib_˛i_comm™d_t
 *
d
;

501 
vlib_˛i_∑r£_ruÀ_t
 *
r
;

503 
d
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
subs
[
i
].
comm™d_ödex
);

504 
r
 =

505 
subs
[
i
].
ruÀ_ödex
 !~0 ? 
	`vec_ñt_©_ödex
 (
cm
->
∑r£_ruÀs
,

506 
subs


507 [
i
].
ruÀ_ödex
) :

510 i‡(
r
)

511 
vlib_˛i_ouçut


512 (
vm
, " %-30U %U",

513 
f‹m©_vlib_˛i_∑r£_ruÀ_«me
, 
r
,

514 
f‹m©_vlib_˛i_comm™d_hñp
, 
d
, 0);

516 
vlib_˛i_ouçut


517 (
vm
, " %-30v %U",

518 
subs
[
i
].
«me
,

519 
f‹m©_vlib_˛i_comm™d_hñp
, 
d
, 0);

522 
	`vec_‰ì
 (
subs
);

526 i‡(
is_maö_di•©ch


527 && (
	`unf‹m©
 (
öput
, "choices") || unformat (input, "?")))

529 
vlib_˛i_comm™d_t
 *
sub
, *
subs
;

531 
subs
 = 
	`Æl_subs
 (
cm
, 0, 
∑ª¡_comm™d_ödex
);

532 
	`vec_s‹t_wôh_fun˘i⁄
 (
subs
, 
vlib_˛i_cmp_comm™d
);

533 
	`vec_f‹óch
 (
sub
, 
subs
)

534 
	`vlib_˛i_ouçut
 (
vm
, " %-40U %U",

535 
f‹m©_vlib_˛i_∑th
, 
sub
->
∑th
,

536 
f‹m©_vlib_˛i_comm™d_hñp
, 
sub
, 0);

537 
	`vec_‰ì
 (
subs
);

540 i‡(
	`unf‹m©
 (
öput
, "commíà%v", &
°rög
))

542 
	`vec_‰ì
 (
°rög
);

545 i‡(
	`unf‹m©
 (
öput
, "uncomment %U",

546 
unf‹m©_vlib_˛i_sub_öput
, &
sub_öput
))

548 
îr‹
 =

549 
	`vlib_˛i_di•©ch_sub_comm™ds
 (
vm
, 
cm
, &
sub_öput
,

550 
∑ª¡_comm™d_ödex
);

551 
	`unf‹m©_‰ì
 (&
sub_öput
);

555 i‡(
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_vlib_˛i_sub_comm™d
, 
vm
, 
∑ª¡
, &
c
))

557 
unf‹m©_öput_t
 *
si
;

558 
uw‹d
 
has_sub_comm™ds
 =

559 
	`vec_Àn
 (
c
->
sub_comm™ds
Ë+ vec_À¿(c->
sub_ruÀs
) > 0;

561 
si
 = 
öput
;

562 i‡(
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_vlib_˛i_sub_öput
, &
sub_öput
))

563 
si
 = &
sub_öput
;

565 i‡(
has_sub_comm™ds
)

566 
îr‹
 = 
	`vlib_˛i_di•©ch_sub_comm™ds
 (
vm
, 
cm
, 
si
, 
c
 - cm->
comm™ds
);

568 i‡(
has_sub_comm™ds
 && !
îr‹
)

571 i‡(
c
->
fun˘i⁄
)

573 
˛ib_îr‹_t
 *
c_îr‹
;

576 
	`unf‹m©_skù_whôe_•a˚
 (
si
);

578 i‡(
	`unf‹m©
 (
si
, "?"))

580 
	`vlib_˛i_ouçut
 (
vm
, " %-40U %U", 
f‹m©_vlib_˛i_∑th
, 
c
->
∑th
, 
f‹m©_vlib_˛i_comm™d_hñp
, c,

585 i‡(!
c
->
is_mp_ß„
)

586 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

588 
c_îr‹
 = 
c
->
	`fun˘i⁄
 (
vm
, 
si
, c);

590 i‡(!
c
->
is_mp_ß„
)

591 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

593 i‡(
c_îr‹
)

595 
îr‹
 =

596 
	`˛ib_îr‹_ªtu∫
 (0, "%v: %v", 
c
->
∑th
, 
c_îr‹
->
wh©
);

597 
	`˛ib_îr‹_‰ì
 (
c_îr‹
);

599 i‡(
si
 !
öput
)

600 
	`unf‹m©_‰ì
 (
si
);

602  
îr‹
;

607 
	`˛ib_îr‹_‰ì
 (
îr‹
);

610 i‡(!
îr‹
)

611 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "%v:Çÿsub-comm™ds", 
c
->
∑th
);

614 i‡(
si
 !
öput
)

615 
	`unf‹m©_‰ì
 (
si
);

619 
unknown
;

621  
îr‹
;

623 
unknown
:

624 i‡(
∑ª¡
->
∑th
)

625  
	`˛ib_îr‹_ªtu∫
 (0, "%v: unknow¿öpuà`%U'", 
∑ª¡
->
∑th
,

626 
f‹m©_unf‹m©_îr‹
, 
öput
);

628  
	`˛ib_îr‹_ªtu∫
 (0, "unknow¿öpuà`%U'", 
f‹m©_unf‹m©_îr‹
,

629 
öput
);

630 
	}
}

633 
	$vlib_unix_îr‹_ªp‹t
 (
vlib_maö_t
 *, 
˛ib_îr‹_t
 *)

634 
	`__©åibuã__
 ((
wók
));

637 
	$vlib_unix_îr‹_ªp‹t
 (
vlib_maö_t
 * 
vm
, 
˛ib_îr‹_t
 * 
îr‹
)

639 
	}
}

643 
	$vlib_˛i_öput
 (
vlib_maö_t
 * 
vm
,

644 
unf‹m©_öput_t
 * 
öput
,

645 
vlib_˛i_ouçut_fun˘i⁄_t
 * 
fun˘i⁄
, 
uw‹d
 
fun˘i⁄_¨g
)

647 
vlib_¥o˚ss_t
 *
˝
 = 
	`vlib_gë_cuºít_¥o˚ss
 (
vm
);

648 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

649 
˛ib_îr‹_t
 *
îr‹
;

650 
vlib_˛i_ouçut_fun˘i⁄_t
 *
ßve_fun˘i⁄
;

651 
uw‹d
 
ßve_fun˘i⁄_¨g
;

653 
ßve_fun˘i⁄
 = 
˝
->
ouçut_fun˘i⁄
;

654 
ßve_fun˘i⁄_¨g
 = 
˝
->
ouçut_fun˘i⁄_¨g
;

656 
˝
->
ouçut_fun˘i⁄
 = 
fun˘i⁄
;

657 
˝
->
ouçut_fun˘i⁄_¨g
 = 
fun˘i⁄_¨g
;

661 
	`vec_ª£t_Àngth
 (
cm
->
∑r£_ruÀ_d©a
);

662 
îr‹
 = 
	`vlib_˛i_di•©ch_sub_comm™ds
 (
vm
, &vm->
˛i_maö
, 
öput
,

665 !
îr‹
 && !
	`unf‹m©
 (
öput
, "%U", 
unf‹m©_eof
));

667 i‡(
îr‹
)

669 
	`vlib_˛i_ouçut
 (
vm
, "%v", 
îr‹
->
wh©
);

670 
	`vlib_unix_îr‹_ªp‹t
 (
vm
, 
îr‹
);

671 
	`˛ib_îr‹_‰ì
 (
îr‹
);

674 
˝
->
ouçut_fun˘i⁄
 = 
ßve_fun˘i⁄
;

675 
˝
->
ouçut_fun˘i⁄_¨g
 = 
ßve_fun˘i⁄_¨g
;

676 
	}
}

680 
	$vlib_˛i_ouçut
 (
vlib_maö_t
 * 
vm
, *
fmt
, ...)

682 
vlib_¥o˚ss_t
 *
˝
 = 
	`vlib_gë_cuºít_¥o˚ss
 (
vm
);

683 
va_li°
 
va
;

684 
u8
 *
s
;

686 
	`va_°¨t
 (
va
, 
fmt
);

687 
s
 = 
	`va_f‹m©
 (0, 
fmt
, &
va
);

688 
	`va_íd
 (
va
);

691 i‡(
	`vec_Àn
 (
s
) > 0 && s[vec_len (s) - 1] != '\n')

692 
	`vec_add1
 (
s
, '\n');

694 i‡((!
˝
Ë|| (!˝->
ouçut_fun˘i⁄
))

695 
	`ff‹m©
 (
°dout
, "%v", 
s
);

697 
˝
->
	`ouçut_fun˘i⁄
 (˝->
ouçut_fun˘i⁄_¨g
, 
s
, 
	`vec_Àn
 (s));

699 
	`vec_‰ì
 (
s
);

700 
	}
}

702 
˛ib_îr‹_t
 *

703 
	$show_mem‹y_ußge
 (
vlib_maö_t
 * 
vm
,

704 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

706 
vîbo£
 = 0;

707 
˛ib_îr‹_t
 *
îr‹
;

708 
u32
 
ödex
 = 0;

710 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

712 i‡(
	`unf‹m©
 (
öput
, "verbose"))

713 
vîbo£
 = 1;

716 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknown input `%U'",

717 
f‹m©_unf‹m©_îr‹
, 
öput
);

718  
îr‹
;

723 
	`f‹óch_vlib_maö
 (

725 
	`vlib_˛i_ouçut
 (
vm
, "Thªad %d %v\n", 
ödex
, 
vlib_w‹kî_thªads
[ödex].
«me
);

726 
	`vlib_˛i_ouçut
 (
vm
, "%U\n", 
f‹m©_mhóp
, 
˛ib_≥r_˝u_mhóps
[
ödex
], 
vîbo£
);

727 
ödex
++;

731 
	}
}

734 
VLIB_CLI_COMMAND
 (
show_mem‹y_ußge_comm™d
, ) = {

735 .
∑th
 = "show memory",

736 .
	gsh‹t_hñp
 = "Show current memory usage",

737 .
	gfun˘i⁄
 = 
show_mem‹y_ußge
,

741 
˛ib_îr‹_t
 *

742 
	$show_˝u
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

743 
vlib_˛i_comm™d_t
 * 
cmd
)

745 
	#_
(
a
,
b
,
c
Ë
	`vlib_˛i_ouçut
 (
vm
, "%-25†" b,á ":", c);

	)

746 
	`_
("ModñÇame", "%U", 
f‹m©_˝u_modñ_«me
);

747 
	`_
("Mi¸ﬂrchôe˘uª", "%U", 
f‹m©_˝u_u¨ch
);

748 
	`_
("Fœgs", "%U", 
f‹m©_˝u_Êags
);

749 
	`_
("Base frequency", "%.2f GHz",

750 ((
f64
Ë
vm
->
˛ib_time
.
˛ocks_≥r_£c⁄d
) * 1e-9);

751 #unde‡
_


753 
	}
}

767 
VLIB_CLI_COMMAND
 (
show_˝u_comm™d
, ) = {

768 .
∑th
 = "show cpu",

769 .
	gsh‹t_hñp
 = "Show cpu information",

770 .
	gfun˘i⁄
 = 
show_˝u
,

774 
˛ib_îr‹_t
 *

775 
	$íabÀ_dißbÀ_mem‹y_åa˚
 (
vlib_maö_t
 * 
vm
,

776 
unf‹m©_öput_t
 * 
öput
,

777 
vlib_˛i_comm™d_t
 * 
cmd
)

779 
˛ib_îr‹_t
 *
îr‹
 = 0;

780 
íabÀ
;

782 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_vlib_íabÀ_dißbÀ
, &
íabÀ
))

784 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "expectingÉnable/on or disable/off");

785 
d⁄e
;

788 
	`˛ib_mem_åa˚
 (
íabÀ
);

790 
d⁄e
:

791  
îr‹
;

792 
	}
}

795 
VLIB_CLI_COMMAND
 (
íabÀ_dißbÀ_mem‹y_åa˚_comm™d
, ) = {

796 .
∑th
 = "memory-trace",

797 .
	gsh‹t_hñp
 = "Enable/disable memoryállocationÅrace",

798 .
	gfun˘i⁄
 = 
íabÀ_dißbÀ_mem‹y_åa˚
,

803 
˛ib_îr‹_t
 *

804 
	$ã°_hóp_vÆid©e
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

805 
vlib_˛i_comm™d_t
 * 
cmd
)

807 
˛ib_îr‹_t
 *
îr‹
 = 0;

808 *
hóp
;

809 
mhóp_t
 *
mhóp
;

811 i‡(
	`unf‹m©
 (
öput
, "on"))

814 
	`f‹óch_vlib_maö
({

815 
hóp
 = 
˛ib_≥r_˝u_mhóps
[
this_vlib_maö
->
thªad_ödex
];

816 
mhóp
 = 
	`mhóp_hódî
(
hóp
);

817 
mhóp
->
Êags
 |
MHEAP_FLAG_VALIDATE
;

819 
mhóp
->
Êags
 &~
MHEAP_FLAG_SMALL_OBJECT_CACHE
;

824 i‡(
	`unf‹m©
 (
öput
, "off"))

827 
	`f‹óch_vlib_maö
({

828 
hóp
 = 
˛ib_≥r_˝u_mhóps
[
this_vlib_maö
->
thªad_ödex
];

829 
mhóp
 = 
	`mhóp_hódî
(
hóp
);

830 
mhóp
->
Êags
 &~
MHEAP_FLAG_VALIDATE
;

831 
mhóp
->
Êags
 |
MHEAP_FLAG_SMALL_OBJECT_CACHE
;

835 i‡(
	`unf‹m©
 (
öput
, "now"))

838 
	`f‹óch_vlib_maö
({

839 
hóp
 = 
˛ib_≥r_˝u_mhóps
[
this_vlib_maö
->
thªad_ödex
];

840 
mhóp
 = 
	`mhóp_hódî
(
hóp
);

841 
	`mhóp_vÆid©e
(
hóp
);

844 
	`vlib_˛i_ouçut
 (
vm
, "heap validation complete");

849  
	`˛ib_îr‹_ªtu∫
 (0, "unknown input `%U'",

850 
f‹m©_unf‹m©_îr‹
, 
öput
);

853  
îr‹
;

854 
	}
}

857 
VLIB_CLI_COMMAND
 (
cmd_ã°_hóp_vÆid©e
,) = {

858 .
∑th
 = "test heap-validate",

859 .
	gsh‹t_hñp
 = "<on/off/now> validate heap on futureállocs/frees orÑightÇow",

860 .
	gfun˘i⁄
 = 
ã°_hóp_vÆid©e
,

864 
˛ib_îr‹_t
 *

865 
	$ª°¨t_cmd_‚
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

866 
vlib_˛i_comm™d_t
 * 
cmd
)

868 *
√wívú⁄
[] = { 
NULL
 };

870 
	`execve
 (
vm
->
«me
, (**Ëvm->
¨gv
, 
√wívú⁄
);

873 
	}
}

876 
VLIB_CLI_COMMAND
 (
ª°¨t_cmd
,) = {

877 .
∑th
 = "restart",

878 .
	gsh‹t_hñp
 = "restartÖrocess",

879 .
	gfun˘i⁄
 = 
ª°¨t_cmd_‚
,

883 #ifde‡
TEST_CODE


889 
˛ib_îr‹_t
 *

890 
	$¶ìp_ãn_£c⁄ds
 (
vlib_maö_t
 * 
vm
,

891 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

893 
u16
 
i
;

894 
u16
 
my_id
 = 
	`ønd
 ();

896 
	`vlib_˛i_ouçut
 (
vm
, "Sèπög 10 sec⁄d†¶ì∞wôh id %u\n", 
my_id
);

898 
i
 = 0; i < 10; i++)

900 
	`vlib_¥o˚ss_waô_f‹_evít_‹_˛ock
 (
vm
, 1.0);

901 
	`vlib_˛i_ouçut
 (
vm
, "Iãøti⁄Çumbî %u, my id: %u\n", 
i
, 
my_id
);

903 
	`vlib_˛i_ouçut
 (
vm
, "D⁄êwôh sÀï wôh id %u\n", 
my_id
);

905 
	}
}

908 
VLIB_CLI_COMMAND
 (
pög_comm™d
, ) = {

909 .
∑th
 = "test sleep",

910 .
	gfun˘i⁄
 = 
¶ìp_ãn_£c⁄ds
,

911 .
	gsh‹t_hñp
 = "Sleep for 10 seconds",

916 
uw‹d


917 
	$vlib_˛i_n‹mÆize_∑th
 (*
öput
, **
ªsu…
)

919 *
i
 = 
öput
;

920 *
s
 = 0;

921 
uw‹d
 
l
 = 0;

922 
uw‹d
 
ödex_of_œ°_•a˚
 = ~0;

924 *
i
 != 0)

926 
u8
 
c
 = *
i
++;

928 
c
)

934 i‡(
l
 > 0 && 
s
[l - 1] != ' ')

936 
	`vec_add1
 (
s
, ' ');

937 
l
++;

942 i‡(
l
 > 0 && 
s
[l - 1] == ' ')

943 
ödex_of_œ°_•a˚
 = 
	`vec_Àn
 (
s
);

944 
	`vec_add1
 (
s
, 
c
);

945 
l
++;

951 i‡(
l
 > 0 && 
s
[l - 1] == ' ')

952 
	`_vec_Àn
 (
s
) -= 1;

954 *
ªsu…
 = 
s
;

955  
ödex_of_œ°_•a˚
;

956 
	}
}

958 
Æways_ölöe
 
uw‹d


959 
	$∑ª¡_∑th_Àn
 (*
∑th
)

961 
w‹d
 
i
;

962 
i
 = 
	`vec_Àn
 (
∑th
) - 1; i >= 0; i--)

964 i‡(
∑th
[
i
] == ' ')

965  
i
;

968 
	}
}

971 
	$add_sub_comm™d
 (
vlib_˛i_maö_t
 * 
cm
, 
uw‹d
 
∑ª¡_ödex
, uw‹d 
chûd_ödex
)

973 
vlib_˛i_comm™d_t
 *
p
, *
c
;

974 
vlib_˛i_sub_comm™d_t
 *
sub_c
;

975 
u8
 *
sub_«me
;

976 
w‹d
 
i
, 
l
;

978 
p
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
∑ª¡_ödex
);

979 
c
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
chûd_ödex
);

981 
l
 = 
	`∑ª¡_∑th_Àn
 (
c
->
∑th
);

982 i‡(
l
 == ~0)

983 
sub_«me
 = 
	`vec_dup
 ((
u8
 *Ë
c
->
∑th
);

986 
	`ASSERT
 (
l
 + 1 < 
	`vec_Àn
 (
c
->
∑th
));

987 
sub_«me
 = 0;

988 
	`vec_add
 (
sub_«me
, 
c
->
∑th
 + 
l
 + 1, 
	`vec_Àn
 (c->path) - (l + 1));

991 i‡(
sub_«me
[0] == '%')

993 
uw‹d
 *
q
;

994 
vlib_˛i_sub_ruÀ_t
 *
§
;

997 
	`vec_dñëe
 (
sub_«me
, 1, 0);

999 i‡(!
p
->
sub_ruÀ_ödex_by_«me
)

1000 
p
->
sub_ruÀ_ödex_by_«me
 = 
	`hash_¸óã_vec
 ( 32,

1001  (
sub_«me
[0]),

1002  (
uw‹d
));

1003 
q
 = 
	`hash_gë_mem
 (
p
->
sub_ruÀ_ödex_by_«me
, 
sub_«me
);

1004 i‡(
q
)

1006 
§
 = 
	`vec_ñt_©_ödex
 (
p
->
sub_ruÀs
, 
q
[0]);

1007 
	`ASSERT
 (
§
->
comm™d_ödex
 =
chûd_ödex
);

1011 
q
 = 
	`hash_gë_mem
 (
cm
->
∑r£_ruÀ_ödex_by_«me
, 
sub_«me
);

1012 i‡(!
q
)

1014 
	`˛ib_îr‹
 ("referenceÅo unknownÑule `%%%v' inÖath `%v'",

1015 
sub_«me
, 
c
->
∑th
);

1019 
	`hash_£t_mem
 (
p
->
sub_ruÀ_ödex_by_«me
, 
sub_«me
,

1020 
	`vec_Àn
 (
p
->
sub_ruÀs
));

1021 
	`vec_add2
 (
p
->
sub_ruÀs
, 
§
, 1);

1022 
§
->
«me
 = 
sub_«me
;

1023 
§
->
ruÀ_ödex
 = 
q
[0];

1024 
§
->
comm™d_ödex
 = 
chûd_ödex
;

1028 i‡(!
p
->
sub_comm™d_ödex_by_«me
)

1029 
p
->
sub_comm™d_ödex_by_«me
 = 
	`hash_¸óã_vec
 ( 32,

1030  (
c
->
∑th
[0]),

1031  (
uw‹d
));

1034 i‡(
	`hash_gë_mem
 (
p
->
sub_comm™d_ödex_by_«me
, 
sub_«me
))

1036 
	`vec_‰ì
 (
sub_«me
);

1040 
	`vec_add2
 (
p
->
sub_comm™ds
, 
sub_c
, 1);

1041 
sub_c
->
ödex
 = 
chûd_ödex
;

1042 
sub_c
->
«me
 = 
sub_«me
;

1043 
	`hash_£t_mem
 (
p
->
sub_comm™d_ödex_by_«me
, 
sub_c
->
«me
,

1044 
sub_c
 - 
p
->
sub_comm™ds
);

1046 
	`vec_vÆid©e
 (
p
->
sub_comm™d_posôi⁄s
, 
	`vec_Àn
 (
sub_c
->
«me
) - 1);

1047 
i
 = 0; i < 
	`vec_Àn
 (
sub_c
->
«me
); i++)

1049 
n
;

1050 
vlib_˛i_∑r£_posôi⁄_t
 *
pos
;

1052 
pos
 = 
	`vec_ñt_©_ödex
 (
p
->
sub_comm™d_posôi⁄s
, 
i
);

1054 i‡(!
pos
->
bôm≠s
)

1055 
pos
->
mö_ch¨
 = 
sub_c
->
«me
[
i
];

1057 
n
 = 
sub_c
->
«me
[
i
] - 
pos
->
mö_ch¨
;

1058 i‡(
n
 < 0)

1060 
pos
->
mö_ch¨
 = 
sub_c
->
«me
[
i
];

1061 
	`vec_ö£π
 (
pos
->
bôm≠s
, -
n
, 0);

1062 
n
 = 0;

1065 
	`vec_vÆid©e
 (
pos
->
bôm≠s
, 
n
);

1066 
pos
->
bôm≠s
[
n
] =

1067 
	`˛ib_bôm≠_‹i
 (
pos
->
bôm≠s
[
n
], 
sub_c
 - 
p
->
sub_comm™ds
);

1069 
	}
}

1072 
	$vlib_˛i_make_∑ª¡
 (
vlib_˛i_maö_t
 * 
cm
, 
uw‹d
 
ci
)

1074 
uw‹d
 
p_Àn
, 
pi
, *
p
;

1075 *
p_∑th
;

1076 
vlib_˛i_comm™d_t
 *
c
, *
∑ª¡
;

1079 
	`ASSERT
 (
	`vec_Àn
 (
cm
->
comm™ds
) > 0);

1081 
c
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
ci
);

1082 
p_Àn
 = 
	`∑ª¡_∑th_Àn
 (
c
->
∑th
);

1085 i‡(
p_Àn
 == ~0)

1087 
	`add_sub_comm™d
 (
cm
, 0, 
ci
);

1091 
p_∑th
 = 0;

1092 
	`vec_add
 (
p_∑th
, 
c
->
∑th
, 
p_Àn
);

1094 
p
 = 
	`hash_gë_mem
 (
cm
->
comm™d_ödex_by_∑th
, 
p_∑th
);

1097 i‡(!
p
)

1100 
	`vec_add2
 (
cm
->
comm™ds
, 
∑ª¡
, 1);

1101 
∑ª¡
->
∑th
 = 
p_∑th
;

1102 
	`hash_£t_mem
 (
cm
->
comm™d_ödex_by_∑th
, 
∑ª¡
->
∑th
,

1103 
∑ª¡
 - 
cm
->
comm™ds
);

1104 
pi
 = 
∑ª¡
 - 
cm
->
comm™ds
;

1108 
pi
 = 
p
[0];

1109 
	`vec_‰ì
 (
p_∑th
);

1112 
	`add_sub_comm™d
 (
cm
, 
pi
, 
ci
);

1115 i‡(!
p
)

1116 
	`vlib_˛i_make_∑ª¡
 (
cm
, 
pi
);

1117 
	}
}

1119 
Æways_ölöe
 
uw‹d


1120 
	$vlib_˛i_comm™d_is_em±y
 (
vlib_˛i_comm™d_t
 * 
c
)

1122  (
c
->
l⁄g_hñp
 =0 && c->
sh‹t_hñp
 =0 && c->
fun˘i⁄
 == 0);

1123 
	}
}

1125 
˛ib_îr‹_t
 *

1126 
	$vlib_˛i_ªgi°î
 (
vlib_maö_t
 * 
vm
, 
vlib_˛i_comm™d_t
 * 
c
)

1128 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

1129 
˛ib_îr‹_t
 *
îr‹
 = 0;

1130 
uw‹d
 
ci
, *
p
;

1131 *
n‹mÆized_∑th
;

1133 i‡((
îr‹
 = 
	`vlib_ˇŒ_öô_fun˘i⁄
 (
vm
, 
vlib_˛i_öô
)))

1134  
îr‹
;

1136 (Ë
	`vlib_˛i_n‹mÆize_∑th
 (
c
->
∑th
, &
n‹mÆized_∑th
);

1138 i‡(!
cm
->
comm™d_ödex_by_∑th
)

1139 
cm
->
comm™d_ödex_by_∑th
 = 
	`hash_¸óã_vec
 ( 32,

1140  (
c
->
∑th
[0]),

1141  (
uw‹d
));

1144 
p
 = 
	`hash_gë_mem
 (
cm
->
comm™d_ödex_by_∑th
, 
n‹mÆized_∑th
);

1145 i‡(
p
)

1147 
vlib_˛i_comm™d_t
 *
d
;

1149 
ci
 = 
p
[0];

1150 
d
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
ci
);

1154 i‡(
	`vlib_˛i_comm™d_is_em±y
 (
d
))

1156 
vlib_˛i_comm™d_t
 
ßve
 = 
d
[0];

1158 
	`ASSERT
 (!
	`vlib_˛i_comm™d_is_em±y
 (
c
));

1161 
d
[0] = 
c
[0];

1164 
d
->
∑th
 = 
ßve
.path;

1165 
d
->
sub_comm™ds
 = 
ßve
.sub_commands;

1166 
d
->
sub_comm™d_ödex_by_«me
 = 
ßve
.sub_command_index_by_name;

1167 
d
->
sub_comm™d_posôi⁄s
 = 
ßve
.sub_command_positions;

1168 
d
->
sub_ruÀs
 = 
ßve
.sub_rules;

1171 
îr‹
 =

1172 
	`˛ib_îr‹_ªtu∫
 (0, "duplicate commandÇame withÖath %v",

1173 
n‹mÆized_∑th
);

1175 
	`vec_‰ì
 (
n‹mÆized_∑th
);

1176 i‡(
îr‹
)

1177  
îr‹
;

1184 i‡(
	`vec_Àn
 (
cm
->
comm™ds
) == 0)

1187 
	`vec_ªsize
 (
cm
->
comm™ds
, 1);

1190 
ci
 = 
	`vec_Àn
 (
cm
->
comm™ds
);

1191 
	`hash_£t_mem
 (
cm
->
comm™d_ödex_by_∑th
, 
n‹mÆized_∑th
, 
ci
);

1192 
	`vec_add1
 (
cm
->
comm™ds
, 
c
[0]);

1194 
c
 = 
	`vec_ñt_©_ödex
 (
cm
->
comm™ds
, 
ci
);

1195 
c
->
∑th
 = 
n‹mÆized_∑th
;

1198 
c
->
sub_comm™ds
 = 0;

1199 
c
->
sub_comm™d_ödex_by_«me
 = 0;

1200 
c
->
sub_comm™d_posôi⁄s
 = 0;

1203 
	`vlib_˛i_make_∑ª¡
 (
cm
, 
ci
);

1205 
	}
}

1207 
˛ib_îr‹_t
 *

1208 
	$vlib_˛i_ªgi°î_∑r£_ruÀ
 (
vlib_maö_t
 * 
vm
, 
vlib_˛i_∑r£_ruÀ_t
 * 
r_ªg
)

1210 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

1211 
vlib_˛i_∑r£_ruÀ_t
 *
r
;

1212 
˛ib_îr‹_t
 *
îr‹
 = 0;

1213 
u8
 *
r_«me
;

1214 
uw‹d
 *
p
;

1216 i‡(!
cm
->
∑r£_ruÀ_ödex_by_«me
)

1217 
cm
->
∑r£_ruÀ_ödex_by_«me
 = 
	`hash_¸óã_vec
 ( 32,

1218  (
r
->
«me
[0]),

1219  (
uw‹d
));

1222 
r_«me
 = 
	`f‹m©
 (0, "%s", 
r_ªg
->
«me
);

1224 i‡((
p
 = 
	`hash_gë_mem
 (
cm
->
∑r£_ruÀ_ödex_by_«me
, 
r_«me
)))

1226 
	`vec_‰ì
 (
r_«me
);

1227  
	`˛ib_îr‹_ªtu∫
 (0, "duplicateÖarseÑuleÇame `%s'",

1228 
r_ªg
->
«me
);

1231 
	`vec_add2
 (
cm
->
∑r£_ruÀs
, 
r
, 1);

1232 
r
[0] = 
r_ªg
[0];

1233 
r
->
«me
 = (*Ë
r_«me
;

1234 
	`hash_£t_mem
 (
cm
->
∑r£_ruÀ_ödex_by_«me
, 
r
->
«me
,Ñ - cm->
∑r£_ruÀs
);

1236  
îr‹
;

1237 
	}
}

1241 
˛ib_îr‹_t
 *
	$vlib_˛i_ªgi°î_∑r£_ruÀs
 (
vlib_maö_t
 * 
vm
,

1242 
vlib_˛i_∑r£_ruÀ_t
 *

1243 
lo
,

1244 
vlib_˛i_∑r£_ruÀ_t
 *

1245 
hi
)

1246 
	`__©åibuã__
 ((
unu£d
))

1248 
˛ib_îr‹_t
 *
îr‹
 = 0;

1249 
vlib_˛i_∑r£_ruÀ_t
 *
r
;

1251 
r
 = 
lo
;Ñ < 
hi
;Ñ = 
	`˛ib_ñf_£˘i⁄_d©a_√xt
 (r, 0))

1253 i‡(!
r
->
«me
 || 
	`°æí
 (r->name) == 0)

1255 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "parseÑule withÇoÇame");

1256 
d⁄e
;

1259 
îr‹
 = 
	`vlib_˛i_ªgi°î_∑r£_ruÀ
 (
vm
, 
r
);

1260 i‡(
îr‹
)

1261 
d⁄e
;

1264 
d⁄e
:

1265  
îr‹
;

1266 
	}
}

1270 
	$˛i_∑th_com∑ª
 (*
a1
, *
a2
)

1272 
u8
 **
s1
 = 
a1
;

1273 
u8
 **
s2
 = 
a2
;

1275 i‡((
	`vec_Àn
 (*
s1
Ë< vec_À¿(*
s2
)) &&

1276 
	`memcmp
 ((*Ë*
s1
, (*Ë*
s2
, 
	`vec_Àn
 (*s1)) == 0)

1280 i‡((
	`vec_Àn
 (*
s1
Ë> vec_À¿(*
s2
)) &&

1281 
	`memcmp
 ((*Ë*
s1
, (*Ë*
s2
, 
	`vec_Àn
 (*s2)) == 0)

1284  
	`vec_cmp
 (*
s1
, *
s2
);

1285 
	}
}

1287 
˛ib_îr‹_t
 *

1288 
	$show_˛i_cmd_‚
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

1289 
vlib_˛i_comm™d_t
 * 
cmd
)

1291 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

1292 
vlib_˛i_comm™d_t
 *
˛i
;

1293 
u8
 **
∑ths
 = 0, **
s
;

1296 
	`vec_f‹óch
 (
˛i
, 
cm
->
comm™ds
)

1297 i‡(
	`vec_Àn
 (
˛i
->
∑th
) > 0)

1298 
	`vec_add1
 (
∑ths
, (
u8
 *Ë
˛i
->
∑th
);

1300 
	`vec_s‹t_wôh_fun˘i⁄
 (
∑ths
, 
˛i_∑th_com∑ª
);

1302 
	`vec_f‹óch
 (
s
, 
∑ths
)

1303 
	`vlib_˛i_ouçut
 (
vm
, "%v", *
s
);

1306 
	`vec_‰ì
 (
∑ths
);

1308 
	}
}

1311 
VLIB_CLI_COMMAND
 (
show_˛i_comm™d
, ) = {

1312 .
∑th
 = "show cli",

1313 .
	gsh‹t_hñp
 = "Show cli commands",

1314 .
	gfun˘i⁄
 = 
show_˛i_cmd_‚
,

1318 
˛ib_îr‹_t
 *

1319 
	$vlib_˛i_öô
 (
vlib_maö_t
 * 
vm
)

1321 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

1322 
˛ib_îr‹_t
 *
îr‹
 = 0;

1323 
vlib_˛i_comm™d_t
 *
cmd
;

1325 
cmd
 = 
cm
->
˛i_comm™d_ªgi°øti⁄s
;

1327 
cmd
)

1329 
îr‹
 = 
	`vlib_˛i_ªgi°î
 (
vm
, 
cmd
);

1330 i‡(
îr‹
)

1331  
îr‹
;

1332 
cmd
 = cmd->
√xt_˛i_comm™d
;

1334  
îr‹
;

1335 
	}
}

1337 
VLIB_INIT_FUNCTION
 (
vlib_˛i_öô
);

	@cli.h

40 #i‚de‡
ö˛uded_vlib_˛i_h


41 
	#ö˛uded_vlib_˛i_h


	)

43 
	~<vµö‰a/f‹m©.h
>

45 
	gvlib_˛i_comm™d_t
;

49 
u32
 
	mmö_ch¨
;

52 
uw‹d
 **
	mbôm≠s
;

53 } 
	tvlib_˛i_∑r£_posôi⁄_t
;

57 
u8
 *
	m«me
;

59 
u32
 
	mödex
;

60 } 
	tvlib_˛i_sub_comm™d_t
;

64 
u8
 *
	m«me
;

66 
u32
 
	mruÀ_ödex
;

68 
u32
 
	mcomm™d_ödex
;

69 } 
	tvlib_˛i_sub_ruÀ_t
;

73 *
	m«me
;

74 *
	msh‹t_hñp
;

75 *
	ml⁄g_hñp
;

78 
uw‹d
 
	md©a_size
;

80 
unf‹m©_fun˘i⁄_t
 *
	munf‹m©_fun˘i⁄
;

83 
uw‹d
 
	munf‹m©_fun˘i⁄_¨g
[2];

84 } 
	tvlib_˛i_∑r£_ruÀ_t
;

87 
	g˛ib_îr‹_t
 *(
	tvlib_˛i_comm™d_fun˘i⁄_t
)

88 (
	tvlib_maö_t
 * 
	tvm
,

89 
	tunf‹m©_öput_t
 * 
	töput
, 
	tvlib_˛i_comm™d_t
 * 
	tcmd
);

91 
	svlib_˛i_comm™d_t


95 *
	m∑th
;

98 *
	msh‹t_hñp
;

99 *
	ml⁄g_hñp
;

102 
vlib_˛i_comm™d_fun˘i⁄_t
 *
	mfun˘i⁄
;

105 
uw‹d
 
	mfun˘i⁄_¨g
;

108 
uw‹d
 
	mis_mp_ß„
;

111 
vlib_˛i_sub_comm™d_t
 *
	msub_comm™ds
;

114 
uw‹d
 *
	msub_comm™d_ödex_by_«me
;

118 
vlib_˛i_∑r£_posôi⁄_t
 *
	msub_comm™d_posôi⁄s
;

121 
uw‹d
 *
	msub_ruÀ_ödex_by_«me
;

124 
vlib_˛i_sub_ruÀ_t
 *
	msub_ruÀs
;

127 
vlib_˛i_comm™d_t
 *
	m√xt_˛i_comm™d
;

129 } 
	tvlib_˛i_comm™d_t
;

131 (
	tvlib_˛i_ouçut_fun˘i⁄_t
Ë(
	tuw‹d
 
	t¨g
,

132 
	tu8
 * 
	tbuf„r
, 
	tuw‹d
 
	tbuf„r_byãs
);

136 
vlib_˛i_comm™d_t
 *
comm™ds
;

139 
uw‹d
 *
comm™d_ödex_by_∑th
;

142 
vlib_˛i_∑r£_ruÀ_t
 *
∑r£_ruÀs
;

145 
uw‹d
 *
∑r£_ruÀ_ödex_by_«me
;

148 **
∑r£_ruÀ_d©a
;

151 
vlib_˛i_comm™d_t
 *
˛i_comm™d_ªgi°øti⁄s
;

152 } 
	tvlib_˛i_maö_t
;

154 
	#VLIB_CLI_COMMAND
(
x
,...) \

155 
__VA_ARGS__
 
vlib_˛i_comm™d_t
 
x
; \

156 
__vlib_˛i_comm™d_ªgi°øti⁄_
##
	`x
 () \

157 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

158 
__vlib_˛i_comm™d_ªgi°øti⁄_
##
	`x
 () \

160 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

161 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
; \

162 
x
.
√xt_˛i_comm™d
 = 
cm
->
˛i_comm™d_ªgi°øti⁄s
; \

163 
cm
->
˛i_comm™d_ªgi°øti⁄s
 = &
x
; \

164 
	}
} \

165 
__VA_ARGS__
 
vlib_˛i_comm™d_t
 
x


	)

166 
	#VLIB_CLI_PARSE_RULE
(
x
) \

167 
vlib_˛i_∑r£_ruÀ_t
 
x


	)

169 
vlib_˛i_ouçut
 (
vlib_maö_t
 *
vm
, *
fmt
, ...);

172 
vlib_˛i_öput
 (
vlib_maö_t
 *
vm
,

173 
unf‹m©_öput_t
 * 
öput
,

174 
vlib_˛i_ouçut_fun˘i⁄_t
 * 
fun˘i⁄
,

175 
uw‹d
 
fun˘i⁄_¨g
);

177 
˛ib_îr‹_t
 *
vlib_˛i_ªgi°î
 (
vlib_maö_t
 *
vm
,

178 
vlib_˛i_comm™d_t
 * 
c
);

179 
˛ib_îr‹_t
 *
vlib_˛i_ªgi°î_∑r£_ruÀ
 (
vlib_maö_t
 *
vm
,

180 
vlib_˛i_∑r£_ruÀ_t
 * 
c
);

182 
uw‹d
 
unf‹m©_vlib_˛i_sub_öput
 (
unf‹m©_öput_t
 * 
i
, 
va_li°
 * 
¨gs
);

186 
u8
 **
vlib_˛i_gë_possibÀ_com∂ëi⁄s
 (u8 * 
öput_°r
);

	@cli_funcs.h

40 #i‚de‡
ö˛uded_vlib_˛i_funcs_h


41 
	#ö˛uded_vlib_˛i_funcs_h


	)

43 
Æways_ölöe
 *

44 
	$vlib_˛i_gë_∑r£_ruÀ_ªsu…
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
ödex
)

46 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

47  
	`vec_ñt
 (
cm
->
∑r£_ruÀ_d©a
, 
ödex
);

48 
	}
}

	@counter.c

40 
	~<vlib/vlib.h
>

43 
	$vlib_˛ór_sim∂e_cou¡îs
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
)

45 
cou¡î_t
 *
my_cou¡îs
;

46 
uw‹d
 
i
, 
j
;

48 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

50 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

52 
j
 = 0; j < 
	`vec_Àn
 (
my_cou¡îs
); j++)

54 
my_cou¡îs
[
j
] = 0;

57 
	}
}

60 
	$vlib_˛ór_comböed_cou¡îs
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
)

62 
vlib_cou¡î_t
 *
my_cou¡îs
;

63 
uw‹d
 
i
, 
j
;

65 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

67 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

69 
j
 = 0; j < 
	`vec_Àn
 (
my_cou¡îs
); j++)

71 
my_cou¡îs
[
j
].
∑ckës
 = 0;

72 
my_cou¡îs
[
j
].
byãs
 = 0;

75 
	}
}

78 
	$vlib_vÆid©e_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

80 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

81 
i
;

83 
	`vec_vÆid©e
 (
cm
->
cou¡îs
, 
tm
->
n_vlib_maös
 - 1);

84 
i
 = 0; i < 
tm
->
n_vlib_maös
; i++)

85 
	`vec_vÆid©e_Æig√d
 (
cm
->
cou¡îs
[
i
], 
ödex
, 
CLIB_CACHE_LINE_BYTES
);

86 
	}
}

89 
	$vlib_vÆid©e_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

91 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

92 
i
;

94 
	`vec_vÆid©e
 (
cm
->
cou¡îs
, 
tm
->
n_vlib_maös
 - 1);

95 
i
 = 0; i < 
tm
->
n_vlib_maös
; i++)

96 
	`vec_vÆid©e_Æig√d
 (
cm
->
cou¡îs
[
i
], 
ödex
, 
CLIB_CACHE_LINE_BYTES
);

97 
	}
}

99 
u32


100 
	$vlib_comböed_cou¡î_n_cou¡îs
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 * 
cm
)

102 
	`ASSERT
 (
cm
->
cou¡îs
);

103  (
	`vec_Àn
 (
cm
->
cou¡îs
[0]));

104 
	}
}

106 
u32


107 
	$vlib_sim∂e_cou¡î_n_cou¡îs
 (c⁄° 
vlib_sim∂e_cou¡î_maö_t
 * 
cm
)

109 
	`ASSERT
 (
cm
->
cou¡îs
);

110  (
	`vec_Àn
 (
cm
->
cou¡îs
[0]));

111 
	}
}

114 
	$£rülize_vlib_sim∂e_cou¡î_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

116 
	`˛ib_w¨nög
 ("unimplemented");

117 
	}
}

120 
	$un£rülize_vlib_sim∂e_cou¡î_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

122 
	`˛ib_w¨nög
 ("unimplemented");

123 
	}
}

126 
	$£rülize_vlib_comböed_cou¡î_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

128 
	`˛ib_w¨nög
 ("unimplemented");

129 
	}
}

132 
	$un£rülize_vlib_comböed_cou¡î_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

134 
	`˛ib_w¨nög
 ("unimplemented");

135 
	}
}

	@counter.h

40 #i‚de‡
ö˛uded_vlib_cou¡î_h


41 
	#ö˛uded_vlib_cou¡î_h


	)

54 
u64
 
	tcou¡î_t
;

60 
cou¡î_t
 **
	mcou¡îs
;

61 
cou¡î_t
 *
	mvÆue_©_œ°_£rülize
;

62 
u32
 
	mœ°_ö¸emíèl_£rülize_ödex
;

65 *
	m«me
;

66 } 
	tvlib_sim∂e_cou¡î_maö_t
;

69 
u32
 
vlib_sim∂e_cou¡î_n_cou¡îs
 (c⁄° 
vlib_sim∂e_cou¡î_maö_t
 * 
cm
);

77 
Æways_ölöe
 

78 
	$vlib_ö¸emít_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
,

79 
u32
 
thªad_ödex
, u32 
ödex
, 
u64
 
ö¸emít
)

81 
cou¡î_t
 *
my_cou¡îs
;

83 
my_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

84 
my_cou¡îs
[
ödex
] +
ö¸emít
;

85 
	}
}

96 
Æways_ölöe
 
cou¡î_t


97 
	$vlib_gë_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

99 
cou¡î_t
 *
my_cou¡îs
;

100 
cou¡î_t
 
v
;

101 
i
;

103 
	`ASSERT
 (
ödex
 < 
	`vlib_sim∂e_cou¡î_n_cou¡îs
 (
cm
));

105 
v
 = 0;

107 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

109 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

110 
v
 +
my_cou¡îs
[
ödex
];

113  
v
;

114 
	}
}

122 
Æways_ölöe
 

123 
	$vlib_zîo_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

125 
cou¡î_t
 *
my_cou¡îs
;

126 
i
;

128 
	`ASSERT
 (
ödex
 < 
	`vlib_sim∂e_cou¡î_n_cou¡îs
 (
cm
));

130 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

132 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

133 
my_cou¡îs
[
ödex
] = 0;

135 
	}
}

141 
cou¡î_t
 
	m∑ckës
;

142 
cou¡î_t
 
	mbyãs
;

143 } 
	tvlib_cou¡î_t
;

150 
Æways_ölöe
 

151 
	$vlib_cou¡î_add
 (
vlib_cou¡î_t
 * 
a
, vlib_cou¡î_à* 
b
)

153 
a
->
∑ckës
 +
b
->packets;

154 
a
->
byãs
 +
b
->bytes;

155 
	}
}

161 
Æways_ölöe
 

162 
	$vlib_cou¡î_sub
 (
vlib_cou¡î_t
 * 
a
, vlib_cou¡î_à* 
b
)

164 
	`ASSERT
 (
a
->
∑ckës
 >
b
->packets);

165 
	`ASSERT
 (
a
->
byãs
 >
b
->bytes);

166 
a
->
∑ckës
 -
b
->packets;

167 
a
->
byãs
 -
b
->bytes;

168 
	}
}

173 
Æways_ölöe
 

174 
	$vlib_cou¡î_zîo
 (
vlib_cou¡î_t
 * 
a
)

176 
a
->
∑ckës
 =á->
byãs
 = 0;

177 
	}
}

182 
vlib_cou¡î_t
 **
	mcou¡îs
;

183 
vlib_cou¡î_t
 *
	mvÆue_©_œ°_£rülize
;

184 
u32
 
	mœ°_ö¸emíèl_£rülize_ödex
;

185 *
	m«me
;

186 } 
	tvlib_comböed_cou¡î_maö_t
;

189 
u32
 
vlib_comböed_cou¡î_n_cou¡îs
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 *

190 
cm
);

195 
vlib_˛ór_sim∂e_cou¡îs
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
);

200 
vlib_˛ór_comböed_cou¡îs
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
);

210 
Æways_ölöe
 

211 
	$vlib_ö¸emít_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
,

212 
u32
 
thªad_ödex
,

213 
u32
 
ödex
, 
u64
 
n_∑ckës
, u64 
n_byãs
)

215 
vlib_cou¡î_t
 *
my_cou¡îs
;

218 
my_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

220 
my_cou¡îs
[
ödex
].
∑ckës
 +
n_∑ckës
;

221 
my_cou¡îs
[
ödex
].
byãs
 +
n_byãs
;

222 
	}
}

225 
Æways_ölöe
 

226 
	$vlib_¥e„tch_comböed_cou¡î
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 * 
cm
,

227 
u32
 
thªad_ödex
, u32 
ödex
)

229 
vlib_cou¡î_t
 *
˝u_cou¡îs
;

234 
˝u_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

235 
	`CLIB_PREFETCH
 (
˝u_cou¡îs
 + 
ödex
, 
CLIB_CACHE_LINE_BYTES
, 
STORE
);

236 
	}
}

249 
ölöe
 

250 
	$vlib_gë_comböed_cou¡î
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 * 
cm
,

251 
u32
 
ödex
, 
vlib_cou¡î_t
 * 
ªsu…
)

253 
vlib_cou¡î_t
 *
my_cou¡îs
, *
cou¡î
;

254 
i
;

256 
ªsu…
->
∑ckës
 = 0;

257 
ªsu…
->
byãs
 = 0;

259 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

261 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

263 
cou¡î
 = 
	`vec_ñt_©_ödex
 (
my_cou¡îs
, 
ödex
);

264 
ªsu…
->
∑ckës
 +
cou¡î
->packets;

265 
ªsu…
->
byãs
 +
cou¡î
->bytes;

267 
	}
}

275 
Æways_ölöe
 

276 
	$vlib_zîo_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

278 
vlib_cou¡î_t
 *
my_cou¡îs
, *
cou¡î
;

279 
i
;

281 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

283 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

285 
cou¡î
 = 
	`vec_ñt_©_ödex
 (
my_cou¡îs
, 
ödex
);

286 
cou¡î
->
∑ckës
 = 0;

287 
cou¡î
->
byãs
 = 0;

289 
	}
}

296 
vlib_vÆid©e_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
,

297 
u32
 
ödex
);

304 
vlib_vÆid©e_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
,

305 
u32
 
ödex
);

315 
	#vlib_cou¡î_Àn
(
cm
Ë
	`vec_Àn
((cm)->
maxi
)

	)

317 
£rülize_fun˘i⁄_t
 
	g£rülize_vlib_sim∂e_cou¡î_maö
,

318 
	gun£rülize_vlib_sim∂e_cou¡î_maö
;

319 
£rülize_fun˘i⁄_t
 
	g£rülize_vlib_comböed_cou¡î_maö
,

320 
	gun£rülize_vlib_comböed_cou¡î_maö
;

	@defs.h

40 #i‚de‡
ö˛uded_vlib_defs_h


41 
	#ö˛uded_vlib_defs_h


	)

46 
	mVLIB_RX
,

47 
	mVLIB_TX
,

48 
	mVLIB_N_RX_TX
 = 2,

49 } 
	tvlib_rx_‹_tx_t
;

51 
	#vlib_f‹óch_rx_tx
(
v
Ëv = 0; v < 
VLIB_N_RX_TX
; v++)

	)

56 
	mVLIB_READ
,

57 
	mVLIB_WRITE
,

58 } 
	tvlib_ªad_‹_wrôe_t
;

63 
	mVLIB_DOWN
 = 0,

64 
	mVLIB_UP
 = 1,

65 } 
	tvlib_up_‹_down_t
;

70 
	mVLIB_DISABLE
 = 0,

71 
	mVLIB_ENABLE
 = 1,

72 } 
	tvlib_íabÀ_‹_dißbÀ_t
;

	@error.c

40 
	~<vlib/vlib.h
>

41 
	~<vµö‰a/hóp.h
>

43 
uw‹d


44 
	$vlib_îr‹_dr›_buf„rs
 (
vlib_maö_t
 * 
vm
,

45 
vlib_node_ru¡ime_t
 * 
node
,

46 
u32
 * 
buf„rs
,

47 
u32
 
√xt_buf„r_°ride
,

48 
u32
 
n_buf„rs
,

49 
u32
 
√xt_ödex
,

50 
u32
 
dr›_îr‹_node
, u32 
dr›_îr‹_code
)

52 
u32
 
n_À·_this_‰ame
, 
n_buf„rs_À·
, *
¨gs
, 
n_¨gs_À·
;

53 
vlib_îr‹_t
 
dr›_îr‹
;

55 
dr›_îr‹
 = 
	`vlib_îr‹_£t
 (
dr›_îr‹_node
, 
dr›_îr‹_code
);

57 
n_buf„rs_À·
 = 
n_buf„rs
;

58 
n_buf„rs_À·
 > 0)

60 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
¨gs
, 
n_¨gs_À·
);

62 
n_À·_this_‰ame
 = 
	`˛ib_mö
 (
n_buf„rs_À·
, 
n_¨gs_À·
);

63 
n_buf„rs_À·
 -
n_À·_this_‰ame
;

64 
n_¨gs_À·
 -
n_À·_this_‰ame
;

66 
n_À·_this_‰ame
 >= 4)

68 
u32
 
bi0
, 
bi1
, 
bi2
, 
bi3
;

69 
vlib_buf„r_t
 *
b0
, *
b1
, *
b2
, *
b3
;

71 
¨gs
[0] = 
bi0
 = 
buf„rs
[0];

72 
¨gs
[1] = 
bi1
 = 
buf„rs
[1];

73 
¨gs
[2] = 
bi2
 = 
buf„rs
[2];

74 
¨gs
[3] = 
bi3
 = 
buf„rs
[3];

76 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi0
);

77 
b1
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi1
);

78 
b2
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi2
);

79 
b3
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi3
);

81 
b0
->
îr‹
 = 
dr›_îr‹
;

82 
b1
->
îr‹
 = 
dr›_îr‹
;

83 
b2
->
îr‹
 = 
dr›_îr‹
;

84 
b3
->
îr‹
 = 
dr›_îr‹
;

86 
buf„rs
 += 4;

87 
¨gs
 += 4;

88 
n_À·_this_‰ame
 -= 4;

91 
n_À·_this_‰ame
 >= 1)

93 
u32
 
bi0
;

94 
vlib_buf„r_t
 *
b0
;

96 
¨gs
[0] = 
bi0
 = 
buf„rs
[0];

98 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi0
);

99 
b0
->
îr‹
 = 
dr›_îr‹
;

101 
buf„rs
 += 1;

102 
¨gs
 += 1;

103 
n_À·_this_‰ame
 -= 1;

106 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_¨gs_À·
);

109  
n_buf„rs
;

110 
	}
}

113 
uw‹d


114 
	$misc_dr›_buf„rs
 (
vlib_maö_t
 * 
vm
,

115 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
‰ame
)

117  
	`vlib_îr‹_dr›_buf„rs
 (
vm
, 
node
, 
	`vlib_‰ame_¨gs
 (
‰ame
),

119 
‰ame
->
n_ve˘‹s
,

121 
node
->
node_ödex
,

123 
	}
}

125 *
	gmisc_dr›_buf„rs_îr‹_°rögs
[] = {

130 
VLIB_REGISTER_NODE
 (
misc_dr›_buf„rs_node
,) = {

131 .
fun˘i⁄
 = 
misc_dr›_buf„rs
,

132 .
	g«me
 = "misc-drop-buffers",

133 .
	gve˘‹_size
 =  (
u32
),

134 .
	gn_îr‹s
 = 1,

135 .
	gn_√xt_nodes
 = 1,

136 .
	g√xt_nodes
 = {

139 .
	gîr‹_°rögs
 = 
misc_dr›_buf„rs_îr‹_°rögs
,

145 
	$vlib_ªgi°î_îr‹s
 (
vlib_maö_t
 * 
vm
,

146 
u32
 
node_ödex
, u32 
n_îr‹s
, *
îr‹_°rögs
[])

148 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

149 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

150 
uw‹d
 
l
;

152 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

155 i‡(
n
->
n_îr‹s
 > 0)

156 
	`hóp_dóŒoc
 (
em
->
îr‹_°rögs_hóp
, 
n
->
îr‹_hóp_h™dÀ
);

158 
n
->
n_îr‹s
 =Ç_errors;

159 
n
->
îr‹_°rögs
 =Érror_strings;

161 i‡(
n_îr‹s
 == 0)

164 
n
->
îr‹_hóp_ödex
 =

165 
	`hóp_Æloc
 (
em
->
îr‹_°rögs_hóp
, 
n_îr‹s
, 
n
->
îr‹_hóp_h™dÀ
);

167 
l
 = 
	`vec_Àn
 (
em
->
îr‹_°rögs_hóp
);

169 
	`˛ib_mem˝y
 (
	`vec_ñt_©_ödex
 (
em
->
îr‹_°rögs_hóp
, 
n
->
îr‹_hóp_ödex
),

170 
îr‹_°rögs
, 
n_îr‹s
 *  (error_strings[0]));

173 
	`vec_vÆid©e
 (
em
->
cou¡îs
, 
l
 - 1);

174 
	`vec_vÆid©e
 (
vm
->
îr‹_ñog_evít_ty≥s
, 
l
 - 1);

177 i‡(
n
->
îr‹_hóp_ödex
 + 
n_îr‹s
 <
	`vec_Àn
 (
em
->
cou¡îs_œ°_˛ór
))

178 
	`˛ib_mem˝y
 (
em
->
cou¡îs
 + 
n
->
îr‹_hóp_ödex
,

179 
em
->
cou¡îs_œ°_˛ór
 + 
n
->
îr‹_hóp_ödex
,

180 
n_îr‹s
 *  (
em
->
cou¡îs
[0]));

182 
	`mem£t
 (
em
->
cou¡îs
 + 
n
->
îr‹_hóp_ödex
,

183 0, 
n_îr‹s
 *  (
em
->
cou¡îs
[0]));

186 
ñog_evít_ty≥_t
 
t
;

187 
uw‹d
 
i
;

189 
	`mem£t
 (&
t
, 0,  (t));

190 
i
 = 0; i < 
n_îr‹s
; i++)

192 
t
.
f‹m©
 = (*Ë
	`f‹m©
 (0, "%v %s: %%d",

193 
n
->
«me
, 
îr‹_°rögs
[
i
]);

194 
vm
->
îr‹_ñog_evít_ty≥s
[
n
->
îr‹_hóp_ödex
 + 
i
] = 
t
;

197 
	}
}

199 
˛ib_îr‹_t
 *

200 
	$show_îr‹s
 (
vlib_maö_t
 * 
vm
,

201 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

203 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

204 
vlib_node_t
 *
n
;

205 
u32
 
code
, 
i
, 
ni
;

206 
u64
 
c
;

207 
ödex
 = 0;

208 
vîbo£
 = 0;

209 
u64
 *
sums
 = 0;

211 i‡(
	`unf‹m©
 (
öput
, "vîbo£ %d", &
vîbo£
))

213 i‡(
	`unf‹m©
 (
öput
, "verbose"))

214 
vîbo£
 = 1;

216 
	`vec_vÆid©e
 (
sums
, 
	`vec_Àn
 (
em
->
cou¡îs
));

218 i‡(
vîbo£
)

219 
	`vlib_˛i_ouçut
 (
vm
, "%=10s%=40s%=20s%=6s", "Count", "Node", "Reason",

222 
	`vlib_˛i_ouçut
 (
vm
, "%=10s%=40s%=6s", "Count", "Node", "Reason");

226 
	`f‹óch_vlib_maö
(({

227 
em
 = &
this_vlib_maö
->
îr‹_maö
;

229 i‡(
vîbo£
)

230 
	`vlib_˛i_ouçut
(
vm
, "Thªad %u (%v):", 
ödex
,

231 
vlib_w‹kî_thªads
[
ödex
].
«me
);

233 
ni
 = 0;Çò< 
	`vec_Àn
 (
this_vlib_maö
->
node_maö
.
nodes
);Çi++)

235 
n
 = 
	`vlib_gë_node
 (
this_vlib_maö
, 
ni
);

236 
code
 = 0; codê< 
n
->
n_îr‹s
; code++)

238 
i
 = 
n
->
îr‹_hóp_ödex
 + 
code
;

239 
c
 = 
em
->
cou¡îs
[
i
];

240 i‡(
i
 < 
	`vec_Àn
 (
em
->
cou¡îs_œ°_˛ór
))

241 
c
 -
em
->
cou¡îs_œ°_˛ór
[
i
];

242 
sums
[
i
] +
c
;

244 i‡(
c
 =0 && 
vîbo£
 < 2)

247 i‡(
vîbo£
)

248 
	`vlib_˛i_ouçut
 (
vm
, "%10Ld%=40v%=20s%=6d", 
c
, 
n
->
«me
,

249 
em
->
îr‹_°rögs_hóp
[
i
], i);

251 
	`vlib_˛i_ouçut
 (
vm
, "%10d%=40v%s", 
c
, 
n
->
«me
,

252 
em
->
îr‹_°rögs_hóp
[
i
]);

255 
ödex
++;

259 i‡(
vîbo£
)

260 
	`vlib_˛i_ouçut
 (
vm
, "Total:");

262 
ni
 = 0;Çò< 
	`vec_Àn
 (
vm
->
node_maö
.
nodes
);Çi++)

264 
n
 = 
	`vlib_gë_node
 (
vm
, 
ni
);

265 
code
 = 0; codê< 
n
->
n_îr‹s
; code++)

267 
i
 = 
n
->
îr‹_hóp_ödex
 + 
code
;

268 i‡(
sums
[
i
])

270 i‡(
vîbo£
)

271 
	`vlib_˛i_ouçut
 (
vm
, "%10Ld%=40v%=20s%=10d", 
sums
[
i
], 
n
->
«me
,

272 
em
->
îr‹_°rögs_hóp
[
i
], i);

277 
	`vec_‰ì
 (
sums
);

280 
	}
}

283 
VLIB_CLI_COMMAND
 (
vlib_˛i_show_îr‹s
) = {

284 .
∑th
 = "showÉrrors",

285 .
	gsh‹t_hñp
 = "ShowÉrror counts",

286 .
	gfun˘i⁄
 = 
show_îr‹s
,

291 
VLIB_CLI_COMMAND
 (
˛i_show_node_cou¡îs
, ) = {

292 .
∑th
 = "showÇode counters",

293 .
	gsh‹t_hñp
 = "ShowÇode counters",

294 .
	gfun˘i⁄
 = 
show_îr‹s
,

298 
˛ib_îr‹_t
 *

299 
	$˛ór_îr‹_cou¡îs
 (
vlib_maö_t
 * 
vm
,

300 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

302 
vlib_îr‹_maö_t
 *
em
;

303 
u32
 
i
;

306 
	`f‹óch_vlib_maö
(({

307 
em
 = &
this_vlib_maö
->
îr‹_maö
;

308 
	`vec_vÆid©e
 (
em
->
cou¡îs_œ°_˛ór
, 
	`vec_Àn
 (em->
cou¡îs
) - 1);

309 
i
 = 0; i < 
	`vec_Àn
 (
em
->
cou¡îs
); i++)

310 
em
->
cou¡îs_œ°_˛ór
[
i
] =Ém->
cou¡îs
[i];

314 
	}
}

317 
VLIB_CLI_COMMAND
 (
˛i_˛ór_îr‹_cou¡îs
, ) = {

318 .
∑th
 = "clearÉrrors",

319 .
	gsh‹t_hñp
 = "ClearÉrror counters",

320 .
	gfun˘i⁄
 = 
˛ór_îr‹_cou¡îs
,

325 
VLIB_CLI_COMMAND
 (
˛i_˛ór_node_cou¡îs
, ) = {

326 .
∑th
 = "clearÇode counters",

327 .
	gsh‹t_hñp
 = "ClearÇode counters",

328 .
	gfun˘i⁄
 = 
˛ór_îr‹_cou¡îs
,

	@error.h

40 #i‚de‡
ö˛uded_vlib_îr‹_h


41 
	#ö˛uded_vlib_îr‹_h


	)

44 
u32
 
	tvlib_îr‹_t
;

46 
Æways_ölöe
 
u32


47 
	$vlib_îr‹_gë_node
 (
vlib_îr‹_t
 
e
)

49  
e
 >> 12;

50 
	}
}

52 
Æways_ölöe
 
u32


53 
	$vlib_îr‹_gë_code
 (
vlib_îr‹_t
 
e
)

55  
e
 & 0xfff;

56 
	}
}

58 
Æways_ölöe
 
vlib_îr‹_t


59 
	$vlib_îr‹_£t
 (
u32
 
node_ödex
, u32 
code
)

61 
	`ASSERT
 (
node_ödex
 < (1 << 20));

62 
	`ASSERT
 (
code
 < (1 << 12));

63  (
node_ödex
 << 12Ë| 
code
;

64 
	}
}

66 
Æways_ölöe
 
vlib_îr‹_t


67 
	$vlib_îr‹_£t_code
 (
vlib_îr‹_t
 
e
, 
u32
 
code
)

69 
	`ASSERT
 (
	`vlib_îr‹_gë_code
 (
e
) == 0);

70 
	`ASSERT
 (
code
 < (1 << 12));

71 
e
 |
code
;

72  
e
;

73 
	}
}

78 
u64
 *
	mcou¡îs
;

81 
u64
 *
	mcou¡îs_œ°_˛ór
;

85 **
	mîr‹_°rögs_hóp
;

86 } 
	tvlib_îr‹_maö_t
;

89 
vlib_ªgi°î_îr‹s
 (
vlib_maö_t
 *
vm
,

90 
u32
 
node_ödex
,

91 
u32
 
n_îr‹s
, *
îr‹_°rögs
[]);

	@error_funcs.h

40 #i‚de‡
ö˛uded_vlib_îr‹_funcs_h


41 
	#ö˛uded_vlib_îr‹_funcs_h


	)

43 
	~<vlib/node_funcs.h
>

45 
Æways_ölöe
 

46 
	$vlib_îr‹_ñog_cou¡
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
cou¡î
, uw‹d 
ö¸emít
)

48 i‡(
VLIB_ELOG_MAIN_LOOP
 > 0 && 
ö¸emít
 > 0)

50 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

51 
	`ñog
 (
em
, 
	`vec_ñt_©_ödex
 (
vm
->
îr‹_ñog_evít_ty≥s
, 
cou¡î
),

52 
ö¸emít
);

54 
	}
}

56 
Æways_ölöe
 

57 
	$vlib_îr‹_cou¡
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

58 
uw‹d
 
cou¡î
, uw‹d 
ö¸emít
)

60 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

61 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

63 
	`ASSERT
 (
cou¡î
 < 
n
->
n_îr‹s
);

64 
cou¡î
 +
n
->
îr‹_hóp_ödex
;

66 
	`ASSERT
 (
cou¡î
 < 
	`vec_Àn
 (
em
->
cou¡îs
));

67 
em
->
cou¡îs
[
cou¡î
] +
ö¸emít
;

69 
	`vlib_îr‹_ñog_cou¡
 (
vm
, 
cou¡î
, 
ö¸emít
);

70 
	}
}

73 
uw‹d


74 
vlib_îr‹_dr›_buf„rs
 (
vlib_maö_t
 * 
vm
,

75 
vlib_node_ru¡ime_t
 * 
node
,

76 
u32
 * 
buf„rs
,

77 
u32
 
√xt_buf„r_°ride
,

78 
u32
 
n_buf„rs
,

79 
u32
 
îr‹_√xt_ödex
,

80 
u32
 
îr‹_node
, u32 
îr‹_code
);

	@format.c

40 
	~<vlib/vlib.h
>

42 
u8
 *

43 
	$f‹m©_vlib_rx_tx
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

45 
vlib_rx_‹_tx_t
 
r
 = 
	`va_¨g
 (*
¨gs
, vlib_rx_or_tx_t);

46 *
t
;

48 
r
)

50 
VLIB_RX
:

51 
t
 = "rx";

53 
VLIB_TX
:

54 
t
 = "tx";

57 
t
 = "INVALID";

61 
	`vec_add
 (
s
, 
t
, 
	`°æí
 (t));

62  
s
;

63 
	}
}

65 
u8
 *

66 
	$f‹m©_vlib_ªad_wrôe
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

68 
vlib_rx_‹_tx_t
 
r
 = 
	`va_¨g
 (*
¨gs
, vlib_rx_or_tx_t);

69 *
t
;

71 
r
)

73 
VLIB_READ
:

74 
t
 = "read";

76 
VLIB_WRITE
:

77 
t
 = "write";

80 
t
 = "INVALID";

84 
	`vec_add
 (
s
, 
t
, 
	`°æí
 (t));

85  
s
;

86 
	}
}

89 
u8
 *

90 
	$f‹m©_vlib_buf„r_d©a
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

92 
u8
 *
d©a
 = 
	`va_¨g
 (*
¨gs
, u8 *);

93 
u32
 
n_d©a_byãs
 = 
	`va_¨g
 (*
¨gs
, u32);

94 
u32
 
i
, 
is_¥öèbÀ
;

96 
is_¥öèbÀ
 = 1;

97 
i
 = 0; i < 
n_d©a_byãs
 && 
is_¥öèbÀ
; i++)

99 
u8
 
c
 = 
d©a
[
i
];

100 i‡(
c
 < 0x20)

101 
is_¥öèbÀ
 = 0;

102 i‡(
c
 >= 0x7f)

103 
is_¥öèbÀ
 = 0;

106 i‡(
is_¥öèbÀ
)

107 
	`vec_add
 (
s
, 
d©a
, 
n_d©a_byãs
);

109 
s
 = 
	`f‹m©
 (s, "%U", 
f‹m©_hex_byãs
, 
d©a
, 
n_d©a_byãs
);

111  
s
;

112 
	}
}

115 
uw‹d


116 
	$unf‹m©_vlib_íabÀ_dißbÀ
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

118 *
ªsu…
 = 
	`va_¨g
 (*
¨gs
, *);

119 
íabÀ
;

121 i‡(
	`unf‹m©
 (
öput
, "enable") || unformat (input, "on"))

122 
íabÀ
 = 1;

123 i‡(
	`unf‹m©
 (
öput
, "disable") || unformat (input, "off"))

124 
íabÀ
 = 0;

128 *
ªsu…
 = 
íabÀ
;

130 
	}
}

133 
uw‹d


134 
	$unf‹m©_vlib_rx_tx
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

136 *
ªsu…
 = 
	`va_¨g
 (*
¨gs
, *);

137 i‡(
	`unf‹m©
 (
öput
, "rx"))

138 *
ªsu…
 = 
VLIB_RX
;

139 i‡(
	`unf‹m©
 (
öput
, "tx"))

140 *
ªsu…
 = 
VLIB_TX
;

144 
	}
}

147 
uw‹d


148 
	$unf‹m©_vlib_numbî
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

150 *
ªsu…
 = 
	`va_¨g
 (*
¨gs
, *);

152  (
	`unf‹m©
 (
öput
, "0x%x", 
ªsu…
) || unformat (input, "%d",Ñesult));

153 
	}
}

156 
uw‹d


157 
	$unf‹m©_vlib_numbî_by_«me
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

159 
uw‹d
 *
hash
 = 
	`va_¨g
 (*
¨gs
, uword *);

160 *
ªsu…
 = 
	`va_¨g
 (*
¨gs
, *);

161 
uw‹d
 *
p
;

162 
u8
 *
tokí
;

163 
i
;

165 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_tokí
, "a-zA-Z0-9_", &
tokí
))

169 i‡(
	`vec_Àn
 (
tokí
) > 0 &&Åoken[vec_len (token) - 1] != 0)

170 
	`vec_add1
 (
tokí
, 0);

173 
p
 = 
	`hash_gë_mem
 (
hash
, 
tokí
);

174 i‡(
p
)

175 
d⁄e
;

178 
i
 = 0; i < 
	`vec_Àn
 (
tokí
); i++)

179 i‡(
tokí
[
i
] >= 'a' &&Åoken[i] <= 'z')

180 
tokí
[
i
] = 'A' +Åoken[i] - 'a';

181 
p
 = 
	`hash_gë_mem
 (
hash
, 
tokí
);

183 
d⁄e
:

184 
	`vec_‰ì
 (
tokí
);

185 i‡(
p
)

186 *
ªsu…
 = 
p
[0];

187  
p
 != 0;

188 
	}
}

	@format_funcs.h

40 #i‚de‡
ö˛uded_vlib_f‹m©_h


41 
	#ö˛uded_vlib_f‹m©_h


	)

44 
u8
 *
f‹m©_vlib_rx_tx
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

45 
u8
 *
f‹m©_vlib_ªad_wrôe
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

48 
u8
 *
f‹m©_vlib_buf„r_d©a
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

51 
uw‹d
 
unf‹m©_vlib_íabÀ_dißbÀ
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

54 
uw‹d
 
unf‹m©_vlib_rx_tx
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

57 
uw‹d
 
unf‹m©_vlib_numbî_by_«me
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

60 
uw‹d
 
unf‹m©_vlib_numbî
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

65 
	#FORMAT_VLIB_HEADER_NO_RECURSION
 (~0)

	)

	@global_funcs.h

19 #i‚de‡
ö˛uded_vlib_globÆ_funcs_h_


20 
	#ö˛uded_vlib_globÆ_funcs_h_


	)

22 
Æways_ölöe
 
vlib_maö_t
 *

23 
	$vlib_gë_maö
 ()

25 
vlib_maö_t
 *
vm
;

26 
vm
 = 
vlib_maös
[
	`vlib_gë_thªad_ödex
 ()];

27 
	`ASSERT
 (
vm
);

28  
vm
;

29 
	}
}

31 
Æways_ölöe
 
vlib_thªad_maö_t
 *

32 
	$vlib_gë_thªad_maö
 ()

34  &
vlib_thªad_maö
;

35 
	}
}

	@i2c.c

16 
	~<vlib/vlib.h
>

17 
	~<vlib/i2c.h
>

19 
ölöe
 

20 
	$i2c_dñay
 (
i2c_bus_t
 * 
b
, 
f64
 
timeout
)

22 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

23 
	`vlib_time_waô
 (
vm
, 
timeout
);

24 
	}
}

27 
	$i2c_waô_f‹_s˛
 (
i2c_bus_t
 * 
b
)

29 
f64
 
t
 = 0;

31 
t
 < 
b
->
hﬁd_time
)

33 
sda
, 
s˛
;

34 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

35 
b
->
	`gë_bôs
 (b, &
s˛
, &
sda
);

37 i‡(
s˛
)

40 
t
 +
b
->
ri£_ÁŒ_time
;

42 
b
->
timeout
 = 1;

43 
	}
}

46 
	$i2c_°¨t
 (
i2c_bus_t
 * 
b
)

48 
b
->
timeout
 = 0;

50 
b
->
	`put_bôs
 (b, 1, 1);

51 
	`i2c_waô_f‹_s˛
 (
b
);

53 i‡(
	`vlib_i2c_bus_timed_out
 (
b
))

56 
b
->
	`put_bôs
 (b, 1, 0);

57 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

58 
b
->
	`put_bôs
 (b, 0, 0);

59 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

60 
	}
}

63 
	$i2c_°›
 (
i2c_bus_t
 * 
b
)

65 
b
->
	`put_bôs
 (b, 0, 0);

66 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

68 
b
->
	`put_bôs
 (b, 1, 0);

69 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

71 
b
->
	`put_bôs
 (b, 1, 1);

72 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

73 
	}
}

76 
	$i2c_wrôe_bô
 (
i2c_bus_t
 * 
b
, 
sda
)

78 
b
->
	`put_bôs
 (b, 0, 
sda
);

79 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

81 
b
->
	`put_bôs
 (b, 1, 
sda
);

82 
	`i2c_waô_f‹_s˛
 (
b
);

83 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

85 
b
->
	`put_bôs
 (b, 0, 
sda
);

86 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

87 
	}
}

90 
	$i2c_ªad_bô
 (
i2c_bus_t
 * 
b
, *
sda
)

92 
s˛
;

94 
b
->
	`put_bôs
 (b, 1, 1);

95 
	`i2c_waô_f‹_s˛
 (
b
);

96 
	`i2c_dñay
 (
b
, b->
hﬁd_time
);

98 
b
->
	`gë_bôs
 (b, &
s˛
, 
sda
);

100 
b
->
	`put_bôs
 (b, 0, 1);

101 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

102 
	}
}

105 
	$i2c_wrôe_byã
 (
i2c_bus_t
 * 
b
, 
u8
 
d©a
)

107 
i
, 
sda
;

109 
i
 = 7; i >= 0; i--)

111 
	`i2c_wrôe_bô
 (
b
, (
d©a
 >> 
i
) & 1);

112 i‡(
b
->
timeout
)

116 
b
->
	`put_bôs
 (b, 0, 1);

117 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

119 
	`i2c_ªad_bô
 (
b
, &
sda
);

121 i‡(
sda
)

122 
b
->
timeout
 = 1;

123 
	}
}

127 
	$i2c_ªad_byã
 (
i2c_bus_t
 * 
b
, 
u8
 * 
d©a
, 
ack
)

129 
i
, 
sda
;

131 *
d©a
 = 0;

133 
b
->
	`put_bôs
 (b, 0, 1);

134 
	`i2c_dñay
 (
b
, b->
ri£_ÁŒ_time
);

136 
i
 = 7; i >= 0; i--)

138 
	`i2c_ªad_bô
 (
b
, &
sda
);

139 i‡(
b
->
timeout
)

142 *
d©a
 |(
sda
 !0Ë<< 
i
;

145 
	`i2c_wrôe_bô
 (
b
, 
ack
 == 0);

146 
	}
}

150 
	$vlib_i2c_öô
 (
i2c_bus_t
 * 
b
)

152 
f64
 
tick
;

153 i‡(!
b
->
˛ock
)

154 
b
->
˛ock
 = 400000;

156 
tick
 = 1.0 / 
b
->
˛ock
;

159 i‡(!
b
->
hﬁd_time
)

160 
b
->
hﬁd_time
 = 0.4 * 
tick
;

163 i‡(!
b
->
ri£_ÁŒ_time
)

164 
b
->
ri£_ÁŒ_time
 = 0.1 * 
tick
;

165 
	}
}

168 
	$vlib_i2c_x„r
 (
i2c_bus_t
 * 
bus
, 
i2c_msg_t
 * 
msgs
)

170 
i2c_msg_t
 *
msg
;

171 
i
;

173 
	`vec_f‹óch
 (
msg
, 
msgs
)

175 
	`i2c_°¨t
 (
bus
);

176 
	`i2c_wrôe_byã
 (
bus
,

177 (
msg
->
addr
 << 1Ë+ (msg->
Êags
 =
I2C_MSG_FLAG_READ
));

179 i‡(
msg
->
Êags
 & 
I2C_MSG_FLAG_READ
)

180 
i
 = 0; i < 
msg
->
Àn
; i++)

182 
	`i2c_ªad_byã
 (
bus
, &
msg
->
buf„r
[
i
], i + 1 !msg->
Àn
);

183 i‡(
bus
->
timeout
)

184 
d⁄e
;

188 
i
 = 0; i < 
msg
->
Àn
; i++)

190 
	`i2c_wrôe_byã
 (
bus
, 
msg
->
buf„r
[
i
]);

191 i‡(
bus
->
timeout
)

192 
d⁄e
;

196 
d⁄e
:

197 
	`i2c_°›
 (
bus
);

198 
	}
}

201 
	$vlib_i2c_ªad_ì¥om
 (
i2c_bus_t
 * 
bus
, 
u8
 
i2c_addr
, 
u16
 
°¨t_addr
,

202 
u16
 
Àngth
, 
u8
 * 
d©a
)

204 
i2c_msg_t
 *
msg
 = 0;

205 
u8
 
°¨t_addªss
[1];

207 
	`vec_vÆid©e
 (
msg
, 1);

209 
°¨t_addªss
[0] = 
°¨t_addr
;

210 
msg
[0].
addr
 = 
i2c_addr
;

211 
msg
[0].
Êags
 = 
I2C_MSG_FLAG_WRITE
;

212 
msg
[0].
buf„r
 = (
u8
 *Ë& 
°¨t_addªss
;

213 
msg
[0].
Àn
 = 1;

215 
msg
[1].
addr
 = 
i2c_addr
;

216 
msg
[1].
Êags
 = 
I2C_MSG_FLAG_READ
;

217 
msg
[1].
buf„r
 = 
d©a
;

218 
msg
[1].
Àn
 = 
Àngth
;

220 
	`vlib_i2c_x„r
 (
bus
, 
msg
);

222 
	`vec_‰ì
 (
msg
);

223 
	}
}

	@i2c.h

16 #i‚de‡
ö˛uded_vlib_i2c_h


17 
	#ö˛uded_vlib_i2c_h


	)

19 
	~<vµö‰a/ty≥s.h
>

22 
	#I2C_MSG_FLAG_WRITE
 0

	)

23 
	#I2C_MSG_FLAG_READ
 1

	)

27 
u8
 
	maddr
;

28 
u8
 
	mÊags
;

29 
u16
 
	mÀn
;

30 
u8
 *
	mbuf„r
;

31 } 
	ti2c_msg_t
;

33 
	si2c_bus_t


35 (*
	mput_bôs
Ë(
i2c_bus_t
 * 
	mb
, 
	ms˛
, 
	msda
);

36 (*
	mgë_bôs
Ë(
i2c_bus_t
 * 
	mb
, *
	ms˛
, *
	msda
);

38 
	mtimeout
;

39 
u32
 
	m˛ock
;

40 
f64
 
	mhﬁd_time
;

41 
f64
 
	mri£_ÁŒ_time
;

44 
uw‹d
 
	m¥iv©e_d©a
;

46 } 
	ti2c_bus_t
;

48 
vlib_i2c_öô
 (
i2c_bus_t
 * 
bus
);

49 
vlib_i2c_x„r
 (
i2c_bus_t
 * 
bus
, 
i2c_msg_t
 * 
msgs
);

50 
vlib_i2c_ªad_ì¥om
 (
i2c_bus_t
 * 
bus
, 
u8
 
i2c_addr
, 
u16
 
°¨t_addr
,

51 
u16
 
Àngth
, 
u8
 * 
d©a
);

53 
ölöe
 

54 
	$vlib_i2c_bus_timed_out
 (
i2c_bus_t
 * 
bus
)

56  
bus
->
timeout
;

57 
	}
}

	@init.c

40 
	~<vlib/vlib.h
>

42 
˛ib_îr‹_t
 *

43 
	$vlib_ˇŒ_öô_exô_fun˘i⁄s
 (
vlib_maö_t
 * 
vm
,

44 
_vlib_öô_fun˘i⁄_li°_ñt_t
 * 
hód
,

45 
ˇŒ_⁄˚
)

47 
˛ib_îr‹_t
 *
îr‹
 = 0;

48 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
i
;

50 
i
 = 
hód
;

51 
i
)

53 i‡(
ˇŒ_⁄˚
 && !
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
i
->
f
))

55 i‡(
ˇŒ_⁄˚
)

56 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
i
->
f
);

57 
îr‹
 = 
i
->
	`f
 (
vm
);

58 i‡(
îr‹
)

59  
îr‹
;

61 
i
 = i->
√xt_öô_fun˘i⁄
;

63  
îr‹
;

64 
	}
}

66 
˛ib_îr‹_t
 *

67 
	$vlib_ˇŒ_Æl_öô_fun˘i⁄s
 (
vlib_maö_t
 * 
vm
)

71 
	#_
(
f
Ë
vlib_
##f##
	`_ª„ªn˚
 ();

	)

72 
f‹óch_vlib_moduÀ_ª„ªn˚
;

73 #unde‡
_


75  
vlib_ˇŒ_öô_exô_fun˘i⁄s


76 (
vm
, vm->
öô_fun˘i⁄_ªgi°øti⁄s
, 1 );

77 
	}
}

79 
˛ib_îr‹_t
 *

80 
	$vlib_ˇŒ_Æl_maö_lo›_íãr_fun˘i⁄s
 (
vlib_maö_t
 * 
vm
)

82  
vlib_ˇŒ_öô_exô_fun˘i⁄s


83 (
vm
, vm->
maö_lo›_íãr_fun˘i⁄_ªgi°øti⁄s
, 1 );

84 
	}
}

86 
˛ib_îr‹_t
 *

87 
	$vlib_ˇŒ_Æl_maö_lo›_exô_fun˘i⁄s
 (
vlib_maö_t
 * 
vm
)

89  
vlib_ˇŒ_öô_exô_fun˘i⁄s


90 (
vm
, vm->
maö_lo›_exô_fun˘i⁄_ªgi°øti⁄s
, 1 );

91 
	}
}

93 
˛ib_îr‹_t
 *

94 
	$vlib_ˇŒ_Æl_c⁄fig_fun˘i⁄s
 (
vlib_maö_t
 * 
vm
,

95 
unf‹m©_öput_t
 * 
öput
, 
is_óæy
)

97 
˛ib_îr‹_t
 *
îr‹
 = 0;

98 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 *
c
, **
Æl
;

99 
uw‹d
 *
hash
 = 0, *
p
;

100 
uw‹d
 
i
;

102 
hash
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

103 
Æl
 = 0;

105 
c
 = 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
;

107 
c
)

109 
	`hash_£t_mem
 (
hash
, 
c
->
«me
, 
	`vec_Àn
 (
Æl
));

110 
	`vec_add1
 (
Æl
, 
c
);

111 
	`unf‹m©_öô
 (&
c
->
öput
, 0, 0);

112 
c
 = c->
√xt_ªgi°øti⁄
;

115 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

117 
u8
 *
s
, *
v
;

119 i‡(!
	`unf‹m©
 (
öput
, "%†%v", &
s
, &
v
Ë|| !(
p
 = 
	`hash_gë_mem
 (
hash
, s)))

121 
îr‹
 = 
	`˛ib_îr‹_¸óã
 ("unknow¿öpuà`%†%v'", 
s
, 
v
);

122 
d⁄e
;

125 
c
 = 
Æl
[
p
[0]];

126 i‡(
	`vec_Àn
 (
c
->
öput
.
buf„r
) > 0)

127 
	`vec_add1
 (
c
->
öput
.
buf„r
, ' ');

128 
	`vec_add
 (
c
->
öput
.
buf„r
, 
v
, 
	`vec_Àn
 (v));

129 
	`vec_‰ì
 (
v
);

130 
	`vec_‰ì
 (
s
);

133 
i
 = 0; i < 
	`vec_Àn
 (
Æl
); i++)

135 
c
 = 
Æl
[
i
];

138 i‡(
is_óæy
 ^ 
c
->is_early)

142 i‡(
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
c
->
fun˘i⁄
))

144 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
c
->
fun˘i⁄
);

146 
îr‹
 = 
c
->
	`fun˘i⁄
 (
vm
, &c->
öput
);

147 i‡(
îr‹
)

148 
d⁄e
;

151 
d⁄e
:

152 
i
 = 0; i < 
	`vec_Àn
 (
Æl
); i++)

154 
c
 = 
Æl
[
i
];

155 
	`unf‹m©_‰ì
 (&
c
->
öput
);

157 
	`vec_‰ì
 (
Æl
);

158 
	`hash_‰ì
 (
hash
);

159  
îr‹
;

160 
	}
}

	@init.h

40 #i‚de‡
ö˛uded_vlib_öô_h


41 
	#ö˛uded_vlib_öô_h


	)

43 
	~<vµö‰a/îr‹.h
>

44 
	~<vµö‰a/f‹m©.h
>

45 
	~<vµö‰a/hash.h
>

51 
	g˛ib_îr‹_t
 *(
	tvlib_öô_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
);

53 
	s_vlib_öô_fun˘i⁄_li°_ñt


55 
_vlib_öô_fun˘i⁄_li°_ñt
 *
	m√xt_öô_fun˘i⁄
;

56 
vlib_öô_fun˘i⁄_t
 *
	mf
;

57 } 
	t_vlib_öô_fun˘i⁄_li°_ñt_t
;

61 
	g˛ib_îr‹_t
 *(
	tvlib_c⁄fig_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

62 
	tunf‹m©_öput_t
 * 
	töput
);

64 
	svlib_c⁄fig_fun˘i⁄_ru¡ime_t


67 
vlib_c⁄fig_fun˘i⁄_t
 *
	mfun˘i⁄
;

70 
unf‹m©_öput_t
 
	möput
;

73 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 *
	m√xt_ªgi°øti⁄
;

76 
u8
 
	mis_óæy
;

79 
	m«me
[32];

80 } 
	tvlib_c⁄fig_fun˘i⁄_ru¡ime_t
;

82 
	#_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
ty≥
) \

83 
_vlib_
##
ty≥
##
_fun˘i⁄_
##
x


	)

85 
	#VLIB_INIT_FUNCTION_SYMBOL
(
x
) \

86 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
öô
)

	)

87 
	#VLIB_MAIN_LOOP_ENTER_FUNCTION_SYMBOL
(
x
) \

88 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
maö_lo›_íãr
)

	)

89 
	#VLIB_MAIN_LOOP_EXIT_FUNCTION_SYMBOL
(
x
) \

90 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
maö_lo›_exô
)

	)

91 
	#VLIB_CONFIG_FUNCTION_SYMBOL
(
x
) \

92 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
c⁄fig
)

	)

97 
	#VLIB_DECLARE_INIT_FUNCTION
(
x
, 
èg
) \

98 
vlib_öô_fun˘i⁄_t
 * 
	`_VLIB_INIT_FUNCTION_SYMBOL
 (
x
, 
èg
) = x; \

99 
__vlib_add_
##
èg
##
_fun˘i⁄_
##
	`x
 () \

100 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

101 
__vlib_add_
##
èg
##
_fun˘i⁄_
##
	`x
 () \

103 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

104 
_vlib_öô_fun˘i⁄_li°_ñt_t
 
_vlib_öô_fun˘i⁄
; \

105 
_vlib_öô_fun˘i⁄
.
√xt_öô_fun˘i⁄
 \

106 
vm
->
èg
##
_fun˘i⁄_ªgi°øti⁄s
; \

107 
vm
->
èg
##
_fun˘i⁄_ªgi°øti⁄s
 = &
_vlib_öô_fun˘i⁄
; \

108 
_vlib_öô_fun˘i⁄
.
f
 = &
x
; \

109 }

	)

111 
	#VLIB_INIT_FUNCTION
(
x
Ë
	`VLIB_DECLARE_INIT_FUNCTION
(x,
öô
)

	)

112 
	#VLIB_WORKER_INIT_FUNCTION
(
x
Ë
	`VLIB_DECLARE_INIT_FUNCTION
(x,
w‹kî_öô
)

	)

114 
	#VLIB_MAIN_LOOP_ENTER_FUNCTION
(
x
) \

115 
	`VLIB_DECLARE_INIT_FUNCTION
(
x
,
maö_lo›_íãr
)

	)

116 
	#VLIB_MAIN_LOOP_EXIT_FUNCTION
(
x
) \

117 
	`VLIB_DECLARE_INIT_FUNCTION
(
x
,
maö_lo›_exô
)

	)

119 
	#VLIB_CONFIG_FUNCTION
(
x
,
n
,...) \

120 
__VA_ARGS__
 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

121 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

122 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

123 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

124 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

126 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

127 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
).
√xt_ªgi°øti⁄
 \

128 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
; \

129 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
 \

130 &
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

132 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

133 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
) \

135 .
«me
 = 
n
, \

136 .
fun˘i⁄
 = 
x
, \

137 .
is_óæy
 = 0, \

138 }

	)

140 
	#VLIB_EARLY_CONFIG_FUNCTION
(
x
,
n
,...) \

141 
__VA_ARGS__
 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

142 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

143 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

144 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

145 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

147 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

148 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
).
√xt_ªgi°øti⁄
 \

149 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
; \

150 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
 \

151 &
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

153 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

154 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
) \

156 .
«me
 = 
n
, \

157 .
fun˘i⁄
 = 
x
, \

158 .
is_óæy
 = 1, \

159 }

	)

162 
	#vlib_ˇŒ_öô_fun˘i⁄
(
vm
, 
x
) \

164 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

165 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

166 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

167 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

169 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

170 
_îr‹
 = 
	`_f
 (
vm
); \

172 
_îr‹
; \

173 })

	)

176 
	#vlib_m¨k_öô_fun˘i⁄_com∂ëe
(
vm
, 
x
) \

178 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

179 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

180 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

181 })

	)

183 
	#vlib_ˇŒ_po°_gøph_öô_fun˘i⁄
(
vm
, 
x
) \

185 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_POST_GRAPH_INIT_FUNCTION_SYMBOL
 (
x
); \

186 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_POST_GRAPH_INIT_FUNCTION_SYMBOL
 (
x
); \

187 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

188 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

190 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

191 
_îr‹
 = 
	`_f
 (
vm
); \

193 
_îr‹
; \

194 })

	)

196 
	#vlib_ˇŒ_c⁄fig_fun˘i⁄
(
vm
, 
x
) \

198 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 * 
_r
; \

199 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

200 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

201 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
); \

203 
_r
 = &
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
); \

204 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_r
->
fun˘i⁄
)) \

206 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_r
->
fun˘i⁄
); \

207 
_îr‹
 = 
_r
->
	`fun˘i⁄
 (
vm
, &_r->
öput
); \

209 
_îr‹
; \

210 })

	)

213 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_öô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
);

214 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_c⁄fig_fun˘i⁄s
 (
vlib_maö_t
 *
vm
,

215 
unf‹m©_öput_t
 * 
öput
,

216 
is_óæy
);

217 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_maö_lo›_íãr_fun˘i⁄s
 (
vlib_maö_t


218 *
vm
);

219 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_maö_lo›_exô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
);

220 
˛ib_îr‹_t
 *
vlib_ˇŒ_öô_exô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
,

221 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *

222 
hód
, 
ˇŒ_⁄˚
);

224 
	#f‹óch_vlib_moduÀ_ª„ªn˚
 \

225 
	`_
 (
node_˛i
) \

226 
	`_
 (
åa˚_˛i
)

	)

229 
	#_
(
x
Ë
vlib_
##x##
	`_ª„ªn˚
 ();

	)

230 
	gf‹óch_vlib_moduÀ_ª„ªn˚


231 #unde‡
_


	@lex.c

15 
	~<vlib/vlib.h
>

16 
	~<vlib/Àx.h
>

18 
vlib_Àx_maö_t
 
	gvlib_Àx_maö
;

20 
	#LEX_DEBUG
 0

	)

22 
u8
 *

23 
	$f‹m©_vlib_Àx_tokí
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

25 
vlib_Àx_maö_t
 *
lm
 = 
	`va_¨g
 (*
¨gs
, vlib_lex_main_t *);

26 
vlib_Àx_tokí_t
 *
t
 = 
	`va_¨g
 (*
¨gs
, vlib_lex_token_t *);

28 i‡(
t
->
tokí
 =
VLIB_LEX_w‹d
)

29 
s
 = 
	`f‹m©
 (s, "%s", 
t
->
vÆue
.
as_poöãr
);

31 
s
 = 
	`f‹m©
 (s, "%s", 
lm
->
Àx_tokí_«mes
[
t
->
tokí
]);

32  
s
;

33 
	}
}

36 
	$vlib_Àx_gë_tokí
 (
vlib_Àx_maö_t
 * 
lm
, 
vlib_Àx_tokí_t
 * 
rv
)

38 
u8
 
c
;

39 
vlib_Àx_èbÀ_t
 *
t
;

40 
vlib_Àx_èbÀ_íåy_t
 *
e
;

41 
uw‹d
 
tv
;

43 i‡(
	`PREDICT_FALSE
 (
lm
->
pushback_•
 >= 0))

45 
rv
[0] = 
lm
->
pushback_ve˘‹
[lm->
pushback_•
--];

49 
rv
->
vÆue
.
as_uw‹d
 = ~0;

53 i‡(
	`PREDICT_FALSE
 (
lm
->
cuºít_ödex
 >
	`vec_Àn
 (lm->
öput_ve˘‹
)))

55 
rv
->
tokí
 = 
VLIB_LEX_eof
;

59 
t
 = 
	`vec_ñt_©_ödex
 (
lm
->
Àx_èbÀs
,Üm->
cuºít_èbÀ_ödex
);

60 
c
 = (
lm
->
öput_ve˘‹
[lm->
cuºít_ödex
++]) & 0x7f;

61 
e
 = &
t
->
íåõs
[
c
];

62 
lm
->
cuºít_èbÀ_ödex
 = 
e
->
√xt_èbÀ_ödex
;

64 
e
->
a˘i⁄
)

66 
VLIB_LEX_IGNORE
:

69 
VLIB_LEX_START_NUMBER
:

70 
lm
->
cuºít_tokí_vÆue
 = 0;

73 
VLIB_LEX_ADD_TO_NUMBER
:

74 
lm
->
cuºít_numbî_ba£
 = 
e
->
tokí
;

75 
lm
->
cuºít_tokí_vÆue
 *lm->
cuºít_numbî_ba£
;

76 
tv
 = 
c
 - '0';

77 i‡(
tv
 >
lm
->
cuºít_numbî_ba£
)

79 
tv
 = 10 + 
c
 - 'A';

80 i‡(
tv
 >
lm
->
cuºít_numbî_ba£
)

81 
tv
 = 10 + 
c
 - 'a';

83 
lm
->
cuºít_tokí_vÆue
 +
tv
;

86 
VLIB_LEX_ADD_TO_TOKEN
:

87 
	`vec_add1
 (
lm
->
tokí_buf„r
, 
c
);

90 
VLIB_LEX_KEYWORD_CHECK
:

92 
uw‹d
 *
p
;

94 
	`vec_add1
 (
lm
->
tokí_buf„r
, 0);

97 
p
 = 
	`hash_gë_mem
 (
lm
->
Àx_keyw‹ds
,Üm->
tokí_buf„r
);

98 i‡(
p
)

100 
rv
->
tokí
 = 
p
[0];

101 i‡(
LEX_DEBUG
 > 0)

102 
	`˛ib_w¨nög
 ("keyword '%s'Åoken %s",

103 
lm
->
tokí_buf„r
,

104 
lm
->
Àx_tokí_«mes
[
rv
->
tokí
]);

109 
rv
->
tokí
 = 
VLIB_LEX_w‹d
;

110 
rv
->
vÆue
.
as_poöãr
 = 
	`vec_dup
 (
lm
->
tokí_buf„r
);

111 i‡(
LEX_DEBUG
 > 0)

112 
	`˛ib_w¨nög
 ("%s, value '%s'",

113 
lm
->
Àx_tokí_«mes
[
VLIB_LEX_w‹d
],

114 
rv
->
vÆue
.
as_poöãr
);

116 
	`_vec_Àn
 (
lm
->
tokí_buf„r
) = 0;

119 
lm
->
cuºít_ödex
--;

123 
VLIB_LEX_RETURN_AND_RESCAN
:

124 
	`ASSERT
 (
lm
->
cuºít_ödex
);

125 
lm
->
cuºít_ödex
--;

128 
VLIB_LEX_RETURN
:

129 
rv
->
tokí
 = 
e
->token;

130 
rv
->
vÆue
.
as_uw‹d
 = 
lm
->
cuºít_tokí_vÆue
;

131 
lm
->
cuºít_tokí_vÆue
 = ~0;

132 i‡(
LEX_DEBUG
 > 0)

134 
˛ib_w¨nög


136 
t
->
«me
, 
c
, c, 
lm
->
Àx_èbÀs
[
e
->
√xt_èbÀ_ödex
].name,

137 
lm
->
Àx_tokí_«mes
[
e
->
tokí
]);

138 i‡(
rv
->
tokí
 =
VLIB_LEX_numbî
)

139 
	`˛ib_w¨nög
 ("Çumîi¯vÆuê0x%x (%d)", 
rv
->
vÆue
,

140 
rv
->
vÆue
);

145 
	}
}

147 
u16


148 
	$vlib_Àx_add_tokí
 (
vlib_Àx_maö_t
 * 
lm
, *
tokí_«me
)

150 
uw‹d
 *
p
;

151 
u16
 
rv
;

153 
p
 = 
	`hash_gë_mem
 (
lm
->
Àx_tokís_by_«me
, 
tokí_«me
);

155 i‡(
p
)

156  
p
[0];

158 
rv
 = 
	`vec_Àn
 (
lm
->
Àx_tokí_«mes
);

159 
	`hash_£t_mem
 (
lm
->
Àx_tokís_by_«me
, 
tokí_«me
, 
rv
);

160 
	`vec_add1
 (
lm
->
Àx_tokí_«mes
, 
tokí_«me
);

162  
rv
;

163 
	}
}

165 
u16


166 
	$add_keyw‹d
 (
vlib_Àx_maö_t
 * 
lm
, *
keyw‹d
, *
tokí_«me
)

168 
uw‹d
 *
p
;

169 
u16
 
tokí
;

171 
p
 = 
	`hash_gë_mem
 (
lm
->
Àx_keyw‹ds
, 
keyw‹d
);

173 
	`ASSERT
 (
p
 == 0);

175 
tokí
 = 
	`vlib_Àx_add_tokí
 (
lm
, 
tokí_«me
);

177 
	`hash_£t_mem
 (
lm
->
Àx_keyw‹ds
, 
keyw‹d
, 
tokí
);

178  
tokí
;

179 
	}
}

181 
u16


182 
	$vlib_Àx_föd_‹_add_keyw‹d
 (
vlib_Àx_maö_t
 * 
lm
, *
keyw‹d
,

183 *
tokí_«me
)

185 
uw‹d
 *
p
 = 
	`hash_gë_mem
 (
lm
->
Àx_keyw‹ds
, 
keyw‹d
);

186  
p
 ?Ö[0] : 
	`add_keyw‹d
 (
lm
, 
keyw‹d
, 
tokí_«me
);

187 
	}
}

190 
	$vlib_Àx_£t_a˘i⁄_ønge
 (
u32
 
èbÀ_ödex
, 
u8
 
lo
, u8 
hi
, 
u16
 
a˘i⁄
,

191 
u16
 
tokí
, 
u32
 
√xt_èbÀ_ödex
)

193 
i
;

194 
vlib_Àx_maö_t
 *
lm
 = &
vlib_Àx_maö
;

195 
vlib_Àx_èbÀ_t
 *
t
 = 
	`poﬁ_ñt_©_ödex
 (
lm
->
Àx_èbÀs
, 
èbÀ_ödex
);

197 
i
 = 
lo
; i <
hi
; i++)

199 
	`ASSERT
 (
i
 < 
	`ARRAY_LEN
 (
t
->
íåõs
));

200 
t
->
íåõs
[
i
].
a˘i⁄
 =áction;

201 
t
->
íåõs
[
i
].
tokí
 =Åoken;

202 
t
->
íåõs
[
i
].
√xt_èbÀ_ödex
 =Çext_table_index;

204 
	}
}

206 
u16


207 
	$vlib_Àx_add_èbÀ
 (*
«me
)

209 
vlib_Àx_maö_t
 *
lm
 = &
vlib_Àx_maö
;

210 
vlib_Àx_èbÀ_t
 *
t
;

211 
uw‹d
 *
p
;

213 
p
 = 
	`hash_gë_mem
 (
lm
->
Àx_èbÀs_by_«me
, 
«me
);

215 
	`ASSERT
 (
p
 == 0);

217 
	`poﬁ_gë_Æig√d
 (
lm
->
Àx_èbÀs
, 
t
, 
CLIB_CACHE_LINE_BYTES
);

219 
t
->
«me
 =Çame;

221 
	`hash_£t_mem
 (
lm
->
Àx_èbÀs_by_«me
, 
«me
, 
t
 -Üm->
Àx_èbÀs
);

223 
	`vlib_Àx_£t_a˘i⁄_ønge
 (
t
 - 
lm
->
Àx_èbÀs
, 1, 0x7F, 
VLIB_LEX_IGNORE
, ~0,

224 
t
 - 
lm
->
Àx_èbÀs
);

226 
	`vlib_Àx_£t_a˘i⁄_ønge
 (
t
 - 
lm
->
Àx_èbÀs
, 0, 0, 
VLIB_LEX_RETURN
,

227 
VLIB_LEX_eof
, 
t
 - 
lm
->
Àx_èbÀs
);

229  
t
 - 
lm
->
Àx_èbÀs
;

230 
	}
}

233 
	$vlib_Àx_ª£t
 (
vlib_Àx_maö_t
 * 
lm
, 
u8
 * 
öput_ve˘‹
)

235 i‡(
lm
->
pushback_ve˘‹
)

236 
	`_vec_Àn
 (
lm
->
pushback_ve˘‹
) = 0;

237 
lm
->
pushback_•
 = -1;

239 
lm
->
öput_ve˘‹
 = input_vector;

240 
lm
->
cuºít_ödex
 = 0;

241 
	}
}

243 
˛ib_îr‹_t
 *

244 
	$Àx_⁄ëime_öô
 (
vlib_maö_t
 * 
vm
)

246 
vlib_Àx_maö_t
 *
lm
 = &
vlib_Àx_maö
;

248 
lm
->
Àx_èbÀs_by_«me
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

249 
lm
->
Àx_tokís_by_«me
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

250 
lm
->
Àx_keyw‹ds
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

251 
lm
->
pushback_•
 = -1;

253 
	#_
(
f
Ë{ 
u16
 
tmp
 = 
	`vlib_Àx_add_tokí
 (
lm
, #f); 
	`ASSERT
 (tm∞=
VLIB_LEX_
##f); }

	)

254 
f‹óch_vlib_Àx_globÆ_tokí
;

255 #unde‡
_


257 
	`vec_vÆid©e
 (
lm
->
tokí_buf„r
, 127);

258 
	`_vec_Àn
 (
lm
->
tokí_buf„r
) = 0;

261 
	}
}

263 
VLIB_INIT_FUNCTION
 (
Àx_⁄ëime_öô
);

	@lex.h

15 #i‚de‡
ö˛uded_vlib_Àx_h


16 
	#ö˛uded_vlib_Àx_h


	)

18 
	~<vµö‰a/hash.h
>

19 
	~<vµö‰a/bôm≠.h
>

20 
	~<vµö‰a/îr‹.h
>

21 
	~<vµö‰a/poﬁ.h
>

23 
	#f‹óch_vlib_Àx_globÆ_tokí
 \

24 
	`_
 (
övÆid
) \

25 
	`_
 (
eof
) \

26 
	`_
 (
w‹d
) \

27 
	`_
 (
numbî
) \

28 
	`_
 (
…
) \

29 
	`_
 (
gt
) \

30 
	`_
 (
dŸ
) \

31 
	`_
 (
¶ash
) \

32 
	`_
 (
qm¨k
) \

33 
	`_
 (
equÆs
) \

34 
	`_
 (
∂us
) \

35 
	`_
 (
möus
) \

36 
	`_
 (
°¨
) \

37 
	`_
 (
Õ¨
) \

38 
	`_
 (
Ω¨
)

	)

42 
	#_
(
f
Ë
VLIB_LEX_
##f,

	)

43 
	mf‹óch_vlib_Àx_globÆ_tokí


44 #unde‡
_


45 } 
	tvlib_Àx_globÆ_tokí_t
;

49 
	mVLIB_LEX_IGNORE
,

50 
	mVLIB_LEX_ADD_TO_TOKEN
,

51 
	mVLIB_LEX_RETURN
,

52 
	mVLIB_LEX_RETURN_AND_RESCAN
,

53 
	mVLIB_LEX_KEYWORD_CHECK
,

54 
	mVLIB_LEX_START_NUMBER
,

55 
	mVLIB_LEX_ADD_TO_NUMBER
,

56 } 
	tvlib_Àx_a˘i⁄_t
;

60 
u16
 
	ma˘i⁄
;

61 
u16
 
	m√xt_èbÀ_ödex
;

62 
u16
 
	mtokí
;

63 } 
	tvlib_Àx_èbÀ_íåy_t
;

67 *
	m«me
;

68 
vlib_Àx_èbÀ_íåy_t
 
	míåõs
[128];

69 } 
	tvlib_Àx_èbÀ_t
;

73 
u32
 
	mtokí
;

77 
uw‹d
 
	mas_uw‹d
;

78 *
	mas_poöãr
;

79 *
	mas_°rög
;

80 } 
	mvÆue
;

81 } 
	tvlib_Àx_tokí_t
;

85 
vlib_Àx_èbÀ_t
 *
	mÀx_èbÀs
;

86 
uw‹d
 *
	mÀx_èbÀs_by_«me
;

89 **
	mÀx_tokí_«mes
;

92 
uw‹d
 *
	mÀx_tokís_by_«me
;

95 
uw‹d
 *
	mÀx_keyw‹ds
;

97 
vlib_Àx_tokí_t
 *
	mpushback_ve˘‹
;

99 
i32
 
	mpushback_•
;

101 
u32
 
	mcuºít_èbÀ_ödex
;

103 
uw‹d
 
	mcuºít_tokí_vÆue
;

105 
uw‹d
 
	mcuºít_numbî_ba£
;

108 
u8
 *
	möput_ve˘‹
;

111 
u32
 
	mcuºít_ödex
;

114 
u8
 *
	mtokí_buf„r
;

115 } 
	tvlib_Àx_maö_t
;

117 
vlib_Àx_maö_t
 
vlib_Àx_maö
;

119 
Æways_ölöe
 

120 
	$vlib_Àx_˛ónup_tokí
 (
vlib_Àx_tokí_t
 * 
t
)

122 i‡(
t
->
tokí
 =
VLIB_LEX_w‹d
)

124 
u8
 *
tv
 = 
t
->
vÆue
.
as_poöãr
;

125 
	`vec_‰ì
 (
tv
);

127 
	}
}

129 
u16
 
vlib_Àx_add_èbÀ
 (*
«me
);

130 
vlib_Àx_gë_tokí
 (
vlib_Àx_maö_t
 * 
lm
, 
vlib_Àx_tokí_t
 * 
ªsu…
);

131 
u16
 
vlib_Àx_add_tokí
 (
vlib_Àx_maö_t
 * 
lm
, *
tokí_«me
);

132 
vlib_Àx_£t_a˘i⁄_ønge
 (
u32
 
èbÀ_ödex
, 
u8
 
lo
, u8 
hi
, 
u16
 
a˘i⁄
,

133 
u16
 
tokí
, 
u32
 
√xt_èbÀ_ödex
);

134 
vlib_Àx_ª£t
 (
vlib_Àx_maö_t
 * 
lm
, 
u8
 * 
öput_ve˘‹
);

135 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_Àx_tokí
;

	@linux/pci.c

40 
	~<vµö‰a/löux/sysfs.h
>

42 
	~<vlib/vlib.h
>

43 
	~<vlib/pci/pci.h
>

44 
	~<vlib/unix/unix.h
>

45 
	~<vlib/löux/vfio.h
>

47 
	~<sys/ty≥s.h
>

48 
	~<sys/°©.h
>

49 
	~<f˙é.h
>

50 
	~<dúít.h
>

51 
	~<sys/io˘l.h
>

52 
	~<√t/if.h
>

53 
	~<löux/ëhtoﬁ.h
>

54 
	~<löux/sockios.h
>

55 
	~<löux/vfio.h
>

56 
	~<sys/evítfd.h
>

58 c⁄° *
	gsysfs_pci_dev_∑th
 = "/sys/bus/pci/devices";

59 c⁄° *
	gsysfs_pci_drv_∑th
 = "/sys/bus/pci/drivers";

60 *
	gsysfs_mod_vfio_noiommu
 =

65 
	mfd
;

66 *
	maddr
;

67 
size_t
 
	msize
;

68 } 
	tlöux_pci_ªgi⁄_t
;

72 
	mfd
;

73 
u32
 
	m˛ib_fûe_ödex
;

76 
pci_ötx_h™dÀr_fun˘i⁄_t
 *
	mötx_h™dÀr
;

77 
pci_msix_h™dÀr_fun˘i⁄_t
 *
	mmsix_h™dÀr
;

79 } 
	tlöux_pci_úq_t
;

83 
	mLINUX_PCI_DEVICE_TYPE_UNKNOWN
,

84 
	mLINUX_PCI_DEVICE_TYPE_UIO
,

85 
	mLINUX_PCI_DEVICE_TYPE_VFIO
,

86 } 
	tlöux_pci_devi˚_ty≥_t
;

90 
löux_pci_devi˚_ty≥_t
 
	mty≥
;

91 
vlib_pci_dev_h™dÀ_t
 
	mh™dÀ
;

92 
vlib_pci_addr_t
 
	maddr
;

95 
löux_pci_ªgi⁄_t
 *
	mªgi⁄s
;

98 
	mc⁄fig_fd
;

99 
u64
 
	mc⁄fig_off£t
;

102 
	mfd
;

105 
u32
 
	muio_mö‹
;

108 
löux_pci_úq_t
 
	mötx_úq
;

109 
löux_pci_úq_t
 *
	mmsix_úqs
;

112 
uw‹d
 
	m¥iv©e_d©a
;

114 } 
	tlöux_pci_devi˚_t
;

119 
vlib_maö_t
 *
	mvlib_maö
;

120 
löux_pci_devi˚_t
 *
	mlöux_pci_devi˚s
;

122 } 
	tlöux_pci_maö_t
;

124 
löux_pci_maö_t
 
löux_pci_maö
;

126 
löux_pci_devi˚_t
 *

127 
	$löux_pci_gë_devi˚
 (
vlib_pci_dev_h™dÀ_t
 
h
)

129 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

130  
	`poﬁ_ñt_©_ödex
 (
Õm
->
löux_pci_devi˚s
, 
h
);

131 
	}
}

133 
uw‹d


134 
	$vlib_pci_gë_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
)

136 
löux_pci_devi˚_t
 *
d
 = 
	`löux_pci_gë_devi˚
 (
h
);

137  
d
->
¥iv©e_d©a
;

138 
	}
}

141 
	$vlib_pci_£t_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
uw‹d
 
¥iv©e_d©a
)

143 
löux_pci_devi˚_t
 *
d
 = 
	`löux_pci_gë_devi˚
 (
h
);

144 
d
->
¥iv©e_d©a
 =Örivate_data;

145 
	}
}

147 
vlib_pci_addr_t
 *

148 
	$vlib_pci_gë_addr
 (
vlib_pci_dev_h™dÀ_t
 
h
)

150 
löux_pci_devi˚_t
 *
d
 = 
	`löux_pci_gë_devi˚
 (
h
);

151  &
d
->
addr
;

152 
	}
}

157 
˛ib_îr‹_t
 *
pci_bus_öô
 (
vlib_maö_t
 * 
vm
);

159 
löux_pci_maö_t
 
	glöux_pci_maö
;

161 
vlib_pci_devi˚_öfo_t
 *

162 
	$vlib_pci_gë_devi˚_öfo
 (
vlib_pci_addr_t
 * 
addr
, 
˛ib_îr‹_t
 ** 
îr‹
)

164 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

165 
˛ib_îr‹_t
 *
îr
;

166 
vlib_pci_devi˚_öfo_t
 *
di
;

167 
u8
 *
f
 = 0;

168 
u32
 
tmp
;

169 
fd
;

171 
di
 = 
	`˛ib_mem_Æloc
 ( (
vlib_pci_devi˚_öfo_t
));

172 
	`mem£t
 (
di
, 0,  (
vlib_pci_devi˚_öfo_t
));

173 
di
->
addr
.
as_u32
 =áddr->as_u32;

175 
u8
 *
dev_dú_«me
 = 
	`f‹m©
 (0, "%s/%U", 
sysfs_pci_dev_∑th
,

176 
f‹m©_vlib_pci_addr
, 
addr
);

178 
f
 = 
	`f‹m©
 (0, "%v/c⁄fig%c", 
dev_dú_«me
, 0);

179 
fd
 = 
	`›í
 ((*Ë
f
, 
O_RDWR
);

182 i‡(
fd
 < 0)

183 
fd
 = 
	`›í
 ((*Ë
f
, 
O_RDONLY
);

185 i‡(
fd
 < 0)

187 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í `%s'", 
f
);

188 
îr‹
;

193 i‡(
	`ªad
 (
fd
, &
di
->
c⁄fig_d©a
,  (di->config_data)) <

194  (
di
->
c⁄fig0
))

196 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ªad `%s'", 
f
);

197 
	`˛o£
 (
fd
);

198 
îr‹
;

202 
pci_c⁄fig_hódî_t
 
Æl_⁄es
;

203 i‡(
Æl_⁄es
.
víd‹_id
 == 0)

204 
	`mem£t
 (&
Æl_⁄es
, ~0,  (all_ones));

206 i‡(!
	`memcmp
 (&
di
->
c⁄fig0
.
hódî
, &
Æl_⁄es
,  (all_ones)))

208 
îr
 = 
	`˛ib_îr‹_ªtu∫
 (0, "övÆid PCI c⁄fig f‹ `%s'", 
f
);

209 
	`˛o£
 (
fd
);

210 
îr‹
;

214 i‡(
di
->
c⁄fig0
.
hódî
.
hódî_ty≥
 == 0)

215 
	`pci_c⁄fig_ty≥0_lôée_to_ho°
 (&
di
->
c⁄fig0
);

217 
	`pci_c⁄fig_ty≥1_lôée_to_ho°
 (&
di
->
c⁄fig1
);

219 
di
->
numa_node
 = -1;

220 
	`vec_ª£t_Àngth
 (
f
);

221 
f
 = 
	`f‹m©
 (f, "%v/numa_node%c", 
dev_dú_«me
, 0);

222 
îr
 = 
	`˛ib_sysfs_ªad
 ((*Ë
f
, "%u", &
di
->
numa_node
);

223 i‡(
îr
)

225 
di
->
numa_node
 = -1;

226 
	`˛ib_îr‹_‰ì
 (
îr
);

229 
	`vec_ª£t_Àngth
 (
f
);

230 
f
 = 
	`f‹m©
 (f, "%v/˛ass%c", 
dev_dú_«me
, 0);

231 
îr
 = 
	`˛ib_sysfs_ªad
 ((*Ë
f
, "0x%x", &
tmp
);

232 i‡(
îr
)

233 
îr‹
;

234 
di
->
devi˚_˛ass
 = 
tmp
 >> 8;

236 
	`vec_ª£t_Àngth
 (
f
);

237 
f
 = 
	`f‹m©
 (f, "%v/víd‹%c", 
dev_dú_«me
, 0);

238 
îr
 = 
	`˛ib_sysfs_ªad
 ((*Ë
f
, "0x%x", &
tmp
);

239 i‡(
îr
)

240 
îr‹
;

241 
di
->
víd‹_id
 = 
tmp
;

243 
	`vec_ª£t_Àngth
 (
f
);

244 
f
 = 
	`f‹m©
 (f, "%v/devi˚%c", 
dev_dú_«me
, 0);

245 
îr
 = 
	`˛ib_sysfs_ªad
 ((*Ë
f
, "0x%x", &
tmp
);

246 i‡(
îr
)

247 
îr‹
;

248 
di
->
devi˚_id
 = 
tmp
;

250 
	`vec_ª£t_Àngth
 (
f
);

251 
f
 = 
	`f‹m©
 (f, "%v/drivî%c", 
dev_dú_«me
, 0);

252 
di
->
drivî_«me
 = 
	`˛ib_sysfs_lök_to_«me
 ((*Ë
f
);

254 
di
->
iommu_group
 = -1;

255 i‡(
lvm
->
c⁄èöî_fd
 != -1)

257 
u8
 *
tmp°r
;

258 
	`vec_ª£t_Àngth
 (
f
);

259 
f
 = 
	`f‹m©
 (f, "%v/iommu_group%c", 
dev_dú_«me
, 0);

260 
tmp°r
 = 
	`˛ib_sysfs_lök_to_«me
 ((*Ë
f
);

261 i‡(
tmp°r
)

263 
di
->
iommu_group
 = 
	`©oi
 ((*Ë
tmp°r
);

264 
	`vec_‰ì
 (
tmp°r
);

268 
	`˛o£
 (
fd
);

270 
	`vec_ª£t_Àngth
 (
f
);

271 
f
 = 
	`f‹m©
 (f, "%v/vpd%c", 
dev_dú_«me
, 0);

272 
fd
 = 
	`›í
 ((*Ë
f
, 
O_RDONLY
);

273 i‡(
fd
 >= 0)

277 
u8
 
èg
[3];

278 
u8
 *
d©a
 = 0;

279 
uw‹d
 
Àn
;

281 i‡(
	`ªad
 (
fd
, &
èg
, 3) != 3)

284 i‡(
èg
[0] != 0x82 &&Åag[0] != 0x90 &&Åag[0] != 0x91)

287 
Àn
 = (
èg
[2] << 8) |Åag[1];

288 
	`vec_vÆid©e
 (
d©a
, 
Àn
);

290 i‡(
	`ªad
 (
fd
, 
d©a
, 
Àn
) !=Üen)

292 
	`vec_‰ì
 (
d©a
);

295 i‡(
èg
[0] == 0x82)

296 
di
->
¥odu˘_«me
 = 
d©a
;

297 i‡(
èg
[0] == 0x90)

298 
di
->
vpd_r
 = 
d©a
;

299 i‡(
èg
[0] == 0x91)

300 
di
->
vpd_w
 = 
d©a
;

302 
d©a
 = 0;

304 
	`˛o£
 (
fd
);

307 
d⁄e
;

309 
îr‹
:

310 
	`vlib_pci_‰ì_devi˚_öfo
 (
di
);

311 
di
 = 0;

313 
d⁄e
:

314 
	`vec_‰ì
 (
f
);

315 
	`vec_‰ì
 (
dev_dú_«me
);

316 i‡(
îr‹
)

317 *
îr‹
 = 
îr
;

319 
	`˛ib_îr‹_‰ì
 (
îr
);

320  
di
;

321 
	}
}

324 
	$dúe˘‹y_exi°s
 (*
∑th
)

326 
°©
 
s
 = { 0 };

327 i‡(
	`°©
 (
∑th
, &
s
) == -1)

330  
	`S_ISDIR
 (
s
.
°_mode
);

331 
	}
}

333 
˛ib_îr‹_t
 *

334 
	$vlib_pci_böd_to_uio
 (
vlib_pci_addr_t
 * 
addr
, *
uio_drv_«me
)

336 
˛ib_îr‹_t
 *
îr‹
 = 0;

337 
u8
 *
s
 = 0, *
drivî_«me
 = 0;

338 
DIR
 *
dú
 = 0;

339 
dúít
 *
e
;

340 
vlib_pci_devi˚_öfo_t
 *
di
;

341 
fd
, 
˛ór_drivî_ovîride
 = 0;

342 
u8
 *
dev_dú_«me
 = 
	`f‹m©
 (0, "%s/%U", 
sysfs_pci_dev_∑th
,

343 
f‹m©_vlib_pci_addr
, 
addr
);

345 
di
 = 
	`vlib_pci_gë_devi˚_öfo
 (
addr
, &
îr‹
);

347 i‡(
îr‹
)

348  
îr‹
;

350 i‡(
	`°∫cmp
 ("auto", 
uio_drv_«me
, 5) == 0)

352 
vfio_pci_lﬂded
 = 0;

354 i‡(
	`dúe˘‹y_exi°s
 ("/sys/module/vfio_pci"))

355 
vfio_pci_lﬂded
 = 1;

357 i‡(
di
->
iommu_group
 != -1)

360 i‡(!
vfio_pci_lﬂded
)

362 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "Skipping PCI device %U: device "

365 
f‹m©_vlib_pci_addr
, 
addr
);

366 
d⁄e
;

369 
uio_drv_«me
 = "vfio-pci";

374 i‡(
vfio_pci_lﬂded
 &&

375 (
îr‹
 = 
	`˛ib_sysfs_wrôe
 (
sysfs_mod_vfio_noiommu
, "Y")) == 0)

376 
uio_drv_«me
 = "vfio-pci";

377 i‡(
	`dúe˘‹y_exi°s
 ("/sys/module/uio_pci_generic"))

378 
uio_drv_«me
 = "uio_pci_generic";

379 i‡(
	`dúe˘‹y_exi°s
 ("/sys/module/igb_uio"))

380 
uio_drv_«me
 = "igb_uio";

383 
	`˛ib_îr‹_‰ì
 (
îr‹
);

384 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "Skipping PCI device %U: missing "

386 
f‹m©_vlib_pci_addr
, 
addr
);

387 
d⁄e
;

389 
	`˛ib_îr‹_‰ì
 (
îr‹
);

393 
s
 = 
	`f‹m©
 (s, "%v/drivî%c", 
dev_dú_«me
, 0);

394 
drivî_«me
 = 
	`˛ib_sysfs_lök_to_«me
 ((*Ë
s
);

395 
	`vec_ª£t_Àngth
 (
s
);

397 i‡(
drivî_«me
 &&

398 ((
	`°rcmp
 ("vfio-pci", (*Ë
drivî_«me
) == 0) ||

399 (
	`°rcmp
 ("uio_pci_gíîic", (*Ë
drivî_«me
) == 0) ||

400 (
	`°rcmp
 ("igb_uio", (*Ë
drivî_«me
) == 0)))

401 
d⁄e
;

405 
dú
 = 
	`›ídú
 ("/sys/class/net");

406 
s
 = 
	`f‹m©
 (s, "%U%c", 
f‹m©_vlib_pci_addr
, 
addr
, 0);

408 i‡(!
dú
)

410 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "Skipping PCI device %U: failedÅo "

412 
f‹m©_vlib_pci_addr
, 
addr
);

413 
d⁄e
;

416 
fd
 = 
	`sockë
 (
PF_INET
, 
SOCK_DGRAM
, 0);

417 i‡(
fd
 < 0)

419 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "socket");

420 
d⁄e
;

423 (
e
 = 
	`ªaddú
 (
dú
)))

425 
i‰eq
 
i‰
;

426 
ëhtoﬁ_drvöfo
 
drvöfo
;

428 i‡(
e
->
d_«me
[0] == '.')

431 
	`mem£t
 (&
i‰
, 0,  ifr);

432 
	`mem£t
 (&
drvöfo
, 0,  drvinfo);

433 
i‰
.
i‰_d©a
 = (*Ë&
drvöfo
;

434 
	`°∫˝y
 (
i‰
.
i‰_«me
, 
e
->
d_«me
, 
IFNAMSIZ
 - 1);

435 
drvöfo
.
cmd
 = 
ETHTOOL_GDRVINFO
;

436 i‡(
	`io˘l
 (
fd
, 
SIOCETHTOOL
, &
i‰
) < 0)

439 i‡((
î∫o
 !
ENOTSUP
Ë&& (î∫ÿ!
ENODEV
))

440 
	`˛ib_unix_w¨nög
 ("ioctl fetch intf %s bus infoÉrror",

441 
e
->
d_«me
);

445 i‡(
	`°rcmp
 ((*Ë
s
, 
drvöfo
.
bus_öfo
))

448 
	`mem£t
 (&
i‰
, 0,  (ifr));

449 
	`°∫˝y
 (
i‰
.
i‰_«me
, 
e
->
d_«me
, 
IFNAMSIZ
 - 1);

450 i‡(
	`io˘l
 (
fd
, 
SIOCGIFFLAGS
, &
i‰
) < 0)

452 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl fetch intf %s flags",

453 
e
->
d_«me
);

454 
	`˛o£
 (
fd
);

455 
d⁄e
;

458 i‡(
i‰
.
i‰_Êags
 & 
IFF_UP
)

460 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "Skipping PCI device %Uás host "

462 
f‹m©_vlib_pci_addr
, 
addr
, 
e
->
d_«me
);

463 
	`˛o£
 (
fd
);

464 
d⁄e
;

468 
	`˛o£
 (
fd
);

469 
	`vec_ª£t_Àngth
 (
s
);

471 
s
 = 
	`f‹m©
 (s, "%v/drivî/unböd%c", 
dev_dú_«me
, 0);

472 
	`˛ib_sysfs_wrôe
 ((*Ë
s
, "%U", 
f‹m©_vlib_pci_addr
, 
addr
);

473 
	`vec_ª£t_Àngth
 (
s
);

475 
s
 = 
	`f‹m©
 (s, "%v/drivî_ovîride%c", 
dev_dú_«me
, 0);

476 i‡(
	`ac˚ss
 ((*Ë
s
, 
F_OK
) == 0)

478 
	`˛ib_sysfs_wrôe
 ((*Ë
s
, "%s", 
uio_drv_«me
);

479 
˛ór_drivî_ovîride
 = 1;

483 
	`vec_ª£t_Àngth
 (
s
);

484 
s
 = 
	`f‹m©
 (s, "%s/%s/√w_id%c", 
sysfs_pci_drv_∑th
, 
uio_drv_«me
, 0);

485 
	`˛ib_sysfs_wrôe
 ((*Ë
s
, "0x%04x 0x%04x", 
di
->
víd‹_id
,

486 
di
->
devi˚_id
);

488 
	`vec_ª£t_Àngth
 (
s
);

490 
s
 = 
	`f‹m©
 (s, "%s/%s/böd%c", 
sysfs_pci_drv_∑th
, 
uio_drv_«me
, 0);

491 
	`˛ib_sysfs_wrôe
 ((*Ë
s
, "%U", 
f‹m©_vlib_pci_addr
, 
addr
);

492 
	`vec_ª£t_Àngth
 (
s
);

494 i‡(
˛ór_drivî_ovîride
)

496 
s
 = 
	`f‹m©
 (s, "%v/drivî_ovîride%c", 
dev_dú_«me
, 0);

497 
	`˛ib_sysfs_wrôe
 ((*Ë
s
, "%c", 0);

498 
	`vec_ª£t_Àngth
 (
s
);

501 
d⁄e
:

502 
	`˛o£dú
 (
dú
);

503 
	`vec_‰ì
 (
s
);

504 
	`vec_‰ì
 (
dev_dú_«me
);

505 
	`vec_‰ì
 (
drivî_«me
);

506  
îr‹
;

507 
	}
}

510 
˛ib_îr‹_t
 *

511 
	$sˇn_uio_dú
 (*
¨g
, 
u8
 * 
∑th_«me
, u8 * 
fûe_«me
)

513 
löux_pci_devi˚_t
 *
l
 = 
¨g
;

514 
unf‹m©_öput_t
 
öput
;

516 
	`unf‹m©_öô_°rög
 (&
öput
, (*Ë
fûe_«me
, 
	`vec_Àn
 (file_name));

518 i‡(!
	`unf‹m©
 (&
öput
, "uio%d", &
l
->
uio_mö‹
))

519 
	`ab‹t
 ();

521 
	`unf‹m©_‰ì
 (&
öput
);

523 
	}
}

525 
˛ib_îr‹_t
 *

526 
	$vfio_£t_úqs
 (
löux_pci_devi˚_t
 * 
p
, 
u32
 
ödex
, u32 
°¨t
, u32 
cou¡
,

527 
u32
 
Êags
, *
efds
)

529 
d©a_Àn
 = 
efds
 ? 
cou¡
 *  () : 0;

530 
u8
 
buf
[ (
vfio_úq_£t
Ë+ 
d©a_Àn
];

531 
vfio_úq_öfo
 
úq_öfo
 = { 0 };

532 
vfio_úq_£t
 *
úq_£t
 = (vfio_úq_£à*Ë
buf
;

535 
úq_öfo
.
¨gsz
 =  (
vfio_úq_öfo
);

536 
úq_öfo
.
ödex
 = index;

538 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_GET_IRQ_INFO
, &
úq_öfo
) < 0)

539  
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_GET_IRQ_INFO) "

540 "'%U'", 
f‹m©_vlib_pci_addr
, &
p
->
addr
);

542 i‡(
úq_öfo
.
cou¡
 < 
°¨t
 + count)

543  
	`˛ib_îr‹_ªtu∫_unix
 (0, "vfio_set_irq: unexistng interrupt on "

544 "'%U'", 
f‹m©_vlib_pci_addr
, &
p
->
addr
);

547 i‡(
efds
)

549 
Êags
 |
VFIO_IRQ_SET_DATA_EVENTFD
;

550 
	`˛ib_mem˝y
 (&
úq_£t
->
d©a
, 
efds
, 
d©a_Àn
);

553 
Êags
 |
VFIO_IRQ_SET_DATA_NONE
;

555 
	`ASSERT
 ((
Êags
 & (
VFIO_IRQ_SET_DATA_NONE
 | 
VFIO_IRQ_SET_DATA_EVENTFD
)) !=

556 (
VFIO_IRQ_SET_DATA_NONE
 | 
VFIO_IRQ_SET_DATA_EVENTFD
));

558 
úq_£t
->
¨gsz
 =  (
vfio_úq_£t
Ë+ 
d©a_Àn
;

559 
úq_£t
->
ödex
 = index;

560 
úq_£t
->
°¨t
 = start;

561 
úq_£t
->
cou¡
 = count;

562 
úq_£t
->
Êags
 = flags;

564 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_SET_IRQS
, 
úq_£t
) < 0)

565  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%U:ioctl(VFIO_DEVICE_SET_IRQS) "

568 
f‹m©_vlib_pci_addr
, &
p
->
addr
,

569 
ödex
, 
°¨t
, 
cou¡
, 
Êags
);

571 
	}
}

573 
˛ib_îr‹_t
 *

574 
	$löux_pci_uio_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

576 
	`__©åibuã__
 ((
unu£d
)Ë
rv
;

577 
vlib_pci_dev_h™dÀ_t
 
h
 = 
uf
->
¥iv©e_d©a
;

578 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

579 
löux_pci_úq_t
 *
úq
 = &
p
->
ötx_úq
;

581 
u32
 
icou¡
;

582 
rv
 = 
	`ªad
 (
uf
->
fûe_des¸ùt‹
, &
icou¡
, 4);

584 i‡(
úq
->
ötx_h™dÀr
)

585 
úq
->
	`ötx_h™dÀr
 (
h
);

587 
	`vlib_pci_öå_íabÀ
 (
h
);

590 
	}
}

592 
˛ib_îr‹_t
 *

593 
	$löux_pci_vfio_unmask_ötx
 (
löux_pci_devi˚_t
 * 
d
)

595  
	`vfio_£t_úqs
 (
d
, 
VFIO_PCI_INTX_IRQ_INDEX
, 0, 1,

596 
VFIO_IRQ_SET_ACTION_UNMASK
, 0);

597 
	}
}

599 
˛ib_îr‹_t
 *

600 
	$löux_pci_uio_îr‹_ªady
 (
˛ib_fûe_t
 * 
uf
)

602 
u32
 
îr‹_ödex
 = (u32Ë
uf
->
¥iv©e_d©a
;

604  
	`˛ib_îr‹_ªtu∫
 (0, "pcòdevi˚ %d:Éº‹", 
îr‹_ödex
);

605 
	}
}

607 
˛ib_îr‹_t
 *

608 
	$löux_pci_vfio_msix_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

610 
	`__©åibuã__
 ((
unu£d
)Ë
rv
;

611 
vlib_pci_dev_h™dÀ_t
 
h
 = 
uf
->
¥iv©e_d©a
 >> 16;

612 
u16
 
löe
 = 
uf
->
¥iv©e_d©a
 & 0xffff;

613 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

614 
löux_pci_úq_t
 *
úq
 = 
	`vec_ñt_©_ödex
 (
p
->
msix_úqs
, 
löe
);

616 
u64
 
icou¡
;

617 
rv
 = 
	`ªad
 (
uf
->
fûe_des¸ùt‹
, &
icou¡
,  (icount));

619 i‡(
úq
->
msix_h™dÀr
)

620 
úq
->
	`msix_h™dÀr
 (
h
, 
löe
);

623 
	}
}

625 
˛ib_îr‹_t
 *

626 
	$löux_pci_vfio_ötx_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

628 
	`__©åibuã__
 ((
unu£d
)Ë
rv
;

629 
vlib_pci_dev_h™dÀ_t
 
h
 = 
uf
->
¥iv©e_d©a
;

630 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

631 
löux_pci_úq_t
 *
úq
 = &
p
->
ötx_úq
;

633 
u64
 
icou¡
;

634 
rv
 = 
	`ªad
 (
uf
->
fûe_des¸ùt‹
, &
icou¡
,  (icount));

636 i‡(
úq
->
ötx_h™dÀr
)

637 
úq
->
	`ötx_h™dÀr
 (
h
);

639 
	`löux_pci_vfio_unmask_ötx
 (
p
);

642 
	}
}

644 
˛ib_îr‹_t
 *

645 
	$löux_pci_vfio_îr‹_ªady
 (
˛ib_fûe_t
 * 
uf
)

647 
u32
 
îr‹_ödex
 = (u32Ë
uf
->
¥iv©e_d©a
;

649  
	`˛ib_îr‹_ªtu∫
 (0, "pcòdevi˚ %d:Éº‹", 
îr‹_ödex
);

650 
	}
}

652 
˛ib_îr‹_t
 *

653 
	$add_devi˚_uio
 (
löux_pci_devi˚_t
 * 
p
, 
vlib_pci_devi˚_öfo_t
 * 
di
,

654 
pci_devi˚_ªgi°øti⁄_t
 * 
r
)

656 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

657 
˛ib_îr‹_t
 *
îr
 = 0;

658 
u8
 *
s
 = 0;

660 
p
->
addr
.
as_u32
 = 
di
->addr.as_u32;

661 
p
->
fd
 = -1;

662 
p
->
ty≥
 = 
LINUX_PCI_DEVICE_TYPE_UIO
;

664 
s
 = 
	`f‹m©
 (s, "%s/%U/c⁄fig%c", 
sysfs_pci_dev_∑th
,

665 
f‹m©_vlib_pci_addr
, &
di
->
addr
, 0);

667 
p
->
c⁄fig_fd
 = 
	`›í
 ((*Ë
s
, 
O_RDWR
);

668 
p
->
c⁄fig_off£t
 = 0;

669 
	`vec_ª£t_Àngth
 (
s
);

671 i‡(
p
->
c⁄fig_fd
 == -1)

673 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í '%s'", 
s
);

674 
îr‹
;

677 
s
 = 
	`f‹m©
 (0, "%s/%U/uio", 
sysfs_pci_dev_∑th
,

678 
f‹m©_vlib_pci_addr
, &
di
->
addr
);

679 
	`f‹óch_dúe˘‹y_fûe
 ((*Ë
s
, 
sˇn_uio_dú
, 
p
,

681 
	`vec_ª£t_Àngth
 (
s
);

683 
s
 = 
	`f‹m©
 (s, "/dev/uio%d%c", 
p
->
uio_mö‹
, 0);

684 
p
->
fd
 = 
	`›í
 ((*Ë
s
, 
O_RDWR
);

685 i‡(
p
->
fd
 < 0)

687 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í '%s'", 
s
);

688 
îr‹
;

691 i‡(
r
 &&Ñ->
öãºu±_h™dÀr
)

692 
	`vlib_pci_ªgi°î_ötx_h™dÀr
 (
p
->
h™dÀ
, 
r
->
öãºu±_h™dÀr
);

694 i‡(
r
 &&Ñ->
öô_fun˘i⁄
)

695 
îr
 = 
r
->
	`öô_fun˘i⁄
 (
Õm
->
vlib_maö
, 
p
->
h™dÀ
);

697 
îr‹
:

698 
	`‰ì
 (
s
);

699 i‡(
îr
)

701 i‡(
p
->
c⁄fig_fd
 != -1)

702 
	`˛o£
 (
p
->
c⁄fig_fd
);

703 i‡(
p
->
fd
 != -1)

704 
	`˛o£
 (
p
->
fd
);

706  
îr
;

707 
	}
}

709 
˛ib_îr‹_t
 *

710 
	$vlib_pci_ªgi°î_ötx_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
,

711 
pci_ötx_h™dÀr_fun˘i⁄_t
 * 
ötx_h™dÀr
)

713 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

714 
˛ib_fûe_t
 
t
 = { 0 };

715 
löux_pci_úq_t
 *
úq
 = &
p
->
ötx_úq
;

716 
	`ASSERT
 (
úq
->
fd
 == -1);

718 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_VFIO
)

720 
vfio_úq_öfo
 
úq_öfo
 = { 0 };

721 
úq_öfo
.
¨gsz
 =  (
vfio_úq_öfo
);

722 
úq_öfo
.
ödex
 = 
VFIO_PCI_INTX_IRQ_INDEX
;

723 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_GET_IRQ_INFO
, &
úq_öfo
) < 0)

724  
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_GET_IRQ_INFO) '"

725 "%U'", 
f‹m©_vlib_pci_addr
, &
p
->
addr
);

726 i‡(
úq_öfo
.
cou¡
 != 1)

727  
	`˛ib_îr‹_ªtu∫
 (0, "INTx interrupt doesÇotÉxist on device"

728 "'%U'", 
f‹m©_vlib_pci_addr
, &
p
->
addr
);

730 
úq
->
fd
 = 
	`evítfd
 (0, 
EFD_NONBLOCK
);

731 i‡(
úq
->
fd
 == -1)

732  
	`˛ib_îr‹_ªtu∫_unix
 (0, "eventfd");

733 
t
.
fûe_des¸ùt‹
 = 
úq
->
fd
;

734 
t
.
ªad_fun˘i⁄
 = 
löux_pci_vfio_ötx_ªad_ªady
;

736 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_UIO
)

738 
t
.
fûe_des¸ùt‹
 = 
p
->
fd
;

739 
t
.
ªad_fun˘i⁄
 = 
löux_pci_uio_ªad_ªady
;

744 
t
.
îr‹_fun˘i⁄
 = 
löux_pci_uio_îr‹_ªady
;

745 
t
.
¥iv©e_d©a
 = 
p
->
h™dÀ
;

746 
t
.
des¸ùti⁄
 = 
	`f‹m©
 (0, "PCI %U INTx", 
f‹m©_vlib_pci_addr
, &
p
->
addr
);

747 
úq
->
˛ib_fûe_ödex
 = 
	`˛ib_fûe_add
 (&
fûe_maö
, &
t
);

748 
úq
->
ötx_h™dÀr
 = intx_handler;

750 
	}
}

752 
˛ib_îr‹_t
 *

753 
	$vlib_pci_ªgi°î_msix_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u32
 
°¨t
, u32 
cou¡
,

754 
pci_msix_h™dÀr_fun˘i⁄_t
 * 
msix_h™dÀr
)

756 
˛ib_îr‹_t
 *
îr
 = 0;

757 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

758 
u32
 
i
;

760 i‡(
p
->
ty≥
 !
LINUX_PCI_DEVICE_TYPE_VFIO
)

761  
	`˛ib_îr‹_ªtu∫
 (0, "vfio driver isÇeeded for MSI-X interrupt "

765 
	`vec_vÆid©e_öô_em±y
 (
p
->
msix_úqs
, 
°¨t
 + 
cou¡
 - 1, (
löux_pci_úq_t
)

766 { .
fd
 = -1});

769 
i
 = 
°¨t
; i < sèπ + 
cou¡
; i++)

771 
˛ib_fûe_t
 
t
 = { 0 };

772 
löux_pci_úq_t
 *
úq
 = 
	`vec_ñt_©_ödex
 (
p
->
msix_úqs
, 
i
);

773 
	`ASSERT
 (
úq
->
fd
 == -1);

775 
úq
->
fd
 = 
	`evítfd
 (0, 
EFD_NONBLOCK
);

776 i‡(
úq
->
fd
 == -1)

778 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "eventfd");

779 
îr‹
;

782 
t
.
ªad_fun˘i⁄
 = 
löux_pci_vfio_msix_ªad_ªady
;

783 
t
.
fûe_des¸ùt‹
 = 
úq
->
fd
;

784 
t
.
îr‹_fun˘i⁄
 = 
löux_pci_vfio_îr‹_ªady
;

785 
t
.
¥iv©e_d©a
 = 
p
->
h™dÀ
 << 16 | 
i
;

786 
t
.
des¸ùti⁄
 = 
	`f‹m©
 (0, "PCI %U MSI-X #%u", 
f‹m©_vlib_pci_addr
,

787 &
p
->
addr
, 
i
);

788 
úq
->
˛ib_fûe_ödex
 = 
	`˛ib_fûe_add
 (&
fûe_maö
, &
t
);

789 
úq
->
msix_h™dÀr
 = msix_handler;

794 
îr‹
:

795 
i
-- > 
°¨t
)

797 
löux_pci_úq_t
 *
úq
 = 
	`vec_ñt_©_ödex
 (
p
->
msix_úqs
, 
i
);

798 i‡(
úq
->
fd
 != -1)

800 
	`˛ib_fûe_dñ_by_ödex
 (&
fûe_maö
, 
úq
->
˛ib_fûe_ödex
);

801 
	`˛o£
 (
úq
->
fd
);

802 
úq
->
fd
 = -1;

805  
îr
;

806 
	}
}

808 
˛ib_îr‹_t
 *

809 
	$vlib_pci_íabÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
, u16 
cou¡
)

811 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

812 
fds
[
cou¡
];

813 
i
;

815 i‡(
p
->
ty≥
 !
LINUX_PCI_DEVICE_TYPE_VFIO
)

816  
	`˛ib_îr‹_ªtu∫
 (0, "vfio driver isÇeeded for MSI-X interrupt "

819 
i
 = 
°¨t
; i < sèπ + 
cou¡
; i++)

821 
löux_pci_úq_t
 *
úq
 = 
	`vec_ñt_©_ödex
 (
p
->
msix_úqs
, 
i
);

822 
fds
[
i
] = 
úq
->
fd
;

825  
	`vfio_£t_úqs
 (
p
, 
VFIO_PCI_MSIX_IRQ_INDEX
, 
°¨t
, 
cou¡
,

826 
VFIO_IRQ_SET_ACTION_TRIGGER
, 
fds
);

827 
	}
}

829 
˛ib_îr‹_t
 *

830 
	$vlib_pci_dißbÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
, u16 
cou¡
)

832 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

833 
i
, 
fds
[
cou¡
];

835 i‡(
p
->
ty≥
 !
LINUX_PCI_DEVICE_TYPE_VFIO
)

836  
	`˛ib_îr‹_ªtu∫
 (0, "vfio driver isÇeeded for MSI-X interrupt "

839 
i
 = 
°¨t
; i < sèπ + 
cou¡
; i++)

840 
fds
[
i
] = -1;

842  
	`vfio_£t_úqs
 (
p
, 
VFIO_PCI_MSIX_IRQ_INDEX
, 
°¨t
, 
cou¡
,

843 
VFIO_IRQ_SET_ACTION_TRIGGER
, 
fds
);

844 
	}
}

846 
˛ib_îr‹_t
 *

847 
	$add_devi˚_vfio
 (
löux_pci_devi˚_t
 * 
p
, 
vlib_pci_devi˚_öfo_t
 * 
di
,

848 
pci_devi˚_ªgi°øti⁄_t
 * 
r
)

850 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

851 
vfio_devi˚_öfo
 
devi˚_öfo
 = { 0 };

852 
vfio_ªgi⁄_öfo
 
ªg
 = { 0 };

853 
˛ib_îr‹_t
 *
îr
 = 0;

854 
u8
 *
s
 = 0;

856 
p
->
addr
.
as_u32
 = 
di
->addr.as_u32;

857 
p
->
ty≥
 = 
LINUX_PCI_DEVICE_TYPE_VFIO
;

859 i‡(
di
->
drivî_«me
 == 0 ||

860 (
	`°rcmp
 ("vfio-pci", (*Ë
di
->
drivî_«me
) != 0))

861  
	`˛ib_îr‹_ªtu∫
 (0, "Device '%U' (iommu group %d)Çot boundÅo "

862 "vfio-pci", 
f‹m©_vlib_pci_addr
, &
di
->
addr
,

863 
di
->
iommu_group
);

865 i‡((
îr
 = 
	`löux_vfio_group_gë_devi˚_fd
 (&
p
->
addr
, &p->
fd
)))

866  
îr
;

868 
devi˚_öfo
.
¨gsz
 =  (device_info);

869 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_GET_INFO
, &
devi˚_öfo
) < 0)

871 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_GET_INFO) '%U'",

872 
f‹m©_vlib_pci_addr
, &
di
->
addr
);

873 
îr‹
;

876 
ªg
.
¨gsz
 =  (
vfio_ªgi⁄_öfo
);

877 
ªg
.
ödex
 = 
VFIO_PCI_CONFIG_REGION_INDEX
;

878 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_GET_REGION_INFO
, &
ªg
) < 0)

880 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_GET_INFO) '%U'",

881 
f‹m©_vlib_pci_addr
, &
di
->
addr
);

882 
îr‹
;

884 
p
->
c⁄fig_off£t
 = 
ªg
.
off£t
;

885 
p
->
c⁄fig_fd
 =Ö->
fd
;

888 i‡(
devi˚_öfo
.
Êags
 & 
VFIO_DEVICE_FLAGS_RESET
)

889 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_RESET
) < 0)

891 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_RESET) '%U'",

892 
f‹m©_vlib_pci_addr
, &
di
->
addr
);

893 
îr‹
;

896 i‡(
r
 &&Ñ->
öãºu±_h™dÀr
)

898 
	`vlib_pci_ªgi°î_ötx_h™dÀr
 (
p
->
h™dÀ
, 
r
->
öãºu±_h™dÀr
);

899 
	`löux_pci_vfio_unmask_ötx
 (
p
);

902 i‡(
r
 &&Ñ->
öô_fun˘i⁄
)

903 
îr
 = 
r
->
	`öô_fun˘i⁄
 (
Õm
->
vlib_maö
, 
p
->
h™dÀ
);

905 
îr‹
:

906 
	`vec_‰ì
 (
s
);

907 i‡(
îr
)

909 i‡(
p
->
fd
 != -1)

910 
	`˛o£
 (
p
->
fd
);

911 i‡(
p
->
c⁄fig_fd
 != -1)

912 
	`˛o£
 (
p
->
c⁄fig_fd
);

914  
îr
;

915 
	}
}

918 
˛ib_îr‹_t
 *

919 
	$vlib_pci_ªad_wrôe_c⁄fig
 (
vlib_pci_dev_h™dÀ_t
 
h
,

920 
vlib_ªad_‹_wrôe_t
 
ªad_‹_wrôe
,

921 
uw‹d
 
addªss
, *
d©a
, 
u32
 
n_byãs
)

923 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

924 
n
;

926 i‡(
ªad_‹_wrôe
 =
VLIB_READ
)

927 
n
 = 
	`¥ód
 (
p
->
c⁄fig_fd
, 
d©a
, 
n_byãs
,Ö->
c⁄fig_off£t
 + 
addªss
);

929 
n
 = 
	`pwrôe
 (
p
->
c⁄fig_fd
, 
d©a
, 
n_byãs
,Ö->
c⁄fig_off£t
 + 
addªss
);

931 i‡(
n
 !
n_byãs
)

932  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%s",

933 
ªad_‹_wrôe
 =
VLIB_READ


937 
	}
}

939 
˛ib_îr‹_t
 *

940 
	$vlib_pci_m≠_ªgi⁄_öt
 (
vlib_pci_dev_h™dÀ_t
 
h
,

941 
u32
 
b¨
, 
u8
 * 
addr
, **
ªsu…
)

943 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

944 
fd
 = -1;

945 
˛ib_îr‹_t
 *
îr‹
;

946 
Êags
 = 
MAP_SHARED
;

947 
u64
 
size
 = 0, 
off£t
 = 0;

949 
	`ASSERT
 (
b¨
 <= 5);

951 
îr‹
 = 0;

953 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_UIO
)

955 
u8
 *
fûe_«me
;

956 
°©
 
°©_buf
;

957 
fûe_«me
 = 
	`f‹m©
 (0, "%s/%U/ªsour˚%d%c", 
sysfs_pci_dev_∑th
,

958 
f‹m©_vlib_pci_addr
, &
p
->
addr
, 
b¨
, 0);

960 
fd
 = 
	`›í
 ((*Ë
fûe_«me
, 
O_RDWR
);

961 i‡(
fd
 < 0)

963 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í `%s'", 
fûe_«me
);

964 
	`vec_‰ì
 (
fûe_«me
);

965  
îr‹
;

968 i‡(
	`f°©
 (
fd
, &
°©_buf
) < 0)

970 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "f°© `%s'", 
fûe_«me
);

971 
	`vec_‰ì
 (
fûe_«me
);

972 
	`˛o£
 (
fd
);

973  
îr‹
;

976 
	`vec_‰ì
 (
fûe_«me
);

977 i‡(
addr
 != 0)

978 
Êags
 |
MAP_FIXED
;

979 
size
 = 
°©_buf
.
°_size
;

980 
off£t
 = 0;

982 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_VFIO
)

984 
vfio_ªgi⁄_öfo
 
ªg
 = { 0 };

985 
ªg
.
¨gsz
 =  (
vfio_ªgi⁄_öfo
);

986 
ªg
.
ödex
 = 
b¨
;

987 i‡(
	`io˘l
 (
p
->
fd
, 
VFIO_DEVICE_GET_REGION_INFO
, &
ªg
) < 0)

988  
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_DEVICE_GET_INFO) "

989 "'%U'", 
f‹m©_vlib_pci_addr
,

990 &
p
->
addr
);

991 
fd
 = 
p
->fd;

992 
size
 = 
ªg
.size;

993 
off£t
 = 
ªg
.offset;

996 
	`ASSERT
 (0);

998 *
ªsu…
 = 
	`mm≠
 (
addr
, 
size
, 
PROT_READ
 | 
PROT_WRITE
, 
Êags
, 
fd
, 
off£t
);

999 i‡(*
ªsu…
 == (*) -1)

1001 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "mm≠ `BAR%u'", 
b¨
);

1002 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_UIO
)

1003 
	`˛o£
 (
fd
);

1004  
îr‹
;

1008 
	`vec_vÆid©e_öô_em±y
 (
p
->
ªgi⁄s
, 
b¨
,

1009 (
löux_pci_ªgi⁄_t
Ë{ .
fd
 = -1});

1011 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_UIO
)

1012 
p
->
ªgi⁄s
[
b¨
].
fd
 = fd;

1013 
p
->
ªgi⁄s
[
b¨
].
addr
 = *
ªsu…
;

1014 
p
->
ªgi⁄s
[
b¨
].
size
 = size;

1016 
	}
}

1018 
˛ib_îr‹_t
 *

1019 
	$vlib_pci_m≠_ªgi⁄
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u32
 
ªsour˚
, **
ªsu…
)

1021  (
	`vlib_pci_m≠_ªgi⁄_öt
 (
h
, 
ªsour˚
, 0 , 
ªsu…
));

1022 
	}
}

1024 
˛ib_îr‹_t
 *

1025 
	$vlib_pci_m≠_ªgi⁄_fixed
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u32
 
ªsour˚
, 
u8
 * 
addr
,

1026 **
ªsu…
)

1028  (
	`vlib_pci_m≠_ªgi⁄_öt
 (
h
, 
ªsour˚
, 
addr
, 
ªsu…
));

1029 
	}
}

1031 
˛ib_îr‹_t
 *

1032 
	$vlib_pci_devi˚_›í
 (
vlib_pci_addr_t
 * 
addr
,

1033 
pci_devi˚_id_t
 
ids
[], 
vlib_pci_dev_h™dÀ_t
 * 
h™dÀ
)

1035 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

1036 
vlib_pci_devi˚_öfo_t
 *
di
;

1037 
löux_pci_devi˚_t
 *
p
;

1038 
˛ib_îr‹_t
 *
îr
 = 0;

1039 
pci_devi˚_id_t
 *
i
;

1041 
di
 = 
	`vlib_pci_gë_devi˚_öfo
 (
addr
, &
îr
);

1043 i‡(
îr
)

1044  
îr
;

1045 
i
 = 
ids
; i->
víd‹_id
 != 0; i++)

1046 i‡(
i
->
víd‹_id
 =
di
->víd‹_id && i->
devi˚_id
 == di->device_id)

1049 i‡(
i
->
víd‹_id
 == 0)

1050  
	`˛ib_îr‹_ªtu∫
 (0, "Wrong vendor or device id");

1052 
	`poﬁ_gë
 (
Õm
->
löux_pci_devi˚s
, 
p
);

1053 
p
->
h™dÀ
 =Ö - 
Õm
->
löux_pci_devi˚s
;

1054 
p
->
ötx_úq
.
fd
 = -1;

1056 i‡(
di
->
iommu_group
 != -1)

1057 
îr
 = 
	`add_devi˚_vfio
 (
p
, 
di
, 0);

1059 
îr
 = 
	`add_devi˚_uio
 (
p
, 
di
, 0);

1060 i‡(
îr
)

1061 
îr‹
;

1063 *
h™dÀ
 = 
p
->handle;

1065 
îr‹
:

1066 
	`vlib_pci_‰ì_devi˚_öfo
 (
di
);

1067 i‡(
îr
)

1069 
	`mem£t
 (
p
, 0,  (
löux_pci_devi˚_t
));

1070 
	`poﬁ_put
 (
Õm
->
löux_pci_devi˚s
, 
p
);

1073  
îr
;

1074 
	}
}

1077 
	$vlib_pci_devi˚_˛o£
 (
vlib_pci_dev_h™dÀ_t
 
h
)

1079 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

1080 
löux_pci_devi˚_t
 *
p
 = 
	`löux_pci_gë_devi˚
 (
h
);

1081 
löux_pci_úq_t
 *
úq
;

1082 
löux_pci_ªgi⁄_t
 *
ªs
;

1083 
˛ib_îr‹_t
 *
îr
 = 0;

1085 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_UIO
)

1087 
úq
 = &
p
->
ötx_úq
;

1088 
	`˛ib_fûe_dñ_by_ödex
 (&
fûe_maö
, 
úq
->
˛ib_fûe_ödex
);

1089 
	`˛o£
 (
p
->
c⁄fig_fd
);

1091 i‡(
p
->
ty≥
 =
LINUX_PCI_DEVICE_TYPE_VFIO
)

1093 
úq
 = &
p
->
ötx_úq
;

1095 i‡(
úq
->
fd
 != -1)

1097 
îr
 = 
	`vfio_£t_úqs
 (
p
, 
VFIO_PCI_INTX_IRQ_INDEX
, 0, 0,

1098 
VFIO_IRQ_SET_ACTION_TRIGGER
, 0);

1099 
	`˛ib_îr‹_‰ì
 (
îr
);

1100 
	`˛ib_fûe_dñ_by_ödex
 (&
fûe_maö
, 
úq
->
˛ib_fûe_ödex
);

1101 
	`˛o£
 (
úq
->
fd
);

1105 i‡(
	`vec_Àn
 (
p
->
msix_úqs
))

1107 
îr
 = 
	`vfio_£t_úqs
 (
p
, 
VFIO_PCI_MSIX_IRQ_INDEX
, 0, 0,

1108 
VFIO_IRQ_SET_ACTION_TRIGGER
, 0);

1109 
	`˛ib_îr‹_‰ì
 (
îr
);

1111 
	`vec_f‹óch
 (
úq
, 
p
->
msix_úqs
)

1113 i‡(
úq
->
fd
 == -1)

1115 
	`˛ib_fûe_dñ_by_ödex
 (&
fûe_maö
, 
úq
->
˛ib_fûe_ödex
);

1116 
	`˛o£
 (
úq
->
fd
);

1119 
	`vec_‰ì
 (
p
->
msix_úqs
);

1124 
	`vec_f‹óch
 (
ªs
, 
p
->
ªgi⁄s
)

1126 i‡(
ªs
->
size
 == 0)

1128 
	`munm≠
 (
ªs
->
addr
,Ñes->
size
);

1129 i‡(
ªs
->
fd
 != -1)

1130 
	`˛o£
 (
ªs
->
fd
);

1133 
	`vec_‰ì
 (
p
->
ªgi⁄s
);

1135 
	`˛o£
 (
p
->
fd
);

1136 
	`mem£t
 (
p
, 0,  (
löux_pci_devi˚_t
));

1137 
	`poﬁ_put
 (
Õm
->
löux_pci_devi˚s
, 
p
);

1138 
	}
}

1141 
	$öô_devi˚_‰om_ªgi°îed
 (
vlib_pci_devi˚_öfo_t
 * 
di
)

1143 
vlib_pci_maö_t
 *
pm
 = &
pci_maö
;

1144 
löux_pci_maö_t
 *
Õm
 = &
löux_pci_maö
;

1145 
pci_devi˚_ªgi°øti⁄_t
 *
r
;

1146 
pci_devi˚_id_t
 *
i
;

1147 
˛ib_îr‹_t
 *
îr
 = 0;

1148 
löux_pci_devi˚_t
 *
p
;

1150 
	`poﬁ_gë
 (
Õm
->
löux_pci_devi˚s
, 
p
);

1151 
p
->
h™dÀ
 =Ö - 
Õm
->
löux_pci_devi˚s
;

1152 
p
->
ötx_úq
.
fd
 = -1;

1154 
r
 = 
pm
->
pci_devi˚_ªgi°øti⁄s
;

1156 
r
)

1158 
i
 = 
r
->
suµ‹ãd_devi˚s
; i->
víd‹_id
 != 0; i++)

1159 i‡(
i
->
víd‹_id
 =
di
->víd‹_id && i->
devi˚_id
 == di->device_id)

1161 i‡(
di
->
iommu_group
 != -1)

1162 
îr
 = 
	`add_devi˚_vfio
 (
p
, 
di
, 
r
);

1164 
îr
 = 
	`add_devi˚_uio
 (
p
, 
di
, 
r
);

1166 i‡(
îr
)

1167 
	`˛ib_îr‹_ªp‹t
 (
îr
);

1171 
r
 =Ñ->
√xt_ªgi°øti⁄
;

1175 
	`mem£t
 (
p
, 0,  (
löux_pci_devi˚_t
));

1176 
	`poﬁ_put
 (
Õm
->
löux_pci_devi˚s
, 
p
);

1177 
	}
}

1179 
˛ib_îr‹_t
 *

1180 
	$sˇn_pci_addr
 (*
¨g
, 
u8
 * 
dev_dú_«me
, u8 * 
ign‹ed
)

1182 
vlib_pci_addr_t
 
addr
, **
addrv
 = 
¨g
;

1183 
unf‹m©_öput_t
 
öput
;

1184 
˛ib_îr‹_t
 *
îr
 = 0;

1186 
	`unf‹m©_öô_°rög
 (&
öput
, (*Ë
dev_dú_«me
,

1187 
	`vec_Àn
 (
dev_dú_«me
));

1189 i‡(!
	`unf‹m©
 (&
öput
, "/sys/bus/pci/devices/%U",

1190 
unf‹m©_vlib_pci_addr
, &
addr
))

1191 
îr
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unf‹m©Éº‹ `%v`", 
dev_dú_«me
);

1193 
	`unf‹m©_‰ì
 (&
öput
);

1195 i‡(
îr
)

1196  
îr
;

1198 
	`vec_add1
 (*
addrv
, 
addr
);

1200 
	}
}

1203 
	$pci_addr_cmp
 (*
v1
, *
v2
)

1205 
vlib_pci_addr_t
 *
a1
 = 
v1
;

1206 
vlib_pci_addr_t
 *
a2
 = 
v2
;

1208 i‡(
a1
->
domaö
 > 
a2
->domain)

1210 i‡(
a1
->
domaö
 < 
a2
->domain)

1212 i‡(
a1
->
bus
 > 
a2
->bus)

1214 i‡(
a1
->
bus
 < 
a2
->bus)

1216 i‡(
a1
->
¶Ÿ
 > 
a2
->slot)

1218 i‡(
a1
->
¶Ÿ
 < 
a2
->slot)

1220 i‡(
a1
->
fun˘i⁄
 > 
a2
->function)

1222 i‡(
a1
->
fun˘i⁄
 < 
a2
->function)

1225 
	}
}

1227 
vlib_pci_addr_t
 *

1228 
	$vlib_pci_gë_Æl_dev_addrs
 ()

1230 
vlib_pci_addr_t
 *
addrs
 = 0;

1231 
˛ib_îr‹_t
 *
îr
;

1232 
îr
 = 
	`f‹óch_dúe˘‹y_fûe
 ((*Ë
sysfs_pci_dev_∑th
, 
sˇn_pci_addr
,

1233 &
addrs
, 0);

1234 i‡(
îr
)

1236 
	`vec_‰ì
 (
addrs
);

1240 
	`vec_s‹t_wôh_fun˘i⁄
 (
addrs
, 
pci_addr_cmp
);

1242  
addrs
;

1243 
	}
}

1245 
˛ib_îr‹_t
 *

1246 
	$löux_pci_öô
 (
vlib_maö_t
 * 
vm
)

1248 
vlib_pci_maö_t
 *
pm
 = &
pci_maö
;

1249 
vlib_pci_addr_t
 *
addr
 = 0, *
addrs
;

1250 
˛ib_îr‹_t
 *
îr‹
;

1252 
pm
->
vlib_maö
 = 
vm
;

1254 i‡((
îr‹
 = 
	`vlib_ˇŒ_öô_fun˘i⁄
 (
vm
, 
unix_öput_öô
)))

1255  
îr‹
;

1257 
	`ASSERT
 ( (
vlib_pci_addr_t
Ë= (
u32
));

1259 
addrs
 = 
	`vlib_pci_gë_Æl_dev_addrs
 ();

1261 
	`vec_f‹óch
 (
addr
, 
addrs
)

1263 
vlib_pci_devi˚_öfo_t
 *
d
;

1264 i‡((
d
 = 
	`vlib_pci_gë_devi˚_öfo
 (
addr
, 0)))

1266 
	`öô_devi˚_‰om_ªgi°îed
 (
d
);

1267 
	`vlib_pci_‰ì_devi˚_öfo
 (
d
);

1272  
îr‹
;

1273 
	}
}

1275 
VLIB_INIT_FUNCTION
 (
löux_pci_öô
);

	@linux/physmem.c

40 
	~<uni°d.h
>

41 
	~<sys/ty≥s.h
>

42 
	~<sys/mou¡.h
>

43 
	~<sys/mm™.h
>

44 
	~<sys/f˙é.h
>

45 
	~<sys/°©.h
>

46 
	~<uni°d.h
>

48 
	~<vµö‰a/löux/sysˇŒ.h
>

49 
	~<vµö‰a/löux/sysfs.h
>

50 
	~<vlib/vlib.h
>

51 
	~<vlib/physmem.h
>

52 
	~<vlib/unix/unix.h
>

53 
	~<vlib/pci/pci.h
>

54 
	~<vlib/löux/vfio.h
>

57 
	$unix_physmem_Æloc_Æig√d
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

58 
uw‹d
 
n_byãs
, uw‹d 
Æignmít
)

60 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

61 
uw‹d
 
lo_off£t
, 
hi_off£t
;

62 
uw‹d
 *
to_‰ì
 = 0;

64 i‡(
¥
->
hóp
 == 0)

68 
Æignmít
 = 
	`˛ib_max
 (Æignmít, 
CLIB_CACHE_LINE_BYTES
);

72 
	`mhóp_gë_Æig√d
 (
¥
->
hóp
, 
n_byãs
,

73  
Æignmít
,

75 &
lo_off£t
);

78 i‡(
lo_off£t
 == ~0)

82 
hi_off£t
 = 
lo_off£t
 + 
n_byãs
 - 1;

84 i‡(((
	`poöãr_to_uw‹d
 (
¥
->
hóp
Ë+ 
lo_off£t
Ë>>Ör->
log2_∑ge_size
) ==

85 ((
	`poöãr_to_uw‹d
 (
¥
->
hóp
Ë+ 
hi_off£t
Ë>>Ör->
log2_∑ge_size
))

90 
	`vec_add1
 (
to_‰ì
, 
lo_off£t
);

93 i‡(
to_‰ì
 != 0)

95 
uw‹d
 
i
;

96 
i
 = 0; i < 
	`vec_Àn
 (
to_‰ì
); i++)

97 
	`mhóp_put
 (
¥
->
hóp
, 
to_‰ì
[
i
]);

98 
	`vec_‰ì
 (
to_‰ì
);

101  
lo_off£t
 !~0 ? 
¥
->
hóp
 +Üo_offset : 0;

102 
	}
}

105 
	$unix_physmem_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
, *
x
)

107 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

109 
	`mhóp_put
 (
¥
->
hóp
, 
x
 -Ör->heap);

110 
	}
}

112 
˛ib_îr‹_t
 *

113 
	$unix_physmem_ªgi⁄_Æloc
 (
vlib_maö_t
 * 
vm
, *
«me
, 
u32
 
size
,

114 
u8
 
numa_node
, 
u32
 
Êags
,

115 
vlib_physmem_ªgi⁄_ödex_t
 * 
idx
)

117 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

118 
vlib_physmem_ªgi⁄_t
 *
¥
;

119 
˛ib_îr‹_t
 *
îr‹
 = 0;

120 
˛ib_mem_vm_Æloc_t
 
Æloc
 = { 0 };

121 
i
;

123 
	`poﬁ_gë
 (
vpm
->
ªgi⁄s
, 
¥
);

125 i‡((
¥
 - 
vpm
->
ªgi⁄s
) >= 256)

127 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "maximumÇumber ofÑegionsÑeached");

128 
îr‹
;

131 
Æloc
.
«me
 =Çame;

132 
Æloc
.
size
 = size;

133 
Æloc
.
numa_node
 =Çuma_node;

135 
Æloc
.
Êags
 = (Êag†& 
VLIB_PHYSMEM_F_SHARED
) ?

136 
CLIB_MEM_VM_F_SHARED
 : 
CLIB_MEM_VM_F_LOCKED
;

138 i‡((
Êags
 & 
VLIB_PHYSMEM_F_HUGETLB
))

140 
Æloc
.
Êags
 |
CLIB_MEM_VM_F_HUGETLB
;

141 
Æloc
.
Êags
 |
CLIB_MEM_VM_F_HUGETLB_PREALLOC
;

142 
Æloc
.
Êags
 |
CLIB_MEM_VM_F_NUMA_FORCE
;

146 
Æloc
.
Êags
 |
CLIB_MEM_VM_F_NUMA_PREFER
;

149 
îr‹
 = 
	`˛ib_mem_vm_ext_Æloc
 (&
Æloc
);

150 i‡(
îr‹
)

151 
îr‹
;

153 
¥
->
ödex
 =Ö∏- 
vpm
->
ªgi⁄s
;

154 
¥
->
Êags
 = flags;

155 
¥
->
fd
 = 
Æloc
.fd;

156 
¥
->
mem
 = 
Æloc
.
addr
;

157 
¥
->
log2_∑ge_size
 = 
Æloc
.log2_page_size;

158 
¥
->
n_∑ges
 = 
Æloc
.n_pages;

159 
¥
->
size
 = (
u64
Ë¥->
n_∑ges
 << (u64Ë¥->
log2_∑ge_size
;

160 
¥
->
∑ge_mask
 = (1 <<Ör->
log2_∑ge_size
) - 1;

161 
¥
->
numa_node
 =Çuma_node;

162 
¥
->
«me
 = 
	`f‹m©
 (0, "%s",Çame);

164 
i
 = 0; i < 
¥
->
n_∑ges
; i++)

166 *
±r
 = 
¥
->
mem
 + (
i
 <<Ör->
log2_∑ge_size
);

167 
node
;

168 i‡((
	`move_∑ges
 (0, 1, &
±r
, 0, &
node
, 0Ë=0Ë&& (
numa_node
 !=Çode))

170 
	`˛ib_w¨nög
 ("physmemÖage forÑegion \'%s\'állocated onÅhe"

172 
¥
->
«me
,Ör->
numa_node
, 
node
, 
i
);

178 i‡((
vpm
->
Êags
 & 
VLIB_PHYSMEM_MAIN_F_HAVE_IOMMU
) ||

179 (
vpm
->
Êags
 & 
VLIB_PHYSMEM_MAIN_F_HAVE_PAGEMAP
) == 0)

180 
i
 = 0; i < 
¥
->
n_∑ges
; i++)

181 
	`vec_add1
 (
¥
->
∑ge_èbÀ
, 
	`poöãr_to_uw‹d
 (¥->
mem
) +

182 
i
 * (1 << 
¥
->
log2_∑ge_size
));

185 
¥
->
∑ge_èbÀ
 = 
	`˛ib_mem_vm_gë_∑ddr
 (¥->
mem
,Ör->
log2_∑ge_size
,

186 
¥
->
n_∑ges
);

188 
	`löux_vfio_dma_m≠_ªgi⁄s
 (
vm
);

190 i‡(
Êags
 & 
VLIB_PHYSMEM_F_INIT_MHEAP
)

192 
¥
->
hóp
 = 
	`mhóp_Æloc_wôh_Êags
 (¥->
mem
,Ör->
size
,

194 
MHEAP_FLAG_DISABLE_VM
 |

195 
MHEAP_FLAG_THREAD_SAFE
);

198 *
idx
 = 
¥
->
ödex
;

200 
d⁄e
;

202 
îr‹
:

203 
	`mem£t
 (
¥
, 0,  (*pr));

204 
	`poﬁ_put
 (
vpm
->
ªgi⁄s
, 
¥
);

206 
d⁄e
:

207  
îr‹
;

208 
	}
}

211 
	$unix_physmem_ªgi⁄_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
)

213 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

214 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

216 i‡(
¥
->
fd
 > 0)

217 
	`˛o£
 (
¥
->
fd
);

218 
	`munm≠
 (
¥
->
mem
,Ör->
size
);

219 
	`vec_‰ì
 (
¥
->
«me
);

220 
	`poﬁ_put
 (
vpm
->
ªgi⁄s
, 
¥
);

221 
	}
}

223 
˛ib_îr‹_t
 *

224 
	$unix_physmem_öô
 (
vlib_maö_t
 * 
vm
)

226 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

227 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

228 
˛ib_îr‹_t
 *
îr‹
 = 0;

229 
u64
 *
±
 = 0;

232 i‡(
vm
->
os_physmem_Æloc_Æig√d
)

233  
îr‹
;

236 
±
 = 
	`˛ib_mem_vm_gë_∑ddr
 (&±, 
	`mö_log2
 (
	`sysc⁄f
 (
_SC_PAGESIZE
)), 1);

237 i‡(
±
[0])

238 
vpm
->
Êags
 |
VLIB_PHYSMEM_MAIN_F_HAVE_PAGEMAP
;

239 
	`vec_‰ì
 (
±
);

241 i‡((
îr‹
 = 
	`löux_vfio_öô
 (
vm
)))

242  
îr‹
;

244 i‡(
lvm
->
Êags
 & 
LINUX_VFIO_F_HAVE_IOMMU
)

245 
vpm
->
Êags
 |
VLIB_PHYSMEM_MAIN_F_HAVE_IOMMU
;

247 
vm
->
os_physmem_Æloc_Æig√d
 = 
unix_physmem_Æloc_Æig√d
;

248 
vm
->
os_physmem_‰ì
 = 
unix_physmem_‰ì
;

249 
vm
->
os_physmem_ªgi⁄_Æloc
 = 
unix_physmem_ªgi⁄_Æloc
;

250 
vm
->
os_physmem_ªgi⁄_‰ì
 = 
unix_physmem_ªgi⁄_‰ì
;

252  
îr‹
;

253 
	}
}

255 
˛ib_îr‹_t
 *

256 
	$show_physmem
 (
vlib_maö_t
 * 
vm
,

257 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

259 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

260 
vlib_physmem_ªgi⁄_t
 *
¥
;

263 
	`poﬁ_f‹óch
 (
¥
, 
vpm
->
ªgi⁄s
, (

265 
	`vlib_˛i_ouçut
 (
vm
, "index %uÇame '%s'Öage-size %uKBÇum-pages %d "

267 
¥
->
ödex
,Ör->
«me
, (1 << (¥->
log2_∑ge_size
 -10)),

268 
¥
->
n_∑ges
,Ör->
numa_node
,Ör->
fd
);

269 i‡(
¥
->
hóp
)

270 
	`vlib_˛i_ouçut
 (
vm
, " %U", 
f‹m©_mhóp
, 
¥
->
hóp
, 1);

272 
	`vlib_˛i_ouçut
 (
vm
, "Ço heap\n");

276 
	}
}

279 
VLIB_CLI_COMMAND
 (
show_physmem_comm™d
, ) = {

280 .
∑th
 = "showÖhysmem",

281 .
	gsh‹t_hñp
 = "ShowÖhysical memoryállocation",

282 .
	gfun˘i⁄
 = 
show_physmem
,

	@linux/vfio.c

40 
	~<uni°d.h
>

41 
	~<sys/ty≥s.h
>

42 
	~<sys/°©.h
>

43 
	~<f˙é.h
>

44 
	~<löux/vfio.h
>

45 
	~<sys/io˘l.h
>

47 
	~<vµö‰a/löux/sysfs.h
>

49 
	~<vlib/vlib.h
>

50 
	~<vlib/unix/unix.h
>

51 
	~<vlib/pci/pci.h
>

52 
	~<vlib/löux/vfio.h
>

53 
	~<vlib/physmem.h
>

55 
löux_vfio_maö_t
 
	gvfio_maö
;

58 
	$m≠_ªgi⁄s
 (
vlib_maö_t
 * 
vm
, 
fd
)

60 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

61 
vlib_physmem_ªgi⁄_t
 *
¥
;

62 
vfio_iommu_ty≥1_dma_m≠
 
dm
 = { 0 };

63 
i
;

65 
dm
.
¨gsz
 =  (
vfio_iommu_ty≥1_dma_m≠
);

66 
dm
.
Êags
 = 
VFIO_DMA_MAP_FLAG_READ
 | 
VFIO_DMA_MAP_FLAG_WRITE
;

69 
	`poﬁ_f‹óch
 (
¥
, 
vpm
->
ªgi⁄s
,

71 
	`vec_f‹óch_ödex
 (
i
, 
¥
->
∑ge_èbÀ
)

73 
rv
;

74 
dm
.
vaddr
 = 
	`poöãr_to_uw‹d
 (
¥
->
mem
Ë+ (
i
 <<Ör->
log2_∑ge_size
);

75 
dm
.
size
 = 1 << 
¥
->
log2_∑ge_size
;

76 
dm
.
iova
 = 
¥
->
∑ge_èbÀ
[
i
];

77 i‡((
rv
 = 
	`io˘l
 (
fd
, 
VFIO_IOMMU_MAP_DMA
, &
dm
)))

78  
rv
;

83 
	}
}

85 
˛ib_îr‹_t
 *

86 
	$sˇn_vfio_fd
 (*
¨g
, 
u8
 * 
∑th_«me
, u8 * 
fûe_«me
)

88 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

89 c⁄° 
‚
[] = "/dev/vfio/vfio";

90 
buff
[ (
‚
)] = { 0 };

91 
fd
;

92 
u8
 *
∑th
 = 
	`f‹m©
 (0, "%v%c", 
∑th_«me
, 0);

94 i‡(
	`ªadlök
 ((*Ë
∑th
, 
buff
,  (
‚
)) + 1 !=  (fn))

95 
d⁄e
;

97 i‡(
	`°∫cmp
 (
‚
, 
buff
,  (fn)))

98 
d⁄e
;

100 
fd
 = 
	`©oi
 ((*Ë
fûe_«me
);

101 i‡(
fd
 !
lvm
->
c⁄èöî_fd
)

102 
lvm
->
ext_c⁄èöî_fd
 = 
	`©oi
 ((*Ë
fûe_«me
);

104 
d⁄e
:

105 
	`vec_‰ì
 (
∑th
);

107 
	}
}

110 
	$löux_vfio_dma_m≠_ªgi⁄s
 (
vlib_maö_t
 * 
vm
)

112 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

114 i‡(
lvm
->
c⁄èöî_fd
 != -1)

115 
	`m≠_ªgi⁄s
 (
vm
, 
lvm
->
c⁄èöî_fd
);

117 i‡(
lvm
->
ext_c⁄èöî_fd
 == -1)

118 
	`f‹óch_dúe˘‹y_fûe
 ("/¥oc/£lf/fd", 
sˇn_vfio_fd
, 0, 0);

120 i‡(
lvm
->
ext_c⁄èöî_fd
 != -1)

121 
	`m≠_ªgi⁄s
 (
vm
, 
lvm
->
ext_c⁄èöî_fd
);

122 
	}
}

124 
löux_pci_vfio_iommu_group_t
 *

125 
	$gë_vfio_iommu_group
 (
group
)

127 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

128 
uw‹d
 *
p
;

130 
p
 = 
	`hash_gë
 (
lvm
->
iommu_poﬁ_ödex_by_group
, 
group
);

132  
p
 ? 
	`poﬁ_ñt_©_ödex
 (
lvm
->
iommu_groups
,Ö[0]) : 0;

133 
	}
}

135 
˛ib_îr‹_t
 *

136 
	$›í_vfio_iommu_group
 (
group
)

138 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

139 
löux_pci_vfio_iommu_group_t
 *
g
;

140 
˛ib_îr‹_t
 *
îr
 = 0;

141 
vfio_group_°©us
 
group_°©us
;

142 
u8
 *
s
 = 0;

143 
fd
;

145 
g
 = 
	`gë_vfio_iommu_group
 (
group
);

146 i‡(
g
)

148 
g
->
ªf˙t
++;

151 
s
 = 
	`f‹m©
 (s, "/dev/vfio/%u%c", 
group
, 0);

152 
fd
 = 
	`›í
 ((*Ë
s
, 
O_RDWR
);

153 i‡(
fd
 < 0)

154  
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í '%s'", 
s
);

156 
group_°©us
.
¨gsz
 =  (group_status);

157 i‡(
	`io˘l
 (
fd
, 
VFIO_GROUP_GET_STATUS
, &
group_°©us
) < 0)

159 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_GROUP_GET_STATUS) '%s'",

160 
s
);

161 
îr‹
;

164 i‡(!(
group_°©us
.
Êags
 & 
VFIO_GROUP_FLAGS_VIABLE
))

166 
îr
 = 
	`˛ib_îr‹_ªtu∫
 (0, "iommu group %d isÇot viable (notáll "

168 
group
);

169 
îr‹
;

172 i‡(
	`io˘l
 (
fd
, 
VFIO_GROUP_SET_CONTAINER
, &
lvm
->
c⁄èöî_fd
) < 0)

174 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_GROUP_SET_CONTAINER) '%s'",

175 
s
);

176 
îr‹
;

179 i‡(
lvm
->
iommu_mode
 == 0)

181 i‡(
	`io˘l
 (
lvm
->
c⁄èöî_fd
, 
VFIO_SET_IOMMU
, 
VFIO_TYPE1_IOMMU
) < 0)

183 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_SET_IOMMU) "

185 
îr‹
;

187 
lvm
->
iommu_mode
 = 
VFIO_TYPE1_IOMMU
;

191 
	`poﬁ_gë
 (
lvm
->
iommu_groups
, 
g
);

192 
g
->
fd
 = fd;

193 
g
->
ªf˙t
 = 1;

194 
	`hash_£t
 (
lvm
->
iommu_poﬁ_ödex_by_group
, 
group
, 
g
 -Üvm->
iommu_groups
);

195 
	`vec_‰ì
 (
s
);

197 
îr‹
:

198 
	`˛o£
 (
fd
);

199  
îr
;

200 
	}
}

202 
˛ib_îr‹_t
 *

203 
	$löux_vfio_group_gë_devi˚_fd
 (
vlib_pci_addr_t
 * 
addr
, *
fdp
)

205 
˛ib_îr‹_t
 *
îr
 = 0;

206 
löux_pci_vfio_iommu_group_t
 *
g
;

207 
u8
 *
s
 = 0;

208 
iommu_group
;

209 
u8
 *
tmp°r
;

210 
fd
;

212 
s
 = 
	`f‹m©
 (s, "/sys/bus/pci/devi˚s/%U/iommu_group", 
f‹m©_vlib_pci_addr
,

213 
addr
);

214 
tmp°r
 = 
	`˛ib_sysfs_lök_to_«me
 ((*Ë
s
);

215 i‡(
tmp°r
)

217 
iommu_group
 = 
	`©oi
 ((*Ë
tmp°r
);

218 
	`vec_‰ì
 (
tmp°r
);

222 
îr
 = 
	`˛ib_îr‹_ªtu∫
 (0, "Cannot find IOMMU group for PCI device ",

223 "'%U'", 
f‹m©_vlib_pci_addr
, 
addr
);

224 
îr‹
;

226 
	`vec_ª£t_Àngth
 (
s
);

228 i‡((
îr
 = 
	`›í_vfio_iommu_group
 (
iommu_group
)))

229  
îr
;

231 
g
 = 
	`gë_vfio_iommu_group
 (
iommu_group
);

233 
s
 = 
	`f‹m©
 (s, "%U%c", 
f‹m©_vlib_pci_addr
, 
addr
, 0);

234 i‡((
fd
 = 
	`io˘l
 (
g
->fd, 
VFIO_GROUP_GET_DEVICE_FD
, (*Ë
s
)) < 0)

236 
îr
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ioctl(VFIO_GROUP_GET_DEVICE_FD) '%U'",

237 
f‹m©_vlib_pci_addr
, 
addr
);

238 
îr‹
;

240 
	`vec_ª£t_Àngth
 (
s
);

242 *
fdp
 = 
fd
;

244 
îr‹
:

245 
	`vec_‰ì
 (
s
);

246  
îr
;

247 
	}
}

249 
˛ib_îr‹_t
 *

250 
	$löux_vfio_öô
 (
vlib_maö_t
 * 
vm
)

252 
löux_vfio_maö_t
 *
lvm
 = &
vfio_maö
;

253 
fd
;

255 
lvm
->
ext_c⁄èöî_fd
 = -1;

257 
fd
 = 
	`›í
 ("/dev/vfio/vfio", 
O_RDWR
);

260 i‡(
fd
 != -1)

262 i‡(
	`io˘l
 (
fd
, 
VFIO_GET_API_VERSION
Ë!
VFIO_API_VERSION
)

264 
	`˛o£
 (
fd
);

265 
fd
 = -1;

267 i‡(
	`io˘l
 (
fd
, 
VFIO_CHECK_EXTENSION
, 
VFIO_TYPE1_IOMMU
) == 1)

268 
lvm
->
Êags
 |
LINUX_VFIO_F_HAVE_IOMMU
;

271 
lvm
->
iommu_poﬁ_ödex_by_group
 = 
	`hash_¸óã
 (0,  (
uw‹d
));

272 
lvm
->
c⁄èöî_fd
 = 
fd
;

274 
	}
}

	@linux/vfio.h

16 #i‚de‡
ö˛uded_vlib_löux_vfio_h


17 
	#ö˛uded_vlib_löux_vfio_h


	)

21 
	mgroup
;

22 
	mfd
;

23 
	mªf˙t
;

24 } 
	tlöux_pci_vfio_iommu_group_t
;

28 
u32
 
	mÊags
;

29 
	#LINUX_VFIO_F_HAVE_IOMMU
 (1 << 0)

	)

30 
	mc⁄èöî_fd
;

31 
	mext_c⁄èöî_fd
;

34 
	miommu_mode
;

37 
löux_pci_vfio_iommu_group_t
 *
	miommu_groups
;

40 
uw‹d
 *
	miommu_poﬁ_ödex_by_group
;

42 } 
	tlöux_vfio_maö_t
;

44 
löux_vfio_maö_t
 
vfio_maö
;

46 
˛ib_îr‹_t
 *
löux_vfio_öô
 (
vlib_maö_t
 * 
vm
);

47 
löux_vfio_dma_m≠_ªgi⁄s
 (
vlib_maö_t
 * 
vm
);

48 
˛ib_îr‹_t
 *
löux_vfio_group_gë_devi˚_fd
 (
vlib_pci_addr_t
 * 
addr
,

49 *
fd
);

	@main.c

40 
	~<m©h.h
>

41 
	~<vµö‰a/f‹m©.h
>

42 
	~<vlib/vlib.h
>

43 
	~<vlib/thªads.h
>

44 
	~<vµö‰a/tw_timî_1t_3w_1024¶_ov.h
>

46 
	~<vlib/unix/unix.h
>

47 
	~<vlib/unix/cj.h
>

49 
	gCJ_GLOBAL_LOG_PROTOTYPE
;

53 
	#VLIB_FRAME_SIZE_ALLOC
 (
VLIB_FRAME_SIZE
 + 4)

	)

55 
u32
 
	gwøps
;

57 
Æways_ölöe
 
u32


58 
	$vlib_‰ame_byãs
 (
u32
 
n_sˇœr_byãs
, u32 
n_ve˘‹_byãs
)

60 
u32
 
n_byãs
;

63 
n_byãs
 = 
	`vlib_‰ame_ve˘‹_byã_off£t
 (
n_sˇœr_byãs
);

68 
	#VLIB_FRAME_SIZE_EXTRA
 4

	)

69 
n_byãs
 +(
VLIB_FRAME_SIZE
 + 
VLIB_FRAME_SIZE_EXTRA
Ë* 
n_ve˘‹_byãs
;

73 
	#VLIB_FRAME_MAGIC
 (0xabadc0ed)

	)

74 
n_byãs
 + (
u32
);

77 
n_byãs
 = 
	`round_pow2
 (n_byãs, 
CLIB_CACHE_LINE_BYTES
);

79  
n_byãs
;

80 
	}
}

82 
Æways_ölöe
 
u32
 *

83 
	$vlib_‰ame_föd_magic
 (
vlib_‰ame_t
 * 
f
, 
vlib_node_t
 * 
node
)

85 *
p
 = 
f
;

87 
p
 +
	`vlib_‰ame_ve˘‹_byã_off£t
 (
node
->
sˇœr_size
);

89 
p
 +(
VLIB_FRAME_SIZE
 + 
VLIB_FRAME_SIZE_EXTRA
Ë* 
node
->
ve˘‹_size
;

91  
p
;

92 
	}
}

94 
vlib_‰ame_size_t
 *

95 
	$gë_‰ame_size_öfo
 (
vlib_node_maö_t
 * 
nm
,

96 
u32
 
n_sˇœr_byãs
, u32 
n_ve˘‹_byãs
)

98 
uw‹d
 
key
 = (
n_sˇœr_byãs
 << 16Ë| 
n_ve˘‹_byãs
;

99 
uw‹d
 *
p
, 
i
;

101 
p
 = 
	`hash_gë
 (
nm
->
‰ame_size_hash
, 
key
);

102 i‡(
p
)

103 
i
 = 
p
[0];

106 
i
 = 
	`vec_Àn
 (
nm
->
‰ame_sizes
);

107 
	`vec_vÆid©e
 (
nm
->
‰ame_sizes
, 
i
);

108 
	`hash_£t
 (
nm
->
‰ame_size_hash
, 
key
, 
i
);

111  
	`vec_ñt_©_ödex
 (
nm
->
‰ame_sizes
, 
i
);

112 
	}
}

114 
u32


115 
	$vlib_‰ame_Æloc_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
,

116 
u32
 
‰ame_Êags
)

118 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

119 
vlib_‰ame_size_t
 *
fs
;

120 
vlib_node_t
 *
to_node
;

121 
vlib_‰ame_t
 *
f
;

122 
u32
 
fi
, 
l
, 
n
, 
sˇœr_size
, 
ve˘‹_size
;

124 
to_node
 = 
	`vlib_gë_node
 (
vm
, 
to_node_ödex
);

126 
sˇœr_size
 = 
to_node
->scalar_size;

127 
ve˘‹_size
 = 
to_node
->vector_size;

129 
fs
 = 
	`gë_‰ame_size_öfo
 (
nm
, 
sˇœr_size
, 
ve˘‹_size
);

130 
n
 = 
	`vlib_‰ame_byãs
 (
sˇœr_size
, 
ve˘‹_size
);

131 i‡((
l
 = 
	`vec_Àn
 (
fs
->
‰ì_‰ame_ödi˚s
)) > 0)

134 
fi
 = 
fs
->
‰ì_‰ame_ödi˚s
[
l
 - 1];

135 
f
 = 
	`vlib_gë_‰ame_no_check
 (
vm
, 
fi
);

136 
	`_vec_Àn
 (
fs
->
‰ì_‰ame_ödi˚s
Ë
l
 - 1;

140 
f
 = 
	`˛ib_mem_Æloc_Æig√d_no_Áû
 (
n
, 
VLIB_FRAME_ALIGN
);

141 
fi
 = 
	`vlib_‰ame_ödex_no_check
 (
vm
, 
f
);

145 i‡(
CLIB_DEBUG
 > 0)

146 
	`mem£t
 (
f
, 0x„, 
n
);

150 
u32
 *
magic
;

152 
magic
 = 
	`vlib_‰ame_föd_magic
 (
f
, 
to_node
);

153 *
magic
 = 
VLIB_FRAME_MAGIC
;

156 
f
->
Êags
 = 
VLIB_FRAME_IS_ALLOCATED
 | 
‰ame_Êags
;

157 
f
->
n_ve˘‹s
 = 0;

158 
f
->
sˇœr_size
 = scalar_size;

159 
f
->
ve˘‹_size
 = vector_size;

161 
fs
->
n_Æloc_‰ames
 += 1;

163  
fi
;

164 
	}
}

168 
u32


169 
	$vlib_‰ame_Æloc
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
‰om_node_ru¡ime
,

170 
u32
 
to_√xt_ödex
)

172 
vlib_node_t
 *
‰om_node
;

174 
‰om_node
 = 
	`vlib_gë_node
 (
vm
, 
‰om_node_ru¡ime
->
node_ödex
);

175 
	`ASSERT
 (
to_√xt_ödex
 < 
	`vec_Àn
 (
‰om_node
->
√xt_nodes
));

177  
	`vlib_‰ame_Æloc_to_node
 (
vm
, 
‰om_node
->
√xt_nodes
[
to_√xt_ödex
],

179 
	}
}

181 
vlib_‰ame_t
 *

182 
	$vlib_gë_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
)

184 
u32
 
fi
 = 
	`vlib_‰ame_Æloc_to_node
 (
vm
, 
to_node_ödex
,

186 
VLIB_FRAME_FREE_AFTER_DISPATCH
);

187  
	`vlib_gë_‰ame
 (
vm
, 
fi
);

188 
	}
}

191 
	$vlib_put_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
, 
vlib_‰ame_t
 * 
f
)

193 
vlib_≥ndög_‰ame_t
 *
p
;

194 
vlib_node_t
 *
to_node
;

196 i‡(
f
->
n_ve˘‹s
 == 0)

199 
to_node
 = 
	`vlib_gë_node
 (
vm
, 
to_node_ödex
);

201 
	`vec_add2
 (
vm
->
node_maö
.
≥ndög_‰ames
, 
p
, 1);

203 
f
->
Êags
 |
VLIB_FRAME_PENDING
;

204 
p
->
‰ame_ödex
 = 
	`vlib_‰ame_ödex
 (
vm
, 
f
);

205 
p
->
node_ru¡ime_ödex
 = 
to_node
->
ru¡ime_ödex
;

206 
p
->
√xt_‰ame_ödex
 = 
VLIB_PENDING_FRAME_NO_NEXT_FRAME
;

207 
	}
}

211 
	$vlib_‰ame_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
r
, 
vlib_‰ame_t
 * 
f
)

213 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

214 
vlib_node_t
 *
node
;

215 
vlib_‰ame_size_t
 *
fs
;

216 
u32
 
‰ame_ödex
;

218 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
);

220 
node
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

221 
fs
 = 
	`gë_‰ame_size_öfo
 (
nm
, 
node
->
sˇœr_size
,Çode->
ve˘‹_size
);

223 
‰ame_ödex
 = 
	`vlib_‰ame_ödex
 (
vm
, 
f
);

225 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
);

228 i‡(
CLIB_DEBUG
 > 0)

230 
vlib_√xt_‰ame_t
 *
nf
;

231 
	`vec_f‹óch
 (
nf
, 
vm
->
node_maö
.
√xt_‰ames
)

232 
	`ASSERT
 (
nf
->
‰ame_ödex
 != frame_index);

235 
f
->
Êags
 &~
VLIB_FRAME_IS_ALLOCATED
;

237 
	`vec_add1
 (
fs
->
‰ì_‰ame_ödi˚s
, 
‰ame_ödex
);

238 
	`ASSERT
 (
fs
->
n_Æloc_‰ames
 > 0);

239 
fs
->
n_Æloc_‰ames
 -= 1;

240 
	}
}

242 
˛ib_îr‹_t
 *

243 
	$show_‰ame_°©s
 (
vlib_maö_t
 * 
vm
,

244 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

246 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

247 
vlib_‰ame_size_t
 *
fs
;

249 
	`vlib_˛i_ouçut
 (
vm
, "%=6s%=12s%=12s", "Size", "# Alloc", "# Free");

250 
	`vec_f‹óch
 (
fs
, 
nm
->
‰ame_sizes
)

252 
u32
 
n_Æloc
 = 
fs
->
n_Æloc_‰ames
;

253 
u32
 
n_‰ì
 = 
	`vec_Àn
 (
fs
->
‰ì_‰ame_ödi˚s
);

255 i‡(
n_Æloc
 + 
n_‰ì
 > 0)

256 
	`vlib_˛i_ouçut
 (
vm
, "%=6d%=12d%=12d",

257 
fs
 - 
nm
->
‰ame_sizes
, 
n_Æloc
, 
n_‰ì
);

261 
	}
}

264 
VLIB_CLI_COMMAND
 (
show_‰ame_°©s_˛i
, ) = {

265 .
∑th
 = "show vlib frame-allocation",

266 .
	gsh‹t_hñp
 = "ShowÇode dispatch frame statistics",

267 .
	gfun˘i⁄
 = 
show_‰ame_°©s
,

273 
	$vlib_√xt_‰ame_ch™ge_ow√rshù
 (
vlib_maö_t
 * 
vm
,

274 
vlib_node_ru¡ime_t
 * 
node_ru¡ime
,

275 
u32
 
√xt_ödex
)

277 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

278 
vlib_√xt_‰ame_t
 *
√xt_‰ame
;

279 
vlib_node_t
 *
node
, *
√xt_node
;

281 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ru¡ime
->
node_ödex
);

284 
	`ASSERT
 (
node
->
ty≥
 =
VLIB_NODE_TYPE_INTERNAL


285 || 
node
->
ty≥
 =
VLIB_NODE_TYPE_INPUT


286 || 
node
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
);

288 
	`ASSERT
 (
	`vec_Àn
 (
node
->
√xt_nodes
Ë=
node_ru¡ime
->
n_√xt_nodes
);

290 
√xt_‰ame
 =

291 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
node_ru¡ime
, 
√xt_ödex
);

292 
√xt_node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node
->
√xt_nodes
[
√xt_ödex
]);

294 i‡(
√xt_node
->
ow√r_node_ödex
 !
VLIB_INVALID_NODE_INDEX
)

297 
vlib_√xt_‰ame_t
 *
ow√r_√xt_‰ame
;

298 
vlib_√xt_‰ame_t
 
tmp
;

300 
ow√r_√xt_‰ame
 =

301 
	`vlib_node_gë_√xt_‰ame
 (
vm
,

302 
√xt_node
->
ow√r_node_ödex
,

303 
√xt_node
->
ow√r_√xt_ödex
);

306 
tmp
 = 
ow√r_√xt_‰ame
[0];

307 
ow√r_√xt_‰ame
[0] = 
√xt_‰ame
[0];

308 
√xt_‰ame
[0] = 
tmp
;

314 i‡(
√xt_‰ame
->
Êags
 & 
VLIB_FRAME_PENDING
)

316 
vlib_≥ndög_‰ame_t
 *
p
;

317 i‡(
√xt_‰ame
->
‰ame_ödex
 != ~0)

319 
	`vec_f‹óch
 (
p
, 
nm
->
≥ndög_‰ames
)

321 i‡(
p
->
‰ame_ödex
 =
√xt_‰ame
->frame_index)

323 
p
->
√xt_‰ame_ödex
 =

324 
√xt_‰ame
 - 
vm
->
node_maö
.
√xt_‰ames
;

333 
√xt_‰ame
->
Êags
 |
VLIB_FRAME_OWNER
;

337 
√xt_node
->
ow√r_node_ödex
 = 
node
->
ödex
;

338 
√xt_node
->
ow√r_√xt_ödex
 = 
√xt_ödex
;

341 
	`ASSERT
 (
√xt_‰ame
->
Êags
 & 
VLIB_FRAME_OWNER
);

342 
	}
}

346 
Æways_ölöe
 

347 
	$vÆid©e_‰ame_magic
 (
vlib_maö_t
 * 
vm
,

348 
vlib_‰ame_t
 * 
f
, 
vlib_node_t
 * 
n
, 
uw‹d
 
√xt_ödex
)

350 
vlib_node_t
 *
√xt_node
 = 
	`vlib_gë_node
 (
vm
, 
n
->
√xt_nodes
[
√xt_ödex
]);

351 
u32
 *
magic
 = 
	`vlib_‰ame_föd_magic
 (
f
, 
√xt_node
);

352 
	`ASSERT
 (
VLIB_FRAME_MAGIC
 =
magic
[0]);

353 
	}
}

355 
vlib_‰ame_t
 *

356 
	$vlib_gë_√xt_‰ame_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

357 
vlib_node_ru¡ime_t
 * 
node
,

358 
u32
 
√xt_ödex
, u32 
Æloˇã_√w_√xt_‰ame
)

360 
vlib_‰ame_t
 *
f
;

361 
vlib_√xt_‰ame_t
 *
nf
;

362 
u32
 
n_u£d
;

364 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
);

367 i‡(
	`PREDICT_FALSE
 (!(
nf
->
Êags
 & 
VLIB_FRAME_OWNER
)))

368 
	`vlib_√xt_‰ame_ch™ge_ow√rshù
 (
vm
, 
node
, 
√xt_ödex
);

371 i‡(
	`PREDICT_FALSE
 (!(
nf
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
)))

373 
nf
->
‰ame_ödex
 = 
	`vlib_‰ame_Æloc
 (
vm
, 
node
, 
√xt_ödex
);

374 
nf
->
Êags
 |
VLIB_FRAME_IS_ALLOCATED
;

377 
f
 = 
	`vlib_gë_‰ame
 (
vm
, 
nf
->
‰ame_ödex
);

381 i‡((
nf
->
Êags
 & 
VLIB_FRAME_PENDING
Ë&& !(
f
->flags & VLIB_FRAME_PENDING))

383 
nf
->
Êags
 &~
VLIB_FRAME_PENDING
;

384 
f
->
n_ve˘‹s
 = 0;

388 
n_u£d
 = 
f
->
n_ve˘‹s
;

389 i‡(
n_u£d
 >
VLIB_FRAME_SIZE
 || (
Æloˇã_√w_√xt_‰ame
 &&Ç_used > 0))

393 i‡(!(
nf
->
Êags
 & 
VLIB_FRAME_NO_FREE_AFTER_DISPATCH
))

395 
vlib_‰ame_t
 *
f_ﬁd
 = 
	`vlib_gë_‰ame
 (
vm
, 
nf
->
‰ame_ödex
);

396 
f_ﬁd
->
Êags
 |
VLIB_FRAME_FREE_AFTER_DISPATCH
;

400 
nf
->
‰ame_ödex
 = 
	`vlib_‰ame_Æloc
 (
vm
, 
node
, 
√xt_ödex
);

401 
f
 = 
	`vlib_gë_‰ame
 (
vm
, 
nf
->
‰ame_ödex
);

402 
n_u£d
 = 
f
->
n_ve˘‹s
;

406 
	`ASSERT
 (
n_u£d
 < 
VLIB_FRAME_SIZE
);

408 i‡(
CLIB_DEBUG
 > 0)

410 
	`vÆid©e_‰ame_magic
 (
vm
, 
f
,

411 
	`vlib_gë_node
 (
vm
, 
node
->
node_ödex
), 
√xt_ödex
);

414  
f
;

415 
	}
}

418 
	$vlib_put_√xt_‰ame_vÆid©e
 (
vlib_maö_t
 * 
vm
,

419 
vlib_node_ru¡ime_t
 * 
π
,

420 
u32
 
√xt_ödex
, u32 
n_ve˘‹s_À·
)

422 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

423 
vlib_√xt_‰ame_t
 *
nf
;

424 
vlib_‰ame_t
 *
f
;

425 
vlib_node_ru¡ime_t
 *
√xt_π
;

426 
vlib_node_t
 *
√xt_node
;

427 
u32
 
n_bef‹e
, 
n_a·î
;

429 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
π
, 
√xt_ödex
);

430 
f
 = 
	`vlib_gë_‰ame
 (
vm
, 
nf
->
‰ame_ödex
);

432 
	`ASSERT
 (
n_ve˘‹s_À·
 <
VLIB_FRAME_SIZE
);

433 
n_a·î
 = 
VLIB_FRAME_SIZE
 - 
n_ve˘‹s_À·
;

434 
n_bef‹e
 = 
f
->
n_ve˘‹s
;

436 
	`ASSERT
 (
n_a·î
 >
n_bef‹e
);

438 
√xt_π
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
],

439 
nf
->
node_ru¡ime_ödex
);

440 
√xt_node
 = 
	`vlib_gë_node
 (
vm
, 
√xt_π
->
node_ödex
);

441 i‡(
n_a·î
 > 0 && 
√xt_node
->
vÆid©e_‰ame
)

443 
u8
 *
msg
 = 
√xt_node
->
	`vÆid©e_‰ame
 (
vm
, 
π
, 
f
);

444 i‡(
msg
)

446 
	`˛ib_w¨nög
 ("%v", 
msg
);

447 
	`ASSERT
 (0);

449 
	`vec_‰ì
 (
msg
);

451 
	}
}

454 
	$vlib_put_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

455 
vlib_node_ru¡ime_t
 * 
r
,

456 
u32
 
√xt_ödex
, u32 
n_ve˘‹s_À·
)

458 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

459 
vlib_√xt_‰ame_t
 *
nf
;

460 
vlib_‰ame_t
 *
f
;

461 
u32
 
n_ve˘‹s_ö_‰ame
;

463 i‡(
vm
->
buf„r_maö
->
ˇŒbacks_ªgi°îed
 =0 && 
CLIB_DEBUG
 > 0)

464 
	`vlib_put_√xt_‰ame_vÆid©e
 (
vm
, 
r
, 
√xt_ödex
, 
n_ve˘‹s_À·
);

466 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

467 
f
 = 
	`vlib_gë_‰ame
 (
vm
, 
nf
->
‰ame_ödex
);

471 i‡(
CLIB_DEBUG
 > 0)

473 
vlib_node_t
 *
node
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

474 
	`vÆid©e_‰ame_magic
 (
vm
, 
f
, 
node
, 
√xt_ödex
);

478 
	`ASSERT
 (
n_ve˘‹s_À·
 <
VLIB_FRAME_SIZE
);

479 
n_ve˘‹s_ö_‰ame
 = 
VLIB_FRAME_SIZE
 - 
n_ve˘‹s_À·
;

481 
f
->
n_ve˘‹s
 = 
n_ve˘‹s_ö_‰ame
;

484 i‡(
	`PREDICT_TRUE
 (
n_ve˘‹s_ö_‰ame
 > 0))

486 
vlib_≥ndög_‰ame_t
 *
p
;

487 
u32
 
v0
, 
v1
;

489 
r
->
ˇched_√xt_ödex
 = 
√xt_ödex
;

491 i‡(!(
f
->
Êags
 & 
VLIB_FRAME_PENDING
))

493 
	`__©åibuã__
 ((
unu£d
)Ë
vlib_node_t
 *
node
;

494 
vlib_node_t
 *
√xt_node
;

495 
vlib_node_ru¡ime_t
 *
√xt_ru¡ime
;

497 
node
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

498 
√xt_node
 = 
	`vlib_gë_√xt_node
 (
vm
, 
r
->
node_ödex
, 
√xt_ödex
);

499 
√xt_ru¡ime
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
√xt_node
->
ödex
);

501 
	`vec_add2
 (
nm
->
≥ndög_‰ames
, 
p
, 1);

503 
p
->
‰ame_ödex
 = 
nf
->frame_index;

504 
p
->
node_ru¡ime_ödex
 = 
nf
->node_runtime_index;

505 
p
->
√xt_‰ame_ödex
 = 
nf
 - 
nm
->
√xt_‰ames
;

506 
nf
->
Êags
 |
VLIB_FRAME_PENDING
;

507 
f
->
Êags
 |
VLIB_FRAME_PENDING
;

515 i‡(0 && 
r
->
thªad_ödex
 !
√xt_ru¡ime
->thread_index)

517 
nf
->
‰ame_ödex
 = ~0;

518 
nf
->
Êags
 &~(
VLIB_FRAME_PENDING
 | 
VLIB_FRAME_IS_ALLOCATED
);

523 
nf
->
Êags
 |=

524 (
nf
->
Êags
 & 
VLIB_NODE_FLAG_TRACE
Ë| (
r
->

525 
Êags
 & 
VLIB_NODE_FLAG_TRACE
);

527 
v0
 = 
nf
->
ve˘‹s_sö˚_œ°_ovîÊow
;

528 
v1
 = 
v0
 + 
n_ve˘‹s_ö_‰ame
;

529 
nf
->
ve˘‹s_sö˚_œ°_ovîÊow
 = 
v1
;

530 i‡(
	`PREDICT_FALSE
 (
v1
 < 
v0
))

532 
vlib_node_t
 *
node
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

533 
	`vec_ñt
 (
node
->
n_ve˘‹s_by_√xt_node
, 
√xt_ödex
Ë+
v0
;

536 
	}
}

539 
√vî_ölöe
 

540 
	$vlib_node_ru¡ime_sync_°©s
 (
vlib_maö_t
 * 
vm
,

541 
vlib_node_ru¡ime_t
 * 
r
,

542 
uw‹d
 
n_ˇŒs
, uw‹d 
n_ve˘‹s
, uw‹d 
n_˛ocks
)

544 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

546 
n
->
°©s_tŸÆ
.
ˇŒs
 +
n_ˇŒs
 + 
r
->
ˇŒs_sö˚_œ°_ovîÊow
;

547 
n
->
°©s_tŸÆ
.
ve˘‹s
 +
n_ve˘‹s
 + 
r
->
ve˘‹s_sö˚_œ°_ovîÊow
;

548 
n
->
°©s_tŸÆ
.
˛ocks
 +
n_˛ocks
 + 
r
->
˛ocks_sö˚_œ°_ovîÊow
;

549 
n
->
°©s_tŸÆ
.
max_˛ock
 = 
r
->max_clock;

550 
n
->
°©s_tŸÆ
.
max_˛ock_n
 = 
r
->max_clock_n;

552 
r
->
ˇŒs_sö˚_œ°_ovîÊow
 = 0;

553 
r
->
ve˘‹s_sö˚_œ°_ovîÊow
 = 0;

554 
r
->
˛ocks_sö˚_œ°_ovîÊow
 = 0;

555 
	}
}

557 
Æways_ölöe
 
__©åibuã__
 ((
unu£d
))

558 
	$vlib_¥o˚ss_sync_°©s
 (
vlib_maö_t
 * 
vm
,

559 
vlib_¥o˚ss_t
 * 
p
,

560 
uw‹d
 
n_ˇŒs
, uw‹d 
n_ve˘‹s
, uw‹d 
n_˛ocks
)

562 
vlib_node_ru¡ime_t
 *
π
 = &
p
->
node_ru¡ime
;

563 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
π
->
node_ödex
);

564 
	`vlib_node_ru¡ime_sync_°©s
 (
vm
, 
π
, 
n_ˇŒs
, 
n_ve˘‹s
, 
n_˛ocks
);

565 
n
->
°©s_tŸÆ
.
su•íds
 +
p
->
n_su•íds
;

566 
p
->
n_su•íds
 = 0;

567 
	}
}

570 
	$vlib_node_sync_°©s
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
n
)

572 
vlib_node_ru¡ime_t
 *
π
;

574 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
)

577 i‡(
vm
 !&
vlib_globÆ_maö
)

580 
vlib_¥o˚ss_t
 *
p
 = 
	`vlib_gë_¥o˚ss_‰om_node
 (
vm
, 
n
);

581 
n
->
°©s_tŸÆ
.
su•íds
 +
p
->
n_su•íds
;

582 
p
->
n_su•íds
 = 0;

583 
π
 = &
p
->
node_ru¡ime
;

586 
π
 =

587 
	`vec_ñt_©_ödex
 (
vm
->
node_maö
.
nodes_by_ty≥
[
n
->
ty≥
],

588 
n
->
ru¡ime_ödex
);

590 
	`vlib_node_ru¡ime_sync_°©s
 (
vm
, 
π
, 0, 0, 0);

594 
vlib_√xt_‰ame_t
 *
nf
;

595 
uw‹d
 
i
;

596 
i
 = 0; i < 
π
->
n_√xt_nodes
; i++)

598 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
π
, 
i
);

599 
	`vec_ñt
 (
n
->
n_ve˘‹s_by_√xt_node
, 
i
) +=

600 
nf
->
ve˘‹s_sö˚_œ°_ovîÊow
;

601 
nf
->
ve˘‹s_sö˚_œ°_ovîÊow
 = 0;

604 
	}
}

606 
Æways_ölöe
 
u32


607 
	$vlib_node_ru¡ime_upd©e_°©s
 (
vlib_maö_t
 * 
vm
,

608 
vlib_node_ru¡ime_t
 * 
node
,

609 
uw‹d
 
n_ˇŒs
,

610 
uw‹d
 
n_ve˘‹s
, uw‹d 
n_˛ocks
)

612 
u32
 
ˇ0
, 
ˇ1
, 
v0
, 
v1
, 
˛0
, 
˛1
, 
r
;

614 
˛0
 = 
˛1
 = 
node
->
˛ocks_sö˚_œ°_ovîÊow
;

615 
ˇ0
 = 
ˇ1
 = 
node
->
ˇŒs_sö˚_œ°_ovîÊow
;

616 
v0
 = 
v1
 = 
node
->
ve˘‹s_sö˚_œ°_ovîÊow
;

618 
ˇ1
 = 
ˇ0
 + 
n_ˇŒs
;

619 
v1
 = 
v0
 + 
n_ve˘‹s
;

620 
˛1
 = 
˛0
 + 
n_˛ocks
;

622 
node
->
ˇŒs_sö˚_œ°_ovîÊow
 = 
ˇ1
;

623 
node
->
˛ocks_sö˚_œ°_ovîÊow
 = 
˛1
;

624 
node
->
ve˘‹s_sö˚_œ°_ovîÊow
 = 
v1
;

625 
node
->
max_˛ock_n
 =Çode->
max_˛ock
 > 
n_˛ocks
 ?

626 
node
->
max_˛ock_n
 : 
n_ve˘‹s
;

627 
node
->
max_˛ock
 =Çode->max_˛ock > 
n_˛ocks
 ?Çode->max_clock :Ç_clocks;

629 
r
 = 
	`vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vm
, 
node
, 
n_ve˘‹s
);

631 i‡(
	`PREDICT_FALSE
 (
ˇ1
 < 
ˇ0
 || 
v1
 < 
v0
 || 
˛1
 < 
˛0
))

633 
node
->
ˇŒs_sö˚_œ°_ovîÊow
 = 
ˇ0
;

634 
node
->
˛ocks_sö˚_œ°_ovîÊow
 = 
˛0
;

635 
node
->
ve˘‹s_sö˚_œ°_ovîÊow
 = 
v0
;

636 
	`vlib_node_ru¡ime_sync_°©s
 (
vm
, 
node
, 
n_ˇŒs
, 
n_ve˘‹s
, 
n_˛ocks
);

639  
r
;

640 
	}
}

642 
Æways_ölöe
 

643 
	$vlib_¥o˚ss_upd©e_°©s
 (
vlib_maö_t
 * 
vm
,

644 
vlib_¥o˚ss_t
 * 
p
,

645 
uw‹d
 
n_ˇŒs
, uw‹d 
n_ve˘‹s
, uw‹d 
n_˛ocks
)

647 
	`vlib_node_ru¡ime_upd©e_°©s
 (
vm
, &
p
->
node_ru¡ime
,

648 
n_ˇŒs
, 
n_ve˘‹s
, 
n_˛ocks
);

649 
	}
}

651 
˛ib_îr‹_t
 *

652 
	$vlib_˛i_ñog_˛ór
 (
vlib_maö_t
 * 
vm
,

653 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

655 
	`ñog_ª£t_buf„r
 (&
vm
->
ñog_maö
);

657 
	}
}

660 
VLIB_CLI_COMMAND
 (
ñog_˛ór_˛i
, ) = {

661 .
∑th
 = "event-logger clear",

662 .
	gsh‹t_hñp
 = "ClearÅheÉventÜog",

663 .
	gfun˘i⁄
 = 
vlib_˛i_ñog_˛ór
,

667 #ifde‡
CLIB_UNIX


668 
˛ib_îr‹_t
 *

669 
	$ñog_ßve_buf„r
 (
vlib_maö_t
 * 
vm
,

670 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

672 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

673 *
fûe
, *
chroŸ_fûe
;

674 
˛ib_îr‹_t
 *
îr‹
 = 0;

676 i‡(!
	`unf‹m©
 (
öput
, "%s", &
fûe
))

678 
	`vlib_˛i_ouçut
 (
vm
, "expected fileÇame, got `%U'",

679 
f‹m©_unf‹m©_îr‹
, 
öput
);

684 i‡(
	`°r°r
 (
fûe
, ".."Ë|| 
	`ödex
 (file, '/'))

686 
	`vlib_˛i_ouçut
 (
vm
, "ûÀgÆ ch¨a˘î†ö fûíamê'%s'", 
fûe
);

690 
chroŸ_fûe
 = (*Ë
	`f‹m©
 (0, "/tmp/%s%c", 
fûe
, 0);

692 
	`vec_‰ì
 (
fûe
);

694 
	`vlib_˛i_ouçut
 (
vm
, "Saving %wd of %wdÉventsÅo %s",

695 
	`ñog_n_evíts_ö_buf„r
 (
em
),

696 
	`ñog_buf„r_ˇ∑côy
 (
em
), 
chroŸ_fûe
);

698 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

699 
îr‹
 = 
	`ñog_wrôe_fûe
 (
em
, 
chroŸ_fûe
, 1 );

700 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

701 
	`vec_‰ì
 (
chroŸ_fûe
);

702  
îr‹
;

703 
	}
}

706 
	$ñog_po°_m‹ãm_dump
 ()

708 
vlib_maö_t
 *
vm
 = &
vlib_globÆ_maö
;

709 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

710 
u8
 *
fûíame
;

711 
˛ib_îr‹_t
 *
îr‹
;

713 i‡(!
vm
->
ñog_po°_m‹ãm_dump
)

716 
fûíame
 = 
	`f‹m©
 (0, "/tmp/ñog_po°_m‹ãm.%d%c", 
	`gëpid
 (), 0);

717 
îr‹
 = 
	`ñog_wrôe_fûe
 (
em
, (*Ë
fûíame
, 1 );

718 i‡(
îr‹
)

719 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

720 
	`vec_‰ì
 (
fûíame
);

721 
	}
}

724 
VLIB_CLI_COMMAND
 (
ñog_ßve_˛i
, ) = {

725 .
∑th
 = "event-logger save",

726 .
	gsh‹t_hñp
 = "event-logger save <filename> (savesÜog in /tmp/<filename>)",

727 .
	gfun˘i⁄
 = 
ñog_ßve_buf„r
,

731 
˛ib_îr‹_t
 *

732 
	$ñog_°›
 (
vlib_maö_t
 * 
vm
,

733 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

735 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

737 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 =Ém->
n_tŸÆ_evíts
;

739 
	`vlib_˛i_ouçut
 (
vm
, "StoppedÅheÉventÜogger...");

741 
	}
}

744 
VLIB_CLI_COMMAND
 (
ñog_°›_˛i
, ) = {

745 .
∑th
 = "event-logger stop",

746 .
	gsh‹t_hñp
 = "StopÅheÉvent-logger",

747 .
	gfun˘i⁄
 = 
ñog_°›
,

751 
˛ib_îr‹_t
 *

752 
	$ñog_ª°¨t
 (
vlib_maö_t
 * 
vm
,

753 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

755 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

757 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 = ~0;

759 
	`vlib_˛i_ouçut
 (
vm
, "RestartedÅheÉventÜogger...");

761 
	}
}

764 
VLIB_CLI_COMMAND
 (
ñog_ª°¨t_˛i
, ) = {

765 .
∑th
 = "event-loggerÑestart",

766 .
	gsh‹t_hñp
 = "RestartÅheÉvent-logger",

767 .
	gfun˘i⁄
 = 
ñog_ª°¨t
,

771 
˛ib_îr‹_t
 *

772 
	$ñog_ªsize
 (
vlib_maö_t
 * 
vm
,

773 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

775 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

776 
u32
 
tmp
;

779 
	`ñog_ª£t_buf„r
 (&
vm
->
ñog_maö
);

781 i‡(
	`unf‹m©
 (
öput
, "%d", &
tmp
))

783 
	`ñog_Æloc
 (
em
, 
tmp
);

784 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 = ~0;

787  
	`˛ib_îr‹_ªtu∫
 (0, "Must specify how manyÉvents inÅheÑing");

789 
	`vlib_˛i_ouçut
 (
vm
, "ResizedÑingándÑestartedÅheÉventÜogger...");

791 
	}
}

794 
VLIB_CLI_COMMAND
 (
ñog_ªsize_˛i
, ) = {

795 .
∑th
 = "event-loggerÑesize",

796 .
	gsh‹t_hñp
 = "event-loggerÑesize <nnn>",

797 .
	gfun˘i⁄
 = 
ñog_ªsize
,

804 
	$ñog_show_buf„r_öã∫Æ
 (
vlib_maö_t
 * 
vm
, 
u32
 
n_evíts_to_show
)

806 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

807 
ñog_evít_t
 *
e
, *
es
;

808 
f64
 
dt
;

811 
dt
 = (
em
->
öô_time
.
˝u
 - 
vm
->
˛ib_time
.
öô_˝u_time
)

812 * 
vm
->
˛ib_time
.
£c⁄ds_≥r_˛ock
;

814 
es
 = 
	`ñog_≥ek_evíts
 (
em
);

815 
	`vlib_˛i_ouçut
 (
vm
, "%d o‡%dÉvít†ö buf„r,Üoggî %s", 
	`vec_Àn
 (
es
),

816 
em
->
evít_rög_size
,

817 
em
->
n_tŸÆ_evíts
 <Ém->
n_tŸÆ_evíts_dißbÀ_limô
 ?

819 
	`vec_f‹óch
 (
e
, 
es
)

821 
	`vlib_˛i_ouçut
 (
vm
, "%18.9f: %U",

822 
e
->
time
 + 
dt
, 
f‹m©_ñog_evít
, 
em
,É);

823 
n_evíts_to_show
--;

824 i‡(
n_evíts_to_show
 == 0)

827 
	`vec_‰ì
 (
es
);

829 
	}
}

831 
˛ib_îr‹_t
 *

832 
	$ñog_show_buf„r
 (
vlib_maö_t
 * 
vm
,

833 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

835 
u32
 
n_evíts_to_show
;

836 
˛ib_îr‹_t
 *
îr‹
 = 0;

838 
n_evíts_to_show
 = 250;

839 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

841 i‡(
	`unf‹m©
 (
öput
, "%d", &
n_evíts_to_show
))

843 i‡(
	`unf‹m©
 (
öput
, "all"))

844 
n_evíts_to_show
 = ~0;

846  
	`unf‹m©_∑r£_îr‹
 (
öput
);

848 
	`ñog_show_buf„r_öã∫Æ
 (
vm
, 
n_evíts_to_show
);

849  
îr‹
;

850 
	}
}

853 
VLIB_CLI_COMMAND
 (
ñog_show_˛i
, ) = {

854 .
∑th
 = "showÉvent-logger",

855 .
	gsh‹t_hñp
 = "ShowÉventÜogger info",

856 .
	gfun˘i⁄
 = 
ñog_show_buf„r
,

861 
	$vlib_gdb_show_evít_log
 ()

863 
	`ñog_show_buf„r_öã∫Æ
 (
	`vlib_gë_maö
 (), (
u32
) ~ 0);

864 
	}
}

866 
ölöe
 

867 
	$vlib_ñog_maö_lo›_evít
 (
vlib_maö_t
 * 
vm
,

868 
u32
 
node_ödex
,

869 
u64
 
time
, 
u32
 
n_ve˘‹s
, u32 
is_ªtu∫
)

871 
vlib_maö_t
 *
evm
 = &
vlib_globÆ_maö
;

872 
ñog_maö_t
 *
em
 = &
evm
->
ñog_maö
;

874 i‡(
VLIB_ELOG_MAIN_LOOP
 && 
n_ve˘‹s
)

875 
	`ñog_åack
 (
em
,

877 
	`vec_ñt_©_ödex
 (
is_ªtu∫


878 ? 
evm
->
node_ªtu∫_ñog_evít_ty≥s


879 : 
evm
->
node_ˇŒ_ñog_evít_ty≥s
,

880 
node_ödex
),

882 (
vm
->
thªad_ödex
 ? &
vlib_w‹kî_thªads
[vm->thread_index].

883 
ñog_åack
 : &
em
->
deÁu…_åack
),

884  
n_ve˘‹s
);

885 
	}
}

887 #i‡
VLIB_BUFFER_TRACE_TRAJECTORY
 > 0

888 (*
vlib_buf„r_åa˚_åaje˘‹y_cb
Ë(
vlib_buf„r_t
 * 
b
, 
u32
 
node_ödex
);

889 (*
vlib_buf„r_åa˚_åaje˘‹y_öô_cb
Ë(
vlib_buf„r_t
 * 
b
);

892 
	$vlib_buf„r_åa˚_åaje˘‹y_öô
 (
vlib_buf„r_t
 * 
b
)

894 i‡(
	`PREDICT_TRUE
 (
vlib_buf„r_åa˚_åaje˘‹y_öô_cb
 != 0))

896 (*
vlib_buf„r_åa˚_åaje˘‹y_öô_cb
Ë(
b
);

898 
	}
}

902 
ölöe
 

903 
	$add_åaje˘‹y_åa˚
 (
vlib_buf„r_t
 * 
b
, 
u32
 
node_ödex
)

905 #i‡
VLIB_BUFFER_TRACE_TRAJECTORY
 > 0

906 i‡(
	`PREDICT_TRUE
 (
vlib_buf„r_åa˚_åaje˘‹y_cb
 != 0))

908 (*
vlib_buf„r_åa˚_åaje˘‹y_cb
Ë(
b
, 
node_ödex
);

911 
	}
}

913 
°©ic_Æways_ölöe
 
u64


914 
	$di•©ch_node
 (
vlib_maö_t
 * 
vm
,

915 
vlib_node_ru¡ime_t
 * 
node
,

916 
vlib_node_ty≥_t
 
ty≥
,

917 
vlib_node_°©e_t
 
di•©ch_°©e
,

918 
vlib_‰ame_t
 * 
‰ame
, 
u64
 
œ°_time_°amp
)

920 
uw‹d
 
n
, 
v
;

921 
u64
 
t
;

922 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

923 
vlib_√xt_‰ame_t
 *
nf
;

925 i‡(
CLIB_DEBUG
 > 0)

927 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node
->
node_ödex
);

928 
	`ASSERT
 (
n
->
ty≥
 ==Åype);

932 i‡(
ty≥
 !
VLIB_NODE_TYPE_INTERNAL
 && 
node
->
°©e
 !
di•©ch_°©e
)

934 
	`ASSERT
 (
ty≥
 !
VLIB_NODE_TYPE_INTERNAL
);

935  
œ°_time_°amp
;

938 i‡((
ty≥
 =
VLIB_NODE_TYPE_PRE_INPUT
 ||Åy≥ =
VLIB_NODE_TYPE_INPUT
)

939 && 
di•©ch_°©e
 !
VLIB_NODE_STATE_INTERRUPT
)

941 
u32
 
c
 = 
node
->
öput_maö_lo›s_≥r_ˇŒ
;

943 i‡(
c
)

945 
node
->
öput_maö_lo›s_≥r_ˇŒ
 = 
c
 - 1;

946  
œ°_time_°amp
;

951 i‡(
node
->
n_√xt_nodes
 > 0)

953 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
node
->
√xt_‰ame_ödex
);

954 
	`CLIB_PREFETCH
 (
nf
, 4 *  (nf[0]), 
WRITE
);

957 
vm
->
˝u_time_œ°_node_di•©ch
 = 
œ°_time_°amp
;

961 
vlib_maö_t
 *
°©_vm
;

963 
°©_vm
 = 
vm
;

965 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node
->
node_ödex
,

966 
œ°_time_°amp
,

967 
‰ame
 ? føme->
n_ve˘‹s
 : 0,

975 i‡(
VLIB_BUFFER_TRACE_TRAJECTORY
 && 
‰ame
)

977 
i
;

978 
u32
 *
‰om
;

979 
‰om
 = 
	`vlib_‰ame_ve˘‹_¨gs
 (
‰ame
);

980 
i
 = 0; i < 
‰ame
->
n_ve˘‹s
; i++)

982 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
‰om
[
i
]);

983 
	`add_åaje˘‹y_åa˚
 (
b
, 
node
->
node_ödex
);

985 
n
 = 
node
->
	`fun˘i⁄
 (
vm
,Çode, 
‰ame
);

988 
n
 = 
node
->
	`fun˘i⁄
 (
vm
,Çode, 
‰ame
);

990 
t
 = 
	`˛ib_˝u_time_now
 ();

992 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node
->
node_ödex
, 
t
, 
n
,

995 
vm
->
maö_lo›_ve˘‹s_¥o˚s£d
 +
n
;

996 
vm
->
maö_lo›_nodes_¥o˚s£d
 +
n
 > 0;

998 
v
 = 
	`vlib_node_ru¡ime_upd©e_°©s
 (
°©_vm
, 
node
,

1000  
n
,

1001  
t
 - 
œ°_time_°amp
);

1005 i‡((
di•©ch_°©e
 =
VLIB_NODE_STATE_INTERRUPT
)

1006 || (
di•©ch_°©e
 =
VLIB_NODE_STATE_POLLING


1007 && (
node
->
Êags


1008 & 
VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
)))

1010 #ifde‡
DISPATCH_NODE_ELOG_REQUIRED


1011 
	`ELOG_TYPE_DECLARE
 (
e
) =

1013 .
fun˘i⁄
 = (*Ë
__FUNCTION__
,.
f‹m©
 =

1014 "%†ve˘‹Üígth %d, swôchögÅÿ%s",.
f‹m©_¨gs
 =

1015 "T4i4t4",.
n_íum_°rögs
 = 2,.
íum_°rögs
 =

1020 
u32
 
node_«me
, 
ve˘‹_Àngth
, 
is_pﬁlög
;

1021 } *
ed
;

1022 
vlib_w‹kî_thªad_t
 *
w
 = 
vlib_w‹kî_thªads
 + 
vm
->
thªad_ödex
;

1025 i‡((
di•©ch_°©e
 =
VLIB_NODE_STATE_INTERRUPT


1026 && 
v
 >
nm
->
pﬁlög_thªshﬁd_ve˘‹_Àngth
) &&

1027 !(
node
->
Êags
 &

1028 
VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
))

1030 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node
->
node_ödex
);

1031 
n
->
°©e
 = 
VLIB_NODE_STATE_POLLING
;

1032 
node
->
°©e
 = 
VLIB_NODE_STATE_POLLING
;

1033 
node
->
Êags
 &=

1034 ~
VLIB_NODE_FLAG_SWITCH_FROM_POLLING_TO_INTERRUPT_MODE
;

1035 
node
->
Êags
 |=

1036 
VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
;

1037 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_INTERRUPT
] -= 1;

1038 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_POLLING
] += 1;

1040 #ifde‡
DISPATCH_NODE_ELOG_REQUIRED


1041 
ed
 = 
	`ELOG_TRACK_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
,

1042 
w
->
ñog_åack
);

1043 
ed
->
node_«me
 = 
n
->
«me_ñog_°rög
;

1044 
ed
->
ve˘‹_Àngth
 = 
v
;

1045 
ed
->
is_pﬁlög
 = 1;

1048 i‡(
di•©ch_°©e
 =
VLIB_NODE_STATE_POLLING


1049 && 
v
 <
nm
->
öãºu±_thªshﬁd_ve˘‹_Àngth
)

1051 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node
->
node_ödex
);

1052 i‡(
node
->
Êags
 &

1053 
VLIB_NODE_FLAG_SWITCH_FROM_POLLING_TO_INTERRUPT_MODE
)

1057 
n
->
°©e
 = 
VLIB_NODE_STATE_INTERRUPT
;

1058 
node
->
°©e
 = 
VLIB_NODE_STATE_INTERRUPT
;

1059 
node
->
Êags
 &=

1060 ~
VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
;

1061 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_POLLING
] -=

1063 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_INTERRUPT
] +=

1069 
node
->
Êags
 |=

1070 
VLIB_NODE_FLAG_SWITCH_FROM_POLLING_TO_INTERRUPT_MODE
;

1071 #ifde‡
DISPATCH_NODE_ELOG_REQUIRED


1072 
ed
 = 
	`ELOG_TRACK_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
,

1073 
w
->
ñog_åack
);

1074 
ed
->
node_«me
 = 
n
->
«me_ñog_°rög
;

1075 
ed
->
ve˘‹_Àngth
 = 
v
;

1076 
ed
->
is_pﬁlög
 = 0;

1083  
t
;

1084 
	}
}

1086 
u64


1087 
	$di•©ch_≥ndög_node
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
≥ndög_‰ame_ödex
,

1088 
u64
 
œ°_time_°amp
)

1090 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1091 
vlib_‰ame_t
 *
f
;

1092 
vlib_√xt_‰ame_t
 *
nf
, 
nf_dummy
;

1093 
vlib_node_ru¡ime_t
 *
n
;

1094 
u32
 
ª°‹e_‰ame_ödex
;

1095 
vlib_≥ndög_‰ame_t
 *
p
;

1098 
p
 = 
nm
->
≥ndög_‰ames
 + 
≥ndög_‰ame_ödex
;

1100 
n
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
],

1101 
p
->
node_ru¡ime_ödex
);

1103 
f
 = 
	`vlib_gë_‰ame
 (
vm
, 
p
->
‰ame_ödex
);

1104 i‡(
p
->
√xt_‰ame_ödex
 =
VLIB_PENDING_FRAME_NO_NEXT_FRAME
)

1107 
nf
 = &
nf_dummy
;

1108 
nf
->
Êags
 = 
f
->Êag†& 
VLIB_NODE_FLAG_TRACE
;

1109 
nf
->
‰ame_ödex
 = ~
p
->frame_index;

1112 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
p
->
√xt_‰ame_ödex
);

1114 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
);

1118 
ª°‹e_‰ame_ödex
 = ~0;

1119 i‡(
nf
->
‰ame_ödex
 =
p
->frame_index)

1121 
nf
->
‰ame_ödex
 = ~0;

1122 
nf
->
Êags
 &~
VLIB_FRAME_IS_ALLOCATED
;

1123 i‡(!(
n
->
Êags
 & 
VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH
))

1124 
ª°‹e_‰ame_ödex
 = 
p
->
‰ame_ödex
;

1128 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_PENDING
);

1129 
	`ASSERT
 (
f
->
n_ve˘‹s
 > 0);

1134 
n
->
Êags
 &~
VLIB_NODE_FLAG_TRACE
;

1135 
n
->
Êags
 |(
nf
->Êag†& 
VLIB_FRAME_TRACE
Ë? 
VLIB_NODE_FLAG_TRACE
 : 0;

1136 
nf
->
Êags
 &~
VLIB_FRAME_TRACE
;

1138 
œ°_time_°amp
 = 
	`di•©ch_node
 (
vm
, 
n
,

1139 
VLIB_NODE_TYPE_INTERNAL
,

1140 
VLIB_NODE_STATE_POLLING
,

1141 
f
, 
œ°_time_°amp
);

1143 
f
->
Êags
 &~
VLIB_FRAME_PENDING
;

1146 i‡(
ª°‹e_‰ame_ödex
 != ~0)

1158 
	`ASSERT
 (!(
f
->
Êags
 & 
VLIB_FRAME_FREE_AFTER_DISPATCH
));

1165 
p
 = 
nm
->
≥ndög_‰ames
 + 
≥ndög_‰ame_ödex
;

1171 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
p
->
√xt_‰ame_ödex
);

1172 
nf
->
Êags
 |
VLIB_FRAME_IS_ALLOCATED
;

1174 i‡(~0 =
nf
->
‰ame_ödex
)

1177 
nf
->
‰ame_ödex
 = 
ª°‹e_‰ame_ödex
;

1178 
f
->
n_ve˘‹s
 = 0;

1185 
	`vlib_‰ame_‰ì
 (
vm
, 
n
, 
f
);

1190 i‡(
f
->
Êags
 & 
VLIB_FRAME_FREE_AFTER_DISPATCH
)

1192 
	`ASSERT
 (!(
n
->
Êags
 & 
VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH
));

1193 
	`vlib_‰ame_‰ì
 (
vm
, 
n
, 
f
);

1197  
œ°_time_°amp
;

1198 
	}
}

1200 
Æways_ölöe
 
uw‹d


1201 
	$vlib_¥o˚ss_°ack_is_vÆid
 (
vlib_¥o˚ss_t
 * 
p
)

1203  
p
->
°ack
[0] =
VLIB_PROCESS_STACK_MAGIC
;

1204 
	}
}

1208 
vlib_maö_t
 *
	mvm
;

1209 
vlib_¥o˚ss_t
 *
	m¥o˚ss
;

1210 
vlib_‰ame_t
 *
	m‰ame
;

1211 } 
	tvlib_¥o˚ss_boŸ°øp_¨gs_t
;

1214 
uw‹d


1215 
	$vlib_¥o˚ss_boŸ°øp
 (
uw‹d
 
_a
)

1217 
vlib_¥o˚ss_boŸ°øp_¨gs_t
 *
a
;

1218 
vlib_maö_t
 *
vm
;

1219 
vlib_node_ru¡ime_t
 *
node
;

1220 
vlib_‰ame_t
 *
f
;

1221 
vlib_¥o˚ss_t
 *
p
;

1222 
uw‹d
 
n
;

1224 
a
 = 
	`uw‹d_to_poöãr
 (
_a
, 
vlib_¥o˚ss_boŸ°øp_¨gs_t
 *);

1226 
vm
 = 
a
->vm;

1227 
p
 = 
a
->
¥o˚ss
;

1228 
f
 = 
a
->
‰ame
;

1229 
node
 = &
p
->
node_ru¡ime
;

1231 
n
 = 
node
->
	`fun˘i⁄
 (
vm
,Çode, 
f
);

1233 
	`ASSERT
 (
	`vlib_¥o˚ss_°ack_is_vÆid
 (
p
));

1235 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
n
);

1237  
n
;

1238 
	}
}

1241 
°©ic_Æways_ölöe
 
uw‹d


1242 
	$vlib_¥o˚ss_°¨tup
 (
vlib_maö_t
 * 
vm
, 
vlib_¥o˚ss_t
 * 
p
, 
vlib_‰ame_t
 * 
f
)

1244 
vlib_¥o˚ss_boŸ°øp_¨gs_t
 
a
;

1245 
uw‹d
 
r
;

1247 
a
.
vm
 = vm;

1248 
a
.
¥o˚ss
 = 
p
;

1249 
a
.
‰ame
 = 
f
;

1251 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_RETURN
);

1252 i‡(
r
 =
VLIB_PROCESS_RETURN_LONGJMP_RETURN
)

1253 
r
 = 
	`˛ib_ˇŒjmp
 (
vlib_¥o˚ss_boŸ°øp
, 
	`poöãr_to_uw‹d
 (&
a
),

1254 (*Ë
p
->
°ack
 + (1 <<Ö->
log2_n_°ack_byãs
));

1256  
r
;

1257 
	}
}

1259 
°©ic_Æways_ölöe
 
uw‹d


1260 
	$vlib_¥o˚ss_ªsume
 (
vlib_¥o˚ss_t
 * 
p
)

1262 
uw‹d
 
r
;

1263 
p
->
Êags
 &~(
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


1264 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT


1265 | 
VLIB_PROCESS_RESUME_PENDING
);

1266 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_RETURN
);

1267 i‡(
r
 =
VLIB_PROCESS_RETURN_LONGJMP_RETURN
)

1268 
	`˛ib_l⁄gjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_RESUME
);

1269  
r
;

1270 
	}
}

1272 
u64


1273 
	$di•©ch_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1274 
vlib_¥o˚ss_t
 * 
p
, 
vlib_‰ame_t
 * 
f
, 
u64
 
œ°_time_°amp
)

1276 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1277 
vlib_node_ru¡ime_t
 *
node_ru¡ime
 = &
p
->node_runtime;

1278 
vlib_node_t
 *
node
 = 
	`vlib_gë_node
 (
vm
, 
node_ru¡ime
->
node_ödex
);

1279 
u64
 
t
;

1280 
uw‹d
 
n_ve˘‹s
, 
is_su•íd
;

1282 i‡(
node
->
°©e
 !
VLIB_NODE_STATE_POLLING


1283 || (
p
->
Êags
 & (
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


1284 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
)))

1285  
œ°_time_°amp
;

1287 
p
->
Êags
 |
VLIB_PROCESS_IS_RUNNING
;

1289 
t
 = 
œ°_time_°amp
;

1290 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node_ru¡ime
->
node_ödex
, 
t
,

1291 
f
 ? f->
n_ve˘‹s
 : 0, 0);

1294 
nm
->
cuºít_¥o˚ss_ödex
 = 
node
->
ru¡ime_ödex
;

1296 
n_ve˘‹s
 = 
	`vlib_¥o˚ss_°¨tup
 (
vm
, 
p
, 
f
);

1298 
nm
->
cuºít_¥o˚ss_ödex
 = ~0;

1300 
	`ASSERT
 (
n_ve˘‹s
 !
VLIB_PROCESS_RETURN_LONGJMP_RETURN
);

1301 
is_su•íd
 = 
n_ve˘‹s
 =
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
;

1302 i‡(
is_su•íd
)

1304 
vlib_≥ndög_‰ame_t
 *
pf
;

1306 
n_ve˘‹s
 = 0;

1307 
	`poﬁ_gë
 (
nm
->
su•íded_¥o˚ss_‰ames
, 
pf
);

1308 
pf
->
node_ru¡ime_ödex
 = 
node
->
ru¡ime_ödex
;

1309 
pf
->
‰ame_ödex
 = 
f
 ? 
	`vlib_‰ame_ödex
 (
vm
, f) : ~0;

1310 
pf
->
√xt_‰ame_ödex
 = ~0;

1312 
p
->
n_su•íds
 += 1;

1313 
p
->
su•íded_¥o˚ss_‰ame_ödex
 = 
pf
 - 
nm
->
su•íded_¥o˚ss_‰ames
;

1315 i‡(
p
->
Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
)

1317 
	`TWT
 (
tw_timî_whìl
Ë* 
tw
 =

1318 (
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
;

1319 
p
->
°›_timî_h™dÀ
 =

1320 
	`TW
 (
tw_timî_°¨t
Ë(
tw
,

1321 
vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss


1322 (
node
->
ru¡ime_ödex
) ,

1324 
p
->
ªsume_˛ock_öãrvÆ
);

1328 
p
->
Êags
 &~
VLIB_PROCESS_IS_RUNNING
;

1330 
t
 = 
	`˛ib_˝u_time_now
 ();

1332 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node_ru¡ime
->
node_ödex
, 
t
, 
is_su•íd
,

1335 
	`vlib_¥o˚ss_upd©e_°©s
 (
vm
, 
p
,

1336  !
is_su•íd
,

1337  
n_ve˘‹s
,

1338  
t
 - 
œ°_time_°amp
);

1340  
t
;

1341 
	}
}

1344 
	$vlib_°¨t_¥o˚ss
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
¥o˚ss_ödex
)

1346 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1347 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
¥o˚ss_ödex
);

1348 
	`di•©ch_¥o˚ss
 (
vm
, 
p
, 0, 0);

1349 
	}
}

1351 
u64


1352 
	$di•©ch_su•íded_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1353 
uw‹d
 
¥o˚ss_ödex
, 
u64
 
œ°_time_°amp
)

1355 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1356 
vlib_node_ru¡ime_t
 *
node_ru¡ime
;

1357 
vlib_node_t
 *
node
;

1358 
vlib_‰ame_t
 *
f
;

1359 
vlib_¥o˚ss_t
 *
p
;

1360 
vlib_≥ndög_‰ame_t
 *
pf
;

1361 
u64
 
t
, 
n_ve˘‹s
, 
is_su•íd
;

1363 
t
 = 
œ°_time_°amp
;

1365 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
¥o˚ss_ödex
);

1366 i‡(
	`PREDICT_FALSE
 (!(
p
->
Êags
 & 
VLIB_PROCESS_IS_RUNNING
)))

1367  
œ°_time_°amp
;

1369 
	`ASSERT
 (
p
->
Êags
 & (
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


1370 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
));

1372 
pf
 =

1373 
	`poﬁ_ñt_©_ödex
 (
nm
->
su•íded_¥o˚ss_‰ames
,

1374 
p
->
su•íded_¥o˚ss_‰ame_ödex
);

1376 
node_ru¡ime
 = &
p
->node_runtime;

1377 
node
 = 
	`vlib_gë_node
 (
vm
, 
node_ru¡ime
->
node_ödex
);

1378 
f
 = 
pf
->
‰ame_ödex
 !~0 ? 
	`vlib_gë_‰ame
 (
vm
,Öf->frame_index) : 0;

1380 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node_ru¡ime
->
node_ödex
, 
t
,

1381 
f
 ? f->
n_ve˘‹s
 : 0, 0);

1384 
nm
->
cuºít_¥o˚ss_ödex
 = 
node
->
ru¡ime_ödex
;

1386 
n_ve˘‹s
 = 
	`vlib_¥o˚ss_ªsume
 (
p
);

1387 
t
 = 
	`˛ib_˝u_time_now
 ();

1389 
nm
->
cuºít_¥o˚ss_ödex
 = ~0;

1391 
is_su•íd
 = 
n_ve˘‹s
 =
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
;

1392 i‡(
is_su•íd
)

1395 
n_ve˘‹s
 = 0;

1396 
p
->
n_su•íds
 += 1;

1397 i‡(
p
->
Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
)

1399 
p
->
°›_timî_h™dÀ
 =

1400 
	`TW
 (
tw_timî_°¨t
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

1401 
vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss


1402 (
node
->
ru¡ime_ödex
) ,

1404 
p
->
ªsume_˛ock_öãrvÆ
);

1409 
p
->
Êags
 &~
VLIB_PROCESS_IS_RUNNING
;

1410 
p
->
su•íded_¥o˚ss_‰ame_ödex
 = ~0;

1411 
	`poﬁ_put
 (
nm
->
su•íded_¥o˚ss_‰ames
, 
pf
);

1414 
t
 = 
	`˛ib_˝u_time_now
 ();

1415 
	`vlib_ñog_maö_lo›_evít
 (
vm
, 
node_ru¡ime
->
node_ödex
, 
t
, !
is_su•íd
,

1418 
	`vlib_¥o˚ss_upd©e_°©s
 (
vm
, 
p
,

1419  !
is_su•íd
,

1420  
n_ve˘‹s
,

1421  
t
 - 
œ°_time_°amp
);

1423  
t
;

1424 
	}
}

1426 
	$vl_≠i_£nd_≥ndög_Ωc_ªque°s
 (
vlib_maö_t
 *Ë
	`__©åibuã__
 ((
wók
));

1428 
	$vl_≠i_£nd_≥ndög_Ωc_ªque°s
 (
vlib_maö_t
 * 
vm
)

1430 
	}
}

1433 
°©ic_Æways_ölöe
 

1434 
	$vlib_maö_‹_w‹kî_lo›
 (
vlib_maö_t
 * 
vm
, 
is_maö
)

1436 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1437 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

1438 
uw‹d
 
i
;

1439 
u64
 
˝u_time_now
;

1440 
vlib_‰ame_queue_maö_t
 *
fqm
;

1441 
u32
 *
œ°_node_ru¡ime_ödi˚s
 = 0;

1444 i‡(
is_maö
)

1446 
	`vec_ªsize
 (
nm
->
≥ndög_‰ames
, 32);

1447 
	`_vec_Àn
 (
nm
->
≥ndög_‰ames
) = 0;

1451 i‡(
is_maö
)

1453 
˝u_time_now
 = 
vm
->
˛ib_time
.
œ°_˝u_time
;

1454 
vm
->
˝u_time_maö_lo›_°¨t
 = 
˝u_time_now
;

1457 
˝u_time_now
 = 
	`˛ib_˝u_time_now
 ();

1460 
	`vec_Æloc
 (
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
, 32);

1461 
	`vec_Æloc
 (
œ°_node_ru¡ime_ödi˚s
, 32);

1462 i‡(!
is_maö
)

1463 
	`˛ib_•ölock_öô
 (&
nm
->
≥ndög_öãºu±_lock
);

1466 i‡(!
nm
->
pﬁlög_thªshﬁd_ve˘‹_Àngth
)

1467 
nm
->
pﬁlög_thªshﬁd_ve˘‹_Àngth
 = 10;

1468 i‡(!
nm
->
öãºu±_thªshﬁd_ve˘‹_Àngth
)

1469 
nm
->
öãºu±_thªshﬁd_ve˘‹_Àngth
 = 5;

1472 i‡(
is_maö
)

1474 
uw‹d
 
i
;

1475 
nm
->
cuºít_¥o˚ss_ödex
 = ~0;

1476 
i
 = 0; i < 
	`vec_Àn
 (
nm
->
¥o˚s£s
); i++)

1477 
˝u_time_now
 = 
	`di•©ch_¥o˚ss
 (
vm
, 
nm
->
¥o˚s£s
[
i
], 0,

1478 
˝u_time_now
);

1483 
vlib_node_ru¡ime_t
 *
n
;

1485 i‡(
	`PREDICT_FALSE
 (
	`_vec_Àn
 (
vm
->
≥ndög_Ωc_ªque°s
) > 0))

1486 
	`vl_≠i_£nd_≥ndög_Ωc_ªque°s
 (
vm
);

1488 i‡(!
is_maö
)

1490 
	`vlib_w‹kî_thªad_b¨rõr_check
 ();

1491 
	`vec_f‹óch
 (
fqm
, 
tm
->
‰ame_queue_maös
)

1492 
	`vlib_‰ame_queue_dequeue
 (
vm
, 
fqm
);

1496 
	`vec_f‹óch
 (
n
, 
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_PRE_INPUT
])

1497 
˝u_time_now
 = 
	`di•©ch_node
 (
vm
, 
n
,

1498 
VLIB_NODE_TYPE_PRE_INPUT
,

1499 
VLIB_NODE_STATE_POLLING
,

1501 
˝u_time_now
);

1504 
	`vec_f‹óch
 (
n
, 
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
])

1505 
˝u_time_now
 = 
	`di•©ch_node
 (
vm
, 
n
,

1506 
VLIB_NODE_TYPE_INPUT
,

1507 
VLIB_NODE_STATE_POLLING
,

1509 
˝u_time_now
);

1511 i‡(
	`PREDICT_TRUE
 (
is_maö
 && 
vm
->
queue_sig«l_≥ndög
 == 0))

1512 
vm
->
	`queue_sig«l_ˇŒback
 (vm);

1517 
uw‹d
 
l
 = 
	`_vec_Àn
 (
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
);

1518 
uw‹d
 
i
;

1519 i‡(
	`PREDICT_FALSE
 (
l
 > 0))

1521 
u32
 *
tmp
;

1522 i‡(!
is_maö
)

1524 
	`˛ib_•ölock_lock
 (&
nm
->
≥ndög_öãºu±_lock
);

1526 
l
 = 
	`_vec_Àn
 (
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
);

1529 
tmp
 = 
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
;

1530 
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
 =

1531 
œ°_node_ru¡ime_ödi˚s
;

1532 
œ°_node_ru¡ime_ödi˚s
 = 
tmp
;

1533 
	`_vec_Àn
 (
œ°_node_ru¡ime_ödi˚s
) = 0;

1534 i‡(!
is_maö
)

1535 
	`˛ib_•ölock_u∆ock
 (&
nm
->
≥ndög_öãºu±_lock
);

1536 
i
 = 0; i < 
l
; i++)

1538 
n
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
],

1539 
œ°_node_ru¡ime_ödi˚s
[
i
]);

1540 
˝u_time_now
 =

1541 
	`di•©ch_node
 (
vm
, 
n
, 
VLIB_NODE_TYPE_INPUT
,

1542 
VLIB_NODE_STATE_INTERRUPT
,

1544 
˝u_time_now
);

1549 i‡(
is_maö
)

1552 
	`ASSERT
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
 != 0);

1554 
nm
->
d©a_‰om_adv™cög_timög_whìl
 =

1555 
	`TW
 (
tw_timî_expúe_timîs_vec
)

1556 ((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
, 
	`vlib_time_now
 (
vm
),

1557 
nm
->
d©a_‰om_adv™cög_timög_whìl
);

1559 
	`ASSERT
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
 != 0);

1561 i‡(
PREDICT_FALSE


1562 (
	`_vec_Àn
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
) > 0))

1564 
uw‹d
 
i
;

1566 
¥o˚s£s_timög_whìl_d©a
:

1567 
i
 = 0; i < 
	`_vec_Àn
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
);

1568 
i
++)

1570 
u32
 
d
 = 
nm
->
d©a_‰om_adv™cög_timög_whìl
[
i
];

1571 
u32
 
di
 = 
	`vlib_timög_whìl_d©a_gë_ödex
 (
d
);

1573 i‡(
	`vlib_timög_whìl_d©a_is_timed_evít
 (
d
))

1575 
vlib_sig«l_timed_evít_d©a_t
 *
ã
 =

1576 
	`poﬁ_ñt_©_ödex
 (
nm
->
sig«l_timed_evít_d©a_poﬁ
,

1577 
di
);

1578 
vlib_node_t
 *
n
 =

1579 
	`vlib_gë_node
 (
vm
, 
ã
->
¥o˚ss_node_ödex
);

1580 
vlib_¥o˚ss_t
 *
p
 =

1581 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

1582 *
d©a
;

1583 
d©a
 =

1584 
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
,

1585 
ã
->
evít_ty≥_ödex
,

1586 
ã
->
n_d©a_ñts
,

1587 
ã
->
n_d©a_ñt_byãs
);

1588 i‡(
ã
->
n_d©a_byãs
 <  (ã->
ölöe_evít_d©a
))

1589 
	`˛ib_mem˝y
 (
d©a
, 
ã
->
ölöe_evít_d©a
,

1590 
ã
->
n_d©a_byãs
);

1593 
	`˛ib_mem˝y
 (
d©a
, 
ã
->
evít_d©a_as_ve˘‹
,

1594 
ã
->
n_d©a_byãs
);

1595 
	`vec_‰ì
 (
ã
->
evít_d©a_as_ve˘‹
);

1597 
	`poﬁ_put
 (
nm
->
sig«l_timed_evít_d©a_poﬁ
, 
ã
);

1601 
˝u_time_now
 = 
	`˛ib_˝u_time_now
 ();

1602 
˝u_time_now
 =

1603 
	`di•©ch_su•íded_¥o˚ss
 (
vm
, 
di
, 
˝u_time_now
);

1606 
	`_vec_Àn
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
) = 0;

1613 
i
 = 0; i < 
	`_vec_Àn
 (
nm
->
≥ndög_‰ames
); i++)

1614 
˝u_time_now
 = 
	`di•©ch_≥ndög_node
 (
vm
, 
i
, cpu_time_now);

1616 
	`_vec_Àn
 (
nm
->
≥ndög_‰ames
) = 0;

1619 i‡(
is_maö
 && 
	`_vec_Àn
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
) > 0)

1620 
¥o˚s£s_timög_whìl_d©a
;

1622 
	`vlib_ö¸emít_maö_lo›_cou¡î
 (
vm
);

1626 
˝u_time_now
 = 
	`˛ib_˝u_time_now
 ();

1628 
	}
}

1631 
	$vlib_maö_lo›
 (
vlib_maö_t
 * 
vm
)

1633 
	`vlib_maö_‹_w‹kî_lo›
 (
vm
, 1);

1634 
	}
}

1637 
	$vlib_w‹kî_lo›
 (
vlib_maö_t
 * 
vm
)

1639 
	`vlib_maö_‹_w‹kî_lo›
 (
vm
, 0);

1640 
	}
}

1642 
vlib_maö_t
 
	gvlib_globÆ_maö
;

1644 
˛ib_îr‹_t
 *

1645 
	$vlib_maö_c⁄figuª
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

1647 
tu∫_⁄_mem_åa˚
 = 0;

1649 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

1651 i‡(
	`unf‹m©
 (
öput
, "memory-trace"))

1652 
tu∫_⁄_mem_åa˚
 = 1;

1654 i‡(
	`unf‹m©
 (
öput
, "elog-events %d",

1655 &
vm
->
ñog_maö
.
evít_rög_size
))

1657 i‡(
	`unf‹m©
 (
öput
, "elog-post-mortem-dump"))

1658 
vm
->
ñog_po°_m‹ãm_dump
 = 1;

1660  
	`unf‹m©_∑r£_îr‹
 (
öput
);

1663 
	`unf‹m©_‰ì
 (
öput
);

1666 i‡(
tu∫_⁄_mem_åa˚
)

1667 
	`˛ib_mem_åa˚
 (1);

1670 
	}
}

1672 
VLIB_EARLY_CONFIG_FUNCTION
 (
vlib_maö_c⁄figuª
, "vlib");

1675 
	$dummy_queue_sig«l_ˇŒback
 (
vlib_maö_t
 * 
vm
)

1677 
	}
}

1681 
	$vlib_maö
 (
vlib_maö_t
 * vﬁ©ûê
vm
, 
unf‹m©_öput_t
 * 
öput
)

1683 
˛ib_îr‹_t
 *vﬁ©ûê
îr‹
;

1684 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

1686 
vm
->
queue_sig«l_ˇŒback
 = 
dummy_queue_sig«l_ˇŒback
;

1688 
	`˛ib_time_öô
 (&
vm
->
˛ib_time
);

1691 i‡(!
vm
->
ñog_maö
.
evít_rög_size
)

1692 
vm
->
ñog_maö
.
evít_rög_size
 = 128 << 10;

1693 
	`ñog_öô
 (&
vm
->
ñog_maö
, vm->ñog_maö.
evít_rög_size
);

1694 
	`ñog_íabÀ_dißbÀ
 (&
vm
->
ñog_maö
, 1);

1697 i‡(!
vm
->
«me
)

1698 
vm
->
«me
 = "VLIB";

1700 i‡((
îr‹
 = 
	`unix_physmem_öô
 (
vm
)))

1702 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1703 
d⁄e
;

1706 i‡((
îr‹
 = 
	`vlib_buf„r_maö_öô
 (
vm
)))

1708 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1709 
d⁄e
;

1712 i‡((
îr‹
 = 
	`vlib_thªad_öô
 (
vm
)))

1714 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1715 
d⁄e
;

1719 
	`vlib_ªgi°î_Æl_°©ic_nodes
 (
vm
);

1723 i‡(!
	`unf‹m©
 (
öput
, "£ed %wd", &
vm
->
øndom_£ed
))

1724 
vm
->
øndom_£ed
 = 
	`˛ib_˝u_time_now
 ();

1725 
	`˛ib_øndom_buf„r_öô
 (&
vm
->
øndom_buf„r
, vm->
øndom_£ed
);

1728 i‡((
îr‹
 = 
	`vlib_node_maö_öô
 (
vm
)))

1731 i‡(
CLIB_DEBUG
 > 0)

1732 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1734 
d⁄e
;

1738 i‡(
vm
->
öô_fun˘i⁄s_ˇŒed
 == 0)

1739 
vm
->
öô_fun˘i⁄s_ˇŒed
 = 
	`hash_¸óã
 (0, 0);

1740 i‡((
îr‹
 = 
	`vlib_ˇŒ_Æl_öô_fun˘i⁄s
 (
vm
)))

1741 
d⁄e
;

1744 
	`vlib_buf„r_gë_‹_¸óã_‰ì_li°
 (
vm
,

1745 
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
,

1748 
nm
->
timög_whìl
 = 
	`˛ib_mem_Æloc_Æig√d
 ( (
	`TWT
 (
tw_timî_whìl
)),

1749 
CLIB_CACHE_LINE_BYTES
);

1751 
	`vec_vÆid©e
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
, 10);

1752 
	`_vec_Àn
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
) = 0;

1755 
	`TW
 (
tw_timî_whìl_öô
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

1760 
	`vec_vÆid©e
 (
vm
->
≥ndög_Ωc_ªque°s
, 0);

1761 
	`_vec_Àn
 (
vm
->
≥ndög_Ωc_ªque°s
) = 0;

1763 
	`˛ib_£tjmp
 (&
vm
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_NONE
))

1765 
VLIB_MAIN_LOOP_EXIT_NONE
:

1766 
vm
->
maö_lo›_exô_£t
 = 1;

1769 
VLIB_MAIN_LOOP_EXIT_CLI
:

1770 
d⁄e
;

1773 
îr‹
 = 
vm
->
maö_lo›_îr‹
;

1774 
d⁄e
;

1777 i‡((
îr‹
 = 
	`vlib_ˇŒ_Æl_c⁄fig_fun˘i⁄s
 (
vm
, 
öput
, 0 )))

1778 
d⁄e
;

1782 
˛ib_îr‹_t
 *
sub_îr‹
;

1783 
sub_îr‹
 = 
	`vlib_ˇŒ_Æl_maö_lo›_íãr_fun˘i⁄s
 (
vm
);

1784 i‡(
sub_îr‹
)

1785 
	`˛ib_îr‹_ªp‹t
 (
sub_îr‹
);

1788 
	`vlib_maö_lo›
 (
vm
);

1790 
d⁄e
:

1793 
˛ib_îr‹_t
 *
sub_îr‹
;

1794 
sub_îr‹
 = 
	`vlib_ˇŒ_Æl_maö_lo›_exô_fun˘i⁄s
 (
vm
);

1795 i‡(
sub_îr‹
)

1796 
	`˛ib_îr‹_ªp‹t
 (
sub_îr‹
);

1799 i‡(
îr‹
)

1800 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1803 
	}
}

	@main.h

40 #i‚de‡
ö˛uded_vlib_maö_h


41 
	#ö˛uded_vlib_maö_h


	)

43 
	~<vµö‰a/ñog.h
>

44 
	~<vµö‰a/f‹m©.h
>

45 
	~<vµö‰a/l⁄gjmp.h
>

46 
	~<vµö‰a/poﬁ.h
>

47 
	~<vµö‰a/øndom_buf„r.h
>

48 
	~<vµö‰a/time.h
>

50 
	~<±hªad.h
>

55 #i‚de‡
VLIB_ELOG_MAIN_LOOP


56 
	#VLIB_ELOG_MAIN_LOOP
 0

	)

59 
	svlib_maö_t


62 
˛ib_time_t
 
	m˛ib_time
;

65 
u64
 
	m˝u_time_œ°_node_di•©ch
;

68 
u64
 
	m˝u_time_maö_lo›_°¨t
;

71 
u32
 
	mmaö_lo›_cou¡
;

74 
u32
 
	mmaö_lo›_ve˘‹s_¥o˚s£d
;

75 
u32
 
	mmaö_lo›_nodes_¥o˚s£d
;

80 
u32
 
	mve˘‹_cou¡s_≥r_maö_lo›
[2];

81 
u32
 
	mnode_cou¡s_≥r_maö_lo›
[2];

84 
	#VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
 7

	)

87 
u32
 
	mmaö_lo›_exô_£t
;

89 vﬁ©ûê
u32
 
	mmaö_lo›_exô_now
;

90 
˛ib_l⁄gjmp_t
 
	mmaö_lo›_exô
;

91 
	#VLIB_MAIN_LOOP_EXIT_NONE
 0

	)

92 
	#VLIB_MAIN_LOOP_EXIT_PANIC
 1

	)

94 
	#VLIB_MAIN_LOOP_EXIT_CLI
 2

	)

97 
˛ib_îr‹_t
 *
	mmaö_lo›_îr‹
;

100 *
	m«me
;

103 *
	mhóp_ba£
;

104 
uw‹d
 
	mhóp_size
;

106 
vlib_buf„r_maö_t
 *
	mbuf„r_maö
;

111 
	m˛ib_îr‹_t
 *(*
	mos_physmem_ªgi⁄_Æloc
Ë(
vlib_maö_t
 * 
	mvm
,

112 *
	m«me
, 
u32
 
	msize
,

113 
u8
 
	mnuma_node
, 
u32
 
	mÊags
,

114 
vlib_physmem_ªgi⁄_ödex_t
 *

115 
	midx
);

117 (*
	mos_physmem_ªgi⁄_‰ì
Ë(
vlib_maö_t
 * 
	mvm
,

118 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
);

120 *(*
	mos_physmem_Æloc_Æig√d
Ë(
vlib_maö_t
 * 
	mvm
,

121 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
,

122 
uw‹d
 
	mn_byãs
, uw‹d 
	mÆignmít
);

123 (*
	mos_physmem_‰ì
Ë(
vlib_maö_t
 * 
	mvm
,

124 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
, *
	mx
);

127 
vlib_node_maö_t
 
	mnode_maö
;

130 
vlib_˛i_maö_t
 
	m˛i_maö
;

133 
vlib_åa˚_maö_t
 
	måa˚_maö
;

136 
vlib_îr‹_maö_t
 
	mîr‹_maö
;

140 (*
	mos_pu¡_‰ame
Ë(
vlib_maö_t
 * 
	mvm
,

141 
vlib_node_ru¡ime_t
 * 
	mnode
,

142 
vlib_‰ame_t
 * 
	m‰ame
);

145 
mc_maö_t
 *
	mmc_maö
;

148 
u32
 
	mmc_°ªam_ödex
;

150 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_mc_°ªam_joö
;

153 
ñog_maö_t
 
	mñog_maö
;

156 
ñog_evít_ty≥_t
 *
	mnode_ˇŒ_ñog_evít_ty≥s
;

157 
ñog_evít_ty≥_t
 *
	mnode_ªtu∫_ñog_evít_ty≥s
;

159 
ñog_evít_ty≥_t
 *
	mîr‹_ñog_evít_ty≥s
;

162 
uw‹d
 
	møndom_£ed
;

165 
˛ib_øndom_buf„r_t
 
	møndom_buf„r
;

168 
uw‹d
 *
	möô_fun˘i⁄s_ˇŒed
;

171 
u32
 
	mthªad_ödex
;

173 **
	mmbuf_Æloc_li°
;

176 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	möô_fun˘i⁄_ªgi°øti⁄s
;

177 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mw‹kî_öô_fun˘i⁄_ªgi°øti⁄s
;

178 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mmaö_lo›_íãr_fun˘i⁄_ªgi°øti⁄s
;

179 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mmaö_lo›_exô_fun˘i⁄_ªgi°øti⁄s
;

180 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	m≠i_öô_fun˘i⁄_ªgi°øti⁄s
;

181 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 *
	mc⁄fig_fun˘i⁄_ªgi°øti⁄s
;

182 
mc_£rülize_msg_t
 *
	mmc_msg_ªgi°øti⁄s
;

185 vﬁ©ûê
u32
 
	mqueue_sig«l_≥ndög
;

186 vﬁ©ûê
u32
 
	m≠i_queue_n⁄em±y
;

187 (*
	mqueue_sig«l_ˇŒback
Ë(
	mvlib_maö_t
 *);

188 
u8
 **
	m¨gv
;

191 vﬁ©ûê
	m∑rked_©_b¨rõr
;

194 
	mñog_po°_m‹ãm_dump
;

200 
	m√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
;

206 
f64
 
	mb¨rõr_ïoch
;

209 
f64
 
	mb¨rõr_no_˛o£_bef‹e
;

212 
uw‹d
 *
	m≥ndög_Ωc_ªque°s
;

214 } 
	tvlib_maö_t
;

217 
vlib_maö_t
 
vlib_globÆ_maö
;

219 
vlib_w‹kî_lo›
 (
vlib_maö_t
 * 
vm
);

221 
Æways_ölöe
 
f64


222 
	$vlib_time_now
 (
vlib_maö_t
 * 
vm
)

224  
	`˛ib_time_now
 (&
vm
->
˛ib_time
);

225 
	}
}

227 
Æways_ölöe
 
f64


228 
	$vlib_time_now_ticks
 (
vlib_maö_t
 * 
vm
, 
u64
 
n
)

230  
	`˛ib_time_now_öã∫Æ
 (&
vm
->
˛ib_time
, 
n
);

231 
	}
}

234 
Æways_ölöe
 

235 
	$vlib_time_waô
 (
vlib_maö_t
 * 
vm
, 
f64
 
waô
)

237 
f64
 
t
 = 
	`vlib_time_now
 (
vm
);

238 
f64
 
limô
 = 
t
 + 
waô
;

239 
t
 < 
limô
)

240 
t
 = 
	`vlib_time_now
 (
vm
);

241 
	}
}

244 
	#vlib_time_code
(
vm
,
body
) \

246 
f64
 
_t
[2]; \

247 
_t
[0] = 
	`vlib_time_now
 (
vm
); \

248 dÿ{ 
body
; } 0); \

249 
_t
[1] = 
	`vlib_time_now
 (
vm
); \

250 
	`˛ib_w¨nög
 ("%.7e", 
_t
[1] - _t[0]); \

251 } 0)

	)

253 
	#vlib_waô_wôh_timeout
(
vm
,
su•íd_time
,
timeout_time
,
ã°
) \

255 
uw‹d
 
__vlib_waô_wôh_timeout
 = 0; \

256 
f64
 
__vlib_waô_time
 = 0; \

257 ! (
__vlib_waô_wôh_timeout
 = (
ã°
)) \

258 && 
__vlib_waô_time
 < (
timeout_time
)) \

260 
	`vlib_¥o˚ss_su•íd
 (
vm
, 
su•íd_time
); \

261 
__vlib_waô_time
 +
su•íd_time
; \

263 
__vlib_waô_wôh_timeout
; \

264 })

	)

266 
Æways_ölöe
 

267 
	$vlib_∑nic_wôh_îr‹
 (
vlib_maö_t
 * 
vm
, 
˛ib_îr‹_t
 * 
îr‹
)

269 
vm
->
maö_lo›_îr‹
 = 
îr‹
;

270 
	`˛ib_l⁄gjmp
 (&
vm
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_PANIC
);

271 
	}
}

273 
	#vlib_∑nic_wôh_msg
(
vm
,
¨gs
...) \

274 
	`vlib_∑nic_wôh_îr‹
 (
vm
, 
	`˛ib_îr‹_ªtu∫
 (0, 
¨gs
))

	)

276 
Æways_ölöe
 

277 
	$vlib_∑nic
 (
vlib_maö_t
 * 
vm
)

279 
	`vlib_∑nic_wôh_îr‹
 (
vm
, 0);

280 
	}
}

282 
Æways_ölöe
 
u32


283 
	$vlib_ve˘‹_öput_°©s_ödex
 (
vlib_maö_t
 * 
vm
, 
w‹d
 
dñè
)

285 
u32
 
i
;

286 
i
 = 
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

287 
	`ASSERT
 (
	`is_pow2
 (
	`ARRAY_LEN
 (
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
)));

288  (
i
 + 
dñè
Ë& (
	`ARRAY_LEN
 (
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
) - 1);

289 
	}
}

294 
Æways_ölöe
 
u32


295 
	$vlib_œ°_ve˘‹s_≥r_maö_lo›
 (
vlib_maö_t
 * 
vm
)

297 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

298 
u32
 
n
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

299  
n
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

300 
	}
}

303 
Æways_ölöe
 
f64


304 
	$vlib_œ°_ve˘‹s_≥r_maö_lo›_as_f64
 (
vlib_maö_t
 * 
vm
)

306 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

307 
u32
 
v
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

308  (
f64
Ë
v
 / (f64Ë(1 << 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
);

309 
	}
}

312 
Æways_ölöe
 
f64


313 
	$vlib_œ°_ve˘‹_Àngth_≥r_node
 (
vlib_maö_t
 * 
vm
)

315 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

316 
u32
 
v
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

317 
u32
 
n
 = 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
];

318  
n
 =0 ? 0 : (
f64
Ë
v
 / (f64)Ç;

319 
	}
}

321 
u32
 
wøps
;

323 
Æways_ölöe
 

324 
	$vlib_ö¸emít_maö_lo›_cou¡î
 (
vlib_maö_t
 * 
vm
)

326 
u32
 
i
, 
c
, 
n
, 
v
, 
is_wøp
;

328 
c
 = 
vm
->
maö_lo›_cou¡
++;

330 
is_wøp
 = (
c
 & 
	`pow2_mask
 (
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)) == 0;

332 i‡(
is_wøp
)

333 
wøps
++;

335 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, 
is_wøp
);

337 
v
 = 
is_wøp
 ? 0 : 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

338 
n
 = 
is_wøp
 ? 0 : 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
];

340 
v
 +
vm
->
maö_lo›_ve˘‹s_¥o˚s£d
;

341 
n
 +
vm
->
maö_lo›_nodes_¥o˚s£d
;

342 
vm
->
maö_lo›_ve˘‹s_¥o˚s£d
 = 0;

343 
vm
->
maö_lo›_nodes_¥o˚s£d
 = 0;

344 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
] = 
v
;

345 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
] = 
n
;

347 i‡(
	`PREDICT_FALSE
 (
vm
->
maö_lo›_exô_now
))

348 
	`˛ib_l⁄gjmp
 (&
vm
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_CLI
);

349 
	}
}

351 
Æways_ölöe
 
	gvlib_£t_queue_sig«l_ˇŒback


352 (
vlib_maö_t
 * 
	gvm
, (*
Â
) (vlib_main_t *))

354 
vm
->
queue_sig«l_ˇŒback
 = 
Â
;

355 
	}
}

358 
vlib_maö
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
);

361 
u8
 **
vlib_thªad_°acks
;

364 
u32
 
	$vlib_≠p_num_thªad_°acks_√eded
 (Ë
	`__©åibuã__
 ((
wók
));

366 
	`vlib_node_sync_°©s
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
n
);

	@mc.c

18 
	~<vlib/vlib.h
>

24 
	#MSG_ID_DEBUG
 0

	)

26 
f‹m©_fun˘i⁄_t
 
	gf‹m©_mc_°ªam_°©e
;

28 
u32


29 
	$ñog_id_f‹_≥î_id
 (
mc_maö_t
 * 
m
, 
u64
 
≥î_id
)

31 
uw‹d
 *
p
, 
r
;

32 
mhash_t
 *
h
 = &
m
->
ñog_id_by_≥î_id
;

34 i‡(!
m
->
ñog_id_by_≥î_id
.
hash
)

35 
	`mhash_öô
 (
h
,  (
uw‹d
),  (
mc_≥î_id_t
));

37 
p
 = 
	`mhash_gë
 (
h
, &
≥î_id
);

38 i‡(
p
)

39  
p
[0];

40 
r
 = 
	`ñog_°rög
 (
m
->
ñog_maö
, "%U", m->
å™•‹t
.
f‹m©_≥î_id
, 
≥î_id
);

41 
	`mhash_£t
 (
h
, &
≥î_id
, 
r
, 0);

42  
r
;

43 
	}
}

45 
u32


46 
	$ñog_id_f‹_msg_«me
 (
mc_maö_t
 * 
m
, *
msg_«me
)

48 
uw‹d
 *
p
, 
r
;

49 
uw‹d
 *
h
 = 
m
->
ñog_id_by_msg_«me
;

50 
u8
 *
«me_c›y
;

52 i‡(!
h
)

53 
h
 = 
m
->
ñog_id_by_msg_«me
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

55 
p
 = 
	`hash_gë_mem
 (
h
, 
msg_«me
);

56 i‡(
p
)

57  
p
[0];

58 
r
 = 
	`ñog_°rög
 (
m
->
ñog_maö
, "%s", 
msg_«me
);

60 
«me_c›y
 = 
	`f‹m©
 (0, "%s%c", 
msg_«me
, 0);

62 
	`hash_£t_mem
 (
h
, 
«me_c›y
, 
r
);

63 
m
->
ñog_id_by_msg_«me
 = 
h
;

65  
r
;

66 
	}
}

69 
	$ñog_tx_msg
 (
mc_maö_t
 * 
m
, 
u32
 
°ªam_id
, u32 
loˇl_£quí˚
,

70 
u32
 
ªåy_cou¡
)

72 i‡(
MC_EVENT_LOGGING
 > 0)

75 
	`ELOG_TYPE_DECLARE
 (
e
) =

77 .
f‹m©
 = "tx-msg: stream %dÜocal seq %dáttempt %d",

78 .
f‹m©_¨gs
 = "i4i4i4",

83 
u32
 
°ªam_id
, 
loˇl_£quí˚
, 
ªåy_cou¡
;

84 } *
ed
;

85 
ed
 = 
	`ELOG_DATA
 (
m
->
ñog_maö
, 
e
);

86 
ed
->
°ªam_id
 = stream_id;

87 
ed
->
loˇl_£quí˚
 =Üocal_sequence;

88 
ed
->
ªåy_cou¡
 =Ñetry_count;

90 
	}
}

103 
Æways_ölöe
 
i32


104 
	$mc_£q_cmp
 (
u32
 
x
, u32 
y
)

106  (
i32
Ë
x
 - (i32Ë
y
;

107 
	}
}

110 
	$mc_gë_vlib_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
n_byãs
, u32 * 
bi_ªtu∫
)

112 
u32
 
n_Æloc
, 
bi
 = 0;

113 
vlib_buf„r_t
 *
b
;

115 
n_Æloc
 = 
	`vlib_buf„r_Æloc
 (
vm
, &
bi
, 1);

116 
	`ASSERT
 (
n_Æloc
 == 1);

118 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

119 
b
->
cuºít_Àngth
 = 
n_byãs
;

120 *
bi_ªtu∫
 = 
bi
;

121  (*Ë
b
->
d©a
;

122 
	}
}

125 
	$dñëe_≥î_wôh_ödex
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
,

126 
uw‹d
 
ödex
, 
nŸify_≠∂iˇti⁄
)

128 
mc_°ªam_≥î_t
 *
p
 = 
	`poﬁ_ñt_©_ödex
 (
s
->
≥îs
, 
ödex
);

129 
	`ASSERT
 (
p
 != 0);

130 i‡(
s
->
c⁄fig
.
≥î_dõd
 && 
nŸify_≠∂iˇti⁄
)

131 
s
->
c⁄fig
.
	`≥î_dõd
 (
mcm
, s, 
p
->
id
);

133 
s
->
Æl_≥î_bôm≠
 = 
	`˛ib_bôm≠_™dnŸi
 (s->Æl_≥î_bôm≠, 
p
 - s->
≥îs
);

135 i‡(
MC_EVENT_LOGGING
 > 0)

138 
	`ELOG_TYPE_DECLARE
 (
e
) =

140 .
f‹m©
 = "deleteÖeer %s fromáll_peer_bitmap",

141 .
f‹m©_¨gs
 = "T4",

146 
u32
 
≥î
;

147 } *
ed
 = 0;

149 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

150 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
p
->
id
.
as_u64
);

153 
	}
}

155 
mc_°ªam_≥î_t
 *

156 
	$gë_‹_¸óã_≥î_wôh_id
 (
mc_maö_t
 * 
mcm
,

157 
mc_°ªam_t
 * 
s
, 
mc_≥î_id_t
 
id
, *
¸óãd
)

159 
uw‹d
 *
q
 = 
	`mhash_gë
 (&
s
->
≥î_ödex_by_id
, &
id
);

160 
mc_°ªam_≥î_t
 *
p
;

162 i‡(
q
)

164 
p
 = 
	`poﬁ_ñt_©_ödex
 (
s
->
≥îs
, 
q
[0]);

165 
d⁄e
;

168 
	`poﬁ_gë
 (
s
->
≥îs
, 
p
);

169 
	`mem£t
 (
p
, 0,  (p[0]));

170 
p
->
id
 = id;

171 
p
->
œ°_£quí˚_ª˚ived
 = ~0;

172 
	`mhash_£t
 (&
s
->
≥î_ödex_by_id
, &
id
, 
p
 - s->
≥îs
, 0);

173 i‡(
¸óãd
)

174 *
¸óãd
 = 1;

176 
d⁄e
:

177 i‡(
MC_EVENT_LOGGING
 > 0)

180 
	`ELOG_TYPE_DECLARE
 (
e
) =

182 .
f‹m©
 = "get_or_create %sÖeer %s stream %d seq %d",

183 .
f‹m©_¨gs
 = "t4T4i4i4",

184 .
n_íum_°rögs
 = 2,

185 .
íum_°rögs
 = {

192 
u32
 
is_√w
, 
≥î
, 
°ªam_ödex
, 
rx_£quí˚
;

193 } *
ed
 = 0;

195 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

196 
ed
->
is_√w
 = 
q
 ? 0 : 1;

197 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
p
->
id
.
as_u64
);

198 
ed
->
°ªam_ödex
 = 
s
->
ödex
;

199 
ed
->
rx_£quí˚
 = 
p
->
œ°_£quí˚_ª˚ived
;

202 
s
->
Æl_≥î_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (s->Æl_≥î_bôm≠, 
p
 - s->
≥îs
);

203  
p
;

204 
	}
}

207 
	$maybe_£nd_wödow_›í_evít
 (
vlib_maö_t
 * 
vm
, 
mc_°ªam_t
 * 
°ªam
)

209 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
p
;

211 i‡(
	`poﬁ_ñts
 (
°ªam
->
ªåy_poﬁ
Ë>°ªam->
c⁄fig
.
wödow_size
)

214 
	`vec_f‹óch
 (
p
, 
°ªam
->
¥ocs_waôög_f‹_›í_wödow
)

215 
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vm
, 
p
);

217 i‡(
°ªam
->
¥ocs_waôög_f‹_›í_wödow
)

218 
	`_vec_Àn
 (
°ªam
->
¥ocs_waôög_f‹_›í_wödow
) = 0;

219 
	}
}

222 
	$mc_ªåy_‰ì
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
, 
mc_ªåy_t
 * 
r
)

224 
mc_ªåy_t
 
ªc‹d
, *
ªç
;

226 i‡(
r
->
u«cked_by_≥î_bôm≠
)

227 
	`_vec_Àn
 (
r
->
u«cked_by_≥î_bôm≠
) = 0;

229 i‡(
	`˛ib_fifo_ñts
 (
s
->
ªtúed_fifo
Ë>2 * s->
c⁄fig
.
wödow_size
)

231 
	`˛ib_fifo_sub1
 (
s
->
ªtúed_fifo
, 
ªc‹d
);

232 
	`vlib_buf„r_‰ì_⁄e
 (
mcm
->
vlib_maö
, 
ªc‹d
.
buf„r_ödex
);

235 
	`˛ib_fifo_add2
 (
s
->
ªtúed_fifo
, 
ªç
);

237 
ªç
->
buf„r_ödex
 = 
r
->buffer_index;

238 
ªç
->
loˇl_£quí˚
 = 
r
->local_sequence;

240 
r
->
buf„r_ödex
 = ~0;

241 
	}
}

244 
	$mc_ª£nd_ªtúed
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
, 
u32
 
loˇl_£quí˚
)

246 
mc_ªåy_t
 *
ªåy
;

248 i‡(
MC_EVENT_LOGGING
 > 0)

251 
	`ELOG_TYPE_DECLARE
 (
e
) =

253 .
f‹m©
 = "resend-retired: search forÜocal seq %d",

254 .
f‹m©_¨gs
 = "i4",

259 
u32
 
loˇl_£quí˚
;

260 } *
ed
;

261 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

262 
ed
->
loˇl_£quí˚
 =Üocal_sequence;

266 
	`˛ib_fifo_f‹óch
 (
ªåy
, 
s
->
ªtúed_fifo
,

268 i‡(
ªåy
->
loˇl_£quí˚
 ==Üocal_sequence)

270 
	`ñog_tx_msg
 (
mcm
, 
s
->
ödex
, 
ªåy
-> 
loˇl_£quí˚
, -13);

271 
mcm
->
å™•‹t
.
	`tx_buf„r
 (mcm->å™•‹t.
›aque
,

272 
MC_TRANSPORT_USER_REQUEST_TO_RELAY
,

273 
ªåy
->
buf„r_ödex
);

279 i‡(
MC_EVENT_LOGGING
 > 0)

282 
	`ELOG_TYPE_DECLARE
 (
e
) =

284 .
f‹m©
 = "resend-retired: FAILED search forÜocal seq %d",

285 .
f‹m©_¨gs
 = "i4",

290 
u32
 
loˇl_£quí˚
;

291 } *
ed
;

292 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

293 
ed
->
loˇl_£quí˚
 =Üocal_sequence;

295 
	}
}

297 
uw‹d
 *

298 
	$dñëe_ªåy_fifo_ñt
 (
mc_maö_t
 * 
mcm
,

299 
mc_°ªam_t
 * 
°ªam
,

300 
mc_ªåy_t
 * 
r
, 
uw‹d
 * 
dód_≥î_bôm≠
)

302 
mc_°ªam_≥î_t
 *
p
;

305 
	`poﬁ_f‹óch
 (
p
, 
°ªam
->
≥îs
, ({

306 
uw‹d
 
pi
 = 
p
 - 
°ªam
->
≥îs
;

307 
uw‹d
 
is_Æive
 = 0 =
	`˛ib_bôm≠_gë
 (
r
->
u«cked_by_≥î_bôm≠
, 
pi
);

309 i‡(! 
is_Æive
)

310 
dód_≥î_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (dód_≥î_bôm≠, 
pi
);

312 i‡(
MC_EVENT_LOGGING
 > 0)

314 
	`ELOG_TYPE_DECLARE
 (
e
) = {

315 .
f‹m©
 = "delete_retry_fifo_elt:Öeer %s is %s",

316 .
f‹m©_¨gs
 = "T4t4",

317 .
n_íum_°rögs
 = 2,

318 .
íum_°rögs
 = { "alive", "dead", },

320 °ru˘ { 
u32
 
≥î
, 
is_Æive
; } * 
ed
;

321 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

322 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
p
->
id
.
as_u64
);

323 
ed
->
is_Æive
 = is_alive;

328 
	`hash_un£t
 (
°ªam
->
ªåy_ödex_by_loˇl_£quí˚
, 
r
->
loˇl_£quí˚
);

329 
	`mc_ªåy_‰ì
 (
mcm
, 
°ªam
, 
r
);

331  
dód_≥î_bôm≠
;

332 
	}
}

334 
Æways_ölöe
 
mc_ªåy_t
 *

335 
	$¥ev_ªåy
 (
mc_°ªam_t
 * 
s
, 
mc_ªåy_t
 * 
r
)

337  (
r
->
¥ev_ödex
 != ~0

338 ? 
	`poﬁ_ñt_©_ödex
 (
s
->
ªåy_poﬁ
, 
r
->
¥ev_ödex
) : 0);

339 
	}
}

341 
Æways_ölöe
 
mc_ªåy_t
 *

342 
	$√xt_ªåy
 (
mc_°ªam_t
 * 
s
, 
mc_ªåy_t
 * 
r
)

344  (
r
->
√xt_ödex
 != ~0

345 ? 
	`poﬁ_ñt_©_ödex
 (
s
->
ªåy_poﬁ
, 
r
->
√xt_ödex
) : 0);

346 
	}
}

348 
Æways_ölöe
 

349 
	$ªmove_ªåy_‰om_poﬁ
 (
mc_°ªam_t
 * 
s
, 
mc_ªåy_t
 * 
r
)

351 
mc_ªåy_t
 *
p
 = 
	`¥ev_ªåy
 (
s
, 
r
);

352 
mc_ªåy_t
 *
n
 = 
	`√xt_ªåy
 (
s
, 
r
);

354 i‡(
p
)

355 
p
->
√xt_ödex
 = 
r
->next_index;

357 
s
->
ªåy_hód_ödex
 = 
r
->
√xt_ödex
;

358 i‡(
n
)

359 
n
->
¥ev_ödex
 = 
r
->prev_index;

361 
s
->
ªåy_èû_ödex
 = 
r
->
¥ev_ödex
;

363 
	`poﬁ_put_ödex
 (
s
->
ªåy_poﬁ
, 
r
 - s->retry_pool);

364 
	}
}

367 
	$check_ªåy
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
)

369 
mc_ªåy_t
 *
r
;

370 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

371 
f64
 
now
 = 
	`vlib_time_now
 (
vm
);

372 
uw‹d
 *
dód_≥î_bôm≠
 = 0;

373 
u32
 
ri
, 
ri_√xt
;

375 
ri
 = 
s
->
ªåy_hód_ödex
;Ñò!~0;Ñò
ri_√xt
)

377 
r
 = 
	`poﬁ_ñt_©_ödex
 (
s
->
ªåy_poﬁ
, 
ri
);

378 
ri_√xt
 = 
r
->
√xt_ödex
;

380 i‡(
now
 < 
r
->
£¡_©
 + 
s
->
c⁄fig
.
ªåy_öãrvÆ
)

383 
r
->
n_ªåõs
 += 1;

384 i‡(
r
->
n_ªåõs
 > 
s
->
c⁄fig
.
ªåy_limô
)

386 
dód_≥î_bôm≠
 =

387 
	`dñëe_ªåy_fifo_ñt
 (
mcm
, 
s
, 
r
, 
dód_≥î_bôm≠
);

388 
	`ªmove_ªåy_‰om_poﬁ
 (
s
, 
r
);

392 i‡(
MC_EVENT_LOGGING
 > 0)

394 
mc_°ªam_≥î_t
 *
p
;

397 
	`ELOG_TYPE_DECLARE
 (
t
) =

399 .
f‹m©
 = "resendÜocal seq %dáttempt %d",

400 .
f‹m©_¨gs
 = "i4i4",

405 
	`poﬁ_f‹óch
 (
p
, 
s
->
≥îs
, ({

406 i‡(
	`˛ib_bôm≠_gë
 (
r
->
u«cked_by_≥î_bôm≠
, 
p
 - 
s
->
≥îs
))

408 
	`ELOG_TYPE_DECLARE
 (
ev
) = {

409 .
f‹m©
 = "resend:Çeeded byÖeer %sÜocal seq %d",

410 .
f‹m©_¨gs
 = "T4i4",

412 °ru˘ { 
u32
 
≥î
, 
rx_£quí˚
; } * 
ed
;

413 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
ev
);

414 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
p
->
id
.
as_u64
);

415 
ed
->
rx_£quí˚
 = 
r
->
loˇl_£quí˚
;

422 
u32
 
£quí˚
;

423 
u32
 
åaû
;

424 } *
ed
;

425 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

426 
ed
->
£quí˚
 = 
r
->
loˇl_£quí˚
;

427 
ed
->
åaû
 = 
r
->
n_ªåõs
;

430 
r
->
£¡_©
 = 
	`vlib_time_now
 (
vm
);

431 
s
->
°©s
.
n_ªåõs
 += 1;

433 
	`ñog_tx_msg
 (
mcm
, 
s
->
ödex
, 
r
->
loˇl_£quí˚
,Ñ->
n_ªåõs
);

435 
mcm
->
å™•‹t
.
tx_buf„r


436 (
mcm
->
å™•‹t
.
›aque
,

437 
MC_TRANSPORT_USER_REQUEST_TO_RELAY
, 
r
->
buf„r_ödex
);

441 
	`maybe_£nd_wödow_›í_evít
 (
mcm
->
vlib_maö
, 
s
);

444 i‡(!
	`˛ib_bôm≠_is_zîo
 (
dód_≥î_bôm≠
))

446 
uw‹d
 
i
;

449 
	`˛ib_bôm≠_f‹óch
 (
i
, 
dód_≥î_bôm≠
, ({

450 
	`dñëe_≥î_wôh_ödex
 (
mcm
, 
s
, 
i
, 1);

453 
	`poﬁ_f‹óch
 (
r
, 
s
->
ªåy_poﬁ
, ({

454 
r
->
u«cked_by_≥î_bôm≠
 =

455 
	`˛ib_bôm≠_™dnŸi
 (
r
->
u«cked_by_≥î_bôm≠
, 
i
);

459 
	`˛ib_bôm≠_‰ì
 (
dód_≥î_bôm≠
);

461 
	}
}

463 
Æways_ölöe
 
mc_maö_t
 *

464 
	$mc_node_gë_maö
 (
vlib_node_ru¡ime_t
 * 
node
)

466 
mc_maö_t
 **
p
 = (*Ë
node
->
ru¡ime_d©a
;

467  
p
[0];

468 
	}
}

470 
uw‹d


471 
	$mc_ªåy_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

472 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
f
)

474 
mc_maö_t
 *
mcm
 = 
	`mc_node_gë_maö
 (
node
);

475 
mc_°ªam_t
 *
s
;

479 
	`vlib_¥o˚ss_su•íd
 (
vm
, 1.0);

480 
	`vec_f‹óch
 (
s
, 
mcm
->
°ªam_ve˘‹
)

482 i‡(
s
->
°©e
 !
MC_STREAM_STATE_övÆid
)

483 
	`check_ªåy
 (
mcm
, 
s
);

487 
	}
}

490 
	$£nd_joö_‹_Àave_ªque°
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_ödex
, u32 
is_joö
)

492 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

493 
mc_msg_joö_‹_Àave_ªque°_t
 *
mp
;

494 
u32
 
bi
;

496 
mp
 = 
	`mc_gë_vlib_buf„r
 (
vm
,  (mp[0]), &
bi
);

497 
	`mem£t
 (
mp
, 0,  (*mp));

498 
mp
->
ty≥
 = 
MC_MSG_TYPE_joö_‹_Àave_ªque°
;

499 
mp
->
≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

500 
mp
->
°ªam_ödex
 = stream_index;

501 
mp
->
is_joö
 = is_join;

503 
	`mc_byã_sw≠_msg_joö_‹_Àave_ªque°
 (
mp
);

509 
mcm
->
å™•‹t
.
	`tx_buf„r
 (mcm->å™•‹t.
›aque
, 
MC_TRANSPORT_JOIN
, 
bi
);

510 
	}
}

512 
uw‹d


513 
	$mc_joö_agî_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

514 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
f
)

516 
mc_maö_t
 *
mcm
 = 
	`mc_node_gë_maö
 (
node
);

520 i‡(
mcm
->
joös_ö_¥ogªss
)

522 
mc_°ªam_t
 *
s
;

523 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
p
;

524 
f64
 
now
 = 
	`vlib_time_now
 (
vm
);

526 
	`vec_f‹óch
 (
s
, 
mcm
->
°ªam_ve˘‹
)

528 i‡(
s
->
°©e
 !
MC_STREAM_STATE_joö_ö_¥ogªss
)

531 i‡(
now
 > 
s
->
joö_timeout
)

533 
s
->
°©e
 = 
MC_STREAM_STATE_ªady
;

535 i‡(
MC_EVENT_LOGGING
 > 0)

538 
	`ELOG_TYPE_DECLARE
 (
e
) =

540 .
f‹m©
 = "stream %d joinÅimeout",

543 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 
s
->
ödex
);

548 (Ë
gë_‹_¸óã_≥î_wôh_id


549 (
mcm
, 
s
, mcm->
å™•‹t
.
our_ack_≥î_id
, 0);

551 
	`vec_f‹óch
 (
p
, 
s
->
¥ocs_waôög_f‹_joö_d⁄e
)

552 
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vm
, 
p
);

553 i‡(
s
->
¥ocs_waôög_f‹_joö_d⁄e
)

554 
	`_vec_Àn
 (
s
->
¥ocs_waôög_f‹_joö_d⁄e
) = 0;

556 
mcm
->
joös_ö_¥ogªss
--;

557 
	`ASSERT
 (
mcm
->
joös_ö_¥ogªss
 >= 0);

562 
	`£nd_joö_‹_Àave_ªque°
 (
mcm
, 
s
->
ödex
, 1 );

565 i‡(
mcm
->
ªœy_°©e
 =
MC_RELAY_STATE_SLAVE
)

566 
s
->
joö_timeout
 = 
	`vlib_time_now
 (
vm
) + 2.0;

569 i‡(
MC_EVENT_LOGGING
 > 0)

572 
	`ELOG_TYPE_DECLARE
 (
e
) =

574 .
f‹m©
 = "stream %dÑesend joinÑequest",

577 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 
s
->
ödex
);

583 
	`vlib_¥o˚ss_su•íd
 (
vm
, .5);

587 
	}
}

590 
	$£rülize_mc_ªgi°î_°ªam_«me
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

592 *
«me
 = 
	`va_¨g
 (*
va
, *);

593 
	`£rülize_c°rög
 (
m
, 
«me
);

594 
	}
}

597 
	$ñog_°ªam_«me
 (*
buf
, 
n_buf_byãs
, *
v
)

599 
	`˛ib_mem˝y
 (
buf
, 
v
, 
	`˛ib_mö
 (
n_buf_byãs
 - 1, 
	`vec_Àn
 (v)));

600 
buf
[
n_buf_byãs
 - 1] = 0;

601 
	}
}

604 
	$un£rülize_mc_ªgi°î_°ªam_«me
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

606 
mc_maö_t
 *
mcm
 = 
	`va_¨g
 (*
va
, mc_main_t *);

607 *
«me
;

608 
mc_°ªam_t
 *
s
;

609 
uw‹d
 *
p
;

611 
	`un£rülize_c°rög
 (
m
, &
«me
);

613 i‡((
p
 = 
	`hash_gë_mem
 (
mcm
->
°ªam_ödex_by_«me
, 
«me
)))

615 i‡(
MC_EVENT_LOGGING
 > 0)

618 
	`ELOG_TYPE_DECLARE
 (
e
) =

620 .
f‹m©
 = "stream index %dálreadyÇamed %s",

621 .
f‹m©_¨gs
 = "i4s16",

626 
u32
 
°ªam_ödex
;

627 
«me
[16];

628 } *
ed
;

629 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

630 
ed
->
°ªam_ödex
 = 
p
[0];

631 
	`ñog_°ªam_«me
 (
ed
->
«me
,  (ed->name),Çame);

634 
	`vec_‰ì
 (
«me
);

638 
	`vec_add2
 (
mcm
->
°ªam_ve˘‹
, 
s
, 1);

639 
	`mc_°ªam_öô
 (
s
);

640 
s
->
°©e
 = 
MC_STREAM_STATE_«me_known
;

641 
s
->
ödex
 = s - 
mcm
->
°ªam_ve˘‹
;

642 
s
->
c⁄fig
.
«me
 =Çame;

644 i‡(
MC_EVENT_LOGGING
 > 0)

647 
	`ELOG_TYPE_DECLARE
 (
e
) =

649 .
f‹m©
 = "stream index %dÇamed %s",

650 .
f‹m©_¨gs
 = "i4s16",

655 
u32
 
°ªam_ödex
;

656 
«me
[16];

657 } *
ed
;

658 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

659 
ed
->
°ªam_ödex
 = 
s
->
ödex
;

660 
	`ñog_°ªam_«me
 (
ed
->
«me
,  (ed->name),Çame);

663 
	`hash_£t_mem
 (
mcm
->
°ªam_ödex_by_«me
, 
«me
, 
s
->
ödex
);

665 
p
 = 
	`hash_gë
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
, 
«me
);

666 i‡(
p
)

668 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
, **
w
;

669 
w
 = 
	`poﬁ_ñt_©_ödex
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_poﬁ
, 
p
[0]);

670 
	`vec_f‹óch
 (
wp
, 
w
[0])

671 
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
mcm
->
vlib_maö
, 
wp
);

672 
	`poﬁ_put
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_poﬁ
, 
w
);

673 
	`hash_un£t_mem
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
, 
«me
);

675 
	}
}

678 
MC_SERIALIZE_MSG
 (
mc_ªgi°î_°ªam_«me_msg
, ) =

680 .
«me
 = "mc_register_stream_name",

681 .
	g£rülize
 = 
£rülize_mc_ªgi°î_°ªam_«me
,

682 .
	gun£rülize
 = 
un£rülize_mc_ªgi°î_°ªam_«me
,

687 
	$mc_rx_buf„r_un£rülize
 (
mc_maö_t
 * 
mcm
,

688 
mc_°ªam_t
 * 
°ªam
,

689 
mc_≥î_id_t
 
≥î_id
, 
u32
 
buf„r_ödex
)

691  
	`mc_un£rülize
 (
mcm
, 
°ªam
, 
buf„r_ödex
);

692 
	}
}

694 
u8
 *

695 
	$mc_öã∫Æ_ˇtchup_¢≠shŸ
 (
mc_maö_t
 * 
mcm
,

696 
u8
 * 
d©a_ve˘‹
,

697 
u32
 
œ°_globÆ_£quí˚_¥o˚s£d
)

699 
£rülize_maö_t
 
m
;

702 
	`£rülize_›í_ve˘‹
 (&
m
, 
d©a_ve˘‹
);

703 
m
.
°ªam
.
cuºít_buf„r_ödex
 = 
	`vec_Àn
 (
d©a_ve˘‹
);

705 
	`£rülize
 (&
m
, 
£rülize_mc_maö
, 
mcm
);

706  
	`£rülize_˛o£_ve˘‹
 (&
m
);

707 
	}
}

710 
	$mc_öã∫Æ_ˇtchup
 (
mc_maö_t
 * 
mcm
, 
u8
 * 
d©a
, 
u32
 
n_d©a_byãs
)

712 
£rülize_maö_t
 
s
;

714 
	`un£rülize_›í_d©a
 (&
s
, 
d©a
, 
n_d©a_byãs
);

716 
	`un£rülize
 (&
s
, 
un£rülize_mc_maö
, 
mcm
);

717 
	}
}

720 
	$mc_°ªam_joö_¥o˚ss_hﬁd
 (Ë
	`__©åibuã__
 ((
wók
));

722 
	$mc_°ªam_joö_¥o˚ss_hﬁd
 ()

724 
	}
}

726 
u32


727 
	$mc_°ªam_joö_hñ≥r
 (
mc_maö_t
 * 
mcm
,

728 
mc_°ªam_c⁄fig_t
 * 
c⁄fig
, 
u32
 
is_öã∫Æ
)

730 
mc_°ªam_t
 *
s
;

731 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

733 
s
 = 0;

734 i‡(!
is_öã∫Æ
)

736 
uw‹d
 *
p
;

739 i‡((
s
 = 
	`mc_°ªam_by_«me
 (
mcm
, 
c⁄fig
->
«me
)))

742 i‡(
s
->
°©e
 =
MC_STREAM_STATE_ªady
)

743  
s
->
ödex
;

747 i‡(!
mcm
->
°ªam_ve˘‹


748 || (
mcm
->
°ªam_ve˘‹
[
MC_STREAM_INDEX_INTERNAL
].
°©e


749 =
MC_STREAM_STATE_övÆid
))

751 
mc_°ªam_c⁄fig_t
 
c
 = {

752 .
«me
 = "mc-internal",

753 .
rx_buf„r
 = 
mc_rx_buf„r_un£rülize
,

754 .
ˇtchup
 = 
mc_öã∫Æ_ˇtchup
,

755 .
ˇtchup_¢≠shŸ
 = 
mc_öã∫Æ_ˇtchup_¢≠shŸ
,

758 
c
.
ßve_¢≠shŸ
 = 
c⁄fig
->save_snapshot;

760 
	`mc_°ªam_joö_hñ≥r
 (
mcm
, &
c
, 1);

766 
s
 = 
	`mc_°ªam_by_«me
 (
mcm
, 
c⁄fig
->
«me
);

767 i‡(!
s
)

769 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
, **
w
;

770 
u8
 *
«me_c›y
 = 
	`f‹m©
 (0, "%s", 
c⁄fig
->
«me
);

772 
	`mc_£rülize_°ªam
 (
mcm
,

773 
MC_STREAM_INDEX_INTERNAL
,

774 &
mc_ªgi°î_°ªam_«me_msg
, 
c⁄fig
->
«me
);

777 
p
 =

778 
	`hash_gë_mem
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
,

779 
«me_c›y
);

780 i‡(
p
)

781 
w
 =

782 
	`poﬁ_ñt_©_ödex
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_poﬁ
,

783 
p
[0]);

786 
	`poﬁ_gë
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_poﬁ
, 
w
);

787 i‡(!
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
)

788 
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
 = 
	`hash_¸óã_°rög
 ( 0,

790 (
uw‹d
));

791 
	`hash_£t_mem
 (
mcm
->
¥ocs_waôög_f‹_°ªam_«me_by_«me
,

792 
«me_c›y
,

793 
w
 - 
mcm
->
¥ocs_waôög_f‹_°ªam_«me_poﬁ
);

794 
w
[0] = 0;

797 
	`vec_add2
 (
w
[0], 
wp
, 1);

798 
	`vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
, 
wp
);

799 
	`vec_‰ì
 (
«me_c›y
);

803 
s
 = 
	`mc_°ªam_by_«me
 (
mcm
, 
c⁄fig
->
«me
);

804 
	`ASSERT
 (
s
 != 0);

805 
	`ASSERT
 (
s
->
°©e
 =
MC_STREAM_STATE_«me_known
);

808 i‡(!
s
)

810 
	`vec_add2
 (
mcm
->
°ªam_ve˘‹
, 
s
, 1);

811 
	`mc_°ªam_öô
 (
s
);

812 
s
->
ödex
 = s - 
mcm
->
°ªam_ve˘‹
;

817 *
«me_ßve
 = 
s
->
c⁄fig
.
«me
;

819 
s
->
c⁄fig
 = config[0];

821 i‡(
«me_ßve
)

822 
s
->
c⁄fig
.
«me
 = 
«me_ßve
;

825 i‡(
s
->
c⁄fig
.
wödow_size
 == 0)

826 
s
->
c⁄fig
.
wödow_size
 = 8;

828 i‡(
s
->
c⁄fig
.
ªåy_öãrvÆ
 == 0.0)

829 
s
->
c⁄fig
.
ªåy_öãrvÆ
 = 1.0;

832 
	`ASSERT
 (
s
->
c⁄fig
.
ªåy_öãrvÆ
 < 30);

834 i‡(
s
->
c⁄fig
.
ªåy_limô
 == 0)

835 
s
->
c⁄fig
.
ªåy_limô
 = 7;

837 
s
->
°©e
 = 
MC_STREAM_STATE_joö_ö_¥ogªss
;

838 i‡(!
s
->
≥î_ödex_by_id
.
hash
)

839 
	`mhash_öô
 (&
s
->
≥î_ödex_by_id
,  (
uw‹d
),  (
mc_≥î_id_t
));

842 
s
->
joö_timeout
 = 
	`vlib_time_now
 (
vm
) + 5.0;

843 
mcm
->
joös_ö_¥ogªss
++;

845 i‡(
MC_EVENT_LOGGING
 > 0)

848 
	`ELOG_TYPE_DECLARE
 (
e
) =

850 .
f‹m©
 = "stream index %d joinÑequest %s",

851 .
f‹m©_¨gs
 = "i4s16",

856 
u32
 
°ªam_ödex
;

857 
«me
[16];

858 } *
ed
;

859 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

860 
ed
->
°ªam_ödex
 = 
s
->
ödex
;

861 
	`ñog_°ªam_«me
 (
ed
->
«me
,  (ed->«me), 
s
->
c⁄fig
.name);

864 
	`£nd_joö_‹_Àave_ªque°
 (
mcm
, 
s
->
ödex
, 1 );

866 
vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹


867 (
vm
, &
s
->
¥ocs_waôög_f‹_joö_d⁄e
);

869 i‡(
MC_EVENT_LOGGING
)

871 
	`ELOG_TYPE
 (
e
, "join complete stream %d");

872 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 
s
->
ödex
);

875  
s
->
ödex
;

876 
	}
}

878 
u32


879 
	$mc_°ªam_joö
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_c⁄fig_t
 * 
c⁄fig
)

881  
	`mc_°ªam_joö_hñ≥r
 (
mcm
, 
c⁄fig
, 0);

882 
	}
}

885 
	$mc_°ªam_Àave
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_ödex
)

887 
mc_°ªam_t
 *
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
°ªam_ödex
);

889 i‡(!
s
)

892 i‡(
MC_EVENT_LOGGING
)

895 
	`ELOG_TYPE_DECLARE
 (
t
) =

897 .
f‹m©
 = "Àave-°ªam: %d",.
f‹m©_¨gs
 = "i4",

902 
u32
 
ödex
;

903 } *
ed
;

904 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

905 
ed
->
ödex
 = 
°ªam_ödex
;

908 
	`£nd_joö_‹_Àave_ªque°
 (
mcm
, 
°ªam_ödex
, 0 );

909 
	`mc_°ªam_‰ì
 (
s
);

910 
s
->
°©e
 = 
MC_STREAM_STATE_«me_known
;

911 
	}
}

914 
	$mc_msg_joö_‹_Àave_ªque°_h™dÀr
 (
mc_maö_t
 * 
mcm
,

915 
mc_msg_joö_‹_Àave_ªque°_t
 * 
ªq
,

916 
u32
 
buf„r_ödex
)

918 
mc_°ªam_t
 *
s
;

919 
mc_msg_joö_ª∂y_t
 *
ªp
;

920 
u32
 
bi
;

922 
	`mc_byã_sw≠_msg_joö_‹_Àave_ªque°
 (
ªq
);

924 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
ªq
->
°ªam_ödex
);

925 i‡(!
s
 || s->
°©e
 !
MC_STREAM_STATE_ªady
)

929 i‡(
ªq
->
is_joö
)

931 
mc_°ªam_t
 *
this_s
;

938 
	`vec_f‹óch
 (
this_s
, 
mcm
->
°ªam_ve˘‹
)

940 i‡(
this_s
->
°©e
 !
MC_STREAM_STATE_ªady


941 && 
this_s
->
°©e
 !
MC_STREAM_STATE_«me_known
)

945 i‡(
mcm
->
joös_ö_¥ogªss
 > 0)

948 (Ë
	`gë_‹_¸óã_≥î_wôh_id
 (
mcm
, 
s
, 
ªq
->
≥î_id
,

951 
ªp
 = 
	`mc_gë_vlib_buf„r
 (
mcm
->
vlib_maö
,  (ªp[0]), &
bi
);

952 
	`mem£t
 (
ªp
, 0,  (rep[0]));

953 
ªp
->
ty≥
 = 
MC_MSG_TYPE_joö_ª∂y
;

954 
ªp
->
°ªam_ödex
 = 
ªq
->stream_index;

956 
	`mc_byã_sw≠_msg_joö_ª∂y
 (
ªp
);

958 
ªp
->
≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

959 
ªp
->
ˇtchup_≥î_id
 = 
mcm
->
å™•‹t
.
our_ˇtchup_≥î_id
;

961 
mcm
->
å™•‹t
.
	`tx_buf„r
 (mcm->å™•‹t.
›aque
, 
MC_TRANSPORT_JOIN
, 
bi
);

965 i‡(
s
->
c⁄fig
.
≥î_dõd
)

966 
s
->
c⁄fig
.
	`≥î_dõd
 (
mcm
, s, 
ªq
->
≥î_id
);

968 
	}
}

971 
	$mc_msg_joö_ª∂y_h™dÀr
 (
mc_maö_t
 * 
mcm
,

972 
mc_msg_joö_ª∂y_t
 * 
mp
, 
u32
 
buf„r_ödex
)

974 
mc_°ªam_t
 *
s
;

976 
	`mc_byã_sw≠_msg_joö_ª∂y
 (
mp
);

978 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

980 i‡(!
s
 || s->
°©e
 !
MC_STREAM_STATE_joö_ö_¥ogªss
)

985 
s
->
°©e
 = 
MC_STREAM_STATE_ˇtchup
;

987 
mcm
->
joös_ö_¥ogªss
--;

988 
mcm
->
å™•‹t
.
	`ˇtchup_ªque°_fun
 (mcm->å™•‹t.
›aque
,

989 
mp
->
°ªam_ödex
, mp->
ˇtchup_≥î_id
);

990 
	}
}

993 
	$mc_waô_f‹_°ªam_ªady
 (
mc_maö_t
 * 
m
, *
°ªam_«me
)

995 
mc_°ªam_t
 *
s
;

999 
s
 = 
	`mc_°ªam_by_«me
 (
m
, 
°ªam_«me
);

1000 i‡(
s
)

1002 
	`vlib_¥o˚ss_su•íd
 (
m
->
vlib_maö
, .1);

1006 i‡(
s
->
°©e
 =
MC_STREAM_STATE_ˇtchup


1007 || 
s
->
°©e
 =
MC_STREAM_STATE_ªady
)

1011 
vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹


1012 (
m
->
vlib_maö
, &
s
->
¥ocs_waôög_f‹_joö_d⁄e
);

1013 
	}
}

1015 
u32


1016 
	$mc_°ªam_£nd
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_ödex
, u32 
buf„r_ödex
)

1018 
mc_°ªam_t
 *
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
°ªam_ödex
);

1019 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1020 
mc_ªåy_t
 *
r
;

1021 
mc_msg_u£r_ªque°_t
 *
mp
;

1022 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

1023 
u32
 
ri
;

1025 i‡(!
s
)

1028 i‡(
s
->
°©e
 !
MC_STREAM_STATE_ªady
)

1029 
vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹


1030 (
vm
, &
s
->
¥ocs_waôög_f‹_joö_d⁄e
);

1032 
	`poﬁ_ñts
 (
s
->
ªåy_poﬁ
Ë>s->
c⁄fig
.
wödow_size
)

1034 
vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹


1035 (
vm
, &
s
->
¥ocs_waôög_f‹_›í_wödow
);

1038 
	`poﬁ_gë
 (
s
->
ªåy_poﬁ
, 
r
);

1039 
ri
 = 
r
 - 
s
->
ªåy_poﬁ
;

1041 
r
->
¥ev_ödex
 = 
s
->
ªåy_èû_ödex
;

1042 
r
->
√xt_ödex
 = ~0;

1043 
s
->
ªåy_èû_ödex
 = 
ri
;

1045 i‡(
r
->
¥ev_ödex
 == ~0)

1046 
s
->
ªåy_hód_ödex
 = 
ri
;

1049 
mc_ªåy_t
 *
p
 = 
	`poﬁ_ñt_©_ödex
 (
s
->
ªåy_poﬁ
, 
r
->
¥ev_ödex
);

1050 
p
->
√xt_ödex
 = 
ri
;

1053 
	`vlib_buf„r_adv™˚
 (
b
, - (
mp
[0]));

1054 
mp
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

1056 
mp
->
≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

1058 
mp
->
globÆ_£quí˚
 = 0xdeadbeef;

1059 
mp
->
°ªam_ödex
 = 
s
->
ödex
;

1060 
mp
->
loˇl_£quí˚
 = 
s
->
our_loˇl_£quí˚
++;

1061 
mp
->
n_d©a_byãs
 =

1062 
	`vlib_buf„r_ödex_Àngth_ö_chaö
 (
vm
, 
buf„r_ödex
Ë-  (
mp
[0]);

1064 
r
->
buf„r_ödex
 = buffer_index;

1065 
r
->
loˇl_£quí˚
 = 
mp
->local_sequence;

1066 
r
->
£¡_©
 = 
	`vlib_time_now
 (
vm
);

1067 
r
->
n_ªåõs
 = 0;

1070 
	`vec_vÆid©e
 (
r
->
u«cked_by_≥î_bôm≠
, 
	`vec_Àn
 (
s
->
Æl_≥î_bôm≠
) - 1);

1071 
	`vec_c›y
 (
r
->
u«cked_by_≥î_bôm≠
, 
s
->
Æl_≥î_bôm≠
);

1073 
	`hash_£t
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
, 
r
->
loˇl_£quí˚
,

1074 
r
 - 
s
->
ªåy_poﬁ
);

1076 
	`ñog_tx_msg
 (
mcm
, 
s
->
ödex
, 
mp
->
loˇl_£quí˚
, 
r
->
n_ªåõs
);

1078 
	`mc_byã_sw≠_msg_u£r_ªque°
 (
mp
);

1080 
mcm
->
å™•‹t
.
	`tx_buf„r
 (mcm->å™•‹t.
›aque
,

1081 
MC_TRANSPORT_USER_REQUEST_TO_RELAY
, 
buf„r_ödex
);

1083 
s
->
u£r_ªque°s_£¡
++;

1086  
s
->
c⁄fig
.
wödow_size
 - 
	`poﬁ_ñts
 (s->
ªåy_poﬁ
);

1087 
	}
}

1090 
	$mc_msg_u£r_ªque°_h™dÀr
 (
mc_maö_t
 * 
mcm
, 
mc_msg_u£r_ªque°_t
 * 
mp
,

1091 
u32
 
buf„r_ödex
)

1093 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1094 
mc_°ªam_t
 *
s
;

1095 
mc_°ªam_≥î_t
 *
≥î
;

1096 
i32
 
£q_cmp_ªsu…
;

1097 
⁄˚
 = 0;

1099 
	`mc_byã_sw≠_msg_u£r_ªque°
 (
mp
);

1101 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

1104 i‡(!
s
 || s->
°©e
 !
MC_STREAM_STATE_ªady
)

1106 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
buf„r_ödex
);

1111 
≥î
 = 
	`gë_‹_¸óã_≥î_wôh_id
 (
mcm
, 
s
, 
mp
->
≥î_id
,

1114 
£q_cmp_ªsu…
 = 
	`mc_£q_cmp
 (
mp
->
loˇl_£quí˚
,

1115 
≥î
->
œ°_£quí˚_ª˚ived
 + 1);

1117 i‡(
MC_EVENT_LOGGING
 > 0)

1120 
	`ELOG_TYPE_DECLARE
 (
e
) =

1122 .
f‹m©
 = "rx-msg:Öeer %s stream %dÑx seq %d seq_cmp %d",

1123 .
f‹m©_¨gs
 = "T4i4i4i4",

1128 
u32
 
≥î
, 
°ªam_ödex
, 
rx_£quí˚
;

1129 
i32
 
£q_cmp_ªsu…
;

1130 } *
ed
;

1131 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

1132 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
,Öìr->
id
.
as_u64
);

1133 
ed
->
°ªam_ödex
 = 
mp
->stream_index;

1134 
ed
->
rx_£quí˚
 = 
mp
->
loˇl_£quí˚
;

1135 
ed
->
£q_cmp_ªsu…
 = seq_cmp_result;

1138 i‡(0 && 
mp
->
°ªam_ödex
 =1 && 
⁄˚
 == 0)

1140 
⁄˚
 = 1;

1141 
	`ELOG_TYPE
 (
e
, "FAKEÜost msg on stream 1");

1142 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1146 
≥î
->
œ°_£quí˚_ª˚ived
 +
£q_cmp_ªsu…
 == 0;

1147 
s
->
u£r_ªque°s_ª˚ived
++;

1149 i‡(
£q_cmp_ªsu…
 > 0)

1150 
≥î
->
°©s
.
n_msgs_‰om_futuª
 += 1;

1155 
mc_msg_u£r_ack_t
 *
Ω
;

1156 
u32
 
bi
;

1158 
Ω
 = 
	`mc_gë_vlib_buf„r
 (
vm
,  (Ω[0]), &
bi
);

1159 
Ω
->
≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

1160 
Ω
->
°ªam_ödex
 = 
s
->
ödex
;

1161 
Ω
->
loˇl_£quí˚
 = 
mp
->local_sequence;

1162 
Ω
->
£q_cmp_ªsu…
 = seq_cmp_result;

1164 i‡(
MC_EVENT_LOGGING
 > 0)

1167 
	`ELOG_TYPE_DECLARE
 (
e
) =

1169 .
f‹m©
 = "tx-ack: stream %dÜocal seq %d",

1170 .
f‹m©_¨gs
 = "i4i4",

1175 
u32
 
°ªam_ödex
;

1176 
u32
 
loˇl_£quí˚
;

1177 } *
ed
;

1178 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

1179 
ed
->
°ªam_ödex
 = 
Ω
->stream_index;

1180 
ed
->
loˇl_£quí˚
 = 
Ω
->local_sequence;

1183 
	`mc_byã_sw≠_msg_u£r_ack
 (
Ω
);

1185 
mcm
->
å™•‹t
.
	`tx_ack
 (mcm->å™•‹t.
›aque
, 
mp
->
≥î_id
, 
bi
);

1187 i‡(
£q_cmp_ªsu…
 < 0)

1189 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
buf„r_ödex
);

1190 
≥î
->
°©s
.
n_msgs_‰om_∑°
 += 1;

1194 i‡(
£q_cmp_ªsu…
 == 0)

1196 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

1197 
s
->
°©e
)

1199 
MC_STREAM_STATE_ªady
:

1200 
	`vlib_buf„r_adv™˚
 (
b
,  (
mp
[0]));

1201 
s
->
c⁄fig
.
	`rx_buf„r
 (
mcm
, s, 
mp
->
≥î_id
, 
buf„r_ödex
);

1205 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

1206 
	`ASSERT
 (
s
 != 0);

1207 
s
->
œ°_globÆ_£quí˚_¥o˚s£d
 = 
mp
->
globÆ_£quí˚
;

1210 
MC_STREAM_STATE_ˇtchup
:

1211 
	`˛ib_fifo_add1
 (
s
->
ˇtchup_fifo
, 
buf„r_ödex
);

1215 
	`˛ib_w¨nög
 ("stream in unknown state %U",

1216 
f‹m©_mc_°ªam_°©e
, 
s
->
°©e
);

1220 
	}
}

1223 
	$mc_msg_u£r_ack_h™dÀr
 (
mc_maö_t
 * 
mcm
, 
mc_msg_u£r_ack_t
 * 
mp
,

1224 
u32
 
buf„r_ödex
)

1226 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1227 
uw‹d
 *
p
;

1228 
mc_°ªam_t
 *
s
;

1229 
mc_°ªam_≥î_t
 *
≥î
;

1230 
mc_ªåy_t
 *
r
;

1231 
≥î_¸óãd
 = 0;

1233 
	`mc_byã_sw≠_msg_u£r_ack
 (
mp
);

1235 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

1237 i‡(
MC_EVENT_LOGGING
 > 0)

1240 
	`ELOG_TYPE_DECLARE
 (
t
) =

1242 .
f‹m©
 = "rx-ack:Üocal seq %dÖeer %s seq_cmp_result %d",

1243 .
f‹m©_¨gs
 = "i4T4i4",

1249 
u32
 
loˇl_£quí˚
;

1250 
u32
 
≥î
;

1251 
i32
 
£q_cmp_ªsu…
;

1252 } *
ed
;

1253 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1254 
ed
->
loˇl_£quí˚
 = 
mp
->local_sequence;

1255 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
mp
->
≥î_id
.
as_u64
);

1256 
ed
->
£q_cmp_ªsu…
 = 
mp
->seq_cmp_result;

1260 i‡(!
s
)

1264 
≥î
 = 
	`gë_‹_¸óã_≥î_wôh_id
 (
mcm
, 
s
, 
mp
->
≥î_id
,

1265  &
≥î_¸óãd
);

1271 i‡(
mp
->
£q_cmp_ªsu…
 > 0)

1273 
p
 = 
	`hash_gë
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
, 
mp
->
loˇl_£quí˚
 -

1274 
mp
->
£q_cmp_ªsu…
);

1275 i‡(
p
 == 0)

1276 
	`mc_ª£nd_ªtúed
 (
mcm
, 
s
, 
mp
->
loˇl_£quí˚
 - mp->
£q_cmp_ªsu…
);

1286 
p
 = 
	`hash_gë
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
, 
mp
->
loˇl_£quí˚
);

1293 i‡(
p
 == 0)

1295 i‡(
MC_EVENT_LOGGING
 > 0)

1298 
	`ELOG_TYPE_DECLARE
 (
t
) =

1300 .
f‹m©
 = "ack: for seq %d fromÖeer %sÇo fifoÉlt",

1301 .
f‹m©_¨gs
 = "i4T4",

1307 
u32
 
£q
;

1308 
u32
 
≥î
;

1309 } *
ed
;

1310 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1311 
ed
->
£q
 = 
mp
->
loˇl_£quí˚
;

1312 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
mp
->
≥î_id
.
as_u64
);

1318 
r
 = 
	`poﬁ_ñt_©_ödex
 (
s
->
ªåy_poﬁ
, 
p
[0]);

1321 i‡(
≥î_¸óãd
)

1323 
mc_ªåy_t
 *
œãr_ªåy
 = 
	`√xt_ªåy
 (
s
, 
r
);

1325 
œãr_ªåy
)

1327 
œãr_ªåy
->
u«cked_by_≥î_bôm≠
 =

1328 
	`˛ib_bôm≠_‹i
 (
œãr_ªåy
->
u«cked_by_≥î_bôm≠
,

1329 
≥î
 - 
s
->
≥îs
);

1330 
œãr_ªåy
 = 
	`√xt_ªåy
 (
s
,Üater_retry);

1334 
	`ASSERT
 (
mp
->
loˇl_£quí˚
 =
r
->local_sequence);

1337 i‡(!
≥î_¸óãd
 &&

1338 !
	`˛ib_bôm≠_gë
 (
r
->
u«cked_by_≥î_bôm≠
, 
≥î
 - 
s
->
≥îs
))

1340 i‡(
MC_EVENT_LOGGING
 > 0)

1343 
	`ELOG_TYPE_DECLARE
 (
t
) =

1345 .
f‹m©
 = "dup-ack: for seq %d fromÖeer %s",

1346 .
f‹m©_¨gs
 = "i4T4",

1351 
u32
 
£q
;

1352 
u32
 
≥î
;

1353 } *
ed
;

1354 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1355 
ed
->
£q
 = 
r
->
loˇl_£quí˚
;

1356 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
,Öìr->
id
.
as_u64
);

1358 i‡(!
	`˛ib_bôm≠_is_zîo
 (
r
->
u«cked_by_≥î_bôm≠
))

1362 i‡(
MC_EVENT_LOGGING
 > 0)

1365 
	`ELOG_TYPE_DECLARE
 (
t
) =

1367 .
f‹m©
 = "ack: for seq %d fromÖeer %s",

1368 .
f‹m©_¨gs
 = "i4T4",

1373 
u32
 
£q
;

1374 
u32
 
≥î
;

1375 } *
ed
;

1376 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1377 
ed
->
£q
 = 
mp
->
loˇl_£quí˚
;

1378 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
,Öìr->
id
.
as_u64
);

1381 
r
->
u«cked_by_≥î_bôm≠
 =

1382 
	`˛ib_bôm≠_™dnŸi
 (
r
->
u«cked_by_≥î_bôm≠
, 
≥î
 - 
s
->
≥îs
);

1385 i‡(!
	`˛ib_bôm≠_is_zîo
 (
r
->
u«cked_by_≥î_bôm≠
))

1389 i‡(
MC_EVENT_LOGGING
 > 0)

1392 
	`ELOG_TYPE_DECLARE
 (
t
) =

1394 .
f‹m©
 = "ack:Ñetire fifoÉltÜoc seq %dáfter %dácks",

1395 .
f‹m©_¨gs
 = "i4i4",

1400 
u32
 
£q
;

1401 
u32
 
≈ìrs
;

1402 } *
ed
;

1403 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1404 
ed
->
£q
 = 
r
->
loˇl_£quí˚
;

1405 
ed
->
≈ìrs
 = 
	`poﬁ_ñts
 (
s
->
≥îs
);

1408 
	`hash_un£t
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
, 
mp
->
loˇl_£quí˚
);

1409 
	`mc_ªåy_‰ì
 (
mcm
, 
s
, 
r
);

1410 
	`ªmove_ªåy_‰om_poﬁ
 (
s
, 
r
);

1411 
	`maybe_£nd_wödow_›í_evít
 (
vm
, 
s
);

1412 
	}
}

1414 
	#EVENT_MC_SEND_CATCHUP_DATA
 0

	)

1416 
uw‹d


1417 
	$mc_ˇtchup_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1418 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
f
)

1420 
mc_maö_t
 *
mcm
 = 
	`mc_node_gë_maö
 (
node
);

1421 
uw‹d
 *
evít_d©a
 = 0;

1422 
mc_ˇtchup_¥o˚ss_¨g_t
 *
¨gs
;

1423 
i
;

1427 i‡(
evít_d©a
)

1428 
	`_vec_Àn
 (
evít_d©a
) = 0;

1429 
	`vlib_¥o˚ss_waô_f‹_evít_wôh_ty≥
 (
vm
, &
evít_d©a
,

1430 
EVENT_MC_SEND_CATCHUP_DATA
);

1432 
i
 = 0; i < 
	`vec_Àn
 (
evít_d©a
); i++)

1434 
¨gs
 = 
	`poﬁ_ñt_©_ödex
 (
mcm
->
ˇtchup_¥o˚ss_¨gs
, 
evít_d©a
[
i
]);

1436 
mcm
->
å™•‹t
.
	`ˇtchup_£nd_fun
 (mcm->å™•‹t.
›aque
,

1437 
¨gs
->
ˇtchup_›aque
,

1438 
¨gs
->
ˇtchup_¢≠shŸ
);

1441 
	`poﬁ_put
 (
mcm
->
ˇtchup_¥o˚ss_¨gs
, 
¨gs
);

1446 
	}
}

1449 
	$£rülize_mc_°ªam
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

1451 
mc_°ªam_t
 *
s
 = 
	`va_¨g
 (*
va
, mc_stream_t *);

1452 
mc_°ªam_≥î_t
 *
p
;

1454 
	`£rülize_öãgî
 (
m
, 
	`poﬁ_ñts
 (
s
->
≥îs
),  (
u32
));

1456 
	`poﬁ_f‹óch
 (
p
, 
s
->
≥îs
, ({

1457 
u8
 * 
x
 = 
	`£rülize_gë
 (
m
,  (
p
->
id
));

1458 
	`˛ib_mem˝y
 (
x
, 
p
->
id
.
as_u8
,  (p->id));

1459 
	`£rülize_öãgî
 (
m
, 
p
->
œ°_£quí˚_ª˚ived
,

1460  (
p
->
œ°_£quí˚_ª˚ived
));

1463 
	`£rülize_bôm≠
 (
m
, 
s
->
Æl_≥î_bôm≠
);

1464 
	}
}

1467 
	$un£rülize_mc_°ªam
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

1469 
mc_°ªam_t
 *
s
 = 
	`va_¨g
 (*
va
, mc_stream_t *);

1470 
u32
 
i
, 
n_≥îs
;

1471 
mc_°ªam_≥î_t
 *
p
;

1473 
	`un£rülize_öãgî
 (
m
, &
n_≥îs
,  (
u32
));

1474 
	`mhash_öô
 (&
s
->
≥î_ödex_by_id
,  (
uw‹d
),  (
mc_≥î_id_t
));

1475 
i
 = 0; i < 
n_≥îs
; i++)

1477 
u8
 *
x
;

1478 
	`poﬁ_gë
 (
s
->
≥îs
, 
p
);

1479 
x
 = 
	`un£rülize_gë
 (
m
,  (
p
->
id
));

1480 
	`˛ib_mem˝y
 (
p
->
id
.
as_u8
, 
x
,  (p->id));

1481 
	`un£rülize_öãgî
 (
m
, &
p
->
œ°_£quí˚_ª˚ived
,

1482  (
p
->
œ°_£quí˚_ª˚ived
));

1483 
	`mhash_£t
 (&
s
->
≥î_ödex_by_id
, &
p
->
id
,Ö - s->
≥îs
,

1486 
s
->
Æl_≥î_bôm≠
 = 
	`un£rülize_bôm≠
 (
m
);

1489 i‡(!
s
->
Æl_≥î_bôm≠
)

1490 
	`˛ib_w¨nög
 ("BUG: såóm %†Æl_≥î_bôm≠ NULL", 
s
->
c⁄fig
.
«me
);

1491 
	}
}

1494 
	$mc_msg_ˇtchup_ªque°_h™dÀr
 (
mc_maö_t
 * 
mcm
,

1495 
mc_msg_ˇtchup_ªque°_t
 * 
ªq
,

1496 
u32
 
ˇtchup_›aque
)

1498 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1499 
mc_°ªam_t
 *
s
;

1500 
mc_ˇtchup_¥o˚ss_¨g_t
 *
¨gs
;

1502 
	`mc_byã_sw≠_msg_ˇtchup_ªque°
 (
ªq
);

1504 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
ªq
->
°ªam_ödex
);

1505 i‡(!
s
 || s->
°©e
 !
MC_STREAM_STATE_ªady
)

1508 i‡(
MC_EVENT_LOGGING
 > 0)

1511 
	`ELOG_TYPE_DECLARE
 (
t
) =

1513 .
f‹m©
 = "catchup-request: from %s stream %d",

1514 .
f‹m©_¨gs
 = "T4i4",

1519 
u32
 
≥î
, 
°ªam
;

1520 } *
ed
;

1521 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1522 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
ªq
->
≥î_id
.
as_u64
);

1523 
ed
->
°ªam
 = 
ªq
->
°ªam_ödex
;

1536 
	`poﬁ_gë
 (
mcm
->
ˇtchup_¥o˚ss_¨gs
, 
¨gs
);

1538 
¨gs
->
°ªam_ödex
 = 
s
 - 
mcm
->
°ªam_ve˘‹
;

1539 
¨gs
->
ˇtchup_›aque
 = catchup_opaque;

1540 
¨gs
->
ˇtchup_¢≠shŸ
 = 0;

1545 
mc_msg_ˇtchup_ª∂y_t
 *
ªp
;

1546 
£rülize_maö_t
 
m
;

1548 
	`vec_ªsize
 (
¨gs
->
ˇtchup_¢≠shŸ
,  (
ªp
[0]));

1550 
ªp
 = (*Ë
¨gs
->
ˇtchup_¢≠shŸ
;

1552 
ªp
->
≥î_id
 = 
ªq
->peer_id;

1553 
ªp
->
°ªam_ödex
 = 
ªq
->stream_index;

1554 
ªp
->
œ°_globÆ_£quí˚_ö˛uded
 = 
s
->
œ°_globÆ_£quí˚_¥o˚s£d
;

1557 
	`£rülize_›í_ve˘‹
 (&
m
, 
¨gs
->
ˇtchup_¢≠shŸ
);

1558 
m
.
°ªam
.
cuºít_buf„r_ödex
 = 
	`vec_Àn
 (m.°ªam.
buf„r
);

1560 
	`£rülize
 (&
m
, 
£rülize_mc_°ªam
, 
s
);

1562 
¨gs
->
ˇtchup_¢≠shŸ
 = 
	`£rülize_˛o£_ve˘‹
 (&
m
);

1565 
¨gs
->
ˇtchup_¢≠shŸ
 = 
s
->
c⁄fig
.catchup_snapshot

1566 (
mcm
, 
¨gs
->
ˇtchup_¢≠shŸ
, 
ªp
->
œ°_globÆ_£quí˚_ö˛uded
);

1568 
ªp
 = (*Ë
¨gs
->
ˇtchup_¢≠shŸ
;

1569 
ªp
->
n_d©a_byãs
 = 
	`vec_Àn
 (
¨gs
->
ˇtchup_¢≠shŸ
) -  (rep[0]);

1571 
	`mc_byã_sw≠_msg_ˇtchup_ª∂y
 (
ªp
);

1575 
	`vlib_¥o˚ss_sig«l_evít
 (
vm
, 
mcm
->
ˇtchup_¥o˚ss
,

1576 
EVENT_MC_SEND_CATCHUP_DATA
,

1577 
¨gs
 - 
mcm
->
ˇtchup_¥o˚ss_¨gs
);

1578 
	}
}

1580 
	#EVENT_MC_UNSERIALIZE_BUFFER
 0

	)

1581 
	#EVENT_MC_UNSERIALIZE_CATCHUP
 1

	)

1584 
	$mc_msg_ˇtchup_ª∂y_h™dÀr
 (
mc_maö_t
 * 
mcm
, 
mc_msg_ˇtchup_ª∂y_t
 * 
mp
,

1585 
u32
 
ˇtchup_›aque
)

1587 
	`vlib_¥o˚ss_sig«l_evít
 (
mcm
->
vlib_maö
,

1588 
mcm
->
un£rülize_¥o˚ss
,

1589 
EVENT_MC_UNSERIALIZE_CATCHUP
,

1590 
	`poöãr_to_uw‹d
 (
mp
));

1591 
	}
}

1594 
	$≥rf‹m_ˇtchup
 (
mc_maö_t
 * 
mcm
, 
mc_msg_ˇtchup_ª∂y_t
 * 
mp
)

1596 
mc_°ªam_t
 *
s
;

1597 
i32
 
£q_cmp_ªsu…
;

1599 
	`mc_byã_sw≠_msg_ˇtchup_ª∂y
 (
mp
);

1601 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

1604 i‡(!
s
 || s->
°©e
 =
MC_STREAM_STATE_ªady
)

1608 
£rülize_maö_t
 
m
;

1609 
mc_°ªam_≥î_t
 *
p
;

1610 
u32
 
n_°ªam_byãs
;

1613 i‡(
s
->
c⁄fig
.
ßve_¢≠shŸ
)

1614 
s
->
c⁄fig
.
	`ßve_¢≠shŸ
 (
mcm
, 1, 
mp
->
d©a
,

1615 
mp
->
n_d©a_byãs
);

1617 
	`un£rülize_›í_d©a
 (&
m
, 
mp
->
d©a
, mp->
n_d©a_byãs
);

1618 
	`un£rülize
 (&
m
, 
un£rülize_mc_°ªam
, 
s
);

1622 
	`poﬁ_f‹óch
 (
p
, 
s
->
≥îs
, ({

1623 i‡(
p
->
id
.
as_u64
 =
mcm
->
å™•‹t
.
our_ack_≥î_id
.as_u64)

1624 
s
->
our_loˇl_£quí˚
 = 
p
->
œ°_£quí˚_ª˚ived
 + 1;

1628 
n_°ªam_byãs
 = 
m
.
°ªam
.
cuºít_buf„r_ödex
;

1633 
s
->
c⁄fig
.
	`ˇtchup
 (
mcm
, 
mp
->
d©a
 + 
n_°ªam_byãs
,

1634 
mp
->
n_d©a_byãs
 - 
n_°ªam_byãs
);

1639 
s
 = 
	`mc_°ªam_by_ödex
 (
mcm
, 
mp
->
°ªam_ödex
);

1641 
s
->
œ°_globÆ_£quí˚_¥o˚s£d
 = 
mp
->
œ°_globÆ_£quí˚_ö˛uded
;

1643 
	`˛ib_fifo_ñts
 (
s
->
ˇtchup_fifo
))

1645 
mc_msg_u£r_ªque°_t
 *
gp
;

1646 
u32
 
bi
;

1647 
vlib_buf„r_t
 *
b
;

1649 
	`˛ib_fifo_sub1
 (
s
->
ˇtchup_fifo
, 
bi
);

1651 
b
 = 
	`vlib_gë_buf„r
 (
mcm
->
vlib_maö
, 
bi
);

1652 
gp
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

1655 
£q_cmp_ªsu…
 = 
	`mc_£q_cmp
 (
gp
->
globÆ_£quí˚
,

1656 
mp
->
œ°_globÆ_£quí˚_ö˛uded
);

1658 i‡(
£q_cmp_ªsu…
 > 0)

1660 
	`vlib_buf„r_adv™˚
 (
b
,  (
gp
[0]));

1661 
s
->
c⁄fig
.
	`rx_buf„r
 (
mcm
, s, 
gp
->
≥î_id
, 
bi
);

1662 
s
->
œ°_globÆ_£quí˚_¥o˚s£d
 = 
gp
->
globÆ_£quí˚
;

1664 i‡(
MC_EVENT_LOGGING
)

1667 
	`ELOG_TYPE_DECLARE
 (
t
) =

1669 .
f‹m©
 = "catchupÑeplayÜocal sequence 0x%x",

1670 .
f‹m©_¨gs
 = "i4",

1675 
u32
 
loˇl_£quí˚
;

1676 } *
ed
;

1677 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1678 
ed
->
loˇl_£quí˚
 = 
gp
->local_sequence;

1683 i‡(
MC_EVENT_LOGGING
)

1686 
	`ELOG_TYPE_DECLARE
 (
t
) =

1688 .
f‹m©
 = "catchup discardÜocal sequence 0x%x",

1689 .
f‹m©_¨gs
 = "i4",

1694 
u32
 
loˇl_£quí˚
;

1695 } *
ed
;

1696 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
t
);

1697 
ed
->
loˇl_£quí˚
 = 
gp
->local_sequence;

1700 
	`vlib_buf„r_‰ì_⁄e
 (
mcm
->
vlib_maö
, 
bi
);

1704 
s
->
°©e
 = 
MC_STREAM_STATE_ªady
;

1708 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
;

1709 
	`vec_f‹óch
 (
wp
, 
s
->
¥ocs_waôög_f‹_joö_d⁄e
)

1710 
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
mcm
->
vlib_maö
, 
wp
);

1711 i‡(
s
->
¥ocs_waôög_f‹_joö_d⁄e
)

1712 
	`_vec_Àn
 (
s
->
¥ocs_waôög_f‹_joö_d⁄e
) = 0;

1714 
	}
}

1717 
	$this_node_maybe_ma°î
 (
mc_maö_t
 * 
mcm
)

1719 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1720 
mc_msg_ma°î_as£π_t
 *
mp
;

1721 
uw‹d
 
evít_ty≥
;

1722 
timeouts
 = 0;

1723 
is_ma°î
 = 
mcm
->
ªœy_°©e
 =
MC_RELAY_STATE_MASTER
;

1724 
˛ib_îr‹_t
 *
îr‹
;

1725 
f64
 
now
, 
time_œ°_ma°î_as£π
 = -1;

1726 
u32
 
bi
;

1730 i‡(!
mcm
->
we_ˇn_be_ªœy_ma°î
)

1732 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_SLAVE
;

1733 i‡(
MC_EVENT_LOGGING
)

1735 
	`ELOG_TYPE
 (
e
, "become slave (config)");

1736 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1741 
now
 = 
	`vlib_time_now
 (
vm
);

1742 i‡(
now
 >
time_œ°_ma°î_as£π
 + 1)

1744 
time_œ°_ma°î_as£π
 = 
now
;

1745 
mp
 = 
	`mc_gë_vlib_buf„r
 (
mcm
->
vlib_maö
,  (mp[0]), &
bi
);

1747 
mp
->
≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

1748 
mp
->
globÆ_£quí˚
 = 
mcm
->
ªœy_globÆ_£quí˚
;

1754 i‡(
MC_EVENT_LOGGING
 > 1)

1757 
	`ELOG_TYPE_DECLARE
 (
e
) =

1759 .
f‹m©
 = "tx-massert:Öeer %s global seq %u",

1760 .
f‹m©_¨gs
 = "T4i4",

1765 
u32
 
≥î
, 
globÆ_£quí˚
;

1766 } *
ed
;

1767 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

1768 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
mp
->
≥î_id
.
as_u64
);

1769 
ed
->
globÆ_£quí˚
 = 
mp
->global_sequence;

1772 
	`mc_byã_sw≠_msg_ma°î_as£π
 (
mp
);

1774 
îr‹
 =

1775 
mcm
->
å™•‹t
.
	`tx_buf„r
 (mcm->å™•‹t.
›aque
,

1776 
MC_TRANSPORT_MASTERSHIP
, 
bi
);

1777 i‡(
îr‹
)

1778 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

1781 
	`vlib_¥o˚ss_waô_f‹_evít_‹_˛ock
 (
vm
, 1.0);

1782 
evít_ty≥
 = 
	`vlib_¥o˚ss_gë_evíts
 (
vm
, 0);

1784 
evít_ty≥
)

1787 i‡(!
is_ma°î
 && 
timeouts
++ > 2)

1789 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_MASTER
;

1790 
mcm
->
ªœy_ma°î_≥î_id
 =

1791 
mcm
->
å™•‹t
.
our_ack_≥î_id
.
as_u64
;

1792 i‡(
MC_EVENT_LOGGING
)

1794 
	`ELOG_TYPE
 (
e
, "become master (was maybe_master)");

1795 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1801 
MC_RELAY_STATE_SLAVE
:

1802 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_SLAVE
;

1803 i‡(
MC_EVENT_LOGGING
 && 
mcm
->
ªœy_°©e
 !
MC_RELAY_STATE_SLAVE
)

1805 
	`ELOG_TYPE
 (
e
, "become slave (was maybe_master)");

1806 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1811 
	}
}

1814 
	$this_node_¶ave
 (
mc_maö_t
 * 
mcm
)

1816 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

1817 
uw‹d
 
evít_ty≥
;

1818 
timeouts
 = 0;

1820 i‡(
MC_EVENT_LOGGING
)

1822 
	`ELOG_TYPE
 (
e
, "become slave");

1823 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1828 
	`vlib_¥o˚ss_waô_f‹_evít_‹_˛ock
 (
vm
, 1.0);

1829 
evít_ty≥
 = 
	`vlib_¥o˚ss_gë_evíts
 (
vm
, 0);

1831 
evít_ty≥
)

1834 i‡(
timeouts
++ > 2)

1836 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_NEGOTIATE
;

1837 
mcm
->
ªœy_ma°î_≥î_id
 = ~0ULL;

1838 i‡(
MC_EVENT_LOGGING
)

1840 
	`ELOG_TYPE
 (
e
, "timeouts;Çegoitate mastership");

1841 
	`ELOG
 (
mcm
->
ñog_maö
, 
e
, 0);

1847 
MC_RELAY_STATE_SLAVE
:

1848 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_SLAVE
;

1849 
timeouts
 = 0;

1853 
	}
}

1855 
uw‹d


1856 
	$mc_ma°îshù_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1857 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
f
)

1859 
mc_maö_t
 *
mcm
 = 
	`mc_node_gë_maö
 (
node
);

1863 
mcm
->
ªœy_°©e
)

1865 
MC_RELAY_STATE_NEGOTIATE
:

1866 
MC_RELAY_STATE_MASTER
:

1867 
	`this_node_maybe_ma°î
 (
mcm
);

1870 
MC_RELAY_STATE_SLAVE
:

1871 
	`this_node_¶ave
 (
mcm
);

1876 
	}
}

1879 
	$mc_íabÀ_dißbÀ_ma°îshù
 (
mc_maö_t
 * 
mcm
, 
we_ˇn_be_ma°î
)

1881 i‡(
we_ˇn_be_ma°î
 !
mcm
->
we_ˇn_be_ªœy_ma°î
)

1883 
mcm
->
we_ˇn_be_ªœy_ma°î
 = 
we_ˇn_be_ma°î
;

1884 
	`vlib_¥o˚ss_sig«l_evít
 (
mcm
->
vlib_maö
,

1885 
mcm
->
ma°îshù_¥o˚ss
,

1886 
MC_RELAY_STATE_NEGOTIATE
, 0);

1888 
	}
}

1891 
	$mc_msg_ma°î_as£π_h™dÀr
 (
mc_maö_t
 * 
mcm
, 
mc_msg_ma°î_as£π_t
 * 
mp
,

1892 
u32
 
buf„r_ödex
)

1894 
mc_≥î_id_t
 
his_≥î_id
, 
our_≥î_id
;

1895 
i32
 
£q_cmp_ªsu…
;

1896 
u8
 
sig«l_¶ave
 = 0;

1897 
u8
 
upd©e_globÆ_£quí˚
 = 0;

1899 
	`mc_byã_sw≠_msg_ma°î_as£π
 (
mp
);

1901 
his_≥î_id
 = 
mp
->
≥î_id
;

1902 
our_≥î_id
 = 
mcm
->
å™•‹t
.
our_ack_≥î_id
;

1905 
£q_cmp_ªsu…
 = 
	`mc_£q_cmp
 (
mp
->
globÆ_£quí˚
,

1906 
mcm
->
ªœy_globÆ_£quí˚
);

1910 i‡(
	`mc_≥î_id_com∑ª
 (
his_≥î_id
, 
our_≥î_id
) < 0

1911 && 
£q_cmp_ªsu…
 >= 0)

1913 
	`vlib_¥o˚ss_sig«l_evít
 (
mcm
->
vlib_maö
,

1914 
mcm
->
ma°îshù_¥o˚ss
,

1915 
MC_RELAY_STATE_SLAVE
, 0);

1916 
sig«l_¶ave
 = 1;

1920 i‡(
£q_cmp_ªsu…
 > 0)

1922 
mcm
->
ªœy_globÆ_£quí˚
 = 
mp
->
globÆ_£quí˚
;

1923 
upd©e_globÆ_£quí˚
 = 1;

1927 
uw‹d
 *
q
 = 
	`mhash_gë
 (&
mcm
->
ma°îshù_≥î_ödex_by_id
, &
his_≥î_id
);

1928 
mc_ma°îshù_≥î_t
 *
p
;

1930 i‡(
q
)

1931 
p
 = 
	`vec_ñt_©_ödex
 (
mcm
->
ma°îshù_≥îs
, 
q
[0]);

1934 
	`vec_add2
 (
mcm
->
ma°îshù_≥îs
, 
p
, 1);

1935 
p
->
≥î_id
 = 
his_≥î_id
;

1936 
	`mhash_£t
 (&
mcm
->
ma°îshù_≥î_ödex_by_id
, &
p
->
≥î_id
,

1937 
p
 - 
mcm
->
ma°îshù_≥îs
,

1940 
p
->
time_œ°_ma°î_as£π_ª˚ived
 = 
	`vlib_time_now
 (
mcm
->
vlib_maö
);

1947 i‡(
MC_EVENT_LOGGING
 > 1)

1950 
	`ELOG_TYPE_DECLARE
 (
e
) =

1952 .
f‹m©
 = "rx-massert:Öeer %s global seq %u upd %d slave %d",

1953 .
f‹m©_¨gs
 = "T4i4i1i1",

1959 
u32
 
≥î
;

1960 
u32
 
globÆ_£quí˚
;

1961 
u8
 
upd©e_£quí˚
;

1962 
u8
 
¶ave
;

1963 } *
ed
;

1964 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

1965 
ed
->
≥î
 = 
	`ñog_id_f‹_≥î_id
 (
mcm
, 
his_≥î_id
.
as_u64
);

1966 
ed
->
globÆ_£quí˚
 = 
mp
->global_sequence;

1967 
ed
->
upd©e_£quí˚
 = 
upd©e_globÆ_£quí˚
;

1968 
ed
->
¶ave
 = 
sig«l_¶ave
;

1970 
	}
}

1973 
	$mc_£rülize_öô
 (
mc_maö_t
 * 
mcm
)

1975 
mc_£rülize_msg_t
 *
m
;

1976 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

1978 
mcm
->
globÆ_msg_ödex_by_«me


1979 
	`hash_¸óã_°rög
 ( 0,  (
uw‹d
));

1981 
m
 = 
vm
->
mc_msg_ªgi°øti⁄s
;

1983 
m
)

1985 
m
->
globÆ_ödex
 = 
	`vec_Àn
 (
mcm
->
globÆ_msgs
);

1986 
	`hash_£t_mem
 (
mcm
->
globÆ_msg_ödex_by_«me
, 
m
->
«me
, m->
globÆ_ödex
);

1987 
	`vec_add1
 (
mcm
->
globÆ_msgs
, 
m
);

1988 
m
 = m->
√xt_ªgi°øti⁄
;

1990 
	}
}

1992 
˛ib_îr‹_t
 *

1993 
	$mc_£rülize_va
 (
mc_maö_t
 * 
mc
,

1994 
u32
 
°ªam_ödex
,

1995 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

1996 
mc_£rülize_msg_t
 * 
msg
, 
va_li°
 * 
va
)

1998 
mc_°ªam_t
 *
s
;

1999 
˛ib_îr‹_t
 *
îr‹
;

2000 
£rülize_maö_t
 *
m
 = &
mc
->
£rülize_maös
[
VLIB_TX
];

2001 
vlib_£rülize_buf„r_maö_t
 *
sbm
 = &
mc
->
£rülize_buf„r_maös
[
VLIB_TX
];

2002 
u32
 
bi
, 
n_bef‹e
, 
n_a·î
, 
n_tŸÆ
, 
n_this_msg
;

2003 
u32
 
si
, 
gi
;

2005 i‡(!
sbm
->
vlib_maö
)

2007 
sbm
->
tx
.
max_n_d©a_byãs_≥r_chaö
 = 4096;

2008 
sbm
->
tx
.
‰ì_li°_ödex
 = 
VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
;

2011 i‡(
sbm
->
fú°_buf„r
 == 0)

2012 
	`£rülize_›í_vlib_buf„r
 (
m
, 
mc
->
vlib_maö
, 
sbm
);

2014 
n_bef‹e
 = 
	`£rülize_vlib_buf„r_n_byãs
 (
m
);

2016 
s
 = 
	`mc_°ªam_by_ödex
 (
mc
, 
°ªam_ödex
);

2017 
gi
 = 
msg
->
globÆ_ödex
;

2018 
	`ASSERT
 (
msg
 =
	`vec_ñt
 (
mc
->
globÆ_msgs
, 
gi
));

2020 
si
 = ~0;

2021 i‡(
gi
 < 
	`vec_Àn
 (
s
->
°ªam_msg_ödex_by_globÆ_ödex
))

2022 
si
 = 
s
->
°ªam_msg_ödex_by_globÆ_ödex
[
gi
];

2024 
	`£rülize_likñy_smÆl_unsig√d_öãgî
 (
m
, 
si
);

2027 i‡(
si
 =~0 || 
MSG_ID_DEBUG
)

2028 
	`£rülize_c°rög
 (
m
, 
msg
->
«me
);

2030 i‡(
MSG_ID_DEBUG
 && 
MC_EVENT_LOGGING
 > 0)

2033 
	`ELOG_TYPE_DECLARE
 (
e
) =

2035 .
f‹m©
 = "serialize-msg: %s index %d",

2036 .
f‹m©_¨gs
 = "T4i4",

2041 
u32
 
c
[2];

2042 } *
ed
;

2043 
ed
 = 
	`ELOG_DATA
 (
mc
->
ñog_maö
, 
e
);

2044 
ed
->
c
[0] = 
	`ñog_id_f‹_msg_«me
 (
mc
, 
msg
->
«me
);

2045 
ed
->
c
[1] = 
si
;

2048 
îr‹
 = 
	`va_£rülize
 (
m
, 
va
);

2050 
n_a·î
 = 
	`£rülize_vlib_buf„r_n_byãs
 (
m
);

2051 
n_this_msg
 = 
n_a·î
 - 
n_bef‹e
;

2052 
n_tŸÆ
 = 
n_a·î
 +  (
mc_msg_u£r_ªque°_t
);

2055 i‡(
si
 != ~0)

2056 
msg
->
max_n_byãs_£rülized
 =

2057 
	`˛ib_max
 (
msg
->
max_n_byãs_£rülized
, 
n_this_msg
);

2059 i‡(!
mu…ùÀ_mesßges_≥r_vlib_buf„r


2060 || 
si
 == ~0

2061 || 
n_tŸÆ
 + 
msg
->
max_n_byãs_£rülized
 >

2062 
mc
->
å™•‹t
.
max_∑ckë_size
)

2064 
bi
 = 
	`£rülize_˛o£_vlib_buf„r
 (
m
);

2065 
sbm
->
fú°_buf„r
 = 0;

2066 i‡(!
îr‹
)

2067 
	`mc_°ªam_£nd
 (
mc
, 
°ªam_ödex
, 
bi
);

2068 i‡(
bi
 != ~0)

2069 
	`vlib_buf„r_‰ì_⁄e
 (
mc
->
vlib_maö
, 
bi
);

2072  
îr‹
;

2073 
	}
}

2075 
˛ib_îr‹_t
 *

2076 
	$mc_£rülize_öã∫Æ
 (
mc_maö_t
 * 
mc
,

2077 
u32
 
°ªam_ödex
,

2078 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

2079 
mc_£rülize_msg_t
 * 
msg
, ...)

2081 
vlib_maö_t
 *
vm
 = 
mc
->
vlib_maö
;

2082 
va_li°
 
va
;

2083 
˛ib_îr‹_t
 *
îr‹
;

2085 i‡(
°ªam_ödex
 == ~0)

2087 i‡(
vm
->
mc_maö
 && vm->
mc_°ªam_ödex
 == ~0)

2088 
vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹


2089 (
vm
, &vm->
¥ocs_waôög_f‹_mc_°ªam_joö
);

2090 
°ªam_ödex
 = 
vm
->
mc_°ªam_ödex
;

2093 
	`va_°¨t
 (
va
, 
msg
);

2094 
îr‹
 = 
	`mc_£rülize_va
 (
mc
, 
°ªam_ödex
,

2095 
mu…ùÀ_mesßges_≥r_vlib_buf„r
, 
msg
, &
va
);

2096 
	`va_íd
 (
va
);

2097  
îr‹
;

2098 
	}
}

2100 
uw‹d


2101 
	$mc_un£rülize_mesßge
 (
mc_maö_t
 * 
mcm
,

2102 
mc_°ªam_t
 * 
s
, 
£rülize_maö_t
 * 
m
)

2104 
mc_£rülize_°ªam_msg_t
 *
sm
;

2105 
u32
 
gi
, 
si
;

2107 
si
 = 
	`un£rülize_likñy_smÆl_unsig√d_öãgî
 (
m
);

2109 i‡(!(
si
 =~0 || 
MSG_ID_DEBUG
))

2111 
sm
 = 
	`vec_ñt_©_ödex
 (
s
->
°ªam_msgs
, 
si
);

2112 
gi
 = 
sm
->
globÆ_ödex
;

2116 *
«me
;

2118 
	`un£rülize_c°rög
 (
m
, &
«me
);

2120 i‡(
MSG_ID_DEBUG
 && 
MC_EVENT_LOGGING
 > 0)

2123 
	`ELOG_TYPE_DECLARE
 (
e
) =

2125 .
f‹m©
 = "unserialize-msg: %sÑx index %d",

2126 .
f‹m©_¨gs
 = "T4i4",

2131 
u32
 
c
[2];

2132 } *
ed
;

2133 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

2134 
ed
->
c
[0] = 
	`ñog_id_f‹_msg_«me
 (
mcm
, 
«me
);

2135 
ed
->
c
[1] = 
si
;

2139 
uw‹d
 *
p
 = 
	`hash_gë_mem
 (
mcm
->
globÆ_msg_ödex_by_«me
, 
«me
);

2140 
gi
 = 
p
 ?Ö[0] : ~0;

2144 i‡(
gi
 == ~0)

2146 
	`vec_‰ì
 (
«me
);

2147 
d⁄e
;

2150 
	`vec_vÆid©e_öô_em±y
 (
s
->
°ªam_msg_ödex_by_globÆ_ödex
, 
gi
, ~0);

2151 
si
 = 
s
->
°ªam_msg_ödex_by_globÆ_ödex
[
gi
];

2154 i‡(
si
 == ~0)

2156 
	`vec_add2
 (
s
->
°ªam_msgs
, 
sm
, 1);

2158 
si
 = 
sm
 - 
s
->
°ªam_msgs
;

2159 
sm
->
globÆ_ödex
 = 
gi
;

2160 
s
->
°ªam_msg_ödex_by_globÆ_ödex
[
gi
] = 
si
;

2162 i‡(
MC_EVENT_LOGGING
 > 0)

2165 
	`ELOG_TYPE_DECLARE
 (
e
) =

2167 .
f‹m©
 = "msg-bind: stream %d %sÅo index %d",

2168 .
f‹m©_¨gs
 = "i4T4i4",

2173 
u32
 
c
[3];

2174 } *
ed
;

2175 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

2176 
ed
->
c
[0] = 
s
->
ödex
;

2177 
ed
->
c
[1] = 
	`ñog_id_f‹_msg_«me
 (
mcm
, 
«me
);

2178 
ed
->
c
[2] = 
si
;

2183 
sm
 = 
	`vec_ñt_©_ödex
 (
s
->
°ªam_msgs
, 
si
);

2184 i‡(
gi
 !
sm
->
globÆ_ödex
 && 
MC_EVENT_LOGGING
 > 0)

2187 
	`ELOG_TYPE_DECLARE
 (
e
) =

2189 .
f‹m©
 = "msg-id-ERROR: %s index %dÉxpected %d",

2190 .
f‹m©_¨gs
 = "T4i4i4",

2195 
u32
 
c
[3];

2196 } *
ed
;

2197 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

2198 
ed
->
c
[0] = 
	`ñog_id_f‹_msg_«me
 (
mcm
, 
«me
);

2199 
ed
->
c
[1] = 
si
;

2200 
ed
->
c
[2] = ~0;

2201 i‡(
sm
->
globÆ_ödex
 <

2202 
	`vec_Àn
 (
s
->
°ªam_msg_ödex_by_globÆ_ödex
))

2203 
ed
->
c
[2] =

2204 
s
->
°ªam_msg_ödex_by_globÆ_ödex
[
sm
->
globÆ_ödex
];

2208 
	`vec_‰ì
 (
«me
);

2211 i‡(
gi
 != ~0)

2213 
mc_£rülize_msg_t
 *
msg
;

2214 
msg
 = 
	`vec_ñt
 (
mcm
->
globÆ_msgs
, 
gi
);

2215 
	`un£rülize
 (
m
, 
msg
->
un£rülize
, 
mcm
);

2218 
d⁄e
:

2219  
gi
 != ~0;

2220 
	}
}

2223 
	$mc_un£rülize_öã∫Æ
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_™d_buf„r_ödex
)

2225 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

2226 
£rülize_maö_t
 *
m
 = &
mcm
->
£rülize_maös
[
VLIB_RX
];

2227 
vlib_£rülize_buf„r_maö_t
 *
sbm
 = &
mcm
->
£rülize_buf„r_maös
[
VLIB_RX
];

2228 
mc_°ªam_™d_buf„r_t
 *
sb
;

2229 
mc_°ªam_t
 *
°ªam
;

2230 
u32
 
buf„r_ödex
;

2232 
sb
 =

2233 
	`poﬁ_ñt_©_ödex
 (
mcm
->
mc_un£rülize_°ªam_™d_buf„rs
,

2234 
°ªam_™d_buf„r_ödex
);

2235 
buf„r_ödex
 = 
sb
->buffer_index;

2236 
°ªam
 = 
	`vec_ñt_©_ödex
 (
mcm
->
°ªam_ve˘‹
, 
sb
->
°ªam_ödex
);

2237 
	`poﬁ_put
 (
mcm
->
mc_un£rülize_°ªam_™d_buf„rs
, 
sb
);

2239 i‡(
°ªam
->
c⁄fig
.
ßve_¢≠shŸ
)

2241 
u32
 
n_byãs
 = 
	`vlib_buf„r_ödex_Àngth_ö_chaö
 (
vm
, 
buf„r_ödex
);

2242 
u8
 *
c⁄ã¡s
;

2243 
	`vec_ª£t_Àngth
 (
c⁄ã¡s
);

2244 
	`vec_vÆid©e
 (
c⁄ã¡s
, 
n_byãs
 - 1);

2245 
	`vlib_buf„r_c⁄ã¡s
 (
vm
, 
buf„r_ödex
, 
c⁄ã¡s
);

2246 
°ªam
->
c⁄fig
.
	`ßve_¢≠shŸ
 (
mcm
, 0, 
c⁄ã¡s
,

2247 
n_byãs
);

2250 
	`ASSERT
 (
	`vlib_ö_¥o˚ss_c⁄ãxt
 (
vm
));

2252 
	`un£rülize_›í_vlib_buf„r
 (
m
, 
vm
, 
sbm
);

2254 
	`˛ib_fifo_add1
 (
sbm
->
rx
.
buf„r_fifo
, 
buf„r_ödex
);

2256 
	`un£rülize_vlib_buf„r_n_byãs
 (
m
) > 0)

2257 
	`mc_un£rülize_mesßge
 (
mcm
, 
°ªam
, 
m
);

2260 
	`un£rülize_˛o£_vlib_buf„r
 (
m
);

2261 
	}
}

2264 
	$mc_un£rülize
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
, 
u32
 
buf„r_ödex
)

2266 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

2267 
mc_°ªam_™d_buf„r_t
 *
sb
;

2268 
	`poﬁ_gë
 (
mcm
->
mc_un£rülize_°ªam_™d_buf„rs
, 
sb
);

2269 
sb
->
°ªam_ödex
 = 
s
->
ödex
;

2270 
sb
->
buf„r_ödex
 = buffer_index;

2271 
	`vlib_¥o˚ss_sig«l_evít
 (
vm
, 
mcm
->
un£rülize_¥o˚ss
,

2272 
EVENT_MC_UNSERIALIZE_BUFFER
,

2273 
sb
 - 
mcm
->
mc_un£rülize_°ªam_™d_buf„rs
);

2274 
	}
}

2276 
uw‹d


2277 
	$mc_un£rülize_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

2278 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
f
)

2280 
mc_maö_t
 *
mcm
 = 
	`mc_node_gë_maö
 (
node
);

2281 
uw‹d
 
evít_ty≥
, *
evít_d©a
 = 0;

2282 
i
;

2286 i‡(
evít_d©a
)

2287 
	`_vec_Àn
 (
evít_d©a
) = 0;

2289 
	`vlib_¥o˚ss_waô_f‹_evít
 (
vm
);

2290 
evít_ty≥
 = 
	`vlib_¥o˚ss_gë_evíts
 (
vm
, &
evít_d©a
);

2291 
evít_ty≥
)

2293 
EVENT_MC_UNSERIALIZE_BUFFER
:

2294 
i
 = 0; i < 
	`vec_Àn
 (
evít_d©a
); i++)

2295 
	`mc_un£rülize_öã∫Æ
 (
mcm
, 
evít_d©a
[
i
]);

2298 
EVENT_MC_UNSERIALIZE_CATCHUP
:

2299 
i
 = 0; i < 
	`vec_Àn
 (
evít_d©a
); i++)

2301 
u8
 *
mp
 = 
	`uw‹d_to_poöãr
 (
evít_d©a
[
i
], u8 *);

2302 
	`≥rf‹m_ˇtchup
 (
mcm
, (*Ë
mp
);

2303 
	`vec_‰ì
 (
mp
);

2313 
	}
}

2316 
	$£rülize_mc_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

2318 
mc_maö_t
 *
mcm
 = 
	`va_¨g
 (*
va
, mc_main_t *);

2319 
mc_°ªam_t
 *
s
;

2320 
mc_£rülize_°ªam_msg_t
 *
sm
;

2321 
mc_£rülize_msg_t
 *
msg
;

2323 
	`£rülize_öãgî
 (
m
, 
	`vec_Àn
 (
mcm
->
°ªam_ve˘‹
),  (
u32
));

2324 
	`vec_f‹óch
 (
s
, 
mcm
->
°ªam_ve˘‹
)

2327 
	`£rülize_c°rög
 (
m
, 
s
->
c⁄fig
.
«me
);

2330 
	`£rülize_öãgî
 (
m
, 
	`vec_Àn
 (
s
->
°ªam_msgs
),  (
u32
));

2331 
	`vec_f‹óch
 (
sm
, 
s
->
°ªam_msgs
)

2333 
msg
 = 
	`vec_ñt
 (
mcm
->
globÆ_msgs
, 
sm
->
globÆ_ödex
);

2334 
	`£rülize_c°rög
 (
m
, 
msg
->
«me
);

2337 
	}
}

2340 
	$un£rülize_mc_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
)

2342 
mc_maö_t
 *
mcm
 = 
	`va_¨g
 (*
va
, mc_main_t *);

2343 
u32
 
i
, 
n_°ªams
, 
n_°ªam_msgs
;

2344 *
«me
;

2345 
mc_°ªam_t
 *
s
;

2346 
mc_£rülize_°ªam_msg_t
 *
sm
;

2348 
	`un£rülize_öãgî
 (
m
, &
n_°ªams
,  (
u32
));

2349 
i
 = 0; i < 
n_°ªams
; i++)

2351 
	`un£rülize_c°rög
 (
m
, &
«me
);

2352 i‡(
i
 !
MC_STREAM_INDEX_INTERNAL
 && !
	`mc_°ªam_by_«me
 (
mcm
, 
«me
))

2354 
	`vec_vÆid©e
 (
mcm
->
°ªam_ve˘‹
, 
i
);

2355 
s
 = 
	`vec_ñt_©_ödex
 (
mcm
->
°ªam_ve˘‹
, 
i
);

2356 
	`mc_°ªam_öô
 (
s
);

2357 
s
->
ödex
 = s - 
mcm
->
°ªam_ve˘‹
;

2358 
s
->
c⁄fig
.
«me
 =Çame;

2359 
s
->
°©e
 = 
MC_STREAM_STATE_«me_known
;

2360 
	`hash_£t_mem
 (
mcm
->
°ªam_ödex_by_«me
, 
s
->
c⁄fig
.
«me
, s->
ödex
);

2363 
	`vec_‰ì
 (
«me
);

2365 
s
 = 
	`vec_ñt_©_ödex
 (
mcm
->
°ªam_ve˘‹
, 
i
);

2367 
	`vec_‰ì
 (
s
->
°ªam_msgs
);

2368 
	`vec_‰ì
 (
s
->
°ªam_msg_ödex_by_globÆ_ödex
);

2370 
	`un£rülize_öãgî
 (
m
, &
n_°ªam_msgs
,  (
u32
));

2371 
	`vec_ªsize
 (
s
->
°ªam_msgs
, 
n_°ªam_msgs
);

2372 
	`vec_f‹óch
 (
sm
, 
s
->
°ªam_msgs
)

2374 
uw‹d
 *
p
;

2375 
u32
 
si
, 
gi
;

2377 
	`un£rülize_c°rög
 (
m
, &
«me
);

2378 
p
 = 
	`hash_gë
 (
mcm
->
globÆ_msg_ödex_by_«me
, 
«me
);

2379 
gi
 = 
p
 ?Ö[0] : ~0;

2380 
si
 = 
sm
 - 
s
->
°ªam_msgs
;

2382 i‡(
MC_EVENT_LOGGING
 > 0)

2385 
	`ELOG_TYPE_DECLARE
 (
e
) =

2387 .
f‹m©
 = "catchup-bind: %sÅo %d global index %d stream %d",

2388 .
f‹m©_¨gs
 = "T4i4i4i4",

2394 
u32
 
c
[4];

2395 } *
ed
;

2396 
ed
 = 
	`ELOG_DATA
 (
mcm
->
ñog_maö
, 
e
);

2397 
ed
->
c
[0] = 
	`ñog_id_f‹_msg_«me
 (
mcm
, 
«me
);

2398 
ed
->
c
[1] = 
si
;

2399 
ed
->
c
[2] = 
gi
;

2400 
ed
->
c
[3] = 
s
->
ödex
;

2403 
	`vec_‰ì
 (
«me
);

2405 
sm
->
globÆ_ödex
 = 
gi
;

2406 i‡(
gi
 != ~0)

2408 
	`vec_vÆid©e_öô_em±y
 (
s
->
°ªam_msg_ödex_by_globÆ_ödex
,

2409 
gi
, ~0);

2410 
s
->
°ªam_msg_ödex_by_globÆ_ödex
[
gi
] = 
si
;

2414 
	}
}

2417 
	$mc_maö_öô
 (
mc_maö_t
 * 
mcm
, *
èg
)

2419 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

2421 
mcm
->
vlib_maö
 = 
vm
;

2422 
mcm
->
ñog_maö
 = &
vm
->elog_main;

2424 
mcm
->
ªœy_ma°î_≥î_id
 = ~0ULL;

2425 
mcm
->
ªœy_°©e
 = 
MC_RELAY_STATE_NEGOTIATE
;

2427 
mcm
->
°ªam_ödex_by_«me


2428 
	`hash_¸óã_°rög
 ( 0,  (
uw‹d
));

2431 
vlib_node_ªgi°øti⁄_t
 
r
;

2433 
	`mem£t
 (&
r
, 0,  (r));

2435 
r
.
ty≥
 = 
VLIB_NODE_TYPE_PROCESS
;

2438 
r
.
ru¡ime_d©a
 = &
mcm
;

2439 
r
.
ru¡ime_d©a_byãs
 =  (&
mcm
);

2441 
r
.
«me
 = (*Ë
	`f‹m©
 (0, "mc-ma°îshù-%s", 
èg
);

2442 
r
.
fun˘i⁄
 = 
mc_ma°îshù_¥o˚ss
;

2443 
mcm
->
ma°îshù_¥o˚ss
 = 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2445 
r
.
«me
 = (*Ë
	`f‹m©
 (0, "mc-joö-agî-%s", 
èg
);

2446 
r
.
fun˘i⁄
 = 
mc_joö_agî_¥o˚ss
;

2447 
mcm
->
joö_agî_¥o˚ss
 = 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2449 
r
.
«me
 = (*Ë
	`f‹m©
 (0, "mc-ªåy-%s", 
èg
);

2450 
r
.
fun˘i⁄
 = 
mc_ªåy_¥o˚ss
;

2451 
mcm
->
ªåy_¥o˚ss
 = 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2453 
r
.
«me
 = (*Ë
	`f‹m©
 (0, "mc-ˇtchup-%s", 
èg
);

2454 
r
.
fun˘i⁄
 = 
mc_ˇtchup_¥o˚ss
;

2455 
mcm
->
ˇtchup_¥o˚ss
 = 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2457 
r
.
«me
 = (*Ë
	`f‹m©
 (0, "mc-un£rülize-%s", 
èg
);

2458 
r
.
fun˘i⁄
 = 
mc_un£rülize_¥o˚ss
;

2459 
mcm
->
un£rülize_¥o˚ss
 = 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2462 i‡(
MC_EVENT_LOGGING
 > 0)

2463 
	`mhash_öô
 (&
mcm
->
ñog_id_by_≥î_id
,  (
uw‹d
),

2464  (
mc_≥î_id_t
));

2466 
	`mhash_öô
 (&
mcm
->
ma°îshù_≥î_ödex_by_id
,  (
uw‹d
),

2467  (
mc_≥î_id_t
));

2468 
	`mc_£rülize_öô
 (
mcm
);

2469 
	}
}

2471 
u8
 *

2472 
	$f‹m©_mc_ªœy_°©e
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

2474 
mc_ªœy_°©e_t
 
°©e
 = 
	`va_¨g
 (*
¨gs
, mc_relay_state_t);

2475 *
t
 = 0;

2476 
°©e
)

2478 
MC_RELAY_STATE_NEGOTIATE
:

2479 
t
 = "negotiate";

2481 
MC_RELAY_STATE_MASTER
:

2482 
t
 = "master";

2484 
MC_RELAY_STATE_SLAVE
:

2485 
t
 = "slave";

2488  
	`f‹m©
 (
s
, "unknow¿0x%x", 
°©e
);

2491  
	`f‹m©
 (
s
, "%s", 
t
);

2492 
	}
}

2494 
u8
 *

2495 
	$f‹m©_mc_°ªam_°©e
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

2497 
mc_°ªam_°©e_t
 
°©e
 = 
	`va_¨g
 (*
¨gs
, mc_stream_state_t);

2498 *
t
 = 0;

2499 
°©e
)

2501 
	#_
(
f
Ë
MC_STREAM_STATE_
##f: 
t
 = #f; ;

	)

2502 
f‹óch_mc_°ªam_°©e


2503 #unde‡
_


2505  
	`f‹m©
 (
s
, "unknow¿0x%x", 
°©e
);

2508  
	`f‹m©
 (
s
, "%s", 
t
);

2509 
	}
}

2512 
	$mc_≥î_comp
 (*
a1
, *
a2
)

2514 
mc_°ªam_≥î_t
 *
p1
 = 
a1
;

2515 
mc_°ªam_≥î_t
 *
p2
 = 
a2
;

2517  
	`mc_≥î_id_com∑ª
 (
p1
->
id
, 
p2
->id);

2518 
	}
}

2520 
u8
 *

2521 
	$f‹m©_mc_maö
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

2523 
mc_maö_t
 *
mcm
 = 
	`va_¨g
 (*
¨gs
, mc_main_t *);

2524 
mc_°ªam_t
 *
t
;

2525 
mc_°ªam_≥î_t
 *
p
, *
ps
;

2526 
u32
 
ödít
 = 
	`f‹m©_gë_ödít
 (
s
);

2528 
s
 = 
	`f‹m©
 (s, "MC state %U, %d streams joined, global sequence 0x%x",

2529 
f‹m©_mc_ªœy_°©e
, 
mcm
->
ªœy_°©e
,

2530 
	`vec_Àn
 (
mcm
->
°ªam_ve˘‹
), mcm->
ªœy_globÆ_£quí˚
);

2533 
mc_ma°îshù_≥î_t
 *
mp
;

2534 
f64
 
now
 = 
	`vlib_time_now
 (
mcm
->
vlib_maö
);

2535 
s
 = 
	`f‹m©
 (s, "\n%UMostÑecent mastershipÖeers:",

2536 
f‹m©_whôe_•a˚
, 
ödít
 + 2);

2537 
	`vec_f‹óch
 (
mp
, 
mcm
->
ma°îshù_≥îs
)

2539 
s
 = 
	`f‹m©
 (s, "\n%U%-30U%.4e",

2540 
f‹m©_whôe_•a˚
, 
ödít
 + 4,

2541 
mcm
->
å™•‹t
.
f‹m©_≥î_id
, 
mp
->
≥î_id
,

2542 
now
 - 
mp
->
time_œ°_ma°î_as£π_ª˚ived
);

2546 
	`vec_f‹óch
 (
t
, 
mcm
->
°ªam_ve˘‹
)

2548 
s
 = 
	`f‹m©
 (s, "\n%Ustream `%s' index %d",

2549 
f‹m©_whôe_•a˚
, 
ödít
 + 2, 
t
->
c⁄fig
.
«me
,Å->
ödex
);

2551 
s
 = 
	`f‹m©
 (s, "\n%Ustate %U",

2552 
f‹m©_whôe_•a˚
, 
ödít
 + 4,

2553 
f‹m©_mc_°ªam_°©e
, 
t
->
°©e
);

2555 
s
 =

2556 
	`f‹m©
 (
s
,

2558 
f‹m©_whôe_•a˚
, 
ödít
 + 4, 
t
->
c⁄fig
.
ªåy_öãrvÆ
,

2559 
t
->
c⁄fig
.
ªåy_limô
, 
	`poﬁ_ñts
 (t->
ªåy_poﬁ
),

2560 
t
->
°©s
.
n_ªåõs
 -Å->
°©s_œ°_˛ór
.n_retries);

2562 
s
 = 
	`f‹m©
 (s, "\n%U%Ld/%Ld userÑequests sent/received",

2563 
f‹m©_whôe_•a˚
, 
ödít
 + 4,

2564 
t
->
u£r_ªque°s_£¡
,Å->
u£r_ªque°s_ª˚ived
);

2566 
s
 = 
	`f‹m©
 (s, "\n%U%dÖeers,Üocal/global sequence 0x%x/0x%x",

2567 
f‹m©_whôe_•a˚
, 
ödít
 + 4,

2568 
	`poﬁ_ñts
 (
t
->
≥îs
),

2569 
t
->
our_loˇl_£quí˚
,Å->
œ°_globÆ_£quí˚_¥o˚s£d
);

2571 
ps
 = 0;

2573 
	`poﬁ_f‹óch
 (
p
, 
t
->
≥îs
,

2575 i‡(
	`˛ib_bôm≠_gë
 (
t
->
Æl_≥î_bôm≠
, 
p
 -Å->
≥îs
))

2576 
	`vec_add1
 (
ps
, 
p
[0]);

2579 
	`vec_s‹t_wôh_fun˘i⁄
 (
ps
, 
mc_≥î_comp
);

2580 
s
 = 
	`f‹m©
 (s, "\n%U%=30s%10s%16s%16s",

2581 
f‹m©_whôe_•a˚
, 
ödít
 + 6,

2584 
	`vec_f‹óch
 (
p
, 
ps
)

2586 
s
 = 
	`f‹m©
 (s, "\n%U%-30U0x%08x%16Ld%16Ld%s",

2587 
f‹m©_whôe_•a˚
, 
ödít
 + 6,

2588 
mcm
->
å™•‹t
.
f‹m©_≥î_id
, 
p
->
id
.
as_u64
,

2589 
p
->
œ°_£quí˚_ª˚ived
,

2590 
p
->
°©s
.
n_msgs_‰om_∑°
 -

2591 
p
->
°©s_œ°_˛ór
.
n_msgs_‰om_∑°
,

2592 
p
->
°©s
.
n_msgs_‰om_futuª
 -

2593 
p
->
°©s_œ°_˛ór
.
n_msgs_‰om_futuª
,

2594 (
mcm
->
å™•‹t
.
our_ack_≥î_id
.
as_u64
 ==

2595 
p
->
id
.
as_u64
 ? " (self)" : ""));

2597 
	`vec_‰ì
 (
ps
);

2600  
s
;

2601 
	}
}

	@mc.h

18 #i‚de‡
ö˛uded_vlib_mc_h


19 
	#ö˛uded_vlib_mc_h


	)

21 
	~<vµö‰a/ñog.h
>

22 
	~<vµö‰a/fifo.h
>

23 
	~<vµö‰a/mhash.h
>

24 
	~<vlib/node.h
>

26 #i‚de‡
MC_EVENT_LOGGING


27 
	#MC_EVENT_LOGGING
 1

	)

30 
Æways_ölöe
 
uw‹d


31 
	$mc_√ed_byã_sw≠
 ()

33  
CLIB_ARCH_IS_LITTLE_ENDIAN
;

34 
	}
}

42 
u8
 
	mas_u8
[8];

43 
u64
 
	mas_u64
;

44 } 
	tmc_≥î_id_t
;

46 
Æways_ölöe
 
mc_≥î_id_t


47 
	$mc_byã_sw≠_≥î_id
 (
mc_≥î_id_t
 
i
)

50  
i
;

51 
	}
}

53 
Æways_ölöe
 

54 
	$mc_≥î_id_com∑ª
 (
mc_≥î_id_t
 
a
, mc_≥î_id_à
b
)

56  
	`memcmp
 (
a
.
as_u8
, 
b
.as_u8,  (a.as_u8));

57 
	}
}

62 
CLIB_PACKED
 (struct

65 
mc_≥î_id_t
 
≥î_id
;

67 
u32
 
globÆ_£quí˚
;}Ë
	tmc_msg_ma°î_as£π_t
;

69 
Æways_ölöe
 

70 
	$mc_byã_sw≠_msg_ma°î_as£π
 (
mc_msg_ma°î_as£π_t
 * 
r
)

72 i‡(
	`mc_√ed_byã_sw≠
 ())

74 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

75 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

77 
	}
}

79 
	#f‹óch_mc_msg_ty≥
 \

80 
	`_
 (
ma°î_as£π
) \

81 
	`_
 (
joö_‹_Àave_ªque°
) \

82 
	`_
 (
joö_ª∂y
) \

83 
	`_
 (
u£r_ªque°
) \

84 
	`_
 (
u£r_ack
) \

85 
	`_
 (
ˇtchup_ªque°
) \

86 
	`_
 (
ˇtchup_ª∂y
)

	)

90 
	#_
(
f
Ë
MC_MSG_TYPE_
##f,

	)

91 
	mf‹óch_mc_msg_ty≥


92 #unde‡
_


93 } 
	tmc_ªœy_msg_ty≥_t
;

96 
CLIB_PACKED
 (struct

98 
mc_≥î_id_t
 
≥î_id
; 
mc_ªœy_msg_ty≥_t
 
ty≥
:32;

101 
u32
 
°ªam_ödex
;

103 
u8
 
is_joö
;}Ë
	tmc_msg_joö_‹_Àave_ªque°_t
;

105 
Æways_ölöe
 

106 
	$mc_byã_sw≠_msg_joö_‹_Àave_ªque°
 (
mc_msg_joö_‹_Àave_ªque°_t
 * 
r
)

108 i‡(
	`mc_√ed_byã_sw≠
 ())

110 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

111 
r
->
ty≥
 = 
	`˛ib_byã_sw≠_u32
 (r->type);

112 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

114 
	}
}

117 
CLIB_PACKED
 (struct

119 
mc_≥î_id_t
 
≥î_id
; 
mc_ªœy_msg_ty≥_t
 
ty≥
:32;

121 
u32
 
°ªam_ödex
;

123 
mc_≥î_id_t
 
ˇtchup_≥î_id
;}Ë
	tmc_msg_joö_ª∂y_t
;

125 
Æways_ölöe
 

126 
	$mc_byã_sw≠_msg_joö_ª∂y
 (
mc_msg_joö_ª∂y_t
 * 
r
)

128 i‡(
	`mc_√ed_byã_sw≠
 ())

130 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

131 
r
->
ty≥
 = 
	`˛ib_byã_sw≠_u32
 (r->type);

132 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

133 
r
->
ˇtchup_≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->catchup_peer_id);

135 
	}
}

139 
CLIB_PACKED
 (struct

141 
mc_≥î_id_t
 
≥î_id
; 
u32
 
°ªam_ödex
;

143 
u32
 
globÆ_£quí˚
;

145 
u32
 
loˇl_£quí˚
;

147 
u32
 
n_d©a_byãs
;

149 
u8
 
d©a
[0];}Ë
	tmc_msg_u£r_ªque°_t
;

151 
Æways_ölöe
 

152 
	$mc_byã_sw≠_msg_u£r_ªque°
 (
mc_msg_u£r_ªque°_t
 * 
r
)

154 i‡(
	`mc_√ed_byã_sw≠
 ())

156 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

157 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

158 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

159 
r
->
loˇl_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->local_sequence);

160 
r
->
n_d©a_byãs
 = 
	`˛ib_byã_sw≠_u32
 (r->n_data_bytes);

162 
	}
}

165 
CLIB_PACKED
 (struct

167 
mc_≥î_id_t
 
≥î_id
;

168 
u32
 
globÆ_£quí˚
; u32 
°ªam_ödex
;

169 
u32
 
loˇl_£quí˚
;

170 
i32
 
£q_cmp_ªsu…
;}Ë
	tmc_msg_u£r_ack_t
;

172 
Æways_ölöe
 

173 
	$mc_byã_sw≠_msg_u£r_ack
 (
mc_msg_u£r_ack_t
 * 
r
)

175 i‡(
	`mc_√ed_byã_sw≠
 ())

177 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

178 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

179 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

180 
r
->
loˇl_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->local_sequence);

181 
r
->
£q_cmp_ªsu…
 = 
	`˛ib_byã_sw≠_i32
 (r->seq_cmp_result);

183 
	}
}

186 
CLIB_PACKED
 (struct

188 
mc_≥î_id_t
 
≥î_id
;

189 
u32
 
°ªam_ödex
;}Ë
	tmc_msg_ˇtchup_ªque°_t
;

191 
Æways_ölöe
 

192 
	$mc_byã_sw≠_msg_ˇtchup_ªque°
 (
mc_msg_ˇtchup_ªque°_t
 * 
r
)

194 i‡(
	`mc_√ed_byã_sw≠
 ())

196 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

197 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

199 
	}
}

202 
CLIB_PACKED
 (struct

204 
mc_≥î_id_t
 
≥î_id
; 
u32
 
°ªam_ödex
;

206 
u32
 
œ°_globÆ_£quí˚_ö˛uded
;

208 
u32
 
n_d©a_byãs
;

210 
u8
 
d©a
[0];}Ë
	tmc_msg_ˇtchup_ª∂y_t
;

212 
Æways_ölöe
 

213 
	$mc_byã_sw≠_msg_ˇtchup_ª∂y
 (
mc_msg_ˇtchup_ª∂y_t
 * 
r
)

215 i‡(
	`mc_√ed_byã_sw≠
 ())

217 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

218 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

219 
r
->
œ°_globÆ_£quí˚_ö˛uded
 =

220 
	`˛ib_byã_sw≠_u32
 (
r
->
œ°_globÆ_£quí˚_ö˛uded
);

221 
r
->
n_d©a_byãs
 = 
	`˛ib_byã_sw≠_u32
 (r->n_data_bytes);

223 
	}
}

225 
	s_mc_£rülize_msg


228 *
	m«me
;

231 
£rülize_fun˘i⁄_t
 *
	m£rülize
;

232 
£rülize_fun˘i⁄_t
 *
	mun£rülize
;

236 
u32
 
	mmax_n_byãs_£rülized
;

239 
u32
 
	m›aque
;

242 
u32
 
	mglobÆ_ödex
;

245 
_mc_£rülize_msg
 *
	m√xt_ªgi°øti⁄
;

246 } 
	tmc_£rülize_msg_t
;

251 
u32
 
	mglobÆ_ödex
;

252 } 
	tmc_£rülize_°ªam_msg_t
;

254 
	#MC_SERIALIZE_MSG
(
x
,...) \

255 
__VA_ARGS__
 
mc_£rülize_msg_t
 
x
; \

256 
__mc_£rülize_msg_ªgi°øti⁄_
##
	`x
 () \

257 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

258 
__mc_£rülize_msg_ªgi°øti⁄_
##
	`x
 () \

260 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

261 
x
.
√xt_ªgi°øti⁄
 = 
vm
->
mc_msg_ªgi°øti⁄s
; \

262 
vm
->
mc_msg_ªgi°øti⁄s
 = &
x
; \

264 
__VA_ARGS__
 
mc_£rülize_msg_t
 
x


	)

268 
	mMC_TRANSPORT_MASTERSHIP
,

269 
	mMC_TRANSPORT_JOIN
,

270 
	mMC_TRANSPORT_USER_REQUEST_TO_RELAY
,

271 
	mMC_TRANSPORT_USER_REQUEST_FROM_RELAY
,

272 
	mMC_N_TRANSPORT_TYPE
,

273 } 
	tmc_å™•‹t_ty≥_t
;

277 
	m˛ib_îr‹_t
 *(*
	mtx_buf„r
Ë(*
	m›aque
, 
mc_å™•‹t_ty≥_t
 
	mty≥
,

278 
u32
 
	mbuf„r_ödex
);

280 
	m˛ib_îr‹_t
 *(*
	mtx_ack
Ë(*
	m›aque
, 
mc_≥î_id_t
 
	m≥î_id
,

281 
u32
 
	mbuf„r_ödex
);

284 
uw‹d
 (*
ˇtchup_ªque°_fun
Ë(*
	m›aque
, 
u32
 
	m°ªam_ödex
,

285 
mc_≥î_id_t
 
	mˇtchup_≥î_id
);

287 (*
	mˇtchup_£nd_fun
Ë(*
	m›aque
, 
uw‹d
 
	mˇtchup_›aque
,

288 
u8
 * 
	md©a_ve˘‹
);

291 *
	m›aque
;

293 
mc_≥î_id_t
 
	mour_ack_≥î_id
;

294 
mc_≥î_id_t
 
	mour_ˇtchup_≥î_id
;

298 
u32
 
	mmax_∑ckë_size
;

300 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_≥î_id
;

301 } 
	tmc_å™•‹t_t
;

307 
u64
 
	mn_msgs_‰om_∑°
;

308 
u64
 
	mn_msgs_‰om_futuª
;

309 } 
	tmc_°ªam_≥î_°©s_t
;

314 
mc_≥î_id_t
 
	mid
;

317 
u32
 
	mœ°_£quí˚_ª˚ived
;

319 
mc_°ªam_≥î_°©s_t
 
	m°©s
, 
	m°©s_œ°_˛ór
;

320 } 
	tmc_°ªam_≥î_t
;

324 
u32
 
	mbuf„r_ödex
;

327 
u32
 
	mloˇl_£quí˚
;

330 
u32
 
	mn_ªåõs
;

333 
u32
 
	m¥ev_ödex
, 
	m√xt_ödex
;

336 
uw‹d
 *
	mu«cked_by_≥î_bôm≠
;

339 
f64
 
	m£¡_©
;

340 } 
	tmc_ªåy_t
;

345 
u64
 
	mn_ªåõs
;

346 } 
	tmc_°ªam_°©s_t
;

348 
	gmc_maö_t
;

349 
	gmc_°ªam_t
;

354 *
	m«me
;

357 
u32
 
	mwödow_size
;

360 
f64
 
	mªåy_öãrvÆ
;

363 
u32
 
	mªåy_limô
;

366 (*
	mrx_buf„r
Ë(
mc_maö_t
 * 
	mmc_maö
,

367 
mc_°ªam_t
 * 
	m°ªam
,

368 
mc_≥î_id_t
 
	m≥î_id
, 
u32
 
	mbuf„r_ödex
);

371 
	mu8
 *(*
	mˇtchup_¢≠shŸ
Ë(
mc_maö_t
 * 
	mmc_maö
,

372 
u8
 * 
	m¢≠shŸ_ve˘‹
,

373 
u32
 
	mœ°_globÆ_£quí˚_ö˛uded
);

376 (*
	mˇtchup
Ë(
mc_maö_t
 * 
	mmc_maö
,

377 
u8
 * 
	m¢≠shŸ_d©a
, 
u32
 
	mn_¢≠shŸ_d©a_byãs
);

380 (*
	mßve_¢≠shŸ
Ë(
mc_maö_t
 * 
	mmc_maö
,

381 
u32
 
	mis_ˇtchup
,

382 
u8
 * 
	m¢≠shŸ_d©a
, 
u32
 
	mn_¢≠shŸ_d©a_byãs
);

385 (*
	m≥î_dõd
Ë(
mc_maö_t
 * 
	mmc_maö
,

386 
mc_°ªam_t
 * 
	m°ªam
, 
mc_≥î_id_t
 
	m≥î_id
);

387 } 
	tmc_°ªam_c⁄fig_t
;

389 
	#f‹óch_mc_°ªam_°©e
 \

390 
	`_
 (
övÆid
) \

391 
	`_
 (
«me_known
) \

392 
	`_
 (
joö_ö_¥ogªss
) \

393 
	`_
 (
ˇtchup
) \

394 
	`_
 (
ªady
)

	)

398 
	#_
(
f
Ë
MC_STREAM_STATE_
##f,

	)

399 
	mf‹óch_mc_°ªam_°©e


400 #unde‡
_


401 } 
	tmc_°ªam_°©e_t
;

403 
	smc_°ªam_t


405 
mc_°ªam_c⁄fig_t
 
	mc⁄fig
;

407 
mc_°ªam_°©e_t
 
	m°©e
;

410 
u32
 
	mödex
;

413 
	#MC_STREAM_INDEX_INTERNAL
 0

	)

415 
mc_ªåy_t
 *
	mªåy_poﬁ
;

418 
u32
 
	mªåy_hód_ödex
, 
	mªåy_èû_ödex
;

426 
mc_ªåy_t
 *
	mªtúed_fifo
;

429 
uw‹d
 *
	mªåy_ödex_by_loˇl_£quí˚
;

433 
u32
 *
	mˇtchup_fifo
;

435 
mc_°ªam_°©s_t
 
	m°©s
, 
	m°©s_œ°_˛ór
;

438 
mc_°ªam_≥î_t
 *
	m≥îs
;

441 
uw‹d
 *
	mÆl_≥î_bôm≠
;

444 
mhash_t
 
	m≥î_ödex_by_id
;

447 
f64
 
	mjoö_timeout
;

449 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_joö_d⁄e
;

451 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_›í_wödow
;

454 
u32
 
	mour_loˇl_£quí˚
;

461 
u32
 
	mœ°_globÆ_£quí˚_¥o˚s£d
;

464 
mc_£rülize_°ªam_msg_t
 *
	m°ªam_msgs
;

467 
u32
 *
	m°ªam_msg_ödex_by_globÆ_ödex
;

470 
uw‹d
 *
	m°ªam_msg_ödex_by_«me
;

472 
u64
 
	mu£r_ªque°s_£¡
;

473 
u64
 
	mu£r_ªque°s_ª˚ived
;

474 } 
	tmc_°ªam_t
;

476 
Æways_ölöe
 

477 
	$mc_°ªam_‰ì
 (
mc_°ªam_t
 * 
s
)

479 
	`poﬁ_‰ì
 (
s
->
ªåy_poﬁ
);

480 
	`hash_‰ì
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
);

481 
	`˛ib_fifo_‰ì
 (
s
->
ˇtchup_fifo
);

482 
	`poﬁ_‰ì
 (
s
->
≥îs
);

483 
	`mhash_‰ì
 (&
s
->
≥î_ödex_by_id
);

484 
	`vec_‰ì
 (
s
->
¥ocs_waôög_f‹_joö_d⁄e
);

485 
	`vec_‰ì
 (
s
->
¥ocs_waôög_f‹_›í_wödow
);

486 
	}
}

488 
Æways_ölöe
 

489 
	$mc_°ªam_öô
 (
mc_°ªam_t
 * 
s
)

491 
	`mem£t
 (
s
, 0,  (s[0]));

492 
s
->
ªåy_hód_ödex
 = s->
ªåy_èû_ödex
 = ~0;

493 
	}
}

497 
u32
 
	m°ªam_ödex
;

498 
u32
 
	mˇtchup_›aque
;

499 
u8
 *
	mˇtchup_¢≠shŸ
;

500 } 
	tmc_ˇtchup_¥o˚ss_¨g_t
;

504 
	mMC_RELAY_STATE_NEGOTIATE
,

505 
	mMC_RELAY_STATE_MASTER
,

506 
	mMC_RELAY_STATE_SLAVE
,

507 } 
	tmc_ªœy_°©e_t
;

511 
mc_≥î_id_t
 
	m≥î_id
;

513 
f64
 
	mtime_œ°_ma°î_as£π_ª˚ived
;

514 } 
	tmc_ma°îshù_≥î_t
;

518 
u32
 
	m°ªam_ödex
;

519 
u32
 
	mbuf„r_ödex
;

520 } 
	tmc_°ªam_™d_buf„r_t
;

522 
	smc_maö_t


524 
mc_ªœy_°©e_t
 
	mªœy_°©e
;

527 
u32
 
	mwe_ˇn_be_ªœy_ma°î
;

529 
u64
 
	mªœy_ma°î_≥î_id
;

531 
mc_ma°îshù_≥î_t
 *
	mma°îshù_≥îs
;

534 
mhash_t
 
	mma°îshù_≥î_ödex_by_id
;

537 
mc_å™•‹t_t
 
	må™•‹t
;

540 
u32
 
	mªœy_globÆ_£quí˚
;

543 
mc_°ªam_t
 *
	m°ªam_ve˘‹
;

546 
uw‹d
 *
	m°ªam_ödex_by_«me
;

548 
uw‹d
 *
	m¥ocs_waôög_f‹_°ªam_«me_by_«me
;

550 
vlib_⁄e_time_waôög_¥o˚ss_t
 **
	m¥ocs_waôög_f‹_°ªam_«me_poﬁ
;

552 
	mjoös_ö_¥ogªss
;

554 
mc_ˇtchup_¥o˚ss_¨g_t
 *
	mˇtchup_¥o˚ss_¨gs
;

558 
u32
 
	mma°îshù_¥o˚ss
;

559 
u32
 
	mjoö_agî_¥o˚ss
;

560 
u32
 
	mªåy_¥o˚ss
;

561 
u32
 
	mˇtchup_¥o˚ss
;

562 
u32
 
	mun£rülize_¥o˚ss
;

565 
mc_£rülize_msg_t
 **
	mglobÆ_msgs
;

568 
uw‹d
 *
	mglobÆ_msg_ödex_by_«me
;

571 
£rülize_maö_t
 
	m£rülize_maös
[
VLIB_N_RX_TX
];

573 
vlib_£rülize_buf„r_maö_t
 
	m£rülize_buf„r_maös
[
VLIB_N_RX_TX
];

576 
vlib_maö_t
 *
	mvlib_maö
;

577 
ñog_maö_t
 *
	mñog_maö
;

580 
mhash_t
 
	mñog_id_by_≥î_id
;

582 
uw‹d
 *
	mñog_id_by_msg_«me
;

585 
mc_°ªam_™d_buf„r_t
 *
	mmc_un£rülize_°ªam_™d_buf„rs
;

586 } 
	tmc_maö_t
;

588 
Æways_ölöe
 
mc_°ªam_t
 *

589 
	$mc_°ªam_by_«me
 (
mc_maö_t
 * 
m
, *
«me
)

591 
uw‹d
 *
p
 = 
	`hash_gë
 (
m
->
°ªam_ödex_by_«me
, 
«me
);

592  
p
 ? 
	`vec_ñt_©_ödex
 (
m
->
°ªam_ve˘‹
,Ö[0]) : 0;

593 
	}
}

595 
Æways_ölöe
 
mc_°ªam_t
 *

596 
	$mc_°ªam_by_ödex
 (
mc_maö_t
 * 
m
, 
u32
 
i
)

598  
i
 < 
	`vec_Àn
 (
m
->
°ªam_ve˘‹
) ? m->stream_vector + i : 0;

599 
	}
}

601 
Æways_ölöe
 

602 
	$mc_˛ór_°ªam_°©s
 (
mc_maö_t
 * 
m
)

604 
mc_°ªam_t
 *
s
;

605 
mc_°ªam_≥î_t
 *
p
;

606 
	`vec_f‹óch
 (
s
, 
m
->
°ªam_ve˘‹
)

608 
s
->
°©s_œ°_˛ór
 = s->
°©s
;

610 
	`poﬁ_f‹óch
 (
p
, 
s
->
≥îs
, ({

611 
p
->
°©s_œ°_˛ór
 =Ö->
°©s
;

615 
	}
}

618 
	#_
(
f
Ë
mc_msg_
##f##
	`_h™dÀr
 (
mc_maö_t
 * 
mcm
, mc_msg_##f##
_t
 * 
msg
, 
u32
 
buf„r_ödex
);

	)

619 
	gf‹óch_mc_msg_ty≥


620 #unde‡
_


621 
u32
 
mc_°ªam_joö
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_c⁄fig_t
 *);

623 
mc_°ªam_Àave
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_ödex
);

625 
mc_waô_f‹_°ªam_ªady
 (
mc_maö_t
 * 
m
, *
°ªam_«me
);

627 
u32
 
mc_°ªam_£nd
 (
mc_maö_t
 * 
mcm
, u32 
°ªam_ödex
, u32 
buf„r_ödex
);

629 
mc_maö_öô
 (
mc_maö_t
 * 
mcm
, *
èg
);

631 
mc_íabÀ_dißbÀ_ma°îshù
 (
mc_maö_t
 * 
mcm
, 
we_ˇn_be_ma°î
);

633 *
mc_gë_vlib_buf„r
 (
vlib_maö_t
 *
vm
, 
u32
 
n_byãs
,

634 
u32
 * 
bi_ªtu∫
);

636 
f‹m©_fun˘i⁄_t
 
	gf‹m©_mc_maö
;

638 
˛ib_îr‹_t
 *
mc_£rülize_öã∫Æ
 (
mc_maö_t
 * 
mc
,

639 
u32
 
°ªam_ödex
,

640 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

641 
mc_£rülize_msg_t
 * 
msg
, ...);

643 
˛ib_îr‹_t
 *
mc_£rülize_va
 (
mc_maö_t
 * 
mc
,

644 
u32
 
°ªam_ödex
,

645 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

646 
mc_£rülize_msg_t
 * 
msg
, 
va_li°
 * 
va
);

648 
	#mc_£rülize_°ªam
(
mc
,
si
,
msg
,
¨gs
...) \

649 
	`mc_£rülize_öã∫Æ
((
mc
),(
si
),(0),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

651 
	#mc_£rülize
(
mc
,
msg
,
¨gs
...) \

652 
	`mc_£rülize_öã∫Æ
((
mc
),(~0),(0),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

654 
	#mc_£rülize2
(
mc
,
add
,
msg
,
¨gs
...) \

655 
	`mc_£rülize_öã∫Æ
((
mc
),(~0),(
add
),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

657 
mc_un£rülize
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
, 
u32
 
buf„r_ödex
);

658 
uw‹d
 
mc_un£rülize_mesßge
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
,

659 
£rülize_maö_t
 * 
m
);

661 
£rülize_fun˘i⁄_t
 
	g£rülize_mc_maö
, 
	gun£rülize_mc_maö
;

663 
Æways_ölöe
 
uw‹d


664 
	$mc_max_mesßge_size_ö_byãs
 (
mc_maö_t
 * 
mcm
)

666  
mcm
->
å™•‹t
.
max_∑ckë_size
 -  (
mc_msg_u£r_ªque°_t
);

667 
	}
}

669 
Æways_ölöe
 
w‹d


670 
	$mc_£rülize_n_byãs_À·
 (
mc_maö_t
 * 
mcm
, 
£rülize_maö_t
 * 
m
)

672  
	`mc_max_mesßge_size_ö_byãs
 (
mcm
) -

673 
	`£rülize_vlib_buf„r_n_byãs
 (
m
);

674 
	}
}

676 
un£rülize_mc_°ªam
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
);

677 
mc_°ªam_joö_¥o˚ss_hﬁd
 ();

	@node.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/thªads.h
>

44 
vlib_node_t
 *

45 
	$vlib_gë_node_by_«me
 (
vlib_maö_t
 * 
vm
, 
u8
 * 
«me
)

47 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

48 
uw‹d
 *
p
;

49 
u8
 *
key
 = 
«me
;

50 i‡(!
	`˛ib_mem_is_hóp_obje˘
 (
key
))

51 
key
 = 
	`f‹m©
 (0, "%s", key);

52 
p
 = 
	`hash_gë
 (
nm
->
node_by_«me
, 
key
);

53 i‡(
key
 !
«me
)

54 
	`vec_‰ì
 (
key
);

55  
p
 ? 
	`vec_ñt
 (
nm
->
nodes
,Ö[0]) : 0;

56 
	}
}

59 
	$node_£t_ñog_«me
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
)

61 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

62 
ñog_evít_ty≥_t
 *
t
;

64 
t
 = 
	`vec_ñt_©_ödex
 (
vm
->
node_ˇŒ_ñog_evít_ty≥s
, 
node_ödex
);

65 
	`vec_‰ì
 (
t
->
f‹m©
);

66 
t
->
f‹m©
 = (*Ë
	`f‹m©
 (0, "%v-ˇŒ: %%d%c", 
n
->
«me
, 0);

68 
t
 = 
	`vec_ñt_©_ödex
 (
vm
->
node_ªtu∫_ñog_evít_ty≥s
, 
node_ödex
);

69 
	`vec_‰ì
 (
t
->
f‹m©
);

70 
t
->
f‹m©
 = (*Ë
	`f‹m©
 (0, "%v-ªtu∫: %%d%c", 
n
->
«me
, 0);

72 
n
->
«me_ñog_°rög
 = 
	`ñog_°rög
 (&
vm
->
ñog_maö
, "%v%c",Ç->
«me
, 0);

73 
	}
}

76 
	$vlib_w‹kî_thªad_node_ª«me
 (
u32
 
node_ödex
)

78 
i
;

79 
vlib_maö_t
 *
vm
;

80 
vlib_node_t
 *
n
;

82 i‡(
	`vec_Àn
 (
vlib_maös
) == 1)

85 
vm
 = 
vlib_maös
[0];

86 
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

88 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

89 
	`ASSERT
 (*
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 == 1);

91 
i
 = 1; i < 
	`vec_Àn
 (
vlib_maös
); i++)

93 
vlib_maö_t
 *
vm_w‹kî
 = 
vlib_maös
[
i
];

94 
vlib_node_t
 *
n_w‹kî
 = 
	`vlib_gë_node
 (
vm_w‹kî
, 
node_ödex
);

96 
n_w‹kî
->
«me
 = 
n
->name;

97 
n_w‹kî
->
«me_ñog_°rög
 = 
n
->name_elog_string;

99 
	}
}

102 
	$vlib_node_ª«me
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, *
fmt
, ...)

104 
va_li°
 
va
;

105 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

106 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

108 
	`va_°¨t
 (
va
, 
fmt
);

109 
	`hash_un£t
 (
nm
->
node_by_«me
, 
n
->
«me
);

110 
	`vec_‰ì
 (
n
->
«me
);

111 
n
->
«me
 = 
	`va_f‹m©
 (0, 
fmt
, &
va
);

112 
	`va_íd
 (
va
);

113 
	`hash_£t
 (
nm
->
node_by_«me
, 
n
->
«me
,Ç->
ödex
);

115 
	`node_£t_ñog_«me
 (
vm
, 
node_ödex
);

118 
	`vlib_w‹kî_thªad_node_ª«me
 (
node_ödex
);

119 
	}
}

122 
	$vlib_node_ru¡ime_upd©e
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, u32 
√xt_ödex
)

124 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

125 
vlib_node_ru¡ime_t
 *
r
, *
s
;

126 
vlib_node_t
 *
node
, *
√xt_node
;

127 
vlib_√xt_‰ame_t
 *
nf
;

128 
vlib_≥ndög_‰ame_t
 *
pf
;

129 
i32
 
i
, 
j
, 
n_ö£π
;

131 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

133 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

135 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

136 
r
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

138 
n_ö£π
 = 
	`vec_Àn
 (
node
->
√xt_nodes
Ë- 
r
->
n_√xt_nodes
;

139 i‡(
n_ö£π
 > 0)

141 
i
 = 
r
->
√xt_‰ame_ödex
 +Ñ->
n_√xt_nodes
;

142 
	`vec_ö£π
 (
nm
->
√xt_‰ames
, 
n_ö£π
, 
i
);

145 
j
 = 0; j < 
n_ö£π
; j++)

146 
	`vlib_√xt_‰ame_öô
 (
nm
->
√xt_‰ames
 + 
i
 + 
j
);

149 
j
 = 0; j < 
	`vec_Àn
 (
nm
->
nodes
); j++)

151 
s
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
j
);

152 i‡(
j
 !
node_ödex
 && 
s
->
√xt_‰ame_ödex
 >
i
)

153 
s
->
√xt_‰ame_ödex
 +
n_ö£π
;

157 
	`vec_f‹óch
 (
pf
, 
nm
->
≥ndög_‰ames
)

159 i‡(
pf
->
√xt_‰ame_ödex
 !
VLIB_PENDING_FRAME_NO_NEXT_FRAME


160 && 
pf
->
√xt_‰ame_ödex
 >
i
)

161 
pf
->
√xt_‰ame_ödex
 +
n_ö£π
;

164 
	`poﬁ_f‹óch
 (
pf
, 
nm
->
su•íded_¥o˚ss_‰ames
, ({

165 i‡(
pf
->
√xt_‰ame_ödex
 !~0 &&Öf->√xt_‰ame_ödex >
i
)

166 
pf
->
√xt_‰ame_ödex
 +
n_ö£π
;

170 
r
->
n_√xt_nodes
 = 
	`vec_Àn
 (
node
->
√xt_nodes
);

174 
√xt_node
 = 
	`vlib_gë_node
 (
vm
, 
node
->
√xt_nodes
[
√xt_ödex
]);

175 
nf
 = 
nm
->
√xt_‰ames
 + 
r
->
√xt_‰ame_ödex
 + 
√xt_ödex
;

176 
nf
->
node_ru¡ime_ödex
 = 
√xt_node
->
ru¡ime_ödex
;

178 
	`vlib_w‹kî_thªad_node_ru¡ime_upd©e
 ();

180 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

181 
	}
}

183 
uw‹d


184 
	$vlib_node_gë_√xt
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
, uw‹d 
√xt_node_ödex
)

186 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

187 
vlib_node_t
 *
node
;

188 
uw‹d
 *
p
;

190 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

193 
	`ASSERT
 (
nm
->
Êags
 & 
VLIB_NODE_MAIN_RUNTIME_STARTED
);

195 i‡((
p
 = 
	`hash_gë
 (
node
->
√xt_¶Ÿ_by_node
, 
√xt_node_ödex
)))

197  
p
[0];

201 
	}
}

204 
uw‹d


205 
	$vlib_node_add_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

206 
uw‹d
 
node_ödex
,

207 
uw‹d
 
√xt_node_ödex
, uw‹d 
¶Ÿ
)

209 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

210 
vlib_node_t
 *
node
, *
√xt
;

211 
uw‹d
 *
p
;

213 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

214 
√xt
 = 
	`vec_ñt
 (
nm
->
nodes
, 
√xt_node_ödex
);

217 
	`ASSERT
 (
nm
->
Êags
 & 
VLIB_NODE_MAIN_RUNTIME_STARTED
);

219 i‡((
p
 = 
	`hash_gë
 (
node
->
√xt_¶Ÿ_by_node
, 
√xt_node_ödex
)))

222 i‡(
¶Ÿ
 != ~0)

223 
	`ASSERT
 (
¶Ÿ
 =
p
[0]);

224  
p
[0];

227 i‡(
¶Ÿ
 == ~0)

228 
¶Ÿ
 = 
	`vec_Àn
 (
node
->
√xt_nodes
);

230 
	`vec_vÆid©e_öô_em±y
 (
node
->
√xt_nodes
, 
¶Ÿ
, ~0);

231 
	`vec_vÆid©e
 (
node
->
n_ve˘‹s_by_√xt_node
, 
¶Ÿ
);

233 
node
->
√xt_nodes
[
¶Ÿ
] = 
√xt_node_ödex
;

234 
	`hash_£t
 (
node
->
√xt_¶Ÿ_by_node
, 
√xt_node_ödex
, 
¶Ÿ
);

236 
	`vlib_node_ru¡ime_upd©e
 (
vm
, 
node_ödex
, 
¶Ÿ
);

238 
√xt
->
¥ev_node_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (next->prev_node_bitmap,

239 
node_ödex
);

243 
uw‹d
 
sib_node_ödex
, 
sib_¶Ÿ
;

244 
vlib_node_t
 *
sib_node
;

246 
	`˛ib_bôm≠_f‹óch
 (
sib_node_ödex
, 
node
->
siblög_bôm≠
, ({

247 
sib_node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
sib_node_ödex
);

248 i‡(
sib_node
 !
node
)

250 
sib_¶Ÿ
 = 
	`vlib_node_add_√xt_wôh_¶Ÿ
 (
vm
, 
sib_node_ödex
, 
√xt_node_ödex
, 
¶Ÿ
);

251 
	`ASSERT
 (
sib_¶Ÿ
 =
¶Ÿ
);

257  
¶Ÿ
;

258 
	}
}

261 
uw‹d


262 
	$vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

263 
uw‹d
 
node
, *
«me
, uw‹d 
¶Ÿ
)

265 
vlib_node_maö_t
 *
nm
;

266 
vlib_node_t
 *
n
, *
n_√xt
;

268 
nm
 = &
vm
->
node_maö
;

269 
n
 = 
	`vlib_gë_node
 (
vm
, 
node
);

271 
n_√xt
 = 
	`vlib_gë_node_by_«me
 (
vm
, (
u8
 *Ë
«me
);

272 i‡(!
n_√xt
)

274 i‡(
nm
->
Êags
 & 
VLIB_NODE_MAIN_RUNTIME_STARTED
)

277 i‡(
¶Ÿ
 == ~0)

278 
¶Ÿ
 = 
	`˛ib_max
 (
	`vec_Àn
 (
n
->
√xt_node_«mes
),

279 
	`vec_Àn
 (
n
->
√xt_nodes
));

280 
	`vec_vÆid©e
 (
n
->
√xt_node_«mes
, 
¶Ÿ
);

281 
n
->
√xt_node_«mes
[
¶Ÿ
] = 
«me
;

282  
¶Ÿ
;

285  
	`vlib_node_add_√xt_wôh_¶Ÿ
 (
vm
, 
node
, 
n_√xt
->
ödex
, 
¶Ÿ
);

286 
	}
}

289 
	$node_ñog_öô
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
ni
)

291 
ñog_evít_ty≥_t
 
t
;

293 
	`mem£t
 (&
t
, 0,  (t));

297 
	`vec_vÆid©e
 (
vm
->
node_ˇŒ_ñog_evít_ty≥s
, 
ni
);

298 
vm
->
node_ˇŒ_ñog_evít_ty≥s
[
ni
] = 
t
;

300 
	`vec_vÆid©e
 (
vm
->
node_ªtu∫_ñog_evít_ty≥s
, 
ni
);

301 
vm
->
node_ªtu∫_ñog_evít_ty≥s
[
ni
] = 
t
;

303 
	`node_£t_ñog_«me
 (
vm
, 
ni
);

304 
	}
}

306 #ifde‡
CLIB_UNIX


307 
	#STACK_ALIGN
 (
	`˛ib_mem_gë_∑ge_size
())

	)

309 
	#STACK_ALIGN
 
CLIB_CACHE_LINE_BYTES


	)

313 
	$ªgi°î_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ªgi°øti⁄_t
 * 
r
)

315 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

316 
vlib_node_t
 *
n
;

317 
u32
 
∑ge_size
 = 
	`˛ib_mem_gë_∑ge_size
 ();

318 
i
;

320 i‡(
CLIB_DEBUG
 > 0)

323 
vlib_node_t
 
zîo
 = { 0 };

324 
	`ASSERT
 (
VLIB_NODE_TYPE_INTERNAL
 =
zîo
.
ty≥
);

327 
	`ASSERT
 (
r
->
fun˘i⁄
 != 0);

329 
n
 = 
	`˛ib_mem_Æloc_no_Áû
 ( (n[0]));

330 
	`mem£t
 (
n
, 0,  (n[0]));

331 
n
->
ödex
 = 
	`vec_Àn
 (
nm
->
nodes
);

333 
	`vec_add1
 (
nm
->
nodes
, 
n
);

336 i‡(
	`˛ib_mem_is_hóp_obje˘
 (
	`vec_hódî
 (
r
->
«me
, 0)))

337 
n
->
«me
 = 
	`vec_dup
 ((
u8
 *Ë
r
->name);

339 
n
->
«me
 = 
	`f‹m©
 (0, "%s", 
r
->name);

341 i‡(!
nm
->
node_by_«me
)

342 
nm
->
node_by_«me
 = 
	`hash_¸óã_vec
 ( 32,

343  (
n
->
«me
[0]),  (
uw‹d
));

347 
vlib_node_t
 *
o
 = 
	`vlib_gë_node_by_«me
 (
vm
, 
n
->
«me
);

348 i‡(
o
)

349 
	`˛ib_îr‹
 ("m‹êth™ o√Çodê«med `%v'", 
n
->
«me
);

352 
	`hash_£t
 (
nm
->
node_by_«me
, 
n
->
«me
,Ç->
ödex
);

354 
r
->
ödex
 = 
n
->index;

355 
n
->
fun˘i⁄
 = 
r
->function;

358 
n
->
siblög_of
 = 
r
->sibling_of;

359 i‡(
r
->
siblög_of
 &&Ñ->
n_√xt_nodes
 > 0)

360 
	`˛ib_îr‹
 ("siblögÇodêshouldÇŸ havê™yÇexànode†`%v'", 
n
->
«me
);

362 i‡(
r
->
ty≥
 =
VLIB_NODE_TYPE_INTERNAL
)

363 
	`ASSERT
 (
r
->
ve˘‹_size
 > 0);

365 
	#_
(
f
Ë
n
->‡
r
->
	)
f

367 
	`_
(
ty≥
);

368 
	`_
(
Êags
);

369 
	`_
(
°©e
);

370 
	`_
(
sˇœr_size
);

371 
	`_
(
ve˘‹_size
);

372 
	`_
(
f‹m©_buf„r
);

373 
	`_
(
unf‹m©_buf„r
);

374 
	`_
(
f‹m©_åa˚
);

375 
	`_
(
vÆid©e_‰ame
);

378 
	`vlib_ªgi°î_îr‹s
 (
vm
, 
n
->
ödex
, 
r
->
n_îr‹s
,Ñ->
îr‹_°rögs
);

379 
	`node_ñog_öô
 (
vm
, 
n
->
ödex
);

381 
	`_
(
ru¡ime_d©a_byãs
);

382 i‡(
r
->
ru¡ime_d©a_byãs
 > 0)

384 
	`vec_ªsize
 (
n
->
ru¡ime_d©a
, 
r
->
ru¡ime_d©a_byãs
);

385 i‡(
r
->
ru¡ime_d©a
)

386 
	`˛ib_mem˝y
 (
n
->
ru¡ime_d©a
, 
r
->ru¡ime_d©a,Ñ->
ru¡ime_d©a_byãs
);

389 
	`vec_ªsize
 (
n
->
√xt_node_«mes
, 
r
->
n_√xt_nodes
);

390 
i
 = 0; i < 
r
->
n_√xt_nodes
; i++)

391 
n
->
√xt_node_«mes
[
i
] = 
r
->
√xt_nodes
[i];

393 
	`vec_vÆid©e_öô_em±y
 (
n
->
√xt_nodes
, 
r
->
n_√xt_nodes
 - 1, ~0);

394 
	`vec_vÆid©e
 (
n
->
n_ve˘‹s_by_√xt_node
, 
r
->
n_√xt_nodes
 - 1);

396 
n
->
ow√r_node_ödex
 =Ç->
ow√r_√xt_ödex
 = ~0;

400 
vlib_node_ru¡ime_t
 *
π
;

401 
u32
 
i
;

403 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
)

405 
vlib_¥o˚ss_t
 *
p
;

406 
uw‹d
 
log2_n_°ack_byãs
;

408 
log2_n_°ack_byãs
 = 
	`˛ib_max
 (
r
->
¥o˚ss_log2_n_°ack_byãs
, 15);

410 #ifde‡
CLIB_UNIX


416 i‡((
∑ge_size
 > (4 << 10)Ë&& 
log2_n_°ack_byãs
 < 19)

418 i‡((1 << 
log2_n_°ack_byãs
Ë<
∑ge_size
)

419 
log2_n_°ack_byãs
 = 
	`mö_log2
 (
∑ge_size
) + 1;

421 
log2_n_°ack_byãs
++;

425 
p
 = 
˛ib_mem_Æloc_Æig√d_©_off£t


426 ( (
p
[0]Ë+ (1 << 
log2_n_°ack_byãs
),

427 
STACK_ALIGN
, 
	`STRUCT_OFFSET_OF
 (
vlib_¥o˚ss_t
, 
°ack
),

429 i‡(
p
 == 0)

430 
	`˛ib_∑nic
 ("failedÅoállocateÖrocess stack (%d bytes)",

431 1 << 
log2_n_°ack_byãs
);

433 
	`mem£t
 (
p
, 0,  (p[0]));

434 
p
->
log2_n_°ack_byãs
 =Üog2_n_stack_bytes;

438 
n
->
ru¡ime_ödex
 = 
	`vec_Àn
 (
nm
->
¥o˚s£s
);

440 
	`vec_add1
 (
nm
->
¥o˚s£s
, 
p
);

444 
p
->
°ack
[0] = 
VLIB_PROCESS_STACK_MAGIC
;

447 
π
 = &
p
->
node_ru¡ime
;

449 #ifde‡
CLIB_UNIX


454 i‡(
	`m¥Ÿe˘
 (
p
->
°ack
, 
∑ge_size
, 
PROT_READ
) < 0)

455 
	`˛ib_unix_w¨nög
 ("process stack");

461 
	`vec_add2_Æig√d
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
], 
π
, 1,

462  
CLIB_CACHE_LINE_BYTES
);

463 
n
->
ru¡ime_ödex
 = 
π
 - 
nm
->
nodes_by_ty≥
[n->
ty≥
];

466 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_INPUT
)

467 
nm
->
öput_node_cou¡s_by_°©e
[
n
->
°©e
] += 1;

469 
π
->
fun˘i⁄
 = 
n
->function;

470 
π
->
Êags
 = 
n
->flags;

471 
π
->
°©e
 = 
n
->state;

472 
π
->
node_ödex
 = 
n
->
ödex
;

474 
π
->
n_√xt_nodes
 = 
r
->n_next_nodes;

475 
π
->
√xt_‰ame_ödex
 = 
	`vec_Àn
 (
nm
->
√xt_‰ames
);

477 
	`vec_ªsize
 (
nm
->
√xt_‰ames
, 
π
->
n_√xt_nodes
);

478 
i
 = 0; i < 
π
->
n_√xt_nodes
; i++)

479 
	`vlib_√xt_‰ame_öô
 (
nm
->
√xt_‰ames
 + 
π
->
√xt_‰ame_ödex
 + 
i
);

481 
	`vec_ªsize
 (
π
->
îr‹s
, 
r
->
n_îr‹s
);

482 
i
 = 0; i < 
	`vec_Àn
 (
π
->
îr‹s
); i++)

483 
π
->
îr‹s
[
i
] = 
	`vlib_îr‹_£t
 (
n
->
ödex
, i);

485 
	`STATIC_ASSERT_SIZEOF
 (
vlib_node_ru¡ime_t
, 128);

486 
	`ASSERT
 (
	`vec_Àn
 (
n
->
ru¡ime_d©a
Ë<
VLIB_NODE_RUNTIME_DATA_SIZE
);

488 i‡(
	`vec_Àn
 (
n
->
ru¡ime_d©a
) > 0)

489 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
n
->runtime_data,

490 
	`vec_Àn
 (
n
->
ru¡ime_d©a
));

492 
	`vec_‰ì
 (
n
->
ru¡ime_d©a
);

494 
	}
}

497 
u32


498 
	$vlib_ªgi°î_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ªgi°øti⁄_t
 * 
r
)

500 
	`ªgi°î_node
 (
vm
, 
r
);

501  
r
->
ödex
;

502 
	}
}

504 
uw‹d


505 
	$nuŒ_node_‚
 (
vlib_maö_t
 * 
vm
,

506 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
‰ame
)

508 
u16
 
n_ve˘‹s
 = 
‰ame
->n_vectors;

510 
	`vlib_node_ö¸emít_cou¡î
 (
vm
, 
node
->
node_ödex
, 0, 
n_ve˘‹s
);

511 
	`vlib_buf„r_‰ì
 (
vm
, 
	`vlib_‰ame_¨gs
 (
‰ame
), 
n_ve˘‹s
);

512 
	`vlib_‰ame_‰ì
 (
vm
, 
node
, 
‰ame
);

514  
n_ve˘‹s
;

515 
	}
}

518 
	$vlib_ªgi°î_Æl_°©ic_nodes
 (
vlib_maö_t
 * 
vm
)

520 
vlib_node_ªgi°øti⁄_t
 *
r
;

522 *
nuŒ_node_îr‹_°rögs
[] = {

526 
vlib_node_ªgi°øti⁄_t
 
nuŒ_node_ªg
 = {

527 .
fun˘i⁄
 = 
nuŒ_node_‚
,

528 .
ve˘‹_size
 =  (
u32
),

529 .
«me
 = "null-node",

530 .
n_îr‹s
 = 1,

531 .
îr‹_°rögs
 = 
nuŒ_node_îr‹_°rögs
,

536 
	`ªgi°î_node
 (
vm
, &
nuŒ_node_ªg
);

538 
r
 = 
vm
->
node_maö
.
node_ªgi°øti⁄s
;

539 
r
)

541 
	`ªgi°î_node
 (
vm
, 
r
);

542 
r
 =Ñ->
√xt_ªgi°øti⁄
;

544 
	}
}

546 
vlib_node_t
 ***

547 
	$vlib_node_gë_nodes
 (
vlib_maö_t
 * 
vm
, 
u32
 
max_thªads
, 
ö˛ude_°©s
)

549 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

550 
vlib_node_t
 *
n
;

551 
vlib_node_t
 ***
node_dups
;

552 
vlib_node_t
 **
nodes
;

553 
vlib_maö_t
 **
°©_vms
;

554 
vlib_maö_t
 *
°©_vm
;

555 
uw‹d
 
i
, 
j
;

556 
u32
 
thªads_to_£rülize
;

558 
	`vec_ª£t_Àngth
 (
node_dups
);

560 i‡(
	`vec_Àn
 (
°©_vms
) == 0)

562 
i
 = 0; i < 
	`vec_Àn
 (
vlib_maös
); i++)

564 
°©_vm
 = 
vlib_maös
[
i
];

565 i‡(
°©_vm
)

566 
	`vec_add1
 (
°©_vms
, 
°©_vm
);

570 
thªads_to_£rülize
 = 
	`˛ib_mö
 (
max_thªads
, 
	`vec_Àn
 (
°©_vms
));

576 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

578 
j
 = 0; j < 
thªads_to_£rülize
; j++)

580 
°©_vm
 = 
°©_vms
[
j
];

581 
nm
 = &
°©_vm
->
node_maö
;

583 i‡(
ö˛ude_°©s
)

585 
i
 = 0; i < 
	`vec_Àn
 (
nm
->
nodes
); i++)

587 
n
 = 
nm
->
nodes
[
i
];

588 
	`vlib_node_sync_°©s
 (
°©_vm
, 
n
);

592 
nodes
 = 
	`vec_dup
 (
nm
->nodes);

593 
	`vec_add1
 (
node_dups
, 
nodes
);

595 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

597  
node_dups
;

598 
	}
}

600 
˛ib_îr‹_t
 *

601 
	$vlib_node_maö_öô
 (
vlib_maö_t
 * 
vm
)

603 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

604 
˛ib_îr‹_t
 *
îr‹
 = 0;

605 
vlib_node_t
 *
n
;

606 
uw‹d
 
ni
;

608 
nm
->
‰ame_size_hash
 = 
	`hash_¸óã
 (0,  (
uw‹d
));

609 
nm
->
Êags
 |
VLIB_NODE_MAIN_RUNTIME_STARTED
;

613 
vlib_node_t
 *
n
, *
sib
;

614 
uw‹d
 
si
;

616 
ni
 = 0;Çò< 
	`vec_Àn
 (
nm
->
nodes
);Çi++)

618 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
ni
);

620 i‡(!
n
->
siblög_of
)

623 
sib
 = 
	`vlib_gë_node_by_«me
 (
vm
, (
u8
 *Ë
n
->
siblög_of
);

624 i‡(!
sib
)

626 
îr‹
 = 
	`˛ib_îr‹_¸óã
 ("sibling `%s'Çot found forÇode `%v'",

627 
n
->
siblög_of
,Ç->
«me
);

628 
d⁄e
;

632 
	`˛ib_bôm≠_f‹óch
 (
si
, 
sib
->
siblög_bôm≠
, ({

633 
vlib_node_t
 * 
m
 = 
	`vec_ñt
 (
nm
->
nodes
, 
si
);

636 
m
->
siblög_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (m->siblög_bôm≠, 
n
->
ödex
);

639 
n
->
siblög_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (n->siblög_bôm≠, 
si
);

644 
sib
->
siblög_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (sib->siblög_bôm≠, 
n
->
ödex
);

647 
n
->
siblög_bôm≠
 = 
	`˛ib_bôm≠_‹i
 (n->siblög_bôm≠, 
sib
->
ödex
);

652 
ni
 = 0;Çò< 
	`vec_Àn
 (
nm
->
nodes
);Çi++)

654 
uw‹d
 
i
;

656 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
ni
);

658 
i
 = 0; i < 
	`vec_Àn
 (
n
->
√xt_node_«mes
); i++)

660 *
a
 = 
n
->
√xt_node_«mes
[
i
];

662 i‡(!
a
)

665 i‡(~0 =
	`vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vm
, 
n
->
ödex
, 
a
, 
i
))

667 
îr‹
 = 
˛ib_îr‹_¸óã


668 ("nodê`%v'Ñe„r†tÿunknow¿nodê`%s'", 
n
->
«me
, 
a
);

669 
d⁄e
;

673 
	`vec_‰ì
 (
n
->
√xt_node_«mes
);

677 
ni
 = 0;Çò< 
	`vec_Àn
 (
nm
->
nodes
);Çi++)

679 
vlib_node_t
 *
n_√xt
;

680 
uw‹d
 
i
;

682 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
ni
);

684 
i
 = 0; i < 
	`vec_Àn
 (
n
->
√xt_nodes
); i++)

686 i‡(
n
->
√xt_nodes
[
i
] >
	`vec_Àn
 (
nm
->
nodes
))

689 
n_√xt
 = 
	`vec_ñt
 (
nm
->
nodes
, 
n
->
√xt_nodes
[
i
]);

690 
n_√xt
->
¥ev_node_bôm≠
 =

691 
	`˛ib_bôm≠_‹i
 (
n_√xt
->
¥ev_node_bôm≠
, 
n
->
ödex
);

696 
vlib_√xt_‰ame_t
 *
nf
;

697 
vlib_node_ru¡ime_t
 *
r
;

698 
vlib_node_t
 *
√xt
;

699 
uw‹d
 
i
;

701 
	`vec_f‹óch
 (
r
, 
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
])

703 i‡(
r
->
n_√xt_nodes
 == 0)

706 
n
 = 
	`vlib_gë_node
 (
vm
, 
r
->
node_ödex
);

707 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
r
->
√xt_‰ame_ödex
);

709 
i
 = 0; i < 
	`vec_Àn
 (
n
->
√xt_nodes
); i++)

711 
√xt
 = 
	`vlib_gë_node
 (
vm
, 
n
->
√xt_nodes
[
i
]);

714 
	`ASSERT
 (
nf
[
i
].
node_ru¡ime_ödex
 =
√xt
->
ru¡ime_ödex
);

716 
nf
[
i
].
Êags
 = 0;

717 i‡(
√xt
->
Êags
 & 
VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH
)

718 
nf
[
i
].
Êags
 |
VLIB_FRAME_NO_FREE_AFTER_DISPATCH
;

723 
d⁄e
:

724  
îr‹
;

725 
	}
}

	@node.h

40 #i‚de‡
ö˛uded_vlib_node_h


41 
	#ö˛uded_vlib_node_h


	)

43 
	~<vµö‰a/˝u.h
>

44 
	~<vµö‰a/l⁄gjmp.h
>

45 
	~<vµö‰a/lock.h
>

46 
	~<vlib/åa˚.h
>

49 
	gvlib_node_ru¡ime_t
;

50 
	gvlib_‰ame_t
;

54 
	$uw‹d
 (
	tvlib_node_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

55 
	tvlib_node_ru¡ime_t
 * 
	tnode
,

56 
	tvlib_‰ame_t
 * 
	t‰ame
);

61 
VLIB_NODE_TYPE_INTERNAL
,

65 
VLIB_NODE_TYPE_INPUT
,

70 
VLIB_NODE_TYPE_PRE_INPUT
,

73 
VLIB_NODE_TYPE_PROCESS
,

75 
VLIB_N_NODE_TYPE
,

76 } 
	tvlib_node_ty≥_t
;

78 
	s_vlib_node_ªgi°øti⁄


81 
vlib_node_fun˘i⁄_t
 *
fun˘i⁄
;

84 *
«me
;

87 *
siblög_of
;

90 
u32
 
ödex
;

93 
vlib_node_ty≥_t
 
ty≥
;

96 **
îr‹_°rögs
;

99 
f‹m©_fun˘i⁄_t
 *
f‹m©_buf„r
;

100 
unf‹m©_fun˘i⁄_t
 *
unf‹m©_buf„r
;

103 
f‹m©_fun˘i⁄_t
 *
f‹m©_åa˚
;

104 
unf‹m©_fun˘i⁄_t
 *
unf‹m©_åa˚
;

107 
u8
 *(*
vÆid©e_‰ame
Ë(
vlib_maö_t
 * 
vm
,

108 
vlib_node_ru¡ime_t
 *,

109 
vlib_‰ame_t
 * 
f
);

112 *
ru¡ime_d©a
;

115 
u16
 
¥o˚ss_log2_n_°ack_byãs
;

118 
u8
 
ru¡ime_d©a_byãs
;

121 
u8
 
°©e
;

124 
u16
 
Êags
;

127 
u16
 
sˇœr_size
, 
ve˘‹_size
;

130 
u16
 
n_îr‹s
;

133 
u16
 
n_√xt_nodes
;

136 
_vlib_node_ªgi°øti⁄
 *
√xt_ªgi°øti⁄
;

139 *
√xt_nodes
[];

141 } 
	tvlib_node_ªgi°øti⁄_t
;

143 
	#VLIB_REGISTER_NODE
(
x
,...) \

144 
__VA_ARGS__
 
vlib_node_ªgi°øti⁄_t
 
x
; \

145 
__vlib_add_node_ªgi°øti⁄_
##
	`x
 () \

146 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

147 
__vlib_add_node_ªgi°øti⁄_
##
	`x
 () \

149 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

150 
x
.
√xt_ªgi°øti⁄
 = 
vm
->
node_maö
.
node_ªgi°øti⁄s
; \

151 
vm
->
node_maö
.
node_ªgi°øti⁄s
 = &
x
; \

152 
	}
} \

153 
__VA_ARGS__
 
vlib_node_ªgi°øti⁄_t
 
x


	)

155 #i‡
CLIB_DEBUG
 > 0

156 
	#VLIB_NODE_FUNCTION_CLONE_TEMPLATE
(
¨ch
, 
‚
)

	)

157 
	#VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
)

	)

158 
	#VLIB_NODE_FUNCTION_MULTIARCH
(
node
, 
‚
)

	)

160 
	#VLIB_NODE_FUNCTION_CLONE_TEMPLATE
(
¨ch
, 
‚
, 
tgt
) \

161 
uw‹d
 \

162 
	`__©åibuã__
 ((
Ê©ãn
)) \

163 
	`__©åibuã__
 ((
	`èrgë
 (
tgt
))) \

164 
CLIB_CPU_OPTIMIZED
 \

165 
‚
 ## 
_
 ## 
	`¨ch
 ( 
vlib_maö_t
 * 
vm
, \

166 
vlib_node_ru¡ime_t
 * 
node
, \

167 
vlib_‰ame_t
 * 
‰ame
) \

168 {  
	`‚
 (
vm
, 
node
, 
‰ame
); }

	)

170 
	#VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
) \

171 
	`f‹óch_m¨ch_v¨ü¡
(
VLIB_NODE_FUNCTION_CLONE_TEMPLATE
, 
‚
)

	)

173 
	#VLIB_NODE_FUNCTION_MULTIARCH
(
node
, 
‚
) \

174 
	`VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
) \

175 
	`CLIB_MULTIARCH_SELECT_FN
(
‚
, 
ölöe
) \

176 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) \

177 
__vlib_node_fun˘i⁄_mu…ürch_£À˘_
##
	`node
 () \

178 { 
node
.
fun˘i⁄
 = 
‚
 ## 
	`_mu…ürch_£À˘
(); }

	)

181 
Æways_ölöe
 
vlib_node_ªgi°øti⁄_t
 *

182 
	$vlib_node_√xt_ªgi°îed
 (
vlib_node_ªgi°øti⁄_t
 * 
c
)

184 
c
 =

185 
	`˛ib_ñf_£˘i⁄_d©a_√xt
 (
c
,

186 
c
->
n_√xt_nodes
 *  (c->
√xt_nodes
[0]));

187  
c
;

188 
	}
}

193 
u64
 
	mˇŒs
, 
	mve˘‹s
, 
	m˛ocks
, 
	msu•íds
;

194 
u64
 
	mmax_˛ock
;

195 
u64
 
	mmax_˛ock_n
;

196 } 
	tvlib_node_°©s_t
;

198 
	#f‹óch_vlib_node_°©e
 \

201 
	`_
 (
POLLING
) \

203 
	`_
 (
INTERRUPT
) \

205 
	`_
 (
DISABLED
)

	)

209 
	#_
(
f
Ë
VLIB_NODE_STATE_
##f,

	)

210 
	mf‹óch_vlib_node_°©e


211 #unde‡
_


212 
	mVLIB_N_NODE_STATE
,

213 } 
	tvlib_node_°©e_t
;

215 
	svlib_node_t


218 
vlib_node_fun˘i⁄_t
 *
	mfun˘i⁄
;

221 
u8
 *
	m«me
;

224 
u32
 
	m«me_ñog_°rög
;

227 
vlib_node_°©s_t
 
	m°©s_tŸÆ
;

231 
vlib_node_°©s_t
 
	m°©s_œ°_˛ór
;

234 
vlib_node_ty≥_t
 
	mty≥
;

237 
u32
 
	mödex
;

240 
u32
 
	mru¡ime_ödex
;

243 *
	mru¡ime_d©a
;

246 
u16
 
	mÊags
;

250 
	#VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH
 (1 << 0)

	)

253 
	#VLIB_NODE_FLAG_IS_OUTPUT
 (1 << 1)

	)

254 
	#VLIB_NODE_FLAG_IS_DROP
 (1 << 2)

	)

255 
	#VLIB_NODE_FLAG_IS_PUNT
 (1 << 3)

	)

256 
	#VLIB_NODE_FLAG_IS_HANDOFF
 (1 << 4)

	)

259 
	#VLIB_NODE_FLAG_TRACE
 (1 << 5)

	)

261 
	#VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
 (1 << 6)

	)

262 
	#VLIB_NODE_FLAG_SWITCH_FROM_POLLING_TO_INTERRUPT_MODE
 (1 << 7)

	)

265 
u8
 
	m°©e
;

268 
u8
 
	mru¡ime_d©a_byãs
;

271 
u16
 
	mn_îr‹s
;

274 
u16
 
	msˇœr_size
, 
	mve˘‹_size
;

277 
u32
 
	mîr‹_hóp_h™dÀ
;

278 
u32
 
	mîr‹_hóp_ödex
;

281 **
	mîr‹_°rögs
;

285 **
	m√xt_node_«mes
;

288 
u32
 *
	m√xt_nodes
;

291 *
	msiblög_of
;

294 
uw‹d
 *
	msiblög_bôm≠
;

297 
u64
 *
	mn_ve˘‹s_by_√xt_node
;

302 
uw‹d
 *
	m√xt_¶Ÿ_by_node
;

305 
uw‹d
 *
	m¥ev_node_bôm≠
;

308 
u32
 
	mow√r_node_ödex
, 
	mow√r_√xt_ödex
;

311 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_buf„r
;

312 
unf‹m©_fun˘i⁄_t
 *
	munf‹m©_buf„r
;

315 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_åa˚
;

318 
	mu8
 *(*
	mvÆid©e_‰ame
Ë(
vlib_maö_t
 * 
	mvm
,

319 
	mvlib_node_ru¡ime_t
 *,

320 
vlib_‰ame_t
 * 
	mf
);

322 
u8
 *
	m°©e_°rög
;

323 } 
	tvlib_node_t
;

325 
	#VLIB_INVALID_NODE_INDEX
 ((
u32
Ë~0)

	)

328 
	#VLIB_FRAME_SIZE
 256

	)

329 
	#VLIB_FRAME_ALIGN
 
CLIB_CACHE_LINE_BYTES


	)

332 
	svlib_‰ame_t


335 
u16
 
	mÊags
;

338 
u8
 
	msˇœr_size
;

341 
u8
 
	mve˘‹_size
;

344 
u16
 
	mn_ve˘‹s
;

347 
u8
 
	m¨gumíts
[0];

348 } 
	tvlib_‰ame_t
;

353 
u32
 
	m‰ame_ödex
;

356 
u32
 
	mnode_ru¡ime_ödex
;

359 
u32
 
	mÊags
;

362 
	#VLIB_FRAME_NO_FREE_AFTER_DISPATCH
 \

363 
VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH


	)

367 
	#VLIB_FRAME_OWNER
 (1 << 15)

	)

370 
	#VLIB_FRAME_IS_ALLOCATED
 
VLIB_NODE_FLAG_IS_OUTPUT


	)

373 
	#VLIB_FRAME_PENDING
 
VLIB_NODE_FLAG_IS_DROP


	)

376 
	#VLIB_FRAME_FREE_AFTER_DISPATCH
 
VLIB_NODE_FLAG_IS_PUNT


	)

379 
	#VLIB_FRAME_TRACE
 
VLIB_NODE_FLAG_TRACE


	)

382 
u32
 
	mve˘‹s_sö˚_œ°_ovîÊow
;

383 } 
	tvlib_√xt_‰ame_t
;

385 
Æways_ölöe
 

386 
	$vlib_√xt_‰ame_öô
 (
vlib_√xt_‰ame_t
 * 
nf
)

388 
	`mem£t
 (
nf
, 0,  (nf[0]));

389 
nf
->
‰ame_ödex
 = ~0;

390 
nf
->
node_ru¡ime_ödex
 = ~0;

391 
	}
}

397 
u32
 
	mnode_ru¡ime_ödex
;

400 
u32
 
	m‰ame_ödex
;

403 
u32
 
	m√xt_‰ame_ödex
;

406 
	#VLIB_PENDING_FRAME_NO_NEXT_FRAME
 ((
u32
Ë~0)

	)

407 } 
	tvlib_≥ndög_‰ame_t
;

409 
	svlib_node_ru¡ime_t


411 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

413 
vlib_node_fun˘i⁄_t
 *
	mfun˘i⁄
;

415 
vlib_îr‹_t
 *
	mîr‹s
;

417 #i‡
__SIZEOF_POINTER__
 == 4

418 
u8
 
	m∑d
[8];

421 
u32
 
	m˛ocks_sö˚_œ°_ovîÊow
;

423 
u32
 
	mmax_˛ock
;

426 
u32
 
	mmax_˛ock_n
;

429 
u32
 
	mˇŒs_sö˚_œ°_ovîÊow
;

431 
u32
 
	mve˘‹s_sö˚_œ°_ovîÊow
;

434 
u32
 
	m√xt_‰ame_ödex
;

437 
u32
 
	mnode_ödex
;

439 
u32
 
	möput_maö_lo›s_≥r_ˇŒ
;

445 
u32
 
	mmaö_lo›_cou¡_œ°_di•©ch
;

448 
u32
 
	mmaö_lo›_ve˘‹_°©s
[2];

450 
u16
 
	mÊags
;

452 
u16
 
	m°©e
;

454 
u16
 
	mn_√xt_nodes
;

456 
u16
 
	mˇched_√xt_ödex
;

462 
u16
 
	mthªad_ödex
;

464 
u8
 
	mru¡ime_d©a
[0];

473 
	tvlib_node_ru¡ime_t
;

475 
	#VLIB_NODE_RUNTIME_DATA_SIZE
 ( (
vlib_node_ru¡ime_t
Ë- 
	`STRUCT_OFFSET_OF
 (vlib_node_ru¡ime_t, 
ru¡ime_d©a
))

	)

480 
u32
 
	mn_Æloc_‰ames
;

483 
u32
 *
	m‰ì_‰ame_ödi˚s
;

484 } 
	tvlib_‰ame_size_t
;

489 
uw‹d
 
	m›aque
;

490 } 
	tvlib_¥o˚ss_evít_ty≥_t
;

495 
vlib_node_ru¡ime_t
 
	mnode_ru¡ime
;

498 
˛ib_l⁄gjmp_t
 
	mªtu∫_l⁄gjmp
;

500 
	#VLIB_PROCESS_RETURN_LONGJMP_RETURN
 ((
uw‹d
Ë~0 - 0)

	)

501 
	#VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
 ((
uw‹d
Ë~0 - 1)

	)

504 
˛ib_l⁄gjmp_t
 
	mªsume_l⁄gjmp
;

505 
	#VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
 0

	)

506 
	#VLIB_PROCESS_RESUME_LONGJMP_RESUME
 1

	)

508 
u16
 
	mÊags
;

509 
	#VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
 (1 << 0)

	)

510 
	#VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
 (1 << 1)

	)

512 
	#VLIB_PROCESS_RESUME_PENDING
 (1 << 2)

	)

515 
	#VLIB_PROCESS_IS_RUNNING
 (1 << 3)

	)

518 
u16
 
	mlog2_n_°ack_byãs
;

520 
u32
 
	msu•íded_¥o˚ss_‰ame_ödex
;

523 
u32
 
	mn_su•íds
;

526 **
	m≥ndög_evít_d©a_by_ty≥_ödex
;

529 
uw‹d
 *
	mn⁄_em±y_evít_ty≥_bôm≠
;

532 
uw‹d
 *
	m⁄e_time_evít_ty≥_bôm≠
;

536 
uw‹d
 *
	mevít_ty≥_ödex_by_ty≥_›aque
;

539 
vlib_¥o˚ss_evít_ty≥_t
 *
	mevít_ty≥_poﬁ
;

545 
u64
 
	mªsume_˛ock_öãrvÆ
;

548 
u32
 
	m°›_timî_h™dÀ
;

552 
vlib_˛i_ouçut_fun˘i⁄_t
 *
	mouçut_fun˘i⁄
;

553 
uw‹d
 
	mouçut_fun˘i⁄_¨g
;

555 #ifde‡
CLIB_UNIX


557 
	#PAGE_SIZE_MULTIPLE
 0x1000

	)

558 
	#ALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT
 
	`__©åibuã__
 ((
	`Æig√d
 (
PAGE_SIZE_MULTIPLE
)))

	)

560 
	#ALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT


	)

566 
	#VLIB_PROCESS_STACK_MAGIC
 (0xdód7ód)

	)

567 
u32
 
	m°ack
[0] 
	mALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT
;

568 } 
	tvlib_¥o˚ss_t
 
	t__©åibuã__
 ((
	tÆig√d
 (
	tCLIB_CACHE_LINE_BYTES
)));

570 #ifde‡
CLIB_UNIX


573 
	tas£π_¥o˚ss_°ack_mu°_be_Æig√d_exa˘ly_to_∑ge_size_mu…ùÀ
[(

574 (
vlib_¥o˚ss_t
)

576 
PAGE_SIZE_MULTIPLE
)

584 
u32
 
	mnode_ödex
;

586 
u32
 
	m⁄e_time_evít
;

587 } 
	tvlib_⁄e_time_waôög_¥o˚ss_t
;

591 
u16
 
	mn_d©a_ñts
;

593 
u16
 
	mn_d©a_ñt_byãs
;

596 
u32
 
	mn_d©a_byãs
;

599 
u32
 
	m¥o˚ss_node_ödex
;

601 
u32
 
	mevít_ty≥_ödex
;

605 
u8
 
	mölöe_evít_d©a
[64 - 3 *  (
u32
Ë- 2 *  (
u16
)];

608 
u8
 *
	mevít_d©a_as_ve˘‹
;

611 
	tvlib_sig«l_timed_evít_d©a_t
;

613 
Æways_ölöe
 
uw‹d


614 
	$vlib_timög_whìl_d©a_is_timed_evít
 (
u32
 
d
)

616  
d
 & 1;

617 
	}
}

619 
Æways_ölöe
 
u32


620 
	$vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss
 (
u32
 
i
)

622  0 + 2 * 
i
;

623 
	}
}

625 
Æways_ölöe
 
u32


626 
	$vlib_timög_whìl_d©a_£t_timed_evít
 (
u32
 
i
)

628  1 + 2 * 
i
;

629 
	}
}

631 
Æways_ölöe
 
uw‹d


632 
	$vlib_timög_whìl_d©a_gë_ödex
 (
u32
 
d
)

634  
d
 / 2;

635 
	}
}

640 
vlib_node_t
 **
	mnodes
;

643 
uw‹d
 *
	mnode_by_«me
;

645 
u32
 
	mÊags
;

646 
	#VLIB_NODE_MAIN_RUNTIME_STARTED
 (1 << 0)

	)

650 
vlib_node_ru¡ime_t
 *
	mnodes_by_ty≥
[
VLIB_N_NODE_TYPE
];

653 
u32
 *
	m≥ndög_öãºu±_node_ru¡ime_ödi˚s
;

654 
˛ib_•ölock_t
 
	m≥ndög_öãºu±_lock
;

659 
u32
 
	mpﬁlög_thªshﬁd_ve˘‹_Àngth
;

660 
u32
 
	möãºu±_thªshﬁd_ve˘‹_Àngth
;

663 
vlib_√xt_‰ame_t
 *
	m√xt_‰ames
;

666 
vlib_≥ndög_‰ame_t
 *
	m≥ndög_‰ames
;

669 *
	mtimög_whìl
;

671 
vlib_sig«l_timed_evít_d©a_t
 *
	msig«l_timed_evít_d©a_poﬁ
;

674 
u32
 *
	md©a_‰om_adv™cög_timög_whìl
;

677 
f64
 
	mtime_√xt_¥o˚ss_ªady
;

681 
vlib_¥o˚ss_t
 **
	m¥o˚s£s
;

684 
u32
 
	mcuºít_¥o˚ss_ödex
;

687 
vlib_≥ndög_‰ame_t
 *
	msu•íded_¥o˚ss_‰ames
;

690 **
	mªcy˛ed_evít_d©a_ve˘‹s
;

693 
u32
 
	möput_node_cou¡s_by_°©e
[
VLIB_N_NODE_STATE
];

696 
uw‹d
 *
	m‰ame_size_hash
;

699 
vlib_‰ame_size_t
 *
	m‰ame_sizes
;

702 
f64
 
	mtime_œ°_ru¡ime_°©s_˛ór
;

705 
vlib_node_ªgi°øti⁄_t
 *
	mnode_ªgi°øti⁄s
;

706 } 
	tvlib_node_maö_t
;

709 
	#FRAME_QUEUE_MAX_NELTS
 32

	)

712 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

713 
u64
 
	mhód
;

714 
u64
 
	mhód_höt
;

715 
u64
 
	mèû
;

716 
u32
 
	mn_ö_u£
;

717 
u32
 
	m√…s
;

718 
u32
 
	mwrôãn
;

719 
u32
 
	mthªshﬁd
;

720 
i32
 
	mn_ve˘‹s
[
FRAME_QUEUE_MAX_NELTS
];

721 } 
	t‰ame_queue_åa˚_t
;

725 
u64
 
	mcou¡
[
FRAME_QUEUE_MAX_NELTS
];

726 } 
	t‰ame_queue_√…_cou¡î_t
;

	@node_cli.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/thªads.h
>

44 
	$node_cmp
 (*
a1
, *
a2
)

46 
vlib_node_t
 **
n1
 = 
a1
;

47 
vlib_node_t
 **
n2
 = 
a2
;

49  
	`vec_cmp
 (
n1
[0]->
«me
, 
n2
[0]->name);

50 
	}
}

52 
˛ib_îr‹_t
 *

53 
	$show_node_gøph
 (
vlib_maö_t
 * 
vm
,

54 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

56 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

57 
vlib_node_t
 *
n
;

58 
u32
 
node_ödex
;

60 
	`vlib_˛i_ouçut
 (
vm
, "%U\n", 
f‹m©_vlib_node_gøph
, 
nm
, 0);

62 i‡(
	`unf‹m©
 (
öput
, "%U", 
unf‹m©_vlib_node
, 
vm
, &
node_ödex
))

64 
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

65 
	`vlib_˛i_ouçut
 (
vm
, "%U\n", 
f‹m©_vlib_node_gøph
, 
nm
, 
n
);

69 
vlib_node_t
 **
nodes
 = 
	`vec_dup
 (
nm
->nodes);

70 
uw‹d
 
i
;

72 
	`vec_s‹t_wôh_fun˘i⁄
 (
nodes
, 
node_cmp
);

74 
i
 = 0; i < 
	`vec_Àn
 (
nodes
); i++)

75 
	`vlib_˛i_ouçut
 (
vm
, "%U\n\n", 
f‹m©_vlib_node_gøph
, 
nm
, 
nodes
[
i
]);

77 
	`vec_‰ì
 (
nodes
);

81 
	}
}

84 
VLIB_CLI_COMMAND
 (
show_node_gøph_comm™d
, ) = {

85 .
∑th
 = "show vlib graph",

86 .
	gsh‹t_hñp
 = "ShowÖacketÖrocessingÇode graph",

87 .
	gfun˘i⁄
 = 
show_node_gøph
,

91 
u8
 *

92 
	$f‹m©_vlib_node_°©s
 (
u8
 * 
s
, 
va_li°
 * 
va
)

94 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

95 
vlib_node_t
 *
n
 = 
	`va_¨g
 (*
va
, vlib_node_t *);

96 
max
 = 
	`va_¨g
 (*
va
, );

97 
f64
 
v
;

98 *
°©e
;

99 
u8
 *
ns
;

100 
u8
 *
misc_öfo
 = 0;

101 
u64
 
c
, 
p
, 
l
, 
d
;

102 
f64
 
x
;

103 
f64
 
maxc
, 
max˙
;

104 
u32
 
maxn
;

105 
u32
 
ödít
;

107 i‡(!
n
)

109 i‡(
max
)

110  
	`f‹m©
 (
s
,

115  
	`f‹m©
 (
s
,

121 
ödít
 = 
	`f‹m©_gë_ödít
 (
s
);

123 
l
 = 
n
->
°©s_tŸÆ
.
˛ocks
 -Ç->
°©s_œ°_˛ór
.clocks;

124 
c
 = 
n
->
°©s_tŸÆ
.
ˇŒs
 -Ç->
°©s_œ°_˛ór
.calls;

125 
p
 = 
n
->
°©s_tŸÆ
.
ve˘‹s
 -Ç->
°©s_œ°_˛ór
.vectors;

126 
d
 = 
n
->
°©s_tŸÆ
.
su•íds
 -Ç->
°©s_œ°_˛ór
.suspends;

127 
maxc
 = (
f64
Ë
n
->
°©s_tŸÆ
.
max_˛ock
;

128 
maxn
 = 
n
->
°©s_tŸÆ
.
max_˛ock_n
;

129 i‡(
n
->
°©s_tŸÆ
.
max_˛ock_n
)

130 
max˙
 = (
f64
Ë
n
->
°©s_tŸÆ
.
max_˛ock
 / (f64Ë
maxn
;

132 
max˙
 = 0.0;

135 
x
 = 0;

136 i‡(
p
 > 0)

137 
x
 = (
f64
Ë
l
 / (f64Ë
p
;

138 i‡(
c
 > 0)

139 
x
 = (
f64
Ë
l
 / (f64Ë
c
;

140 i‡(
d
 > 0)

141 
x
 = (
f64
Ë
l
 / (f64Ë
d
;

143 i‡(
c
 > 0)

144 
v
 = (Ë
p
 / (Ë
c
;

146 
v
 = 0;

148 
°©e
 = "active";

149 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
)

151 
vlib_¥o˚ss_t
 *
p
 = 
	`vlib_gë_¥o˚ss_‰om_node
 (
vm
, 
n
);

155 i‡(!
	`˛ib_bôm≠_is_zîo
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
))

156 
misc_öfo
 = 
	`f‹m©
 (misc_info, "eventsÖending, ");

158 
p
->
Êags
 & (
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


159 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
))

162 i‡(!(
p
->
Êags
 & 
VLIB_PROCESS_IS_RUNNING
))

163 
°©e
 = "done";

166 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
:

167 
°©e
 = "time wait";

170 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
:

171 
°©e
 = "event wait";

174 (
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
):

175 
°©e
 =

180 i‡(
n
->
ty≥
 !
VLIB_NODE_TYPE_INTERNAL
)

182 
°©e
 = "polling";

183 i‡(
n
->
°©e
 =
VLIB_NODE_STATE_DISABLED
)

184 
°©e
 = "disabled";

185 i‡(
n
->
°©e
 =
VLIB_NODE_STATE_INTERRUPT
)

186 
°©e
 = "interrupt wait";

189 
ns
 = 
n
->
«me
;

191 i‡(
max
)

192 
s
 = 
	`f‹m©
 (s, "%-30v%=17.2e%=16d%=16.2e%=16.2e%=16.2e",

193 
ns
, 
maxc
, 
maxn
, 
max˙
, 
x
, 
v
);

195 
s
 = 
	`f‹m©
 (s, "%-30v%=12s%16Ld%16Ld%16Ld%16.2e%16.2f", 
ns
, 
°©e
,

196 
c
, 
p
, 
d
, 
x
, 
v
);

198 i‡(
ns
 !
n
->
«me
)

199 
	`vec_‰ì
 (
ns
);

201 i‡(
misc_öfo
)

203 
s
 = 
	`f‹m©
 (s, "\n%U%v", 
f‹m©_whôe_•a˚
, 
ödít
 + 4, 
misc_öfo
);

204 
	`vec_‰ì
 (
misc_öfo
);

207  
s
;

208 
	}
}

210 
˛ib_îr‹_t
 *

211 
	$show_node_ru¡ime
 (
vlib_maö_t
 * 
vm
,

212 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

214 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

215 
vlib_node_t
 *
n
;

216 
f64
 
time_now
;

217 
u32
 
node_ödex
;

218 
vlib_node_t
 ***
node_dups
 = 0;

219 
f64
 *
ve˘‹s_≥r_maö_lo›
 = 0;

220 
f64
 *
œ°_ve˘‹_Àngth_≥r_node
 = 0;

222 
time_now
 = 
	`vlib_time_now
 (
vm
);

224 i‡(
	`unf‹m©
 (
öput
, "%U", 
unf‹m©_vlib_node
, 
vm
, &
node_ödex
))

226 
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

227 
	`vlib_node_sync_°©s
 (
vm
, 
n
);

228 
	`vlib_˛i_ouçut
 (
vm
, "%U\n", 
f‹m©_vlib_node_°©s
, vm, 0, 0);

229 
	`vlib_˛i_ouçut
 (
vm
, "%U\n", 
f‹m©_vlib_node_°©s
, vm, 
n
, 0);

233 
vlib_node_t
 **
nodes
;

234 
uw‹d
 
i
, 
j
;

235 
f64
 
dt
;

236 
u64
 
n_öput
, 
n_ouçut
, 
n_dr›
, 
n_pu¡
;

237 
u64
 
n_öã∫Æ_ve˘‹s
, 
n_öã∫Æ_ˇŒs
;

238 
u64
 
n_˛ocks
, 
l
, 
v
, 
c
, 
d
;

239 
brõf
 = 1;

240 
max
 = 0;

241 
vlib_maö_t
 **
°©_vms
 = 0, *
°©_vm
;

244 i‡(
	`unf‹m©
 (
öput
, "brief") || unformat (input, "b"))

245 
brõf
 = 1;

246 i‡(
	`unf‹m©
 (
öput
, "verbose") || unformat (input, "v"))

247 
brõf
 = 0;

248 i‡(
	`unf‹m©
 (
öput
, "max") || unformat (input, "m"))

249 
max
 = 1;

251 
i
 = 0; i < 
	`vec_Àn
 (
vlib_maös
); i++)

253 
°©_vm
 = 
vlib_maös
[
i
];

254 i‡(
°©_vm
)

255 
	`vec_add1
 (
°©_vms
, 
°©_vm
);

262 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

264 
j
 = 0; j < 
	`vec_Àn
 (
°©_vms
); j++)

266 
°©_vm
 = 
°©_vms
[
j
];

267 
nm
 = &
°©_vm
->
node_maö
;

269 
i
 = 0; i < 
	`vec_Àn
 (
nm
->
nodes
); i++)

271 
n
 = 
nm
->
nodes
[
i
];

272 
	`vlib_node_sync_°©s
 (
°©_vm
, 
n
);

275 
nodes
 = 
	`vec_dup
 (
nm
->nodes);

277 
	`vec_add1
 (
node_dups
, 
nodes
);

278 
	`vec_add1
 (
ve˘‹s_≥r_maö_lo›
,

279 
	`vlib_œ°_ve˘‹s_≥r_maö_lo›_as_f64
 (
°©_vm
));

280 
	`vec_add1
 (
œ°_ve˘‹_Àngth_≥r_node
,

281 
	`vlib_œ°_ve˘‹_Àngth_≥r_node
 (
°©_vm
));

283 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

286 
j
 = 0; j < 
	`vec_Àn
 (
°©_vms
); j++)

288 
°©_vm
 = 
°©_vms
[
j
];

289 
nodes
 = 
node_dups
[
j
];

291 
	`vec_s‹t_wôh_fun˘i⁄
 (
nodes
, 
node_cmp
);

293 
n_öput
 = 
n_ouçut
 = 
n_dr›
 = 
n_pu¡
 = 
n_˛ocks
 = 0;

294 
n_öã∫Æ_ve˘‹s
 = 
n_öã∫Æ_ˇŒs
 = 0;

295 
i
 = 0; i < 
	`vec_Àn
 (
nodes
); i++)

297 
n
 = 
nodes
[
i
];

299 
l
 = 
n
->
°©s_tŸÆ
.
˛ocks
 -Ç->
°©s_œ°_˛ór
.clocks;

300 
n_˛ocks
 +
l
;

302 
v
 = 
n
->
°©s_tŸÆ
.
ve˘‹s
 -Ç->
°©s_œ°_˛ór
.vectors;

303 
c
 = 
n
->
°©s_tŸÆ
.
ˇŒs
 -Ç->
°©s_œ°_˛ór
.calls;

305 
n
->
ty≥
)

310 
VLIB_NODE_TYPE_INTERNAL
:

311 
n_ouçut
 +(
n
->
Êags
 & 
VLIB_NODE_FLAG_IS_OUTPUT
Ë? 
v
 : 0;

312 
n_dr›
 +(
n
->
Êags
 & 
VLIB_NODE_FLAG_IS_DROP
Ë? 
v
 : 0;

313 
n_pu¡
 +(
n
->
Êags
 & 
VLIB_NODE_FLAG_IS_PUNT
Ë? 
v
 : 0;

314 i‡(!(
n
->
Êags
 & 
VLIB_NODE_FLAG_IS_OUTPUT
))

316 
n_öã∫Æ_ve˘‹s
 +
v
;

317 
n_öã∫Æ_ˇŒs
 +
c
;

319 i‡(
n
->
Êags
 & 
VLIB_NODE_FLAG_IS_HANDOFF
)

320 
n_öput
 +
v
;

323 
VLIB_NODE_TYPE_INPUT
:

324 
n_öput
 +
v
;

329 i‡(
	`vec_Àn
 (
vlib_maös
) > 1)

331 
vlib_w‹kî_thªad_t
 *
w
 = 
vlib_w‹kî_thªads
 + 
j
;

332 i‡(
j
 > 0)

333 
	`vlib_˛i_ouçut
 (
vm
, "---------------");

335 i‡(
w
->
lc‹e_id
 > -1)

336 
	`vlib_˛i_ouçut
 (
vm
, "Thªad %d %†÷c‹ê%u)", 
j
, 
w
->
«me
,

337 
w
->
lc‹e_id
);

339 
	`vlib_˛i_ouçut
 (
vm
, "Thªad %d %s", 
j
, 
w
->
«me
);

342 
dt
 = 
time_now
 - 
nm
->
time_œ°_ru¡ime_°©s_˛ór
;

343 
vlib_˛i_ouçut


344 (
vm
,

347 
dt
,

348 (
n_öã∫Æ_ˇŒs
 > 0

349 ? (
f64
Ë
n_öã∫Æ_ve˘‹s
 / (f64Ë
n_öã∫Æ_ˇŒs


351 1 << 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
,

352 
ve˘‹s_≥r_maö_lo›
[
j
],

353 
œ°_ve˘‹_Àngth_≥r_node
[
j
],

354 (
f64
Ë
n_öput
 / 
dt
,

355 (
f64
Ë
n_ouçut
 / 
dt
, (f64Ë
n_dr›
 / dt, (f64Ë
n_pu¡
 / dt);

357 
	`vlib_˛i_ouçut
 (
vm
, "%U", 
f‹m©_vlib_node_°©s
, 
°©_vm
, 0, 
max
);

358 
i
 = 0; i < 
	`vec_Àn
 (
nodes
); i++)

360 
c
 =

361 
nodes
[
i
]->
°©s_tŸÆ
.
ˇŒs
 -

362 
nodes
[
i
]->
°©s_œ°_˛ór
.
ˇŒs
;

363 
d
 =

364 
nodes
[
i
]->
°©s_tŸÆ
.
su•íds
 -

365 
nodes
[
i
]->
°©s_œ°_˛ór
.
su•íds
;

366 i‡(
c
 || 
d
 || !
brõf
)

368 
	`vlib_˛i_ouçut
 (
vm
, "%U", 
f‹m©_vlib_node_°©s
, 
°©_vm
,

369 
nodes
[
i
], 
max
);

372 
	`vec_‰ì
 (
nodes
);

374 
	`vec_‰ì
 (
°©_vms
);

375 
	`vec_‰ì
 (
node_dups
);

376 
	`vec_‰ì
 (
ve˘‹s_≥r_maö_lo›
);

377 
	`vec_‰ì
 (
œ°_ve˘‹_Àngth_≥r_node
);

381 
	}
}

384 
VLIB_CLI_COMMAND
 (
show_node_ru¡ime_comm™d
, ) = {

385 .
∑th
 = "showÑuntime",

386 .
	gsh‹t_hñp
 = "ShowÖacketÖrocessingÑuntime",

387 .
	gfun˘i⁄
 = 
show_node_ru¡ime
,

388 .
	gis_mp_ß„
 = 1,

392 
˛ib_îr‹_t
 *

393 
	$˛ór_node_ru¡ime
 (
vlib_maö_t
 * 
vm
,

394 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

396 
vlib_node_maö_t
 *
nm
;

397 
vlib_node_t
 *
n
;

398 
i
, 
j
;

399 
vlib_maö_t
 **
°©_vms
 = 0, *
°©_vm
;

400 
vlib_node_ru¡ime_t
 *
r
;

402 
i
 = 0; i < 
	`vec_Àn
 (
vlib_maös
); i++)

404 
°©_vm
 = 
vlib_maös
[
i
];

405 i‡(
°©_vm
)

406 
	`vec_add1
 (
°©_vms
, 
°©_vm
);

409 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

411 
j
 = 0; j < 
	`vec_Àn
 (
°©_vms
); j++)

413 
°©_vm
 = 
°©_vms
[
j
];

414 
nm
 = &
°©_vm
->
node_maö
;

416 
i
 = 0; i < 
	`vec_Àn
 (
nm
->
nodes
); i++)

418 
n
 = 
nm
->
nodes
[
i
];

419 
	`vlib_node_sync_°©s
 (
°©_vm
, 
n
);

420 
n
->
°©s_œ°_˛ór
 =Ç->
°©s_tŸÆ
;

422 
r
 = 
	`vlib_node_gë_ru¡ime
 (
°©_vm
, 
n
->
ödex
);

423 
r
->
max_˛ock
 = 0;

426 
nm
->
time_œ°_ru¡ime_°©s_˛ór
 = 
	`vlib_time_now
 (
vm
);

429 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

431 
	`vec_‰ì
 (
°©_vms
);

434 
	}
}

437 
VLIB_CLI_COMMAND
 (
˛ór_node_ru¡ime_comm™d
, ) = {

438 .
∑th
 = "clearÑuntime",

439 .
	gsh‹t_hñp
 = "ClearÖacketÖrocessingÑuntime statistics",

440 .
	gfun˘i⁄
 = 
˛ór_node_ru¡ime
,

446 
	$vlib_node_˛i_ª„ªn˚
 ()

448 
	}
}

	@node_format.c

40 
	~<vlib/vlib.h
>

42 
u8
 *

43 
	$f‹m©_vlib_node_gøph
 (
u8
 * 
s
, 
va_li°
 * 
va
)

45 
vlib_node_maö_t
 *
nm
 = 
	`va_¨g
 (*
va
, vlib_node_main_t *);

46 
vlib_node_t
 *
n
 = 
	`va_¨g
 (*
va
, vlib_node_t *);

47 
i
, 
j
;

48 
u32
 
ödít
;

51 
u32
 
√xt_node
;

52 
u32
 
√xt_¶Ÿ
;

53 
u32
 
¥ev_node
;

54 } 
	ttmp_t
;

55 
tmp_t
 *
tmps
 = 0;

56 
tmp_t
 
em±y
 = {.
√xt_node
 = ~0,.
¥ev_node
 = ~0 };

58 i‡(!
n
)

59  
	`f‹m©
 (
s
, "%=26s%=26s%=26s", "Name", "Next", "Previous");

61 
s
 = 
	`f‹m©
 (s, "%-26v", 
n
->
«me
);

63 
ödít
 = 
	`f‹m©_gë_ödít
 (
s
);

65 
i
 = 
j
 = 0; i < 
	`vec_Àn
 (
n
->
√xt_nodes
); i++)

67 i‡(
n
->
√xt_nodes
[
i
] =
VLIB_INVALID_NODE_INDEX
)

69 
	`vec_vÆid©e_öô_em±y
 (
tmps
, 
j
, 
em±y
);

70 
tmps
[
j
].
√xt_node
 = 
n
->
√xt_nodes
[
i
];

71 
tmps
[
j
].
√xt_¶Ÿ
 = 
i
;

72 
j
++;

75 
j
 = 0;

77 
	`˛ib_bôm≠_f‹óch
 (
i
, 
n
->
¥ev_node_bôm≠
, ({

78 
	`vec_vÆid©e_öô_em±y
 (
tmps
, 
j
, 
em±y
);

79 
tmps
[
j
].
¥ev_node
 = 
i
;

80 
j
++;

84 
i
 = 0; i < 
	`vec_Àn
 (
tmps
); i++)

86 i‡(
i
 > 0)

87 
s
 = 
	`f‹m©
 (s, "\n%U", 
f‹m©_whôe_•a˚
, 
ödít
);

89 i‡(
tmps
[
i
].
√xt_node
 != ~0)

91 
vlib_node_t
 *
x
;

92 
u8
 *
t
 = 0;

94 
x
 = 
	`vec_ñt
 (
nm
->
nodes
, 
tmps
[
i
].
√xt_node
);

95 
t
 = 
	`f‹m©
 (t, "%v [%d]", 
x
->
«me
, 
tmps
[
i
].
√xt_¶Ÿ
);

96 
s
 = 
	`f‹m©
 (s, "%=26v", 
t
);

97 
	`vec_‰ì
 (
t
);

100 
s
 = 
	`f‹m©
 (s, "%26s", "");

102 i‡(
tmps
[
i
].
¥ev_node
 != ~0)

104 
vlib_node_t
 *
x
;

105 
x
 = 
	`vec_ñt
 (
nm
->
nodes
, 
tmps
[
i
].
¥ev_node
);

106 
s
 = 
	`f‹m©
 (s, "%=26v", 
x
->
«me
);

110 
	`vec_‰ì
 (
tmps
);

112  
s
;

113 
	}
}

115 
u8
 *

116 
	$f‹m©_vlib_node_™d_√xt
 (
u8
 * 
s
, 
va_li°
 * 
va
)

118 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

119 
vlib_node_t
 *
n
 = 
	`va_¨g
 (*
va
, vlib_node_t *);

120 
u32
 
√xt_ödex
 = 
	`va_¨g
 (*
va
, u32);

121 
vlib_node_t
 *
n_√xt
;

122 
u32
 *
ni
;

124 
ni
 = 
	`vec_ñt_©_ödex
 (
n
->
√xt_nodes
, 
√xt_ödex
);

125 
n_√xt
 = 
	`vlib_gë_node
 (
vm
, 
ni
[0]);

126  
	`f‹m©
 (
s
, "%v -> %v", 
n
->
«me
, 
n_√xt
->name);

127 
	}
}

129 
u8
 *

130 
	$f‹m©_vlib_node_«me
 (
u8
 * 
s
, 
va_li°
 * 
va
)

132 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

133 
u32
 
node_ödex
 = 
	`va_¨g
 (*
va
, u32);

134 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

136  
	`f‹m©
 (
s
, "%v", 
n
->
«me
);

137 
	}
}

139 
u8
 *

140 
	$f‹m©_vlib_√xt_node_«me
 (
u8
 * 
s
, 
va_li°
 * 
va
)

142 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

143 
u32
 
node_ödex
 = 
	`va_¨g
 (*
va
, u32);

144 
u32
 
√xt_ödex
 = 
	`va_¨g
 (*
va
, u32);

145 
vlib_node_t
 *
√xt
 = 
	`vlib_gë_√xt_node
 (
vm
, 
node_ödex
, 
√xt_ödex
);

146  
	`f‹m©
 (
s
, "%v", 
√xt
->
«me
);

147 
	}
}

150 
uw‹d


151 
	$unf‹m©_vlib_node
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

153 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
¨gs
, vlib_main_t *);

154 
u32
 *
ªsu…
 = 
	`va_¨g
 (*
¨gs
, u32 *);

156  
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_hash_vec_°rög
,

157 
vm
->
node_maö
.
node_by_«me
, 
ªsu…
);

158 
	}
}

160 
u8
 *

161 
	$f‹m©_vlib_time
 (
u8
 * 
s
, 
va_li°
 * 
va
)

163 
	`CLIB_UNUSED
 (
vlib_maö_t
 * 
vm
Ë
	`va_¨g
 (*
va
, vlib_main_t *);

164 
f64
 
time
 = 
	`va_¨g
 (*
va
, f64);

165  
	`f‹m©
 (
s
, "%12.4f", 
time
);

166 
	}
}

168 
u8
 *

169 
	$f‹m©_vlib_˝u_time
 (
u8
 * 
s
, 
va_li°
 * 
va
)

171 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

172 
u64
 
˝u_time
 = 
	`va_¨g
 (*
va
, u64);

173 
f64
 
dt
;

175 
dt
 =

176 (
˝u_time
 -

177 
vm
->
˛ib_time
.
öô_˝u_time
Ë* vm->˛ib_time.
£c⁄ds_≥r_˛ock
;

178  
	`f‹m©
 (
s
, "%U", 
f‹m©_vlib_time
, 
vm
, 
dt
);

179 
	}
}

	@node_funcs.h

45 #i‚de‡
ö˛uded_vlib_node_funcs_h


46 
	#ö˛uded_vlib_node_funcs_h


	)

48 
	~<vµö‰a/fifo.h
>

49 
	~<vµö‰a/tw_timî_1t_3w_1024¶_ov.h
>

58 
Æways_ölöe
 
vlib_node_t
 *

59 
	$vlib_gë_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
i
)

61  
	`vec_ñt
 (
vm
->
node_maö
.
nodes
, 
i
);

62 
	}
}

71 
Æways_ölöe
 
vlib_node_t
 *

72 
	$vlib_gë_√xt_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, u32 
√xt_ödex
)

74 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

75 
vlib_node_t
 *
n
;

77 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

78 
	`ASSERT
 (
√xt_ödex
 < 
	`vec_Àn
 (
n
->
√xt_nodes
));

79  
	`vlib_gë_node
 (
vm
, 
n
->
√xt_nodes
[
√xt_ödex
]);

80 
	}
}

88 
Æways_ölöe
 
vlib_node_ru¡ime_t
 *

89 
	$vlib_node_gë_ru¡ime
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

91 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

92 
vlib_node_t
 *
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

93 
vlib_¥o˚ss_t
 *
p
;

94 i‡(
n
->
ty≥
 !
VLIB_NODE_TYPE_PROCESS
)

95  
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

98 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

99  &
p
->
node_ru¡ime
;

101 
	}
}

109 
Æways_ölöe
 *

110 
	$vlib_node_gë_ru¡ime_d©a
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

112 
vlib_node_ru¡ime_t
 *
r
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

113  
r
->
ru¡ime_d©a
;

114 
	}
}

123 
Æways_ölöe
 

124 
	$vlib_node_£t_ru¡ime_d©a
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

125 *
ru¡ime_d©a
, 
u32
 
n_ru¡ime_d©a_byãs
)

127 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

128 
vlib_node_ru¡ime_t
 *
r
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

130 
n
->
ru¡ime_d©a_byãs
 = 
n_ru¡ime_d©a_byãs
;

131 
	`vec_‰ì
 (
n
->
ru¡ime_d©a
);

132 
	`vec_add
 (
n
->
ru¡ime_d©a
,Ñu¡ime_d©a, 
n_ru¡ime_d©a_byãs
);

134 
	`ASSERT
 (
	`vec_Àn
 (
n
->
ru¡ime_d©a
Ë< (
vlib_node_ru¡ime_t
) -

135 
	`STRUCT_OFFSET_OF
 (
vlib_node_ru¡ime_t
, 
ru¡ime_d©a
));

137 i‡(
	`vec_Àn
 (
n
->
ru¡ime_d©a
) > 0)

138 
	`˛ib_mem˝y
 (
r
->
ru¡ime_d©a
, 
n
->ru¡ime_d©a, 
	`vec_Àn
 (n->runtime_data));

139 
	}
}

146 
Æways_ölöe
 

147 
	$vlib_node_£t_°©e
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

148 
vlib_node_°©e_t
 
√w_°©e
)

150 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

151 
vlib_node_t
 *
n
;

152 
vlib_node_ru¡ime_t
 *
r
;

154 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

155 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
)

157 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

158 
r
 = &
p
->
node_ru¡ime
;

161 
p
->
Êags
 &~(
VLIB_PROCESS_RESUME_PENDING


162 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


163 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
);

166 
r
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

168 
	`ASSERT
 (
√w_°©e
 < 
VLIB_N_NODE_STATE
);

170 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_INPUT
)

172 
	`ASSERT
 (
nm
->
öput_node_cou¡s_by_°©e
[
n
->
°©e
] > 0);

173 
nm
->
öput_node_cou¡s_by_°©e
[
n
->
°©e
] -= 1;

174 
nm
->
öput_node_cou¡s_by_°©e
[
√w_°©e
] += 1;

177 
n
->
°©e
 = 
√w_°©e
;

178 
r
->
°©e
 = 
√w_°©e
;

179 
	}
}

186 
Æways_ölöe
 
vlib_node_°©e_t


187 
	$vlib_node_gë_°©e
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

189 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

190 
vlib_node_t
 *
n
;

191 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

192  
n
->
°©e
;

193 
	}
}

195 
Æways_ölöe
 

196 
	$vlib_node_£t_öãºu±_≥ndög
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

198 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

199 
vlib_node_t
 *
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

200 
	`ASSERT
 (
n
->
ty≥
 =
VLIB_NODE_TYPE_INPUT
);

201 
	`˛ib_•ölock_lock_if_öô
 (&
nm
->
≥ndög_öãºu±_lock
);

202 
	`vec_add1
 (
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
, 
n
->
ru¡ime_ödex
);

203 
	`˛ib_•ölock_u∆ock_if_öô
 (&
nm
->
≥ndög_öãºu±_lock
);

204 
	}
}

206 
Æways_ölöe
 
vlib_¥o˚ss_t
 *

207 
	$vlib_gë_¥o˚ss_‰om_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
node
)

209 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

210 
	`ASSERT
 (
node
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
);

211  
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
node
->
ru¡ime_ödex
);

212 
	}
}

215 
Æways_ölöe
 
vlib_‰ame_t
 *

216 
	$vlib_gë_‰ame_no_check
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
‰ame_ödex
)

218 
vlib_‰ame_t
 *
f
;

219 
f
 = 
vm
->
hóp_ba£
 + (
‰ame_ödex
 * 
VLIB_FRAME_ALIGN
);

220  
f
;

221 
	}
}

223 
Æways_ölöe
 
u32


224 
	$vlib_‰ame_ödex_no_check
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_t
 * 
f
)

226 
uw‹d
 
i
;

228 
	`ASSERT
 (((
uw‹d
Ë
f
 & (
VLIB_FRAME_ALIGN
 - 1)) == 0);

230 
i
 = ((
u8
 *Ë
f
 - (u8 *Ë
vm
->
hóp_ba£
);

231 
	`ASSERT
 ((
i
 / 
VLIB_FRAME_ALIGN
) <= 0xFFFFFFFFULL);

233  
i
 / 
VLIB_FRAME_ALIGN
;

234 
	}
}

236 
Æways_ölöe
 
vlib_‰ame_t
 *

237 
	$vlib_gë_‰ame
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
‰ame_ödex
)

239 
vlib_‰ame_t
 *
f
 = 
	`vlib_gë_‰ame_no_check
 (
vm
, 
‰ame_ödex
);

240 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
);

241  
f
;

242 
	}
}

244 
Æways_ölöe
 
u32


245 
	$vlib_‰ame_ödex
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_t
 * 
f
)

247 
uw‹d
 
i
 = 
	`vlib_‰ame_ödex_no_check
 (
vm
, 
f
);

248 
	`ASSERT
 (
	`vlib_gë_‰ame
 (
vm
, 
i
Ë=
f
);

249  
i
;

250 
	}
}

253 
	#VLIB_FRAME_VECTOR_ALIGN
 (1 << 4)

	)

255 
Æways_ölöe
 
u32


256 
	$vlib_‰ame_ve˘‹_byã_off£t
 (
u32
 
sˇœr_size
)

258  
	`round_pow2
 ( (
vlib_‰ame_t
Ë+ 
sˇœr_size
,

259 
VLIB_FRAME_VECTOR_ALIGN
);

260 
	}
}

266 
Æways_ölöe
 *

267 
	$vlib_‰ame_ve˘‹_¨gs
 (
vlib_‰ame_t
 * 
f
)

269  (*Ë
f
 + 
	`vlib_‰ame_ve˘‹_byã_off£t
 (f->
sˇœr_size
);

270 
	}
}

283 
Æways_ölöe
 *

284 
	$vlib_‰ame_¨gs
 (
vlib_‰ame_t
 * 
f
)

286  
	`vlib_‰ame_ve˘‹_¨gs
 (
f
Ë- f->
sˇœr_size
;

287 
	}
}

289 
Æways_ölöe
 
vlib_√xt_‰ame_t
 *

290 
	$vlib_node_ru¡ime_gë_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

291 
vlib_node_ru¡ime_t
 * 
n
, 
u32
 
√xt_ödex
)

293 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

294 
vlib_√xt_‰ame_t
 *
nf
;

296 
	`ASSERT
 (
√xt_ödex
 < 
n
->
n_√xt_nodes
);

297 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
n
->
√xt_‰ame_ödex
 + 
√xt_ödex
);

299 i‡(
CLIB_DEBUG
 > 0)

301 
vlib_node_t
 *
node
, *
√xt
;

302 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
n
->
node_ödex
);

303 
√xt
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node
->
√xt_nodes
[
√xt_ödex
]);

304 
	`ASSERT
 (
nf
->
node_ru¡ime_ödex
 =
√xt
->
ru¡ime_ödex
);

307  
nf
;

308 
	}
}

324 
Æways_ölöe
 
vlib_√xt_‰ame_t
 *

325 
	$vlib_node_gë_√xt_‰ame
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, u32 
√xt_ödex
)

327 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

328 
vlib_node_t
 *
n
;

329 
vlib_node_ru¡ime_t
 *
r
;

331 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

332 
r
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

333  
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

334 
	}
}

336 
vlib_‰ame_t
 *
vlib_gë_√xt_‰ame_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

337 
vlib_node_ru¡ime_t
 * 
node
,

338 
u32
 
√xt_ödex
,

339 
u32
 
Æloc_√w_‰ame
);

341 
	#vlib_gë_√xt_‰ame_ma¸o
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
,
Æloc_√w_‰ame
) \

343 
vlib_‰ame_t
 * 
_f
 \

344 
	`vlib_gë_√xt_‰ame_öã∫Æ
 ((
vm
), (
node
), (
√xt_ödex
), \

345 (
Æloc_√w_‰ame
)); \

346 
u32
 
_n
 = 
_f
->
n_ve˘‹s
; \

347 (
ve˘‹s
Ë
	`vlib_‰ame_ve˘‹_¨gs
 (
_f
Ë+ 
_n
 *  ((vectors)[0]); \

348 (
n_ve˘‹s_À·
Ë
VLIB_FRAME_SIZE
 - 
_n
; \

349 } 0)

	)

364 
	#vlib_gë_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
) \

365 
	`vlib_gë_√xt_‰ame_ma¸o
 (
vm
, 
node
, 
√xt_ödex
, \

366 
ve˘‹s
, 
n_ve˘‹s_À·
, \

367  0)

	)

369 
	#vlib_gë_√w_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
) \

370 
	`vlib_gë_√xt_‰ame_ma¸o
 (
vm
, 
node
, 
√xt_ödex
, \

371 
ve˘‹s
, 
n_ve˘‹s_À·
, \

372  1)

	)

382 
vlib_put_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

383 
vlib_node_ru¡ime_t
 * 
r
,

384 
u32
 
√xt_ödex
, u32 
n_∑ckës_À·
);

387 
	#vlib_£t_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
v
) \

389 
uw‹d
 
_n_À·
; \

390 
	`vlib_gë_√xt_‰ame
 ((
vm
), (
node
), (
√xt_ödex
), (
v
), 
_n_À·
); \

391 
	`ASSERT
 (
_n_À·
 > 0); \

392 
	`vlib_put_√xt_‰ame
 ((
vm
), (
node
), (
√xt_ödex
), 
_n_À·
 - 1); \

393 (
v
); \

394 })

	)

396 
Æways_ölöe
 

397 
	$vlib_£t_√xt_‰ame_buf„r
 (
vlib_maö_t
 * 
vm
,

398 
vlib_node_ru¡ime_t
 * 
node
,

399 
u32
 
√xt_ödex
, u32 
buf„r_ödex
)

401 
u32
 *
p
;

402 
p
 = 
	`vlib_£t_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
,Ö);

403 
p
[0] = 
buf„r_ödex
;

404 
	}
}

406 
vlib_‰ame_t
 *
vlib_gë_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
);

407 
vlib_put_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
,

408 
vlib_‰ame_t
 * 
f
);

410 
Æways_ölöe
 
uw‹d


411 
	$vlib_ö_¥o˚ss_c⁄ãxt
 (
vlib_maö_t
 * 
vm
)

413  
vm
->
node_maö
.
cuºít_¥o˚ss_ödex
 != ~0;

414 
	}
}

416 
Æways_ölöe
 
vlib_¥o˚ss_t
 *

417 
	$vlib_gë_cuºít_¥o˚ss
 (
vlib_maö_t
 * 
vm
)

419 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

420 i‡(
	`vlib_ö_¥o˚ss_c⁄ãxt
 (
vm
))

421  
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

423 
	}
}

425 
Æways_ölöe
 
uw‹d


426 
	$vlib_cuºít_¥o˚ss
 (
vlib_maö_t
 * 
vm
)

428  
	`vlib_gë_cuºít_¥o˚ss
 (
vm
)->
node_ru¡ime
.
node_ödex
;

429 
	}
}

435 
Æways_ölöe
 
uw‹d


436 
	$vlib_¥o˚ss_su•íd_time_is_zîo
 (
f64
 
dt
)

438  
dt
 < 10e-6;

439 
	}
}

447 
Æways_ölöe
 
uw‹d


448 
	$vlib_¥o˚ss_su•íd
 (
vlib_maö_t
 * 
vm
, 
f64
 
dt
)

450 
uw‹d
 
r
;

451 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

452 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

454 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
))

455  
VLIB_PROCESS_RESUME_LONGJMP_RESUME
;

457 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
;

458 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

459 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

462 
p
->
ªsume_˛ock_öãrvÆ
 = 
dt
 * 1e5;

463 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

466  
r
;

467 
	}
}

469 
Æways_ölöe
 

470 
	$vlib_¥o˚ss_‰ì_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
,

471 
uw‹d
 
is_⁄e_time_evít
)

473 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

474 
	`poﬁ_put_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

475 i‡(
is_⁄e_time_evít
)

476 
p
->
⁄e_time_evít_ty≥_bôm≠
 =

477 
	`˛ib_bôm≠_™dnŸi
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
);

478 
	}
}

480 
Æways_ölöe
 

481 
	$vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
)

483 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

484 i‡(
	`˛ib_bôm≠_gë
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
))

485 
	`vlib_¥o˚ss_‰ì_evít_ty≥
 (
p
, 
t
, 1);

486 
	}
}

488 
Æways_ölöe
 *

489 
	$vlib_¥o˚ss_gë_evít_d©a
 (
vlib_maö_t
 * 
vm
,

490 
uw‹d
 * 
ªtu∫_evít_ty≥_›aque
)

492 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

493 
vlib_¥o˚ss_t
 *
p
;

494 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

495 
uw‹d
 
t
;

496 *
evít_d©a_ve˘‹
;

498 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

502 
t
 = 
	`˛ib_bôm≠_fú°_£t
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
);

503 i‡(
t
 == ~0)

506 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

507 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

509 
	`ASSERT
 (
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) > 0);

510 
evít_d©a_ve˘‹
 = 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
];

511 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
] = 0;

513 
ë
 = 
	`poﬁ_ñt_©_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

516 *
ªtu∫_evít_ty≥_›aque
 = 
ë
->
›aque
;

518 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

520  
evít_d©a_ve˘‹
;

521 
	}
}

525 
Æways_ölöe
 

526 
	$vlib_¥o˚ss_put_evít_d©a
 (
vlib_maö_t
 * 
vm
, *
evít_d©a
)

528 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

529 
	`vec_add1
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
, 
evít_d©a
);

530 
	}
}

541 
Æways_ölöe
 
uw‹d


542 
	$vlib_¥o˚ss_gë_evíts
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 ** 
d©a_ve˘‹
)

544 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

545 
vlib_¥o˚ss_t
 *
p
;

546 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

547 
uw‹d
 
r
, 
t
, 
l
;

549 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

553 
t
 = 
	`˛ib_bôm≠_fú°_£t
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
);

554 i‡(
t
 == ~0)

555  
t
;

557 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

558 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

560 
l
 = 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]);

561 i‡(
d©a_ve˘‹
)

562 
	`vec_add
 (*
d©a_ve˘‹
, 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
], 
l
);

563 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) = 0;

565 
ë
 = 
	`poﬁ_ñt_©_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

568 
r
 = 
ë
->
›aque
;

570 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

572  
r
;

573 
	}
}

575 
Æways_ölöe
 
uw‹d


576 
	$vlib_¥o˚ss_gë_evíts_hñ≥r
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
,

577 
uw‹d
 ** 
d©a_ve˘‹
)

579 
uw‹d
 
l
;

581 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

582 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

584 
l
 = 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]);

585 i‡(
d©a_ve˘‹
)

586 
	`vec_add
 (*
d©a_ve˘‹
, 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
], 
l
);

587 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) = 0;

589 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

591  
l
;

592 
	}
}

596 
Æways_ölöe
 
uw‹d


597 
	$vlib_¥o˚ss_gë_evíts_wôh_ty≥
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 ** 
d©a_ve˘‹
,

598 
uw‹d
 
wôh_ty≥_›aque
)

600 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

601 
vlib_¥o˚ss_t
 *
p
;

602 
uw‹d
 
t
, *
h
;

604 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

605 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

606 i‡(!
h
)

611 
t
 = 
h
[0];

612 i‡(!
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
))

615  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
t
, 
d©a_ve˘‹
);

616 
	}
}

618 
Æways_ölöe
 
uw‹d
 *

619 
	$vlib_¥o˚ss_waô_f‹_evít
 (
vlib_maö_t
 * 
vm
)

621 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

622 
vlib_¥o˚ss_t
 *
p
;

623 
uw‹d
 
r
;

625 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

626 i‡(
	`˛ib_bôm≠_is_zîo
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
))

628 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

629 
r
 =

630 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

631 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

632 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

633 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

636  
p
->
n⁄_em±y_evít_ty≥_bôm≠
;

637 
	}
}

639 
Æways_ölöe
 
uw‹d


640 
	$vlib_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

641 
uw‹d
 ** 
d©a_ve˘‹
,

642 
uw‹d
 
wôh_ty≥_ödex
)

644 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

645 
vlib_¥o˚ss_t
 *
p
;

646 
uw‹d
 
r
;

648 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

649 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
wôh_ty≥_ödex
));

650 !
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
wôh_ty≥_ödex
))

652 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

653 
r
 =

654 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

655 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

656 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

657 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

660  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
wôh_ty≥_ödex
, 
d©a_ve˘‹
);

661 
	}
}

663 
Æways_ölöe
 
uw‹d


664 
	$vlib_¥o˚ss_waô_f‹_evít_wôh_ty≥
 (
vlib_maö_t
 * 
vm
,

665 
uw‹d
 ** 
d©a_ve˘‹
,

666 
uw‹d
 
wôh_ty≥_›aque
)

668 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

669 
vlib_¥o˚ss_t
 *
p
;

670 
uw‹d
 
r
, *
h
;

672 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

673 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

674 !
h
 || !
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, h[0]))

676 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

677 
r
 =

678 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

679 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

680 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

681 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

684 i‡(!
h
)

685 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

688  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
h
[0], 
d©a_ve˘‹
);

689 
	}
}

698 
Æways_ölöe
 
f64


699 
	$vlib_¥o˚ss_waô_f‹_evít_‹_˛ock
 (
vlib_maö_t
 * 
vm
, 
f64
 
dt
)

701 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

702 
vlib_¥o˚ss_t
 *
p
;

703 
f64
 
wakeup_time
;

704 
uw‹d
 
r
;

706 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

708 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
)

709 || !
	`˛ib_bôm≠_is_zîo
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
))

710  
dt
;

712 
wakeup_time
 = 
	`vlib_time_now
 (
vm
Ë+ 
dt
;

715 
p
->
Êags
 |(
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT


716 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
);

718 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

719 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

721 
p
->
ªsume_˛ock_öãrvÆ
 = 
dt
 * 1e5;

722 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

727  
wakeup_time
 - 
	`vlib_time_now
 (
vm
);

728 
	}
}

730 
Æways_ölöe
 
vlib_¥o˚ss_evít_ty≥_t
 *

731 
	$vlib_¥o˚ss_√w_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
wôh_ty≥_›aque
)

733 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

734 
	`poﬁ_gë
 (
p
->
evít_ty≥_poﬁ
, 
ë
);

735 
ë
->
›aque
 = 
wôh_ty≥_›aque
;

736  
ë
;

737 
	}
}

739 
Æways_ölöe
 
uw‹d


740 
	$vlib_¥o˚ss_¸óã_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

741 
uw‹d
 
wôh_ty≥_›aque
)

743 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

744 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

745 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

746 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

747 
uw‹d
 
t
;

749 
ë
 = 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
wôh_ty≥_›aque
);

750 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

751 
p
->
⁄e_time_evít_ty≥_bôm≠
 =

752 
	`˛ib_bôm≠_‹i
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
);

753  
t
;

754 
	}
}

756 
Æways_ölöe
 

757 
	$vlib_¥o˚ss_dñëe_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

758 
uw‹d
 
t
)

760 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

761 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

762 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

764 
	`ASSERT
 (
	`˛ib_bôm≠_gë
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
));

765 
	`vlib_¥o˚ss_‰ì_evít_ty≥
 (
p
, 
t
, 1);

766 
	}
}

768 
Æways_ölöe
 *

769 
	$vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
vlib_node_maö_t
 * 
nm
,

770 
vlib_node_t
 * 
n
,

771 
vlib_¥o˚ss_t
 * 
p
,

772 
uw‹d
 
t
,

773 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

775 
uw‹d
 
p_Êags
, 
add_to_≥ndög
, 
dñëe_‰om_whìl
;

776 *
d©a_to_be_wrôãn_by_ˇŒî
;

778 
	`ASSERT
 (
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
);

780 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

782 
	`vec_vÆid©e
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
, 
t
);

786 *
d©a_vec
 = 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
];

787 
uw‹d
 
l
;

789 i‡(!
d©a_vec
 && 
	`vec_Àn
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
))

791 
d©a_vec
 = 
	`vec_p›
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
);

792 
	`_vec_Àn
 (
d©a_vec
) = 0;

795 
l
 = 
	`vec_Àn
 (
d©a_vec
);

797 
d©a_vec
 = 
	`_vec_ªsize
 (data_vec,

798  
n_d©a_ñts
,

800 (
l
 + 
n_d©a_ñts
Ë* 
n_d©a_ñt_byãs
,

803 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
] = 
d©a_vec
;

804 
d©a_to_be_wrôãn_by_ˇŒî
 = 
d©a_vec
 + 
l
 * 
n_d©a_ñt_byãs
;

807 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

808 
	`˛ib_bôm≠_‹i
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

810 
p_Êags
 = 
p
->
Êags
;

813 
add_to_≥ndög
 = (
p_Êags
 & 
VLIB_PROCESS_RESUME_PENDING
) == 0;

816 
dñëe_‰om_whìl
 = 0;

817 i‡(
p_Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
)

820 i‡(
p_Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
)

821 
dñëe_‰om_whìl
 = 1;

825 
add_to_≥ndög
 = 0;

830 
add_to_≥ndög
 &
nm
->
cuºít_¥o˚ss_ödex
 !
n
->
ru¡ime_ödex
;

832 i‡(
add_to_≥ndög
)

834 
u32
 
x
 = 
	`vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss
 (
n
->
ru¡ime_ödex
);

835 
p
->
Êags
 = 
p_Êags
 | 
VLIB_PROCESS_RESUME_PENDING
;

836 
	`vec_add1
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
, 
x
);

837 i‡(
dñëe_‰om_whìl
)

838 
	`TW
 (
tw_timî_°›
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

839 
p
->
°›_timî_h™dÀ
);

842  
d©a_to_be_wrôãn_by_ˇŒî
;

843 
	}
}

845 
Æways_ölöe
 *

846 
	$vlib_¥o˚ss_sig«l_evít_d©a
 (
vlib_maö_t
 * 
vm
,

847 
uw‹d
 
node_ödex
,

848 
uw‹d
 
ty≥_›aque
,

849 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

851 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

852 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

853 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

854 
uw‹d
 *
h
, 
t
;

857 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

859 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
);

860 i‡(!
h
)

862 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
 =

863 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
ty≥_›aque
);

864 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

865 
	`hash_£t
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
, 
t
);

868 
t
 = 
h
[0];

870  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
t
, 
n_d©a_ñts
,

871 
n_d©a_ñt_byãs
);

872 
	}
}

874 
Æways_ölöe
 *

875 
	$vlib_¥o˚ss_sig«l_evít_©_time
 (
vlib_maö_t
 * 
vm
,

876 
f64
 
dt
,

877 
uw‹d
 
node_ödex
,

878 
uw‹d
 
ty≥_›aque
,

879 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

881 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

882 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

883 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

884 
uw‹d
 *
h
, 
t
;

886 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
);

887 i‡(!
h
)

889 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
 =

890 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
ty≥_›aque
);

891 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

892 
	`hash_£t
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
, 
t
);

895 
t
 = 
h
[0];

897 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
))

898  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
t
, 
n_d©a_ñts
,

899 
n_d©a_ñt_byãs
);

902 
vlib_sig«l_timed_evít_d©a_t
 *
ã
;

904 
	`poﬁ_gë_Æig√d
 (
nm
->
sig«l_timed_evít_d©a_poﬁ
, 
ã
,  (te[0]));

906 
ã
->
n_d©a_ñts
 =Ç_data_elts;

907 
ã
->
n_d©a_ñt_byãs
 =Ç_data_elt_bytes;

908 
ã
->
n_d©a_byãs
 = 
n_d©a_ñts
 * 
n_d©a_ñt_byãs
;

911 
	`ASSERT
 (
ã
->
n_d©a_ñts
 ==Ç_data_elts);

912 
	`ASSERT
 (
ã
->
n_d©a_ñt_byãs
 ==Ç_data_elt_bytes);

913 
	`ASSERT
 (
ã
->
n_d©a_byãs
 =
n_d©a_ñts
 * 
n_d©a_ñt_byãs
);

915 
ã
->
¥o˚ss_node_ödex
 = 
n
->
ru¡ime_ödex
;

916 
ã
->
evít_ty≥_ödex
 = 
t
;

918 
p
->
°›_timî_h™dÀ
 =

919 
	`TW
 (
tw_timî_°¨t
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

920 
vlib_timög_whìl_d©a_£t_timed_evít


921 (
ã
 - 
nm
->
sig«l_timed_evít_d©a_poﬁ
),

923 (
	`vlib_time_now
 (
vm
Ë+ 
dt
) * 1e5);

926 i‡(
ã
->
n_d©a_byãs
 <  (ã->
ölöe_evít_d©a
))

927  
ã
->
ölöe_evít_d©a
;

930 
ã
->
evít_d©a_as_ve˘‹
 = 0;

931 
	`vec_ªsize
 (
ã
->
evít_d©a_as_ve˘‹
,Åe->
n_d©a_byãs
);

932  
ã
->
evít_d©a_as_ve˘‹
;

935 
	}
}

937 
Æways_ölöe
 *

938 
	$vlib_¥o˚ss_sig«l_⁄e_time_evít_d©a
 (
vlib_maö_t
 * 
vm
,

939 
uw‹d
 
node_ödex
,

940 
uw‹d
 
ty≥_ödex
,

941 
uw‹d
 
n_d©a_ñts
,

942 
uw‹d
 
n_d©a_ñt_byãs
)

944 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

945 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

946 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

947  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
ty≥_ödex
, 
n_d©a_ñts
,

948 
n_d©a_ñt_byãs
);

949 
	}
}

951 
Æways_ölöe
 

952 
	$vlib_¥o˚ss_sig«l_evít
 (
vlib_maö_t
 * 
vm
,

953 
uw‹d
 
node_ödex
, uw‹d 
ty≥_›aque
, uw‹d 
d©a
)

955 
uw‹d
 *
d
 = 
	`vlib_¥o˚ss_sig«l_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_›aque
,

956 1 ,  (
uw‹d
));

957 
d
[0] = 
d©a
;

958 
	}
}

960 
Æways_ölöe
 

961 
	$vlib_¥o˚ss_sig«l_evít_poöãr
 (
vlib_maö_t
 * 
vm
,

962 
uw‹d
 
node_ödex
,

963 
uw‹d
 
ty≥_›aque
, *
d©a
)

965 **
d
 = 
	`vlib_¥o˚ss_sig«l_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_›aque
,

966 1 ,  (
d©a
));

967 
d
[0] = 
d©a
;

968 
	}
}

975 
Æways_ölöe
 

976 
	$vlib_¥o˚ss_sig«l_evít_mt
 (
vlib_maö_t
 * 
vm
,

977 
uw‹d
 
node_ödex
, uw‹d 
ty≥_›aque
, uw‹d 
d©a
)

979 i‡(
	`vlib_gë_thªad_ödex
 () != 0)

981 
vlib_¥o˚ss_sig«l_evít_mt_¨gs_t
 
¨gs
 = {

982 .
node_ödex
 =Çode_index,

983 .
ty≥_›aque
 =Åype_opaque,

984 .
d©a
 = data,

986 
	`vlib_Ωc_ˇŒ_maö_thªad
 (
vlib_¥o˚ss_sig«l_evít_mt_hñ≥r
,

987 (
u8
 *Ë& 
¨gs
,  (args));

990 
	`vlib_¥o˚ss_sig«l_evít
 (
vm
, 
node_ödex
, 
ty≥_›aque
, 
d©a
);

991 
	}
}

993 
Æways_ölöe
 

994 
	$vlib_¥o˚ss_sig«l_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

995 
uw‹d
 
node_ödex
,

996 
uw‹d
 
ty≥_ödex
, uw‹d 
d©a
)

998 
uw‹d
 *
d
 =

999 
	`vlib_¥o˚ss_sig«l_⁄e_time_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_ödex
,

1000 1 ,  (
uw‹d
));

1001 
d
[0] = 
d©a
;

1002 
	}
}

1004 
Æways_ölöe
 

1005 
	$vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1006 
vlib_⁄e_time_waôög_¥o˚ss_t
 * 
p
)

1008 
	`vlib_¥o˚ss_sig«l_⁄e_time_evít
 (
vm
, 
p
->
node_ödex
,Ö->
⁄e_time_evít
,

1010 
	`mem£t
 (
p
, ~0,  (p[0]));

1011 
	}
}

1013 
Æways_ölöe
 

1014 
	$vlib_sig«l_⁄e_time_waôög_¥o˚ss_ve˘‹
 (
vlib_maö_t
 * 
vm
,

1015 
vlib_⁄e_time_waôög_¥o˚ss_t


1016 ** 
wps
)

1018 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
;

1019 
	`vec_f‹óch
 (
wp
, *
wps
Ë
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vm
, wp);

1020 
	`vec_‰ì
 (*
wps
);

1021 
	}
}

1023 
Æways_ölöe
 

1024 
	$vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

1025 
vlib_⁄e_time_waôög_¥o˚ss_t


1026 * 
p
)

1028 
p
->
node_ödex
 = 
	`vlib_cuºít_¥o˚ss
 (
vm
);

1029 
p
->
⁄e_time_evít
 = 
	`vlib_¥o˚ss_¸óã_⁄e_time_evít
 (
vm
,Ö->
node_ödex
,

1031 
	`vlib_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
,

1033 
p
->
⁄e_time_evít
);

1034 
	}
}

1036 
Æways_ölöe
 

1037 
	$vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹
 (
vlib_maö_t
 * 
vm
,

1038 
vlib_⁄e_time_waôög_¥o˚ss_t


1039 ** 
wps
)

1041 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
;

1042 
	`vec_add2
 (*
wps
, 
wp
, 1);

1043 
	`vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
, 
wp
);

1044 
	}
}

1046 
Æways_ölöe
 
u32


1047 
	$vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vlib_maö_t
 * 
vm
,

1048 
vlib_node_ru¡ime_t
 * 
node
,

1049 
uw‹d
 
n_ve˘‹s
)

1051 
u32
 
i
, 
d
, 
vi0
, 
vi1
;

1052 
u32
 
i0
, 
i1
;

1054 
	`ASSERT
 (
	`is_pow2
 (
	`ARRAY_LEN
 (
node
->
maö_lo›_ve˘‹_°©s
)));

1055 
i
 = ((
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)

1056 & (
	`ARRAY_LEN
 (
node
->
maö_lo›_ve˘‹_°©s
) - 1));

1057 
i0
 = 
i
 ^ 0;

1058 
i1
 = 
i
 ^ 1;

1059 
d
 = ((
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)

1061 (
node
->
maö_lo›_cou¡_œ°_di•©ch
 >>

1062 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
));

1063 
vi0
 = 
node
->
maö_lo›_ve˘‹_°©s
[
i0
];

1064 
vi1
 = 
node
->
maö_lo›_ve˘‹_°©s
[
i1
];

1065 
vi0
 = 
d
 == 0 ? vi0 : 0;

1066 
vi1
 = 
d
 <= 1 ? vi1 : 0;

1067 
vi0
 +
n_ve˘‹s
;

1068 
node
->
maö_lo›_ve˘‹_°©s
[
i0
] = 
vi0
;

1069 
node
->
maö_lo›_ve˘‹_°©s
[
i1
] = 
vi1
;

1070 
node
->
maö_lo›_cou¡_œ°_di•©ch
 = 
vm
->
maö_lo›_cou¡
;

1072  
node
->
maö_lo›_ve˘‹_°©s
[
i1
];

1073 
	}
}

1075 
Æways_ölöe
 
f64


1076 
	$vlib_node_ve˘‹s_≥r_maö_lo›_as_Êﬂt
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

1078 
vlib_node_ru¡ime_t
 *
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

1079 
u32
 
v
;

1081 
v
 = 
	`vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vm
, 
π
,

1083  (
f64
Ë
v
 / (1 << 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
);

1084 
	}
}

1086 
Æways_ölöe
 
u32


1087 
	$vlib_node_ve˘‹s_≥r_maö_lo›_as_öãgî
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

1089 
vlib_node_ru¡ime_t
 *
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

1090 
u32
 
v
;

1092 
v
 = 
	`vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vm
, 
π
,

1094  
v
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

1095 
	}
}

1098 
vlib_‰ame_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
r
, 
vlib_‰ame_t
 * 
f
);

1101 
uw‹d
 
vlib_node_gë_√xt
 (
vlib_maö_t
 * 
vm
, uw‹d 
node
, uw‹d 
√xt_node
);

1104 
uw‹d


1105 
vlib_node_add_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

1106 
uw‹d
 
node
, uw‹d 
√xt_node
, uw‹d 
¶Ÿ
);

1109 
Æways_ölöe
 
uw‹d


1110 
	$vlib_node_add_√xt
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node
, uw‹d 
√xt_node
)

1112  
	`vlib_node_add_√xt_wôh_¶Ÿ
 (
vm
, 
node
, 
√xt_node
, ~0);

1113 
	}
}

1116 
uw‹d


1117 
vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

1118 
uw‹d
 
node
, *
√xt_«me
, uw‹d 
¶Ÿ
);

1121 
Æways_ölöe
 
uw‹d


1122 
	$vlib_node_add_«med_√xt
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node
, *
«me
)

1124  
	`vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vm
, 
node
, 
«me
, ~0);

1125 
	}
}

1130 
vlib_node_t
 ***
vlib_node_gë_nodes
 (
vlib_maö_t
 * 
vm
, 
u32
 
max_thªads
,

1131 
ö˛ude_°©s
);

1134 
vlib_node_t
 *
vlib_gë_node_by_«me
 (
vlib_maö_t
 * 
vm
, 
u8
 * 
«me
);

1137 
vlib_node_ª«me
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, *
fmt
, ...);

1142 
u32
 
vlib_ªgi°î_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ªgi°øti⁄_t
 * 
r
);

1145 
vlib_ªgi°î_Æl_°©ic_nodes
 (
vlib_maö_t
 * 
vm
);

1148 
vlib_°¨t_¥o˚ss
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
¥o˚ss_ödex
);

1151 
vlib_node_sync_°©s
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
n
);

1154 
˛ib_îr‹_t
 *
vlib_node_maö_öô
 (
vlib_maö_t
 * 
vm
);

1156 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_gøph
;

1157 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_«me
;

1158 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_√xt_node_«me
;

1159 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_™d_√xt
;

1160 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_˝u_time
;

1161 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_time
;

1163 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_vlib_node
;

1165 
Æways_ölöe
 

1166 
	$vlib_node_ö¸emít_cou¡î
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

1167 
u32
 
cou¡î_ödex
, 
u64
 
ö¸emít
)

1169 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

1170 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

1171 
u32
 
node_cou¡î_ba£_ödex
 = 
n
->
îr‹_hóp_ödex
;

1172 
em
->
cou¡îs
[
node_cou¡î_ba£_ödex
 + 
cou¡î_ödex
] +
ö¸emít
;

1173 
	}
}

	@parse.h

15 #i‚de‡
ö˛uded_vlib_∑r£_h


16 
	#ö˛uded_vlib_∑r£_h


	)

18 
	~<vlib/vlib.h
>

19 
	~<vlib/Àx.h
>

20 
	~<vµö‰a/mhash.h
>

27 
u8
 
	mas_u8
[32 - 1 *  (
u16
)];

28 *
	mas_poöãr
;

29 
uw‹d
 
	mas_uw‹d
;

30 
w‹d
 
	mas_w‹d
;

31 
u64
 
	mas_u64
;

32 } 
	mvÆue
;

35 
u16
 
	mty≥
;

36 } 
	t__©åibuã
 ((
	t∑cked
))

37 
	tvlib_∑r£_vÆue_t
;

42 
u32


43 
	mty≥
;

45 
u32


46 
	m‹igö
;

48 
u32


49 
	mhñp_ödex
;

54 
	mas_poöãr
;

55 
uw‹d


56 
	mas_uw‹d
;

57 } 
	mvÆue
;

58 } 
	tvlib_∑r£_ôem_t
;

63 
u32


64 
	môem
;

67 
u32


68 
	m≥î
;

71 
u32


72 
	mdì≥r
;

73 } 
	tvlib_∑r£_gøph_t
;

75 
	#f‹óch_∑r£_m©ch_ty≥
 \

76 
	`_
(
MATCH_DONE
) \

77 
	`_
(
MATCH_RULE
) \

78 
	`_
(
MATCH_FAIL
) \

79 
	`_
(
MATCH_FULL
) \

80 
	`_
(
MATCH_VALUE
) \

81 
	`_
(
MATCH_PARTIAL
) \

82 
	`_
(
MATCH_AMBIGUOUS
) \

83 
	`_
(
MATCH_EVAL_FAIL
)

	)

87 
	#_
(
a
Ë
VLIB_PARSE_
##a,

	)

88 
	mf‹óch_∑r£_m©ch_ty≥


89 #unde‡
_


90 } 
	tvlib_∑r£_m©ch_t
;

92 
	gvlib_∑r£_ty≥
;

93 
	gvlib_∑r£_maö
;

96 
	$vlib_∑r£_m©ch_t
 (
	tvlib_∑r£_m©ch_fun˘i⁄_t
)

97 (
	tvlib_∑r£_maö
 *,

98 
	tvlib_∑r£_ty≥
 *, 
	tvlib_Àx_tokí_t
 *, 
	tvlib_∑r£_vÆue_t
 *);

99 (
	tvlib_∑r£_vÆue_˛ónup_fun˘i⁄_t
Ë(
	tvlib_∑r£_vÆue_t


102 
	svlib_∑r£_ty≥


106 
«me
;

108 
vlib_∑r£_m©ch_fun˘i⁄_t
 *

109 
m©ch_fun˘i⁄
;

111 
vlib_∑r£_vÆue_˛ónup_fun˘i⁄_t
 *

112 
vÆue_˛ónup_fun˘i⁄
;

114 
f‹m©_fun˘i⁄_t
 *

115 
f‹m©_vÆue
;

117 
u32


118 
ruÀ_ödex
;

119 } 
	tvlib_∑r£_ty≥_t
;

124 
öôülizî
;

126 
eof_m©ch
;

128 
ruÀ_Àngth
;

129 } 
	t∑r£_ªgi°øti⁄_t
;

131 
	svlib_∑r£_maö


134 
vlib_∑r£_ôem_t
 *

135 
∑r£_ôems
;

136 
mhash_t


137 
∑r£_ôem_hash
;

140 
vlib_∑r£_gøph_t
 *

141 
∑r£_gøph
;

142 
u32


143 
roŸ_ödex
;

145 
u8
 *

146 
ªgi°î_öput
;

149 
vlib_∑r£_ty≥_t
 *

150 
∑r£_ty≥s
;

151 
uw‹d
 *

152 
∑r£_ty≥_by_«me_hash
;

155 
vlib_∑r£_vÆue_t
 *

156 
∑r£_vÆue
;

157 
u32
 *

158 
m©ch_ôems
;

161 
∑r£_ªgi°øti⁄_t
 **

162 
∑r£_ªgi°øti⁄s
;

165 
vlib_Àx_tokí_t
 *

166 
tokís
;

167 
u32


168 
cuºít_tokí_ödex
;

170 
vlib_Àx_maö_t
 *

171 
Àx_maö
;

172 
vlib_maö_t
 *

173 
vlib_maö
;

174 } 
	tvlib_∑r£_maö_t
;

176 
vlib_∑r£_maö_t


177 
vlib_∑r£_maö
;

180 
	$vlib_∑r£_m©ch_t
 (
	tvlib_∑r£_evÆ_fun˘i⁄_t
)

181 (
	tvlib_∑r£_maö_t
 *, 
	tvlib_∑r£_ôem_t
 *, 
	tvlib_∑r£_vÆue_t
 *);

183 
vlib_∑r£_m©ch_t


184 
	`vlib_∑r£_evÆ
 (
u8
 * 
öput
);

186 
f‹m©_fun˘i⁄_t
 
f‹m©_vlib_∑r£_vÆue
;

189 
vlib_∑r£_m©ch_fun˘i⁄_t
 
ruÀ_m©ch
, 
eof_m©ch
, 
w‹d_m©ch
,

190 
numbî_m©ch
;

192 
	#_PARSE_REGISTRATION_DATA
(
x
) \

193 
	`VLIB_ELF_SECTION_DATA
(
x
##
_ªgi°øti⁄
,
∑r£_ªgi°øti⁄_t
,
∑r£_ªgi°øti⁄s
)

	)

195 
	#PARSE_INIT
(
x
, 
s
, 
e
) \

196 
	`_PARSE_REGISTRATION_DATA
(
x
) = { \

197 .
öôülizî
 = 
s
, \

198 .
eof_m©ch
 = 
e
, \

199 
	}
};

	)

201 
	#_PARSE_TYPE_REGISTRATION_DATA
(
x
) \

202 
	`VLIB_ELF_SECTION_DATA
(
x
##
_ty≥_ªgi°øti⁄
,
vlib_∑r£_ty≥_t
, \

203 
∑r£_ty≥_ªgi°øti⁄s
)

	)

205 
	#PARSE_TYPE_INIT
(
n
, 
m
, 
c
, 
f
) \

206 
	`_PARSE_TYPE_REGISTRATION_DATA
(
n
) = { \

207 .
«me
 = #n, \

208 .
m©ch_fun˘i⁄
 = 
m
, \

209 .
vÆue_˛ónup_fun˘i⁄
 = 
c
, \

210 .
f‹m©_vÆue
 = 
f
, \

211 };

	)

	@pci/pci.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/pci/pci.h
>

42 
	~<vlib/unix/unix.h
>

44 
	~<sys/ty≥s.h
>

45 
	~<sys/°©.h
>

46 
	~<f˙é.h
>

47 
	~<dúít.h
>

48 
	~<sys/io˘l.h
>

49 
	~<√t/if.h
>

50 
	~<löux/ëhtoﬁ.h
>

51 
	~<löux/sockios.h
>

53 
vlib_pci_maö_t
 
	gpci_maö
;

55 
vlib_pci_devi˚_öfo_t
 * 
__©åibuã__
 ((
wók
))

56 
	$vlib_pci_gë_devi˚_öfo
 (
vlib_pci_addr_t
 * 
addr
, 
˛ib_îr‹_t
 ** 
îr‹
)

58 i‡(
îr‹
)

59 *
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unsupported");

61 
	}
}

63 
vlib_pci_addr_t
 * 
__©åibuã__
 ((
wók
)Ë
	$vlib_pci_gë_Æl_dev_addrs
 ()

66 
	}
}

68 
˛ib_îr‹_t
 *

69 
	$show_pci_‚
 (
vlib_maö_t
 * 
vm
,

70 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

72 
vlib_pci_addr_t
 *
addr
 = 0, *
addrs
;

73 
show_Æl
 = 0;

74 
u8
 *
s
 = 0;

76 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

78 i‡(
	`unf‹m©
 (
öput
, "all"))

79 
show_Æl
 = 1;

81  
	`˛ib_îr‹_ªtu∫
 (0, "unknown input `%U'",

82 
f‹m©_unf‹m©_îr‹
, 
öput
);

85 
	`vlib_˛i_ouçut
 (
vm
, "%-13s%-5s%-12s%-13s%-16s%-32s%s",

89 
addrs
 = 
	`vlib_pci_gë_Æl_dev_addrs
 ();

91 
	`vec_f‹óch
 (
addr
, 
addrs
)

93 
vlib_pci_devi˚_öfo_t
 *
d
;

94 
d
 = 
	`vlib_pci_gë_devi˚_öfo
 (
addr
, 0);

96 i‡(!
d
)

99 i‡(
d
->
devi˚_˛ass
 !
PCI_CLASS_NETWORK_ETHERNET
 && !
show_Æl
)

102 
	`vec_ª£t_Àngth
 (
s
);

103 i‡(
d
->
numa_node
 >= 0)

104 
s
 = 
	`f‹m©
 (s, " %d", 
d
->
numa_node
);

106 
	`vlib_˛i_ouçut
 (
vm
, "%-13U%-5v%04x:%04x %-13U%-16s%-32v%U",

107 
f‹m©_vlib_pci_addr
, 
addr
, 
s
,

108 
d
->
víd‹_id
, d->
devi˚_id
,

109 
f‹m©_vlib_pci_lök_•ìd
, 
d
,

110 
d
->
drivî_«me
 ? (*) d->driver_name : "",

111 
d
->
¥odu˘_«me
,

112 
f‹m©_vlib_pci_vpd
, 
d
->
vpd_r
, 0);

113 
	`vlib_pci_‰ì_devi˚_öfo
 (
d
);

117 
	`vec_‰ì
 (
s
);

118 
	`vec_‰ì
 (
addrs
);

120 
	}
}

122 
uw‹d


123 
	$unf‹m©_vlib_pci_addr
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

125 
vlib_pci_addr_t
 *
addr
 = 
	`va_¨g
 (*
¨gs
, vlib_pci_addr_t *);

126 
u32
 
x
[4];

128 i‡(!
	`unf‹m©
 (
öput
, "%x:%x:%x.%x", &
x
[0], &x[1], &x[2], &x[3]))

131 
addr
->
domaö
 = 
x
[0];

132 
addr
->
bus
 = 
x
[1];

133 
addr
->
¶Ÿ
 = 
x
[2];

134 
addr
->
fun˘i⁄
 = 
x
[3];

137 
	}
}

139 
u8
 *

140 
	$f‹m©_vlib_pci_addr
 (
u8
 * 
s
, 
va_li°
 * 
va
)

142 
vlib_pci_addr_t
 *
addr
 = 
	`va_¨g
 (*
va
, vlib_pci_addr_t *);

143  
	`f‹m©
 (
s
, "%04x:%02x:%02x.%x", 
addr
->
domaö
,áddr->
bus
,

144 
addr
->
¶Ÿ
,áddr->
fun˘i⁄
);

145 
	}
}

147 
u8
 *

148 
	$f‹m©_vlib_pci_lök_•ìd
 (
u8
 * 
s
, 
va_li°
 * 
va
)

150 
vlib_pci_devi˚_öfo_t
 *
d
 = 
	`va_¨g
 (*
va
, vlib_pci_device_info_t *);

151 
pcõ_c⁄fig_ªgs_t
 *
r
 =

152 
	`pci_c⁄fig_föd_ˇ∑bûôy
 (&
d
->
c⁄fig0
, 
PCI_CAP_ID_PCIE
);

153 
width
;

155 i‡(!
r
)

156  
	`f‹m©
 (
s
, "unknown");

158 
width
 = (
r
->
lök_°©us
 >> 4) & 0x3f;

160 i‡((
r
->
lök_°©us
 & 0xf) == 1)

161  
	`f‹m©
 (
s
, "2.5 GT/†x%u", 
width
);

162 i‡((
r
->
lök_°©us
 & 0xf) == 2)

163  
	`f‹m©
 (
s
, "5.0 GT/†x%u", 
width
);

164 i‡((
r
->
lök_°©us
 & 0xf) == 3)

165  
	`f‹m©
 (
s
, "8.0 GT/†x%u", 
width
);

166  
	`f‹m©
 (
s
, "unknown");

167 
	}
}

169 
u8
 *

170 
	$f‹m©_vlib_pci_vpd
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

172 
u8
 *
d©a
 = 
	`va_¨g
 (*
¨gs
, u8 *);

173 
u8
 *
id
 = 
	`va_¨g
 (*
¨gs
, u8 *);

174 
u32
 
ödít
 = 
	`f‹m©_gë_ödít
 (
s
);

175 *
°rög_ty≥s
[] = { "PN", "EC", "SN", "MN", 0 };

176 
uw‹d
 
p
 = 0;

177 
fú°_löe
 = 1;

179 i‡(
	`vec_Àn
 (
d©a
) < 3)

180  
s
;

182 
p
 + 3 < 
	`vec_Àn
 (
d©a
))

185 i‡(
d©a
[
p
] == 0 && data[p + 1] == 0)

186  
s
;

188 i‡(
p
 + 
d©a
[∞+ 2] > 
	`vec_Àn
 (data))

189  
s
;

191 i‡(
id
 == 0)

193 
is_°rög
 = 0;

194 **
c
 = 
°rög_ty≥s
;

196 
c
[0])

198 i‡(*(
u16
 *Ë& 
d©a
[
p
] =*(u16 *Ë
c
[0])

199 
is_°rög
 = 1;

200 
c
++;

203 i‡(
d©a
[
p
 + 2])

205 i‡(!
fú°_löe
)

206 
s
 = 
	`f‹m©
 (s, "\n%U", 
f‹m©_whôe_•a˚
, 
ödít
);

209 
fú°_löe
 = 0;

210 
s
 = 
	`f‹m©
 (s, " ");

213 
s
 = 
	`f‹m©
 (s, "%c%c: ", 
d©a
[
p
], data[p + 1]);

214 i‡(
is_°rög
)

215 
	`vec_add
 (
s
, 
d©a
 + 
p
 + 3, data[p + 2]);

218 
i
;

219 c⁄° 
max_byãs
 = 8;

220 
s
 = 
	`f‹m©
 (s, "0x");

221 
i
 = 0; i < 
	`˛ib_mö
 (
d©a
[
p
 + 2], 
max_byãs
); i++)

222 
s
 = 
	`f‹m©
 (s, " %02x", 
d©a
[
p
 + 3 + 
i
]);

224 i‡(
d©a
[
p
 + 2] > 
max_byãs
)

225 
s
 = 
	`f‹m©
 (s, " ...");

229 i‡(*(
u16
 *Ë& 
d©a
[
p
] =*(u16 *Ë
id
)

231 
	`vec_add
 (
s
, 
d©a
 + 
p
 + 3, data[p + 2]);

232  
s
;

235 
p
 +3 + 
d©a
[p + 2];

238  
s
;

239 
	}
}

243 
VLIB_CLI_COMMAND
 (
show_pci_comm™d
, ) = {

244 .
∑th
 = "showÖci",

245 .
	gsh‹t_hñp
 = "showÖci [all]",

246 .
	gfun˘i⁄
 = 
show_pci_‚
,

250 
˛ib_îr‹_t
 *

251 
	$pci_bus_öô
 (
vlib_maö_t
 * 
vm
)

253  
	`vlib_ˇŒ_öô_fun˘i⁄
 (
vm
, 
pci_bus_öô
);

254 
	}
}

256 
VLIB_INIT_FUNCTION
 (
pci_bus_öô
);

	@pci/pci.h

40 #i‚de‡
ö˛uded_vlib_pci_h


41 
	#ö˛uded_vlib_pci_h


	)

43 
	~<vlib/vlib.h
>

44 
	~<vlib/pci/pci_c⁄fig.h
>

47 
CLIB_PACKED
 (union

51 
u16
 
domaö
;

52 
u8
 
bus
;

53 
u8
 
¶Ÿ
: 5;

54 
u8
 
fun˘i⁄
:3;

56 
u32
 
as_u32
;

57 }Ë
	tvlib_pci_addr_t
;

60 
	svlib_pci_devi˚_öfo


63 
vlib_pci_addr_t
 
	maddr
;

66 
	mnuma_node
;

69 
u16
 
	mdevi˚_˛ass
;

70 
u16
 
	mvíd‹_id
;

71 
u16
 
	mdevi˚_id
;

74 
u8
 *
	m¥odu˘_«me
;

75 
u8
 *
	mvpd_r
;

76 
u8
 *
	mvpd_w
;

79 
u8
 *
	mdrivî_«me
;

84 
pci_c⁄fig_ty≥0_ªgs_t
 
	mc⁄fig0
;

85 
pci_c⁄fig_ty≥1_ªgs_t
 
	mc⁄fig1
;

86 
u8
 
	mc⁄fig_d©a
[256];

90 
	miommu_group
;

92 } 
	tvlib_pci_devi˚_öfo_t
;

94 
u32
 
	tvlib_pci_dev_h™dÀ_t
;

96 
vlib_pci_devi˚_öfo_t
 *
vlib_pci_gë_devi˚_öfo
 (
vlib_pci_addr_t
 * 
addr
,

97 
˛ib_îr‹_t
 ** 
îr‹
);

98 
vlib_pci_addr_t
 *
vlib_pci_gë_Æl_dev_addrs
 ();

99 
vlib_pci_addr_t
 *
vlib_pci_gë_addr
 (
vlib_pci_dev_h™dÀ_t
 
h
);

100 
uw‹d
 
vlib_pci_gë_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
);

101 
vlib_pci_£t_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
uw‹d
 
¥iv©e_d©a
);

103 
ölöe
 

104 
	$vlib_pci_‰ì_devi˚_öfo
 (
vlib_pci_devi˚_öfo_t
 * 
di
)

106 i‡(!
di
)

108 
	`vec_‰ì
 (
di
->
¥odu˘_«me
);

109 
	`vec_‰ì
 (
di
->
vpd_r
);

110 
	`vec_‰ì
 (
di
->
vpd_w
);

111 
	`vec_‰ì
 (
di
->
drivî_«me
);

112 
	`˛ib_mem_‰ì
 (
di
);

113 
	}
}

117 
u16
 
	mvíd‹_id
, 
	mdevi˚_id
;

118 } 
	tpci_devi˚_id_t
;

120 (
	tpci_ötx_h™dÀr_fun˘i⁄_t
Ë(
	tvlib_pci_dev_h™dÀ_t
 
	th™dÀ
);

121 (
	tpci_msix_h™dÀr_fun˘i⁄_t
Ë(
	tvlib_pci_dev_h™dÀ_t
 
	th™dÀ
,

122 
	tu16
 
	tlöe
);

124 
	s_pci_devi˚_ªgi°øti⁄


127 
˛ib_îr‹_t
 *(*
öô_fun˘i⁄
Ë(
vlib_maö_t
 * 
vm
,

128 
vlib_pci_dev_h™dÀ_t
 
h™dÀ
);

131 
pci_ötx_h™dÀr_fun˘i⁄_t
 *
öãºu±_h™dÀr
;

134 
_pci_devi˚_ªgi°øti⁄
 *
√xt_ªgi°øti⁄
;

137 
pci_devi˚_id_t
 
suµ‹ãd_devi˚s
[];

138 } 
	tpci_devi˚_ªgi°øti⁄_t
;

143 
vlib_maö_t
 *
vlib_maö
;

144 
pci_devi˚_ªgi°øti⁄_t
 *
pci_devi˚_ªgi°øti⁄s
;

145 } 
	tvlib_pci_maö_t
;

147 
vlib_pci_maö_t
 
pci_maö
;

149 
	#PCI_REGISTER_DEVICE
(
x
,...) \

150 
__VA_ARGS__
 
pci_devi˚_ªgi°øti⁄_t
 
x
; \

151 
__vlib_add_pci_devi˚_ªgi°øti⁄_
##
	`x
 () \

152 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

153 
__vlib_add_pci_devi˚_ªgi°øti⁄_
##
	`x
 () \

155 
vlib_pci_maö_t
 * 
pm
 = &
pci_maö
; \

156 
x
.
√xt_ªgi°øti⁄
 = 
pm
->
pci_devi˚_ªgi°øti⁄s
; \

157 
pm
->
pci_devi˚_ªgi°øti⁄s
 = &
x
; \

158 
	}
} \

159 
__VA_ARGS__
 
pci_devi˚_ªgi°øti⁄_t
 
x


	)

161 
˛ib_îr‹_t
 *
vlib_pci_böd_to_uio
 (
vlib_pci_addr_t
 * 
addr
,

162 *
uio_drivî_«me
);

165 
˛ib_îr‹_t
 *
vlib_pci_ªad_wrôe_c⁄fig
 (
vlib_pci_dev_h™dÀ_t
 
h™dÀ
,

166 
vlib_ªad_‹_wrôe_t
 
ªad_‹_wrôe
,

167 
uw‹d
 
addªss
,

168 *
d©a
, 
u32
 
n_byãs
);

170 
	#_
(
t
) \

171 
ölöe
 
˛ib_îr‹_t
 * \

172 
vlib_pci_ªad_c⁄fig_
##
	`t
 (
vlib_pci_dev_h™dÀ_t
 
h
, \

173 
uw‹d
 
addªss
, 
t
 * 
d©a
) \

175  
	`vlib_pci_ªad_wrôe_c⁄fig
 (
h
, 
VLIB_READ
,
addªss
, 
d©a
, \

176  (
d©a
[0])); \

177 }

	)

179 
_
(
u32
);

180 
_
(
u16
);

181 
_
(
u8
);

183 #unde‡
_


185 
	#_
(
t
) \

186 
ölöe
 
˛ib_îr‹_t
 * \

187 
vlib_pci_wrôe_c⁄fig_
##
	`t
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
uw‹d
 
addªss
, \

188 
t
 * 
d©a
) \

190  
	`vlib_pci_ªad_wrôe_c⁄fig
 (
h
, 
VLIB_WRITE
, \

191 
addªss
, 
d©a
,  (data[0])); \

192 }

	)

194 
_
(
u32
);

195 
_
(
u16
);

196 
_
(
u8
);

198 #unde‡
_


200 
ölöe
 
˛ib_îr‹_t
 *

201 
	$vlib_pci_öå_íabÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

203 
u16
 
comm™d
;

204 
˛ib_îr‹_t
 *
îr
;

206 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

208 i‡(
îr
)

209  
îr
;

211 
comm™d
 &~
PCI_COMMAND_INTX_DISABLE
;

213  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

214 
	}
}

216 
ölöe
 
˛ib_îr‹_t
 *

217 
	$vlib_pci_öå_dißbÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

219 
u16
 
comm™d
;

220 
˛ib_îr‹_t
 *
îr
;

222 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

224 i‡(
îr
)

225  
îr
;

227 
comm™d
 |
PCI_COMMAND_INTX_DISABLE
;

229  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

230 
	}
}

232 
ölöe
 
˛ib_îr‹_t
 *

233 
	$vlib_pci_bus_ma°î_íabÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

235 
˛ib_îr‹_t
 *
îr
;

236 
u16
 
comm™d
;

239 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

241 i‡(
îr
)

242  
îr
;

244 i‡(
comm™d
 & 
PCI_COMMAND_BUS_MASTER
)

247 
comm™d
 |
PCI_COMMAND_BUS_MASTER
;

249  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

250 
	}
}

252 
˛ib_îr‹_t
 *
vlib_pci_devi˚_›í
 (
vlib_pci_addr_t
 * 
addr
,

253 
pci_devi˚_id_t
 
ids
[],

254 
vlib_pci_dev_h™dÀ_t
 * 
h™dÀ
);

255 
vlib_pci_devi˚_˛o£
 (
vlib_pci_dev_h™dÀ_t
 
h
);

257 
˛ib_îr‹_t
 *
vlib_pci_m≠_ªgi⁄
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u32
 
ªsour˚
,

258 **
ªsu…
);

260 
˛ib_îr‹_t
 *
vlib_pci_m≠_ªgi⁄_fixed
 (
vlib_pci_dev_h™dÀ_t
 
h
,

261 
u32
 
ªsour˚
, 
u8
 * 
addr
,

262 **
ªsu…
);

264 
˛ib_îr‹_t
 *
vlib_pci_ªgi°î_ötx_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
,

265 
pci_ötx_h™dÀr_fun˘i⁄_t
 *

266 
ötx_h™dÀr
);

267 
˛ib_îr‹_t
 *
vlib_pci_ªgi°î_msix_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
,

268 
u32
 
°¨t
, u32 
cou¡
,

269 
pci_msix_h™dÀr_fun˘i⁄_t
 *

270 
msix_h™dÀr
);

271 
˛ib_îr‹_t
 *
vlib_pci_íabÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
,

272 
u16
 
cou¡
);

273 
˛ib_îr‹_t
 *
vlib_pci_dißbÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
,

274 
u16
 
cou¡
);

276 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_vlib_pci_addr
;

277 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_addr
;

278 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_lök_•ìd
;

279 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_vpd
;

	@pci/pci_config.h

40 #i‚de‡
ö˛uded_vlib_pci_c⁄fig_h


41 
	#ö˛uded_vlib_pci_c⁄fig_h


	)

43 
	~<vµö‰a/byã_‹dî.h
>

44 
	~<vµö‰a/îr‹.h
>

48 
	mPCI_CLASS_NOT_DEFINED
 = 0x0000,

49 
	mPCI_CLASS_NOT_DEFINED_VGA
 = 0x0001,

51 
	mPCI_CLASS_STORAGE_SCSI
 = 0x0100,

52 
	mPCI_CLASS_STORAGE_IDE
 = 0x0101,

53 
	mPCI_CLASS_STORAGE_FLOPPY
 = 0x0102,

54 
	mPCI_CLASS_STORAGE_IPI
 = 0x0103,

55 
	mPCI_CLASS_STORAGE_RAID
 = 0x0104,

56 
	mPCI_CLASS_STORAGE_OTHER
 = 0x0180,

57 
	mPCI_CLASS_STORAGE
 = 0x0100,

59 
	mPCI_CLASS_NETWORK_ETHERNET
 = 0x0200,

60 
	mPCI_CLASS_NETWORK_TOKEN_RING
 = 0x0201,

61 
	mPCI_CLASS_NETWORK_FDDI
 = 0x0202,

62 
	mPCI_CLASS_NETWORK_ATM
 = 0x0203,

63 
	mPCI_CLASS_NETWORK_OTHER
 = 0x0280,

64 
	mPCI_CLASS_NETWORK
 = 0x0200,

66 
	mPCI_CLASS_DISPLAY_VGA
 = 0x0300,

67 
	mPCI_CLASS_DISPLAY_XGA
 = 0x0301,

68 
	mPCI_CLASS_DISPLAY_3D
 = 0x0302,

69 
	mPCI_CLASS_DISPLAY_OTHER
 = 0x0380,

70 
	mPCI_CLASS_DISPLAY
 = 0x0300,

72 
	mPCI_CLASS_MULTIMEDIA_VIDEO
 = 0x0400,

73 
	mPCI_CLASS_MULTIMEDIA_AUDIO
 = 0x0401,

74 
	mPCI_CLASS_MULTIMEDIA_PHONE
 = 0x0402,

75 
	mPCI_CLASS_MULTIMEDIA_OTHER
 = 0x0480,

76 
	mPCI_CLASS_MULTIMEDIA
 = 0x0400,

78 
	mPCI_CLASS_MEMORY_RAM
 = 0x0500,

79 
	mPCI_CLASS_MEMORY_FLASH
 = 0x0501,

80 
	mPCI_CLASS_MEMORY_OTHER
 = 0x0580,

81 
	mPCI_CLASS_MEMORY
 = 0x0500,

83 
	mPCI_CLASS_BRIDGE_HOST
 = 0x0600,

84 
	mPCI_CLASS_BRIDGE_ISA
 = 0x0601,

85 
	mPCI_CLASS_BRIDGE_EISA
 = 0x0602,

86 
	mPCI_CLASS_BRIDGE_MC
 = 0x0603,

87 
	mPCI_CLASS_BRIDGE_PCI
 = 0x0604,

88 
	mPCI_CLASS_BRIDGE_PCMCIA
 = 0x0605,

89 
	mPCI_CLASS_BRIDGE_NUBUS
 = 0x0606,

90 
	mPCI_CLASS_BRIDGE_CARDBUS
 = 0x0607,

91 
	mPCI_CLASS_BRIDGE_RACEWAY
 = 0x0608,

92 
	mPCI_CLASS_BRIDGE_OTHER
 = 0x0680,

93 
	mPCI_CLASS_BRIDGE
 = 0x0600,

95 
	mPCI_CLASS_COMMUNICATION_SERIAL
 = 0x0700,

96 
	mPCI_CLASS_COMMUNICATION_PARALLEL
 = 0x0701,

97 
	mPCI_CLASS_COMMUNICATION_MULTISERIAL
 = 0x0702,

98 
	mPCI_CLASS_COMMUNICATION_MODEM
 = 0x0703,

99 
	mPCI_CLASS_COMMUNICATION_OTHER
 = 0x0780,

100 
	mPCI_CLASS_COMMUNICATION
 = 0x0700,

102 
	mPCI_CLASS_SYSTEM_PIC
 = 0x0800,

103 
	mPCI_CLASS_SYSTEM_DMA
 = 0x0801,

104 
	mPCI_CLASS_SYSTEM_TIMER
 = 0x0802,

105 
	mPCI_CLASS_SYSTEM_RTC
 = 0x0803,

106 
	mPCI_CLASS_SYSTEM_PCI_HOTPLUG
 = 0x0804,

107 
	mPCI_CLASS_SYSTEM_OTHER
 = 0x0880,

108 
	mPCI_CLASS_SYSTEM
 = 0x0800,

110 
	mPCI_CLASS_INPUT_KEYBOARD
 = 0x0900,

111 
	mPCI_CLASS_INPUT_PEN
 = 0x0901,

112 
	mPCI_CLASS_INPUT_MOUSE
 = 0x0902,

113 
	mPCI_CLASS_INPUT_SCANNER
 = 0x0903,

114 
	mPCI_CLASS_INPUT_GAMEPORT
 = 0x0904,

115 
	mPCI_CLASS_INPUT_OTHER
 = 0x0980,

116 
	mPCI_CLASS_INPUT
 = 0x0900,

118 
	mPCI_CLASS_DOCKING_GENERIC
 = 0x0a00,

119 
	mPCI_CLASS_DOCKING_OTHER
 = 0x0a80,

120 
	mPCI_CLASS_DOCKING
 = 0x0a00,

122 
	mPCI_CLASS_PROCESSOR_386
 = 0x0b00,

123 
	mPCI_CLASS_PROCESSOR_486
 = 0x0b01,

124 
	mPCI_CLASS_PROCESSOR_PENTIUM
 = 0x0b02,

125 
	mPCI_CLASS_PROCESSOR_ALPHA
 = 0x0b10,

126 
	mPCI_CLASS_PROCESSOR_POWERPC
 = 0x0b20,

127 
	mPCI_CLASS_PROCESSOR_MIPS
 = 0x0b30,

128 
	mPCI_CLASS_PROCESSOR_CO
 = 0x0b40,

129 
	mPCI_CLASS_PROCESSOR
 = 0x0b00,

131 
	mPCI_CLASS_SERIAL_FIREWIRE
 = 0x0c00,

132 
	mPCI_CLASS_SERIAL_ACCESS
 = 0x0c01,

133 
	mPCI_CLASS_SERIAL_SSA
 = 0x0c02,

134 
	mPCI_CLASS_SERIAL_USB
 = 0x0c03,

135 
	mPCI_CLASS_SERIAL_FIBER
 = 0x0c04,

136 
	mPCI_CLASS_SERIAL_SMBUS
 = 0x0c05,

137 
	mPCI_CLASS_SERIAL
 = 0x0c00,

139 
	mPCI_CLASS_INTELLIGENT_I2O
 = 0x0e00,

140 
	mPCI_CLASS_INTELLIGENT
 = 0x0e00,

142 
	mPCI_CLASS_SATELLITE_TV
 = 0x0f00,

143 
	mPCI_CLASS_SATELLITE_AUDIO
 = 0x0f01,

144 
	mPCI_CLASS_SATELLITE_VOICE
 = 0x0f03,

145 
	mPCI_CLASS_SATELLITE_DATA
 = 0x0f04,

146 
	mPCI_CLASS_SATELLITE
 = 0x0f00,

148 
	mPCI_CLASS_CRYPT_NETWORK
 = 0x1000,

149 
	mPCI_CLASS_CRYPT_ENTERTAINMENT
 = 0x1001,

150 
	mPCI_CLASS_CRYPT_OTHER
 = 0x1080,

151 
	mPCI_CLASS_CRYPT
 = 0x1000,

153 
	mPCI_CLASS_SP_DPIO
 = 0x1100,

154 
	mPCI_CLASS_SP_OTHER
 = 0x1180,

155 
	mPCI_CLASS_SP
 = 0x1100,

156 } 
	tpci_devi˚_˛ass_t
;

158 
ölöe
 
pci_devi˚_˛ass_t


159 
	$pci_devi˚_˛ass_ba£
 (
pci_devi˚_˛ass_t
 
c
)

161  
c
 & ~0xff;

162 
	}
}

168 
	#VIRTIO_PCI_LEGACY_DEVICEID_NET
 0x1000

	)

169 
	#VIRTIO_PCI_MODERN_DEVICEID_NET
 0x1041

	)

177 
u16
 
	mvíd‹_id
;

178 
u16
 
	mdevi˚_id
;

180 
u16
 
	mcomm™d
;

181 
	#PCI_COMMAND_IO
 (1 << 0Ë

	)

182 
	#PCI_COMMAND_MEMORY
 (1 << 1Ë

	)

183 
	#PCI_COMMAND_BUS_MASTER
 (1 << 2Ë

	)

184 
	#PCI_COMMAND_SPECIAL
 (1 << 3Ë

	)

185 
	#PCI_COMMAND_WRITE_INVALIDATE
 (1 << 4Ë

	)

186 
	#PCI_COMMAND_VGA_PALETTE_SNOOP
 (1 << 5)

	)

187 
	#PCI_COMMAND_PARITY
 (1 << 6)

	)

188 
	#PCI_COMMAND_WAIT
 (1 << 7Ë

	)

189 
	#PCI_COMMAND_SERR
 (1 << 8Ë

	)

190 
	#PCI_COMMAND_BACK_TO_BACK_WRITE
 (1 << 9)

	)

191 
	#PCI_COMMAND_INTX_DISABLE
 (1 << 10Ë

	)

193 
u16
 
	m°©us
;

194 
	#PCI_STATUS_INTX_PENDING
 (1 << 3)

	)

195 
	#PCI_STATUS_CAPABILITY_LIST
 (1 << 4)

	)

196 
	#PCI_STATUS_66MHZ
 (1 << 5Ë

	)

197 
	#PCI_STATUS_UDF
 (1 << 6Ë

	)

198 
	#PCI_STATUS_BACK_TO_BACK_WRITE
 (1 << 7Ë

	)

199 
	#PCI_STATUS_PARITY_ERROR
 (1 << 8Ë

	)

200 
	#PCI_STATUS_DEVSEL_GET
(
x
Ë((x >> 9Ë& 3Ë

	)

201 
	#PCI_STATUS_DEVSEL_FAST
 (0 << 9)

	)

202 
	#PCI_STATUS_DEVSEL_MEDIUM
 (1 << 9)

	)

203 
	#PCI_STATUS_DEVSEL_SLOW
 (2 << 9)

	)

204 
	#PCI_STATUS_SIG_TARGET_ABORT
 (1 << 11Ë

	)

205 
	#PCI_STATUS_REC_TARGET_ABORT
 (1 << 12Ë

	)

206 
	#PCI_STATUS_REC_MASTER_ABORT
 (1 << 13Ë

	)

207 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 (1 << 14Ë

	)

208 
	#PCI_STATUS_DETECTED_PARITY_ERROR
 (1 << 15)

	)

210 
u8
 
	mªvisi⁄_id
;

211 
u8
 
	m¥ogømmög_öãrÁ˚_˛ass
;

213 
pci_devi˚_˛ass_t
 
	mdevi˚_˛ass
:16;

215 
u8
 
	mˇche_size
;

216 
u8
 
	mœãncy_timî
;

218 
u8
 
	mhódî_ty≥
;

219 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

220 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

221 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

223 
u8
 
	mbi°
;

224 
	#PCI_BIST_CODE_MASK
 0x0‡

	)

225 
	#PCI_BIST_START
 0x40

	)

226 
	#PCI_BIST_CAPABLE
 0x80

	)

227 } 
	tpci_c⁄fig_hódî_t
;

230 
Æways_ölöe
 

231 
	$pci_c⁄fig_hódî_lôée_to_ho°
 (
pci_c⁄fig_hódî_t
 * 
r
)

233 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

235 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

236 
	`_
(
víd‹_id
, 
u16
);

237 
	`_
(
devi˚_id
, 
u16
);

238 
	`_
(
comm™d
, 
u16
);

239 
	`_
(
°©us
, 
u16
);

240 
	`_
(
devi˚_˛ass
, 
u16
);

241 #unde‡
_


242 
	}
}

247 
pci_c⁄fig_hódî_t
 
	mhódî
;

255 
u32
 
	mba£_addªss
[6];

257 
u16
 
	mˇrdbus_cis
;

259 
u16
 
	msubsy°em_víd‹_id
;

260 
u16
 
	msubsy°em_id
;

262 
u32
 
	mrom_addªss
;

263 
	#PCI_ROM_ADDRESS
 0x30

	)

264 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

265 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffUL)

	)

267 
u8
 
	mfú°_ˇ∑bûôy_off£t
;

268 
CLIB_PAD_FROM_TO
 (0x35, 0x3c);

270 
u8
 
	möãºu±_löe
;

271 
u8
 
	möãºu±_pö
;

272 
u8
 
	mmö_gø¡
;

273 
u8
 
	mmax_œãncy
;

275 
u8
 
	mˇ∑bûôy_d©a
[0];

276 } 
	tpci_c⁄fig_ty≥0_ªgs_t
;

278 
Æways_ölöe
 

279 
	$pci_c⁄fig_ty≥0_lôée_to_ho°
 (
pci_c⁄fig_ty≥0_ªgs_t
 * 
r
)

281 
i
;

282 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

284 
	`pci_c⁄fig_hódî_lôée_to_ho°
 (&
r
->
hódî
);

285 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

286 
i
 = 0; i < 
	`ARRAY_LEN
 (
r
->
ba£_addªss
); i++)

287 
	`_
(
ba£_addªss
[
i
], 
u32
);

288 
	`_
(
ˇrdbus_cis
, 
u16
);

289 
	`_
(
subsy°em_víd‹_id
, 
u16
);

290 
	`_
(
subsy°em_id
, 
u16
);

291 
	`_
(
rom_addªss
, 
u32
);

292 #unde‡
_


293 
	}
}

298 
pci_c⁄fig_hódî_t
 
	mhódî
;

300 
u32
 
	mba£_addªss
[2];

303 
u8
 
	m¥im¨y_bus
;

304 
u8
 
	m£c⁄d¨y_bus
;

307 
u8
 
	msub‹dö©e_bus
;

309 
u8
 
	m£c⁄d¨y_bus_œãncy_timî
;

312 
u8
 
	mio_ba£
, 
	mio_limô
;

315 
u16
 
	m£c⁄d¨y_°©us
;

318 
u16
 
	mmem‹y_ba£
, 
	mmem‹y_limô
;

319 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

320 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

322 
u16
 
	m¥e„tchabÀ_mem‹y_ba£
, 
	m¥e„tchabÀ_mem‹y_limô
;

323 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

324 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

325 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

326 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

328 
u32
 
	m¥e„tchabÀ_mem‹y_ba£_uµî_32bôs
;

329 
u32
 
	m¥e„tchabÀ_mem‹y_limô_uµî_32bôs
;

330 
u16
 
	mio_ba£_uµî_16bôs
;

331 
u16
 
	mio_limô_uµî_16bôs
;

334 
u8
 
	mˇ∑bûôy_li°_off£t
;

335 
CLIB_PAD_FROM_TO
 (0x35, 0x37);

337 
u32
 
	mrom_addªss
;

338 
CLIB_PAD_FROM_TO
 (0x3c, 0x3e);

340 
u16
 
	mbridge_c⁄åﬁ
;

341 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

342 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

343 
	#PCI_BRIDGE_CTL_NO_ISA
 0x04

	)

344 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

345 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

346 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

347 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

349 
u8
 
	mˇ∑bûôy_d©a
[0];

350 } 
	tpci_c⁄fig_ty≥1_ªgs_t
;

352 
Æways_ölöe
 

353 
	$pci_c⁄fig_ty≥1_lôée_to_ho°
 (
pci_c⁄fig_ty≥1_ªgs_t
 * 
r
)

355 
i
;

356 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

358 
	`pci_c⁄fig_hódî_lôée_to_ho°
 (&
r
->
hódî
);

359 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

360 
i
 = 0; i < 
	`ARRAY_LEN
 (
r
->
ba£_addªss
); i++)

361 
	`_
(
ba£_addªss
[
i
], 
u32
);

362 
	`_
(
£c⁄d¨y_°©us
, 
u16
);

363 
	`_
(
mem‹y_ba£
, 
u16
);

364 
	`_
(
mem‹y_limô
, 
u16
);

365 
	`_
(
¥e„tchabÀ_mem‹y_ba£
, 
u16
);

366 
	`_
(
¥e„tchabÀ_mem‹y_limô
, 
u16
);

367 
	`_
(
¥e„tchabÀ_mem‹y_ba£_uµî_32bôs
, 
u32
);

368 
	`_
(
¥e„tchabÀ_mem‹y_limô_uµî_32bôs
, 
u32
);

369 
	`_
(
io_ba£_uµî_16bôs
, 
u16
);

370 
	`_
(
io_limô_uµî_16bôs
, 
u16
);

371 
	`_
(
rom_addªss
, 
u32
);

372 
	`_
(
bridge_c⁄åﬁ
, 
u16
);

373 #unde‡
_


374 
	}
}

377 
	epci_ˇ∑bûôy_ty≥


380 
	mPCI_CAP_ID_PM
 = 1,

383 
	mPCI_CAP_ID_AGP
 = 2,

386 
	mPCI_CAP_ID_VPD
 = 3,

389 
	mPCI_CAP_ID_SLOTID
 = 4,

392 
	mPCI_CAP_ID_MSI
 = 5,

395 
	mPCI_CAP_ID_CHSWP
 = 6,

398 
	mPCI_CAP_ID_PCIX
 = 7,

401 
	mPCI_CAP_ID_HYPERTRANSPORT
 = 8,

404 
	mPCI_CAP_ID_SHPC
 = 0xc,

407 
	mPCI_CAP_ID_PCIE
 = 0x10,

410 
	mPCI_CAP_ID_MSIX
 = 0x11,

411 } 
	tpci_ˇ∑bûôy_ty≥_t
;

416 
pci_ˇ∑bûôy_ty≥
 
	mty≥
:8;

417 
u8
 
	m√xt_off£t
;

418 } 
	t__˛ib_∑cked
 
	tpci_ˇ∑bûôy_ªgs_t
;

420 
Æways_ölöe
 *

421 
	$pci_c⁄fig_föd_ˇ∑bûôy
 (
pci_c⁄fig_ty≥0_ªgs_t
 * 
t
, 
ˇp_ty≥
)

423 
pci_ˇ∑bûôy_ªgs_t
 *
c
;

424 
u32
 
√xt_off£t
;

425 
u32
 
âl
 = 48;

427 i‡(!(
t
->
hódî
.
°©us
 & 
PCI_STATUS_CAPABILITY_LIST
))

430 
√xt_off£t
 = 
t
->
fú°_ˇ∑bûôy_off£t
;

431 
âl
-- && 
√xt_off£t
 >= 0x40)

433 
c
 = (*Ë
t
 + (
√xt_off£t
 & ~3);

434 i‡((
u8
Ë
c
->
ty≥
 == 0xff)

436 i‡(
c
->
ty≥
 =
ˇp_ty≥
)

437  
c
;

438 
√xt_off£t
 = 
c
->next_offset;

441 
	}
}

446 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

447 
u16
 
	mˇ∑bûôõs
;

448 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

449 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

450 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

451 
	#PCI_PM_CAP_DSI
 0x0020

	)

452 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

453 
	#PCI_PM_CAP_D1
 0x0200

	)

454 
	#PCI_PM_CAP_D2
 0x0400

	)

455 
	#PCI_PM_CAP_PME
 0x0800

	)

456 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

457 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

458 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

459 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

460 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

461 
	#PCI_PM_CAP_PME_D3cﬁd
 0x8000

	)

462 
u16
 
	mc⁄åﬁ
;

463 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

464 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

465 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

466 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

467 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

468 
u8
 
	mexãnsi⁄s
;

469 
	#PCI_PM_PPB_B2_B3
 0x40

	)

470 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

471 
u8
 
	md©a
;

472 } 
	t__˛ib_∑cked
 
	tpci_powî_m™agemít_ªgs_t
;

477 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

478 
u8
 
	mvîsi⁄
;

479 
u8
 
	mª°_of_ˇ∑bûôy_Êags
;

480 
u32
 
	m°©us
;

481 
u32
 
	mcomm™d
;

483 
	#PCI_AGP_RQ_MASK
 0xff000000

	)

484 
	#PCI_AGP_SBA
 0x0200

	)

485 
	#PCI_AGP_64BIT
 0x0020

	)

486 
	#PCI_AGP_ALLOW_TRANSACTIONS
 0x0100

	)

487 
	#PCI_AGP_FW
 0x0010

	)

488 
	#PCI_AGP_RATE4
 0x0004

	)

489 
	#PCI_AGP_RATE2
 0x0002

	)

490 
	#PCI_AGP_RATE1
 0x0001

	)

491 } 
	t__˛ib_∑cked
 
	tpci_agp_ªgs_t
;

496 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

497 
u16
 
	maddªss
;

498 
	#PCI_VPD_ADDR_MASK
 0x7ff‡

	)

499 
	#PCI_VPD_ADDR_F
 0x8000

	)

500 
u32
 
	md©a
;

501 } 
	t__˛ib_∑cked
 
	tpci_vpd_ªgs_t
;

506 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

507 
u8
 
	me§
;

508 
	#PCI_SID_ESR_NSLOTS
 0x1‡

	)

509 
	#PCI_SID_ESR_FIC
 0x20

	)

510 
u8
 
	mchassis
;

511 } 
	t__˛ib_∑cked
 
	tpci_sid_ªgs_t
;

516 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

517 
u16
 
	mÊags
;

518 
	#PCI_MSI_FLAGS_ENABLE
 (1 << 0Ë

	)

519 
	#PCI_MSI_FLAGS_GET_MAX_QUEUE_SIZE
(
x
Ë((x >> 1Ë& 0x7)

	)

520 
	#PCI_MSI_FLAGS_MAX_QUEUE_SIZE
(
x
Ë(((xË& 0x7Ë<< 1)

	)

521 
	#PCI_MSI_FLAGS_GET_QUEUE_SIZE
(
x
Ë((x >> 4Ë& 0x7)

	)

522 
	#PCI_MSI_FLAGS_QUEUE_SIZE
(
x
Ë(((xË& 0x7Ë<< 4)

	)

523 
	#PCI_MSI_FLAGS_64BIT
 (1 << 7Ë

	)

524 
	#PCI_MSI_FLAGS_MASKBIT
 (1 << 8Ë

	)

525 
u32
 
	maddªss
;

526 
u32
 
	md©a
;

527 
u32
 
	mmask_bôs
;

528 } 
	t__˛ib_∑cked
 
	tpci_msi32_ªgs_t
;

532 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

533 
u16
 
	mÊags
;

534 
u32
 
	maddªss
[2];

535 
u32
 
	md©a
;

536 
u32
 
	mmask_bôs
;

537 } 
	t__˛ib_∑cked
 
	tpci_msi64_ªgs_t
;

542 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

543 
u16
 
	mc⁄åﬁ_°©us
;

544 
	#PCI_CHSWP_DHA
 0x01

	)

545 
	#PCI_CHSWP_EIM
 0x02

	)

546 
	#PCI_CHSWP_PIE
 0x04

	)

547 
	#PCI_CHSWP_LOO
 0x08

	)

548 
	#PCI_CHSWP_PI
 0x30

	)

549 
	#PCI_CHSWP_EXT
 0x40

	)

550 
	#PCI_CHSWP_INS
 0x80

	)

551 } 
	t__˛ib_∑cked
 
	tpci_chswp_ªgs_t
;

556 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

557 
u16
 
	mcomm™d
;

558 
	#PCIX_CMD_DPERR_E
 0x0001

	)

559 
	#PCIX_CMD_ERO
 0x0002

	)

560 
	#PCIX_CMD_MAX_READ
 0x000¯

	)

561 
	#PCIX_CMD_MAX_SPLIT
 0x0070

	)

562 
	#PCIX_CMD_VERSION
(
x
Ë(((xË>> 12Ë& 3Ë

	)

563 
u32
 
	m°©us
;

564 
	#PCIX_STATUS_DEVFN
 0x000000f‡

	)

565 
	#PCIX_STATUS_BUS
 0x0000ff00

	)

566 
	#PCIX_STATUS_64BIT
 0x00010000

	)

567 
	#PCIX_STATUS_133MHZ
 0x00020000

	)

568 
	#PCIX_STATUS_SPL_DISC
 0x00040000

	)

569 
	#PCIX_STATUS_UNX_SPL
 0x00080000

	)

570 
	#PCIX_STATUS_COMPLEX
 0x00100000

	)

571 
	#PCIX_STATUS_MAX_READ
 0x00600000

	)

572 
	#PCIX_STATUS_MAX_SPLIT
 0x03800000

	)

573 
	#PCIX_STATUS_MAX_CUM
 0x1c000000

	)

574 
	#PCIX_STATUS_SPL_ERR
 0x20000000

	)

575 
	#PCIX_STATUS_266MHZ
 0x40000000

	)

576 
	#PCIX_STATUS_533MHZ
 0x80000000

	)

577 } 
	t__˛ib_∑cked
 
	tpcix_c⁄fig_ªgs_t
;

579 
ölöe
 

580 
	$pcõ_size_to_code
 (
byãs
)

582 
	`ASSERT
 (
	`is_pow2
 (
byãs
));

583 
	`ASSERT
 (
byãs
 <= 4096);

584  
	`mö_log2
 (
byãs
) - 7;

585 
	}
}

587 
ölöe
 

588 
	$pcõ_code_to_size
 (
code
)

590 
size
 = 1 << (
code
 + 7);

591 
	`ASSERT
 (
size
 <= 4096);

592  
size
;

593 
	}
}

598 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

599 
u16
 
	mpcõ_ˇ∑bûôõs
;

600 
	#PCIE_CAP_VERSION
(
x
Ë(((xË>> 0Ë& 0xf)

	)

601 
	#PCIE_CAP_DEVICE_TYPE
(
x
Ë(((xË>> 4Ë& 0xf)

	)

602 
	#PCIE_DEVICE_TYPE_ENDPOINT
 0

	)

603 
	#PCIE_DEVICE_TYPE_LEGACY_ENDPOINT
 1

	)

604 
	#PCIE_DEVICE_TYPE_ROOT_PORT
 4

	)

606 
	#PCIE_DEVICE_TYPE_SWITCH_UPSTREAM
 5

	)

607 
	#PCIE_DEVICE_TYPE_SWITCH_DOWNSTREAM
 6

	)

608 
	#PCIE_DEVICE_TYPE_PCIE_TO_PCI_BRIDGE
 7

	)

609 
	#PCIE_DEVICE_TYPE_PCI_TO_PCIE_BRIDGE
 8

	)

611 
	#PCIE_DEVICE_TYPE_ROOT_COMPLEX_ENDPOINT
 9

	)

612 
	#PCIE_DEVICE_TYPE_ROOT_COMPLEX_EVENT_COLLECTOR
 10

	)

613 
	#PCIE_CAP_SLOW_IMPLEMENTED
 (1 << 8)

	)

614 
	#PCIE_CAP_MSI_IRQ
(
x
Ë(((xË>> 9Ë& 0x1f)

	)

615 
u32
 
	mdev_ˇ∑bûôõs
;

616 
	#PCIE_DEVCAP_MAX_PAYLOAD
(
x
Ë(128 << (((xË>> 0Ë& 0x7))

	)

617 
	#PCIE_DEVCAP_PHANTOM_BITS
(
x
Ë(((xË>> 3Ë& 0x3)

	)

618 
	#PCIE_DEVCAP_EXTENTED_TAG
 (1 << 5)

	)

619 
	#PCIE_DEVCAP_L0S
 0x1c0

	)

620 
	#PCIE_DEVCAP_L1
 0xe00

	)

621 
	#PCIE_DEVCAP_ATN_BUT
 0x1000

	)

622 
	#PCIE_DEVCAP_ATN_IND
 0x2000

	)

623 
	#PCIE_DEVCAP_PWR_IND
 0x4000

	)

624 
	#PCIE_DEVCAP_PWR_VAL
 0x3fc0000

	)

625 
	#PCIE_DEVCAP_PWR_SCL
 0xc000000

	)

626 
u16
 
	mdev_c⁄åﬁ
;

627 
	#PCIE_CTRL_CERE
 0x0001

	)

628 
	#PCIE_CTRL_NFERE
 0x0002

	)

629 
	#PCIE_CTRL_FERE
 0x0004

	)

630 
	#PCIE_CTRL_URRE
 0x0008

	)

631 
	#PCIE_CTRL_RELAX_EN
 0x0010

	)

632 
	#PCIE_CTRL_MAX_PAYLOAD
(
n
Ë((“Ë& 7Ë<< 5)

	)

633 
	#PCIE_CTRL_EXT_TAG
 0x0100

	)

634 
	#PCIE_CTRL_PHANTOM
 0x0200

	)

635 
	#PCIE_CTRL_AUX_PME
 0x0400

	)

636 
	#PCIE_CTRL_NOSNOOP_EN
 0x0800

	)

637 
	#PCIE_CTRL_MAX_READ_REQUEST
(
n
Ë((“Ë& 7Ë<< 12)

	)

638 
u16
 
	mdev_°©us
;

639 
	#PCIE_DEVSTA_AUXPD
 0x10

	)

640 
	#PCIE_DEVSTA_TRPND
 0x20

	)

641 
u32
 
	mlök_ˇ∑bûôõs
;

642 
u16
 
	mlök_c⁄åﬁ
;

643 
u16
 
	mlök_°©us
;

644 
u32
 
	m¶Ÿ_ˇ∑bûôõs
;

645 
u16
 
	m¶Ÿ_c⁄åﬁ
;

646 
u16
 
	m¶Ÿ_°©us
;

647 
u16
 
	mroŸ_c⁄åﬁ
;

648 
	#PCIE_RTCTL_SECEE
 0x01

	)

649 
	#PCIE_RTCTL_SENFEE
 0x02

	)

650 
	#PCIE_RTCTL_SEFEE
 0x04

	)

651 
	#PCIE_RTCTL_PMEIE
 0x08

	)

652 
	#PCIE_RTCTL_CRSSVE
 0x10

	)

653 
u16
 
	mroŸ_ˇ∑bûôõs
;

654 
u32
 
	mroŸ_°©us
;

655 
u32
 
	mdev_ˇ∑bûôõs2
;

656 
u16
 
	mdev_c⁄åﬁ2
;

657 
u16
 
	mdev_°©us2
;

658 
u32
 
	mlök_ˇ∑bûôõs2
;

659 
u16
 
	mlök_c⁄åﬁ2
;

660 
u16
 
	mlök_°©us2
;

661 
u32
 
	m¶Ÿ_ˇ∑bûôõs2
;

662 
u16
 
	m¶Ÿ_c⁄åﬁ2
;

663 
u16
 
	m¶Ÿ_°©us2
;

664 } 
	t__˛ib_∑cked
 
	tpcõ_c⁄fig_ªgs_t
;

667 
	epcõ_ˇ∑bûôy_ty≥


669 
	mPCIE_CAP_ADVANCED_ERROR
 = 1,

670 
	mPCIE_CAP_VC
 = 2,

671 
	mPCIE_CAP_DSN
 = 3,

672 
	mPCIE_CAP_PWR
 = 4,

673 } 
	tpcõ_ˇ∑bûôy_ty≥_t
;

678 
pcõ_ˇ∑bûôy_ty≥
 
	mty≥
:16;

679 
u16
 
	mvîsi⁄
:4;

680 
u16
 
	m√xt_ˇ∑bûôy
:12;

681 } 
	t__˛ib_∑cked
 
	tpcõ_ˇ∑bûôy_ªgs_t
;

685 
pcõ_ˇ∑bûôy_ªgs_t
 
	mhódî
;

686 
u32
 
	munc‹ª˘abÀ_°©us
;

687 
	#PCIE_ERROR_UNC_LINK_TRAINING
 (1 << 0)

	)

688 
	#PCIE_ERROR_UNC_DATA_LINK_PROTOCOL
 (1 << 4)

	)

689 
	#PCIE_ERROR_UNC_SURPRISE_DOWN
 (1 << 5)

	)

690 
	#PCIE_ERROR_UNC_POISONED_TLP
 (1 << 12)

	)

691 
	#PCIE_ERROR_UNC_FLOW_CONTROL
 (1 << 13)

	)

692 
	#PCIE_ERROR_UNC_COMPLETION_TIMEOUT
 (1 << 14)

	)

693 
	#PCIE_ERROR_UNC_COMPLETER_ABORT
 (1 << 15)

	)

694 
	#PCIE_ERROR_UNC_UNEXPECTED_COMPLETION
 (1 << 16)

	)

695 
	#PCIE_ERROR_UNC_RX_OVERFLOW
 (1 << 17)

	)

696 
	#PCIE_ERROR_UNC_MALFORMED_TLP
 (1 << 18)

	)

697 
	#PCIE_ERROR_UNC_CRC_ERROR
 (1 << 19)

	)

698 
	#PCIE_ERROR_UNC_UNSUPPORTED_REQUEST
 (1 << 20)

	)

699 
u32
 
	munc‹ª˘abÀ_mask
;

700 
u32
 
	munc‹ª˘abÀ_£vîôy
;

701 
u32
 
	mc‹ª˘abÀ_°©us
;

702 
	#PCIE_ERROR_COR_RX_ERROR
 (1 << 0)

	)

703 
	#PCIE_ERROR_COR_BAD_TLP
 (1 << 6)

	)

704 
	#PCIE_ERROR_COR_BAD_DLLP
 (1 << 7)

	)

705 
	#PCIE_ERROR_COR_REPLAY_ROLLOVER
 (1 << 8)

	)

706 
	#PCIE_ERROR_COR_REPLAY_TIMER
 (1 << 12)

	)

707 
	#PCIE_ERROR_COR_ADVISORY
 (1 << 13)

	)

708 
u32
 
	mc‹ª˘abÀ_mask
;

709 
u32
 
	mc⁄åﬁ
;

710 
u32
 
	mlog
[4];

711 
u32
 
	mroŸ_comm™d
;

712 
u32
 
	mroŸ_°©us
;

713 
u16
 
	mc‹ª˘abÀ_îr‹_sour˚
;

714 
u16
 
	mîr‹_sour˚
;

715 } 
	t__˛ib_∑cked
 
	tpcõ_adv™˚d_îr‹_ªgs_t
;

718 
	#PCI_VC_PORT_REG1
 4

	)

719 
	#PCI_VC_PORT_REG2
 8

	)

720 
	#PCI_VC_PORT_CTRL
 12

	)

721 
	#PCI_VC_PORT_STATUS
 14

	)

722 
	#PCI_VC_RES_CAP
 16

	)

723 
	#PCI_VC_RES_CTRL
 20

	)

724 
	#PCI_VC_RES_STATUS
 26

	)

727 
	#PCI_PWR_DSR
 4

	)

728 
	#PCI_PWR_DATA
 8

	)

729 
	#PCI_PWR_DATA_BASE
(
x
Ë((xË& 0xffË

	)

730 
	#PCI_PWR_DATA_SCALE
(
x
Ë(((xË>> 8Ë& 3Ë

	)

731 
	#PCI_PWR_DATA_PM_SUB
(
x
Ë(((xË>> 10Ë& 7Ë

	)

732 
	#PCI_PWR_DATA_PM_STATE
(
x
Ë(((xË>> 13Ë& 3Ë

	)

733 
	#PCI_PWR_DATA_TYPE
(
x
Ë(((xË>> 15Ë& 7Ë

	)

734 
	#PCI_PWR_DATA_RAIL
(
x
Ë(((xË>> 18Ë& 7Ë

	)

735 
	#PCI_PWR_CAP
 12

	)

736 
	#PCI_PWR_CAP_BUDGET
(
x
Ë((xË& 1Ë

	)

	@physmem.h

40 #i‚de‡
ö˛uded_vlib_physmem_h


41 
	#ö˛uded_vlib_physmem_h


	)

43 
u8
 
	tvlib_physmem_ªgi⁄_ödex_t
;

47 
vlib_physmem_ªgi⁄_ödex_t
 
	mödex
;

48 *
	mmem
;

49 
uw‹d
 
	msize
;

50 
	mfd
;

51 
u8
 
	mlog2_∑ge_size
;

52 
u16
 
	mn_∑ges
;

53 
u32
 
	m∑ge_mask
;

55 *
	mhóp
;

56 
u32
 
	mÊags
;

57 
	#VLIB_PHYSMEM_F_INIT_MHEAP
 (1 << 0)

	)

58 
	#VLIB_PHYSMEM_F_HUGETLB
 (1 << 1)

	)

59 
	#VLIB_PHYSMEM_F_SHARED
 (1 << 2)

	)

61 
u8
 
	mnuma_node
;

62 
u64
 *
	m∑ge_èbÀ
;

63 
u8
 *
	m«me
;

64 } 
	tvlib_physmem_ªgi⁄_t
;

70 
u32
 
	mÊags
;

71 
	#VLIB_PHYSMEM_MAIN_F_HAVE_PAGEMAP
 (1 << 0)

	)

72 
	#VLIB_PHYSMEM_MAIN_F_HAVE_IOMMU
 (1 << 1)

	)

73 
vlib_physmem_ªgi⁄_t
 *
	mªgi⁄s
;

74 } 
	tvlib_physmem_maö_t
;

76 
vlib_physmem_maö_t
 
physmem_maö
;

	@physmem_funcs.h

40 #i‚de‡
ö˛uded_vlib_physmem_funcs_h


41 
	#ö˛uded_vlib_physmem_funcs_h


	)

43 
Æways_ölöe
 
vlib_physmem_ªgi⁄_t
 *

44 
	$vlib_physmem_gë_ªgi⁄
 (
vlib_maö_t
 * 
vm
, 
u8
 
ödex
)

46 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

47  
	`poﬁ_ñt_©_ödex
 (
vpm
->
ªgi⁄s
, 
ödex
);

48 
	}
}

50 
Æways_ölöe
 
u64


51 
	$vlib_physmem_off£t_to_physiˇl
 (
vlib_maö_t
 * 
vm
,

52 
vlib_physmem_ªgi⁄_ödex_t
 
idx
, 
uw‹d
 
o
)

54 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

55 
uw‹d
 
∑ge_ödex
 = 
o
 >> 
¥
->
log2_∑ge_size
;

56 
	`ASSERT
 (
o
 < 
¥
->
size
);

57 
	`ASSERT
 (
¥
->
∑ge_èbÀ
[
∑ge_ödex
] != 0);

58  (
	`vec_ñt
 (
¥
->
∑ge_èbÀ
, 
∑ge_ödex
Ë+ (
o
 &Ör->
∑ge_mask
));

59 
	}
}

61 
Æways_ölöe
 

62 
	$vlib_physmem_is_vútuÆ
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

63 
uw‹d
 
p
)

65 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

66  
p
 >
	`poöãr_to_uw‹d
 (
¥
->
mem
)

67 && 
p
 < (
	`poöãr_to_uw‹d
 (
¥
->
mem
Ë+Ör->
size
);

68 
	}
}

70 
Æways_ölöe
 
uw‹d


71 
	$vlib_physmem_off£t_of
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

72 *
p
)

74 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

75 
uw‹d
 
a
 = 
	`poöãr_to_uw‹d
 (
p
);

76 
uw‹d
 
o
;

78 
	`ASSERT
 (
	`vlib_physmem_is_vútuÆ
 (
vm
, 
idx
, 
a
));

79 
o
 = 
a
 - 
	`poöãr_to_uw‹d
 (
¥
->
mem
);

82 
	`ASSERT
 ((
uw‹d
Ë
o
 =
a
 - 
	`poöãr_to_uw‹d
 (
¥
->
mem
));

84  
o
;

85 
	}
}

87 
Æways_ölöe
 *

88 
	$vlib_physmem_©_off£t
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

89 
uw‹d
 
off£t
)

91 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

92 
	`ASSERT
 (
off£t
 < 
¥
->
size
);

93  
	`uw‹d_to_poöãr
 (
	`poöãr_to_uw‹d
 (
¥
->
mem
Ë+ 
off£t
, *);

94 
	}
}

96 
Æways_ölöe
 *

97 
	$vlib_physmem_Æloc_Æig√d
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

98 
˛ib_îr‹_t
 ** 
îr‹
,

99 
uw‹d
 
n_byãs
, uw‹d 
Æignmít
)

101 *
r
 = 
vm
->
	`os_physmem_Æloc_Æig√d
 (vm, 
idx
, 
n_byãs
, 
Æignmít
);

102 i‡(!
r
)

103 *
îr‹
 =

104 
	`˛ib_îr‹_ªtu∫
 (0, "failedÅoállocate %wd bytes of I/O memory",

105 
n_byãs
);

107 *
îr‹
 = 0;

108  
r
;

109 
	}
}

112 
Æways_ölöe
 *

113 
	$vlib_physmem_Æloc
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

114 
˛ib_îr‹_t
 ** 
îr‹
, 
uw‹d
 
n_byãs
)

116  
	`vlib_physmem_Æloc_Æig√d
 (
vm
, 
idx
, 
îr‹
, 
n_byãs
,

117 
CLIB_CACHE_LINE_BYTES
);

118 
	}
}

120 
Æways_ölöe
 

121 
	$vlib_physmem_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

122 *
mem
)

124 i‡(
mem
)

125 
vm
->
	`os_physmem_‰ì
 (vm, 
idx
, 
mem
);

126 
	}
}

128 
Æways_ölöe
 
u64


129 
	$vlib_physmem_vútuÆ_to_physiˇl
 (
vlib_maö_t
 * 
vm
,

130 
vlib_physmem_ªgi⁄_ödex_t
 
idx
, *
mem
)

132 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

133 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`poﬁ_ñt_©_ödex
 (
vpm
->
ªgi⁄s
, 
idx
);

134 
uw‹d
 
o
 = 
mem
 - 
¥
->mem;

135  
	`vlib_physmem_off£t_to_physiˇl
 (
vm
, 
idx
, 
o
);

136 
	}
}

139 
Æways_ölöe
 
˛ib_îr‹_t
 *

140 
	$vlib_physmem_ªgi⁄_Æloc
 (
vlib_maö_t
 * 
vm
, *
«me
, 
u32
 
size
,

141 
u8
 
numa_node
, 
u32
 
Êags
,

142 
vlib_physmem_ªgi⁄_ödex_t
 * 
idx
)

144  
vm
->
	`os_physmem_ªgi⁄_Æloc
 (vm, 
«me
, 
size
, 
numa_node
, 
Êags
, 
idx
);

145 
	}
}

147 
Æways_ölöe
 

148 
	$vlib_physmem_ªgi⁄_‰ì
 (
vlib_maö_t
 *
vm
,

149 
vlib_physmem_ªgi⁄_ödex_t
 
idx
)

151 
vm
->
	`os_physmem_ªgi⁄_‰ì
 (vm, 
idx
);

152 
	}
}

	@threads.c

15 
	#_GNU_SOURCE


	)

17 
	~<sig«l.h
>

18 
	~<m©h.h
>

19 
	~<vµö‰a/f‹m©.h
>

20 
	~<vlib/vlib.h
>

22 
	~<vlib/thªads.h
>

23 
	~<vlib/unix/cj.h
>

25 
	gDECLARE_CJ_GLOBAL_LOG
;

27 
	#FRAME_QUEUE_NELTS
 32

	)

29 
u32


30 
	$vl
 (*
p
)

32  
	`vec_Àn
 (
p
);

33 
	}
}

35 
vlib_w‹kî_thªad_t
 *
	gvlib_w‹kî_thªads
;

36 
vlib_thªad_maö_t
 
	gvlib_thªad_maö
;

45 #ifde‡
BARRIER_TRACING


49 #ifde‡
BARRIER_TRACING_ELOG


50 
u32


51 
	$ñog_id_f‹_msg_«me
 (c⁄° *
msg_«me
)

53 
uw‹d
 *
p
, 
r
;

54 
uw‹d
 *
h
;

55 
u8
 *
«me_c›y
;

57 i‡(!
h
)

58 
h
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

60 
p
 = 
	`hash_gë_mem
 (
h
, 
msg_«me
);

61 i‡(
p
)

62  
p
[0];

63 
r
 = 
	`ñog_°rög
 (&
vlib_globÆ_maö
.
ñog_maö
, "%s", 
msg_«me
);

65 
«me_c›y
 = 
	`f‹m©
 (0, "%s%c", 
msg_«me
, 0);

67 
	`hash_£t_mem
 (
h
, 
«me_c›y
, 
r
);

69  
r
;

70 
	}
}

77 
ölöe
 

78 
	$b¨rõr_åa˚_sync
 (
f64
 
t_íåy
, f64 
t_›í
, f64 
t_˛o£d
)

81 
	`ELOG_TYPE_DECLARE
 (
e
) =

83 .
f‹m©
 = "barrier <%d#%s(O:%dus:%dus)(%dus)",

84 .
f‹m©_¨gs
 = "i4T4i4i4i4",

89 
u32
 
cou¡
, 
ˇŒî
, 
t_íåy
, 
t_›í
, 
t_˛o£d
;

90 } *
ed
 = 0;

92 
ed
 = 
	`ELOG_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
);

93 
ed
->
cou¡
 = (Ë
vlib_w‹kî_thªads
[0].
b¨rõr_sync_cou¡
;

94 
ed
->
ˇŒî
 = 
	`ñog_id_f‹_msg_«me
 (
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
);

95 
ed
->
t_íåy
 = () (1000000.0 *Å_entry);

96 
ed
->
t_›í
 = () (1000000.0 *Å_open);

97 
ed
->
t_˛o£d
 = () (1000000.0 *Å_closed);

98 
	}
}

100 
ölöe
 

101 
	$b¨rõr_åa˚_sync_ªc
 (
f64
 
t_íåy
)

104 
	`ELOG_TYPE_DECLARE
 (
e
) =

106 .
f‹m©
 = "barrier <%d(%dus)%s",

107 .
f‹m©_¨gs
 = "i4i4T4",

112 
u32
 
dïth
, 
t_íåy
, 
ˇŒî
;

113 } *
ed
 = 0;

115 
ed
 = 
	`ELOG_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
);

116 
ed
->
dïth
 = (Ë
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
 - 1;

117 
ed
->
t_íåy
 = () (1000000.0 *Å_entry);

118 
ed
->
ˇŒî
 = 
	`ñog_id_f‹_msg_«me
 (
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
);

119 
	}
}

121 
ölöe
 

122 
	$b¨rõr_åa˚_ªÀa£_ªc
 (
f64
 
t_íåy
)

125 
	`ELOG_TYPE_DECLARE
 (
e
) =

127 .
f‹m©
 = "barrier (%dus)%d>",

128 .
f‹m©_¨gs
 = "i4i4",

133 
u32
 
t_íåy
, 
dïth
;

134 } *
ed
 = 0;

136 
ed
 = 
	`ELOG_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
);

137 
ed
->
t_íåy
 = () (1000000.0 *Å_entry);

138 
ed
->
dïth
 = (Ë
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
;

139 
	}
}

141 
ölöe
 

142 
	$b¨rõr_åa˚_ªÀa£
 (
f64
 
t_íåy
, f64 
t_˛o£d_tŸÆ
, f64 
t_upd©e_maö
)

145 
	`ELOG_TYPE_DECLARE
 (
e
) =

147 .
f‹m©
 = "barrier (%dus){%d}(C:%dus)#%d>",

148 .
f‹m©_¨gs
 = "i4i4i4i4",

153 
u32
 
t_íåy
, 
t_upd©e_maö
, 
t_˛o£d_tŸÆ
, 
cou¡
;

154 } *
ed
 = 0;

156 
ed
 = 
	`ELOG_DATA
 (&
vlib_globÆ_maö
.
ñog_maö
, 
e
);

157 
ed
->
t_íåy
 = () (1000000.0 *Å_entry);

158 
ed
->
t_upd©e_maö
 = () (1000000.0 *Å_update_main);

159 
ed
->
t_˛o£d_tŸÆ
 = () (1000000.0 *Å_closed_total);

160 
ed
->
cou¡
 = (Ë
vlib_w‹kî_thªads
[0].
b¨rõr_sync_cou¡
;

163 
vlib_w‹kî_thªads
[0].
b¨rõr_c⁄ãxt
 = 
NULL
;

164 
	}
}

166 
	gb¨rõr_åa˚
[65536];

167 *
	gbç
 = 
b¨rõr_åa˚
;

175 
ölöe
 

176 
	$b¨rõr_åa˚_sync
 (
f64
 
t_íåy
, f64 
t_›í
, f64 
t_˛o£d
)

178 
bç
 +
	`•rötf
 (btp, "<%u#%s",

179 (Ë
vlib_w‹kî_thªads
[0].
b¨rõr_sync_cou¡
,

180 
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
);

182 i‡(
vlib_w‹kî_thªads
[0].
b¨rõr_c⁄ãxt
)

184 
bç
 +
	`•rötf
 (bç, "[%s]", 
vlib_w‹kî_thªads
[0].
b¨rõr_c⁄ãxt
);

188 
bç
 +
	`•rötf
 (btp, "(O:%dus:%dus)(%dus):",

189 (Ë(1000000.0 * 
t_íåy
),

190 (Ë(1000000.0 * 
t_›í
), (Ë(1000000.0 * 
t_˛o£d
));

192 
	}
}

194 
ölöe
 

195 
	$b¨rõr_åa˚_sync_ªc
 (
f64
 
t_íåy
)

197 
bç
 +
	`•rötf
 (btp, "<%u(%dus)%s:",

198 (Ë
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
 - 1,

199 (Ë(1000000.0 * 
t_íåy
),

200 
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
);

201 
	}
}

203 
ölöe
 

204 
	$b¨rõr_åa˚_ªÀa£_ªc
 (
f64
 
t_íåy
)

206 
bç
 +
	`•rötf
 (bç, ":(%dus)%u>", (Ë(1000000.0 * 
t_íåy
),

207 (Ë
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
);

208 
	}
}

210 
ölöe
 

211 
	$b¨rõr_åa˚_ªÀa£
 (
f64
 
t_íåy
, f64 
t_˛o£d_tŸÆ
, f64 
t_upd©e_maö
)

214 
bç
 +
	`•rötf
 (bç, ":(%dus)", (Ë(1000000.0 * 
t_íåy
));

215 i‡(
t_upd©e_maö
 > 0)

217 
bç
 +
	`•rötf
 (bç, "{%dus}", (Ë(1000000.0 * 
t_upd©e_maö
));

220 
bç
 +
	`•rötf
 (btp, "(C:%dus)#%u>",

221 (Ë(1000000.0 * 
t_˛o£d_tŸÆ
),

222 (Ë
vlib_w‹kî_thªads
[0].
b¨rõr_sync_cou¡
);

225 
	`ff‹m©
 (
°dîr
, "BTRC %s\n", 
b¨rõr_åa˚
);

226 
bç
 = 
b¨rõr_åa˚
;

227 
vlib_w‹kî_thªads
[0].
b¨rõr_c⁄ãxt
 = 
NULL
;

228 
	}
}

233 
ölöe
 

234 
	$b¨rõr_åa˚_sync
 (
f64
 
t_íåy
, f64 
t_›í
, f64 
t_˛o£d
)

236 
	}
}

238 
ölöe
 

239 
	$b¨rõr_åa˚_sync_ªc
 (
f64
 
t_íåy
)

241 
	}
}

243 
ölöe
 

244 
	$b¨rõr_åa˚_ªÀa£_ªc
 (
f64
 
t_íåy
)

246 
	}
}

248 
ölöe
 

249 
	$b¨rõr_åa˚_ªÀa£
 (
f64
 
t_íåy
, f64 
t_˛o£d_tŸÆ
, f64 
t_upd©e_maö
)

251 
	}
}

254 
uw‹d


255 
	$os_gë_¡hªads
 ()

257 
u32
 
Àn
;

259 
Àn
 = 
	`vec_Àn
 (
vlib_thªad_°acks
);

260 i‡(
Àn
 == 0)

263  
Àn
;

264 
	}
}

267 
	$vlib_£t_thªad_«me
 (*
«me
)

269 
	`±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, c⁄° *
__«me
);

270 
rv
;

271 
±hªad_t
 
thªad
 = 
	`±hªad_£lf
 ();

273 i‡(
thªad
)

275 
rv
 = 
	`±hªad_£äame_≈
 (
thªad
, 
«me
);

276 i‡(
rv
)

277 
	`˛ib_w¨nög
 ("±hªad_£äame_≈Ñëu∫ed %d", 
rv
);

279 
	}
}

282 
	$s‹t_ªgi°øti⁄s_by_no_˛⁄e
 (*
a0
, *
a1
)

284 
vlib_thªad_ªgi°øti⁄_t
 **
å0
 = 
a0
;

285 
vlib_thªad_ªgi°øti⁄_t
 **
å1
 = 
a1
;

287  ((
i32
Ë((*
å0
)->
no_d©a_°ru˘uª_˛⁄e
)

288 - ((
i32
Ë((*
å1
)->
no_d©a_°ru˘uª_˛⁄e
)));

289 
	}
}

291 
uw‹d
 *

292 
	$˛ib_sysfs_li°_to_bôm≠
 (*
fûíame
)

294 
FILE
 *
Â
;

295 
uw‹d
 *
r
 = 0;

297 
Â
 = 
	`f›í
 (
fûíame
, "r");

299 i‡(
Â
 !
NULL
)

301 
u8
 *
buf„r
 = 0;

302 
	`vec_vÆid©e
 (
buf„r
, 256 - 1);

303 i‡(
	`fgës
 ((*Ë
buf„r
, 256, 
Â
))

305 
unf‹m©_öput_t
 
ö
;

306 
	`unf‹m©_öô_°rög
 (&
ö
, (*Ë
buf„r
,

307 
	`°æí
 ((*Ë
buf„r
));

308 i‡(
	`unf‹m©
 (&
ö
, "%U", 
unf‹m©_bôm≠_li°
, &
r
) != 1)

309 
	`˛ib_w¨nög
 ("unformat_bitmap_list failed");

310 
	`unf‹m©_‰ì
 (&
ö
);

312 
	`vec_‰ì
 (
buf„r
);

313 
	`f˛o£
 (
Â
);

315  
r
;

316 
	}
}

321 
˛ib_îr‹_t
 *

322 
	$vlib_thªad_öô
 (
vlib_maö_t
 * 
vm
)

324 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

325 
vlib_w‹kî_thªad_t
 *
w
;

326 
vlib_thªad_ªgi°øti⁄_t
 *
å
;

327 
u32
 
n_vlib_maös
 = 1;

328 
u32
 
fú°_ödex
 = 1;

329 
u32
 
i
;

330 
uw‹d
 *
avaû_˝u
;

333 
tm
->
˝u_c‹e_bôm≠
 =

334 
	`˛ib_sysfs_li°_to_bôm≠
 ("/sys/devices/system/cpu/online");

335 
tm
->
˝u_sockë_bôm≠
 =

336 
	`˛ib_sysfs_li°_to_bôm≠
 ("/sys/devices/system/node/online");

338 
avaû_˝u
 = 
	`˛ib_bôm≠_dup
 (
tm
->
˝u_c‹e_bôm≠
);

341 
i
 = 0; i < 
tm
->
skù_c‹es
; i++)

343 
uw‹d
 
c
 = 
	`˛ib_bôm≠_fú°_£t
 (
avaû_˝u
);

344 i‡(
c
 == ~0)

345  
	`˛ib_îr‹_ªtu∫
 (0, "noávailable cpusÅo skip");

347 
avaû_˝u
 = 
	`˛ib_bôm≠_£t
 (avaû_˝u, 
c
, 0);

351 i‡(!
tm
->
maö_lc‹e
)

353 
tm
->
maö_lc‹e
 = 
	`˛ib_bôm≠_fú°_£t
 (
avaû_˝u
);

354 i‡(
tm
->
maö_lc‹e
 =(
u8
) ~ 0)

355  
	`˛ib_îr‹_ªtu∫
 (0, "noávailable cpusÅo be used forÅhe"

360 i‡(
	`˛ib_bôm≠_gë
 (
avaû_˝u
, 
tm
->
maö_lc‹e
) == 0)

361  
	`˛ib_îr‹_ªtu∫
 (0, "cpu %u isÇotávailableÅo be used"

362 " f‹ÅhêmaöÅhªad", 
tm
->
maö_lc‹e
);

364 
avaû_˝u
 = 
	`˛ib_bôm≠_£t
 (avaû_˝u, 
tm
->
maö_lc‹e
, 0);

367 i‡(!
tm
->
˝u_sockë_bôm≠
)

368 
tm
->
˝u_sockë_bôm≠
 = 
	`˛ib_bôm≠_£t
 (0, 0, 1);

371 i‡(
tm
->
cb
.
vlib_thªad_£t_lc‹e_cb
)

373 
tm
->
cb
.
	`vlib_thªad_£t_lc‹e_cb
 (0,Åm->
maö_lc‹e
);

377 
˝u_£t_t
 
˝u£t
;

378 
	`CPU_ZERO
 (&
˝u£t
);

379 
	`CPU_SET
 (
tm
->
maö_lc‹e
, &
˝u£t
);

380 
	`±hªad_£èfföôy_≈
 (
	`±hªad_£lf
 (),  (
˝u_£t_t
), &
˝u£t
);

384 
	`vec_vÆid©e_Æig√d
 (
vlib_w‹kî_thªads
, 
	`vec_Àn
 (
vlib_thªad_°acks
) - 1,

385 
CLIB_CACHE_LINE_BYTES
);

388 
	`_vec_Àn
 (
vlib_w‹kî_thªads
) = 1;

389 
w
 = 
vlib_w‹kî_thªads
;

390 
w
->
thªad_mhóp
 = 
	`˛ib_mem_gë_hóp
 ();

391 
w
->
thªad_°ack
 = 
vlib_thªad_°acks
[0];

392 
w
->
lc‹e_id
 = 
tm
->
maö_lc‹e
;

393 
w
->
lwp
 = 
	`sysˇŒ
 (
SYS_gëtid
);

394 
w
->
thªad_id
 = 
	`±hªad_£lf
 ();

395 
tm
->
n_vlib_maös
 = 1;

397 i‡(
tm
->
sched_pﬁicy
 != ~0)

399 
sched_∑øm
 sched_param;

400 i‡(!
	`sched_gë∑øm
 (
w
->
lwp
, &
sched_∑øm
))

402 i‡(
tm
->
sched_¥i‹ôy
 != ~0)

403 
sched_∑øm
.
sched_¥i‹ôy
 = 
tm
->sched_priority;

404 
	`sched_£tscheduÀr
 (
w
->
lwp
, 
tm
->
sched_pﬁicy
, &
sched_∑øm
);

409 
å
 = 
tm
->
√xt
;

411 
å
)

413 
	`vec_add1
 (
tm
->
ªgi°øti⁄s
, 
å
);

414 
å
 =År->
√xt
;

417 
	`vec_s‹t_wôh_fun˘i⁄
 (
tm
->
ªgi°øti⁄s
, 
s‹t_ªgi°øti⁄s_by_no_˛⁄e
);

419 
i
 = 0; i < 
	`vec_Àn
 (
tm
->
ªgi°øti⁄s
); i++)

421 
j
;

422 
å
 = 
tm
->
ªgi°øti⁄s
[
i
];

423 
å
->
fú°_ödex
 = first_index;

424 
fú°_ödex
 +
å
->
cou¡
;

425 
n_vlib_maös
 +(
å
->
no_d©a_°ru˘uª_˛⁄e
 =0Ë?År->
cou¡
 : 0;

428 i‡(
å
->
u£_±hªads
 || !å->
cou¡
)

431 i‡(
å
->
c‹emask
)

433 
uw‹d
 
c
;

435 
	`˛ib_bôm≠_f‹óch
 (
c
, 
å
->
c‹emask
, ({

436 i‡(
	`˛ib_bôm≠_gë
(
avaû_˝u
, 
c
) == 0)

437  
	`˛ib_îr‹_ªtu∫
 (0, "cpu %u isÇotávailableÅo be used"

438 " f‹Åhê'%s'Åhªad",
c
, 
å
->
«me
);

440 
avaû_˝u
 = 
	`˛ib_bôm≠_£t
◊vaû_˝u, 
c
, 0);

447 
j
 = 0; j < 
å
->
cou¡
; j++)

449 
uw‹d
 
c
 = 
	`˛ib_bôm≠_fú°_£t
 (
avaû_˝u
);

450 i‡(
c
 == ~0)

451  
	`˛ib_îr‹_ªtu∫
 (0,

453 "Åhê'%s'Åhªad", 
å
->
«me
);

455 
avaû_˝u
 = 
	`˛ib_bôm≠_£t
 (avaû_˝u, 
c
, 0);

456 
å
->
c‹emask
 = 
	`˛ib_bôm≠_£t
 (å->c‹emask, 
c
, 1);

461 
	`˛ib_bôm≠_‰ì
 (
avaû_˝u
);

463 
tm
->
n_vlib_maös
 =Ç_vlib_mains;

465 
	`vec_vÆid©e_Æig√d
 (
vlib_w‹kî_thªads
, 
fú°_ödex
 - 1,

466 
CLIB_CACHE_LINE_BYTES
);

469 
	}
}

471 
vlib_‰ame_queue_t
 *

472 
	$vlib_‰ame_queue_Æloc
 (
√…s
)

474 
vlib_‰ame_queue_t
 *
fq
;

476 
fq
 = 
	`˛ib_mem_Æloc_Æig√d
 ( (*fq), 
CLIB_CACHE_LINE_BYTES
);

477 
	`mem£t
 (
fq
, 0,  (*fq));

478 
fq
->
√…s
 =Çelts;

479 
fq
->
ve˘‹_thªshﬁd
 = 128;

480 
	`vec_vÆid©e_Æig√d
 (
fq
->
ñts
, 
√…s
 - 1, 
CLIB_CACHE_LINE_BYTES
);

484 i‡(((
uw‹d
Ë& 
fq
->
èû
Ë& (
CLIB_CACHE_LINE_BYTES
 - 1))

485 
	`ff‹m©
 (
°dîr
, "WARNING: fq->tail unaligned\n");

486 i‡(((
uw‹d
Ë& 
fq
->
hód
Ë& (
CLIB_CACHE_LINE_BYTES
 - 1))

487 
	`ff‹m©
 (
°dîr
, "WARNING: fq->head unaligned\n");

488 i‡(((
uw‹d
Ë
fq
->
ñts
Ë& (
CLIB_CACHE_LINE_BYTES
 - 1))

489 
	`ff‹m©
 (
°dîr
, "WARNING: fq->elts unaligned\n");

491 i‡( (
fq
->
ñts
[0]Ë% 
CLIB_CACHE_LINE_BYTES
)

492 
	`ff‹m©
 (
°dîr
, "WARNING: fq->elts[0] size %d\n",

493  (
fq
->
ñts
[0]));

494 i‡(
√…s
 & (nelts - 1))

496 
	`ff‹m©
 (
°dîr
, "FATAL:Çelts MUST beáÖower of 2\n");

497 
	`ab‹t
 ();

501  (
fq
);

502 
	}
}

504 
	$vl_msg_≠i_h™dÀr_no_‰ì
 (*Ë
	`__©åibuã__
 ((
wók
));

506 
	$vl_msg_≠i_h™dÀr_no_‰ì
 (*
v
)

508 
	}
}

512 
ölöe
 

513 
	$vlib_‰ame_queue_dequeue_öã∫Æ
 (
thªad_id
,

514 
vlib_maö_t
 * 
vm
, 
vlib_node_maö_t
 * 
nm
)

516 
vlib_‰ame_queue_t
 *
fq
 = 
vlib_‰ame_queues
[
thªad_id
];

517 
vlib_‰ame_queue_ñt_t
 *
ñt
;

518 
vlib_‰ame_t
 *
f
;

519 
vlib_≥ndög_‰ame_t
 *
p
;

520 
vlib_node_ru¡ime_t
 *
r
;

521 
u32
 
node_ru¡ime_ödex
;

522 
msg_ty≥
;

523 
u64
 
bef‹e
;

524 
¥o˚s£d
 = 0;

526 
	`ASSERT
 (
vm
 =
vlib_maös
[
thªad_id
]);

530 i‡(
fq
->
hód
 =fq->
èû
)

531  
¥o˚s£d
;

533 
ñt
 = 
fq
->
ñts
 + ((fq->
hód
 + 1Ë& (fq->
√…s
 - 1));

535 i‡(!
ñt
->
vÆid
)

536  
¥o˚s£d
;

538 
bef‹e
 = 
	`˛ib_˝u_time_now
 ();

540 
f
 = 
ñt
->
‰ame
;

541 
node_ru¡ime_ödex
 = 
ñt
->node_runtime_index;

542 
msg_ty≥
 = 
ñt
->msg_type;

544 
msg_ty≥
)

546 
VLIB_FRAME_QUEUE_ELT_FREE_BUFFERS
:

547 
	`vlib_buf„r_‰ì
 (
vm
, 
	`vlib_‰ame_ve˘‹_¨gs
 (
f
), f->
n_ve˘‹s
);

549 
VLIB_FRAME_QUEUE_ELT_FREE_FRAME
:

550 
r
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
],

551 
node_ru¡ime_ödex
);

552 
	`vlib_‰ame_‰ì
 (
vm
, 
r
, 
f
);

554 
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
:

555 
	`vec_add2
 (
vm
->
node_maö
.
≥ndög_‰ames
, 
p
, 1);

556 
f
->
Êags
 |(
VLIB_FRAME_PENDING
 | 
VLIB_FRAME_FREE_AFTER_DISPATCH
);

557 
p
->
node_ru¡ime_ödex
 = 
ñt
->node_runtime_index;

558 
p
->
‰ame_ödex
 = 
	`vlib_‰ame_ödex
 (
vm
, 
f
);

559 
p
->
√xt_‰ame_ödex
 = 
VLIB_PENDING_FRAME_NO_NEXT_FRAME
;

560 
fq
->
dequeue_ve˘‹s
 +(
u64
Ë
f
->
n_ve˘‹s
;

562 
VLIB_FRAME_QUEUE_ELT_API_MSG
:

563 
	`vl_msg_≠i_h™dÀr_no_‰ì
 (
f
);

566 
	`˛ib_w¨nög
 ("bogu†‰amêqueuêmesßge,Åy≥ %d", 
msg_ty≥
);

569 
ñt
->
vÆid
 = 0;

570 
fq
->
dequeues
++;

571 
fq
->
dequeue_ticks
 +
	`˛ib_˝u_time_now
 (Ë- 
bef‹e
;

572 
	`CLIB_MEMORY_BARRIER
 ();

573 
fq
->
hód
++;

574 
¥o˚s£d
++;

576 
	`ASSERT
 (0);

577  
¥o˚s£d
;

578 
	}
}

581 
	$vlib_‰ame_queue_dequeue
 (
thªad_id
,

582 
vlib_maö_t
 * 
vm
, 
vlib_node_maö_t
 * 
nm
)

584  
	`vlib_‰ame_queue_dequeue_öã∫Æ
 (
thªad_id
, 
vm
, 
nm
);

585 
	}
}

588 
	$vlib_‰ame_queue_íqueue
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ru¡ime_ödex
,

589 
u32
 
‰ame_queue_ödex
, 
vlib_‰ame_t
 * 
‰ame
,

590 
vlib_‰ame_queue_msg_ty≥_t
 
ty≥
)

592 
vlib_‰ame_queue_t
 *
fq
 = 
vlib_‰ame_queues
[
‰ame_queue_ödex
];

593 
vlib_‰ame_queue_ñt_t
 *
ñt
;

594 
u32
 
ßve_cou¡
;

595 
u64
 
√w_èû
;

596 
u64
 
bef‹e
 = 
	`˛ib_˝u_time_now
 ();

598 
	`ASSERT
 (
fq
);

600 
√w_èû
 = 
	`__sync_add_™d_„tch
 (&
fq
->
èû
, 1);

603 
√w_èû
 >
fq
->
hód
 + fq->
√…s
)

605 
f64
 
b4
 = 
	`vlib_time_now_ticks
 (
vm
, 
bef‹e
);

606 
	`vlib_w‹kî_thªad_b¨rõr_check
 (
vm
, 
b4
);

611 
ñt
 = 
fq
->
ñts
 + (
√w_èû
 & (fq->
√…s
 - 1));

614 
ñt
->
vÆid
)

619 
ßve_cou¡
 = 
‰ame
->
n_ve˘‹s
;

621 
ñt
->
‰ame
 = frame;

622 
ñt
->
node_ru¡ime_ödex
 =Çode_runtime_index;

623 
ñt
->
msg_ty≥
 = 
ty≥
;

624 
	`CLIB_MEMORY_BARRIER
 ();

625 
ñt
->
vÆid
 = 1;

627  
ßve_cou¡
;

628 
	}
}

633 
	$vlib_w‹kî_thªad_öô
 (
vlib_w‹kî_thªad_t
 * 
w
)

635 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

647 
	`˛ib_mem_£t_hóp
 (
w
->
thªad_mhóp
);

649 i‡(
	`vec_Àn
 (
tm
->
thªad_¥efix
Ë&& 
w
->
ªgi°øti⁄
->
sh‹t_«me
)

651 
w
->
«me
 = 
	`f‹m©
 (0, "%v_%s_%d%c", 
tm
->
thªad_¥efix
,

652 
w
->
ªgi°øti⁄
->
sh‹t_«me
, w->
ö°™˚_id
, '\0');

653 
	`vlib_£t_thªad_«me
 ((*Ë
w
->
«me
);

656 i‡(!
w
->
ªgi°øti⁄
->
u£_±hªads
)

660 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, 1);

662 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
)

665 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, -1);

667 
	}
}

670 
	$vlib_w‹kî_thªad_boŸ°øp_‚
 (*
¨g
)

672 *
rv
;

673 
vlib_w‹kî_thªad_t
 *
w
 = 
¨g
;

675 
w
->
lwp
 = 
	`sysˇŒ
 (
SYS_gëtid
);

676 
w
->
thªad_id
 = 
	`±hªad_£lf
 ();

678 
__os_thªad_ödex
 = 
w
 - 
vlib_w‹kî_thªads
;

680 
rv
 = (*Ë
˛ib_ˇŒjmp


681 ((
	`uw‹d
 (*)(
uw‹d
)Ë
w
->
thªad_fun˘i⁄
,

682 (
uw‹d
Ë
¨g
, 
w
->
thªad_°ack
 + 
VLIB_THREAD_STACK_SIZE
);

684  
rv
;

685 
	}
}

687 
˛ib_îr‹_t
 *

688 
	$vlib_œunch_thªad_öt
 (*
Â
, 
vlib_w‹kî_thªad_t
 * 
w
, 
lc‹e_id
)

690 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

691 *(*
Â_¨g
Ë(*Ë
Â
;

693 
w
->
lc‹e_id
 =Ücore_id;

694 i‡(
tm
->
cb
.
vlib_œunch_thªad_cb
 && !
w
->
ªgi°øti⁄
->
u£_±hªads
)

695  
tm
->
cb
.
	`vlib_œunch_thªad_cb
 (
Â
, (*Ë
w
, 
lc‹e_id
);

698 
±hªad_t
 
w‹kî
;

699 
˝u_£t_t
 
˝u£t
;

700 
	`CPU_ZERO
 (&
˝u£t
);

701 
	`CPU_SET
 (
lc‹e_id
, &
˝u£t
);

703 i‡(
	`±hªad_¸óã
 (&
w‹kî
, 
NULL
 , 
Â_¨g
, (*Ë
w
))

704  
	`˛ib_îr‹_ªtu∫_unix
 (0, "pthread_create");

706 i‡(
	`±hªad_£èfföôy_≈
 (
w‹kî
,  (
˝u_£t_t
), &
˝u£t
))

707  
	`˛ib_îr‹_ªtu∫_unix
 (0, "pthread_setaffinity_np");

711 
	}
}

713 
˛ib_îr‹_t
 *

714 
	$°¨t_w‹kîs
 (
vlib_maö_t
 * 
vm
)

716 
i
, 
j
;

717 
vlib_w‹kî_thªad_t
 *
w
;

718 
vlib_maö_t
 *
vm_˛⁄e
;

719 *
ﬁdhóp
;

720 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

721 
vlib_thªad_ªgi°øti⁄_t
 *
å
;

722 
vlib_node_ru¡ime_t
 *
π
;

723 
u32
 
n_vlib_maös
 = 
tm
->n_vlib_mains;

724 
u32
 
w‹kî_thªad_ödex
;

725 
u8
 *
maö_hóp
 = 
	`˛ib_mem_gë_≥r_˝u_hóp
 ();

726 
mhóp_t
 *
maö_hóp_hódî
 = 
	`mhóp_hódî
 (
maö_hóp
);

728 
	`vec_ª£t_Àngth
 (
vlib_w‹kî_thªads
);

731 
	`vec_add2_Æig√d
 (
vlib_w‹kî_thªads
, 
w
, 1, 
CLIB_CACHE_LINE_BYTES
);

732 
w
->
ñog_åack
.
«me
 = "mainÅhread";

733 
	`ñog_åack_ªgi°î
 (&
vm
->
ñog_maö
, &
w
->
ñog_åack
);

735 i‡(
	`vec_Àn
 (
tm
->
thªad_¥efix
))

737 
w
->
«me
 = 
	`f‹m©
 (0, "%v_maö%c", 
tm
->
thªad_¥efix
, '\0');

738 
	`vlib_£t_thªad_«me
 ((*Ë
w
->
«me
);

746 
maö_hóp_hódî
->
Êags
 |
MHEAP_FLAG_THREAD_SAFE
;

747 
vm
->
ñog_maö
.
lock
 =

748 
	`˛ib_mem_Æloc_Æig√d
 (
CLIB_CACHE_LINE_BYTES
, CLIB_CACHE_LINE_BYTES);

749 
vm
->
ñog_maö
.
lock
[0] = 0;

751 i‡(
n_vlib_maös
 > 1)

754 
vlib_maös
 = 0;

756 
	`vec_vÆid©e_Æig√d
 (
vlib_maös
, 
tm
->
n_vlib_maös
 - 1,

757 
CLIB_CACHE_LINE_BYTES
);

758 
	`_vec_Àn
 (
vlib_maös
) = 0;

759 
	`vec_add1_Æig√d
 (
vlib_maös
, 
vm
, 
CLIB_CACHE_LINE_BYTES
);

761 
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 =

762 
	`˛ib_mem_Æloc_Æig√d
 ( (
u32
), 
CLIB_CACHE_LINE_BYTES
);

763 
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
 =

764 
	`˛ib_mem_Æloc_Æig√d
 ( (
u32
), 
CLIB_CACHE_LINE_BYTES
);

766 
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
 =

767 
	`˛ib_mem_Æloc_Æig√d
 ( (
u32
), 
CLIB_CACHE_LINE_BYTES
);

770 *
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
 = 0;

771 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 = 1;

774 *
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
 = 0;

775 
vm
->
√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
 = 0;

778 
vm
->
b¨rõr_ïoch
 = 0;

779 
vm
->
b¨rõr_no_˛o£_bef‹e
 = 0;

781 
w‹kî_thªad_ödex
 = 1;

783 
i
 = 0; i < 
	`vec_Àn
 (
tm
->
ªgi°øti⁄s
); i++)

785 
vlib_node_maö_t
 *
nm
, *
nm_˛⁄e
;

786 
vlib_buf„r_maö_t
 *
bm_˛⁄e
;

787 
vlib_buf„r_‰ì_li°_t
 *
Ê_˛⁄e
, *
Ê_‹ig
;

788 
vlib_buf„r_‰ì_li°_t
 *
‹ig_‰ìli°_poﬁ
;

789 
k
;

791 
å
 = 
tm
->
ªgi°øti⁄s
[
i
];

793 i‡(
å
->
cou¡
 == 0)

796 
k
 = 0; k < 
å
->
cou¡
; k++)

798 
vlib_node_t
 *
n
;

800 
	`vec_add2
 (
vlib_w‹kî_thªads
, 
w
, 1);

801 i‡(
å
->
mhóp_size
)

802 
w
->
thªad_mhóp
 =

803 
	`mhóp_Æloc
 (0 , 
å
->
mhóp_size
);

805 
w
->
thªad_mhóp
 = 
maö_hóp
;

807 
w
->
thªad_°ack
 =

808 
	`vlib_thªad_°ack_öô
 (
w
 - 
vlib_w‹kî_thªads
);

809 
w
->
thªad_fun˘i⁄
 = 
å
->
fun˘i⁄
;

810 
w
->
thªad_fun˘i⁄_¨g
 = w;

811 
w
->
ö°™˚_id
 = 
k
;

812 
w
->
ªgi°øti⁄
 = 
å
;

814 
w
->
ñog_åack
.
«me
 =

815 (*Ë
	`f‹m©
 (0, "%†%d", 
å
->
«me
, 
k
 + 1);

816 
	`vec_add1
 (
w
->
ñog_åack
.
«me
, 0);

817 
	`ñog_åack_ªgi°î
 (&
vm
->
ñog_maö
, &
w
->
ñog_åack
);

819 i‡(
å
->
no_d©a_°ru˘uª_˛⁄e
)

823 
ﬁdhóp
 = 
	`˛ib_mem_£t_hóp
 (
w
->
thªad_mhóp
);

825 
vm_˛⁄e
 = 
	`˛ib_mem_Æloc
 ( (*vm_clone));

826 
	`˛ib_mem˝y
 (
vm_˛⁄e
, 
vlib_maös
[0],  (*vm_clone));

828 
vm_˛⁄e
->
thªad_ödex
 = 
w‹kî_thªad_ödex
;

829 
vm_˛⁄e
->
hóp_ba£
 = 
w
->
thªad_mhóp
;

830 
vm_˛⁄e
->
mbuf_Æloc_li°
 = 0;

831 
vm_˛⁄e
->
öô_fun˘i⁄s_ˇŒed
 =

832 
	`hash_¸óã
 (0, 0);

833 
vm_˛⁄e
->
≥ndög_Ωc_ªque°s
 = 0;

834 
	`vec_vÆid©e
 (
vm_˛⁄e
->
≥ndög_Ωc_ªque°s
, 0);

835 
	`_vec_Àn
 (
vm_˛⁄e
->
≥ndög_Ωc_ªque°s
) = 0;

836 
	`mem£t
 (&
vm_˛⁄e
->
øndom_buf„r
, 0,

837  (
vm_˛⁄e
->
øndom_buf„r
));

839 
nm
 = &
vlib_maös
[0]->
node_maö
;

840 
nm_˛⁄e
 = &
vm_˛⁄e
->
node_maö
;

842 
nm_˛⁄e
->
√xt_‰ames
 = 
	`vec_dup
 (
nm
->next_frames);

843 
j
 = 0; j < 
	`vec_Àn
 (
nm_˛⁄e
->
√xt_‰ames
); j++)

845 
vlib_√xt_‰ame_t
 *
nf
 = &
nm_˛⁄e
->
√xt_‰ames
[
j
];

846 
u32
 
ßve_node_ru¡ime_ödex
;

847 
u32
 
ßve_Êags
;

849 
ßve_node_ru¡ime_ödex
 = 
nf
->
node_ru¡ime_ödex
;

850 
ßve_Êags
 = 
nf
->
Êags
 & 
VLIB_FRAME_NO_FREE_AFTER_DISPATCH
;

851 
	`vlib_√xt_‰ame_öô
 (
nf
);

852 
nf
->
node_ru¡ime_ödex
 = 
ßve_node_ru¡ime_ödex
;

853 
nf
->
Êags
 = 
ßve_Êags
;

857 
nm_˛⁄e
->
≥ndög_‰ames
 = 0;

858 
	`vec_vÆid©e
 (
nm_˛⁄e
->
≥ndög_‰ames
, 10);

859 
	`_vec_Àn
 (
nm_˛⁄e
->
≥ndög_‰ames
) = 0;

862 
nm_˛⁄e
->
nodes
 = 0;

865 
n
 = 
	`˛ib_mem_Æloc_no_Áû
 (
	`vec_Àn
 (
nm
->
nodes
) *  (*n));

867 
j
 = 0; j < 
	`vec_Àn
 (
nm
->
nodes
); j++)

869 
	`˛ib_mem˝y
 (
n
, 
nm
->
nodes
[
j
],  (*n));

871 
n
->
ow√r_node_ödex
 = 
VLIB_INVALID_NODE_INDEX
;

872 
	`mem£t
 (&
n
->
°©s_tŸÆ
, 0,  (n->stats_total));

873 
	`mem£t
 (&
n
->
°©s_œ°_˛ór
, 0,

874  (
n
->
°©s_œ°_˛ór
));

875 
	`vec_add1
 (
nm_˛⁄e
->
nodes
, 
n
);

876 
n
++;

878 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
] =

879 
	`vec_dup
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
]);

880 
	`vec_f‹óch
 (
π
,

881 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
])

883 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
π
->
node_ödex
);

884 
π
->
thªad_ödex
 = 
vm_˛⁄e
->thread_index;

886 i‡(
n
->
ru¡ime_d©a
 &&Ç->
ru¡ime_d©a_byãs
 > 0)

887 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
n
->runtime_data,

888 
	`˛ib_mö
 (
VLIB_NODE_RUNTIME_DATA_SIZE
,

889 
n
->
ru¡ime_d©a_byãs
));

892 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
] =

893 
	`vec_dup
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
]);

894 
	`vec_f‹óch
 (
π
, 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
])

896 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
π
->
node_ödex
);

897 
π
->
thªad_ödex
 = 
vm_˛⁄e
->thread_index;

899 i‡(
n
->
ru¡ime_d©a
 &&Ç->
ru¡ime_d©a_byãs
 > 0)

900 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
n
->runtime_data,

901 
	`˛ib_mö
 (
VLIB_NODE_RUNTIME_DATA_SIZE
,

902 
n
->
ru¡ime_d©a_byãs
));

905 
nm_˛⁄e
->
¥o˚s£s
 = 
	`vec_dup
 (
nm
->processes);

908 
nm_˛⁄e
->
‰ame_sizes
 = 0;

909 
nm_˛⁄e
->
‰ame_size_hash
 = 
	`hash_¸óã
 (0,  (
uw‹d
));

913 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

914 
	`vec_add1_Æig√d
 (
vlib_maös
, 
vm_˛⁄e
, 
CLIB_CACHE_LINE_BYTES
);

916 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs
 =

917 
	`vec_dup
 (
vlib_maös
[0]->
îr‹_maö
.
cou¡îs
);

918 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs_œ°_˛ór
 =

919 
	`vec_dup
 (
vlib_maös
[0]->
îr‹_maö
.
cou¡îs_œ°_˛ór
);

922 
bm_˛⁄e
 = 
	`vec_dup
 (
vm_˛⁄e
->
buf„r_maö
);

923 
vm_˛⁄e
->
buf„r_maö
 = 
bm_˛⁄e
;

925 
‹ig_‰ìli°_poﬁ
 = 
bm_˛⁄e
->
buf„r_‰ì_li°_poﬁ
;

926 
bm_˛⁄e
->
buf„r_‰ì_li°_poﬁ
 = 0;

929 
	`poﬁ_f‹óch
 (
Ê_‹ig
, 
‹ig_‰ìli°_poﬁ
,

931 
	`poﬁ_gë_Æig√d
 (
bm_˛⁄e
->
buf„r_‰ì_li°_poﬁ
,

932 
Ê_˛⁄e
, 
CLIB_CACHE_LINE_BYTES
);

933 
	`ASSERT
 (
Ê_‹ig
 - 
‹ig_‰ìli°_poﬁ


934 =
Ê_˛⁄e
 - 
bm_˛⁄e
->
buf„r_‰ì_li°_poﬁ
);

936 
Ê_˛⁄e
[0] = 
Ê_‹ig
[0];

937 
Ê_˛⁄e
->
buf„rs
 = 0;

938 
Ê_˛⁄e
->
n_Æloc
 = 0;

942 
w‹kî_thªad_ödex
++;

949 
i
 = 0; i < 
	`vec_Àn
 (
tm
->
ªgi°øti⁄s
); i++)

951 
å
 = 
tm
->
ªgi°øti⁄s
[
i
];

953 
j
 = 0; j < 
å
->
cou¡
; j++)

955 
	`vec_add2
 (
vlib_w‹kî_thªads
, 
w
, 1);

956 i‡(
å
->
mhóp_size
)

957 
w
->
thªad_mhóp
 =

958 
	`mhóp_Æloc
 (0 , 
å
->
mhóp_size
);

960 
w
->
thªad_mhóp
 = 
maö_hóp
;

961 
w
->
thªad_°ack
 =

962 
	`vlib_thªad_°ack_öô
 (
w
 - 
vlib_w‹kî_thªads
);

963 
w
->
thªad_fun˘i⁄
 = 
å
->
fun˘i⁄
;

964 
w
->
thªad_fun˘i⁄_¨g
 = w;

965 
w
->
ö°™˚_id
 = 
j
;

966 
w
->
ñog_åack
.
«me
 =

967 (*Ë
	`f‹m©
 (0, "%†%d", 
å
->
«me
, 
j
 + 1);

968 
w
->
ªgi°øti⁄
 = 
å
;

969 
	`vec_add1
 (
w
->
ñog_åack
.
«me
, 0);

970 
	`ñog_åack_ªgi°î
 (&
vm
->
ñog_maö
, &
w
->
ñog_åack
);

975 
w‹kî_thªad_ödex
 = 1;

977 
i
 = 0; i < 
	`vec_Àn
 (
tm
->
ªgi°øti⁄s
); i++)

979 
˛ib_îr‹_t
 *
îr
;

980 
j
;

982 
å
 = 
tm
->
ªgi°øti⁄s
[
i
];

984 i‡(
å
->
u£_±hªads
 || 
tm
->use_pthreads)

986 
j
 = 0; j < 
å
->
cou¡
; j++)

988 
w
 = 
vlib_w‹kî_thªads
 + 
w‹kî_thªad_ödex
++;

989 
îr
 = 
	`vlib_œunch_thªad_öt
 (
vlib_w‹kî_thªad_boŸ°øp_‚
,

990 
w
, 0);

991 i‡(
îr
)

992 
	`˛ib_îr‹_ªp‹t
 (
îr
);

997 
uw‹d
 
c
;

999 
	`˛ib_bôm≠_f‹óch
 (
c
, 
å
->
c‹emask
, ({

1000 
w
 = 
vlib_w‹kî_thªads
 + 
w‹kî_thªad_ödex
++;

1001 
îr
 = 
	`vlib_œunch_thªad_öt
 (
vlib_w‹kî_thªad_boŸ°øp_‚
,

1002 
w
, 
c
);

1003 i‡(
îr
)

1004 
	`˛ib_îr‹_ªp‹t
 (
îr
);

1009 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

1010 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

1012 
	}
}

1014 
VLIB_MAIN_LOOP_ENTER_FUNCTION
 (
°¨t_w‹kîs
);

1017 
ölöe
 

1018 
	$w‹kî_thªad_node_ru¡ime_upd©e_öã∫Æ
 ()

1020 
i
, 
j
;

1021 
vlib_maö_t
 *
vm
;

1022 
vlib_node_maö_t
 *
nm
, *
nm_˛⁄e
;

1023 
vlib_maö_t
 *
vm_˛⁄e
;

1024 
vlib_node_ru¡ime_t
 *
π
;

1025 
√vî_ölöe
 

1026 
	`vlib_node_ru¡ime_sync_°©s
 (
vlib_maö_t
 * 
vm
,

1027 
vlib_node_ru¡ime_t
 * 
r
,

1028 
uw‹d
 
n_ˇŒs
,

1029 
uw‹d
 
n_ve˘‹s
, uw‹d 
n_˛ocks
);

1031 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

1033 
vm
 = 
vlib_maös
[0];

1034 
nm
 = &
vm
->
node_maö
;

1036 
	`ASSERT
 (*
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 == 1);

1042 
j
 = 0; j < 
	`vec_Àn
 (
nm
->
nodes
); j++)

1044 
vlib_node_t
 *
n
;

1045 
n
 = 
nm
->
nodes
[
j
];

1046 
	`vlib_node_sync_°©s
 (
vm
, 
n
);

1049 
i
 = 1; i < 
	`vec_Àn
 (
vlib_maös
); i++)

1051 
vlib_node_t
 *
n
;

1053 
vm_˛⁄e
 = 
vlib_maös
[
i
];

1054 
nm_˛⁄e
 = &
vm_˛⁄e
->
node_maö
;

1056 
j
 = 0; j < 
	`vec_Àn
 (
nm_˛⁄e
->
nodes
); j++)

1058 
n
 = 
nm_˛⁄e
->
nodes
[
j
];

1060 
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm_˛⁄e
, 
n
->
ödex
);

1061 
	`vlib_node_ru¡ime_sync_°©s
 (
vm_˛⁄e
, 
π
, 0, 0, 0);

1066 
	}
}

1070 
	$vlib_w‹kî_thªad_node_ªf‹k
 ()

1072 
vlib_maö_t
 *
vm
, *
vm_˛⁄e
;

1073 
vlib_node_maö_t
 *
nm
, *
nm_˛⁄e
;

1074 
vlib_node_t
 **
ﬁd_nodes_˛⁄e
;

1075 
vlib_node_ru¡ime_t
 *
π
, *
ﬁd_π
;

1077 
vlib_node_t
 *
√w_n_˛⁄e
;

1079 
j
;

1081 
vm
 = 
vlib_maös
[0];

1082 
nm
 = &
vm
->
node_maö
;

1083 
vm_˛⁄e
 = 
	`vlib_gë_maö
 ();

1084 
nm_˛⁄e
 = &
vm_˛⁄e
->
node_maö
;

1087 
u64
 *
ﬁd_cou¡îs
 = 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs
;

1088 
u64
 *
ﬁd_cou¡îs_Æl_˛ór
 = 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs_œ°_˛ór
;

1090 
	`˛ib_mem˝y
 (&
vm_˛⁄e
->
îr‹_maö
, &
vm
->error_main,

1091  (
vm
->
îr‹_maö
));

1092 
j
 = 
	`vec_Àn
 (
vm
->
îr‹_maö
.
cou¡îs
) - 1;

1093 
	`vec_vÆid©e_Æig√d
 (
ﬁd_cou¡îs
, 
j
, 
CLIB_CACHE_LINE_BYTES
);

1094 
	`vec_vÆid©e_Æig√d
 (
ﬁd_cou¡îs_Æl_˛ór
, 
j
, 
CLIB_CACHE_LINE_BYTES
);

1095 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs
 = 
ﬁd_cou¡îs
;

1096 
vm_˛⁄e
->
îr‹_maö
.
cou¡îs_œ°_˛ór
 = 
ﬁd_cou¡îs_Æl_˛ór
;

1098 
nm_˛⁄e
 = &
vm_˛⁄e
->
node_maö
;

1099 
	`vec_‰ì
 (
nm_˛⁄e
->
√xt_‰ames
);

1100 
nm_˛⁄e
->
√xt_‰ames
 = 
	`vec_dup
 (
nm
->next_frames);

1102 
j
 = 0; j < 
	`vec_Àn
 (
nm_˛⁄e
->
√xt_‰ames
); j++)

1104 
vlib_√xt_‰ame_t
 *
nf
 = &
nm_˛⁄e
->
√xt_‰ames
[
j
];

1105 
u32
 
ßve_node_ru¡ime_ödex
;

1106 
u32
 
ßve_Êags
;

1108 
ßve_node_ru¡ime_ödex
 = 
nf
->
node_ru¡ime_ödex
;

1109 
ßve_Êags
 = 
nf
->
Êags
 & 
VLIB_FRAME_NO_FREE_AFTER_DISPATCH
;

1110 
	`vlib_√xt_‰ame_öô
 (
nf
);

1111 
nf
->
node_ru¡ime_ödex
 = 
ßve_node_ru¡ime_ödex
;

1112 
nf
->
Êags
 = 
ßve_Êags
;

1115 
ﬁd_nodes_˛⁄e
 = 
nm_˛⁄e
->
nodes
;

1116 
nm_˛⁄e
->
nodes
 = 0;

1121 
√w_n_˛⁄e
 =

1122 
	`˛ib_mem_Æloc_no_Áû
 (
	`vec_Àn
 (
nm
->
nodes
Ë*  (*
√w_n_˛⁄e
));

1123 
j
 = 0; j < 
	`vec_Àn
 (
nm
->
nodes
); j++)

1125 
vlib_node_t
 *
ﬁd_n_˛⁄e
;

1126 
vlib_node_t
 *
√w_n
;

1128 
√w_n
 = 
nm
->
nodes
[
j
];

1129 
ﬁd_n_˛⁄e
 = 
ﬁd_nodes_˛⁄e
[
j
];

1131 
	`˛ib_mem˝y
 (
√w_n_˛⁄e
, 
√w_n
,  (*new_n));

1133 
√w_n_˛⁄e
->
ow√r_node_ödex
 = 
VLIB_INVALID_NODE_INDEX
;

1135 i‡(
j
 >
	`vec_Àn
 (
ﬁd_nodes_˛⁄e
))

1138 
	`mem£t
 (&
√w_n_˛⁄e
->
°©s_tŸÆ
, 0,

1139  (
√w_n_˛⁄e
->
°©s_tŸÆ
));

1140 
	`mem£t
 (&
√w_n_˛⁄e
->
°©s_œ°_˛ór
, 0,

1141  (
√w_n_˛⁄e
->
°©s_œ°_˛ór
));

1146 
	`˛ib_mem˝y
 (&
√w_n_˛⁄e
->
°©s_tŸÆ
,

1147 &
ﬁd_n_˛⁄e
->
°©s_tŸÆ
,

1148  (
√w_n_˛⁄e
->
°©s_tŸÆ
));

1149 
	`˛ib_mem˝y
 (&
√w_n_˛⁄e
->
°©s_œ°_˛ór
,

1150 &
ﬁd_n_˛⁄e
->
°©s_œ°_˛ór
,

1151  (
√w_n_˛⁄e
->
°©s_œ°_˛ór
));

1154 
√w_n_˛⁄e
->
°©e
 = 
ﬁd_n_˛⁄e
->state;

1156 
	`vec_add1
 (
nm_˛⁄e
->
nodes
, 
√w_n_˛⁄e
);

1157 
√w_n_˛⁄e
++;

1160 
	`˛ib_mem_‰ì
 (
ﬁd_nodes_˛⁄e
[0]);

1162 
	`vec_‰ì
 (
ﬁd_nodes_˛⁄e
);

1166 
ﬁd_π
 = 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
];

1167 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
] =

1168 
	`vec_dup
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
]);

1170 
	`vec_f‹óch
 (
π
, 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INTERNAL
])

1172 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
π
->
node_ödex
);

1173 
π
->
thªad_ödex
 = 
vm_˛⁄e
->thread_index;

1175 i‡(
n
->
ru¡ime_d©a
 &&Ç->
ru¡ime_d©a_byãs
 > 0)

1176 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
n
->runtime_data,

1177 
	`˛ib_mö
 (
VLIB_NODE_RUNTIME_DATA_SIZE
,

1178 
n
->
ru¡ime_d©a_byãs
));

1181 
j
 = 0; j < 
	`vec_Àn
 (
ﬁd_π
); j++)

1183 
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm_˛⁄e
, 
ﬁd_π
[
j
].
node_ödex
);

1184 
π
->
°©e
 = 
ﬁd_π
[
j
].state;

1185 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
ﬁd_π
[
j
].runtime_data,

1186 
VLIB_NODE_RUNTIME_DATA_SIZE
);

1189 
	`vec_‰ì
 (
ﬁd_π
);

1192 
ﬁd_π
 = 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
];

1193 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
] =

1194 
	`vec_dup
 (
nm
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
]);

1196 
	`vec_f‹óch
 (
π
, 
nm_˛⁄e
->
nodes_by_ty≥
[
VLIB_NODE_TYPE_INPUT
])

1198 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
π
->
node_ödex
);

1199 
π
->
thªad_ödex
 = 
vm_˛⁄e
->thread_index;

1201 i‡(
n
->
ru¡ime_d©a
 &&Ç->
ru¡ime_d©a_byãs
 > 0)

1202 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
n
->runtime_data,

1203 
	`˛ib_mö
 (
VLIB_NODE_RUNTIME_DATA_SIZE
,

1204 
n
->
ru¡ime_d©a_byãs
));

1207 
j
 = 0; j < 
	`vec_Àn
 (
ﬁd_π
); j++)

1209 
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm_˛⁄e
, 
ﬁd_π
[
j
].
node_ödex
);

1210 
π
->
°©e
 = 
ﬁd_π
[
j
].state;

1211 
	`˛ib_mem˝y
 (
π
->
ru¡ime_d©a
, 
ﬁd_π
[
j
].runtime_data,

1212 
VLIB_NODE_RUNTIME_DATA_SIZE
);

1215 
	`vec_‰ì
 (
ﬁd_π
);

1217 
nm_˛⁄e
->
¥o˚s£s
 = 
	`vec_dup
 (
nm
->processes);

1218 
	}
}

1221 
	$vlib_w‹kî_thªad_node_ru¡ime_upd©e
 ()

1227 
vlib_globÆ_maö
.
√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
 = 1;

1228 
	}
}

1230 
u32


1231 
	$unf‹m©_sched_pﬁicy
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
)

1233 
u32
 *
r
 = 
	`va_¨g
 (*
¨gs
, u32 *);

1236 
	#_
(
v
,
f
,
s
Ëi‡(
	`unf‹m©
 (
öput
, s)Ë*
r
 = 
SCHED_POLICY_
##f;

	)

1237 
f‹óch_sched_pﬁicy


1238 #unde‡
_


1242 
	}
}

1244 
˛ib_îr‹_t
 *

1245 
	$˝u_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

1247 
vlib_thªad_ªgi°øti⁄_t
 *
å
;

1248 
uw‹d
 *
p
;

1249 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

1250 
u8
 *
«me
;

1251 
u64
 
c‹emask
;

1252 
uw‹d
 *
bôm≠
;

1253 
u32
 
cou¡
;

1255 
tm
->
thªad_ªgi°øti⁄s_by_«me
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

1257 
tm
->
n_thªad_°acks
 = 1;

1258 
tm
->
sched_pﬁicy
 = ~0;

1259 
tm
->
sched_¥i‹ôy
 = ~0;

1261 
å
 = 
tm
->
√xt
;

1263 
å
)

1265 
	`hash_£t_mem
 (
tm
->
thªad_ªgi°øti⁄s_by_«me
, 
å
->
«me
, (
uw‹d
)År);

1266 
å
 =År->
√xt
;

1269 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

1271 i‡(
	`unf‹m©
 (
öput
, "use-pthreads"))

1272 
tm
->
u£_±hªads
 = 1;

1273 i‡(
	`unf‹m©
 (
öput
, "thªad-¥efix %v", &
tm
->
thªad_¥efix
))

1275 i‡(
	`unf‹m©
 (
öput
, "maö-c‹ê%u", &
tm
->
maö_lc‹e
))

1277 i‡(
	`unf‹m©
 (
öput
, "skù-c‹e†%u", &
tm
->
skù_c‹es
))

1279 i‡(
	`unf‹m©
 (
öput
, "c‹emask-%†%Œx", &
«me
, &
c‹emask
))

1281 
p
 = 
	`hash_gë_mem
 (
tm
->
thªad_ªgi°øti⁄s_by_«me
, 
«me
);

1282 i‡(
p
 == 0)

1283  
	`˛ib_îr‹_ªtu∫
 (0, "nÿsuchÅhªadÅy≥ '%s'", 
«me
);

1285 
å
 = (
vlib_thªad_ªgi°øti⁄_t
 *Ë
p
[0];

1287 i‡(
å
->
u£_±hªads
)

1288  
	`˛ib_îr‹_ªtu∫
 (0,

1290 
«me
);

1292 
å
->
c‹emask
 = 
˛ib_bôm≠_£t_mu…ùÀ


1293 (
å
->
c‹emask
, 0, c‹emask, 
	`BITS
 (coremask));

1294 
å
->
cou¡
 = 
	`˛ib_bôm≠_cou¡_£t_bôs
 (å->
c‹emask
);

1296 i‡(
	`unf‹m©
 (
öput
, "c‹ñi°-%†%U", &
«me
, 
unf‹m©_bôm≠_li°
,

1297 &
bôm≠
))

1299 
p
 = 
	`hash_gë_mem
 (
tm
->
thªad_ªgi°øti⁄s_by_«me
, 
«me
);

1300 i‡(
p
 == 0)

1301  
	`˛ib_îr‹_ªtu∫
 (0, "nÿsuchÅhªadÅy≥ '%s'", 
«me
);

1303 
å
 = (
vlib_thªad_ªgi°øti⁄_t
 *Ë
p
[0];

1305 i‡(
å
->
u£_±hªads
)

1306  
	`˛ib_îr‹_ªtu∫
 (0,

1308 
«me
);

1310 
å
->
c‹emask
 = 
bôm≠
;

1311 
å
->
cou¡
 = 
	`˛ib_bôm≠_cou¡_£t_bôs
 (å->
c‹emask
);

1314 i‡(
unf‹m©


1315 (
öput
, "scheduÀr-pﬁicy %U", 
unf‹m©_sched_pﬁicy
,

1316 &
tm
->
sched_pﬁicy
))

1318 i‡(
	`unf‹m©
 (
öput
, "scheduÀr-¥i‹ôy %u", &
tm
->
sched_¥i‹ôy
))

1320 i‡(
	`unf‹m©
 (
öput
, "%†%u", &
«me
, &
cou¡
))

1322 
p
 = 
	`hash_gë_mem
 (
tm
->
thªad_ªgi°øti⁄s_by_«me
, 
«me
);

1323 i‡(
p
 == 0)

1324  
	`˛ib_îr‹_ªtu∫
 (0, "nÿsuchÅhªadÅy≥ 3 '%s'", 
«me
);

1326 
å
 = (
vlib_thªad_ªgi°øti⁄_t
 *Ë
p
[0];

1327 i‡(
å
->
fixed_cou¡
)

1328  
˛ib_îr‹_ªtu∫


1329 (0, "numbî o‡%†thªad†nŸ c⁄figuøbÀ", 
å
->
«me
);

1330 
å
->
cou¡
 = count;

1336 i‡(
tm
->
sched_¥i‹ôy
 != ~0)

1338 i‡(
tm
->
sched_pﬁicy
 =
SCHED_FIFO
 ||Åm->sched_pﬁicy =
SCHED_RR
)

1340 
u32
 
¥io_max
 = 
	`sched_gë_¥i‹ôy_max
 (
tm
->
sched_pﬁicy
);

1341 
u32
 
¥io_mö
 = 
	`sched_gë_¥i‹ôy_mö
 (
tm
->
sched_pﬁicy
);

1342 i‡(
tm
->
sched_¥i‹ôy
 > 
¥io_max
)

1343 
tm
->
sched_¥i‹ôy
 = 
¥io_max
;

1344 i‡(
tm
->
sched_¥i‹ôy
 < 
¥io_mö
)

1345 
tm
->
sched_¥i‹ôy
 = 
¥io_mö
;

1349  
˛ib_îr‹_ªtu∫


1352 
tm
->
sched_¥i‹ôy
);

1355 
å
 = 
tm
->
√xt
;

1357 i‡(!
tm
->
thªad_¥efix
)

1358 
tm
->
thªad_¥efix
 = 
	`f‹m©
 (0, "vpp");

1360 
å
)

1362 
tm
->
n_thªad_°acks
 +
å
->
cou¡
;

1363 
tm
->
n_±hªads
 +
å
->
cou¡
 *År->
u£_±hªads
;

1364 
tm
->
n_thªads
 +
å
->
cou¡
 * (å->
u£_±hªads
 == 0);

1365 
å
 =År->
√xt
;

1369 
	}
}

1371 
VLIB_EARLY_CONFIG_FUNCTION
 (
˝u_c⁄fig
, "cpu");

1373 #i‡!
deföed
 (
__x86_64__
Ë&& !deföed (
__i386__
Ë&& !deföed (
__Ørch64__
Ë&& !deföed (
__powîpc64__
Ë&& !deföed(
__¨m__
)

1375 
	$__sync_„tch_™d_add_8
 ()

1377 
	`ff‹m©
 (
°dîr
, "%†ˇŒed\n", 
__FUNCTION__
);

1378 
	`ab‹t
 ();

1379 
	}
}

1382 
	$__sync_add_™d_„tch_8
 ()

1384 
	`ff‹m©
 (
°dîr
, "%†ˇŒed\n", 
__FUNCTION__
);

1385 
	`ab‹t
 ();

1386 
	}
}

1389 
	$v√t_maö_fixup
 (
vlib_f‹k_fixup_t
 
which
Ë
	`__©åibuã__
 ((
wók
));

1391 
	$v√t_maö_fixup
 (
vlib_f‹k_fixup_t
 
which
)

1393 
	}
}

1396 
	$vlib_w‹kî_thªad_f‹k_fixup
 (
vlib_f‹k_fixup_t
 
which
)

1398 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

1400 i‡(
vlib_maös
 == 0)

1403 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

1404 
	`vlib_w‹kî_thªad_b¨rõr_sync
 (
vm
);

1406 
which
)

1408 
VLIB_WORKER_THREAD_FORK_FIXUP_NEW_SW_IF_INDEX
:

1409 
	`v√t_maö_fixup
 (
VLIB_WORKER_THREAD_FORK_FIXUP_NEW_SW_IF_INDEX
);

1413 
	`ASSERT
 (0);

1415 
	`vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vm
);

1416 
	}
}

1425 #i‚de‡
BARRIER_MINIMUM_OPEN_LIMIT


1426 
	#BARRIER_MINIMUM_OPEN_LIMIT
 0.001

	)

1429 #i‚de‡
BARRIER_MINIMUM_OPEN_FACTOR


1430 
	#BARRIER_MINIMUM_OPEN_FACTOR
 3

	)

1434 
	$vlib_w‹kî_thªad_b¨rõr_sync_öt
 (
vlib_maö_t
 * 
vm
)

1436 
f64
 
dódlöe
;

1437 
f64
 
now
;

1438 
f64
 
t_íåy
;

1439 
f64
 
t_›í
;

1440 
f64
 
t_˛o£d
;

1441 
u32
 
cou¡
;

1443 i‡(
	`vec_Àn
 (
vlib_maös
) < 2)

1446 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

1448 
cou¡
 = 
	`vec_Àn
 (
vlib_maös
) - 1;

1451 
now
 = 
	`vlib_time_now
 (
vm
);

1452 
t_íåy
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1455 i‡(++
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
 > 1)

1457 
	`b¨rõr_åa˚_sync_ªc
 (
t_íåy
);

1461 
vlib_w‹kî_thªads
[0].
b¨rõr_sync_cou¡
++;

1464 
	`ASSERT
 (
vm
->
b¨rõr_no_˛o£_bef‹e
 <(
now
 + 
BARRIER_MINIMUM_OPEN_LIMIT
));

1465 (
now
 = 
	`vlib_time_now
 (
vm
)Ë< vm->
b¨rõr_no_˛o£_bef‹e
)

1469 
t_›í
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1470 
vm
->
b¨rõr_ïoch
 = 
now
;

1472 
dódlöe
 = 
now
 + 
BARRIER_SYNC_TIMEOUT
;

1474 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 = 1;

1475 *
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
 !
cou¡
)

1477 i‡((
now
 = 
	`vlib_time_now
 (
vm
)Ë> 
dódlöe
)

1479 
	`ff‹m©
 (
°dîr
, "%s: w‹kîÅhªad dódlock\n", 
__FUNCTION__
);

1480 
	`os_∑nic
 ();

1484 
t_˛o£d
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1486 
	`b¨rõr_åa˚_sync
 (
t_íåy
, 
t_›í
, 
t_˛o£d
);

1488 
	}
}

1491 
	$vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vlib_maö_t
 * 
vm
)

1493 
f64
 
dódlöe
;

1494 
f64
 
now
;

1495 
f64
 
möimum_›í
;

1496 
f64
 
t_íåy
;

1497 
f64
 
t_˛o£d_tŸÆ
;

1498 
f64
 
t_upd©e_maö
 = 0.0;

1499 
ªf‹k_√eded
 = 0;

1501 i‡(
	`vec_Àn
 (
vlib_maös
) < 2)

1504 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

1507 
now
 = 
	`vlib_time_now
 (
vm
);

1508 
t_íåy
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1510 i‡(--
vlib_w‹kî_thªads
[0].
ªcursi⁄_Àvñ
 > 0)

1512 
	`b¨rõr_åa˚_ªÀa£_ªc
 (
t_íåy
);

1517 i‡(
vm
->
√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
)

1520 
	`w‹kî_thªad_node_ru¡ime_upd©e_öã∫Æ
 ();

1521 
vm
->
√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
 = 0;

1524 
ªf‹k_√eded
 = 1;

1525 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
,

1526 (
	`vec_Àn
 (
vlib_maös
) - 1));

1527 
now
 = 
	`vlib_time_now
 (
vm
);

1528 
t_upd©e_maö
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1531 
dódlöe
 = 
now
 + 
BARRIER_SYNC_TIMEOUT
;

1533 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
 = 0;

1535 *
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
 > 0)

1537 i‡((
now
 = 
	`vlib_time_now
 (
vm
)Ë> 
dódlöe
)

1539 
	`ff‹m©
 (
°dîr
, "%s: w‹kîÅhªad dódlock\n", 
__FUNCTION__
);

1540 
	`os_∑nic
 ();

1545 i‡(
ªf‹k_√eded
)

1547 
now
 = 
	`vlib_time_now
 (
vm
);

1549 
dódlöe
 = 
now
 + 
BARRIER_SYNC_TIMEOUT
;

1551 *
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
 > 0)

1553 i‡((
now
 = 
	`vlib_time_now
 (
vm
)Ë> 
dódlöe
)

1555 
	`ff‹m©
 (
°dîr
, "%s: workerÅhreadÑefork deadlock\n",

1556 
__FUNCTION__
);

1557 
	`os_∑nic
 ();

1562 
t_˛o£d_tŸÆ
 = 
now
 - 
vm
->
b¨rõr_ïoch
;

1564 
möimum_›í
 = 
t_˛o£d_tŸÆ
 * 
BARRIER_MINIMUM_OPEN_FACTOR
;

1566 i‡(
möimum_›í
 > 
BARRIER_MINIMUM_OPEN_LIMIT
)

1568 
möimum_›í
 = 
BARRIER_MINIMUM_OPEN_LIMIT
;

1571 
vm
->
b¨rõr_no_˛o£_bef‹e
 = 
now
 + 
möimum_›í
;

1574 
vm
->
b¨rõr_ïoch
 = 
now
;

1576 
	`b¨rõr_åa˚_ªÀa£
 (
t_íåy
, 
t_˛o£d_tŸÆ
, 
t_upd©e_maö
);

1578 
	}
}

1586 
	$vlib_‰ame_queue_dequeue
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_queue_maö_t
 * 
fqm
)

1588 
u32
 
thªad_id
 = 
vm
->
thªad_ödex
;

1589 
vlib_‰ame_queue_t
 *
fq
 = 
fqm
->
vlib_‰ame_queues
[
thªad_id
];

1590 
vlib_‰ame_queue_ñt_t
 *
ñt
;

1591 
u32
 *
‰om
, *
to
;

1592 
vlib_‰ame_t
 *
f
;

1593 
msg_ty≥
;

1594 
¥o˚s£d
 = 0;

1595 
u32
 
n_À·_to_node
;

1596 
u32
 
ve˘‹s
 = 0;

1598 
	`ASSERT
 (
fq
);

1599 
	`ASSERT
 (
vm
 =
vlib_maös
[
thªad_id
]);

1601 i‡(
	`PREDICT_FALSE
 (
fqm
->
node_ödex
 == ~0))

1606 i‡(
	`PREDICT_FALSE
 (
fq
->
åa˚
))

1608 
‰ame_queue_åa˚_t
 *
fqt
;

1609 
‰ame_queue_√…_cou¡î_t
 *
fqh
;

1610 
u32
 
ñix
;

1612 
fqt
 = &
fqm
->
‰ame_queue_åa˚s
[
thªad_id
];

1614 
fqt
->
√…s
 = 
fq
->nelts;

1615 
fqt
->
hód
 = 
fq
->head;

1616 
fqt
->
hód_höt
 = 
fq
->head_hint;

1617 
fqt
->
èû
 = 
fq
->tail;

1618 
fqt
->
thªshﬁd
 = 
fq
->
ve˘‹_thªshﬁd
;

1619 
fqt
->
n_ö_u£
 = fqt->
èû
 - fqt->
hód
;

1620 i‡(
fqt
->
n_ö_u£
 >fqt->
√…s
)

1623 
fqt
->
n_ö_u£
 = fqt->
√…s
 - 1;

1627 
fqh
 = &
fqm
->
‰ame_queue_hi°ogøm
[
thªad_id
];

1628 
fqh
->
cou¡
[
fqt
->
n_ö_u£
]++;

1631 
ñix
 = 0;Élix < 
fqt
->
√…s
;Élix++)

1633 
ñt
 = 
fq
->
ñts
 + ((fq->
hód
 + 1 + 
ñix
Ë& (fq->
√…s
 - 1));

1634 i‡(1 || 
ñt
->
vÆid
)

1636 
fqt
->
n_ve˘‹s
[
ñix
] = 
ñt
->n_vectors;

1639 
fqt
->
wrôãn
 = 1;

1644 i‡(
fq
->
hód
 =fq->
èû
)

1646 
fq
->
hód_höt
 = fq->
hód
;

1647  
¥o˚s£d
;

1650 
ñt
 = 
fq
->
ñts
 + ((fq->
hód
 + 1Ë& (fq->
√…s
 - 1));

1652 i‡(!
ñt
->
vÆid
)

1654 
fq
->
hód_höt
 = fq->
hód
;

1655  
¥o˚s£d
;

1658 
‰om
 = 
ñt
->
buf„r_ödex
;

1659 
msg_ty≥
 = 
ñt
->msg_type;

1661 
	`ASSERT
 (
msg_ty≥
 =
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
);

1662 
	`ASSERT
 (
ñt
->
n_ve˘‹s
 <
VLIB_FRAME_SIZE
);

1664 
f
 = 
	`vlib_gë_‰ame_to_node
 (
vm
, 
fqm
->
node_ödex
);

1666 
to
 = 
	`vlib_‰ame_ve˘‹_¨gs
 (
f
);

1668 
n_À·_to_node
 = 
ñt
->
n_ve˘‹s
;

1670 
n_À·_to_node
 >= 4)

1672 
to
[0] = 
‰om
[0];

1673 
to
[1] = 
‰om
[1];

1674 
to
[2] = 
‰om
[2];

1675 
to
[3] = 
‰om
[3];

1676 
to
 += 4;

1677 
‰om
 += 4;

1678 
n_À·_to_node
 -= 4;

1681 
n_À·_to_node
 > 0)

1683 
to
[0] = 
‰om
[0];

1684 
to
++;

1685 
‰om
++;

1686 
n_À·_to_node
--;

1689 
ve˘‹s
 +
ñt
->
n_ve˘‹s
;

1690 
f
->
n_ve˘‹s
 = 
ñt
->n_vectors;

1691 
	`vlib_put_‰ame_to_node
 (
vm
, 
fqm
->
node_ödex
, 
f
);

1693 
ñt
->
vÆid
 = 0;

1694 
ñt
->
n_ve˘‹s
 = 0;

1695 
ñt
->
msg_ty≥
 = 0xfefefefe;

1696 
	`CLIB_MEMORY_BARRIER
 ();

1697 
fq
->
hód
++;

1698 
¥o˚s£d
++;

1703 i‡(
ve˘‹s
 >
fq
->
ve˘‹_thªshﬁd
)

1705 
fq
->
hód_höt
 = fq->
hód
;

1706  
¥o˚s£d
;

1709 
	`ASSERT
 (0);

1710  
¥o˚s£d
;

1711 
	}
}

1714 
	$vlib_w‹kî_thªad_‚
 (*
¨g
)

1716 
vlib_w‹kî_thªad_t
 *
w
 = (vlib_w‹kî_thªad_à*Ë
¨g
;

1717 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

1718 
vlib_maö_t
 *
vm
 = 
	`vlib_gë_maö
 ();

1719 
˛ib_îr‹_t
 *
e
;

1721 
	`ASSERT
 (
vm
->
thªad_ödex
 =
	`vlib_gë_thªad_ödex
 ());

1723 
	`vlib_w‹kî_thªad_öô
 (
w
);

1724 
	`˛ib_time_öô
 (&
vm
->
˛ib_time
);

1725 
	`˛ib_mem_£t_hóp
 (
w
->
thªad_mhóp
);

1728 
tm
->
exã∫_thªad_mgmt
 &&Åm->
w‹kî_thªad_ªÀa£
 == 0)

1729 
	`vlib_w‹kî_thªad_b¨rõr_check
 ();

1731 
e
 = 
vlib_ˇŒ_öô_exô_fun˘i⁄s


1732 (
vm
, vm->
w‹kî_öô_fun˘i⁄_ªgi°øti⁄s
, 1 );

1733 i‡(
e
)

1734 
	`˛ib_îr‹_ªp‹t
 (
e
);

1736 
	`vlib_w‹kî_lo›
 (
vm
);

1737 
	}
}

1740 
VLIB_REGISTER_THREAD
 (
w‹kî_thªad_ªg
, ) = {

1741 .
«me
 = "workers",

1742 .
	gsh‹t_«me
 = "wk",

1743 .
	gfun˘i⁄
 = 
vlib_w‹kî_thªad_‚
,

1747 
u32


1748 
	$vlib_‰ame_queue_maö_öô
 (
u32
 
node_ödex
, u32 
‰ame_queue_√…s
)

1750 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

1751 
vlib_‰ame_queue_maö_t
 *
fqm
;

1752 
vlib_‰ame_queue_t
 *
fq
;

1753 
i
;

1755 i‡(
‰ame_queue_√…s
 == 0)

1756 
‰ame_queue_√…s
 = 
FRAME_QUEUE_NELTS
;

1758 
	`vec_add2
 (
tm
->
‰ame_queue_maös
, 
fqm
, 1);

1760 
fqm
->
node_ödex
 =Çode_index;

1762 
	`vec_vÆid©e
 (
fqm
->
vlib_‰ame_queues
, 
tm
->
n_vlib_maös
 - 1);

1763 
	`_vec_Àn
 (
fqm
->
vlib_‰ame_queues
) = 0;

1764 
i
 = 0; i < 
tm
->
n_vlib_maös
; i++)

1766 
fq
 = 
	`vlib_‰ame_queue_Æloc
 (
‰ame_queue_√…s
);

1767 
	`vec_add1
 (
fqm
->
vlib_‰ame_queues
, 
fq
);

1770  (
fqm
 - 
tm
->
‰ame_queue_maös
);

1771 
	}
}

1774 
	$vlib_thªad_cb_ªgi°î
 (
vlib_maö_t
 *
vm
, 
vlib_thªad_ˇŒbacks_t
 * 
cb
)

1776 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

1778 i‡(
tm
->
exã∫_thªad_mgmt
)

1781 
tm
->
cb
.
vlib_œunch_thªad_cb
 = cb->vlib_launch_thread_cb;

1782 
tm
->
exã∫_thªad_mgmt
 = 1;

1784 
	}
}

1787 
	$vlib_¥o˚ss_sig«l_evít_mt_hñ≥r
 (
vlib_¥o˚ss_sig«l_evít_mt_¨gs_t
 *

1788 
¨gs
)

1790 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

1791 
	`vlib_¥o˚ss_sig«l_evít
 (
	`vlib_gë_maö
 (), 
¨gs
->
node_ödex
,

1792 
¨gs
->
ty≥_›aque
,árgs->
d©a
);

1793 
	}
}

1795 *
	gΩc_ˇŒ_maö_thªad_cb_‚
;

1798 
	$vlib_Ωc_ˇŒ_maö_thªad
 (*
ˇŒback
, 
u8
 * 
¨gs
, 
u32
 
¨g_size
)

1800 i‡(
Ωc_ˇŒ_maö_thªad_cb_‚
)

1802 (*
Â
Ë(*, 
u8
 *, 
u32
Ë
Ωc_ˇŒ_maö_thªad_cb_‚
;

1803 (*
Â
Ë(
ˇŒback
, 
¨gs
, 
¨g_size
);

1806 
	`˛ib_w¨nög
 ("BUG:Ñpc_call_main_thread_cb_fn NULL!");

1807 
	}
}

1809 
˛ib_îr‹_t
 *

1810 
	$thªads_öô
 (
vlib_maö_t
 * 
vm
)

1813 
	}
}

1815 
VLIB_INIT_FUNCTION
 (
thªads_öô
);

	@threads.h

15 #i‚de‡
ö˛uded_vlib_thªads_h


16 
	#ö˛uded_vlib_thªads_h


	)

18 
	~<vlib/maö.h
>

19 
	~<löux/sched.h
>

37 
vlib_maö_t
 **
vlib_maös
;

39 
vlib_£t_thªad_«me
 (*
«me
);

42 (
	tvlib_thªad_fun˘i⁄_t
Ë(*
	t¨g
);

44 
	svlib_thªad_ªgi°øti⁄_


47 
vlib_thªad_ªgi°øti⁄_
 *
√xt
;

50 *
«me
;

51 *
sh‹t_«me
;

52 
vlib_thªad_fun˘i⁄_t
 *
fun˘i⁄
;

53 
uw‹d
 
mhóp_size
;

54 
fixed_cou¡
;

55 
u32
 
cou¡
;

56 
no_d©a_°ru˘uª_˛⁄e
;

57 
u32
 
‰ame_queue_√…s
;

60 
u£_±hªads
;

61 
u32
 
fú°_ödex
;

62 
uw‹d
 *
c‹emask
;

63 } 
	tvlib_thªad_ªgi°øti⁄_t
;

70 #i‚de‡
VLIB_MAX_CPUS


71 
	#VLIB_MAX_CPUS
 256

	)

74 #i‡
VLIB_MAX_CPUS
 > 
CLIB_MAX_MHEAPS


75 #îr‹ 
PÀa£
 
ö¸ó£
 
numbî
 
of
 
≥r
-
˝u
 
mhóps


78 
	#VLIB_CPU_MASK
 (
VLIB_MAX_CPUS
 - 1Ë

	)

79 
	#VLIB_OFFSET_MASK
 (~
VLIB_CPU_MASK
)

	)

81 
	#VLIB_LOG2_THREAD_STACK_SIZE
 (21)

	)

82 
	#VLIB_THREAD_STACK_SIZE
 (1<<
VLIB_LOG2_THREAD_STACK_SIZE
)

	)

86 
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
,

87 } 
	tvlib_‰ame_queue_msg_ty≥_t
;

91 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

92 vﬁ©ûê
u32
 
vÆid
;

93 
u32
 
msg_ty≥
;

94 
u32
 
n_ve˘‹s
;

95 
u32
 
œ°_n_ve˘‹s
;

98 
u32
 
buf„r_ödex
[
VLIB_FRAME_SIZE
];

100 
	tvlib_‰ame_queue_ñt_t
;

105 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

106 vﬁ©ûê
u32
 *
waô_©_b¨rõr
;

107 vﬁ©ûê
u32
 *
w‹kîs_©_b¨rõr
;

110 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

111 *
thªad_mhóp
;

112 
u8
 *
thªad_°ack
;

113 (*
thªad_fun˘i⁄
) (*);

114 *
thªad_fun˘i⁄_¨g
;

115 
i64
 
ªcursi⁄_Àvñ
;

116 
ñog_åack_t
 
ñog_åack
;

117 
u32
 
ö°™˚_id
;

118 
vlib_thªad_ªgi°øti⁄_t
 *
ªgi°øti⁄
;

119 
u8
 *
«me
;

120 
u64
 
b¨rõr_sync_cou¡
;

121 #ifde‡
BARRIER_TRACING


122 c⁄° *
b¨rõr_ˇŒî
;

123 c⁄° *
b¨rõr_c⁄ãxt
;

125 vﬁ©ûê
u32
 *
node_ªf‹ks_ªquúed
;

127 
lwp
;

128 
lc‹e_id
;

129 
±hªad_t
 
thªad_id
;

130 } 
	tvlib_w‹kî_thªad_t
;

132 
vlib_w‹kî_thªad_t
 *
vlib_w‹kî_thªads
;

137 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

138 vﬁ©ûê
u64
 
èû
;

139 
u64
 
íqueues
;

140 
u64
 
íqueue_ticks
;

141 
u64
 
íqueue_ve˘‹s
;

142 
u32
 
íqueue_fuŒ_evíts
;

145 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

146 vﬁ©ûê
u64
 
hód
;

147 
u64
 
dequeues
;

148 
u64
 
dequeue_ticks
;

149 
u64
 
dequeue_ve˘‹s
;

150 
u64
 
åa˚
;

151 
u64
 
ve˘‹_thªshﬁd
;

154 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe2
);

155 vﬁ©ûê
u64
 
hód_höt
;

158 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe3
);

159 
vlib_‰ame_queue_ñt_t
 *
ñts
;

160 
u32
 
√…s
;

162 
	tvlib_‰ame_queue_t
;

166 
u32
 
node_ödex
;

167 
vlib_‰ame_queue_t
 **
vlib_‰ame_queues
;

170 
‰ame_queue_åa˚_t
 *
‰ame_queue_åa˚s
;

171 
‰ame_queue_√…_cou¡î_t
 *
‰ame_queue_hi°ogøm
;

172 } 
	tvlib_‰ame_queue_maö_t
;

176 
uw‹d
 
node_ödex
;

177 
uw‹d
 
ty≥_›aque
;

178 
uw‹d
 
d©a
;

179 } 
	tvlib_¥o˚ss_sig«l_evít_mt_¨gs_t
;

182 
˛ib_îr‹_t
 *
	`vlib_thªad_öô
 (
vlib_maö_t
 * 
vm
);

184 
	`vlib_‰ame_queue_íqueue
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ru¡ime_ödex
,

185 
u32
 
‰ame_queue_ödex
, 
vlib_‰ame_t
 * 
‰ame
,

186 
vlib_‰ame_queue_msg_ty≥_t
 
ty≥
);

189 
	`vlib_‰ame_queue_dequeue
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_queue_maö_t
 * 
fqm
);

191 
	`vlib_w‹kî_thªad_node_ru¡ime_upd©e
 ();

193 
	`vlib_¸óã_w‹kî_thªads
 (
vlib_maö_t
 * 
vm
, 
n
,

194 (*
thªad_fun˘i⁄
) (*));

196 
	`vlib_w‹kî_thªad_öô
 (
vlib_w‹kî_thªad_t
 * 
w
);

197 
u32
 
	`vlib_‰ame_queue_maö_öô
 (u32 
node_ödex
, u32 
‰ame_queue_√…s
);

200 
	#BARRIER_SYNC_DELAY
 (0.030000)

	)

202 #i‡
CLIB_DEBUG
 > 0

204 
	#BARRIER_SYNC_TIMEOUT
 (600.1)

	)

206 
	#BARRIER_SYNC_TIMEOUT
 (1.0)

	)

209 #ifde‡
BARRIER_TRACING


210 
	#vlib_w‹kî_thªad_b¨rõr_sync
(
X
Ë{
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
=
__FUNCTION__
;
	`vlib_w‹kî_thªad_b¨rõr_sync_öt
(X);
	}

	)
}

212 
	#vlib_w‹kî_thªad_b¨rõr_sync
(
X
Ë
	`vlib_w‹kî_thªad_b¨rõr_sync_öt
(X)

	)

216 
vlib_w‹kî_thªad_b¨rõr_sync_öt
 (
vlib_maö_t
 * 
vm
);

217 
vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vlib_maö_t
 * 
vm
);

218 
vlib_w‹kî_thªad_node_ªf‹k
 ();

220 
°©ic_Æways_ölöe
 
uw‹d


221 
	$vlib_gë_thªad_ödex
 ()

223  
__os_thªad_ödex
;

224 
	}
}

226 
Æways_ölöe
 

227 
	$vlib_smp_unß„_w¨nög
 ()

229 i‡(
CLIB_DEBUG
 > 0)

231 i‡(
	`vlib_gë_thªad_ödex
 ())

232 
	`ff‹m©
 (
°dîr
, "%s: SMP unß„ w¨nög...\n", 
__FUNCTION__
);

234 
	}
}

238 
	mVLIB_WORKER_THREAD_FORK_FIXUP_ILLEGAL
 = 0,

239 
	mVLIB_WORKER_THREAD_FORK_FIXUP_NEW_SW_IF_INDEX
,

240 } 
	tvlib_f‹k_fixup_t
;

242 
vlib_w‹kî_thªad_f‹k_fixup
 (
vlib_f‹k_fixup_t
 
which
);

244 
	#f‹óch_vlib_maö
(
body
) \

246 
vlib_maö_t
 ** 
__vlib_maös
 = 0, *
this_vlib_maö
; \

247 
ii
; \

249 
ii
 = 0; iò< 
	`vec_Àn
 (
vlib_maös
); ii++) \

251 
this_vlib_maö
 = 
vlib_maös
[
ii
]; \

252 
	`ASSERT
 (
ii
 == 0 || \

253 
this_vlib_maö
->
∑rked_©_b¨rõr
 == 1); \

254 i‡(
this_vlib_maö
) \

255 
	`vec_add1
 (
__vlib_maös
, 
this_vlib_maö
); \

258 
ii
 = 0; iò< 
	`vec_Àn
 (
__vlib_maös
); ii++) \

260 
this_vlib_maö
 = 
__vlib_maös
[
ii
]; \

262 (
body
); \

264 
	`vec_‰ì
 (
__vlib_maös
); \

265 } 0);

	)

267 
	#f‹óch_sched_pﬁicy
 \

268 
	`_
(
SCHED_OTHER
, 
OTHER
, "other") \

269 
	`_
(
SCHED_BATCH
, 
BATCH
, "batch") \

270 
	`_
(
SCHED_IDLE
, 
IDLE
, "idle") \

271 
	`_
(
SCHED_FIFO
, 
FIFO
, "fifo") \

272 
	`_
(
SCHED_RR
, 
RR
, "º")

	)

276 
	#_
(
v
,
f
,
s
Ë
SCHED_POLICY_
##‡v,

	)

277 
	mf‹óch_sched_pﬁicy


278 #unde‡
_


279 
	mSCHED_POLICY_N
,

280 } 
	tsched_pﬁicy_t
;

284 
	m˛ib_îr‹_t
 *(*
	mvlib_œunch_thªad_cb
Ë(*
	mÂ
, 
vlib_w‹kî_thªad_t
 * 
	mw
,

285 
	mlc‹e_id
);

286 
	m˛ib_îr‹_t
 *(*
	mvlib_thªad_£t_lc‹e_cb
Ë(
u32
 
	mthªad
, 
u16
 
	mlc‹e
);

287 } 
	tvlib_thªad_ˇŒbacks_t
;

292 
vlib_thªad_ªgi°øti⁄_t
 *
	m√xt
;

295 
vlib_thªad_ªgi°øti⁄_t
 **
	mªgi°øti⁄s
;

297 
uw‹d
 *
	mthªad_ªgi°øti⁄s_by_«me
;

299 
vlib_w‹kî_thªad_t
 *
	mw‹kî_thªads
;

305 
	mu£_±hªads
;

308 
u32
 
	mn_vlib_maös
;

311 
u32
 
	mn_thªad_°acks
;

314 
u32
 
	mn_±hªads
;

317 
u32
 
	mn_thªads
;

320 
u32
 
	mskù_c‹es
;

323 
u8
 *
	mthªad_¥efix
;

326 
u8
 
	mmaö_lc‹e
;

329 
uw‹d
 *
	m˝u_c‹e_bôm≠
;

332 
uw‹d
 *
	m˝u_sockë_bôm≠
;

335 
vlib_‰ame_queue_maö_t
 *
	m‰ame_queue_maös
;

338 vﬁ©ûê
u32
 
	mw‹kî_thªad_ªÀa£
;

341 
u32
 
	msched_pﬁicy
;

344 
u32
 
	msched_¥i‹ôy
;

347 
vlib_thªad_ˇŒbacks_t
 
	mcb
;

348 
	mexã∫_thªad_mgmt
;

349 } 
	tvlib_thªad_maö_t
;

351 
vlib_thªad_maö_t
 
vlib_thªad_maö
;

353 
	~<vlib/globÆ_funcs.h
>

355 
	#VLIB_REGISTER_THREAD
(
x
,...) \

356 
__VA_ARGS__
 
vlib_thªad_ªgi°øti⁄_t
 
x
; \

357 
__vlib_add_thªad_ªgi°øti⁄_
##
	`x
 () \

358 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

359 
__vlib_add_thªad_ªgi°øti⁄_
##
	`x
 () \

361 
vlib_thªad_maö_t
 * 
tm
 = &
vlib_thªad_maö
; \

362 
x
.
√xt
 = 
tm
->next; \

363 
tm
->
√xt
 = &
x
; \

365 
__VA_ARGS__
 
vlib_thªad_ªgi°øti⁄_t
 
x


	)

367 
Æways_ölöe
 
u32


368 
	$vlib_num_w‹kîs
 ()

370  
vlib_thªad_maö
.
n_vlib_maös
 - 1;

371 
	}
}

373 
Æways_ölöe
 
u32


374 
	$vlib_gë_w‹kî_thªad_ödex
 (
u32
 
w‹kî_ödex
)

376  
w‹kî_ödex
 + 1;

377 
	}
}

379 
Æways_ölöe
 
u32


380 
	$vlib_gë_w‹kî_ödex
 (
u32
 
thªad_ödex
)

382  
thªad_ödex
 - 1;

383 
	}
}

385 
Æways_ölöe
 
u32


386 
	$vlib_gë_cuºít_w‹kî_ödex
 ()

388  
	`vlib_gë_thªad_ödex
 () - 1;

389 
	}
}

391 
ölöe
 

392 
	$vlib_w‹kî_thªad_b¨rõr_check
 ()

394 i‡(
	`PREDICT_FALSE
 (*
vlib_w‹kî_thªads
->
waô_©_b¨rõr
))

396 
vlib_maö_t
 *
vm
;

397 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, 1);

398 i‡(
CLIB_DEBUG
 > 0)

400 
vm
 = 
	`vlib_gë_maö
 ();

401 
vm
->
∑rked_©_b¨rõr
 = 1;

403 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
)

405 i‡(
CLIB_DEBUG
 > 0)

406 
vm
->
∑rked_©_b¨rõr
 = 0;

407 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, -1);

409 i‡(
	`PREDICT_FALSE
 (*
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
))

411 
	`vlib_w‹kî_thªad_node_ªf‹k
 ();

412 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
,

414 *
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
)

418 
	}
}

420 
Æways_ölöe
 
vlib_maö_t
 *

421 
	$vlib_gë_w‹kî_vlib_maö
 (
u32
 
w‹kî_ödex
)

423 
vlib_maö_t
 *
vm
;

424 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

425 
	`ASSERT
 (
w‹kî_ödex
 < 
tm
->
n_vlib_maös
 - 1);

426 
vm
 = 
vlib_maös
[
w‹kî_ödex
 + 1];

427 
	`ASSERT
 (
vm
);

428  
vm
;

429 
	}
}

431 
ölöe
 

432 
	$vlib_put_‰ame_queue_ñt
 (
vlib_‰ame_queue_ñt_t
 * 
hf
)

434 
	`CLIB_MEMORY_BARRIER
 ();

435 
hf
->
vÆid
 = 1;

436 
	}
}

438 
ölöe
 
vlib_‰ame_queue_ñt_t
 *

439 
	$vlib_gë_‰ame_queue_ñt
 (
u32
 
‰ame_queue_ödex
, u32 
ödex
)

441 
vlib_‰ame_queue_t
 *
fq
;

442 
vlib_‰ame_queue_ñt_t
 *
ñt
;

443 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

444 
vlib_‰ame_queue_maö_t
 *
fqm
 =

445 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
‰ame_queue_ödex
);

446 
u64
 
√w_èû
;

448 
fq
 = 
fqm
->
vlib_‰ame_queues
[
ödex
];

449 
	`ASSERT
 (
fq
);

451 
√w_èû
 = 
	`__sync_add_™d_„tch
 (&
fq
->
èû
, 1);

454 
√w_èû
 >
fq
->
hód_höt
 + fq->
√…s
)

455 
	`vlib_w‹kî_thªad_b¨rõr_check
 ();

457 
ñt
 = 
fq
->
ñts
 + (
√w_èû
 & (fq->
√…s
 - 1));

460 
ñt
->
vÆid
)

463 
ñt
->
msg_ty≥
 = 
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
;

464 
ñt
->
œ°_n_ve˘‹s
 =É…->
n_ve˘‹s
 = 0;

466  
ñt
;

467 
	}
}

469 
ölöe
 
vlib_‰ame_queue_t
 *

470 
	$is_vlib_‰ame_queue_c⁄ge°ed
 (
u32
 
‰ame_queue_ödex
,

471 
u32
 
ödex
,

472 
u32
 
queue_hi_thªsh
,

473 
vlib_‰ame_queue_t
 **

474 
h™doff_queue_by_w‹kî_ödex
)

476 
vlib_‰ame_queue_t
 *
fq
;

477 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

478 
vlib_‰ame_queue_maö_t
 *
fqm
 =

479 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
‰ame_queue_ödex
);

481 
fq
 = 
h™doff_queue_by_w‹kî_ödex
[
ödex
];

482 i‡(
fq
 !(
vlib_‰ame_queue_t
 *) (~0))

483  
fq
;

485 
fq
 = 
fqm
->
vlib_‰ame_queues
[
ödex
];

486 
	`ASSERT
 (
fq
);

488 i‡(
	`PREDICT_FALSE
 (
fq
->
èû
 >(fq->
hód_höt
 + 
queue_hi_thªsh
)))

493 
h™doff_queue_by_w‹kî_ödex
[
ödex
] = 
fq
;

494 
fq
->
íqueue_fuŒ_evíts
++;

495  
fq
;

498  
NULL
;

499 
	}
}

501 
ölöe
 
vlib_‰ame_queue_ñt_t
 *

502 
	$vlib_gë_w‹kî_h™doff_queue_ñt
 (
u32
 
‰ame_queue_ödex
,

503 
u32
 
vlib_w‹kî_ödex
,

504 
vlib_‰ame_queue_ñt_t
 **

505 
h™doff_queue_ñt_by_w‹kî_ödex
)

507 
vlib_‰ame_queue_ñt_t
 *
ñt
;

509 i‡(
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
])

510  
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
];

512 
ñt
 = 
	`vlib_gë_‰ame_queue_ñt
 (
‰ame_queue_ödex
, 
vlib_w‹kî_ödex
);

514 
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
] = 
ñt
;

516  
ñt
;

517 
	}
}

519 
u8
 *
vlib_thªad_°ack_öô
 (
uw‹d
 
thªad_ödex
);

520 
vlib_thªad_cb_ªgi°î
 (
vlib_maö_t
 *
vm
,

521 
vlib_thªad_ˇŒbacks_t
 * 
cb
);

522 *
Ωc_ˇŒ_maö_thªad_cb_‚
;

525 
vlib_¥o˚ss_sig«l_evít_mt_hñ≥r
 (
vlib_¥o˚ss_sig«l_evít_mt_¨gs_t
 *

526 
¨gs
);

527 
vlib_Ωc_ˇŒ_maö_thªad
 (*
fun˘i⁄
, 
u8
 * 
¨gs
, 
u32
 
size
);

	@threads_cli.c

15 
	#_GNU_SOURCE


	)

17 
	~<vµö‰a/f‹m©.h
>

18 
	~<vµö‰a/löux/sysfs.h
>

19 
	~<vlib/vlib.h
>

21 
	~<vlib/thªads.h
>

22 
	~<vlib/unix/unix.h
>

24 
u8
 *

25 
	$f‹m©_sched_pﬁicy_™d_¥i‹ôy
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

27 
i
 = 
	`va_¨g
 (*
¨gs
, );

28 
sched_∑øm
 sched_param;

29 
u8
 *
t
 = 0;

31 
	`sched_gëscheduÀr
 (
i
))

33 
	#_
(
v
,
f
,
°r
Ë
SCHED_POLICY_
##f: 
t
 = (
u8
 *Ë°r; ;

	)

34 
f‹óch_sched_pﬁicy


35 #unde‡
_


37 i‡(
	`sched_gë∑øm
 (
i
, &
sched_∑øm
) == 0)

38  
	`f‹m©
 (
s
, "%†(%d)", 
t
, 
sched_∑øm
.
sched_¥i‹ôy
);

40  
	`f‹m©
 (
s
, "%†“/a)", 
t
);

41 
	}
}

43 
˛ib_îr‹_t
 *

44 
	$show_thªads_‚
 (
vlib_maö_t
 * 
vm
,

45 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

47 
vlib_w‹kî_thªad_t
 *
w
;

48 
i
;

50 
	`vlib_˛i_ouçut
 (
vm
, "%-7s%-20s%-12s%-8s%-25s%-7s%-7s%-7s%-10s",

54 #i‡!
	`deföed
(
__powîpc64__
)

55 
i
 = 0; i < 
	`vec_Àn
 (
vlib_w‹kî_thªads
); i++)

57 
w
 = 
vlib_w‹kî_thªads
 + 
i
;

58 
u8
 *
löe
 = 
NULL
;

60 
löe
 = 
	`f‹m©
 (line, "%-7d%-20s%-12s%-8d",

61 
i
,

62 
w
->
«me
 ? w->«mê: (
u8
 *) "",

63 
w
->
ªgi°øti⁄
 ? w->ªgi°øti⁄->
«me
 : "", w->
lwp
);

65 
löe
 = 
	`f‹m©
 (löe, "%-25U", 
f‹m©_sched_pﬁicy_™d_¥i‹ôy
, 
w
->
lwp
);

67 
lc‹e
 = -1;

68 
˝u_£t_t
 
˝u£t
;

69 
	`CPU_ZERO
 (&
˝u£t
);

70 
ªt
 = -1;

72 
ªt
 =

73 
	`±hªad_gëafföôy_≈
 (
w
->
thªad_id
,  (
˝u_£t_t
), &
˝u£t
);

74 i‡(!
ªt
)

76 
c
;

77 
c
 = 0; c < 
CPU_SETSIZE
; c++)

78 i‡(
	`CPU_ISSET
 (
c
, &
˝u£t
))

80 i‡(
lc‹e
 > -1)

82 
lc‹e
 = -2;

85 
lc‹e
 = 
c
;

90 
lc‹e
 = 
w
->
lc‹e_id
;

93 i‡(
lc‹e
 > -1)

95 c⁄° *
sys_˝u_∑th
 = "/sys/devices/system/cpu/cpu";

96 
sockë_id
 = -1;

97 
c‹e_id
 = -1;

98 
u8
 *
p
 = 0;

100 
p
 = 
	`f‹m©
 (p, "%s%u/t›ﬁogy/c‹e_id%c", 
sys_˝u_∑th
, 
lc‹e
, 0);

101 
	`˛ib_sysfs_ªad
 ((*Ë
p
, "%d", &
c‹e_id
);

103 
	`vec_ª£t_Àngth
 (
p
);

104 
p
 =

105 
	`f‹m©
 (
p
,

107 
sys_˝u_∑th
, 
lc‹e
, 0);

108 
	`˛ib_sysfs_ªad
 ((*Ë
p
, "%d", &
sockë_id
);

109 
	`vec_‰ì
 (
p
);

111 
löe
 = 
	`f‹m©
 (löe, "%-7u%-7u%-7u%", 
lc‹e
, 
c‹e_id
, 
sockë_id
);

115 
löe
 =

116 
	`f‹m©
 (
löe
, "%-7s%-7s%-7s%", (
lc‹e
 == -2) ? "M" : "n/a", "n/a",

120 
	`vlib_˛i_ouçut
 (
vm
, "%v", 
löe
);

121 
	`vec_‰ì
 (
löe
);

126 
	}
}

130 
VLIB_CLI_COMMAND
 (
show_thªads_comm™d
, ) = {

131 .
∑th
 = "showÅhreads",

132 .
	gsh‹t_hñp
 = "ShowÅhreads",

133 .
	gfun˘i⁄
 = 
show_thªads_‚
,

140 
˛ib_îr‹_t
 *

141 
	$åa˚_‰ame_queue
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

142 
vlib_˛i_comm™d_t
 * 
cmd
)

144 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

145 
˛ib_îr‹_t
 *
îr‹
 = 
NULL
;

146 
‰ame_queue_åa˚_t
 *
fqt
;

147 
‰ame_queue_√…_cou¡î_t
 *
fqh
;

148 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

149 
vlib_‰ame_queue_maö_t
 *
fqm
;

150 
u32
 
num_fq
;

151 
u32
 
fqix
;

152 
u32
 
íabÀ
 = 2;

153 
u32
 
ödex
 = ~(u32) 0;

155 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

158 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

160 i‡(
	`unf‹m©
 (
löe_öput
, "on"))

161 
íabÀ
 = 1;

162 i‡(
	`unf‹m©
 (
löe_öput
, "off"))

163 
íabÀ
 = 0;

164 i‡(
	`unf‹m©
 (
löe_öput
, "ödex %u", &
ödex
))

168 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "parseÉrror: '%U'",

169 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

170 
d⁄e
;

174 i‡(
íabÀ
 > 1)

176 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "expecting on or off");

177 
d⁄e
;

180 i‡(
	`vec_Àn
 (
tm
->
‰ame_queue_maös
) == 0)

182 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "no worker handoffsÉxist");

183 
d⁄e
;

186 i‡(
ödex
 > 
	`vec_Àn
 (
tm
->
‰ame_queue_maös
) - 1)

188 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0,

190 
d⁄e
;

193 
fqm
 = 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
ödex
);

195 
num_fq
 = 
	`vec_Àn
 (
fqm
->
vlib_‰ame_queues
);

196 i‡(
num_fq
 == 0)

198 
	`vlib_˛i_ouçut
 (
vm
, "No frame queuesÉxist\n");

199 
d⁄e
;

203 
	`vec_vÆid©e_Æig√d
 (
fqm
->
‰ame_queue_åa˚s
, 
num_fq
 - 1,

204 
CLIB_CACHE_LINE_BYTES
);

205 
	`vec_vÆid©e_Æig√d
 (
fqm
->
‰ame_queue_hi°ogøm
, 
num_fq
 - 1,

206 
CLIB_CACHE_LINE_BYTES
);

208 
fqix
 = 0; fqix < 
num_fq
; fqix++)

210 
fqt
 = &
fqm
->
‰ame_queue_åa˚s
[
fqix
];

211 
fqh
 = &
fqm
->
‰ame_queue_hi°ogøm
[
fqix
];

213 
	`mem£t
 (
fqt
->
n_ve˘‹s
, 0xff,  (fqt->n_vectors));

214 
fqt
->
wrôãn
 = 0;

215 
	`mem£t
 (
fqh
, 0,  (*fqh));

216 
fqm
->
vlib_‰ame_queues
[
fqix
]->
åa˚
 = 
íabÀ
;

219 
d⁄e
:

220 
	`unf‹m©_‰ì
 (
löe_öput
);

222  
îr‹
;

223 
	}
}

226 
VLIB_CLI_COMMAND
 (
cmd_åa˚_‰ame_queue
,) = {

227 .
∑th
 = "trace frame-queue",

228 .
	gsh‹t_hñp
 = "trace frame-queue (on|off)",

229 .
	gfun˘i⁄
 = 
åa˚_‰ame_queue
,

230 .
	gis_mp_ß„
 = 1,

239 
u32


240 
	$compuã_≥r˚¡
 (
u64
 * 
two_cou¡îs
, u64 
tŸÆ
)

242 i‡(
tŸÆ
 == 0)

248  (((
two_cou¡îs
[0] +Åwo_counters[1]) * 100) +

249 (
tŸÆ
 - 1)) /Åotal;

251 
	}
}

256 
˛ib_îr‹_t
 *

257 
	$show_‰ame_queue_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

258 
vlib_‰ame_queue_maö_t
 * 
fqm
, 
u32
 
hi°ogøm
)

260 
˛ib_îr‹_t
 *
îr‹
 = 
NULL
;

261 
‰ame_queue_åa˚_t
 *
fqt
;

262 
‰ame_queue_√…_cou¡î_t
 *
fqh
;

263 
u32
 
num_fq
;

264 
u32
 
fqix
;

266 
num_fq
 = 
	`vec_Àn
 (
fqm
->
‰ame_queue_åa˚s
);

267 i‡(
num_fq
 == 0)

269 
	`vlib_˛i_ouçut
 (
vm
, "NoÅrace data for frame queues\n");

270  
îr‹
;

273 i‡(
hi°ogøm
)

275 
	`vlib_˛i_ouçut
 (
vm
, "0-1 2-3 4-5 6-7 8-9 10-11 12-13 14-15 "

279 
fqix
 = 0; fqix < 
num_fq
; fqix++)

281 
fqt
 = &(
fqm
->
‰ame_queue_åa˚s
[
fqix
]);

283 
	`vlib_˛i_ouçut
 (
vm
, "Thªad %d %v\n", 
fqix
,

284 
vlib_w‹kî_thªads
[
fqix
].
«me
);

286 i‡(
fqt
->
wrôãn
 == 0)

288 
	`vlib_˛i_ouçut
 (
vm
, "ÇoÅrace data\n");

292 i‡(
hi°ogøm
)

294 
fqh
 = &(
fqm
->
‰ame_queue_hi°ogøm
[
fqix
]);

295 
u32
 
√…
;

296 
u64
 
tŸÆ
 = 0;

298 
√…
 = 0;Çñà< 
FRAME_QUEUE_MAX_NELTS
;Çelt++)

300 
tŸÆ
 +
fqh
->
cou¡
[
√…
];

310 
	`vlib_˛i_ouçut
 (
vm
,

313 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[0], 
tŸÆ
),

314 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[2], 
tŸÆ
),

315 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[4], 
tŸÆ
),

316 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[6], 
tŸÆ
),

317 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[8], 
tŸÆ
),

318 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[10], 
tŸÆ
),

319 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[12], 
tŸÆ
),

320 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[14], 
tŸÆ
),

321 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[16], 
tŸÆ
),

322 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[18], 
tŸÆ
),

323 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[20], 
tŸÆ
),

324 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[22], 
tŸÆ
),

325 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[24], 
tŸÆ
),

326 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[26], 
tŸÆ
),

327 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[28], 
tŸÆ
),

328 
	`compuã_≥r˚¡
 (&
fqh
->
cou¡
[30], 
tŸÆ
));

332 
	`vlib_˛i_ouçut
 (
vm
,

334 
fqt
->
thªshﬁd
, fqt->
√…s
, fqt->
n_ö_u£
);

335 
	`vlib_˛i_ouçut
 (
vm
, " head %12d head_hint %12dÅail %12d\n",

336 
fqt
->
hód
, fqt->
hód_höt
, fqt->
èû
);

337 
	`vlib_˛i_ouçut
 (
vm
,

339 
fqt
->
n_ve˘‹s
[0], fqt->n_vectors[1],

340 
fqt
->
n_ve˘‹s
[2], fqt->n_vectors[3],

341 
fqt
->
n_ve˘‹s
[4], fqt->n_vectors[5],

342 
fqt
->
n_ve˘‹s
[6], fqt->n_vectors[7],

343 
fqt
->
n_ve˘‹s
[8], fqt->n_vectors[9],

344 
fqt
->
n_ve˘‹s
[10], fqt->n_vectors[11],

345 
fqt
->
n_ve˘‹s
[12], fqt->n_vectors[13],

346 
fqt
->
n_ve˘‹s
[14], fqt->n_vectors[15]);

348 i‡(
fqt
->
√…s
 > 16)

350 
	`vlib_˛i_ouçut
 (
vm
,

352 
fqt
->
n_ve˘‹s
[16], fqt->n_vectors[17],

353 
fqt
->
n_ve˘‹s
[18], fqt->n_vectors[19],

354 
fqt
->
n_ve˘‹s
[20], fqt->n_vectors[21],

355 
fqt
->
n_ve˘‹s
[22], fqt->n_vectors[23],

356 
fqt
->
n_ve˘‹s
[24], fqt->n_vectors[25],

357 
fqt
->
n_ve˘‹s
[26], fqt->n_vectors[27],

358 
fqt
->
n_ve˘‹s
[28], fqt->n_vectors[29],

359 
fqt
->
n_ve˘‹s
[30], fqt->n_vectors[31]);

364  
îr‹
;

365 
	}
}

367 
˛ib_îr‹_t
 *

368 
	$show_‰ame_queue_åa˚
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

369 
vlib_˛i_comm™d_t
 * 
cmd
)

371 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

372 
vlib_‰ame_queue_maö_t
 *
fqm
;

373 
˛ib_îr‹_t
 *
îr‹
;

375 
	`vec_f‹óch
 (
fqm
, 
tm
->
‰ame_queue_maös
)

377 
	`vlib_˛i_ouçut
 (
vm
, "Worker handoff queue index %u (nextÇode '%U'):",

378 
fqm
 - 
tm
->
‰ame_queue_maös
,

379 
f‹m©_vlib_node_«me
, 
vm
, 
fqm
->
node_ödex
);

380 
îr‹
 = 
	`show_‰ame_queue_öã∫Æ
 (
vm
, 
fqm
, 0);

381 i‡(
îr‹
)

382  
îr‹
;

385 
	}
}

387 
˛ib_îr‹_t
 *

388 
	$show_‰ame_queue_hi°ogøm
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

389 
vlib_˛i_comm™d_t
 * 
cmd
)

391 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

392 
vlib_‰ame_queue_maö_t
 *
fqm
;

393 
˛ib_îr‹_t
 *
îr‹
;

395 
	`vec_f‹óch
 (
fqm
, 
tm
->
‰ame_queue_maös
)

397 
	`vlib_˛i_ouçut
 (
vm
, "Worker handoff queue index %u (nextÇode '%U'):",

398 
fqm
 - 
tm
->
‰ame_queue_maös
,

399 
f‹m©_vlib_node_«me
, 
vm
, 
fqm
->
node_ödex
);

400 
îr‹
 = 
	`show_‰ame_queue_öã∫Æ
 (
vm
, 
fqm
, 1);

401 i‡(
îr‹
)

402  
îr‹
;

405 
	}
}

408 
VLIB_CLI_COMMAND
 (
cmd_show_‰ame_queue_åa˚
,) = {

409 .
∑th
 = "show frame-queue",

410 .
	gsh‹t_hñp
 = "show frame-queueÅrace",

411 .
	gfun˘i⁄
 = 
show_‰ame_queue_åa˚
,

416 
VLIB_CLI_COMMAND
 (
cmd_show_‰ame_queue_hi°ogøm
,) = {

417 .
∑th
 = "show frame-queue histogram",

418 .
	gsh‹t_hñp
 = "show frame-queue histogram",

419 .
	gfun˘i⁄
 = 
show_‰ame_queue_hi°ogøm
,

427 
˛ib_îr‹_t
 *

428 
	$ã°_‰ame_queue_√…s
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

429 
vlib_˛i_comm™d_t
 * 
cmd
)

431 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

432 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

433 
vlib_‰ame_queue_maö_t
 *
fqm
;

434 
˛ib_îr‹_t
 *
îr‹
 = 
NULL
;

435 
u32
 
num_fq
;

436 
u32
 
fqix
;

437 
u32
 
√…s
 = 0;

438 
u32
 
ödex
 = ~(u32) 0;

440 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

443 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

445 i‡(
	`unf‹m©
 (
löe_öput
, "√…†%u", &
√…s
))

447 i‡(
	`unf‹m©
 (
löe_öput
, "ödex %u", &
ödex
))

451 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "parseÉrror: '%U'",

452 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

453 
d⁄e
;

457 i‡(
ödex
 > 
	`vec_Àn
 (
tm
->
‰ame_queue_maös
) - 1)

459 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0,

461 
d⁄e
;

464 
fqm
 = 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
ödex
);

466 i‡((
√…s
 != 4) && (nelts != 8) && (nelts != 16) && (nelts != 32))

468 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "expecting 4,8,16,32");

469 
d⁄e
;

472 
num_fq
 = 
	`vec_Àn
 (
fqm
->
vlib_‰ame_queues
);

473 i‡(
num_fq
 == 0)

475 
	`vlib_˛i_ouçut
 (
vm
, "No frame queuesÉxist\n");

476 
d⁄e
;

479 
fqix
 = 0; fqix < 
num_fq
; fqix++)

481 
fqm
->
vlib_‰ame_queues
[
fqix
]->
√…s
 =Çelts;

484 
d⁄e
:

485 
	`unf‹m©_‰ì
 (
löe_öput
);

487  
îr‹
;

488 
	}
}

491 
VLIB_CLI_COMMAND
 (
cmd_ã°_‰ame_queue_√…s
,) = {

492 .
∑th
 = "test frame-queueÇelts",

493 .
	gsh‹t_hñp
 = "test frame-queueÇelts (4,8,16,32)",

494 .
	gfun˘i⁄
 = 
ã°_‰ame_queue_√…s
,

502 
˛ib_îr‹_t
 *

503 
	$ã°_‰ame_queue_thªshﬁd
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
,

504 
vlib_˛i_comm™d_t
 * 
cmd
)

506 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

507 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

508 
vlib_‰ame_queue_maö_t
 *
fqm
;

509 
˛ib_îr‹_t
 *
îr‹
 = 
NULL
;

510 
u32
 
num_fq
;

511 
u32
 
fqix
;

512 
u32
 
thªshﬁd
 = ~(u32) 0;

513 
u32
 
ödex
 = ~(u32) 0;

515 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

518 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

520 i‡(
	`unf‹m©
 (
löe_öput
, "thªshﬁd %u", &
thªshﬁd
))

522 i‡(
	`unf‹m©
 (
löe_öput
, "ödex %u", &
ödex
))

526 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "parseÉrror: '%U'",

527 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

528 
d⁄e
;

532 i‡(
ödex
 > 
	`vec_Àn
 (
tm
->
‰ame_queue_maös
) - 1)

534 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0,

536 
d⁄e
;

539 
fqm
 = 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
ödex
);

542 i‡(
thªshﬁd
 =~(
u32
) 0)

544 
	`vlib_˛i_ouçut
 (
vm
, "expectingÅhreshold value\n");

545 
d⁄e
;

548 i‡(
thªshﬁd
 == 0)

549 
thªshﬁd
 = ~0;

551 
num_fq
 = 
	`vec_Àn
 (
fqm
->
vlib_‰ame_queues
);

552 i‡(
num_fq
 == 0)

554 
	`vlib_˛i_ouçut
 (
vm
, "No frame queuesÉxist\n");

555 
d⁄e
;

558 
fqix
 = 0; fqix < 
num_fq
; fqix++)

560 
fqm
->
vlib_‰ame_queues
[
fqix
]->
ve˘‹_thªshﬁd
 = 
thªshﬁd
;

563 
d⁄e
:

564 
	`unf‹m©_‰ì
 (
löe_öput
);

566  
îr‹
;

567 
	}
}

570 
VLIB_CLI_COMMAND
 (
cmd_ã°_‰ame_queue_thªshﬁd
,) = {

571 .
∑th
 = "test frame-queueÅhreshold",

572 .
	gsh‹t_hñp
 = "test frame-queueÅhreshold N (0=noÜimit)",

573 .
	gfun˘i⁄
 = 
ã°_‰ame_queue_thªshﬁd
,

	@trace.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/thªads.h
>

45 
	$vlib_åa˚_‰ame_buf„rs_⁄ly
 (
vlib_maö_t
 * 
vm
,

46 
vlib_node_ru¡ime_t
 * 
node
,

47 
u32
 * 
buf„rs
,

48 
uw‹d
 
n_buf„rs
,

49 
uw‹d
 
√xt_buf„r_°ride
,

50 
uw‹d
 
n_buf„r_d©a_byãs_ö_åa˚
)

52 
u32
 
n_À·
, *
‰om
;

54 
n_À·
 = 
n_buf„rs
;

55 
‰om
 = 
buf„rs
;

57 
n_À·
 >= 4)

59 
u32
 
bi0
, 
bi1
;

60 
vlib_buf„r_t
 *
b0
, *
b1
;

61 
u8
 *
t0
, *
t1
;

64 
	`vlib_¥e„tch_buf„r_wôh_ödex
 (
vm
, 
‰om
[2], 
LOAD
);

65 
	`vlib_¥e„tch_buf„r_wôh_ödex
 (
vm
, 
‰om
[3], 
LOAD
);

67 
bi0
 = 
‰om
[0];

68 
bi1
 = 
‰om
[1];

70 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi0
);

71 
b1
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi1
);

73 i‡(
b0
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
)

75 
t0
 = 
	`vlib_add_åa˚
 (
vm
, 
node
, 
b0
, 
n_buf„r_d©a_byãs_ö_åa˚
);

76 
	`˛ib_mem˝y
 (
t0
, 
b0
->
d©a
 + b0->
cuºít_d©a
,

77 
n_buf„r_d©a_byãs_ö_åa˚
);

79 i‡(
b1
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
)

81 
t1
 = 
	`vlib_add_åa˚
 (
vm
, 
node
, 
b1
, 
n_buf„r_d©a_byãs_ö_åa˚
);

82 
	`˛ib_mem˝y
 (
t1
, 
b1
->
d©a
 + b1->
cuºít_d©a
,

83 
n_buf„r_d©a_byãs_ö_åa˚
);

85 
‰om
 += 2;

86 
n_À·
 -= 2;

89 
n_À·
 >= 1)

91 
u32
 
bi0
;

92 
vlib_buf„r_t
 *
b0
;

93 
u8
 *
t0
;

95 
bi0
 = 
‰om
[0];

97 
b0
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi0
);

99 i‡(
b0
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
)

101 
t0
 = 
	`vlib_add_åa˚
 (
vm
, 
node
, 
b0
, 
n_buf„r_d©a_byãs_ö_åa˚
);

102 
	`˛ib_mem˝y
 (
t0
, 
b0
->
d©a
 + b0->
cuºít_d©a
,

103 
n_buf„r_d©a_byãs_ö_åa˚
);

105 
‰om
 += 1;

106 
n_À·
 -= 1;

108 
	}
}

111 
Æways_ölöe
 

112 
	$˛ór_åa˚_buf„r
 ()

114 
i
;

115 
vlib_åa˚_maö_t
 *
tm
;

118 
	`f‹óch_vlib_maö
 (

120 *
maöhóp
;

122 
tm
 = &
this_vlib_maö
->
åa˚_maö
;

123 
maöhóp
 = 
	`˛ib_mem_£t_hóp
 (
this_vlib_maö
->
hóp_ba£
);

125 
tm
->
åa˚_a˘ive_höt
 = 0;

127 
i
 = 0; i < 
	`vec_Àn
 (
tm
->
åa˚_buf„r_poﬁ
); i++)

128 i‡(! 
	`poﬁ_is_‰ì_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
i
))

129 
	`vec_‰ì
 (
tm
->
åa˚_buf„r_poﬁ
[
i
]);

130 
	`poﬁ_‰ì
 (
tm
->
åa˚_buf„r_poﬁ
);

131 
	`˛ib_mem_£t_hóp
 (
maöhóp
);

134 
	}
}

136 
u8
 *

137 
	$f‹m©_vlib_åa˚
 (
u8
 * 
s
, 
va_li°
 * 
va
)

139 
vlib_maö_t
 *
vm
 = 
	`va_¨g
 (*
va
, vlib_main_t *);

140 
vlib_åa˚_hódî_t
 *
h
 = 
	`va_¨g
 (*
va
, vlib_trace_header_t *);

141 
vlib_åa˚_hódî_t
 *
e
 = 
	`vec_íd
 (
h
);

142 
vlib_node_t
 *
node
, *
¥ev_node
;

143 
˛ib_time_t
 *
˘
 = &
vm
->
˛ib_time
;

144 
f64
 
t
;

146 
¥ev_node
 = 0;

147 
h
 < 
e
)

149 
node
 = 
	`vlib_gë_node
 (
vm
, 
h
->
node_ödex
);

151 i‡(
node
 !
¥ev_node
)

153 
t
 =

154 (
h
->
time
 - 
vm
->
˝u_time_maö_lo›_°¨t
Ë* 
˘
->
£c⁄ds_≥r_˛ock
;

155 
s
 =

156 
	`f‹m©
 (
s
, "\n%U: %v", 
f‹m©_time_öãrvÆ
, "h:m:s:u", 
t
,

157 
node
->
«me
);

159 
¥ev_node
 = 
node
;

161 i‡(
node
->
f‹m©_åa˚
)

162 
s
 = 
	`f‹m©
 (s, "\¿ %U", 
node
->
f‹m©_åa˚
, 
vm
,Çode, 
h
->
d©a
);

164 
s
 = 
	`f‹m©
 (s, "\¿ %U", 
node
->
f‹m©_buf„r
, 
h
->
d©a
);

166 
h
 = 
	`vlib_åa˚_hódî_√xt
 (h);

169  
s
;

170 
	}
}

174 
VLIB_CLI_COMMAND
 (
åa˚_˛i_comm™d
,) = {

175 .
∑th
 = "trace",

176 .
	gsh‹t_hñp
 = "PacketÅracer commands",

181 
	$åa˚_cmp
 (*
a1
, *
a2
)

183 
vlib_åa˚_hódî_t
 **
t1
 = 
a1
;

184 
vlib_åa˚_hódî_t
 **
t2
 = 
a2
;

185 
i64
 
dt
 = 
t1
[0]->
time
 - 
t2
[0]->time;

186  
dt
 < 0 ? -1 : (dt > 0 ? +1 : 0);

187 
	}
}

192 
u32


193 
	$fûãr_ac˚±
 (
vlib_åa˚_maö_t
 * 
tm
, 
vlib_åa˚_hódî_t
 * 
h
)

195 
vlib_åa˚_hódî_t
 *
e
 = 
	`vec_íd
 (
h
);

197 i‡(
tm
->
fûãr_Êag
 == 0)

200 i‡(
tm
->
fûãr_Êag
 =
FILTER_FLAG_INCLUDE
)

202 
h
 < 
e
)

204 i‡(
h
->
node_ödex
 =
tm
->
fûãr_node_ödex
)

206 
h
 = 
	`vlib_åa˚_hódî_√xt
 (h);

212 
h
 < 
e
)

214 i‡(
h
->
node_ödex
 =
tm
->
fûãr_node_ödex
)

216 
h
 = 
	`vlib_åa˚_hódî_√xt
 (h);

222 
	}
}

228 
	$åa˚_≠∂y_fûãr
 (
vlib_maö_t
 * 
vm
)

230 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

231 
vlib_åa˚_hódî_t
 **
h
;

232 
vlib_åa˚_hódî_t
 ***
åa˚s_to_ªmove
 = 0;

233 
u32
 
ödex
;

234 
u32
 
åa˚_ödex
;

235 
u32
 
n_ac˚±ed
;

237 
u32
 
ac˚±
;

239 i‡(
tm
->
fûãr_Êag
 =
FILTER_FLAG_NONE
)

246 
n_ac˚±ed
 = 0;

248 
	`poﬁ_f‹óch
 (
h
, 
tm
->
åa˚_buf„r_poﬁ
,

250 
ac˚±
 = 
	`fûãr_ac˚±
(
tm
, 
h
[0]);

252 i‡((
n_ac˚±ed
 =
tm
->
fûãr_cou¡
Ë|| !
ac˚±
)

253 
	`vec_add1
 (
åa˚s_to_ªmove
, 
h
);

255 
n_ac˚±ed
++;

260 
ödex
 = 0; index < 
	`vec_Àn
 (
åa˚s_to_ªmove
); index++)

262 
åa˚_ödex
 = 
åa˚s_to_ªmove
[
ödex
] - 
tm
->
åa˚_buf„r_poﬁ
;

263 
	`_vec_Àn
 (
tm
->
åa˚_buf„r_poﬁ
[
åa˚_ödex
]) = 0;

264 
	`poﬁ_put_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
åa˚_ödex
);

267 
	`vec_‰ì
 (
åa˚s_to_ªmove
);

268 
	}
}

270 
˛ib_îr‹_t
 *

271 
	$˛i_show_åa˚_buf„r
 (
vlib_maö_t
 * 
vm
,

272 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

274 
vlib_åa˚_maö_t
 *
tm
;

275 
vlib_åa˚_hódî_t
 **
h
, **
åa˚s
;

276 
u32
 
i
, 
ödex
 = 0;

277 *
fmt
;

278 
u8
 *
s
 = 0;

279 
u32
 
max
;

285 
max
 = 50;

286 
	`unf‹m©_check_öput
 (
öput
Ë!(
uw‹d
Ë
UNFORMAT_END_OF_INPUT
)

288 i‡(
	`unf‹m©
 (
öput
, "max %d", &
max
))

291  
	`˛ib_îr‹_¸óã
 ("expected 'max COUNT', got `%U'",

292 
f‹m©_unf‹m©_îr‹
, 
öput
);

299 
	`f‹óch_vlib_maö
 (

301 *
maöhóp
;

303 
fmt
 = "------------------- Start ofÅhread %d %s -------------------\n";

304 
s
 = 
	`f‹m©
 (s, 
fmt
, 
ödex
, 
vlib_w‹kî_thªads
[ödex].
«me
);

306 
tm
 = &
this_vlib_maö
->
åa˚_maö
;

308 
maöhóp
 = 
	`˛ib_mem_£t_hóp
 (
this_vlib_maö
->
hóp_ba£
);

310 
	`åa˚_≠∂y_fûãr
(
this_vlib_maö
);

312 
åa˚s
 = 0;

313 
	`poﬁ_f‹óch
 (
h
, 
tm
->
åa˚_buf„r_poﬁ
,

315 
	`vec_add1
 (
åa˚s
, 
h
[0]);

318 i‡(
	`vec_Àn
 (
åa˚s
) == 0)

320 
	`˛ib_mem_£t_hóp
 (
maöhóp
);

321 
s
 = 
	`f‹m©
 (s, "NoÖackets inÅrace buffer\n");

322 
d⁄e
;

326 
	`vec_s‹t_wôh_fun˘i⁄
 (
åa˚s
, 
åa˚_cmp
);

328 
i
 = 0; i < 
	`vec_Àn
 (
åa˚s
); i++)

330 i‡(
i
 =
max
)

332 
	`vlib_˛i_ouçut
 (
vm
, "Limiting displayÅo %dÖackets."

333 " Tÿdi•œy m‹ê•ecify max.", 
max
);

334 
d⁄e
;

337 
	`˛ib_mem_£t_hóp
 (
maöhóp
);

339 
s
 = 
	`f‹m©
 (s, "Packë %d\n%U\n\n", 
i
 + 1,

340 
f‹m©_vlib_åa˚
, 
vm
, 
åa˚s
[
i
]);

342 
maöhóp
 = 
	`˛ib_mem_£t_hóp
 (
this_vlib_maö
->
hóp_ba£
);

345 
d⁄e
:

346 
	`vec_‰ì
 (
åa˚s
);

347 
	`˛ib_mem_£t_hóp
 (
maöhóp
);

349 
ödex
++;

353 
	`vlib_˛i_ouçut
 (
vm
, "%v", 
s
);

354 
	`vec_‰ì
 (
s
);

356 
	}
}

359 
VLIB_CLI_COMMAND
 (
show_åa˚_˛i
,) = {

360 .
∑th
 = "showÅrace",

361 .
	gsh‹t_hñp
 = "ShowÅrace buffer [max COUNT]",

362 .
	gfun˘i⁄
 = 
˛i_show_åa˚_buf„r
,

366 
˛ib_îr‹_t
 *

367 
	$˛i_add_åa˚_buf„r
 (
vlib_maö_t
 * 
vm
,

368 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

370 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

371 
vlib_åa˚_maö_t
 *
tm
;

372 
vlib_åa˚_node_t
 *
ä
;

373 
u32
 
node_ödex
, 
add
;

374 
u8
 
vîbo£
 = 0;

375 
˛ib_îr‹_t
 *
îr‹
 = 0;

377 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

380 
	`unf‹m©_check_öput
 (
löe_öput
Ë!(
uw‹d
Ë
UNFORMAT_END_OF_INPUT
)

382 i‡(
	`unf‹m©
 (
löe_öput
, "%U %d",

383 
unf‹m©_vlib_node
, 
vm
, &
node_ödex
, &
add
))

385 i‡(
	`unf‹m©
 (
löe_öput
, "verbose"))

386 
vîbo£
 = 1;

389 
îr‹
 = 
	`˛ib_îr‹_¸óã
 ("expected NODE COUNT, got `%U'",

390 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

391 
d⁄e
;

396 
	`f‹óch_vlib_maö
 ((

398 *
ﬁdhóp
;

399 
tm
 = &
this_vlib_maö
->
åa˚_maö
;

400 
tm
->
åa˚_a˘ive_höt
 = 1;

401 
tm
->
vîbo£
 = verbose;

402 
ﬁdhóp
 =

403 
	`˛ib_mem_£t_hóp
 (
this_vlib_maö
->
hóp_ba£
);

404 
	`vec_vÆid©e
 (
tm
->
nodes
, 
node_ödex
);

405 
ä
 = 
tm
->
nodes
 + 
node_ödex
;

406 
ä
->
limô
 +
add
; 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

410 
d⁄e
:

411 
	`unf‹m©_‰ì
 (
löe_öput
);

413  
îr‹
;

414 
	}
}

417 
VLIB_CLI_COMMAND
 (
add_åa˚_˛i
,) = {

418 .
∑th
 = "traceádd",

419 .
	gsh‹t_hñp
 = "Trace givenÇumber ofÖackets",

420 .
	gfun˘i⁄
 = 
˛i_add_åa˚_buf„r
,

462 
˛ib_îr‹_t
 *

463 
	$˛i_fûãr_åa˚
 (
vlib_maö_t
 * 
vm
,

464 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

466 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

467 
u32
 
fûãr_node_ödex
;

468 
u32
 
fûãr_Êag
;

469 
u32
 
fûãr_cou¡
;

470 *
maöhóp
;

472 i‡(
	`unf‹m©
 (
öput
, "include %U %d",

473 
unf‹m©_vlib_node
, 
vm
, &
fûãr_node_ödex
, &
fûãr_cou¡
))

475 
fûãr_Êag
 = 
FILTER_FLAG_INCLUDE
;

477 i‡(
	`unf‹m©
 (
öput
, "exclude %U %d",

478 
unf‹m©_vlib_node
, 
vm
, &
fûãr_node_ödex
,

479 &
fûãr_cou¡
))

481 
fûãr_Êag
 = 
FILTER_FLAG_EXCLUDE
;

483 i‡(
	`unf‹m©
 (
öput
, "none"))

485 
fûãr_Êag
 = 
FILTER_FLAG_NONE
;

486 
fûãr_node_ödex
 = 0;

487 
fûãr_cou¡
 = 0;

491 
˛ib_îr‹_¸óã


493 
f‹m©_unf‹m©_îr‹
, 
öput
);

496 
	`f‹óch_vlib_maö
 (

498 
tm
 = &
this_vlib_maö
->
åa˚_maö
;

499 
tm
->
fûãr_node_ödex
 = filter_node_index;

500 
tm
->
fûãr_Êag
 = filter_flag;

501 
tm
->
fûãr_cou¡
 = filter_count;

507 
maöhóp
 = 
	`˛ib_mem_£t_hóp
 (
this_vlib_maö
->
hóp_ba£
);

508 
	`vec_‰ì
 (
tm
->
nodes
);

509 
	`˛ib_mem_£t_hóp
 (
maöhóp
);

514 
	}
}

517 
VLIB_CLI_COMMAND
 (
fûãr_åa˚_˛i
,) = {

518 .
∑th
 = "trace filter",

519 .
	gsh‹t_hñp
 = "filterÅrace output - include NODE COUNT |Éxclude NODE COUNT |Çone",

520 .
	gfun˘i⁄
 = 
˛i_fûãr_åa˚
,

524 
˛ib_îr‹_t
 *

525 
	$˛i_˛ór_åa˚_buf„r
 (
vlib_maö_t
 * 
vm
,

526 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

528 
	`˛ór_åa˚_buf„r
 ();

530 
	}
}

533 
VLIB_CLI_COMMAND
 (
˛ór_åa˚_˛i
,) = {

534 .
∑th
 = "clearÅrace",

535 .
	gsh‹t_hñp
 = "ClearÅrace bufferánd free memory",

536 .
	gfun˘i⁄
 = 
˛i_˛ór_åa˚_buf„r
,

542 
	$vlib_åa˚_˛i_ª„ªn˚
 ()

544 
	}
}

	@trace.h

40 #i‚de‡
ö˛uded_vlib_åa˚_h


41 
	#ö˛uded_vlib_åa˚_h


	)

43 
	~<vµö‰a/poﬁ.h
>

48 
u64
 
	mtime
;

51 
u32
 
	mnode_ödex
;

54 
u32
 
	mn_d©a
;

57 
u8
 
	md©a
[0];

58 } 
	tvlib_åa˚_hódî_t
;

63 
u32
 
	mcou¡
;

66 
u32
 
	mlimô
;

67 } 
	tvlib_åa˚_node_t
;

72 
vlib_åa˚_hódî_t
 **
	måa˚_buf„r_poﬁ
;

74 
u32
 
	mœ°_maö_lo›_cou¡
;

75 
u32
 
	mfûãr_node_ödex
;

76 
u32
 
	mfûãr_Êag
;

77 
	#FILTER_FLAG_NONE
 0

	)

78 
	#FILTER_FLAG_INCLUDE
 1

	)

79 
	#FILTER_FLAG_EXCLUDE
 2

	)

80 
u32
 
	mfûãr_cou¡
;

83 
u32
 
	måa˚_a˘ive_höt
;

86 
vlib_åa˚_node_t
 *
	mnodes
;

89 
	mvîbo£
;

90 } 
	tvlib_åa˚_maö_t
;

	@trace_funcs.h

40 #i‚de‡
ö˛uded_vlib_åa˚_funcs_h


41 
	#ö˛uded_vlib_åa˚_funcs_h


	)

43 
Æways_ölöe
 

44 
	$vlib_vÆid©e_åa˚
 (
vlib_åa˚_maö_t
 * 
tm
, 
vlib_buf„r_t
 * 
b
)

50 
	`ASSERT
 (1 || 
b
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
);

51 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
b
->
åa˚_ödex
));

52 
	}
}

54 
Æways_ölöe
 *

55 
	$vlib_add_åa˚
 (
vlib_maö_t
 * 
vm
,

56 
vlib_node_ru¡ime_t
 * 
r
, 
vlib_buf„r_t
 * 
b
, 
u32
 
n_d©a_byãs
)

58 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

59 
vlib_åa˚_hódî_t
 *
h
;

60 
u32
 
n_d©a_w‹ds
;

62 
	`vlib_vÆid©e_åa˚
 (
tm
, 
b
);

64 
n_d©a_byãs
 = 
	`round_pow2
 (n_d©a_byãs,  (
h
[0]));

65 
n_d©a_w‹ds
 = 
n_d©a_byãs
 /  (
h
[0]);

66 
	`vec_add2_Æig√d
 (
tm
->
åa˚_buf„r_poﬁ
[
b
->
åa˚_ödex
], 
h
,

67 1 + 
n_d©a_w‹ds
,  (
h
[0]));

69 
h
->
time
 = 
vm
->
˝u_time_œ°_node_di•©ch
;

70 
h
->
n_d©a
 = 
n_d©a_w‹ds
;

71 
h
->
node_ödex
 = 
r
->node_index;

73  
h
->
d©a
;

74 
	}
}

76 
Æways_ölöe
 
vlib_åa˚_hódî_t
 *

77 
	$vlib_åa˚_hódî_√xt
 (
vlib_åa˚_hódî_t
 * 
h
)

79  
h
 + 1 + h->
n_d©a
;

80 
	}
}

82 
Æways_ölöe
 

83 
	$vlib_‰ì_åa˚
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

85 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

86 
	`vlib_vÆid©e_åa˚
 (
tm
, 
b
);

87 
	`_vec_Àn
 (
tm
->
åa˚_buf„r_poﬁ
[
b
->
åa˚_ödex
]) = 0;

88 
	`poﬁ_put_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
b
->
åa˚_ödex
);

89 
	}
}

91 
Æways_ölöe
 

92 
	$vlib_åa˚_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

93 
vlib_node_ru¡ime_t
 * 
r
, 
u32
 
√xt_ödex
)

95 
vlib_√xt_‰ame_t
 *
nf
;

96 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

97 
nf
->
Êags
 |
VLIB_FRAME_TRACE
;

98 
	}
}

100 
åa˚_≠∂y_fûãr
 (
vlib_maö_t
 * 
vm
);

103 
Æways_ölöe
 

104 
	$vlib_åa˚_buf„r
 (
vlib_maö_t
 * 
vm
,

105 
vlib_node_ru¡ime_t
 * 
r
,

106 
u32
 
√xt_ödex
, 
vlib_buf„r_t
 * 
b
, 
fﬁlow_chaö
)

108 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

109 
vlib_åa˚_hódî_t
 **
h
;

115 i‡(
tm
->
œ°_maö_lo›_cou¡
 !
vm
->
maö_lo›_cou¡
)

117 
tm
->
œ°_maö_lo›_cou¡
 = 
vm
->
maö_lo›_cou¡
;

118 
	`åa˚_≠∂y_fûãr
 (
vm
);

121 
	`vlib_åa˚_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

123 
	`poﬁ_gë
 (
tm
->
åa˚_buf„r_poﬁ
, 
h
);

127 
b
->
Êags
 |
VLIB_BUFFER_IS_TRACED
;

128 
b
->
åa˚_ödex
 = 
h
 - 
tm
->
åa˚_buf„r_poﬁ
;

130 
fﬁlow_chaö
 && (
b
 = 
	`vlib_gë_√xt_buf„r
 (
vm
, b)));

131 
	}
}

133 
Æways_ölöe
 

134 
	$vlib_buf„r_c›y_åa˚_Êag
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
,

135 
u32
 
bi_èrgë
)

137 
vlib_buf„r_t
 *
b_èrgë
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi_èrgë
);

138 
b_èrgë
->
Êags
 |
b
->Êag†& 
VLIB_BUFFER_IS_TRACED
;

139 
b_èrgë
->
åa˚_ödex
 = 
b
->trace_index;

140 
	}
}

142 
Æways_ölöe
 
u32


143 
	$vlib_gë_åa˚_cou¡
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
π
)

145 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

146 
vlib_åa˚_node_t
 *
ä
;

147 
n
;

149 i‡(
π
->
node_ödex
 >
	`vec_Àn
 (
tm
->
nodes
))

151 
ä
 = 
tm
->
nodes
 + 
π
->
node_ödex
;

152 
n
 = 
ä
->
limô
 -Ån->
cou¡
;

153 
	`ASSERT
 (
n
 >= 0);

155  
n
;

156 
	}
}

158 
Æways_ölöe
 

159 
	$vlib_£t_åa˚_cou¡
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
π
, 
u32
 
cou¡
)

161 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

162 
vlib_åa˚_node_t
 *
ä
 = 
	`vec_ñt_©_ödex
 (
tm
->
nodes
, 
π
->
node_ödex
);

164 
	`ASSERT
 (
cou¡
 <
ä
->
limô
);

165 
ä
->
cou¡
 =Ån->
limô
 - count;

166 
	}
}

170 
vlib_åa˚_‰ame_buf„rs_⁄ly
 (
vlib_maö_t
 * 
vm
,

171 
vlib_node_ru¡ime_t
 * 
node
,

172 
u32
 * 
buf„rs
,

173 
uw‹d
 
n_buf„rs
,

174 
uw‹d
 
√xt_buf„r_°ride
,

175 
uw‹d
 
n_buf„r_d©a_byãs_ö_åa˚
);

	@unix/cj.c

30 
	~<°dio.h
>

31 
	~<vlib/vlib.h
>

33 
	~<vlib/unix/cj.h
>

35 
cj_maö_t
 
	gcj_maö
;

38 
	$cj_log
 (
u32
 
ty≥
, *
d©a0
, *
d©a1
)

40 
u64
 
√w_èû
;

41 
cj_maö_t
 *
cjm
 = &
cj_maö
;

42 
cj_ªc‹d_t
 *
r
;

44 i‡(
cjm
->
íabÀ
 == 0)

47 
√w_èû
 = 
	`__sync_add_™d_„tch
 (&
cjm
->
èû
, 1);

49 
r
 = (
cj_ªc‹d_t
 *Ë& (
cjm
->
ªc‹ds
[
√w_èû
 & (cjm->
num_ªc‹ds
 - 1)]);

50 
r
->
time
 = 
	`vlib_time_now
 (
cjm
->
vlib_maö
);

51 
r
->
thªad_ödex
 = 
	`vlib_gë_thªad_ödex
 ();

52 
r
->
ty≥
 =Åype;

53 
r
->
d©a
[0] = 
	`poöãr_to_uw‹d
 (
d©a0
);

54 
r
->
d©a
[1] = 
	`poöãr_to_uw‹d
 (
d©a1
);

55 
	}
}

58 
	$cj_°›
 ()

60 
cj_maö_t
 *
cjm
 = &
cj_maö
;

62 
cjm
->
íabÀ
 = 0;

63 
	}
}

66 
˛ib_îr‹_t
 *

67 
	$cj_öô
 (
vlib_maö_t
 * 
vm
)

69 
cj_maö_t
 *
cjm
 = &
cj_maö
;

71 
cjm
->
vlib_maö
 = 
vm
;

73 
	}
}

75 
VLIB_INIT_FUNCTION
 (
cj_öô
);

77 
˛ib_îr‹_t
 *

78 
	$cj_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

80 
cj_maö_t
 *
cjm
 = &
cj_maö
;

81 
m©ched
 = 0;

82 
íabÀ
 = 0;

84 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

86 i‡(
	`unf‹m©
 (
öput
, "ªc‹d†%d", &
cjm
->
num_ªc‹ds
))

87 
m©ched
 = 1;

88 i‡(
	`unf‹m©
 (
öput
, "on"))

89 
íabÀ
 = 1;

91  
	`˛ib_îr‹_ªtu∫
 (0, "cj_config: unknown input '%U'",

92 
f‹m©_unf‹m©_îr‹
, 
öput
);

95 i‡(
m©ched
 == 0)

98 
cjm
->
num_ªc‹ds
 = 
	`max_pow2
 (cjm->num_records);

99 
	`vec_vÆid©e
 (
cjm
->
ªc‹ds
, cjm->
num_ªc‹ds
 - 1);

100 
	`mem£t
 (
cjm
->
ªc‹ds
, 0xff, cjm->
num_ªc‹ds
 *  (
cj_ªc‹d_t
));

101 
cjm
->
èû
 = ~0;

102 
cjm
->
íabÀ
 =Énable;

105 
	}
}

119 
VLIB_CONFIG_FUNCTION
 (
cj_c⁄fig
, "cj");

122 
	$cj_íabÀ_dißbÀ
 (
is_íabÀ
)

124 
cj_maö_t
 *
cjm
 = &
cj_maö
;

126 i‡(
cjm
->
num_ªc‹ds
)

127 
cjm
->
íabÀ
 = 
is_íabÀ
;

129 
	`vlib_˛i_ouçut
 (
cjm
->
vlib_maö
, "CJÇot configured...");

130 
	}
}

132 
ölöe
 

133 
	$cj_dump_⁄e_ªc‹d
 (
cj_ªc‹d_t
 * 
r
)

135 
	`Ârötf
 (
°dîr
, "[%d]: %10.6f T%02d %llx %llx\n",

136 
r
->
thªad_ödex
,Ñ->
time
,Ñ->
ty≥
,

137 (Ë
r
->
d©a
[0],

138 (Ë
r
->
d©a
[1]);

139 
	}
}

142 
	$cj_dump_öã∫Æ
 (
u8
 
fûãr0_íabÀ
, 
u64
 
fûãr0
,

143 
u8
 
fûãr1_íabÀ
, 
u64
 
fûãr1
)

145 
cj_maö_t
 *
cjm
 = &
cj_maö
;

146 
cj_ªc‹d_t
 *
r
;

147 
u32
 
i
, 
ödex
;

149 i‡(
cjm
->
num_ªc‹ds
 == 0)

151 
	`Ârötf
 (
°dîr
, "CJÇot configured...\n");

155 i‡(
cjm
->
èû
 =(
u64
) ~ 0)

157 
	`Ârötf
 (
°dîr
, "No data collected...\n");

162 
ödex
 = (
cjm
->
èû
 + 1Ë& (cjm->
num_ªc‹ds
 - 1);

163 
r
 = &(
cjm
->
ªc‹ds
[
ödex
]);

165 i‡(
r
->
thªad_ödex
 !(
u32
) ~ 0)

168 
i
 = 
ödex
; i < 
cjm
->
num_ªc‹ds
; i++)

170 i‡(
fûãr0_íabÀ
 && (
r
->
d©a
[0] !
fûãr0
))

171 
skù
;

172 i‡(
fûãr1_íabÀ
 && (
r
->
d©a
[1] !
fûãr1
))

173 
skù
;

174 
	`cj_dump_⁄e_ªc‹d
 (
r
);

175 
skù
:

176 
r
++;

180 
r
 = 
cjm
->
ªc‹ds
;

181 
i
 = 0; i <
cjm
->
èû
; i++)

183 i‡(
fûãr0_íabÀ
 && (
r
->
d©a
[0] !
fûãr0
))

184 
skù2
;

185 i‡(
fûãr1_íabÀ
 && (
r
->
d©a
[1] !
fûãr1
))

186 
skù2
;

187 
	`cj_dump_⁄e_ªc‹d
 (
r
);

188 
skù2
:

189 
r
++;

191 
	}
}

194 
	$cj_dump
 ()

196 
	`cj_dump_öã∫Æ
 (0, 0, 0, 0);

197 
	}
}

200 
	$cj_dump_fûãr_d©a0
 (
u64
 
fûãr0
)

202 
	`cj_dump_öã∫Æ
 (1 , 
fûãr0
, 0, 0);

203 
	}
}

206 
	$cj_dump_fûãr_d©a1
 (
u64
 
fûãr1
)

208 
	`cj_dump_öã∫Æ
 (0, 0, 1 , 
fûãr1
);

209 
	}
}

212 
	$cj_dump_fûãr_d©a12
 (
u64
 
fûãr0
, u64 
fûãr1
)

214 
	`cj_dump_öã∫Æ
 (1, 
fûãr0
, 1, 
fûãr1
);

215 
	}
}

217 
˛ib_îr‹_t
 *

218 
	$cj_comm™d_‚
 (
vlib_maö_t
 * 
vm
,

219 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

221 
is_íabÀ
 = -1;

222 
is_dump
 = -1;

223 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

224 
˛ib_îr‹_t
 *
îr‹
 = 
NULL
;

227 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

228  
	`˛ib_îr‹_ªtu∫
 (0, "expectedÉnable | disable | dump");

230 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

232 i‡(
	`unf‹m©
 (
löe_öput
, "enable") || unformat (line_input, "on"))

233 
is_íabÀ
 = 1;

234 i‡(
	`unf‹m©
 (
löe_öput
, "disable")

235 || 
	`unf‹m©
 (
löe_öput
, "off"))

236 
is_íabÀ
 = 0;

237 i‡(
	`unf‹m©
 (
löe_öput
, "dump"))

238 
is_dump
 = 1;

241 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknown input `%U'",

242 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

243 
d⁄e
;

247 i‡(
is_íabÀ
 >= 0)

248 
	`cj_íabÀ_dißbÀ
 (
is_íabÀ
);

250 i‡(
is_dump
 > 0)

251 
	`cj_dump
 ();

253 
d⁄e
:

254 
	`unf‹m©_‰ì
 (
löe_öput
);

255  
îr‹
;

256 
	}
}

270 
VLIB_CLI_COMMAND
 (
cj_comm™d
,) = {

271 .
∑th
 = "cj",

272 .
	gsh‹t_hñp
 = "cj <enable | disable | dump>",

273 .
	gfun˘i⁄
 = 
cj_comm™d_‚
,

	@unix/cj.h

20 #i‚de‡
__ö˛uded_cj_h__


21 
	#__ö˛uded_cj_h__


	)

25 
f64
 
	mtime
;

26 
u32
 
	mthªad_ödex
;

27 
u32
 
	mty≥
;

28 
u64
 
	md©a
[2];

29 } 
	tcj_ªc‹d_t
;

33 vﬁ©ûê
u64
 
	mèû
;

34 
cj_ªc‹d_t
 *
	mªc‹ds
;

35 
u32
 
	mnum_ªc‹ds
;

36 vﬁ©ûê
u32
 
	míabÀ
;

38 
vlib_maö_t
 *
	mvlib_maö
;

39 } 
	tcj_maö_t
;

41 
cj_log
 (
u32
 
ty≥
, *
d©a0
, *
d©a1
);

48 
	#DECLARE_CJ_GLOBAL_LOG
 \

49 
	`cj_globÆ_log
 (
ty≥
, * 
d©a0
, * 
d©a1
) \

50 
	`__©åibuã__
 ((
wók
)); \

52 
__cj_ty≥
; \

53 * 
__cj_d©a0
; \

54 * 
__cj_d©a1
; \

57 
	`cj_globÆ_log
 (
ty≥
, * 
d©a0
, * 
d©a1
) \

59 
__cj_ty≥
 = 
ty≥
; \

60 
__cj_d©a0
 = 
d©a0
; \

61 
__cj_d©a1
 = 
d©a1
; \

62 }

	)

64 
	#CJ_GLOBAL_LOG_PROTOTYPE


	)

66 
	$cj_globÆ_log
 (
ty≥
, *
d©a0
, *
d©a1
)

67 
	`__©åibuã__
 ((
wók
));

69 
	`cj_°›
 ();

	@unix/cli.c

48 
	~<vlib/vlib.h
>

49 
	~<vlib/unix/unix.h
>

50 
	~<vµö‰a/timî.h
>

52 
	~<˘y≥.h
>

53 
	~<f˙é.h
>

54 
	~<sys/°©.h
>

55 
	~<ãrmios.h
>

56 
	~<sig«l.h
>

57 
	~<uni°d.h
>

58 
	~<¨∑/ã ë.h
>

59 
	~<sys/io˘l.h
>

60 
	~<sys/ty≥s.h
>

61 
	~<uni°d.h
>

62 
	~<limôs.h
>

65 
	#ESC
 "\x1b"

	)

68 
	#CSI
 
ESC
 "["

	)

71 
	#ANSI_CLEAR
 
CSI
 "2J" CSI "1;1H"

	)

73 
	#ANSI_RESET
 
CSI
 "0m"

	)

75 
	#ANSI_BOLD
 
CSI
 "1m"

	)

77 
	#ANSI_DIM
 
CSI
 "2m"

	)

79 
	#ANSI_DRED
 
ANSI_DIM
 
CSI
 "31m"

	)

81 
	#ANSI_BRED
 
ANSI_BOLD
 
CSI
 "31m"

	)

83 
	#ANSI_CLEARLINE
 
CSI
 "2K"

	)

85 
	#ANSI_SCROLLDN
 
CSI
 "1T"

	)

87 
	#ANSI_SAVECURSOR
 
CSI
 "s"

	)

89 
	#ANSI_RESTCURSOR
 
CSI
 "u"

	)

93 
	#UNIX_CLI_MAX_DEPTH_TELNET
 24

	)

96 
	#UNIX_CLI_MAX_TERMINAL_WIDTH
 512

	)

98 
	#UNIX_CLI_MAX_TERMINAL_HEIGHT
 512

	)

100 
	#UNIX_CLI_DEFAULT_TERMINAL_HEIGHT
 24

	)

102 
	#UNIX_CLI_DEFAULT_TERMINAL_WIDTH
 80

	)

107 
u8
 *
	mlöe
;

108 
u32
 
	mÀngth
;

109 } 
	tunix_˛i_b™√r_t
;

111 
	#_
(
a
Ë{ .
löe
 = (
u8
 *)◊), .
Àngth
 = ◊Ë- 1 }

	)

113 
unix_˛i_b™√r_t
 
	gunix_˛i_b™√r
[] = {

114 
_
(" _______ _ _ _____ ___ \n"),

115 
_
(" __/ __/ _ \\ (_)__ | | / / _ \\/ _ \\\n"),

116 
_
(" _/ _// // / / / _ \\ | |/ / ___/ ___/\n"),

117 
_
(" /_/ /____(_)_/\\___/ |___/_/ /_/ \n"),

118 
_
("\n")

122 
unix_˛i_b™√r_t
 
	gunix_˛i_b™√r_cﬁ‹
[] = {

123 
_
(
ANSI_BRED
 " _______ _ " 
ANSI_RESET
 " _ _____ ___ \n"),

124 
_
(
ANSI_BRED
 " __/ __/ _ \\ (_)__ " 
ANSI_RESET
 " | | / / _ \\/ _ \\\n"),

125 
_
(
ANSI_BRED
 " _/ _// // / / / _ \\" 
ANSI_RESET
 " | |/ / ___/ ___/\n"),

126 
_
(
ANSI_BRED
 " /_/ /____(_)_/\\___/" 
ANSI_RESET
 " |___/_/ /_/ \n"),

127 
_
("\n")

130 #unde‡
_


136 
u32
 
	mlöe
;

139 
u32
 
	moff£t
;

142 
u32
 
	mÀngth
;

143 } 
	tunix_˛i_∑gî_ödex_t
;

150 
u32
 
	m˛ib_fûe_ödex
;

153 
u8
 *
	mouçut_ve˘‹
;

157 
u8
 *
	möput_ve˘‹
;

160 
u8
 
	mhas_hi°‹y
;

162 
u8
 **
	mcomm™d_hi°‹y
;

164 
u8
 *
	mcuºít_comm™d
;

166 
i32
 
	mexcursi⁄
;

169 
u32
 
	mhi°‹y_limô
;

172 
u32
 
	mcomm™d_numbî
;

175 
u8
 *
	m£¨ch_key
;

180 
	m£¨ch_mode
;

183 
u32
 
	mcurs‹
;

186 
u8
 
	mlöe_mode
;

189 
u8
 
	m¸lf_mode
;

192 
u8
 
	m™si_ˇ∑bÀ
;

195 
u8
 
	m°¨ãd
;

198 
u8
 
	mno_∑gî
;

202 
u8
 
	mis_öãø˘ive
;

205 
u8
 
	mis_sockë
;

210 
u8
 
	mhas_ïùe
;

213 
u8
 **
	m∑gî_ve˘‹
;

216 
unix_˛i_∑gî_ödex_t
 *
	m∑gî_ödex
;

219 
u32
 
	m∑gî_°¨t
;

222 
u32
 
	mwidth
;

225 
u32
 
	mheight
;

228 
u32
 
	m¥o˚ss_node_ödex
;

229 } 
	tunix_˛i_fûe_t
;

234 
Æways_ölöe
 

235 
	$unix_˛i_∑gî_ª£t
 (
unix_˛i_fûe_t
 * 
f
)

237 
u8
 **
p
;

239 
f
->
∑gî_°¨t
 = 0;

241 
	`vec_‰ì
 (
f
->
∑gî_ödex
);

242 
f
->
∑gî_ödex
 = 0;

244 
	`vec_f‹óch
 (
p
, 
f
->
∑gî_ve˘‹
)

246 
	`vec_‰ì
 (*
p
);

248 
	`vec_‰ì
 (
f
->
∑gî_ve˘‹
);

249 
f
->
∑gî_ve˘‹
 = 0;

250 
	}
}

255 
Æways_ölöe
 

256 
	$unix_˛i_fûe_‰ì
 (
unix_˛i_fûe_t
 * 
f
)

258 
	`vec_‰ì
 (
f
->
ouçut_ve˘‹
);

259 
	`vec_‰ì
 (
f
->
öput_ve˘‹
);

260 
	`unix_˛i_∑gî_ª£t
 (
f
);

261 
	}
}

266 
	mUNIX_CLI_PARSE_ACTION_NOACTION
 = 0,

267 
	mUNIX_CLI_PARSE_ACTION_CRLF
,

268 
	mUNIX_CLI_PARSE_ACTION_TAB
,

269 
	mUNIX_CLI_PARSE_ACTION_ERASE
,

270 
	mUNIX_CLI_PARSE_ACTION_ERASERIGHT
,

271 
	mUNIX_CLI_PARSE_ACTION_UP
,

272 
	mUNIX_CLI_PARSE_ACTION_DOWN
,

273 
	mUNIX_CLI_PARSE_ACTION_LEFT
,

274 
	mUNIX_CLI_PARSE_ACTION_RIGHT
,

275 
	mUNIX_CLI_PARSE_ACTION_HOME
,

276 
	mUNIX_CLI_PARSE_ACTION_END
,

277 
	mUNIX_CLI_PARSE_ACTION_WORDLEFT
,

278 
	mUNIX_CLI_PARSE_ACTION_WORDRIGHT
,

279 
	mUNIX_CLI_PARSE_ACTION_ERASELINELEFT
,

280 
	mUNIX_CLI_PARSE_ACTION_ERASELINERIGHT
,

281 
	mUNIX_CLI_PARSE_ACTION_CLEAR
,

282 
	mUNIX_CLI_PARSE_ACTION_REVSEARCH
,

283 
	mUNIX_CLI_PARSE_ACTION_FWDSEARCH
,

284 
	mUNIX_CLI_PARSE_ACTION_YANK
,

285 
	mUNIX_CLI_PARSE_ACTION_TELNETIAC
,

287 
	mUNIX_CLI_PARSE_ACTION_PAGER_CRLF
,

288 
	mUNIX_CLI_PARSE_ACTION_PAGER_QUIT
,

289 
	mUNIX_CLI_PARSE_ACTION_PAGER_NEXT
,

290 
	mUNIX_CLI_PARSE_ACTION_PAGER_DN
,

291 
	mUNIX_CLI_PARSE_ACTION_PAGER_UP
,

292 
	mUNIX_CLI_PARSE_ACTION_PAGER_TOP
,

293 
	mUNIX_CLI_PARSE_ACTION_PAGER_BOTTOM
,

294 
	mUNIX_CLI_PARSE_ACTION_PAGER_PGDN
,

295 
	mUNIX_CLI_PARSE_ACTION_PAGER_PGUP
,

296 
	mUNIX_CLI_PARSE_ACTION_PAGER_REDRAW
,

297 
	mUNIX_CLI_PARSE_ACTION_PAGER_SEARCH
,

299 
	mUNIX_CLI_PARSE_ACTION_PARTIALMATCH
,

300 
	mUNIX_CLI_PARSE_ACTION_NOMATCH


301 } 
	tunix_˛i_∑r£_a˘i⁄_t
;

309 
u8
 *
	möput
;

310 
u32
 
	mÀn
;

311 
unix_˛i_∑r£_a˘i⁄_t
 
	ma˘i⁄
;

312 } 
	tunix_˛i_∑r£_a˘i⁄s_t
;

323 
	#CTL
(
c
Ë(
u8
[]){ (cË- '@', 0 }

	)

325 
	#_
(
a
,
b
Ë{ .
öput
 = (
u8
 *)◊), .
Àn
 = ◊Ë- 1, .
a˘i⁄
 = (bË}

	)

330 
unix_˛i_∑r£_a˘i⁄s_t
 
	gunix_˛i_∑r£_°rögs
[] = {

332 
_
("\r\n", 
UNIX_CLI_PARSE_ACTION_CRLF
),

333 
_
("\n", 
UNIX_CLI_PARSE_ACTION_CRLF
),

334 
_
("\r\0", 
UNIX_CLI_PARSE_ACTION_CRLF
),

335 
_
("\r", 
UNIX_CLI_PARSE_ACTION_CRLF
),

338 
_
(
CTL
 ('B'), 
UNIX_CLI_PARSE_ACTION_LEFT
),

339 
_
(
CTL
 ('F'), 
UNIX_CLI_PARSE_ACTION_RIGHT
),

340 
_
(
CTL
 ('P'), 
UNIX_CLI_PARSE_ACTION_UP
),

341 
_
(
CTL
 ('N'), 
UNIX_CLI_PARSE_ACTION_DOWN
),

342 
_
(
CTL
 ('A'), 
UNIX_CLI_PARSE_ACTION_HOME
),

343 
_
(
CTL
 ('E'), 
UNIX_CLI_PARSE_ACTION_END
),

344 
_
(
CTL
 ('D'), 
UNIX_CLI_PARSE_ACTION_ERASERIGHT
),

345 
_
(
CTL
 ('U'), 
UNIX_CLI_PARSE_ACTION_ERASELINELEFT
),

346 
_
(
CTL
 ('K'), 
UNIX_CLI_PARSE_ACTION_ERASELINERIGHT
),

347 
_
(
CTL
 ('Y'), 
UNIX_CLI_PARSE_ACTION_YANK
),

348 
_
(
CTL
 ('L'), 
UNIX_CLI_PARSE_ACTION_CLEAR
),

349 
_
(
ESC
 "b", 
UNIX_CLI_PARSE_ACTION_WORDLEFT
),

350 
_
(
ESC
 "f", 
UNIX_CLI_PARSE_ACTION_WORDRIGHT
),

351 
_
("\b", 
UNIX_CLI_PARSE_ACTION_ERASE
),

352 
_
("\x7f", 
UNIX_CLI_PARSE_ACTION_ERASE
),

353 
_
("\t", 
UNIX_CLI_PARSE_ACTION_TAB
),

356 
_
(
CSI
 "A", 
UNIX_CLI_PARSE_ACTION_UP
),

357 
_
(
CSI
 "B", 
UNIX_CLI_PARSE_ACTION_DOWN
),

358 
_
(
CSI
 "C", 
UNIX_CLI_PARSE_ACTION_RIGHT
),

359 
_
(
CSI
 "D", 
UNIX_CLI_PARSE_ACTION_LEFT
),

360 
_
(
CSI
 "H", 
UNIX_CLI_PARSE_ACTION_HOME
),

361 
_
(
CSI
 "F", 
UNIX_CLI_PARSE_ACTION_END
),

362 
_
(
CSI
 "3~", 
UNIX_CLI_PARSE_ACTION_ERASERIGHT
),

363 
_
(
CSI
 "1;5D", 
UNIX_CLI_PARSE_ACTION_WORDLEFT
),

364 
_
(
CSI
 "1;5C", 
UNIX_CLI_PARSE_ACTION_WORDRIGHT
),

367 
_
(
ESC
 "OA", 
UNIX_CLI_PARSE_ACTION_UP
),

368 
_
(
ESC
 "OB", 
UNIX_CLI_PARSE_ACTION_DOWN
),

369 
_
(
ESC
 "OC", 
UNIX_CLI_PARSE_ACTION_RIGHT
),

370 
_
(
ESC
 "OD", 
UNIX_CLI_PARSE_ACTION_LEFT
),

371 
_
(
ESC
 "OH", 
UNIX_CLI_PARSE_ACTION_HOME
),

372 
_
(
ESC
 "OF", 
UNIX_CLI_PARSE_ACTION_END
),

375 
_
(
CSI
 "1~", 
UNIX_CLI_PARSE_ACTION_HOME
),

376 
_
(
CSI
 "4~", 
UNIX_CLI_PARSE_ACTION_END
),

379 
_
(
CTL
 ('S'), 
UNIX_CLI_PARSE_ACTION_FWDSEARCH
),

380 
_
(
CTL
 ('R'), 
UNIX_CLI_PARSE_ACTION_REVSEARCH
),

383 
_
("\xff", 
UNIX_CLI_PARSE_ACTION_TELNETIAC
),

384 
_
("\0", 
UNIX_CLI_PARSE_ACTION_NOACTION
),

385 
_
(
NULL
, 
UNIX_CLI_PARSE_ACTION_NOMATCH
)

392 
unix_˛i_∑r£_a˘i⁄s_t
 
	gunix_˛i_∑r£_∑gî
[] = {

394 
_
("\r\n", 
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
),

395 
_
("\n", 
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
),

396 
_
("\r\0", 
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
),

397 
_
("\r", 
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
),

400 
_
(" ", 
UNIX_CLI_PARSE_ACTION_PAGER_NEXT
),

401 
_
("q", 
UNIX_CLI_PARSE_ACTION_PAGER_QUIT
),

402 
_
(
CTL
 ('L'), 
UNIX_CLI_PARSE_ACTION_PAGER_REDRAW
),

403 
_
(
CTL
 ('R'), 
UNIX_CLI_PARSE_ACTION_PAGER_REDRAW
),

404 
_
("/", 
UNIX_CLI_PARSE_ACTION_PAGER_SEARCH
),

407 
_
(
CSI
 "A", 
UNIX_CLI_PARSE_ACTION_PAGER_UP
),

408 
_
(
CSI
 "B", 
UNIX_CLI_PARSE_ACTION_PAGER_DN
),

409 
_
(
CSI
 "H", 
UNIX_CLI_PARSE_ACTION_PAGER_TOP
),

410 
_
(
CSI
 "F", 
UNIX_CLI_PARSE_ACTION_PAGER_BOTTOM
),

413 
_
(
ESC
 "OA", 
UNIX_CLI_PARSE_ACTION_PAGER_UP
),

414 
_
(
ESC
 "OB", 
UNIX_CLI_PARSE_ACTION_PAGER_DN
),

415 
_
(
ESC
 "OH", 
UNIX_CLI_PARSE_ACTION_PAGER_TOP
),

416 
_
(
ESC
 "OF", 
UNIX_CLI_PARSE_ACTION_PAGER_BOTTOM
),

419 
_
(
CSI
 "1~", 
UNIX_CLI_PARSE_ACTION_PAGER_TOP
),

420 
_
(
CSI
 "4~", 
UNIX_CLI_PARSE_ACTION_PAGER_BOTTOM
),

421 
_
(
CSI
 "5~", 
UNIX_CLI_PARSE_ACTION_PAGER_PGUP
),

422 
_
(
CSI
 "6~", 
UNIX_CLI_PARSE_ACTION_PAGER_PGDN
),

425 
_
("\xff", 
UNIX_CLI_PARSE_ACTION_TELNETIAC
),

426 
_
("\0", 
UNIX_CLI_PARSE_ACTION_NOACTION
),

427 
_
(
NULL
, 
UNIX_CLI_PARSE_ACTION_NOMATCH
)

430 #unde‡
_


435 
	mUNIX_CLI_PROCESS_EVENT_READ_READY
,

436 
	mUNIX_CLI_PROCESS_EVENT_QUIT
,

437 } 
	tunix_˛i_¥o˚ss_evít_ty≥_t
;

443 
u8
 *
	m˛i_¥om±
;

446 
unix_˛i_fûe_t
 *
	m˛i_fûe_poﬁ
;

449 
u32
 *
	munu£d_˛i_¥o˚ss_node_ödi˚s
;

452 
u32
 
	m°dö_˛i_fûe_ödex
;

455 
u32
 
	mcuºít_öput_fûe_ödex
;

456 } 
	tunix_˛i_maö_t
;

459 
unix_˛i_maö_t
 
	gunix_˛i_maö
;

484 
unix_˛i_∑r£_a˘i⁄_t


485 
	$unix_˛i_m©ch_a˘i⁄
 (
unix_˛i_∑r£_a˘i⁄s_t
 * 
a
,

486 
u8
 * 
öput
, 
u32
 
ûí
, 
i32
 * 
m©ched
)

488 
u8
 
∑πül
 = 0;

490 
a
->
öput
)

492 i‡(
ûí
 >
a
->
Àn
)

496 i‡(
	`memcmp
 (
öput
, 
a
->öput,á->
Àn
) == 0)

498 *
m©ched
 = 
a
->
Àn
;

499  
a
->
a˘i⁄
;

506 i‡(
	`memcmp
 (
öput
, 
a
->öput, 
ûí
) == 0)

507 
∑πül
 = 1;

511 
a
++;

514  
∑πül
 ?

515 
UNIX_CLI_PARSE_ACTION_PARTIALMATCH
 : 
UNIX_CLI_PARSE_ACTION_NOMATCH
;

516 
	}
}

523 
	$unix_˛i_add_≥ndög_ouçut
 (
˛ib_fûe_t
 * 
uf
,

524 
unix_˛i_fûe_t
 * 
cf
,

525 
u8
 * 
buf„r
, 
uw‹d
 
buf„r_byãs
)

527 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

529 
	`vec_add
 (
cf
->
ouçut_ve˘‹
, 
buf„r
, 
buf„r_byãs
);

530 i‡(
	`vec_Àn
 (
cf
->
ouçut_ve˘‹
) > 0)

532 
skù_upd©e
 = 0 !(
uf
->
Êags
 & 
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
);

533 
uf
->
Êags
 |
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
;

534 i‡(!
skù_upd©e
)

535 
fm
->
	`fûe_upd©e
 (
uf
, 
UNIX_FILE_UPDATE_MODIFY
);

537 
	}
}

543 
	$unix_˛i_dñ_≥ndög_ouçut
 (
˛ib_fûe_t
 * 
uf
,

544 
unix_˛i_fûe_t
 * 
cf
, 
uw‹d
 
n_byãs
)

546 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

548 
	`vec_dñëe
 (
cf
->
ouçut_ve˘‹
, 
n_byãs
, 0);

549 i‡(
	`vec_Àn
 (
cf
->
ouçut_ve˘‹
) <= 0)

551 
skù_upd©e
 = 0 =(
uf
->
Êags
 & 
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
);

552 
uf
->
Êags
 &~
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
;

553 i‡(!
skù_upd©e
)

554 
fm
->
	`fûe_upd©e
 (
uf
, 
UNIX_FILE_UPDATE_MODIFY
);

556 
	}
}

572 
Æways_ölöe
 
w‹d


573 
	$unix_vlib_födchr
 (
u8
 
chr
, u8 * 
°r
, 
w‹d
 
Àn
)

575 
w‹d
 
i
 = 0;

576 
i
 = 0; i < 
Àn
; i++, 
°r
++)

578 i‡(*
°r
 =
chr
)

579  
i
;

581  
Àn
;

582 
	}
}

600 
	$unix_vlib_˛i_ouçut_øw
 (
unix_˛i_fûe_t
 * 
cf
,

601 
˛ib_fûe_t
 * 
uf
, 
u8
 * 
buf„r
, 
uw‹d
 
buf„r_byãs
)

603 
n
 = 0;

605 i‡(
cf
->
has_ïùe
)

608 i‡(
	`vec_Àn
 (
cf
->
ouçut_ve˘‹
) == 0)

610 i‡(
cf
->
is_sockë
)

612 
n
 = 
	`£nd
 (
uf
->
fûe_des¸ùt‹
, 
buf„r
, 
buf„r_byãs
, 
MSG_NOSIGNAL
);

614 
n
 = 
	`wrôe
 (
uf
->
fûe_des¸ùt‹
, 
buf„r
, 
buf„r_byãs
);

617 i‡(
n
 < 0 && 
î∫o
 !
EAGAIN
)

619 i‡(
î∫o
 =
EPIPE
)

622 
unix_maö_t
 *
um
 = &
unix_maö
;

623 
cf
->
has_ïùe
 = 1;

624 
	`vlib_¥o˚ss_sig«l_evít
 (
um
->
vlib_maö
, 
cf
->
¥o˚ss_node_ödex
,

625 
UNIX_CLI_PROCESS_EVENT_QUIT
,

626 
uf
->
¥iv©e_d©a
);

630 
	`˛ib_unix_w¨nög
 ("write");

633 i‡((
w‹d
Ë
n
 < (w‹dË
buf„r_byãs
)

637 i‡(
n
 < 0)

638 
n
 = 0;

639 
	`unix_˛i_add_≥ndög_ouçut
 (
uf
, 
cf
, 
buf„r
 + 
n
, 
buf„r_byãs
 -Ç);

641 
	}
}

651 
	$unix_vlib_˛i_ouçut_cooked
 (
unix_˛i_fûe_t
 * 
cf
,

652 
˛ib_fûe_t
 * 
uf
,

653 
u8
 * 
buf„r
, 
uw‹d
 
buf„r_byãs
)

655 
w‹d
 
íd
 = 0, 
°¨t
 = 0;

657 
íd
 < 
buf„r_byãs
)

659 i‡(
cf
->
¸lf_mode
)

662 
íd
 = 
	`unix_vlib_födchr
 ('\n',

663 
buf„r
 + 
°¨t
,

664 
buf„r_byãs
 - 
°¨t
) + start;

669 
íd
 = 
buf„r_byãs
;

672 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, 
buf„r
 + 
°¨t
, 
íd
 - start);

674 i‡(
cf
->
¸lf_mode
)

676 i‡(
íd
 < 
buf„r_byãs
)

678 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\r\n", 2);

679 
íd
++;

681 
°¨t
 = 
íd
;

684 
	}
}

688 
	$unix_˛i_˛i_¥om±
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
)

690 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

692 i‡(
cf
->
is_öãø˘ive
)

693 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, 
cm
->
˛i_¥om±
,

694 
	`vec_Àn
 (
cm
->
˛i_¥om±
));

695 
	}
}

699 
	$unix_˛i_∑gî_¥om±
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
)

701 
u8
 *
¥om±
;

702 
u32
 
h
;

704 
h
 = 
cf
->
∑gî_°¨t
 + (cf->
height
 - 1);

705 i‡(
h
 > 
	`vec_Àn
 (
cf
->
∑gî_ödex
))

706 
h
 = 
	`vec_Àn
 (
cf
->
∑gî_ödex
);

708 
¥om±
 = 
	`f‹m©
 (0, "\r%s-- more -- (%d-%d/%d)%s",

709 
cf
->
™si_ˇ∑bÀ
 ? 
ANSI_BOLD
 : "",

710 
cf
->
∑gî_°¨t
 + 1,

711 
h
,

712 
	`vec_Àn
 (
cf
->
∑gî_ödex
),

713 
cf
->
™si_ˇ∑bÀ
 ? 
ANSI_RESET
 : "");

715 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
¥om±
, 
	`vec_Àn
 (prompt));

717 
	`vec_‰ì
 (
¥om±
);

718 
	}
}

722 
	$unix_˛i_∑gî_mesßge
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
,

723 *
mesßge
, *
po°fix
)

725 
u8
 *
¥om±
;

727 
¥om±
 = 
	`f‹m©
 (0, "\r%s-- %s --%s%s",

728 
cf
->
™si_ˇ∑bÀ
 ? 
ANSI_BOLD
 : "",

729 
mesßge
, 
cf
->
™si_ˇ∑bÀ
 ? 
ANSI_RESET
 : "", 
po°fix
);

731 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
¥om±
, 
	`vec_Àn
 (prompt));

733 
	`vec_‰ì
 (
¥om±
);

734 
	}
}

738 
	$unix_˛i_∑gî_¥om±_îa£
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
)

740 i‡(
cf
->
™si_ˇ∑bÀ
)

742 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\r", 1);

743 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

744 (
u8
 *Ë
ANSI_CLEARLINE
,

745  (
ANSI_CLEARLINE
) - 1);

749 
i
;

751 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\r", 1);

752 
i
 = 0; i < 
cf
->
width
 - 1; i++)

753 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " ", 1);

754 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\r", 1);

756 
	}
}

760 
	$unix_˛i_™si_curs‹
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
, 
u16
 
x
, u16 
y
)

762 
u8
 *
°r
;

764 
°r
 = 
	`f‹m©
 (0, "%s%d;%dH", 
CSI
, 
y
, 
x
);

766 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
°r
, 
	`vec_Àn
 (str));

768 
	`vec_‰ì
 (
°r
);

769 
	}
}

776 
	$unix_˛i_∑gî_ªdøw
 (
unix_˛i_fûe_t
 * 
cf
, 
˛ib_fûe_t
 * 
uf
)

778 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

779 
u8
 *
löe
 = 
NULL
;

780 
w‹d
 
i
;

783 i‡(!
	`vec_Àn
 (
cf
->
∑gî_ödex
))

786 i‡(
cf
->
™si_ˇ∑bÀ
)

789 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

790 (
u8
 *Ë
ANSI_CLEAR
,

791  (
ANSI_CLEAR
) - 1);

796 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

800 
i
 = 0; i < 
cf
->
height
 - 1 &&

801 
i
 + 
cf
->
∑gî_°¨t
 < 
	`vec_Àn
 (cf->
∑gî_ödex
); i++)

803 
pi
 = &
cf
->
∑gî_ödex
[cf->
∑gî_°¨t
 + 
i
];

804 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

806 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

809 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

810 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

812 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

813 
	}
}

837 
	$unix_˛i_∑gî_add_löe
 (
unix_˛i_fûe_t
 * 
cf
, 
u8
 * 
löe
, 
w‹d
 
Àn_‹_ödex
)

839 
u8
 *
p
 = 
NULL
;

840 
w‹d
 
i
, 
j
, 
k
;

841 
w‹d
 
löe_ödex
, 
Àn
;

842 
u32
 
width
 = 
cf
->width;

843 
unix_˛i_∑gî_ödex_t
 *
pi
;

845 i‡(
löe
 =
NULL
)

848 
löe_ödex
 = 
Àn_‹_ödex
;

849 i‡(
cf
->
∑gî_ve˘‹
 !
NULL
)

850 
p
 = 
cf
->
∑gî_ve˘‹
[
löe_ödex
];

851 
Àn
 = 
	`vec_Àn
 (
p
);

855 
Àn
 = 
Àn_‹_ödex
;

857 
p
 = 
	`vec_√w
 (
u8
, 
Àn
);

858 
	`˛ib_mem˝y
 (
p
, 
löe
, 
Àn
);

861 
löe_ödex
 = 
	`vec_Àn
 (
cf
->
∑gî_ve˘‹
);

862 
	`vec_add1
 (
cf
->
∑gî_ve˘‹
, 
p
);

865 
i
 = 0;

866 
i
 < 
Àn
)

869 
l
 = 
Àn
 - 
i
;

870 
j
 = 
	`unix_vlib_födchr
 ((
u8
Ë'\n', 
p
, 
l
 < 
width
 ?Ü : width);

872 i‡(
j
 < 
l
 && 
p
[j] == '\n')

873 
j
++;

876 
k
 = 
	`vec_Àn
 (
cf
->
∑gî_ödex
);

877 
	`vec_vÆid©e
 (
cf
->
∑gî_ödex
, 
k
);

878 
pi
 = &
cf
->
∑gî_ödex
[
k
];

880 
pi
->
löe
 = 
löe_ödex
;

881 
pi
->
off£t
 = 
i
;

882 
pi
->
Àngth
 = 
j
;

884 
i
 +
j
;

885 
p
 +
j
;

887 
	}
}

899 
	$unix_˛i_∑gî_ªödex
 (
unix_˛i_fûe_t
 * 
cf
)

901 
w‹d
 
i
, 
ﬁd_löe
, 
ﬁd_off£t
;

902 
unix_˛i_∑gî_ödex_t
 *
pi
;

907 i‡(
cf
->
∑gî_ve˘‹
 == 0)

909 
	`vec_ª£t_Àngth
 (
cf
->
∑gî_ödex
);

916 
pi
 = &
cf
->
∑gî_ödex
[cf->
∑gî_°¨t
];

917 
ﬁd_löe
 = 
pi
->
löe
;

918 
ﬁd_off£t
 = 
pi
->
off£t
;

921 
	`vec_ª£t_Àngth
 (
cf
->
∑gî_ödex
);

922 
	`vec_f‹óch_ödex
 (
i
, 
cf
->
∑gî_ve˘‹
)

924 
	`unix_˛i_∑gî_add_löe
 (
cf
, 
NULL
, 
i
);

928 
	`vec_f‹óch_ödex
 (
i
, 
cf
->
∑gî_ödex
)

930 
pi
 = &
cf
->
∑gî_ödex
[
i
];

932 i‡(
pi
->
löe
 =
ﬁd_löe
 &&

933 (
pi
->
off£t
 <
ﬁd_off£t
 ||Öi->off£à+Öi->
Àngth
 > old_offset))

936 
cf
->
∑gî_°¨t
 = 
i
;

944 i‡(
cf
->
∑gî_°¨t
 >
	`vec_Àn
 (cf->
∑gî_ödex
))

946 i‡(!
cf
->
height
 || 
	`vec_Àn
 (cf->
∑gî_ödex
) < (cf->height - 1))

947 
cf
->
∑gî_°¨t
 = 0;

949 
cf
->
∑gî_°¨t
 = 
	`vec_Àn
 (cf->
∑gî_ödex
Ë- (cf->
height
 - 1);

951 
	}
}

972 
	$unix_vlib_˛i_ouçut
 (
uw‹d
 
˛i_fûe_ödex
, 
u8
 * 
buf„r
, uw‹d 
buf„r_byãs
)

974 
unix_maö_t
 *
um
 = &
unix_maö
;

975 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

976 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

977 
unix_˛i_fûe_t
 *
cf
;

978 
˛ib_fûe_t
 *
uf
;

980 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
˛i_fûe_ödex
);

981 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

983 i‡(
cf
->
no_∑gî
 || 
um
->
˛i_∑gî_buf„r_limô
 =0 || cf->
height
 == 0)

985 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
buf„r
, 
buf„r_byãs
);

989 
w‹d
 
row
 = 
	`vec_Àn
 (
cf
->
∑gî_ödex
);

990 
u8
 *
löe
;

991 
unix_˛i_∑gî_ödex_t
 *
pi
;

994 
	`unix_˛i_∑gî_add_löe
 (
cf
, 
buf„r
, 
buf„r_byãs
);

999 
row
 < 
	`vec_Àn
 (
cf
->
∑gî_ödex
))

1001 i‡(
row
 < 
cf
->
height
 - 1)

1004 
pi
 = &
cf
->
∑gî_ödex
[
row
];

1005 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1006 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1010 i‡(
löe
[
pi
->
Àngth
 - 1] !'\n' && 
row
 =
cf
->
height
 - 2)

1011 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1016 i‡(!(
row
 % 10))

1017 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1019 
row
++;

1023 i‡(
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë> 
um
->
˛i_∑gî_buf„r_limô
)

1026 
cf
->
no_∑gî
 = 2;

1029 i‡(
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë> cf->
height
 - 1)

1030 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1033 
row
 = 
cf
->
∑gî_°¨t
 + (cf->
height
 - 1);

1034 
row
 < 
	`vec_Àn
 (
cf
->
∑gî_ödex
);Ñow++)

1036 
pi
 = &
cf
->
∑gî_ödex
[
row
];

1037 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1038 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1041 
	`unix_˛i_∑gî_ª£t
 (
cf
);

1044 
	}
}

1059 
u8


1060 
	$unix_˛i_ãrmöÆ_ty≥_™si
 (
u8
 * 
ãrm
, 
uw‹d
 
Àn
)

1063 
	#_
(
a
) do { \

1064 i‡(
	`°∫ˇ£cmp
(
a
, (*)
ãrm
, (
size_t
)
Àn
) == 0)  1; \

1065 } 0)

	)

1067 
	`_
("xterm");

1068 
	`_
("xterm-color");

1069 
	`_
("xterm-256color");

1070 
	`_
("screen");

1071 
	`_
("screen-256color");

1072 
	`_
("ansi");

1073 #unde‡
_


1076 
	}
}

1091 
u8


1092 
	$unix_˛i_ãrmöÆ_ty≥_n⁄öãø˘ive
 (
u8
 * 
ãrm
, 
uw‹d
 
Àn
)

1095 
	#_
(
a
) do { \

1096 i‡(
	`°∫ˇ£cmp
(
a
, (*)
ãrm
, (
size_t
)
Àn
) == 0)  1; \

1097 } 0)

	)

1099 
	`_
("vppctl");

1100 #unde‡
_


1103 
	}
}

1107 
	$unix_˛i_£t_£ssi⁄_n⁄öãø˘ive
 (
unix_˛i_fûe_t
 * 
cf
)

1110 
cf
->
is_öãø˘ive
 = 0;

1111 
cf
->
no_∑gî
 = 1;

1112 
cf
->
hi°‹y_limô
 = 0;

1113 
cf
->
has_hi°‹y
 = 0;

1114 
cf
->
löe_mode
 = 1;

1115 
	}
}

1119 
	$unix_˛i_fûe_wñcome
 (
unix_˛i_maö_t
 * 
cm
, 
unix_˛i_fûe_t
 * 
cf
)

1121 
unix_maö_t
 *
um
 = &
unix_maö
;

1122 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

1123 
˛ib_fûe_t
 *
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

1124 
unix_˛i_b™√r_t
 *
b™√r
;

1125 
i
, 
Àn
;

1128 
cf
->
°¨ãd
 = 1;

1130 i‡(!(
cf
->
is_öãø˘ive
))

1138 
	`unix_˛i_add_≥ndög_ouçut
 (
uf
, 
cf
, (
u8
 *) "\r", 1);

1140 i‡(!
um
->
˛i_no_b™√r
)

1142 i‡(
cf
->
™si_ˇ∑bÀ
)

1144 
b™√r
 = 
unix_˛i_b™√r_cﬁ‹
;

1145 
Àn
 = 
	`ARRAY_LEN
 (
unix_˛i_b™√r_cﬁ‹
);

1149 
b™√r
 = 
unix_˛i_b™√r
;

1150 
Àn
 = 
	`ARRAY_LEN
 (
unix_˛i_b™√r
);

1153 
i
 = 0; i < 
Àn
; i++)

1155 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1156 
b™√r
[
i
].
löe
, b™√r[i].
Àngth
);

1161 
	`unix_˛i_˛i_¥om±
 (
cf
, 
uf
);

1163 
	}
}

1168 
	$unix_˛i_fûe_wñcome_timî
 (
™y
 
¨g
, 
f64
 
dñay
)

1170 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

1171 
unix_˛i_fûe_t
 *
cf
;

1172 (Ë
dñay
;

1175 i‡(
	`poﬁ_is_‰ì_ödex
 (
cm
->
˛i_fûe_poﬁ
, (
uw‹d
Ë
¨g
))

1178 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, (
uw‹d
Ë
¨g
);

1180 i‡(!
cf
->
°¨ãd
)

1181 
	`unix_˛i_fûe_wñcome
 (
cm
, 
cf
);

1182 
	}
}

1192 
i32


1193 
	$unix_˛i_¥o˚ss_ã ë
 (
unix_maö_t
 * 
um
,

1194 
unix_˛i_fûe_t
 * 
cf
,

1195 
˛ib_fûe_t
 * 
uf
, 
u8
 * 
öput_ve˘‹
, 
uw‹d
 
Àn
)

1201 
i32
 
c⁄sume
 = 0;

1203 i‡(
Àn
 == 1)

1206 
öput_ve˘‹
[1])

1208 
IAC
:

1212 
c⁄sume
 = 1;

1215 
WILL
:

1216 
WONT
:

1217 
DO
:

1218 
DONT
:

1220 i‡(
	`vec_Àn
 (
öput_ve˘‹
) < 3)

1223 
c⁄sume
 = 2;

1226 
SB
:

1229 
i32
 
i
;

1230 
i
 = 3; i < 
Àn
 && i < 
UNIX_CLI_MAX_DEPTH_TELNET
; i++)

1232 i‡(
öput_ve˘‹
[
i
 - 1] =
IAC
 && i≈ut_ve˘‹[i] =
SE
)

1235 
öput_ve˘‹
[2])

1237 
TELOPT_TTYPE
:

1238 i‡(
öput_ve˘‹
[3] != 0)

1242 
u8
 *
ãrm
 = 
öput_ve˘‹
 + 4;

1243 
uw‹d
 
Àn
 = 
i
 - 5;

1246 
cf
->
™si_ˇ∑bÀ
 =

1247 
	`unix_˛i_ãrmöÆ_ty≥_™si
 (
ãrm
, 
Àn
);

1250 i‡(
	`unix_˛i_ãrmöÆ_ty≥_n⁄öãø˘ive
 (
ãrm
, 
Àn
))

1251 
	`unix_˛i_£t_£ssi⁄_n⁄öãø˘ive
 (
cf
);

1255 i‡(!
cf
->
°¨ãd
)

1257 
	`unix_˛i_fûe_wñcome
 (&
unix_˛i_maö
, 
cf
);

1260 
TELOPT_NAWS
:

1262 i‡(
i
 != 8)

1265 
cf
->
width
 =

1266 
	`˛ib_√t_to_ho°_u16
 (*((
u16
 *Ë(
öput_ve˘‹
 + 3)));

1267 i‡(
cf
->
width
 > 
UNIX_CLI_MAX_TERMINAL_WIDTH
)

1268 
cf
->
width
 = 
UNIX_CLI_MAX_TERMINAL_WIDTH
;

1269 i‡(
cf
->
width
 == 0)

1270 
cf
->
width
 = 
UNIX_CLI_DEFAULT_TERMINAL_WIDTH
;

1272 
cf
->
height
 =

1273 
	`˛ib_√t_to_ho°_u16
 (*((
u16
 *Ë(
öput_ve˘‹
 + 5)));

1274 i‡(
cf
->
height
 > 
UNIX_CLI_MAX_TERMINAL_HEIGHT
)

1275 
cf
->
height
 = 
UNIX_CLI_MAX_TERMINAL_HEIGHT
;

1276 i‡(
cf
->
height
 == 0)

1277 
cf
->
height
 = 
UNIX_CLI_DEFAULT_TERMINAL_HEIGHT
;

1280 
	`unix_˛i_∑gî_ªödex
 (
cf
);

1282 
	`unix_˛i_∑gî_ªdøw
 (
cf
, 
uf
);

1289 
c⁄sume
 = 
i
;

1294 i‡(
i
 =
UNIX_CLI_MAX_DEPTH_TELNET
)

1295 
c⁄sume
 = 1;

1297 i‡(
c⁄sume
 == 0)

1303 
GA
:

1304 
EL
:

1305 
EC
:

1306 
AO
:

1307 
IP
:

1308 
BREAK
:

1309 
DM
:

1310 
NOP
:

1311 
SE
:

1312 
EOR
:

1313 
ABORT
:

1314 
SUSP
:

1315 
xEOF
:

1317 
c⁄sume
 = 1;

1320 
AYT
:

1322 
c⁄sume
 = 1;

1323 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "fd.io VPP\n", 10);

1331  
c⁄sume
;

1332 
	}
}

1339 
	$unix_˛i_löe_¥o˚ss_⁄e
 (
unix_˛i_maö_t
 * 
cm
,

1340 
unix_maö_t
 * 
um
,

1341 
unix_˛i_fûe_t
 * 
cf
,

1342 
˛ib_fûe_t
 * 
uf
,

1343 
u8
 
öput
, 
unix_˛i_∑r£_a˘i⁄_t
 
a˘i⁄
)

1345 
u8
 *
¥ev
;

1346 
u8
 *
ßve
 = 0;

1347 
u8
 **
possibÀ_comm™ds
;

1348 
j
, 
dñè
;

1350 
a˘i⁄
)

1352 
UNIX_CLI_PARSE_ACTION_NOACTION
:

1355 
UNIX_CLI_PARSE_ACTION_REVSEARCH
:

1356 
UNIX_CLI_PARSE_ACTION_FWDSEARCH
:

1357 i‡(!
cf
->
has_hi°‹y
 || !cf->
hi°‹y_limô
)

1359 i‡(
cf
->
£¨ch_mode
 == 0)

1362 
j
 = 0; j < (
	`vec_Àn
 (
cf
->
cuºít_comm™d
)); j++)

1363 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b \b", 3);

1365 
	`vec_ª£t_Àngth
 (
cf
->
£¨ch_key
);

1366 
	`vec_ª£t_Àngth
 (
cf
->
cuºít_comm™d
);

1367 i‡(
a˘i⁄
 =
UNIX_CLI_PARSE_ACTION_REVSEARCH
)

1368 
cf
->
£¨ch_mode
 = -1;

1370 
cf
->
£¨ch_mode
 = 1;

1371 
cf
->
curs‹
 = 0;

1375 i‡(
a˘i⁄
 =
UNIX_CLI_PARSE_ACTION_REVSEARCH
)

1376 
cf
->
£¨ch_mode
 = -1;

1378 
cf
->
£¨ch_mode
 = 1;

1380 
cf
->
excursi⁄
 +cf->
£¨ch_mode
;

1381 
£¨ch_agaö
;

1385 
UNIX_CLI_PARSE_ACTION_ERASELINELEFT
:

1389 
dñè
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
;

1390 
j
 = 
cf
->
curs‹
; j > 
dñè
; j--)

1391 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1393 ; 
j
 < (
	`vec_Àn
 (
cf
->
cuºít_comm™d
)); j++)

1394 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " ", 1);

1396 
j
 = 0; j < (
	`vec_Àn
 (
cf
->
cuºít_comm™d
)); j++)

1397 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1399 
j
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
;

1400 
	`memmove
 (
cf
->
cuºít_comm™d
, cf->cuºít_comm™d + cf->
curs‹
, 
j
);

1401 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ë
j
;

1404 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, cf->
cuºít_comm™d
, 
j
);

1406 
j
 = 0; j < (
	`vec_Àn
 (
cf
->
cuºít_comm™d
)); j++)

1407 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1408 
cf
->
curs‹
 = 0;

1410 
cf
->
£¨ch_mode
 = 0;

1413 
UNIX_CLI_PARSE_ACTION_ERASELINERIGHT
:

1417 
j
 = 
cf
->
curs‹
; j < (
	`vec_Àn
 (cf->
cuºít_comm™d
)); j++)

1418 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " ", 1);

1420 
j
 = 
cf
->
curs‹
; j < (
	`vec_Àn
 (cf->
cuºít_comm™d
)); j++)

1421 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1424 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ëcf->
curs‹
;

1426 
cf
->
£¨ch_mode
 = 0;

1429 
UNIX_CLI_PARSE_ACTION_LEFT
:

1430 i‡(
cf
->
curs‹
 > 0)

1432 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1433 
cf
->
curs‹
--;

1436 
cf
->
£¨ch_mode
 = 0;

1439 
UNIX_CLI_PARSE_ACTION_RIGHT
:

1440 i‡(
cf
->
curs‹
 < 
	`vec_Àn
 (cf->
cuºít_comm™d
))

1443 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1444 
cf
->
cuºít_comm™d
 + cf->
curs‹
, 1);

1445 
cf
->
curs‹
++;

1448 
cf
->
£¨ch_mode
 = 0;

1451 
UNIX_CLI_PARSE_ACTION_UP
:

1452 
UNIX_CLI_PARSE_ACTION_DOWN
:

1453 i‡(!
cf
->
has_hi°‹y
 || !cf->
hi°‹y_limô
)

1455 
cf
->
£¨ch_mode
 = 0;

1457 
j
 = 
cf
->
curs‹
; j < (
	`vec_Àn
 (cf->
cuºít_comm™d
)); j++)

1458 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " ", 1);

1459 
j
 = 0; j < (
	`vec_Àn
 (
cf
->
cuºít_comm™d
)); j++)

1460 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b \b", 3);

1461 
	`vec_ª£t_Àngth
 (
cf
->
cuºít_comm™d
);

1462 i‡(
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
))

1464 i‡(
a˘i⁄
 =
UNIX_CLI_PARSE_ACTION_UP
)

1465 
dñè
 = -1;

1467 
dñè
 = 1;

1469 
cf
->
excursi⁄
 +
dñè
;

1471 i‡(
cf
->
excursi⁄
 =
	`vec_Àn
 (cf->
comm™d_hi°‹y
))

1474 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
) = 0;

1476 i‡(
cf
->
excursi⁄
 < 0)

1479 
cf
->
excursi⁄
 = 
	`vec_Àn
 (cf->
comm™d_hi°‹y
);

1480 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
) = 0;

1484 i‡(
cf
->
excursi⁄
 > (
i32
Ë
	`vec_Àn
 (cf->
comm™d_hi°‹y
) - 1)

1486 
cf
->
excursi⁄
 = 0;

1489 
¥ev
 = 
cf
->
comm™d_hi°‹y
[cf->
excursi⁄
];

1490 
	`vec_vÆid©e
 (
cf
->
cuºít_comm™d
, 
	`vec_Àn
 (
¥ev
) - 1);

1492 
	`˛ib_mem˝y
 (
cf
->
cuºít_comm™d
, 
¥ev
, 
	`vec_Àn
 (prev));

1493 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ë
	`vec_Àn
 (
¥ev
);

1494 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, cf->
cuºít_comm™d
,

1495 
	`vec_Àn
 (
cf
->
cuºít_comm™d
));

1498 
cf
->
curs‹
 = 
	`vec_Àn
 (cf->
cuºít_comm™d
);

1501 
UNIX_CLI_PARSE_ACTION_HOME
:

1502 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë&& cf->
curs‹
 > 0)

1504 
cf
->
curs‹
)

1506 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1507 
cf
->
curs‹
--;

1511 
cf
->
£¨ch_mode
 = 0;

1514 
UNIX_CLI_PARSE_ACTION_END
:

1515 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
) &&

1516 
cf
->
curs‹
 < 
	`vec_Àn
 (cf->
cuºít_comm™d
))

1518 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1519 
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1520 
	`vec_Àn
 (
cf
->
cuºít_comm™d
) -

1521 
cf
->
curs‹
);

1522 
cf
->
curs‹
 = 
	`vec_Àn
 (cf->
cuºít_comm™d
);

1525 
cf
->
£¨ch_mode
 = 0;

1528 
UNIX_CLI_PARSE_ACTION_WORDLEFT
:

1529 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë&& cf->
curs‹
 > 0)

1531 
j
 = 
cf
->
curs‹
;

1533 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1534 
j
--;

1536 
j
 && 
	`is•a˚
 (
cf
->
cuºít_comm™d
[j]))

1538 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1539 
j
--;

1541 
j
 && !
	`is•a˚
 (
cf
->
cuºít_comm™d
[j]))

1543 i‡(
	`is•a˚
 (
cf
->
cuºít_comm™d
[
j
 - 1]))

1545 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1546 
j
--;

1549 
cf
->
curs‹
 = 
j
;

1552 
cf
->
£¨ch_mode
 = 0;

1555 
UNIX_CLI_PARSE_ACTION_WORDRIGHT
:

1556 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
) &&

1557 
cf
->
curs‹
 < 
	`vec_Àn
 (cf->
cuºít_comm™d
))

1559 
e
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
);

1560 
j
 = 
cf
->
curs‹
;

1561 
j
 < 
e
 && !
	`is•a˚
 (
cf
->
cuºít_comm™d
[j]))

1562 
j
++;

1563 
j
 < 
e
 && 
	`is•a˚
 (
cf
->
cuºít_comm™d
[j]))

1564 
j
++;

1565 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1566 
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1567 
j
 - 
cf
->
curs‹
);

1568 
cf
->
curs‹
 = 
j
;

1571 
cf
->
£¨ch_mode
 = 0;

1575 
UNIX_CLI_PARSE_ACTION_ERASE
:

1576 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
))

1578 i‡(
cf
->
curs‹
 =
	`vec_Àn
 (cf->
cuºít_comm™d
))

1580 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b \b", 3);

1581 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
)--;

1582 
cf
->
curs‹
--;

1584 i‡(
cf
->
curs‹
 > 0)

1587 
j
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
;

1588 
	`memmove
 (
cf
->
cuºít_comm™d
 + cf->
curs‹
 - 1,

1589 
cf
->
cuºít_comm™d
 + cf->
curs‹
, 
j
);

1590 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
)--;

1591 
cf
->
curs‹
--;

1593 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1594 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1595 
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1596 
j
);

1597 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " \b\b", 3);

1599 --
j
)

1600 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1603 
cf
->
£¨ch_mode
 = 0;

1604 
cf
->
excursi⁄
 = 0;

1605 
	`vec_ª£t_Àngth
 (
cf
->
£¨ch_key
);

1608 
UNIX_CLI_PARSE_ACTION_ERASERIGHT
:

1609 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
))

1611 i‡(
cf
->
curs‹
 < 
	`vec_Àn
 (cf->
cuºít_comm™d
))

1614 
j
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
 - 1;

1615 
	`memmove
 (
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1616 
cf
->
cuºít_comm™d
 + cf->
curs‹
 + 1, 
j
);

1617 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
)--;

1619 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1620 
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1621 
j
);

1622 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) " \b", 2);

1624 i‡(
j
)

1626 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1627 --
j
)

1628 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1632 i‡(
öput
 == 'D' - '@')

1635 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "quit\n", 5);

1636 
	`vlib_¥o˚ss_sig«l_evít
 (
um
->
vlib_maö
,

1637 
	`vlib_cuºít_¥o˚ss
 (
um
->
vlib_maö
),

1638 
UNIX_CLI_PROCESS_EVENT_QUIT
,

1639 
cf
 - 
cm
->
˛i_fûe_poﬁ
);

1641 
cf
->
£¨ch_mode
 = 0;

1642 
cf
->
excursi⁄
 = 0;

1643 
	`vec_ª£t_Àngth
 (
cf
->
£¨ch_key
);

1646 
UNIX_CLI_PARSE_ACTION_CLEAR
:

1651 i‡(
cf
->
™si_ˇ∑bÀ
)

1652 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
,

1653 (
u8
 *Ë
ANSI_CLEAR
,

1654  (
ANSI_CLEAR
) - 1);

1656 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1658 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
,

1659 
cm
->
˛i_¥om±
, 
	`vec_Àn
 (cm->cli_prompt));

1660 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
,

1661 
cf
->
cuºít_comm™d
,

1662 
	`vec_Àn
 (
cf
->
cuºít_comm™d
));

1663 
j
 = 
cf
->
curs‹
; j < 
	`vec_Àn
 (cf->
cuºít_comm™d
); j++)

1664 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1668 
UNIX_CLI_PARSE_ACTION_TAB
:

1669 i‡(
cf
->
curs‹
 < 
	`vec_Àn
 (cf->
cuºít_comm™d
))

1673 i‡(
	`is•a˚
 (
cf
->
cuºít_comm™d
[cf->
curs‹
]))

1676 
	`vec_ªsize
 (
ßve
, 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
);

1677 
	`˛ib_mem˝y
 (
ßve
, 
cf
->
cuºít_comm™d
 + cf->
curs‹
,

1678 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
);

1679 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ëcf->
curs‹
;

1683 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\a", 1);

1687 
possibÀ_comm™ds
 =

1688 
	`vlib_˛i_gë_possibÀ_com∂ëi⁄s
 (
cf
->
cuºít_comm™d
);

1689 i‡(
	`vec_Àn
 (
possibÀ_comm™ds
) == 1)

1691 
u32
 
j
 = 
cf
->
curs‹
;

1692 
u8
 *
com∂ëed
 = 
possibÀ_comm™ds
[0];

1695 
j
 >1 && !
	`is•a˚
 (
cf
->
cuºít_comm™d
[j - 1]))

1697 
j
--;

1698 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1700 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ë
j
;

1703 
	`vec_≠≥nd
 (
cf
->
cuºít_comm™d
, 
com∂ëed
);

1706 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, 
com∂ëed
, 
	`vec_Àn
 (completed));

1709 i‡(
	`vec_Àn
 (
ßve
) == 0)

1711 
	`vec_add1
 (
cf
->
cuºít_comm™d
, ' ');

1712 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) " ", 1);

1715 
cf
->
curs‹
 = 
	`vec_Àn
 (cf->
cuºít_comm™d
);

1718 i‡(
	`vec_Àn
 (
possibÀ_comm™ds
) >= 2)

1720 
u8
 **
possibÀ_comm™d
;

1721 
uw‹d
 
max_comm™d_Àn
 = 0, 
mö_comm™d_Àn
 = ~0;

1722 
u32
 
i
, 
j
;

1724 
	`vec_f‹óch
 (
possibÀ_comm™d
, 
possibÀ_comm™ds
)

1726 i‡(
	`vec_Àn
 (*
possibÀ_comm™d
Ë> 
max_comm™d_Àn
)

1728 
max_comm™d_Àn
 = 
	`vec_Àn
 (*
possibÀ_comm™d
);

1730 i‡(
	`vec_Àn
 (*
possibÀ_comm™d
Ë< 
mö_comm™d_Àn
)

1732 
mö_comm™d_Àn
 = 
	`vec_Àn
 (*
possibÀ_comm™d
);

1736 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1738 
i
 = 0;

1739 
	`vec_f‹óch
 (
possibÀ_comm™d
, 
possibÀ_comm™ds
)

1741 i‡(
i
 + 
max_comm™d_Àn
 >
cf
->
width
)

1743 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1744 
i
 = 0;

1746 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, *
possibÀ_comm™d
,

1747 
	`vec_Àn
 (*
possibÀ_comm™d
));

1748 
j
 = 
	`vec_Àn
 (*
possibÀ_comm™d
); j < 
max_comm™d_Àn
 + 2;

1749 
j
++)

1751 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) " ", 1);

1753 
i
 +
max_comm™d_Àn
 + 2;

1756 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1759 
	`unix_˛i_˛i_¥om±
 (
cf
, 
uf
);

1760 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, cf->
cuºít_comm™d
,

1761 
	`vec_Àn
 (
cf
->
cuºít_comm™d
));

1764 
j
 = 
cf
->
curs‹
;

1765 
i
 = 0;

1766 
j
 >1 && !
	`is•a˚
 (
cf
->
cuºít_comm™d
[j - 1]))

1768 
j
--;

1769 
i
++;

1773 ; 
i
 < 
mö_comm™d_Àn
; i++)

1775 
u8
 
comm⁄
 = '\0';

1776 
°›
 = 0;

1777 
	`vec_f‹óch
 (
possibÀ_comm™d
, 
possibÀ_comm™ds
)

1779 i‡(
comm⁄
 == '\0')

1781 
comm⁄
 = (*
possibÀ_comm™d
)[
i
];

1783 i‡(
comm⁄
 !(*
possibÀ_comm™d
)[
i
])

1785 
°›
 = 1;

1789 i‡(!
°›
)

1791 
	`vec_add1
 (
cf
->
cuºít_comm™d
, 
comm⁄
);

1792 
cf
->
curs‹
++;

1793 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *Ë& 
comm⁄
, 1);

1803 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\a", 1);

1806 i‡(
	`vec_Àn
 (
ßve
) > 0)

1809 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, 
ßve
, 
	`vec_Àn
 (save));

1810 
j
 = 0; j < 
	`vec_Àn
 (
ßve
); j++)

1812 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

1814 
	`vec_≠≥nd
 (
cf
->
cuºít_comm™d
, 
ßve
);

1815 
	`vec_‰ì
 (
ßve
);

1817 
	`vec_‰ì
 (
possibÀ_comm™ds
);

1820 
UNIX_CLI_PARSE_ACTION_YANK
:

1825 
UNIX_CLI_PARSE_ACTION_PAGER_QUIT
:

1826 
∑gî_quô
:

1827 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1828 
	`unix_˛i_∑gî_ª£t
 (
cf
);

1829 
	`unix_˛i_˛i_¥om±
 (
cf
, 
uf
);

1832 
UNIX_CLI_PARSE_ACTION_PAGER_NEXT
:

1833 
UNIX_CLI_PARSE_ACTION_PAGER_PGDN
:

1835 i‡(
cf
->
height
 + cf->
∑gî_°¨t
 < 
	`vec_Àn
 (cf->
∑gî_ödex
))

1837 
u8
 *
löe
 = 
NULL
;

1838 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

1840 
m
 = 
cf
->
∑gî_°¨t
 + (cf->
height
 - 1);

1841 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1842 
j
 = 
m
;

1843 
j
 < 
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë&& cf->
∑gî_°¨t
 < 
m
;

1844 
j
++, 
cf
->
∑gî_°¨t
++)

1846 
pi
 = &
cf
->
∑gî_ödex
[
j
];

1847 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1848 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1851 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

1852 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1853 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1857 i‡(
a˘i⁄
 =
UNIX_CLI_PARSE_ACTION_PAGER_NEXT
)

1859 
∑gî_quô
;

1863 
UNIX_CLI_PARSE_ACTION_PAGER_DN
:

1864 
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
:

1866 i‡(
cf
->
∑gî_°¨t
 < 
	`vec_Àn
 (cf->
∑gî_ödex
Ë- (cf->
height
 - 1))

1868 
u8
 *
löe
;

1869 
unix_˛i_∑gî_ödex_t
 *
pi
;

1871 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1872 
pi
 = &
cf
->
∑gî_ödex
[cf->
∑gî_°¨t
 + (cf->
height
 - 1)];

1873 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1874 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1875 
cf
->
∑gî_°¨t
++;

1877 i‡(
löe
[
pi
->
Àngth
 - 1] != '\n')

1878 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1879 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1883 i‡(
a˘i⁄
 =
UNIX_CLI_PARSE_ACTION_PAGER_CRLF
)

1885 
∑gî_quô
;

1890 
UNIX_CLI_PARSE_ACTION_PAGER_UP
:

1892 i‡(
cf
->
∑gî_°¨t
 > 0)

1894 
u8
 *
löe
 = 
NULL
;

1895 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

1897 
cf
->
∑gî_°¨t
--;

1898 i‡(
cf
->
™si_ˇ∑bÀ
)

1900 
pi
 = &
cf
->
∑gî_ödex
[cf->
∑gî_°¨t
];

1901 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1902 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1903 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *Ë
ANSI_SCROLLDN
,

1904  (
ANSI_SCROLLDN
) - 1);

1905 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *Ë
ANSI_SAVECURSOR
,

1906  (
ANSI_SAVECURSOR
) - 1);

1907 
	`unix_˛i_™si_curs‹
 (
cf
, 
uf
, 1, 1);

1908 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *Ë
ANSI_CLEARLINE
,

1909  (
ANSI_CLEARLINE
) - 1);

1910 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1911 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *Ë
ANSI_RESTCURSOR
,

1912  (
ANSI_RESTCURSOR
) - 1);

1913 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1914 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1918 
m
 = 
cf
->
∑gî_°¨t
 + (cf->
height
 - 1);

1919 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1920 
j
 = 
cf
->
∑gî_°¨t
;

1921 
j
 < 
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë&& j < 
m
; j++)

1923 
pi
 = &
cf
->
∑gî_ödex
[
j
];

1924 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1925 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1928 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

1929 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1930 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1935 
UNIX_CLI_PARSE_ACTION_PAGER_TOP
:

1937 i‡(
cf
->
∑gî_°¨t
 > 0)

1939 
u8
 *
löe
 = 
NULL
;

1940 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

1942 
cf
->
∑gî_°¨t
 = 0;

1943 
m
 = 
cf
->
∑gî_°¨t
 + (cf->
height
 - 1);

1944 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1945 
j
 = 
cf
->
∑gî_°¨t
; j < 
	`vec_Àn
 (cf->
∑gî_ödex
Ë&& j < 
m
;

1946 
j
++)

1948 
pi
 = &
cf
->
∑gî_ödex
[
j
];

1949 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1950 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1953 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

1954 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1955 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1959 
UNIX_CLI_PARSE_ACTION_PAGER_BOTTOM
:

1961 i‡(
cf
->
∑gî_°¨t
 < 
	`vec_Àn
 (cf->
∑gî_ödex
Ë- (cf->
height
 - 1))

1963 
u8
 *
löe
 = 
NULL
;

1964 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

1966 
cf
->
∑gî_°¨t
 = 
	`vec_Àn
 (cf->
∑gî_ödex
Ë- (cf->
height
 - 1);

1967 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1968 
	`unix_˛i_∑gî_mesßge
 (
cf
, 
uf
, "skipping", "\n");

1969 
j
 = 
cf
->
∑gî_°¨t
; j < 
	`vec_Àn
 (cf->
∑gî_ödex
); j++)

1971 
pi
 = &
cf
->
∑gî_ödex
[
j
];

1972 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

1973 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

1976 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

1977 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

1978 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

1982 
UNIX_CLI_PARSE_ACTION_PAGER_PGUP
:

1984 i‡(
cf
->
∑gî_°¨t
 > 0)

1986 
u8
 *
löe
 = 
NULL
;

1987 
unix_˛i_∑gî_ödex_t
 *
pi
 = 
NULL
;

1988 
m
;

1990 i‡(
cf
->
∑gî_°¨t
 >cf->
height
)

1991 
cf
->
∑gî_°¨t
 -cf->
height
 - 1;

1993 
cf
->
∑gî_°¨t
 = 0;

1994 
m
 = 
cf
->
∑gî_°¨t
 + cf->
height
 - 1;

1995 
	`unix_˛i_∑gî_¥om±_îa£
 (
cf
, 
uf
);

1996 
j
 = 
cf
->
∑gî_°¨t
; j < 
	`vec_Àn
 (cf->
∑gî_ödex
Ë&& j < 
m
;

1997 
j
++)

1999 
pi
 = &
cf
->
∑gî_ödex
[
j
];

2000 
löe
 = 
cf
->
∑gî_ve˘‹
[
pi
->löe] +Öi->
off£t
;

2001 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, 
löe
, 
pi
->
Àngth
);

2004 i‡(
pi
 && 
löe
[pi->
Àngth
 - 1] != '\n')

2005 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

2006 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

2010 
UNIX_CLI_PARSE_ACTION_PAGER_REDRAW
:

2012 
	`unix_˛i_∑gî_ªdøw
 (
cf
, 
uf
);

2015 
UNIX_CLI_PARSE_ACTION_PAGER_SEARCH
:

2020 
UNIX_CLI_PARSE_ACTION_CRLF
:

2021 
¸lf
:

2022 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\n", 1);

2024 i‡(
cf
->
has_hi°‹y
 && cf->
hi°‹y_limô
)

2026 i‡(
cf
->
comm™d_hi°‹y


2027 && 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
Ë>cf->
hi°‹y_limô
)

2029 
	`vec_‰ì
 (
cf
->
comm™d_hi°‹y
[0]);

2030 
	`vec_dñëe
 (
cf
->
comm™d_hi°‹y
, 1, 0);

2033 i‡(
	`vec_Àn
 (
cf
->
cuºít_comm™d
))

2036 
j
 = 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
);

2037 i‡(
j
 == 0 ||

2038 (
	`vec_Àn
 (
cf
->
cuºít_comm™d
) !=

2039 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
[
j
 - 1])

2040 || 
	`memcmp
 (
cf
->
cuºít_comm™d
, cf->
comm™d_hi°‹y
[
j
 - 1],

2041 
	`vec_Àn
 (
cf
->
cuºít_comm™d
)) != 0))

2044 
u8
 *
c
 = 0;

2045 
	`vec_≠≥nd
 (
c
, 
cf
->
cuºít_comm™d
);

2046 
	`vec_add1
 (
cf
->
comm™d_hi°‹y
, 
c
);

2047 
cf
->
comm™d_numbî
++;

2050 
cf
->
excursi⁄
 = 
	`vec_Àn
 (cf->
comm™d_hi°‹y
);

2053 
cf
->
£¨ch_mode
 = 0;

2054 
	`vec_ª£t_Àngth
 (
cf
->
£¨ch_key
);

2055 
cf
->
curs‹
 = 0;

2059 
UNIX_CLI_PARSE_ACTION_PARTIALMATCH
:

2060 
UNIX_CLI_PARSE_ACTION_NOMATCH
:

2061 i‡(
	`vec_Àn
 (
cf
->
∑gî_ödex
))

2065 i‡(
cf
->
has_hi°‹y
 && cf->
£¨ch_mode
 && 
	`i•röt
 (
öput
))

2067 
k
, 
limô
, 
off£t
;

2068 
u8
 *
ôem
;

2070 
	`vec_add1
 (
cf
->
£¨ch_key
, 
öput
);

2072 
£¨ch_agaö
:

2073 
j
 = 0; j < 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
); j++)

2075 i‡(
cf
->
excursi⁄
 > (
i32
Ë
	`vec_Àn
 (cf->
comm™d_hi°‹y
) - 1)

2076 
cf
->
excursi⁄
 = 0;

2077 i‡(
cf
->
excursi⁄
 < 0)

2078 
cf
->
excursi⁄
 = 
	`vec_Àn
 (cf->
comm™d_hi°‹y
) - 1;

2080 
ôem
 = 
cf
->
comm™d_hi°‹y
[cf->
excursi⁄
];

2082 
limô
 = (
	`vec_Àn
 (
cf
->
£¨ch_key
Ë> vec_À¿(
ôem
)) ?

2083 
	`vec_Àn
 (
ôem
Ë: vec_À¿(
cf
->
£¨ch_key
);

2085 
off£t
 = 0; off£à<
	`vec_Àn
 (
ôem
Ë- 
limô
; offset++)

2087 
k
 = 0; k < 
limô
; k++)

2089 i‡(
ôem
[
k
 + 
off£t
] !
cf
->
£¨ch_key
[k])

2090 
√xt_off£t
;

2092 
found_©_off£t
;

2094 
√xt_off£t
:

2097 
√xt
;

2099 
found_©_off£t
:

2100 
j
 = 0; j < 
	`vec_Àn
 (
cf
->
cuºít_comm™d
); j++)

2101 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\b \b", 3);

2103 
	`vec_vÆid©e
 (
cf
->
cuºít_comm™d
, 
	`vec_Àn
 (
ôem
) - 1);

2104 
	`˛ib_mem˝y
 (
cf
->
cuºít_comm™d
, 
ôem
, 
	`vec_Àn
 (item));

2105 
	`_vec_Àn
 (
cf
->
cuºít_comm™d
Ë
	`vec_Àn
 (
ôem
);

2107 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, cf->
cuºít_comm™d
,

2108 
	`vec_Àn
 (
cf
->
cuºít_comm™d
));

2109 
cf
->
curs‹
 = 
	`vec_Àn
 (cf->
cuºít_comm™d
);

2110 
found
;

2112 
√xt
:

2113 
cf
->
excursi⁄
 +cf->
£¨ch_mode
;

2116 
	`unix_vlib_˛i_ouçut_cooked
 (
cf
, 
uf
, (
u8
 *) "\nNo match...", 12);

2117 
	`vec_ª£t_Àngth
 (
cf
->
£¨ch_key
);

2118 
	`vec_ª£t_Àngth
 (
cf
->
cuºít_comm™d
);

2119 
cf
->
£¨ch_mode
 = 0;

2120 
cf
->
curs‹
 = 0;

2121 
¸lf
;

2123 i‡(
	`i•röt
 (
öput
))

2125 i‡(
cf
->
curs‹
 =
	`vec_Àn
 (cf->
cuºít_comm™d
))

2128 
	`vec_add1
 (
cf
->
cuºít_comm™d
, 
öput
);

2129 
cf
->
curs‹
++;

2132 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, &
öput
, 1);

2137 
j
 = 
	`vec_Àn
 (
cf
->
cuºít_comm™d
Ë- cf->
curs‹
;

2138 
	`vec_add1
 (
cf
->
cuºít_comm™d
, (
u8
) 'A');

2139 
	`memmove
 (
cf
->
cuºít_comm™d
 + cf->
curs‹
 + 1,

2140 
cf
->
cuºít_comm™d
 + cf->
curs‹
, 
j
);

2141 
cf
->
cuºít_comm™d
[cf->
curs‹
] = 
öput
;

2143 
j
++;

2144 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
,

2145 
cf
->
cuºít_comm™d
 + cf->
curs‹
, 
j
);

2147 --
j
)

2148 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\b", 1);

2149 
cf
->
curs‹
++;

2157 
found
:

2161 
UNIX_CLI_PARSE_ACTION_TELNETIAC
:

2165 
	}
}

2170 
	$unix_˛i_löe_edô
 (
unix_˛i_maö_t
 * 
cm
, 
unix_maö_t
 * 
um
,

2171 
˛ib_fûe_maö_t
 * 
fm
, 
unix_˛i_fûe_t
 * 
cf
)

2173 
˛ib_fûe_t
 *
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

2174 
i
;

2176 
i
 = 0; i < 
	`vec_Àn
 (
cf
->
öput_ve˘‹
); i++)

2178 
unix_˛i_∑r£_a˘i⁄_t
 
a˘i⁄
;

2179 
i32
 
m©ched
 = 0;

2180 
unix_˛i_∑r£_a˘i⁄s_t
 *
a
;

2183 
a
 =

2184 
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë? 
unix_˛i_∑r£_∑gî
 :

2185 
unix_˛i_∑r£_°rögs
;

2188 
a˘i⁄
 = 
	`unix_˛i_m©ch_a˘i⁄
 (
a
, &
cf
->
öput_ve˘‹
[
i
],

2189 
	`vec_Àn
 (
cf
->
öput_ve˘‹
Ë- 
i
,

2190 &
m©ched
);

2192 
a˘i⁄
)

2194 
UNIX_CLI_PARSE_ACTION_PARTIALMATCH
:

2195 i‡(
i
)

2202 
	`vec_dñëe
 (
cf
->
öput_ve˘‹
, 
i
, 0);

2206 
UNIX_CLI_PARSE_ACTION_TELNETIAC
:

2208 
m©ched
 = 
	`unix_˛i_¥o˚ss_ã ë
 (
um
, 
cf
, 
uf
,

2209 
cf
->
öput_ve˘‹
 + 
i
,

2210 
	`vec_Àn
 (
cf
->
öput_ve˘‹
Ë- 
i
);

2211 i‡(
m©ched
 < 0)

2216 i‡(
i
)

2222 
	`vec_dñëe
 (
cf
->
öput_ve˘‹
, 
i
, 0);

2232 i‡(
cf
->
löe_mode
)

2234 
	`vec_dñëe
 (
cf
->
öput_ve˘‹
, 
i
, 0);

2235 
cf
->
cuºít_comm™d
 = cf->
öput_ve˘‹
;

2240 i‡(!
	`unix_˛i_löe_¥o˚ss_⁄e
 (
cm
, 
um
, 
cf
, 
uf
,

2241 
cf
->
öput_ve˘‹
[
i
], 
a˘i⁄
))

2244 
	`vec_dñëe
 (
cf
->
öput_ve˘‹
, 
i
 + 
m©ched
, 0);

2250 
i
 +
m©ched
;

2253 
	`vec_ª£t_Àngth
 (
cf
->
öput_ve˘‹
);

2255 
	}
}

2259 
	$unix_˛i_¥o˚ss_öput
 (
unix_˛i_maö_t
 * 
cm
, 
uw‹d
 
˛i_fûe_ödex
)

2261 
unix_maö_t
 *
um
 = &
unix_maö
;

2262 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2263 
˛ib_fûe_t
 *
uf
;

2264 
unix_˛i_fûe_t
 *
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
˛i_fûe_ödex
);

2265 
unf‹m©_öput_t
 
öput
;

2266 
	`vlib_∑r£_evÆ
 (
u8
 *);

2268 
cm
->
cuºít_öput_fûe_ödex
 = 
˛i_fûe_ödex
;

2270 
m‹e
:

2272 i‡(0 && 
	`vlib_∑r£_evÆ
 (
cf
->
öput_ve˘‹
) == 0)

2273 
d⁄e
;

2276 i‡(
cf
->
löe_mode
)

2279 
cf
->
cuºít_comm™d
 = cf->
öput_ve˘‹
;

2284 i‡(
	`unix_˛i_löe_edô
 (
cm
, 
um
, 
fm
, 
cf
))

2289 i‡(
um
->
log_fd
)

2291 
u8
 *
lv
;

2292 
	`vec_ª£t_Àngth
 (
lv
);

2293 
lv
 = 
	`f‹m©
 (lv, "%U[%d]: %v",

2294 
f‹m©_timevÆ
, 0 ,

2296 
˛i_fûe_ödex
, 
cf
->
cuºít_comm™d
);

2297 
rv
 
	`__©åibuã__
 ((
unu£d
)Ë
	`wrôe
 (
um
->
log_fd
, 
lv
, 
	`vec_Àn
 (lv));

2301 
	`unf‹m©_öô_ve˘‹
 (&
öput
, 
cf
->
cuºít_comm™d
);

2304 (Ë
	`unf‹m©
 (&
öput
, "");

2306 
cf
->
∑gî_°¨t
 = 0;

2308 i‡(
	`unf‹m©_check_öput
 (&
öput
Ë!
UNFORMAT_END_OF_INPUT
)

2309 
	`vlib_˛i_öput
 (
um
->
vlib_maö
, &
öput
, 
unix_vlib_˛i_ouçut
,

2310 
˛i_fûe_ödex
);

2313 
öput
.
buf„r
 = 0;

2315 
	`unf‹m©_‰ì
 (&
öput
);

2318 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
˛i_fûe_ödex
);

2319 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

2321 
d⁄e
:

2323 i‡(
cf
->
löe_mode
)

2325 
	`vec_ª£t_Àngth
 (
cf
->
öput_ve˘‹
);

2326 
cf
->
cuºít_comm™d
 = 0;

2330 
	`vec_ª£t_Àngth
 (
cf
->
cuºít_comm™d
);

2333 i‡(
cf
->
no_∑gî
 == 2)

2336 
	`unix_˛i_∑gî_mesßge
 (
cf
, 
uf
, "pager buffer overflowed", "\n");

2337 
cf
->
no_∑gî
 = 
um
->
˛i_no_∑gî
;

2340 i‡(
	`vec_Àn
 (
cf
->
∑gî_ödex
) == 0

2341 || 
	`vec_Àn
 (
cf
->
∑gî_ödex
Ë< cf->
height
)

2344 
	`unix_˛i_∑gî_ª£t
 (
cf
);

2347 
	`unix_˛i_˛i_¥om±
 (
cf
, 
uf
);

2352 
	`unix_˛i_∑gî_¥om±
 (
cf
, 
uf
);

2356 i‡(
	`vec_Àn
 (
cf
->
öput_ve˘‹
))

2357 
m‹e
;

2365 i‡(!
cf
->
is_öãø˘ive
)

2366 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, (
u8
 *) "\0", 1);

2367 
	}
}

2374 
	$unix_˛i_kûl
 (
unix_˛i_maö_t
 * 
cm
, 
uw‹d
 
˛i_fûe_ödex
)

2376 
unix_maö_t
 *
um
 = &
unix_maö
;

2377 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2378 
unix_˛i_fûe_t
 *
cf
;

2379 
˛ib_fûe_t
 *
uf
;

2380 
i
;

2382 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
˛i_fûe_ödex
);

2383 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

2386 i‡(
uf
->
fûe_des¸ùt‹
 =
STDIN_FILENO
)

2387 
	`˛ib_l⁄gjmp
 (&
um
->
vlib_maö
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_CLI
);

2389 
	`vec_‰ì
 (
cf
->
cuºít_comm™d
);

2390 
	`vec_‰ì
 (
cf
->
£¨ch_key
);

2392 
i
 = 0; i < 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
); i++)

2393 
	`vec_‰ì
 (
cf
->
comm™d_hi°‹y
[
i
]);

2395 
	`vec_‰ì
 (
cf
->
comm™d_hi°‹y
);

2397 
	`˛ib_fûe_dñ
 (
fm
, 
uf
);

2399 
	`unix_˛i_fûe_‰ì
 (
cf
);

2400 
	`poﬁ_put
 (
cm
->
˛i_fûe_poﬁ
, 
cf
);

2401 
	}
}

2404 
uw‹d


2405 
	$unix_˛i_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

2406 
vlib_node_ru¡ime_t
 * 
π
, 
vlib_‰ame_t
 * 
f
)

2408 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2409 
uw‹d
 
i
, *
d©a
 = 0;

2413 
unix_˛i_¥o˚ss_evít_ty≥_t
 
evít_ty≥
;

2414 
	`vlib_¥o˚ss_waô_f‹_evít
 (
vm
);

2415 
evít_ty≥
 = 
	`vlib_¥o˚ss_gë_evíts
 (
vm
, &
d©a
);

2417 
evít_ty≥
)

2419 
UNIX_CLI_PROCESS_EVENT_READ_READY
:

2420 
i
 = 0; i < 
	`vec_Àn
 (
d©a
); i++)

2421 
	`unix_˛i_¥o˚ss_öput
 (
cm
, 
d©a
[
i
]);

2424 
UNIX_CLI_PROCESS_EVENT_QUIT
:

2426 
i
 = 0; i < 
	`vec_Àn
 (
d©a
); i++)

2427 
	`unix_˛i_kûl
 (
cm
, 
d©a
[
i
]);

2428 
d⁄e
;

2431 i‡(
d©a
)

2432 
	`_vec_Àn
 (
d©a
) = 0;

2435 
d⁄e
:

2436 
	`vec_‰ì
 (
d©a
);

2438 
	`vlib_node_£t_°©e
 (
vm
, 
π
->
node_ödex
, 
VLIB_NODE_STATE_DISABLED
);

2441 
	`vec_add1
 (
cm
->
unu£d_˛i_¥o˚ss_node_ödi˚s
, 
π
->
node_ödex
);

2444 
	}
}

2448 
˛ib_îr‹_t
 *

2449 
	$unix_˛i_wrôe_ªady
 (
˛ib_fûe_t
 * 
uf
)

2451 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2452 
unix_˛i_fûe_t
 *
cf
;

2453 
n
;

2455 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
uf
->
¥iv©e_d©a
);

2458 i‡(
cf
->
is_sockë
)

2460 
n
 = 
	`£nd
 (
uf
->
fûe_des¸ùt‹
,

2461 
cf
->
ouçut_ve˘‹
, 
	`vec_Àn
 (cf->ouçut_ve˘‹), 
MSG_NOSIGNAL
);

2463 
n
 = 
	`wrôe
 (
uf
->
fûe_des¸ùt‹
,

2464 
cf
->
ouçut_ve˘‹
, 
	`vec_Àn
 (cf->output_vector));

2466 i‡(
n
 < 0 && 
î∫o
 !
EAGAIN
)

2468 i‡(
î∫o
 =
EPIPE
)

2471 
unix_maö_t
 *
um
 = &
unix_maö
;

2472 
cf
->
has_ïùe
 = 1;

2473 
	`vlib_¥o˚ss_sig«l_evít
 (
um
->
vlib_maö
, 
cf
->
¥o˚ss_node_ödex
,

2474 
UNIX_CLI_PROCESS_EVENT_QUIT
,

2475 
uf
->
¥iv©e_d©a
);

2479  
	`˛ib_îr‹_ªtu∫_unix
 (0, "write");

2483 i‡(
n
 > 0)

2484 
	`unix_˛i_dñ_≥ndög_ouçut
 (
uf
, 
cf
, 
n
);

2487 
	}
}

2490 
˛ib_îr‹_t
 *

2491 
	$unix_˛i_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

2493 
unix_maö_t
 *
um
 = &
unix_maö
;

2494 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2495 
unix_˛i_fûe_t
 *
cf
;

2496 
uw‹d
 
l
;

2497 
n
, 
n_ªad
, 
n_åy
;

2499 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
uf
->
¥iv©e_d©a
);

2501 
n
 = 
n_åy
 = 4096;

2502 
n
 =
n_åy
)

2504 
l
 = 
	`vec_Àn
 (
cf
->
öput_ve˘‹
);

2505 
	`vec_ªsize
 (
cf
->
öput_ve˘‹
, 
l
 + 
n_åy
);

2507 
n
 = 
	`ªad
 (
uf
->
fûe_des¸ùt‹
, 
cf
->
öput_ve˘‹
 + 
l
, 
n_åy
);

2510 i‡(
n
 < 0 && 
î∫o
 !
EAGAIN
)

2511  
	`˛ib_îr‹_ªtu∫_unix
 (0, "read");

2513 
n_ªad
 = 
n
 < 0 ? 0 :Ç;

2514 
	`_vec_Àn
 (
cf
->
öput_ve˘‹
Ë
l
 + 
n_ªad
;

2517 i‡(!(
n
 < 0))

2518 
	`vlib_¥o˚ss_sig«l_evít
 (
um
->
vlib_maö
,

2519 
cf
->
¥o˚ss_node_ödex
,

2520 (
n_ªad
 == 0

2521 ? 
UNIX_CLI_PROCESS_EVENT_QUIT


2522 : 
UNIX_CLI_PROCESS_EVENT_READ_READY
),

2523  
uf
->
¥iv©e_d©a
);

2526 
	}
}

2529 
˛ib_îr‹_t
 *

2530 
	$unix_˛i_îr‹_dëe˘ed
 (
˛ib_fûe_t
 * 
uf
)

2532 
unix_maö_t
 *
um
 = &
unix_maö
;

2533 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2534 
unix_˛i_fûe_t
 *
cf
;

2536 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
uf
->
¥iv©e_d©a
);

2537 
cf
->
has_ïùe
 = 1;

2538 
	`vlib_¥o˚ss_sig«l_evít
 (
um
->
vlib_maö
,

2539 
cf
->
¥o˚ss_node_ödex
,

2540 
UNIX_CLI_PROCESS_EVENT_QUIT
,

2541  
uf
->
¥iv©e_d©a
);

2544 
	}
}

2551 
u32


2552 
	$unix_˛i_fûe_add
 (
unix_˛i_maö_t
 * 
cm
, *
«me
, 
fd
)

2554 
unix_maö_t
 *
um
 = &
unix_maö
;

2555 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2556 
unix_˛i_fûe_t
 *
cf
;

2557 
˛ib_fûe_t
 
ãm∂©e
 = { 0 };

2558 
vlib_maö_t
 *
vm
 = 
um
->
vlib_maö
;

2559 
vlib_node_t
 *
n
;

2560 
u8
 *
fûe_desc
 = 0;

2562 
fûe_desc
 = 
	`f‹m©
 (0, "%s", 
«me
);

2564 
«me
 = (*Ë
	`f‹m©
 (0, "unix-cli-%s",Çame);

2566 i‡(
	`vec_Àn
 (
cm
->
unu£d_˛i_¥o˚ss_node_ödi˚s
) > 0)

2568 
uw‹d
 
l
 = 
	`vec_Àn
 (
cm
->
unu£d_˛i_¥o˚ss_node_ödi˚s
);

2571 
n
 = 
	`vlib_gë_node
 (
vm
, 
cm
->
unu£d_˛i_¥o˚ss_node_ödi˚s
[
l
 - 1]);

2572 
	`vec_‰ì
 (
n
->
«me
);

2573 
n
->
«me
 = (
u8
 *)Çame;

2575 
	`vlib_node_£t_°©e
 (
vm
, 
n
->
ödex
, 
VLIB_NODE_STATE_POLLING
);

2577 
	`_vec_Àn
 (
cm
->
unu£d_˛i_¥o˚ss_node_ödi˚s
Ë
l
 - 1;

2581 
vlib_node_ªgi°øti⁄_t
 
r
 = {

2582 .
fun˘i⁄
 = 
unix_˛i_¥o˚ss
,

2583 .
ty≥
 = 
VLIB_NODE_TYPE_PROCESS
,

2584 .
¥o˚ss_log2_n_°ack_byãs
 = 16,

2587 
r
.
«me
 =Çame;

2588 
	`vlib_ªgi°î_node
 (
vm
, &
r
);

2589 
	`vec_‰ì
 (
«me
);

2591 
n
 = 
	`vlib_gë_node
 (
vm
, 
r
.
ödex
);

2594 
	`poﬁ_gë
 (
cm
->
˛i_fûe_poﬁ
, 
cf
);

2595 
	`mem£t
 (
cf
, 0,  (*cf));

2597 
ãm∂©e
.
ªad_fun˘i⁄
 = 
unix_˛i_ªad_ªady
;

2598 
ãm∂©e
.
wrôe_fun˘i⁄
 = 
unix_˛i_wrôe_ªady
;

2599 
ãm∂©e
.
îr‹_fun˘i⁄
 = 
unix_˛i_îr‹_dëe˘ed
;

2600 
ãm∂©e
.
fûe_des¸ùt‹
 = 
fd
;

2601 
ãm∂©e
.
¥iv©e_d©a
 = 
cf
 - 
cm
->
˛i_fûe_poﬁ
;

2602 
ãm∂©e
.
des¸ùti⁄
 = 
fûe_desc
;

2604 
cf
->
¥o˚ss_node_ödex
 = 
n
->
ödex
;

2605 
cf
->
˛ib_fûe_ödex
 = 
	`˛ib_fûe_add
 (
fm
, &
ãm∂©e
);

2606 
cf
->
ouçut_ve˘‹
 = 0;

2607 
cf
->
öput_ve˘‹
 = 0;

2609 
	`vlib_°¨t_¥o˚ss
 (
vm
, 
n
->
ru¡ime_ödex
);

2611 
vlib_¥o˚ss_t
 *
p
 = 
	`vlib_gë_¥o˚ss_‰om_node
 (
vm
, 
n
);

2612 
p
->
ouçut_fun˘i⁄
 = 
unix_vlib_˛i_ouçut
;

2613 
p
->
ouçut_fun˘i⁄_¨g
 = 
cf
 - 
cm
->
˛i_fûe_poﬁ
;

2615  
cf
 - 
cm
->
˛i_fûe_poﬁ
;

2616 
	}
}

2619 
˛ib_îr‹_t
 *

2620 
	$unix_˛i_li°í_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

2622 
unix_maö_t
 *
um
 = &
unix_maö
;

2623 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2624 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2625 
˛ib_sockë_t
 *
s
 = &
um
->
˛i_li°í_sockë
;

2626 
˛ib_sockë_t
 
˛õ¡
;

2627 *
˛õ¡_«me
;

2628 
˛ib_îr‹_t
 *
îr‹
;

2629 
unix_˛i_fûe_t
 *
cf
;

2630 
u32
 
cf_ödex
;

2632 
îr‹
 = 
	`˛ib_sockë_ac˚±
 (
s
, &
˛õ¡
);

2633 i‡(
îr‹
)

2634  
îr‹
;

2636 
˛õ¡_«me
 = (*Ë
	`f‹m©
 (0, "%U%c", 
f‹m©_sockaddr
, &
˛õ¡
.
≥î
, 0);

2638 
cf_ödex
 = 
	`unix_˛i_fûe_add
 (
cm
, 
˛õ¡_«me
, 
˛õ¡
.
fd
);

2639 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
cf_ödex
);

2640 
cf
->
is_sockë
 = 1;

2643 
	`˛ib_sockë_‰ì
 (&
˛õ¡
);

2644 
	`vec_‰ì
 (
˛õ¡_«me
);

2647 i‡(
um
->
˛i_löe_mode
 == 0)

2653 
u8
 
ch¨mode_›ti⁄
[] = {

2654 
IAC
, 
WONT
, 
TELOPT_LINEMODE
,

2655 
IAC
, 
DONT
, 
TELOPT_LINEMODE
,

2656 
IAC
, 
WILL
, 
TELOPT_SGA
,

2657 
IAC
, 
DO
, 
TELOPT_SGA
,

2658 
IAC
, 
WILL
, 
TELOPT_ECHO
,

2659 
IAC
, 
DONT
, 
TELOPT_ECHO
,

2660 
IAC
, 
DO
, 
TELOPT_TTYPE
,

2661 
IAC
, 
SB
, 
TELOPT_TTYPE
, 1, IAC, 
SE
,

2662 
IAC
, 
DO
, 
TELOPT_NAWS
,

2663 
IAC
, 
SB
, 
TELOPT_NAWS
, 1, IAC, 
SE
,

2667 
cf
->
hi°‹y_limô
 = 
um
->
˛i_hi°‹y_limô
;

2668 
cf
->
has_hi°‹y
 = cf->
hi°‹y_limô
 != 0;

2671 
cf
->
is_öãø˘ive
 = 1;

2674 
cf
->
löe_mode
 = 0;

2677 
cf
->
¸lf_mode
 = 1;

2680 
cf
->
no_∑gî
 = 
um
->
˛i_no_∑gî
;

2685 
cf
->
width
 = 
UNIX_CLI_DEFAULT_TERMINAL_WIDTH
;

2686 
cf
->
height
 = 
UNIX_CLI_DEFAULT_TERMINAL_HEIGHT
;

2689 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

2690 
	`unix_vlib_˛i_ouçut_øw
 (
cf
, 
uf
, 
ch¨mode_›ti⁄
,

2691 
	`ARRAY_LEN
 (
ch¨mode_›ti⁄
));

2695 
	`timî_ˇŒ
 (
unix_˛i_fûe_wñcome_timî
, 
cf_ödex
, 1);

2698  
îr‹
;

2699 
	}
}

2705 
	$unix_˛i_ªsize_öãºu±
 (
signum
)

2707 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2708 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2709 
unix_˛i_fûe_t
 *
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
,

2710 
cm
->
°dö_˛i_fûe_ödex
);

2711 
˛ib_fûe_t
 *
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

2712 
wösize
 
ws
;

2713 (Ë
signum
;

2716 i‡(
	`io˘l
 (
STDIN_FILENO
, 
TIOCGWINSZ
, &
ws
) < 0)

2719 
	`˛ib_unix_w¨nög
 ("TIOCGWINSZ");

2724 
cf
->
width
 = 
ws
.
ws_cﬁ
;

2725 i‡(
cf
->
width
 > 
UNIX_CLI_MAX_TERMINAL_WIDTH
)

2726 
cf
->
width
 = 
UNIX_CLI_MAX_TERMINAL_WIDTH
;

2727 i‡(
cf
->
width
 == 0)

2728 
cf
->
width
 = 
UNIX_CLI_DEFAULT_TERMINAL_WIDTH
;

2730 
cf
->
height
 = 
ws
.
ws_row
;

2731 i‡(
cf
->
height
 > 
UNIX_CLI_MAX_TERMINAL_HEIGHT
)

2732 
cf
->
height
 = 
UNIX_CLI_MAX_TERMINAL_HEIGHT
;

2733 i‡(
cf
->
height
 == 0)

2734 
cf
->
height
 = 
UNIX_CLI_DEFAULT_TERMINAL_HEIGHT
;

2737 
	`unix_˛i_∑gî_ªödex
 (
cf
);

2740 
	`unix_˛i_∑gî_ªdøw
 (
cf
, 
uf
);

2741 
	}
}

2744 
˛ib_îr‹_t
 *

2745 
	$unix_˛i_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

2747 
unix_maö_t
 *
um
 = &
unix_maö
;

2748 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

2749 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2750 
Êags
;

2751 
˛ib_îr‹_t
 *
îr‹
 = 0;

2752 
unix_˛i_fûe_t
 *
cf
;

2753 
u32
 
cf_ödex
;

2754 
ãrmios
 
tio
;

2755 
siga˘i⁄
 
ß
;

2756 
wösize
 
ws
;

2757 
u8
 *
ãrm
;

2760 i‡((
îr‹
 = 
	`vlib_ˇŒ_c⁄fig_fun˘i⁄
 (
vm
, 
unix_c⁄fig
)))

2761  
îr‹
;

2763 i‡(
um
->
Êags
 & 
UNIX_FLAG_INTERACTIVE
)

2766 i‡((
Êags
 = 
	`f˙é
 (
STDIN_FILENO
, 
F_GETFL
, 0)) < 0)

2767 
Êags
 = 0;

2768 (Ë
	`f˙é
 (
STDIN_FILENO
, 
F_SETFL
, 
Êags
 | 
O_NONBLOCK
);

2770 
cf_ödex
 = 
	`unix_˛i_fûe_add
 (
cm
, "°dö", 
STDIN_FILENO
);

2771 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, 
cf_ödex
);

2772 
cm
->
°dö_˛i_fûe_ödex
 = 
cf_ödex
;

2776 i‡(
	`ißây
 (
STDIN_FILENO
Ë&& 
um
->
˛i_löe_mode
 == 0)

2779 
	`mem£t
 (&
ß
, 0,  (sa));

2780 
ß
.
ß_h™dÀr
 = 
unix_˛i_ªsize_öãºu±
;

2781 i‡(
	`siga˘i⁄
 (
SIGWINCH
, &
ß
, 0) < 0)

2782 
	`˛ib_∑nic
 ("sigaction");

2785 
	`io˘l
 (
STDIN_FILENO
, 
TIOCGWINSZ
, &
ws
);

2786 
cf
->
width
 = 
ws
.
ws_cﬁ
;

2787 
cf
->
height
 = 
ws
.
ws_row
;

2789 i‡(
cf
->
width
 =0 || cf->
height
 == 0)

2795 
cf
->
width
 = 
UNIX_CLI_DEFAULT_TERMINAL_WIDTH
;

2796 
cf
->
height
 = 
UNIX_CLI_DEFAULT_TERMINAL_HEIGHT
;

2800 
cf
->
hi°‹y_limô
 = 
um
->
˛i_hi°‹y_limô
;

2801 
cf
->
has_hi°‹y
 = cf->
hi°‹y_limô
 != 0;

2804 
cf
->
no_∑gî
 = 
um
->
˛i_no_∑gî
;

2807 
cf
->
is_öãø˘ive
 = 1;

2810 
cf
->
löe_mode
 = 0;

2813 
	`tcgë©å
 (
STDIN_FILENO
, &
um
->
tio_°dö
);

2814 
um
->
tio_is£t
 = 1;

2817 
tio
 = 
um
->
tio_°dö
;

2819 
tio
.
c_lÊag
 &~(
ECHO
 | 
ICANON
 | 
IEXTEN
);

2820 
tio
.
c_cc
[
VMIN
] = 1;

2821 
tio
.
c_cc
[
VTIME
] = 0;

2822 
	`tc£èâr
 (
STDIN_FILENO
, 
TCSAFLUSH
, &
tio
);

2825 
ãrm
 = (
u8
 *Ë
	`gëív
 ("TERM");

2826 i‡(
ãrm
 !
NULL
)

2828 
Àn
 = 
	`°æí
 ((*Ë
ãrm
);

2829 
cf
->
™si_ˇ∑bÀ
 = 
	`unix_˛i_ãrmöÆ_ty≥_™si
 (
ãrm
, 
Àn
);

2830 i‡(
	`unix_˛i_ãrmöÆ_ty≥_n⁄öãø˘ive
 (
ãrm
, 
Àn
))

2831 
	`unix_˛i_£t_£ssi⁄_n⁄öãø˘ive
 (
cf
);

2837 
	`unix_˛i_£t_£ssi⁄_n⁄öãø˘ive
 (
cf
);

2841 
	`unix_˛i_fûe_wñcome
 (
cm
, 
cf
);

2845 
˛ib_sockë_t
 *
s
 = &
um
->
˛i_li°í_sockë
;

2846 i‡(
s
->
c⁄fig
 && s->config[0] != 0)

2849 
˛ib_fûe_t
 
ãm∂©e
 = { 0 };

2852 i‡(
	`°∫cmp
 (
s
->
c⁄fig
, "/run", 4) == 0)

2854 
u8
 *
tmp
 = 
	`f‹m©
 (0, "%s", 
s
->
c⁄fig
);

2855 
i
 = 
	`vec_Àn
 (
tmp
);

2856 
i
 && 
tmp
[--i] != '/')

2859 
tmp
[
i
] = 0;

2861 i‡(
i
)

2862 
	`vlib_unix_ªcursive_mkdú
 ((*Ë
tmp
);

2863 
	`vec_‰ì
 (
tmp
);

2866 
s
->
Êags
 = 
CLIB_SOCKET_F_IS_SERVER
 |

2867 
CLIB_SOCKET_F_ALLOW_GROUP_WRITE
;

2868 
îr‹
 = 
	`˛ib_sockë_öô
 (
s
);

2870 i‡(
îr‹
)

2871  
îr‹
;

2873 
ãm∂©e
.
ªad_fun˘i⁄
 = 
unix_˛i_li°í_ªad_ªady
;

2874 
ãm∂©e
.
fûe_des¸ùt‹
 = 
s
->
fd
;

2875 
ãm∂©e
.
des¸ùti⁄
 = 
	`f‹m©
 (0, "˛òli°íî %s", 
s
->
c⁄fig
);

2877 
	`˛ib_fûe_add
 (
fm
, &
ãm∂©e
);

2881 i‡(!
cm
->
˛i_¥om±
)

2882 
cm
->
˛i_¥om±
 = 
	`f‹m©
 (0, "VLIB: ");

2885 
	}
}

2890 
VLIB_CONFIG_FUNCTION
 (
unix_˛i_c⁄fig
, "unix-cli");

2895 
˛ib_îr‹_t
 *

2896 
	$unix_˛i_exô
 (
vlib_maö_t
 * 
vm
)

2898 
unix_maö_t
 *
um
 = &
unix_maö
;

2901 i‡(
	`ißây
 (
STDIN_FILENO
Ë&& 
um
->
tio_is£t
)

2902 
	`tc£èâr
 (
STDIN_FILENO
, 
TCSAFLUSH
, &
um
->
tio_°dö
);

2905 
	}
}

2907 
VLIB_MAIN_LOOP_EXIT_FUNCTION
 (
unix_˛i_exô
);

2915 
	$vlib_unix_˛i_£t_¥om±
 (*
¥om±
)

2917 *
fmt
 = (
¥om±
[
	`°æí
 (prompt) - 1] == ' ') ? "%s" : "%s ";

2918 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2919 i‡(
cm
->
˛i_¥om±
)

2920 
	`vec_‰ì
 (
cm
->
˛i_¥om±
);

2921 
cm
->
˛i_¥om±
 = 
	`f‹m©
 (0, 
fmt
, 
¥om±
);

2922 
	}
}

2928 
˛ib_îr‹_t
 *

2929 
	$unix_˛i_quô
 (
vlib_maö_t
 * 
vm
,

2930 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

2932 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

2933 
unix_˛i_fûe_t
 *
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
,

2934 
cm
->
cuºít_öput_fûe_ödex
);

2937 
cf
->
is_öãø˘ive
 = 0;

2938 
cf
->
°¨ãd
 = 1;

2940 
	`vlib_¥o˚ss_sig«l_evít
 (
vm
,

2941 
	`vlib_cuºít_¥o˚ss
 (
vm
),

2942 
UNIX_CLI_PROCESS_EVENT_QUIT
,

2943 
cm
->
cuºít_öput_fûe_ödex
);

2945 
	}
}

2954 
VLIB_CLI_COMMAND
 (
unix_˛i_quô_comm™d
, ) = {

2955 .
∑th
 = "quit",

2956 .
	gsh‹t_hñp
 = "Exit CLI",

2957 .
	gfun˘i⁄
 = 
unix_˛i_quô
,

2962 
˛ib_îr‹_t
 *

2963 
	$unix_˛i_exec
 (
vlib_maö_t
 * 
vm
,

2964 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

2966 *
fûe_«me
;

2967 
fd
;

2968 
unf‹m©_öput_t
 
sub_öput
;

2969 
˛ib_îr‹_t
 *
îr‹
;

2971 
fûe_«me
 = 0;

2972 
fd
 = -1;

2973 
îr‹
 = 0;

2975 i‡(!
	`unf‹m©
 (
öput
, "%s", &
fûe_«me
))

2977 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "expecting fileÇame, got `%U'",

2978 
f‹m©_unf‹m©_îr‹
, 
öput
);

2979 
d⁄e
;

2982 
fd
 = 
	`›í
 (
fûe_«me
, 
O_RDONLY
);

2983 i‡(
fd
 < 0)

2985 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ÁûedÅÿ›í `%s'", 
fûe_«me
);

2986 
d⁄e
;

2991 
°©
 
s
;

2993 i‡(
	`f°©
 (
fd
, &
s
) < 0)

2995 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "ÁûedÅÿ°© `%s'", 
fûe_«me
);

2996 
d⁄e
;

2999 i‡(!(
	`S_ISREG
 (
s
.
°_mode
Ë|| 
	`S_ISLNK
 (s.st_mode)))

3001 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "nŸáÑeguœ∏fûê`%s'", 
fûe_«me
);

3002 
d⁄e
;

3006 
	`unf‹m©_öô_˛ib_fûe
 (&
sub_öput
, 
fd
);

3008 
	`vlib_˛i_öput
 (
vm
, &
sub_öput
, 0, 0);

3009 
	`unf‹m©_‰ì
 (&
sub_öput
);

3011 
d⁄e
:

3012 i‡(
fd
 > 0)

3013 
	`˛o£
 (
fd
);

3014 
	`vec_‰ì
 (
fûe_«me
);

3016  
îr‹
;

3017 
	}
}

3043 
VLIB_CLI_COMMAND
 (
˛i_exec
, ) = {

3044 .
∑th
 = "exec",

3045 .
	gsh‹t_hñp
 = "exec <filename>",

3046 .
	gfun˘i⁄
 = 
unix_˛i_exec
,

3047 .
	gis_mp_ß„
 = 1,

3052 
˛ib_îr‹_t
 *

3053 
	$unix_show_îr‹s
 (
vlib_maö_t
 * 
vm
,

3054 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

3056 
unix_maö_t
 *
um
 = &
unix_maö
;

3057 
˛ib_îr‹_t
 *
îr‹
 = 0;

3058 
i
, 
n_îr‹s_to_show
;

3059 
unix_îr‹_hi°‹y_t
 *
unix_îr‹s
 = 0;

3061 
n_îr‹s_to_show
 = 1 << 30;

3063 i‡(
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

3065 i‡(!
	`unf‹m©
 (
öput
, "%d", &
n_îr‹s_to_show
))

3067 
îr‹
 =

3068 
	`˛ib_îr‹_ªtu∫
 (0,

3070 
f‹m©_unf‹m©_îr‹
, 
öput
);

3071 
d⁄e
;

3075 
n_îr‹s_to_show
 =

3076 
	`˛ib_mö
 (
	`ARRAY_LEN
 (
um
->
îr‹_hi°‹y
), 
n_îr‹s_to_show
);

3078 
i
 =

3079 
um
->
îr‹_hi°‹y_ödex
 >

3080 0 ? 
um
->
îr‹_hi°‹y_ödex
 - 1 : 
	`ARRAY_LEN
 (um->
îr‹_hi°‹y
) - 1;

3082 
n_îr‹s_to_show
 > 0)

3084 
unix_îr‹_hi°‹y_t
 *
eh
 = 
um
->
îr‹_hi°‹y
 + 
i
;

3086 i‡(!
eh
->
îr‹
)

3089 
	`vec_add1
 (
unix_îr‹s
, 
eh
[0]);

3090 
n_îr‹s_to_show
 -= 1;

3091 i‡(
i
 == 0)

3092 
i
 = 
	`ARRAY_LEN
 (
um
->
îr‹_hi°‹y
) - 1;

3094 
i
--;

3097 i‡(
	`vec_Àn
 (
unix_îr‹s
) == 0)

3098 
	`vlib_˛i_ouçut
 (
vm
, "no UnixÉrrors so far");

3101 
	`vlib_˛i_ouçut
 (
vm
, "%LdÅŸÆÉº‹†£í", 
um
->
n_tŸÆ_îr‹s
);

3102 
i
 = 
	`vec_Àn
 (
unix_îr‹s
) - 1; i >= 0; i--)

3104 
unix_îr‹_hi°‹y_t
 *
eh
 = 
	`vec_ñt_©_ödex
 (
unix_îr‹s
, 
i
);

3105 
	`vlib_˛i_ouçut
 (
vm
, "%U: %U",

3106 
f‹m©_time_öãrvÆ
, "h:m:s:u", 
eh
->
time
,

3107 
f‹m©_˛ib_îr‹
, 
eh
->
îr‹
);

3109 
	`vlib_˛i_ouçut
 (
vm
, "%U:ÅimeÇow",

3110 
f‹m©_time_öãrvÆ
, "h:m:s:u", 
	`vlib_time_now
 (
vm
));

3113 
d⁄e
:

3114 
	`vec_‰ì
 (
unix_îr‹s
);

3115  
îr‹
;

3116 
	}
}

3119 
VLIB_CLI_COMMAND
 (
˛i_unix_show_îr‹s
, ) = {

3120 .
∑th
 = "show unixÉrrors",

3121 .
	gsh‹t_hñp
 = "Show Unix system callÉrror history",

3122 .
	gfun˘i⁄
 = 
unix_show_îr‹s
,

3127 
˛ib_îr‹_t
 *

3128 
	$unix_show_fûes
 (
vlib_maö_t
 * 
vm
,

3129 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

3131 
˛ib_îr‹_t
 *
îr‹
 = 0;

3132 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

3133 
˛ib_fûe_t
 *
f
;

3134 
∑th
[
PATH_MAX
];

3135 
u8
 *
s
 = 0;

3137 
	`vlib_˛i_ouçut
 (
vm
, "%3s %6s %12s %12s %12s %-32s %s", "FD", "Thread",

3141 
	`poﬁ_f‹óch
 (
f
, 
fm
->
fûe_poﬁ
,(

3143 
rv
;

3144 
s
 = 
	`f‹m©
 (s, "/¥oc/£lf/fd/%d%c", 
f
->
fûe_des¸ùt‹
, 0);

3145 
rv
 = 
	`ªadlök
((*Ë
s
, 
∑th
, 
PATH_MAX
 - 1);

3147 
∑th
[
rv
 < 0 ? 0 :Ñv] = 0;

3149 
	`vlib_˛i_ouçut
 (
vm
, "%3d %6d %12d %12d %12d %-32s %v",

3150 
f
->
fûe_des¸ùt‹
, f->
pﬁlög_thªad_ödex
,

3151 
f
->
ªad_evíts
, f->
wrôe_evíts
, f->
îr‹_evíts
,

3152 
∑th
, 
f
->
des¸ùti⁄
);

3153 
	`vec_ª£t_Àngth
 (
s
);

3156 
	`vec_‰ì
 (
s
);

3158  
îr‹
;

3159 
	}
}

3162 
VLIB_CLI_COMMAND
 (
˛i_unix_show_fûes
, ) = {

3163 .
∑th
 = "show unix files",

3164 .
	gsh‹t_hñp
 = "Show Unix files in use",

3165 .
	gfun˘i⁄
 = 
unix_show_fûes
,

3170 
˛ib_îr‹_t
 *

3171 
	$unix_˛i_show_hi°‹y
 (
vlib_maö_t
 * 
vm
,

3172 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

3174 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3175 
unix_˛i_fûe_t
 *
cf
;

3176 
i
, 
j
;

3178 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, cm->
cuºít_öput_fûe_ödex
);

3180 i‡(!
cf
->
is_öãø˘ive
)

3181  
	`˛ib_îr‹_ªtu∫
 (0, "invalid forÇon-interactive sessions");

3183 i‡(
cf
->
has_hi°‹y
 && cf->
hi°‹y_limô
)

3185 
i
 = 1 + 
cf
->
comm™d_numbî
 - 
	`vec_Àn
 (cf->
comm™d_hi°‹y
);

3186 
j
 = 0; j < 
	`vec_Àn
 (
cf
->
comm™d_hi°‹y
); j++)

3187 
	`vlib_˛i_ouçut
 (
vm
, "%d %v\n", 
i
 + 
j
, 
cf
->
comm™d_hi°‹y
[j]);

3191 
	`vlib_˛i_ouçut
 (
vm
, "HistoryÇotÉnabled.\n");

3195 
	}
}

3201 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_show_hi°‹y
, ) = {

3202 .
∑th
 = "history",

3203 .
	gsh‹t_hñp
 = "Show current session command history",

3204 .
	gfun˘i⁄
 = 
unix_˛i_show_hi°‹y
,

3209 
˛ib_îr‹_t
 *

3210 
	$unix_˛i_show_ãrmöÆ
 (
vlib_maö_t
 * 
vm
,

3211 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

3213 
unix_maö_t
 *
um
 = &
unix_maö
;

3214 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3215 
unix_˛i_fûe_t
 *
cf
;

3216 
vlib_node_t
 *
n
;

3218 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, cm->
cuºít_öput_fûe_ödex
);

3219 
n
 = 
	`vlib_gë_node
 (
vm
, 
cf
->
¥o˚ss_node_ödex
);

3221 
	`vlib_˛i_ouçut
 (
vm
, "TîmöÆÇame: %v\n", 
n
->
«me
);

3222 
	`vlib_˛i_ouçut
 (
vm
, "TîmöÆ mode: %s\n", 
cf
->
löe_mode
 ?

3224 
	`vlib_˛i_ouçut
 (
vm
, "TîmöÆ width: %d\n", 
cf
->
width
);

3225 
	`vlib_˛i_ouçut
 (
vm
, "TîmöÆ height: %d\n", 
cf
->
height
);

3226 
	`vlib_˛i_ouçut
 (
vm
, "ANSI capable: %s\n",

3227 
cf
->
™si_ˇ∑bÀ
 ? "yes" : "no");

3228 
	`vlib_˛i_ouçut
 (
vm
, "Interactive: %s\n",

3229 
cf
->
is_öãø˘ive
 ? "yes" : "no");

3230 
	`vlib_˛i_ouçut
 (
vm
, "HistoryÉnabled: %s%s\n",

3231 
cf
->
has_hi°‹y
 ? "yes" : "no", !cf->has_history

3232 || 
cf
->
hi°‹y_limô
 ? "" :

3234 i‡(
cf
->
has_hi°‹y
)

3235 
	`vlib_˛i_ouçut
 (
vm
, "Hi°‹yÜimô: %d\n", 
cf
->
hi°‹y_limô
);

3236 
	`vlib_˛i_ouçut
 (
vm
, "PagerÉnabled: %s%s%s\n",

3237 
cf
->
no_∑gî
 ? "no" : "yes",

3238 
cf
->
no_∑gî


3239 || 
cf
->
height
 ? "" : " (disabled byÅerminal height)",

3240 
cf
->
no_∑gî


3241 || 
um
->
˛i_∑gî_buf„r_limô
 ? "" :

3243 i‡(!
cf
->
no_∑gî
)

3244 
	`vlib_˛i_ouçut
 (
vm
, "PagîÜimô: %d\n", 
um
->
˛i_∑gî_buf„r_limô
);

3245 
	`vlib_˛i_ouçut
 (
vm
, "CRLF mode: %s\n",

3246 
cf
->
¸lf_mode
 ? "CR+LF" : "LF");

3249 
	}
}

3271 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_show_ãrmöÆ
, ) = {

3272 .
∑th
 = "showÅerminal",

3273 .
	gsh‹t_hñp
 = "Show current sessionÅerminal settings",

3274 .
	gfun˘i⁄
 = 
unix_˛i_show_ãrmöÆ
,

3279 
˛ib_îr‹_t
 *

3280 
	$unix_˛i_show_˛i_£ssi⁄s
 (
vlib_maö_t
 * 
vm
,

3281 
unf‹m©_öput_t
 * 
öput
,

3282 
vlib_˛i_comm™d_t
 * 
cmd
)

3285 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3286 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

3287 
unix_˛i_fûe_t
 *
cf
;

3288 
˛ib_fûe_t
 *
uf
;

3289 
vlib_node_t
 *
n
;

3291 
	`vlib_˛i_ouçut
 (
vm
, "%-5s %-5s %-20s %s", "PNI", "FD", "Name", "Flags");

3293 
	#Ê
(
x
, 
y
Ë–(xË? 
	`touµî
((y)Ë: 
	`tﬁowî
((y)Ë)

	)

3295 
	`poﬁ_f‹óch
 (
cf
, 
cm
->
˛i_fûe_poﬁ
, ({

3296 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
cf
->
˛ib_fûe_ödex
);

3297 
n
 = 
	`vlib_gë_node
 (
vm
, 
cf
->
¥o˚ss_node_ödex
);

3298 
	`vlib_˛i_ouçut
 (
vm
,

3300 
cf
->
¥o˚ss_node_ödex
,

3301 
uf
->
fûe_des¸ùt‹
,

3302 
n
->
«me
,

3303 
	`Ê
 (
cf
->
is_öãø˘ive
, 'i'),

3304 
	`Ê
 (
cf
->
is_sockë
, 's'),

3305 
	`Ê
 (
cf
->
löe_mode
, 'l'),

3306 
	`Ê
 (
cf
->
has_ïùe
, 'p'),

3307 
	`Ê
 (
cf
->
™si_ˇ∑bÀ
, 'a'));

3310 #unde‡
Ê


3313 
	}
}

3352 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_show_˛i_£ssi⁄s
, ) = {

3353 .
∑th
 = "show cli-sessions",

3354 .
	gsh‹t_hñp
 = "Show current CLI sessions",

3355 .
	gfun˘i⁄
 = 
unix_˛i_show_˛i_£ssi⁄s
,

3360 
˛ib_îr‹_t
 *

3361 
	$unix_˛i_£t_ãrmöÆ_∑gî
 (
vlib_maö_t
 * 
vm
,

3362 
unf‹m©_öput_t
 * 
öput
,

3363 
vlib_˛i_comm™d_t
 * 
cmd
)

3365 
unix_maö_t
 *
um
 = &
unix_maö
;

3366 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3367 
unix_˛i_fûe_t
 *
cf
;

3368 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

3369 
˛ib_îr‹_t
 *
îr‹
 = 0;

3371 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, cm->
cuºít_öput_fûe_ödex
);

3373 i‡(!
cf
->
is_öãø˘ive
)

3374  
	`˛ib_îr‹_ªtu∫
 (0, "invalid forÇon-interactive sessions");

3376 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

3379 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

3381 i‡(
	`unf‹m©
 (
löe_öput
, "on"))

3382 
cf
->
no_∑gî
 = 0;

3383 i‡(
	`unf‹m©
 (
löe_öput
, "off"))

3384 
cf
->
no_∑gî
 = 1;

3385 i‡(
	`unf‹m©
 (
löe_öput
, "limô %u", &
um
->
˛i_∑gî_buf„r_limô
))

3386 
	`vlib_˛i_ouçut
 (
vm
,

3388 
um
->
˛i_∑gî_buf„r_limô
);

3391 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknownÖarameter: `%U`",

3392 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

3393 
d⁄e
;

3397 
d⁄e
:

3398 
	`unf‹m©_‰ì
 (
löe_öput
);

3400  
îr‹
;

3401 
	}
}

3411 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_£t_ãrmöÆ_∑gî
, ) = {

3412 .
∑th
 = "setÅerminalÖager",

3413 .
	gsh‹t_hñp
 = "setÅerminalÖager [on|off] [limit <lines>]",

3414 .
	gfun˘i⁄
 = 
unix_˛i_£t_ãrmöÆ_∑gî
,

3419 
˛ib_îr‹_t
 *

3420 
	$unix_˛i_£t_ãrmöÆ_hi°‹y
 (
vlib_maö_t
 * 
vm
,

3421 
unf‹m©_öput_t
 * 
öput
,

3422 
vlib_˛i_comm™d_t
 * 
cmd
)

3424 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3425 
unix_˛i_fûe_t
 *
cf
;

3426 
unf‹m©_öput_t
 
_löe_öput
, *
löe_öput
 = &_line_input;

3427 
u32
 
limô
;

3428 
˛ib_îr‹_t
 *
îr‹
 = 0;

3430 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, cm->
cuºít_öput_fûe_ödex
);

3432 i‡(!
cf
->
is_öãø˘ive
)

3433  
	`˛ib_îr‹_ªtu∫
 (0, "invalid forÇon-interactive sessions");

3435 i‡(!
	`unf‹m©_u£r
 (
öput
, 
unf‹m©_löe_öput
, 
löe_öput
))

3438 
	`unf‹m©_check_öput
 (
löe_öput
Ë!
UNFORMAT_END_OF_INPUT
)

3440 i‡(
	`unf‹m©
 (
löe_öput
, "on"))

3441 
cf
->
has_hi°‹y
 = 1;

3442 i‡(
	`unf‹m©
 (
löe_öput
, "off"))

3443 
cf
->
has_hi°‹y
 = 0;

3444 i‡(
	`unf‹m©
 (
löe_öput
, "limô %u", &
cf
->
hi°‹y_limô
))

3448 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknownÖarameter: `%U`",

3449 
f‹m©_unf‹m©_îr‹
, 
löe_öput
);

3450 
d⁄e
;

3454 
limô
 = 
cf
->
has_hi°‹y
 ? cf->
hi°‹y_limô
 : 0;

3456 
cf
->
comm™d_hi°‹y
 && 
	`vec_Àn
 (cf->comm™d_hi°‹yË>
limô
)

3458 
	`vec_‰ì
 (
cf
->
comm™d_hi°‹y
[0]);

3459 
	`vec_dñëe
 (
cf
->
comm™d_hi°‹y
, 1, 0);

3463 
d⁄e
:

3464 
	`unf‹m©_‰ì
 (
löe_öput
);

3466  
îr‹
;

3467 
	}
}

3477 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_£t_ãrmöÆ_hi°‹y
, ) = {

3478 .
∑th
 = "setÅerminal history",

3479 .
	gsh‹t_hñp
 = "setÅerminal history [on|off] [limit <lines>]",

3480 .
	gfun˘i⁄
 = 
unix_˛i_£t_ãrmöÆ_hi°‹y
,

3485 
˛ib_îr‹_t
 *

3486 
	$unix_˛i_£t_ãrmöÆ_™si
 (
vlib_maö_t
 * 
vm
,

3487 
unf‹m©_öput_t
 * 
öput
,

3488 
vlib_˛i_comm™d_t
 * 
cmd
)

3490 
unix_˛i_maö_t
 *
cm
 = &
unix_˛i_maö
;

3491 
unix_˛i_fûe_t
 *
cf
;

3493 
cf
 = 
	`poﬁ_ñt_©_ödex
 (
cm
->
˛i_fûe_poﬁ
, cm->
cuºít_öput_fûe_ödex
);

3495 i‡(!
cf
->
is_öãø˘ive
)

3496  
	`˛ib_îr‹_ªtu∫
 (0, "invalid forÇon-interactive sessions");

3498 i‡(
	`unf‹m©
 (
öput
, "on"))

3499 
cf
->
™si_ˇ∑bÀ
 = 1;

3500 i‡(
	`unf‹m©
 (
öput
, "off"))

3501 
cf
->
™si_ˇ∑bÀ
 = 0;

3503  
	`˛ib_îr‹_ªtu∫
 (0, "unknownÖarameter: `%U`",

3504 
f‹m©_unf‹m©_îr‹
, 
öput
);

3507 
	}
}

3518 
VLIB_CLI_COMMAND
 (
˛i_unix_˛i_£t_ãrmöÆ_™si
, ) = {

3519 .
∑th
 = "setÅerminalánsi",

3520 .
	gsh‹t_hñp
 = "setÅerminalánsi [on|off]",

3521 .
	gfun˘i⁄
 = 
unix_˛i_£t_ãrmöÆ_™si
,

3525 
˛ib_îr‹_t
 *

3526 
	$unix_˛i_öô
 (
vlib_maö_t
 * 
vm
)

3529 
	}
}

3531 
VLIB_INIT_FUNCTION
 (
unix_˛i_öô
);

	@unix/input.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/unix/unix.h
>

42 
	~<sig«l.h
>

43 
	~<uni°d.h
>

44 
	~<vµö‰a/tw_timî_1t_3w_1024¶_ov.h
>

47 
	#HAVE_LINUX_EPOLL


	)

49 #ifde‡
HAVE_LINUX_EPOLL


51 
	~<sys/ïﬁl.h
>

55 
	mïﬁl_fd
;

56 
ïﬁl_evít
 *
	mïﬁl_evíts
;

57 
	mn_ïﬁl_fds
;

60 
u64
 
	mïﬁl_fûes_ªady
;

61 
u64
 
	mïﬁl_waôs
;

62 } 
	tlöux_ïﬁl_maö_t
;

64 
löux_ïﬁl_maö_t
 *
	glöux_ïﬁl_maös
 = 0;

67 
	$löux_ïﬁl_fûe_upd©e
 (
˛ib_fûe_t
 * 
f
, 
˛ib_fûe_upd©e_ty≥_t
 
upd©e_ty≥
)

69 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

70 
löux_ïﬁl_maö_t
 *
em
 = 
	`vec_ñt_©_ödex
 (
löux_ïﬁl_maös
,

71 
f
->
pﬁlög_thªad_ödex
);

72 
ïﬁl_evít
 
e
 = { 0 };

73 
›
, 
add_dñ
 = 0;

75 
e
.
evíts
 = 
EPOLLIN
;

76 i‡(
f
->
Êags
 & 
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
)

77 
e
.
evíts
 |
EPOLLOUT
;

78 i‡(
f
->
Êags
 & 
UNIX_FILE_EVENT_EDGE_TRIGGERED
)

79 
e
.
evíts
 |
EPOLLET
;

80 
e
.
d©a
.
u32
 = 
f
 - 
fm
->
fûe_poﬁ
;

82 
›
 = -1;

84 
upd©e_ty≥
)

86 
UNIX_FILE_UPDATE_ADD
:

87 
›
 = 
EPOLL_CTL_ADD
;

88 
add_dñ
 = 1;

91 
UNIX_FILE_UPDATE_MODIFY
:

92 
›
 = 
EPOLL_CTL_MOD
;

95 
UNIX_FILE_UPDATE_DELETE
:

96 
›
 = 
EPOLL_CTL_DEL
;

97 
add_dñ
 = -1;

101 
	`˛ib_w¨nög
 ("unknow¿upd©e_ty≥ %d", 
upd©e_ty≥
);

106 i‡(
upd©e_ty≥
 =
UNIX_FILE_UPDATE_ADD
 && 
em
->
ïﬁl_fd
 == -1)

108 
em
->
ïﬁl_fd
 = 
	`ïﬁl_¸óã
 (1);

109 i‡(
em
->
ïﬁl_fd
 < 0)

111 
	`˛ib_unix_w¨nög
 ("epoll_create");

114 
em
->
n_ïﬁl_fds
 = 0;

117 i‡(
	`ïﬁl_˘l
 (
em
->
ïﬁl_fd
, 
›
, 
f
->
fûe_des¸ùt‹
, &
e
) < 0)

119 
	`˛ib_unix_w¨nög
 ("epoll_ctl");

123 
em
->
n_ïﬁl_fds
 +
add_dñ
;

125 i‡(
em
->
n_ïﬁl_fds
 == 0)

127 
	`˛o£
 (
em
->
ïﬁl_fd
);

128 
em
->
ïﬁl_fd
 = -1;

130 
	}
}

132 
°©ic_Æways_ölöe
 
uw‹d


133 
	$löux_ïﬁl_öput_ölöe
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
node
,

134 
vlib_‰ame_t
 * 
‰ame
, 
u32
 
thªad_ödex
)

136 
unix_maö_t
 *
um
 = &
unix_maö
;

137 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

138 
löux_ïﬁl_maö_t
 *
em
 = 
	`vec_ñt_©_ödex
 (
löux_ïﬁl_maös
, 
thªad_ödex
);

139 
ïﬁl_evít
 *
e
;

140 
n_fds_ªady
;

141 
is_maö
 = (
thªad_ödex
 == 0);

144 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

145 
u32
 
ticks_u¡û_expú©i⁄
;

146 
f64
 
timeout
;

147 
timeout_ms
 = 0, 
max_timeout_ms
 = 10;

148 
f64
 
ve˘‹_øã
 = 
	`vlib_œ°_ve˘‹s_≥r_maö_lo›
 (
vm
);

151 i‡(
is_maö
 && 
ve˘‹_øã
 < 2 && 
vm
->
≠i_queue_n⁄em±y
 == 0

152 && 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_POLLING
] == 0)

154 
ticks_u¡û_expú©i⁄
 = 
	`TW
 (
tw_timî_fú°_expúes_ö_ticks
)

155 ((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
);

158 i‡(
ticks_u¡û_expú©i⁄
 =
TW_SLOTS_PER_RING
)

160 
timeout
 = 10e-3;

161 
timeout_ms
 = 
max_timeout_ms
;

165 
timeout
 = (
f64
Ë
ticks_u¡û_expú©i⁄
 *1e-5;

166 i‡(
timeout
 < 1e-3)

167 
timeout_ms
 = 0;

170 
timeout_ms
 = 
timeout
 * 1e3;

172 
timeout_ms
 = 
	`˛ib_max
 (1,Åimeout_ms);

173 
timeout_ms
 = 
	`˛ib_mö
 (
max_timeout_ms
,Åimeout_ms);

176 
node
->
öput_maö_lo›s_≥r_ˇŒ
 = 0;

178 i‡(
is_maö
 =0 && 
ve˘‹_øã
 < 2 &&

179 
nm
->
öput_node_cou¡s_by_°©e
[
VLIB_NODE_STATE_POLLING
] == 0)

181 
timeout
 = 10e-3;

182 
timeout_ms
 = 
max_timeout_ms
;

183 
node
->
öput_maö_lo›s_≥r_ˇŒ
 = 0;

188 
node
->
öput_maö_lo›s_≥r_ˇŒ
 = 1024;

192 i‡(
is_maö
 || 
em
->
ïﬁl_fd
 != -1)

194 
sig£t_t
 
unblock_Æl_sig«ls
;

195 
n_fds_ªady
 = 
	`ïﬁl_pwaô
 (
em
->
ïﬁl_fd
,

196 
em
->
ïﬁl_evíts
,

197 
	`vec_Àn
 (
em
->
ïﬁl_evíts
),

198 
timeout_ms
, &
unblock_Æl_sig«ls
);

201 i‡(
n_fds_ªady
 < 0 && 
î∫o
 =
ENOSYS
)

203 
n_fds_ªady
 = 
	`ïﬁl_waô
 (
em
->
ïﬁl_fd
,

204 
em
->
ïﬁl_evíts
,

205 
	`vec_Àn
 (
em
->
ïﬁl_evíts
), 
timeout_ms
);

210 i‡(
timeout_ms
)

211 
	`u¶ìp
 (
timeout_ms
 * 1000);

216 i‡(
n_fds_ªady
 < 0)

218 i‡(
	`unix_îr‹_is_Áèl
 (
î∫o
))

219 
	`vlib_∑nic_wôh_îr‹
 (
vm
, 
	`˛ib_îr‹_ªtu∫_unix
 (0, "epoll_wait"));

225 
em
->
ïﬁl_waôs
 += 1;

226 
em
->
ïﬁl_fûes_ªady
 +
n_fds_ªady
;

228 
e
 = 
em
->
ïﬁl_evíts
;É <Ém->ïﬁl_evít†+ 
n_fds_ªady
;É++)

230 
u32
 
i
 = 
e
->
d©a
.u32;

231 
˛ib_fûe_t
 *
f
 = 
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
i
);

232 
˛ib_îr‹_t
 *
îr‹s
[4];

233 
n_îr‹s
 = 0;

235 i‡(
	`PREDICT_TRUE
 (!(
e
->
evíts
 & 
EPOLLERR
)))

237 i‡(
e
->
evíts
 & 
EPOLLIN
)

239 
îr‹s
[
n_îr‹s
] = 
f
->
	`ªad_fun˘i⁄
 (f);

240 
f
->
ªad_evíts
++;

241 
n_îr‹s
 +
îr‹s
[n_errors] != 0;

243 i‡(
e
->
evíts
 & 
EPOLLOUT
)

245 
îr‹s
[
n_îr‹s
] = 
f
->
	`wrôe_fun˘i⁄
 (f);

246 
f
->
wrôe_evíts
++;

247 
n_îr‹s
 +
îr‹s
[n_errors] != 0;

252 i‡(
f
->
îr‹_fun˘i⁄
)

254 
îr‹s
[
n_îr‹s
] = 
f
->
	`îr‹_fun˘i⁄
 (f);

255 
f
->
îr‹_evíts
++;

256 
n_îr‹s
 +
îr‹s
[n_errors] != 0;

259 
	`˛o£
 (
f
->
fûe_des¸ùt‹
);

262 
	`ASSERT
 (
n_îr‹s
 < 
	`ARRAY_LEN
 (
îr‹s
));

263 
i
 = 0; i < 
n_îr‹s
; i++)

265 
	`unix_ßve_îr‹
 (
um
, 
îr‹s
[
i
]);

270 
	}
}

272 
uw‹d


273 
	$löux_ïﬁl_öput
 (
vlib_maö_t
 * 
vm
,

274 
vlib_node_ru¡ime_t
 * 
node
, 
vlib_‰ame_t
 * 
‰ame
)

276 
u32
 
thªad_ödex
 = 
	`vlib_gë_thªad_ödex
 ();

278 i‡(
thªad_ödex
 == 0)

279  
	`löux_ïﬁl_öput_ölöe
 (
vm
, 
node
, 
‰ame
, 0);

281  
	`löux_ïﬁl_öput_ölöe
 (
vm
, 
node
, 
‰ame
, 
thªad_ödex
);

282 
	}
}

285 
VLIB_REGISTER_NODE
 (
löux_ïﬁl_öput_node
,) = {

286 .
fun˘i⁄
 = 
löux_ïﬁl_öput
,

287 .
	gty≥
 = 
VLIB_NODE_TYPE_PRE_INPUT
,

288 .
	g«me
 = "unix-epoll-input",

292 
˛ib_îr‹_t
 *

293 
	$löux_ïﬁl_öput_öô
 (
vlib_maö_t
 * 
vm
)

295 
löux_ïﬁl_maö_t
 *
em
;

296 
˛ib_fûe_maö_t
 *
fm
 = &
fûe_maö
;

297 
vlib_thªad_maö_t
 *
tm
 = 
	`vlib_gë_thªad_maö
 ();

300 
	`vec_vÆid©e_Æig√d
 (
löux_ïﬁl_maös
, 
tm
->
n_vlib_maös
,

301 
CLIB_CACHE_LINE_BYTES
);

303 
	`vec_f‹óch
 (
em
, 
löux_ïﬁl_maös
)

306 
	`vec_ªsize
 (
em
->
ïﬁl_evíts
, 
VLIB_FRAME_SIZE
);

308 i‡(
löux_ïﬁl_maös
 =
em
)

310 
em
->
ïﬁl_fd
 = 
	`ïﬁl_¸óã
 (1);

311 i‡(
em
->
ïﬁl_fd
 < 0)

312  
	`˛ib_îr‹_ªtu∫_unix
 (0, "epoll_create");

315 
em
->
ïﬁl_fd
 = -1;

318 
fm
->
fûe_upd©e
 = 
löux_ïﬁl_fûe_upd©e
;

321 
	}
}

323 
VLIB_INIT_FUNCTION
 (
löux_ïﬁl_öput_öô
);

327 
˛ib_îr‹_t
 *

328 
	$unix_öput_öô
 (
vlib_maö_t
 * 
vm
)

330  
	`vlib_ˇŒ_öô_fun˘i⁄
 (
vm
, 
löux_ïﬁl_öput_öô
);

331 
	}
}

333 
VLIB_INIT_FUNCTION
 (
unix_öput_öô
);

	@unix/main.c

39 
	~<vlib/vlib.h
>

40 
	~<vlib/unix/unix.h
>

41 
	~<vlib/unix/∂ugö.h
>

43 
	~<sig«l.h
>

44 
	~<sys/uc⁄ãxt.h
>

45 
	~<sy¶og.h
>

46 
	~<sys/ty≥s.h
>

47 
	~<sys/°©.h
>

48 
	~<f˙é.h
>

49 
	~<sys/time.h
>

50 
	~<sys/ªsour˚.h
>

51 
	~<uni°d.h
>

54 
	#UNIX_CLI_DEFAULT_PAGER_LIMIT
 100000

	)

57 
	#UNIX_CLI_DEFAULT_HISTORY
 50

	)

59 *
vlib_deÁu…_ru¡ime_dú
 
__©åibuã__
 ((
wók
));

60 *
	gvlib_deÁu…_ru¡ime_dú
 = "vlib";

62 
unix_maö_t
 
	gunix_maö
;

63 
˛ib_fûe_maö_t
 
	gfûe_maö
;

64 
vlib_physmem_maö_t
 
	gphysmem_maö
;

66 
˛ib_îr‹_t
 *

67 
	$unix_maö_öô
 (
vlib_maö_t
 * 
vm
)

69 
unix_maö_t
 *
um
 = &
unix_maö
;

70 
um
->
vlib_maö
 = 
vm
;

71  
	`vlib_ˇŒ_öô_fun˘i⁄
 (
vm
, 
unix_öput_öô
);

72 
	}
}

74 
VLIB_INIT_FUNCTION
 (
unix_maö_öô
);

77 
	$unix_sig«l_h™dÀr
 (
signum
, 
sigöfo_t
 * 
si
, 
uc⁄ãxt_t
 * 
uc
)

79 
uw‹d
 
Áèl
 = 0;

80 
u8
 *
msg
 = 0;

82 
msg
 = 
	`f‹m©
 (msg, "received signal %U, PC %U",

83 
f‹m©_sig«l
, 
signum
, 
f‹m©_uc⁄ãxt_pc
, 
uc
);

85 i‡(
signum
 =
SIGSEGV
)

86 
msg
 = 
	`f‹m©
 (msg, ", fau…ögáddªs†%p", 
si
->
si_addr
);

88 
signum
)

91 
SIGTERM
:

92 i‡(
unix_maö
.
vlib_maö
->
maö_lo›_exô_£t
)

94 
	`sy¶og
 (
LOG_ERR
 | 
LOG_DAEMON
, "received SIGTERM,Éxiting...");

95 
unix_maö
.
vlib_maö
->
maö_lo›_exô_now
 = 1;

99 
SIGQUIT
:

100 
SIGINT
:

101 
SIGILL
:

102 
SIGBUS
:

103 
SIGSEGV
:

104 
SIGHUP
:

105 
SIGFPE
:

106 
Áèl
 = 1;

111 
Áèl
 = 0;

116 
	`vec_add1
 (
msg
, 0);

118 i‡(
Áèl
)

120 
	`sy¶og
 (
LOG_ERR
 | 
LOG_DAEMON
, "%s", 
msg
);

121 
	`os_exô
 (1);

124 
	`˛ib_w¨nög
 ("%s", 
msg
);

126 
	`vec_‰ì
 (
msg
);

127 
	}
}

129 
˛ib_îr‹_t
 *

130 
	$£tup_sig«l_h™dÀrs
 (
unix_maö_t
 * 
um
)

132 
uw‹d
 
i
;

133 
siga˘i⁄
 
ß
;

135 
i
 = 1; i < 32; i++)

137 
	`mem£t
 (&
ß
, 0,  (sa));

138 
ß
.
ß_siga˘i⁄
 = (*Ë
unix_sig«l_h™dÀr
;

139 
ß
.
ß_Êags
 = 
SA_SIGINFO
;

141 
i
)

144 
SIGABRT
:

145 
SIGKILL
:

146 
SIGSTOP
:

147 
SIGUSR1
:

148 
SIGUSR2
:

152 
SIGPIPE
:

153 
SIGCHLD
:

154 
ß
.
ß_siga˘i⁄
 = (*Ë
SIG_IGN
;

162 i‡(
	`siga˘i⁄
 (
i
, &
ß
, 0) < 0)

163  
	`˛ib_îr‹_ªtu∫_unix
 (0, "siga˘i⁄ %U", 
f‹m©_sig«l
, 
i
);

167 
	}
}

170 
	$unix_îr‹_h™dÀr
 (*
¨g
, 
u8
 * 
msg
, 
msg_Àn
)

172 
unix_maö_t
 *
um
 = 
¨g
;

175 i‡(
um
->
Êags
 & 
UNIX_FLAG_INTERACTIVE
)

177 
	`CLIB_UNUSED
 (
r
Ë
	`wrôe
 (2, 
msg
, 
msg_Àn
);

181 
ßve
 = 
msg
[
msg_Àn
 - 1];

184 
msg
[
msg_Àn
 - 1] = 0;

186 
	`sy¶og
 (
LOG_ERR
 | 
LOG_DAEMON
, "%s", 
msg
);

188 
msg
[
msg_Àn
 - 1] = 
ßve
;

190 
	}
}

193 
	$vlib_unix_îr‹_ªp‹t
 (
vlib_maö_t
 * 
vm
, 
˛ib_îr‹_t
 * 
îr‹
)

195 
unix_maö_t
 *
um
 = &
unix_maö
;

197 i‡(
um
->
Êags
 & 
UNIX_FLAG_INTERACTIVE
 || 
îr‹
 == 0)

201 
ßve
;

202 
u8
 *
msg
;

203 
u32
 
msg_Àn
;

205 
msg
 = 
îr‹
->
wh©
;

206 
msg_Àn
 = 
	`vec_Àn
 (
msg
);

209 
ßve
 = 
msg
[
msg_Àn
 - 1];

210 
msg
[
msg_Àn
 - 1] = 0;

212 
	`sy¶og
 (
LOG_ERR
 | 
LOG_DAEMON
, "%s", 
msg
);

214 
msg
[
msg_Àn
 - 1] = 
ßve
;

216 
	}
}

218 
uw‹d


219 
	$°¨tup_c⁄fig_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

220 
vlib_node_ru¡ime_t
 * 
π
, 
vlib_‰ame_t
 * 
f
)

222 
unix_maö_t
 *
um
 = &
unix_maö
;

223 
u8
 *
buf
 = 0;

224 
uw‹d
 
l
, 
n
 = 1;

226 
	`vlib_¥o˚ss_su•íd
 (
vm
, 2.0);

228 
um
->
unix_c⁄fig_com∂ëe
 == 0)

229 
	`vlib_¥o˚ss_su•íd
 (
vm
, 0.1);

231 i‡(
um
->
°¨tup_c⁄fig_fûíame
)

233 
unf‹m©_öput_t
 
sub_öput
;

234 
fd
;

235 
°©
 
s
;

236 *
‚
 = (*Ë
um
->
°¨tup_c⁄fig_fûíame
;

238 
fd
 = 
	`›í
 (
‚
, 
O_RDONLY
);

239 i‡(
fd
 < 0)

241 
	`˛ib_w¨nög
 ("ÁûedÅÿ›í `%s'", 
‚
);

245 i‡(
	`f°©
 (
fd
, &
s
) < 0)

247 
	`˛ib_w¨nög
 ("ÁûedÅÿ°© `%s'", 
‚
);

248 
baû
:

249 
	`˛o£
 (
fd
);

253 i‡(!(
	`S_ISREG
 (
s
.
°_mode
Ë|| 
	`S_ISLNK
 (s.st_mode)))

255 
	`˛ib_w¨nög
 ("nŸáÑeguœ∏fûe: `%s'", 
‚
);

256 
baû
;

259 
n
 > 0)

261 
l
 = 
	`vec_Àn
 (
buf
);

262 
	`vec_ªsize
 (
buf
, 4096);

263 
n
 = 
	`ªad
 (
fd
, 
buf
 + 
l
, 4096);

264 i‡(
n
 > 0)

266 
	`_vec_Àn
 (
buf
Ë
l
 + 
n
;

267 i‡(
n
 < 4096)

273 i‡(
um
->
log_fd
 && 
	`vec_Àn
 (
buf
))

275 
u8
 *
lv
 = 0;

276 
lv
 = 
	`f‹m©
 (lv, "%U: ***** Startup Config *****\n%v",

277 
f‹m©_timevÆ
, 0 ,

279 
buf
);

281 
rv
 
	`__©åibuã__
 ((
unu£d
)) =

282 
	`wrôe
 (
um
->
log_fd
, 
lv
, 
	`vec_Àn
 (lv));

284 
	`vec_ª£t_Àngth
 (
lv
);

285 
lv
 = 
	`f‹m©
 (lv, "%U: ***** End Startup Config *****\n",

286 
f‹m©_timevÆ
, 0 ,

289 
rv
 
	`__©åibuã__
 ((
unu£d
)) =

290 
	`wrôe
 (
um
->
log_fd
, 
lv
, 
	`vec_Àn
 (lv));

292 
	`vec_‰ì
 (
lv
);

295 i‡(
	`vec_Àn
 (
buf
))

297 
	`unf‹m©_öô_ve˘‹
 (&
sub_öput
, 
buf
);

298 
	`vlib_˛i_öput
 (
vm
, &
sub_öput
, 0, 0);

300 
	`unf‹m©_‰ì
 (&
sub_öput
);

302 
	`˛o£
 (
fd
);

305 
	}
}

308 
VLIB_REGISTER_NODE
 (
°¨tup_c⁄fig_node
,) = {

309 .
fun˘i⁄
 = 
°¨tup_c⁄fig_¥o˚ss
,

310 .
	gty≥
 = 
VLIB_NODE_TYPE_PROCESS
,

311 .
	g«me
 = "startup-config-process",

315 
˛ib_îr‹_t
 *

316 
	$unix_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

318 
unix_maö_t
 *
um
 = &
unix_maö
;

319 
˛ib_îr‹_t
 *
îr‹
 = 0;

320 
gid_t
 
gid
;

321 
pidfd
 = -1;

324 
um
->
˛i_∑gî_buf„r_limô
 = 
UNIX_CLI_DEFAULT_PAGER_LIMIT
;

325 
um
->
˛i_hi°‹y_limô
 = 
UNIX_CLI_DEFAULT_HISTORY
;

327 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

329 *
˛i_¥om±
;

330 i‡(
	`unf‹m©
 (
öput
, "interactive"))

331 
um
->
Êags
 |
UNIX_FLAG_INTERACTIVE
;

332 i‡(
	`unf‹m©
 (
öput
, "nodaemon"))

333 
um
->
Êags
 |
UNIX_FLAG_NODAEMON
;

334 i‡(
	`unf‹m©
 (
öput
, "˛i-¥om± %s", &
˛i_¥om±
))

335 
	`vlib_unix_˛i_£t_¥om±
 (
˛i_¥om±
);

337 i‡(
	`unf‹m©
 (
öput
, "˛i-li°í %s", &
um
->
˛i_li°í_sockë
.
c⁄fig
))

339 i‡(
	`unf‹m©
 (
öput
, "ru¡ime-dú %s", &
um
->
ru¡ime_dú
))

341 i‡(
	`unf‹m©
 (
öput
, "cli-line-mode"))

342 
um
->
˛i_löe_mode
 = 1;

343 i‡(
	`unf‹m©
 (
öput
, "cli-no-banner"))

344 
um
->
˛i_no_b™√r
 = 1;

345 i‡(
	`unf‹m©
 (
öput
, "cli-no-pager"))

346 
um
->
˛i_no_∑gî
 = 1;

347 i‡(
	`unf‹m©
 (
öput
, "cli-pager-buffer-limit %d",

348 &
um
->
˛i_∑gî_buf„r_limô
))

351 i‡(
	`unf‹m©
 (
öput
, "˛i-hi°‹y-limô %d", &
um
->
˛i_hi°‹y_limô
))

353 i‡(
	`unf‹m©
 (
öput
, "coredump-size"))

355 
uw‹d
 
c‹edump_size
 = 0;

356 i‡(
	`unf‹m©
 (
öput
, "unlimited"))

358 
c‹edump_size
 = 
RLIM_INFINITY
;

361 i‡(!
	`unf‹m©
 (
öput
, "%U", 
unf‹m©_mem‹y_size
, &
c‹edump_size
))

363  
	`˛ib_îr‹_ªtu∫
 (0,

365 
f‹m©_unf‹m©_îr‹
, 
öput
);

367 c⁄° 
æimô
 
√w_limô
 = { 
c‹edump_size
, coredump_size };

368 i‡(0 !
	`£ålimô
 (
RLIMIT_CORE
, &
√w_limô
))

370 
	`˛ib_unix_w¨nög
 ("prlimit() failed");

373 i‡(
	`unf‹m©
 (
öput
, "full-coredump"))

375 
fd
;

377 
fd
 = 
	`›í
 ("/¥oc/£lf/c‹edump_fûãr", 
O_WRONLY
);

378 i‡(
fd
 >= 0)

380 i‡(
	`wrôe
 (
fd
, "0x6f\n", 5) != 5)

381 
	`˛ib_unix_w¨nög
 ("coredump filter write failed!");

382 
	`˛o£
 (
fd
);

385 
	`˛ib_unix_w¨nög
 ("couldn't open /proc/self/coredump_filter");

387 i‡(
	`unf‹m©
 (
öput
, "startup-config %s",

388 &
um
->
°¨tup_c⁄fig_fûíame
))

390 i‡(
	`unf‹m©
 (
öput
, "exe¯%s", &
um
->
°¨tup_c⁄fig_fûíame
))

392 i‡(
	`unf‹m©
 (
öput
, "log %s", &
um
->
log_fûíame
))

394 
um
->
log_fd
 = 
	`›í
 ((*Ëum->
log_fûíame
,

395 
O_CREAT
 | 
O_WRONLY
 | 
O_APPEND
, 0644);

396 i‡(
um
->
log_fd
 < 0)

398 
	`˛ib_w¨nög
 ("couldn'à›íÜog '%s'\n", 
um
->
log_fûíame
);

399 
um
->
log_fd
 = 0;

403 
u8
 *
lv
 = 0;

404 
lv
 = 
	`f‹m©
 (0, "%U: ***** Start: PID %d *****\n",

405 
f‹m©_timevÆ
, 0 ,

407 
	`gëpid
 ());

409 
rv
 
	`__©åibuã__
 ((
unu£d
)) =

410 
	`wrôe
 (
um
->
log_fd
, 
lv
, 
	`vec_Àn
 (lv));

412 
	`vec_‰ì
 (
lv
);

415 i‡(
	`unf‹m©
 (
öput
, "gid %U", 
unf‹m©_unix_gid
, &
gid
))

417 i‡(
	`£ãgid
 (
gid
) == -1)

418  
	`˛ib_îr‹_ªtu∫_unix
 (0, "setegid");

420 i‡(
	`unf‹m©
 (
öput
, "pidfûê%s", &
um
->
pidfûe
))

423  
	`˛ib_îr‹_ªtu∫
 (0, "unknown input `%U'",

424 
f‹m©_unf‹m©_îr‹
, 
öput
);

427 i‡(
um
->
ru¡ime_dú
 == 0)

429 
uid_t
 
uid
 = 
	`gëeuid
 ();

430 i‡(
uid
 == 00)

431 
um
->
ru¡ime_dú
 = 
	`f‹m©
 (0, "/run/%s%c",

432 
vlib_deÁu…_ru¡ime_dú
, 0);

434 
um
->
ru¡ime_dú
 = 
	`f‹m©
 (0, "/run/u£r/%u/%s%c", 
uid
,

435 
vlib_deÁu…_ru¡ime_dú
, 0);

438 
îr‹
 = 
	`£tup_sig«l_h™dÀrs
 (
um
);

439 i‡(
îr‹
)

440  
îr‹
;

442 i‡(
um
->
pidfûe
)

444 i‡((
îr‹
 = 
	`vlib_unix_vÆid©e_ru¡ime_fûe
 (
um
,

445 (*Ë
um
->
pidfûe
,

446 &
um
->
pidfûe
)))

447  
îr‹
;

449 i‡(((
pidfd
 = 
	`›í
 ((*Ë
um
->
pidfûe
,

450 
O_CREAT
 | 
O_WRONLY
 | 
O_TRUNC
, 0644)) < 0))

452  
	`˛ib_îr‹_ªtu∫_unix
 (0, "open");

456 i‡(!(
um
->
Êags
 & 
UNIX_FLAG_INTERACTIVE
))

458 
	`›ílog
 (
vm
->
«me
, 
LOG_CONS
 | 
LOG_PERROR
 | 
LOG_PID
, 
LOG_DAEMON
);

459 
	`˛ib_îr‹_ªgi°î_h™dÀr
 (
unix_îr‹_h™dÀr
, 
um
);

461 i‡(!(
um
->
Êags
 & 
UNIX_FLAG_NODAEMON
Ë&& 
	`d´m⁄
 ( 0,

464 
	`˛ib_îr‹_ªtu∫
 (0, "daemon () fails");

467 i‡(
pidfd
 >= 0)

469 
u8
 *
lv
 = 
	`f‹m©
 (0, "%d", 
	`gëpid
 ());

470 i‡(
	`wrôe
 (
pidfd
, (*Ë
lv
, 
	`vec_Àn
 (lv)) != vec_len (lv))

472 
	`vec_‰ì
 (
lv
);

473 
	`˛o£
 (
pidfd
);

474  
	`˛ib_îr‹_ªtu∫_unix
 (0, "write");

476 
	`vec_‰ì
 (
lv
);

477 
	`˛o£
 (
pidfd
);

480 
um
->
unix_c⁄fig_com∂ëe
 = 1;

483 
	}
}

546 
VLIB_EARLY_CONFIG_FUNCTION
 (
unix_c⁄fig
, "unix");

548 
˛ib_îr‹_t
 *

549 
	$unix_exô
 (
vlib_maö_t
 * 
vm
)

552 
	`˛o£log
 ();

554 
	}
}

556 
VLIB_MAIN_LOOP_EXIT_FUNCTION
 (
unix_exô
);

558 
u8
 **
	gvlib_thªad_°acks
;

560 
uw‹d


561 
	$thªad0
 (
uw‹d
 
¨g
)

563 
vlib_maö_t
 *
vm
 = (vlib_maö_à*Ë
¨g
;

564 
unf‹m©_öput_t
 
öput
;

565 
i
;

567 
	`unf‹m©_öô_comm™d_löe
 (&
öput
, (**Ë
vm
->
¨gv
);

568 
i
 = 
	`vlib_maö
 (
vm
, &
öput
);

569 
	`unf‹m©_‰ì
 (&
öput
);

571  
i
;

572 
	}
}

574 
u8
 *

575 
	$vlib_thªad_°ack_öô
 (
uw‹d
 
thªad_ödex
)

577 
	`vec_vÆid©e
 (
vlib_thªad_°acks
, 
thªad_ödex
);

578 
vlib_thªad_°acks
[
thªad_ödex
] = 
˛ib_mem_Æloc_Æig√d


579 (
VLIB_THREAD_STACK_SIZE
, VLIB_THREAD_STACK_SIZE);

585 i‡(
	`m¥Ÿe˘
 (
vlib_thªad_°acks
[
thªad_ödex
],

586 
	`˛ib_mem_gë_∑ge_size
 (), 
PROT_READ
) < 0)

587 
	`˛ib_unix_w¨nög
 ("thread stack");

588  
vlib_thªad_°acks
[
thªad_ödex
];

589 
	}
}

592 
	$vlib_unix_maö
 (
¨gc
, *
¨gv
[])

594 
vlib_maö_t
 *
vm
 = &
vlib_globÆ_maö
;

595 
unf‹m©_öput_t
 
öput
;

596 
˛ib_îr‹_t
 *
e
;

597 
i
;

599 
vm
->
¨gv
 = (
u8
 **)árgv;

600 
vm
->
«me
 = 
¨gv
[0];

601 
vm
->
hóp_ba£
 = 
	`˛ib_mem_gë_hóp
 ();

602 
	`ASSERT
 (
vm
->
hóp_ba£
);

604 
	`unf‹m©_öô_comm™d_löe
 (&
öput
, (**Ë
vm
->
¨gv
);

605 i‡((
e
 = 
	`vlib_∂ugö_c⁄fig
 (
vm
, &
öput
)))

607 
	`˛ib_îr‹_ªp‹t
 (
e
);

610 
	`unf‹m©_‰ì
 (&
öput
);

612 
i
 = 
	`vlib_∂ugö_óæy_öô
 (
vm
);

613 i‡(
i
)

614  
i
;

616 
	`unf‹m©_öô_comm™d_löe
 (&
öput
, (**Ë
vm
->
¨gv
);

617 i‡(
vm
->
öô_fun˘i⁄s_ˇŒed
 == 0)

618 
vm
->
öô_fun˘i⁄s_ˇŒed
 = 
	`hash_¸óã
 (0, 0);

619 
e
 = 
	`vlib_ˇŒ_Æl_c⁄fig_fun˘i⁄s
 (
vm
, &
öput
, 1 );

620 i‡(
e
 != 0)

622 
	`˛ib_îr‹_ªp‹t
 (
e
);

625 
	`unf‹m©_‰ì
 (&
öput
);

627 
	`vlib_thªad_°ack_öô
 (0);

629 
__os_thªad_ödex
 = 0;

630 
vm
->
thªad_ödex
 = 0;

632 
i
 = 
	`˛ib_ˇŒjmp
 (
thªad0
, (
uw‹d
Ë
vm
,

633 (*Ë(
vlib_thªad_°acks
[0] +

634 
VLIB_THREAD_STACK_SIZE
));

635  
i
;

636 
	}
}

	@unix/mc_socket.c

18 
	~<vlib/vlib.h
>

19 
	~<vlib/unix/mc_sockë.h
>

21 
	~<sys/io˘l.h
>

22 
	~<√töë/t˝.h
>

23 
	~<√t/if.h
>

25 
u8
 *

26 
	$f‹m©_sockë_≥î_id
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

28 
u64
 
≥î_id_as_u64
 = 
	`va_¨g
 (*
¨gs
, u64);

29 
mc_≥î_id_t
 
≥î_id
;

30 
≥î_id
.
as_u64
 = 
≥î_id_as_u64
;

31 
u32
 
a
 = 
	`mc_sockë_≥î_id_gë_addªss
 (
≥î_id
);

32 
u32
 
p
 = 
	`mc_sockë_≥î_id_gë_p‹t
 (
≥î_id
);

34 
s
 = 
	`f‹m©
 (s, "%U:%04x", 
f‹m©_√tw‹k_addªss
, 
AF_INET
, &
a
, 
	`¡ohs
 (
p
));

36  
s
;

37 
	}
}

39 (
	tmc_msg_h™dÀr_t
Ë(
	tmc_maö_t
 * 
	tmcm
, *
	tmsg
,

40 
	tu32
 
	tbuf„r_ödex
);

42 
Æways_ölöe
 

43 
	$msg_h™dÀr
 (
mc_maö_t
 * 
mcm
,

44 
u32
 
buf„r_ödex
, u32 
h™dÀr_‰ìs_buf„r
, *
_h
)

46 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

47 
mc_msg_h™dÀr_t
 *
h
 = 
_h
;

48 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

49 *
the_msg
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

51 
	`h
 (
mcm
, 
the_msg
, 
buf„r_ödex
);

52 i‡(!
h™dÀr_‰ìs_buf„r
)

53 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
buf„r_ödex
);

54 
	}
}

56 
uw‹d


57 
	$≠≥nd_buf„r_ödex_to_iovec
 (
vlib_maö_t
 * 
vm
,

58 
u32
 
buf„r_ödex
, 
iovec
 **
iovs_ªtu∫
)

60 
iovec
 *
i
;

61 
vlib_buf„r_t
 *
b
;

62 
u32
 
bi
 = 
buf„r_ödex
;

63 
u32
 
l
 = 0;

67 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

68 
	`vec_add2
 (*
iovs_ªtu∫
, 
i
, 1);

69 
i
->
iov_ba£
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

70 
i
->
iov_Àn
 = 
b
->
cuºít_Àngth
;

71 
l
 +
i
->
iov_Àn
;

72 i‡(!(
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

74 
bi
 = 
b
->
√xt_buf„r
;

77  
l
;

78 
	}
}

80 
˛ib_îr‹_t
 *

81 
	$£ndmsg_hñ≥r
 (
mc_sockë_maö_t
 * 
msm
,

82 
sockë
, 
sockaddr_ö
 *
tx_addr
, 
u32
 
buf„r_ödex
)

84 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

85 
msghdr
 
h
;

86 
w‹d
 
n_byãs
, 
n_byãs_tx
, 
n_ªåõs
;

88 
	`mem£t
 (&
h
, 0,  (h));

89 
h
.
msg_«me
 = 
tx_addr
;

90 
h
.
msg_«mñí
 =  (
tx_addr
[0]);

92 i‡(
msm
->
iovecs
)

93 
	`_vec_Àn
 (
msm
->
iovecs
) = 0;

95 
n_byãs
 = 
	`≠≥nd_buf„r_ödex_to_iovec
 (
vm
, 
buf„r_ödex
, &
msm
->
iovecs
);

96 
	`ASSERT
 (
n_byãs
 <
msm
->
mc_maö
.
å™•‹t
.
max_∑ckë_size
);

97 i‡(
n_byãs
 > 
msm
->
mc_maö
.
å™•‹t
.
max_∑ckë_size
)

98 
	`˛ib_îr‹
 ("£ndögÖackëÜ¨gîÅh™ i¡îa˚ MTU %d byãs", 
n_byãs
);

100 
h
.
msg_iov
 = 
msm
->
iovecs
;

101 
h
.
msg_iovÀn
 = 
	`vec_Àn
 (
msm
->
iovecs
);

103 
n_ªåõs
 = 0;

104 (
n_byãs_tx
 = 
	`£ndmsg
 (
sockë
, &
h
, 0)Ë!
n_byãs


105 && 
î∫o
 =
EAGAIN
)

106 
n_ªåõs
++;

107 i‡(
n_byãs_tx
 !
n_byãs
)

109 
	`˛ib_unix_w¨nög
 ("sendmsg");

112 i‡(
n_ªåõs
)

114 
	`ELOG_TYPE_DECLARE
 (
e
) =

116 .
f‹m©
 = "£ndmsg-hñ≥r: %dÑërõs",.
f‹m©_¨gs
 = "i4",};

119 
u32
 
ªåõs
;

120 } *
ed
 = 0;

122 
ed
 = 
	`ELOG_DATA
 (&
vm
->
ñog_maö
, 
e
);

123 
ed
->
ªåõs
 = 
n_ªåõs
;

126 
	}
}

128 
˛ib_îr‹_t
 *

129 
	$tx_buf„r
 (*
å™•‹t
, 
mc_å™•‹t_ty≥_t
 
ty≥
, 
u32
 
buf„r_ödex
)

131 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
å™•‹t
;

132 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

133 
mc_mu…iˇ°_sockë_t
 *
ms
 = &
msm
->
mu…iˇ°_sockës
[
ty≥
];

134 
˛ib_îr‹_t
 *
îr‹
;

135 
îr‹
 = 
	`£ndmsg_hñ≥r
 (
msm
, 
ms
->
sockë
, &ms->
tx_addr
, 
buf„r_ödex
);

136 i‡(
ty≥
 !
MC_TRANSPORT_USER_REQUEST_TO_RELAY
)

137 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
buf„r_ödex
);

138  
îr‹
;

139 
	}
}

141 
˛ib_îr‹_t
 *

142 
	$tx_ack
 (*
å™•‹t
, 
mc_≥î_id_t
 
de°_≥î_id
, 
u32
 
buf„r_ödex
)

144 
sockaddr_ö
 
tx_addr
;

145 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
å™•‹t
;

146 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

147 
˛ib_îr‹_t
 *
îr‹
;

149 
	`mem£t
 (&
tx_addr
, 0,  (tx_addr));

150 
tx_addr
.
sö_Ámûy
 = 
AF_INET
;

151 
tx_addr
.
sö_addr
.
s_addr
 = 
	`mc_sockë_≥î_id_gë_addªss
 (
de°_≥î_id
);

152 
tx_addr
.
sö_p‹t
 = 
	`mc_sockë_≥î_id_gë_p‹t
 (
de°_≥î_id
);

154 
îr‹
 = 
	`£ndmsg_hñ≥r
 (
msm
, msm->
ack_sockë
, &
tx_addr
, 
buf„r_ödex
);

155 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
buf„r_ödex
);

156  
îr‹
;

157 
	}
}

159 
˛ib_îr‹_t
 *

160 
	$ªcvmsg_hñ≥r
 (
mc_sockë_maö_t
 * 
msm
,

161 
sockë
,

162 
sockaddr_ö
 *
rx_addr
,

163 
u32
 * 
buf„r_ödex
, u32 
dr›_mesßge
)

165 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

166 
vlib_buf„r_t
 *
b
;

167 
uw‹d
 
n_À·
, 
n_Æloc
, 
n_mtu
, 
i
, 
i_rx
;

168 c⁄° 
uw‹d
 
buf„r_size
 = 
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
;

169 
w‹d
 
n_byãs_À·
;

172 
n_mtu
 = 
msm
->
rx_mtu_n_buf„rs
;

173 
n_À·
 = 
	`vec_Àn
 (
msm
->
rx_buf„rs
);

174 i‡(
n_À·
 < 
n_mtu
)

176 
uw‹d
 
max_Æloc
 = 8 * 
n_mtu
;

177 
	`vec_vÆid©e
 (
msm
->
rx_buf„rs
, 
max_Æloc
 - 1);

178 
n_Æloc
 =

179 
	`vlib_buf„r_Æloc
 (
vm
, 
msm
->
rx_buf„rs
 + 
n_À·
, 
max_Æloc
 -Ç_left);

180 
	`_vec_Àn
 (
msm
->
rx_buf„rs
Ë
n_À·
 + 
n_Æloc
;

183 
	`ASSERT
 (
	`vec_Àn
 (
msm
->
rx_buf„rs
Ë>
n_mtu
);

184 
	`vec_vÆid©e
 (
msm
->
iovecs
, 
n_mtu
 - 1);

188 
i_rx
 = 
	`vec_Àn
 (
msm
->
rx_buf„rs
) - 1;

189 
i
 = 0; i < 
n_mtu
; i++)

191 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
msm
->
rx_buf„rs
[
i_rx
 - 
i
]);

192 
msm
->
iovecs
[
i
].
iov_ba£
 = 
b
->
d©a
;

193 
msm
->
iovecs
[
i
].
iov_Àn
 = 
buf„r_size
;

195 
	`_vec_Àn
 (
msm
->
iovecs
Ë
n_mtu
;

198 
msghdr
 
h
;

200 
	`mem£t
 (&
h
, 0,  (h));

201 i‡(
rx_addr
)

203 
h
.
msg_«me
 = 
rx_addr
;

204 
h
.
msg_«mñí
 =  (
rx_addr
[0]);

206 
h
.
msg_iov
 = 
msm
->
iovecs
;

207 
h
.
msg_iovÀn
 = 
	`vec_Àn
 (
msm
->
iovecs
);

209 
n_byãs_À·
 = 
	`ªcvmsg
 (
sockë
, &
h
, 0);

210 i‡(
n_byãs_À·
 < 0)

211  
	`˛ib_îr‹_ªtu∫_unix
 (0, "recvmsg");

214 i‡(
dr›_mesßge
)

216 *
buf„r_ödex
 = ~0;

220 *
buf„r_ödex
 = 
msm
->
rx_buf„rs
[
i_rx
];

223 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
msm
->
rx_buf„rs
[
i_rx
]);

225 
b
->
Êags
 = 0;

226 
b
->
cuºít_d©a
 = 0;

227 
b
->
cuºít_Àngth
 =

228 
n_byãs_À·
 < 
buf„r_size
 ?Ç_bytes_left : buffer_size;

230 
n_byãs_À·
 -
buf„r_size
;

232 i‡(
n_byãs_À·
 <= 0)

235 
i_rx
--;

236 
b
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

237 
b
->
√xt_buf„r
 = 
msm
->
rx_buf„rs
[
i_rx
];

240 
	`_vec_Àn
 (
msm
->
rx_buf„rs
Ë
i_rx
;

243 
	}
}

245 
˛ib_îr‹_t
 *

246 
	$ma°îshù_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

248 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

249 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

250 
mc_mu…iˇ°_sockë_t
 *
ms
 =

251 &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_MASTERSHIP
];

252 
˛ib_îr‹_t
 *
îr‹
;

253 
u32
 
bi
;

255 
îr‹
 = 
	`ªcvmsg_hñ≥r
 (
msm
, 
ms
->
sockë
, 0, &
bi
,

257 i‡(!
îr‹
)

258 
	`msg_h™dÀr
 (
mcm
, 
bi
,

260 
mc_msg_ma°î_as£π_h™dÀr
);

262  
îr‹
;

263 
	}
}

265 
˛ib_îr‹_t
 *

266 
	$to_ªœy_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

268 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

269 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

270 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

271 
mc_mu…iˇ°_sockë_t
 *
ms_to_ªœy
 =

272 &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_USER_REQUEST_TO_RELAY
];

273 
mc_mu…iˇ°_sockë_t
 *
ms_‰om_ªœy
 =

274 &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_USER_REQUEST_FROM_RELAY
];

275 
˛ib_îr‹_t
 *
îr‹
;

276 
u32
 
bi
;

277 
u32
 
is_ma°î
 = 
mcm
->
ªœy_°©e
 =
MC_RELAY_STATE_MASTER
;

280 
îr‹
 = 
	`ªcvmsg_hñ≥r
 (
msm
, 
ms_to_ªœy
->
sockë
, 0, &
bi
,

281  !
is_ma°î
);

284 i‡(!
îr‹
 && 
is_ma°î
)

286 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

287 
mc_msg_u£r_ªque°_t
 *
mp
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

288 
mp
->
globÆ_£quí˚
 = 
	`˛ib_ho°_to_√t_u32
 (
mcm
->
ªœy_globÆ_£quí˚
);

289 
mcm
->
ªœy_globÆ_£quí˚
++;

290 
îr‹
 =

291 
	`£ndmsg_hñ≥r
 (
msm
, 
ms_‰om_ªœy
->
sockë
, &ms_‰om_ªœy->
tx_addr
,

292 
bi
);

293 
	`vlib_buf„r_‰ì_⁄e
 (
vm
, 
bi
);

296  
îr‹
;

297 
	}
}

299 
˛ib_îr‹_t
 *

300 
	$‰om_ªœy_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

302 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

303 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

304 
mc_mu…iˇ°_sockë_t
 *
ms
 =

305 &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_USER_REQUEST_FROM_RELAY
];

306 
˛ib_îr‹_t
 *
îr‹
;

307 
u32
 
bi
;

309 
îr‹
 = 
	`ªcvmsg_hñ≥r
 (
msm
, 
ms
->
sockë
, 0, &
bi
,

311 i‡(!
îr‹
)

313 
	`msg_h™dÀr
 (
mcm
, 
bi
, 1,

314 
mc_msg_u£r_ªque°_h™dÀr
);

316  
îr‹
;

317 
	}
}

319 
˛ib_îr‹_t
 *

320 
	$joö_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

322 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

323 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

324 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

325 
mc_mu…iˇ°_sockë_t
 *
ms
 = &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_JOIN
];

326 
˛ib_îr‹_t
 *
îr‹
;

327 
u32
 
bi
;

329 
îr‹
 = 
	`ªcvmsg_hñ≥r
 (
msm
, 
ms
->
sockë
, 0, &
bi
,

331 i‡(!
îr‹
)

333 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

334 
mc_msg_joö_‹_Àave_ªque°_t
 *
mp
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

336 
	`˛ib_ho°_to_√t_u32
 (
mp
->
ty≥
))

338 
MC_MSG_TYPE_joö_‹_Àave_ªque°
:

339 
	`msg_h™dÀr
 (
mcm
, 
bi
, 0,

340 
mc_msg_joö_‹_Àave_ªque°_h™dÀr
);

343 
MC_MSG_TYPE_joö_ª∂y
:

344 
	`msg_h™dÀr
 (
mcm
, 
bi
, 0,

345 
mc_msg_joö_ª∂y_h™dÀr
);

349 
	`ASSERT
 (0);

353  
îr‹
;

354 
	}
}

356 
˛ib_îr‹_t
 *

357 
	$ack_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

359 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

360 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

361 
˛ib_îr‹_t
 *
îr‹
;

362 
u32
 
bi
;

364 
îr‹
 = 
	`ªcvmsg_hñ≥r
 (
msm
, msm->
ack_sockë
, 0, &
bi
,

366 i‡(!
îr‹
)

367 
	`msg_h™dÀr
 (
mcm
, 
bi
, 0,

368 
mc_msg_u£r_ack_h™dÀr
);

369  
îr‹
;

370 
	}
}

373 
	$ˇtchup_˛ónup
 (
mc_sockë_maö_t
 * 
msm
,

374 
mc_sockë_ˇtchup_t
 * 
c
, 
˛ib_fûe_maö_t
 * 
um
,

375 
˛ib_fûe_t
 * 
uf
)

377 
	`hash_un£t
 (
msm
->
ˇtchup_ödex_by_fûe_des¸ùt‹
, 
uf
->
fûe_des¸ùt‹
);

378 
	`˛ib_fûe_dñ
 (
um
, 
uf
);

379 
	`vec_‰ì
 (
c
->
öput_ve˘‹
);

380 
	`vec_‰ì
 (
c
->
ouçut_ve˘‹
);

381 
	`poﬁ_put
 (
msm
->
ˇtchups
, 
c
);

382 
	}
}

384 
mc_sockë_ˇtchup_t
 *

385 
	$föd_ˇtchup_‰om_fûe_des¸ùt‹
 (
mc_sockë_maö_t
 * 
msm
,

386 
fûe_des¸ùt‹
)

388 
uw‹d
 *
p
 =

389 
	`hash_gë
 (
msm
->
ˇtchup_ödex_by_fûe_des¸ùt‹
, 
fûe_des¸ùt‹
);

390  
p
 ? 
	`poﬁ_ñt_©_ödex
 (
msm
->
ˇtchups
,Ö[0]) : 0;

391 
	}
}

393 
˛ib_îr‹_t
 *

394 
	$ˇtchup_sockë_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
, 
is_£rvî
)

396 
˛ib_fûe_maö_t
 *
um
 = &
fûe_maö
;

397 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

398 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

399 
mc_sockë_ˇtchup_t
 *
c
 =

400 
	`föd_ˇtchup_‰om_fûe_des¸ùt‹
 (
msm
, 
uf
->
fûe_des¸ùt‹
);

401 
w‹d
 
l
, 
n
, 
is_eof
;

403 
l
 = 
	`vec_Àn
 (
c
->
öput_ve˘‹
);

404 
	`vec_ªsize
 (
c
->
öput_ve˘‹
, 4096);

405 
n
 =

406 
	`ªad
 (
uf
->
fûe_des¸ùt‹
, 
c
->
öput_ve˘‹
 + 
l
,

407 
	`vec_Àn
 (
c
->
öput_ve˘‹
Ë- 
l
);

408 
is_eof
 = 
n
 == 0;

410 i‡(
n
 < 0)

412 i‡(
î∫o
 =
EAGAIN
)

413 
n
 = 0;

416 
	`ˇtchup_˛ónup
 (
msm
, 
c
, 
um
, 
uf
);

417  
	`˛ib_îr‹_ªtu∫_unix
 (0, "read");

421 
	`_vec_Àn
 (
c
->
öput_ve˘‹
Ë
l
 + 
n
;

423 i‡(
is_eof
 && 
	`vec_Àn
 (
c
->
öput_ve˘‹
) > 0)

425 i‡(
is_£rvî
)

427 
	`mc_msg_ˇtchup_ªque°_h™dÀr
 (
mcm
, (*Ë
c
->
öput_ve˘‹
,

428 
c
 - 
msm
->
ˇtchups
);

429 
	`_vec_Àn
 (
c
->
öput_ve˘‹
) = 0;

433 
	`mc_msg_ˇtchup_ª∂y_h™dÀr
 (
mcm
, (*Ë
c
->
öput_ve˘‹
,

434 
c
 - 
msm
->
ˇtchups
);

435 
c
->
öput_ve˘‹
 = 0;

436 
	`ˇtchup_˛ónup
 (
msm
, 
c
, 
um
, 
uf
);

441 
	}
}

443 
˛ib_îr‹_t
 *

444 
	$ˇtchup_£rvî_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

446  
	`ˇtchup_sockë_ªad_ªady
 (
uf
, 1);

447 
	}
}

449 
˛ib_îr‹_t
 *

450 
	$ˇtchup_˛õ¡_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

452 i‡(
MC_EVENT_LOGGING
)

454 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

455 
vlib_maö_t
 *
vm
 = 
msm
->
mc_maö
.
vlib_maö
;

457 
	`ELOG_TYPE
 (
e
, "catchup_client_read_ready");

458 
	`ELOG
 (&
vm
->
ñog_maö
, 
e
, 0);

460  
	`ˇtchup_sockë_ªad_ªady
 (
uf
, 0);

461 
	}
}

463 
˛ib_îr‹_t
 *

464 
	$ˇtchup_sockë_wrôe_ªady
 (
˛ib_fûe_t
 * 
uf
, 
is_£rvî
)

466 
˛ib_fûe_maö_t
 *
um
 = &
fûe_maö
;

467 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

468 
mc_sockë_ˇtchup_t
 *
c
 =

469 
	`föd_ˇtchup_‰om_fûe_des¸ùt‹
 (
msm
, 
uf
->
fûe_des¸ùt‹
);

470 
˛ib_îr‹_t
 *
îr‹
 = 0;

471 
n
;

473 i‡(
c
->
c⁄√˘_ö_¥ogªss
)

475 
u32
 
Àn
, 
vÆue
;

477 
c
->
c⁄√˘_ö_¥ogªss
 = 0;

478 
Àn
 =  (
vÆue
);

479 i‡(
	`gësock›t
 (
c
->
sockë
, 
SOL_SOCKET
, 
SO_ERROR
, &
vÆue
, &
Àn
) < 0)

481 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "getsockopt SO_ERROR");

482 
îr‹_quô
;

484 i‡(
vÆue
 != 0)

486 
îr‹
 =

487 
	`˛ib_îr‹_ªtu∫_code
 (0, 
vÆue
, 
CLIB_ERROR_ERRNO_VALID
,

489 
îr‹_quô
;

495 
u32
 
n_this_wrôe
;

497 
n_this_wrôe
 =

498 
	`˛ib_mö
 (
	`vec_Àn
 (
c
->
ouçut_ve˘‹
Ë- c->
ouçut_ve˘‹_n_wrôãn
,

499 
msm
->
rx_mtu_n_byãs
 -

502 i‡(
n_this_wrôe
 <= 0)

507 
n
 = 
	`wrôe
 (
uf
->
fûe_des¸ùt‹
,

508 
c
->
ouçut_ve˘‹
 + c->
ouçut_ve˘‹_n_wrôãn
,

509 
n_this_wrôe
);

511 
n
 < 0 && 
î∫o
 =
EAGAIN
);

513 i‡(
n
 < 0)

515 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "write");

516 
îr‹_quô
;

518 
c
->
ouçut_ve˘‹_n_wrôãn
 +
n
;

521 i‡(
c
->
ouçut_ve˘‹_n_wrôãn
 >
	`vec_Àn
 (c->
ouçut_ve˘‹
))

523 i‡(!
is_£rvî
)

525 
uf
->
Êags
 &~
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
;

526 
fûe_maö
.
	`fûe_upd©e
 (
uf
, 
UNIX_FILE_UPDATE_MODIFY
);

528 
	`shutdown
 (
uf
->
fûe_des¸ùt‹
, 
SHUT_WR
);

529  
îr‹
;

533 
îr‹_quô
:

534 
	`ˇtchup_˛ónup
 (
msm
, 
c
, 
um
, 
uf
);

537  
îr‹
;

538 
	}
}

540 
˛ib_îr‹_t
 *

541 
	$ˇtchup_£rvî_wrôe_ªady
 (
˛ib_fûe_t
 * 
uf
)

543  
	`ˇtchup_sockë_wrôe_ªady
 (
uf
, 1);

544 
	}
}

546 
˛ib_îr‹_t
 *

547 
	$ˇtchup_˛õ¡_wrôe_ªady
 (
˛ib_fûe_t
 * 
uf
)

549  
	`ˇtchup_sockë_wrôe_ªady
 (
uf
, 0);

550 
	}
}

552 
˛ib_îr‹_t
 *

553 
	$ˇtchup_sockë_îr‹_ªady
 (
˛ib_fûe_t
 * 
uf
)

555 
˛ib_fûe_maö_t
 *
um
 = &
fûe_maö
;

556 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

557 
mc_sockë_ˇtchup_t
 *
c
 =

558 
	`föd_ˇtchup_‰om_fûe_des¸ùt‹
 (
msm
, 
uf
->
fûe_des¸ùt‹
);

559 
	`ˇtchup_˛ónup
 (
msm
, 
c
, 
um
, 
uf
);

560  
	`˛ib_îr‹_ªtu∫
 (0, "error");

561 
	}
}

563 
˛ib_îr‹_t
 *

564 
	$ˇtchup_li°í_ªad_ªady
 (
˛ib_fûe_t
 * 
uf
)

566 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
uf
->
¥iv©e_d©a
;

567 
sockaddr_ö
 
˛õ¡_addr
;

568 
˛õ¡_Àn
;

569 
mc_sockë_ˇtchup_t
 *
c
;

570 
˛ib_fûe_t
 
ãm∂©e
 = { 0 };

572 
	`poﬁ_gë
 (
msm
->
ˇtchups
, 
c
);

573 
	`mem£t
 (
c
, 0,  (c[0]));

575 
˛õ¡_Àn
 =  (
˛õ¡_addr
);

578 
c
->
sockë
 = 
	`ac˚±
 (
uf
->
fûe_des¸ùt‹
,

579 (
sockaddr
 *Ë&
˛õ¡_addr
,

580 (
sockÀn_t
 *Ë& 
˛õ¡_Àn
);

582 i‡(
c
->
sockë
 < 0)

584 
	`poﬁ_put
 (
msm
->
ˇtchups
, 
c
);

585  
	`˛ib_îr‹_ªtu∫_unix
 (0, "accept");

588 i‡(
MC_EVENT_LOGGING
)

590 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

591 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

593 
	`ELOG_TYPE_DECLARE
 (
e
) =

595 .
f‹m©
 = "ˇtchu∞ac˚±ed from 0x%lx",.
f‹m©_¨gs
 = "i4",};

598 
u32
 
addr
;

599 } *
ed
 = 0;

601 
ed
 = 
	`ELOG_DATA
 (&
vm
->
ñog_maö
, 
e
);

602 
ed
->
addr
 = 
	`¡ohl
 (
˛õ¡_addr
.
sö_addr
.
s_addr
);

607 
⁄e
 = 1;

608 i‡((
	`£tsock›t
 (
c
->
sockë
, 
IPPROTO_TCP
,

609 
TCP_NODELAY
, (*Ë&
⁄e
,  (one))) < 0)

611 
	`˛ib_unix_w¨nög
 ("catchup socket: set TCP_NODELAY");

615 
ãm∂©e
.
ªad_fun˘i⁄
 = 
ˇtchup_£rvî_ªad_ªady
;

616 
ãm∂©e
.
wrôe_fun˘i⁄
 = 
ˇtchup_£rvî_wrôe_ªady
;

617 
ãm∂©e
.
îr‹_fun˘i⁄
 = 
ˇtchup_sockë_îr‹_ªady
;

618 
ãm∂©e
.
fûe_des¸ùt‹
 = 
c
->
sockë
;

619 
ãm∂©e
.
¥iv©e_d©a
 = 
	`poöãr_to_uw‹d
 (
msm
);

620 
c
->
˛ib_fûe_ödex
 = 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

621 
	`hash_£t
 (
msm
->
ˇtchup_ödex_by_fûe_des¸ùt‹
, 
c
->
sockë
,

622 
c
 - 
msm
->
ˇtchups
);

625 
	}
}

628 
w‹d


629 
	$föd_™d_böd_to_‰ì_p‹t
 (
w‹d
 
sock
, w‹d 
p‹t
)

631 ; 
p‹t
 < 1 << 16;Öort++)

633 
sockaddr_ö
 
a
;

635 
	`mem£t
 (&
a
, 0,  (a));

637 
a
.
sö_Ámûy
 = 
PF_INET
;

638 
a
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

639 
a
.
sö_p‹t
 = 
	`ht⁄s
 (
p‹t
);

641 i‡(
	`böd
 (
sock
, (
sockaddr
 *Ë&
a
,  (a)) >= 0)

645  
p‹t
 < 1 << 16 ?Öort : -1;

646 
	}
}

648 
˛ib_îr‹_t
 *

649 
	$£tup_muéiˇ°_sockë
 (
mc_sockë_maö_t
 * 
msm
,

650 
mc_mu…iˇ°_sockë_t
 * 
ms
,

651 *
ty≥
, 
uw‹d
 
udp_p‹t
)

653 
⁄e
 = 1;

654 
ù_mªq
 
mˇ°_ªq
;

656 i‡(!
msm
->
mu…iˇ°_âl
)

657 
msm
->
mu…iˇ°_âl
 = 1;

660 i‡((
ms
->
sockë
 = 
	`sockë
 (
PF_INET
, 
SOCK_DGRAM
, 
IPPROTO_UDP
)) < 0)

661  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%†sockë", 
ty≥
);

664 
u8
 
âl
 = 
msm
->
mu…iˇ°_âl
;

666 i‡((
	`£tsock›t
 (
ms
->
sockë
, 
IPPROTO_IP
,

667 
IP_MULTICAST_TTL
, (*Ë&
âl
,  (ttl))) < 0)

668  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%†£àmu…iˇ°Åé", 
ty≥
);

671 i‡(
	`£tsock›t
 (
ms
->
sockë
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄e
,  (one)) <

673  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%†£tsock›àSO_REUSEADDR", 
ty≥
);

675 
	`mem£t
 (&
ms
->
tx_addr
, 0,  (ms->tx_addr));

676 
ms
->
tx_addr
.
sö_Ámûy
 = 
AF_INET
;

677 
ms
->
tx_addr
.
sö_addr
.
s_addr
 =

678 
	`ht⁄l
 (
msm
->
mu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
);

679 
ms
->
tx_addr
.
sö_p‹t
 = 
	`ht⁄s
 (
udp_p‹t
);

681 i‡(
	`böd
 (
ms
->
sockë
, (
sockaddr
 *Ë&ms->
tx_addr
,

682  (
ms
->
tx_addr
)) < 0)

683  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%†böd", 
ty≥
);

685 
	`mem£t
 (&
mˇ°_ªq
, 0,  (mcast_req));

686 
mˇ°_ªq
.
imr_mu…üddr
.
s_addr
 =

687 
	`ht⁄l
 (
msm
->
mu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
);

688 
mˇ°_ªq
.
imr_öãrÁ˚
.
s_addr
 = 
msm
->
if_ù4_addªss_√t_byã_‹dî
;

690 i‡((
	`£tsock›t
 (
ms
->
sockë
, 
IPPROTO_IP
,

691 
IP_ADD_MEMBERSHIP
, (*Ë&
mˇ°_ªq
,

692  (
mˇ°_ªq
))) < 0)

693  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%s IP_ADD_MEMBERSHIP setsockopt",

694 
ty≥
);

696 i‡(
	`io˘l
 (
ms
->
sockë
, 
FIONBIO
, &
⁄e
) < 0)

697  
	`˛ib_îr‹_ªtu∫_unix
 (0, "%†£àFIONBIO", 
ty≥
);

701 
u32
 
Àn
 = 1 << 20;

702 
sockÀn_t
 
¶
 =  (
Àn
);

703 i‡(
	`£tsock›t
 (
ms
->
sockë
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
Àn
, 
¶
) < 0)

704 
	`˛ib_unix_îr‹
 ("setsockopt");

708 
	}
}

710 
˛ib_îr‹_t
 *

711 
	$sockë_£tup
 (
mc_sockë_maö_t
 * 
msm
)

713 
⁄e
 = 1;

714 
˛ib_îr‹_t
 *
îr‹
;

715 
u32
 
p‹t
;

717 i‡(!
msm
->
ba£_mu…iˇ°_udp_p‹t_ho°_byã_‹dî
)

718 
msm
->
ba£_mu…iˇ°_udp_p‹t_ho°_byã_‹dî
 =

719 0xfff‡- ((
MC_N_TRANSPORT_TYPE
 + 2 )

722 
p‹t
 = 
msm
->
ba£_mu…iˇ°_udp_p‹t_ho°_byã_‹dî
;

724 
îr‹
 = 
	`£tup_muéiˇ°_sockë
 (
msm
,

725 &
msm
->
mu…iˇ°_sockës


726 [
MC_TRANSPORT_MASTERSHIP
], "mastership",

727 
p‹t
++);

728 i‡(
îr‹
)

729  
îr‹
;

731 
îr‹
 = 
	`£tup_muéiˇ°_sockë
 (
msm
,

732 &
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_JOIN
],

733 "joö", 
p‹t
++);

734 i‡(
îr‹
)

735  
îr‹
;

737 
îr‹
 = 
	`£tup_muéiˇ°_sockë
 (
msm
,

738 &
msm
->
mu…iˇ°_sockës


739 [
MC_TRANSPORT_USER_REQUEST_TO_RELAY
],

740 "tÿªœy", 
p‹t
++);

741 i‡(
îr‹
)

742  
îr‹
;

744 
îr‹
 = 
	`£tup_muéiˇ°_sockë
 (
msm
,

745 &
msm
->
mu…iˇ°_sockës


746 [
MC_TRANSPORT_USER_REQUEST_FROM_RELAY
],

747 "‰omÑñay", 
p‹t
++);

748 i‡(
îr‹
)

749  
îr‹
;

752 
msm
->
ack_sockë
 = 
	`sockë
 (
PF_INET
, 
SOCK_DGRAM
, 
IPPROTO_UDP
);

753 i‡(
msm
->
ack_sockë
 < 0)

754  
	`˛ib_îr‹_ªtu∫_unix
 (0, "ack socket");

756 
msm
->
ack_udp_p‹t
 = 
	`föd_™d_böd_to_‰ì_p‹t
 (msm->
ack_sockë
, 
p‹t
++);

758 i‡(
	`io˘l
 (
msm
->
ack_sockë
, 
FIONBIO
, &
⁄e
) < 0)

759  
	`˛ib_îr‹_ªtu∫_unix
 (0, "ack socket FIONBIO");

761 
msm
->
ˇtchup_£rvî_sockë
 = 
	`sockë
 (
AF_INET
, 
SOCK_STREAM
, 0);

762 i‡(
msm
->
ˇtchup_£rvî_sockë
 < 0)

763  
	`˛ib_îr‹_ªtu∫_unix
 (0, "catchup server socket");

765 
msm
->
ˇtchup_t˝_p‹t
 =

766 
	`föd_™d_böd_to_‰ì_p‹t
 (
msm
->
ˇtchup_£rvî_sockë
, 
p‹t
++);

768 i‡(
	`io˘l
 (
msm
->
ˇtchup_£rvî_sockë
, 
FIONBIO
, &
⁄e
) < 0)

769  
	`˛ib_îr‹_ªtu∫_unix
 (0, "catchup server socket FIONBIO");

771 i‡(
	`li°í
 (
msm
->
ˇtchup_£rvî_sockë
, 5) < 0)

772  
	`˛ib_îr‹_ªtu∫_unix
 (0, "catchup server socketÜisten");

776 
˛ib_fûe_t
 
ãm∂©e
 = { 0 };

778 
ãm∂©e
.
ªad_fun˘i⁄
 = 
ma°îshù_sockë_ªad_ªady
;

779 
ãm∂©e
.
fûe_des¸ùt‹
 =

780 
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_MASTERSHIP
].
sockë
;

781 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

782 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

785 
ãm∂©e
.
ªad_fun˘i⁄
 = 
to_ªœy_sockë_ªad_ªady
;

786 
ãm∂©e
.
fûe_des¸ùt‹
 =

787 
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_USER_REQUEST_TO_RELAY
].
sockë
;

788 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

789 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

792 
ãm∂©e
.
ªad_fun˘i⁄
 = 
‰om_ªœy_sockë_ªad_ªady
;

793 
ãm∂©e
.
fûe_des¸ùt‹
 =

794 
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_USER_REQUEST_FROM_RELAY
].
sockë
;

795 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

796 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

798 
ãm∂©e
.
ªad_fun˘i⁄
 = 
joö_sockë_ªad_ªady
;

799 
ãm∂©e
.
fûe_des¸ùt‹
 =

800 
msm
->
mu…iˇ°_sockës
[
MC_TRANSPORT_JOIN
].
sockë
;

801 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

802 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

805 
ãm∂©e
.
ªad_fun˘i⁄
 = 
ack_sockë_ªad_ªady
;

806 
ãm∂©e
.
fûe_des¸ùt‹
 = 
msm
->
ack_sockë
;

807 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

808 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

811 
ãm∂©e
.
ªad_fun˘i⁄
 = 
ˇtchup_li°í_ªad_ªady
;

812 
ãm∂©e
.
fûe_des¸ùt‹
 = 
msm
->
ˇtchup_£rvî_sockë
;

813 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

814 
	`˛ib_fûe_add
 (&
fûe_maö
, &
ãm∂©e
);

818 
	}
}

821 
	$ˇtchup_add_≥ndög_ouçut
 (
mc_sockë_ˇtchup_t
 * 
c
, 
uw‹d
 
n_byãs
,

822 
u8
 * 
£t_ouçut_ve˘‹
)

824 
˛ib_fûe_t
 *
uf
 = 
	`poﬁ_ñt_©_ödex
 (
fûe_maö
.
fûe_poﬁ
,

825 
c
->
˛ib_fûe_ödex
);

826 
u8
 *
ªsu…
 = 0;

828 i‡(
£t_ouçut_ve˘‹
)

829 
c
->
ouçut_ve˘‹
 = 
£t_ouçut_ve˘‹
;

831 
	`vec_add2
 (
c
->
ouçut_ve˘‹
, 
ªsu…
, 
n_byãs
);

832 i‡(
	`vec_Àn
 (
c
->
ouçut_ve˘‹
) > 0)

834 
skù_upd©e
 = 0 !(
uf
->
Êags
 & 
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
);

835 
uf
->
Êags
 |
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
;

836 i‡(!
skù_upd©e
)

837 
fûe_maö
.
	`fûe_upd©e
 (
uf
, 
UNIX_FILE_UPDATE_MODIFY
);

839  
ªsu…
;

840 
	}
}

842 
uw‹d


843 
	$ˇtchup_ªque°_fun
 (*
å™•‹t_maö
,

844 
u32
 
°ªam_ödex
, 
mc_≥î_id_t
 
ˇtchup_≥î_id
)

846 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
å™•‹t_maö
;

847 
mc_maö_t
 *
mcm
 = &
msm
->
mc_maö
;

848 
vlib_maö_t
 *
vm
 = 
mcm
->
vlib_maö
;

849 
mc_sockë_ˇtchup_t
 *
c
;

850 
sockaddr_ö
 
addr
;

851 
˛ib_fûe_maö_t
 *
um
 = &
fûe_maö
;

852 
⁄e
 = 1;

854 
	`poﬁ_gë
 (
msm
->
ˇtchups
, 
c
);

855 
	`mem£t
 (
c
, 0,  (*c));

857 
c
->
sockë
 = 
	`sockë
 (
AF_INET
, 
SOCK_STREAM
, 0);

858 i‡(
c
->
sockë
 < 0)

860 
	`˛ib_unix_w¨nög
 ("socket");

864 i‡(
	`io˘l
 (
c
->
sockë
, 
FIONBIO
, &
⁄e
) < 0)

866 
	`˛ib_unix_w¨nög
 ("FIONBIO");

870 
	`mem£t
 (&
addr
, 0,  (addr));

871 
addr
.
sö_Ámûy
 = 
AF_INET
;

872 
addr
.
sö_addr
.
s_addr
 = 
	`mc_sockë_≥î_id_gë_addªss
 (
ˇtchup_≥î_id
);

873 
addr
.
sö_p‹t
 = 
	`mc_sockë_≥î_id_gë_p‹t
 (
ˇtchup_≥î_id
);

875 
c
->
c⁄√˘_ö_¥ogªss
 = 1;

877 i‡(
MC_EVENT_LOGGING
)

879 
	`ELOG_TYPE_DECLARE
 (
e
) =

881 .
f‹m©
 = "c⁄√˘ögÅÿ≥î 0x%Lx",.
f‹m©_¨gs
 = "i8",};

884 
u64
 
≥î
;

885 } *
ed
;

886 
ed
 = 
	`ELOG_DATA
 (&
vm
->
ñog_maö
, 
e
);

887 
ed
->
≥î
 = 
ˇtchup_≥î_id
.
as_u64
;

890 i‡(
	`c⁄√˘
 (
c
->
sockë
, (c⁄° *Ë&
addr
,  (addr))

891 < 0 && 
î∫o
 !
EINPROGRESS
)

893 
	`˛ib_unix_w¨nög
 ("connectÅo %U fails",

894 
f‹m©_sockë_≥î_id
, 
ˇtchup_≥î_id
);

899 
˛ib_fûe_t
 
ãm∂©e
 = { 0 };

901 
ãm∂©e
.
ªad_fun˘i⁄
 = 
ˇtchup_˛õ¡_ªad_ªady
;

902 
ãm∂©e
.
wrôe_fun˘i⁄
 = 
ˇtchup_˛õ¡_wrôe_ªady
;

903 
ãm∂©e
.
îr‹_fun˘i⁄
 = 
ˇtchup_sockë_îr‹_ªady
;

904 
ãm∂©e
.
fûe_des¸ùt‹
 = 
c
->
sockë
;

905 
ãm∂©e
.
¥iv©e_d©a
 = (
uw‹d
Ë
msm
;

906 
c
->
˛ib_fûe_ödex
 = 
	`˛ib_fûe_add
 (
um
, &
ãm∂©e
);

908 
	`hash_£t
 (
msm
->
ˇtchup_ödex_by_fûe_des¸ùt‹
, 
c
->
sockë
,

909 
c
 - 
msm
->
ˇtchups
);

913 
mc_msg_ˇtchup_ªque°_t
 *
mp
;

914 
mp
 = 
	`ˇtchup_add_≥ndög_ouçut
 (
c
,  (mp[0]),

916 
mp
->
≥î_id
 = 
msm
->
mc_maö
.
å™•‹t
.
our_ˇtchup_≥î_id
;

917 
mp
->
°ªam_ödex
 = stream_index;

918 
	`mc_byã_sw≠_msg_ˇtchup_ªque°
 (
mp
);

921  
c
 - 
msm
->
ˇtchups
;

922 
	}
}

925 
	$ˇtchup_£nd_fun
 (*
å™•‹t_maö
, 
uw‹d
 
›aque
, 
u8
 * 
d©a
)

927 
mc_sockë_maö_t
 *
msm
 = (mc_sockë_maö_à*Ë
å™•‹t_maö
;

928 
mc_sockë_ˇtchup_t
 *
c
 = 
	`poﬁ_ñt_©_ödex
 (
msm
->
ˇtchups
, 
›aque
);

929 
	`ˇtchup_add_≥ndög_ouçut
 (
c
, 0, 
d©a
);

930 
	}
}

933 
	$föd_öãrÁ˚_ù4_addªss
 (*
if_«me
, 
u32
 * 
ù4_addªss
, u32 * 
mtu
)

935 
fd
;

936 
i‰eq
 
i‰
;

937 
sockaddr_ö
 *
ß
;

940 
fd
 = 
	`sockë
 (
PF_INET
, 
AF_INET
, 0);

941 i‡(
fd
 < 0)

943 
	`˛ib_unix_îr‹
 ("socket");

947 
i‰
.
i‰_addr
.
ß_Ámûy
 = 
AF_INET
;

948 
	`°∫˝y
 (
i‰
.
i‰_«me
, 
if_«me
,  (ifr.ifr_name) - 1);

949 i‡(
	`io˘l
 (
fd
, 
SIOCGIFADDR
, &
i‰
) < 0)

951 
	`˛ib_unix_îr‹
 ("ioctl(SIOCFIGADDR)");

952 
	`˛o£
 (
fd
);

956 
ß
 = (*Ë&
i‰
.
i‰_addr
;

957 
	`˛ib_mem˝y
 (
ù4_addªss
, &
ß
->
sö_addr
.
s_addr
,  (ip4_address[0]));

959 i‡(
	`io˘l
 (
fd
, 
SIOCGIFMTU
, &
i‰
) < 0)

961 
	`˛o£
 (
fd
);

964 i‡(
mtu
)

965 *
mtu
 = 
i‰
.
i‰_mtu
 - ( 20 + 8);

967 
	`˛o£
 (
fd
);

970 
	}
}

972 
˛ib_îr‹_t
 *

973 
	$mc_sockë_maö_öô
 (
mc_sockë_maö_t
 * 
msm
, **
ötfc_¥obe_li°
,

974 
n_ötfcs_to_¥obe
)

976 
˛ib_îr‹_t
 *
îr‹
;

977 
mc_maö_t
 *
mcm
;

978 
u32
 
mtu
;

980 
mcm
 = &
msm
->
mc_maö
;

983 i‡(!
msm
->
mu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
)

984 
msm
->
mu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
 = 0xefff0007;

987 
u32
 
i
, 
a
, 
wö
;

989 
wö
 = 0;

990 i‡(
msm
->
mu…iˇ°_öãrÁ˚_«me
)

992 
wö
 =

993 !
	`föd_öãrÁ˚_ù4_addªss
 (
msm
->
mu…iˇ°_öãrÁ˚_«me
, &
a
,

994 &
mtu
);

998 
i
 = 0; i < 
n_ötfcs_to_¥obe
; i++)

999 i‡(!
	`föd_öãrÁ˚_ù4_addªss
 (
ötfc_¥obe_li°
[
i
], &
a
, &
mtu
))

1001 
wö
 = 1;

1002 
msm
->
mu…iˇ°_öãrÁ˚_«me
 = 
ötfc_¥obe_li°
[
i
];

1007 i‡(!
wö
)

1008  
	`˛ib_îr‹_ªtu∫
 (0, "can't find interface ip4áddress");

1010 
msm
->
if_ù4_addªss_√t_byã_‹dî
 = 
a
;

1013 
msm
->
rx_mtu_n_byãs
 = 
mtu
;

1014 
msm
->
rx_mtu_n_buf„rs
 =

1015 
msm
->
rx_mtu_n_byãs
 / 
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
;

1016 
msm
->
rx_mtu_n_buf„rs
 +=

1017 (
msm
->
rx_mtu_n_byãs
 % 
VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
) != 0;

1019 
îr‹
 = 
	`sockë_£tup
 (
msm
);

1020 i‡(
îr‹
)

1021  
îr‹
;

1023 
mcm
->
å™•‹t
.
our_ack_≥î_id
 =

1024 
	`mc_sockë_£t_≥î_id
 (
msm
->
if_ù4_addªss_√t_byã_‹dî
,

1025 
msm
->
ack_udp_p‹t
);

1027 
mcm
->
å™•‹t
.
our_ˇtchup_≥î_id
 =

1028 
	`mc_sockë_£t_≥î_id
 (
msm
->
if_ù4_addªss_√t_byã_‹dî
,

1029 
msm
->
ˇtchup_t˝_p‹t
);

1031 
mcm
->
å™•‹t
.
tx_buf„r
 =Åx_buffer;

1032 
mcm
->
å™•‹t
.
tx_ack
 =Åx_ack;

1033 
mcm
->
å™•‹t
.
ˇtchup_ªque°_fun
 = catchup_request_fun;

1034 
mcm
->
å™•‹t
.
ˇtchup_£nd_fun
 = catchup_send_fun;

1035 
mcm
->
å™•‹t
.
f‹m©_≥î_id
 = 
f‹m©_sockë_≥î_id
;

1036 
mcm
->
å™•‹t
.
›aque
 = 
msm
;

1037 
mcm
->
å™•‹t
.
max_∑ckë_size
 = 
mtu
;

1039 
	`mc_maö_öô
 (
mcm
, "socket");

1041  
îr‹
;

1042 
	}
}

	@unix/mc_socket.h

18 #i‚de‡
__ö˛uded_mc_sockë_h__


19 
	#__ö˛uded_mc_sockë_h__


	)

21 
	~<vlib/unix/unix.h
>

22 
	~<√töë/ö.h
>

26 
	msockë
;

27 
sockaddr_ö
 
	mtx_addr
;

28 } 
	tmc_mu…iˇ°_sockë_t
;

33 
	msockë
;

34 
u32
 
	m˛ib_fûe_ödex
;

36 
u8
 *
	möput_ve˘‹
;

37 
u8
 *
	mouçut_ve˘‹
;

38 
u32
 
	mouçut_ve˘‹_n_wrôãn
;

40 
u32
 
	mc⁄√˘_ö_¥ogªss
;

41 } 
	tmc_sockë_ˇtchup_t
;

43 
	smc_sockë_maö_t


45 
mc_maö_t
 
	mmc_maö
;

48 
mc_mu…iˇ°_sockë_t
 
	mmu…iˇ°_sockës
[
MC_N_TRANSPORT_TYPE
];

51 
	mack_sockë
;

54 
	mˇtchup_£rvî_sockë
;

57 
mc_sockë_ˇtchup_t
 *
	mˇtchups
;

59 
uw‹d
 *
	mˇtchup_ödex_by_fûe_des¸ùt‹
;

61 
u32
 
	mrx_mtu_n_byãs
;

64 
u32
 
	mrx_mtu_n_buf„rs
;

67 
u32
 *
	mrx_buf„rs
;

70 
iovec
 *
	miovecs
;

73 
u32
 
	mif_ù4_addªss_√t_byã_‹dî
;

75 
u32
 
	mack_udp_p‹t
;

76 
u32
 
	mˇtchup_t˝_p‹t
;

79 *
	mmu…iˇ°_öãrÁ˚_«me
;

83 
u32
 
	mmu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
;

86 
u32
 
	mmu…iˇ°_âl
;

91 
u32
 
	mba£_mu…iˇ°_udp_p‹t_ho°_byã_‹dî
;

92 } 
	tmc_sockë_maö_t
;

94 
Æways_ölöe
 
u32


95 
	$mc_sockë_≥î_id_gë_addªss
 (
mc_≥î_id_t
 
i
)

97 
u32
 
a
 = ((
i
.
as_u8
[0] << 24)

98 | (
i
.
as_u8
[1] << 16) | (i.as_u8[2] << 8) | (i.as_u8[3] << 0));

99  
	`˛ib_ho°_to_√t_u32
 (
a
);

100 
	}
}

102 
Æways_ölöe
 
u32


103 
	$mc_sockë_≥î_id_gë_p‹t
 (
mc_≥î_id_t
 
i
)

105  
	`˛ib_ho°_to_√t_u16
 ((
i
.
as_u8
[4] << 8) | i.as_u8[5]);

106 
	}
}

108 
°©ic_Æways_ölöe
 
mc_≥î_id_t


109 
	$mc_sockë_£t_≥î_id
 (
u32
 
addªss_√t_byã_‹dî
, u32 
p‹t_ho°_byã_‹dî
)

111 
mc_≥î_id_t
 
i
;

112 
u32
 
a
 = 
	`¡ohl
 (
addªss_√t_byã_‹dî
);

113 
u32
 
p
 = 
p‹t_ho°_byã_‹dî
;

114 
i
.
as_u8
[0] = (
a
 >> 24) & 0xff;

115 
i
.
as_u8
[1] = (
a
 >> 16) & 0xff;

116 
i
.
as_u8
[2] = (
a
 >> 8) & 0xff;

117 
i
.
as_u8
[3] = (
a
 >> 0) & 0xff;

118 
i
.
as_u8
[4] = (
p
 >> 8) & 0xff;

119 
i
.
as_u8
[5] = (
p
 >> 0) & 0xff;

120 
i
.
as_u8
[6] = 0;

121 
i
.
as_u8
[7] = 0;

122  
i
;

123 
	}
}

125 
˛ib_îr‹_t
 *
mc_sockë_maö_öô
 (
mc_sockë_maö_t
 * 
msm
,

126 **
ötfc_¥obe_li°
,

127 
n_ötfcs_to_¥obe
);

	@unix/plugin.c

18 
	~<vlib/unix/∂ugö.h
>

19 
	~<vµö‰a/ñf.h
>

20 
	~<dlf˙.h
>

21 
	~<dúít.h
>

23 
∂ugö_maö_t
 
	gvlib_∂ugö_maö
;

25 *
vlib_∂ugö_∑th
 
__©åibuã__
 ((
wók
));

26 *
	gvlib_∂ugö_∑th
 = "";

27 *
vlib_∂ugö_≠p_vîsi⁄
 
__©åibuã__
 ((
wók
));

28 *
	gvlib_∂ugö_≠p_vîsi⁄
 = "";

31 
	$vlib_gë_∂ugö_symbﬁ
 (*
∂ugö_«me
, *
symbﬁ_«me
)

33 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

34 
uw‹d
 *
p
;

35 
∂ugö_öfo_t
 *
pi
;

37 i‡((
p
 = 
	`hash_gë_mem
 (
pm
->
∂ugö_by_«me_hash
, 
∂ugö_«me
)) == 0)

40 
pi
 = 
	`vec_ñt_©_ödex
 (
pm
->
∂ugö_öfo
, 
p
[0]);

41  
	`dlsym
 (
pi
->
h™dÀ
, 
symbﬁ_«me
);

42 
	}
}

45 
	$°r_¨øy_to_vec
 (*
¨øy
, 
Àn
)

47 
c
, *
r
 = 0;

48 
n
 = 0;

52 
c
 = 
¨øy
[
n
];

53 
	`vec_add1
 (
r
, 
c
);

55 
c
 && ++
n
 < 
Àn
);

57 i‡(
c
)

58 
	`vec_add1
 (
r
, 0);

60  
r
;

61 
	}
}

64 
	$lﬂd_⁄e_∂ugö
 (
∂ugö_maö_t
 * 
pm
, 
∂ugö_öfo_t
 * 
pi
, 
‰om_óæy_öô
)

66 *
h™dÀ
;

67 
˛ib_îr‹_t
 *
îr‹
;

68 
ñf_maö_t
 
em
 = { 0 };

69 
ñf_£˘i⁄_t
 *
£˘i⁄
;

70 
u8
 *
d©a
;

71 *
vîsi⁄_ªquúed
;

72 
vlib_∂ugö_ªgi°øti⁄_t
 *
ªg
;

73 
∂ugö_c⁄fig_t
 *
pc
 = 0;

74 
uw‹d
 *
p
;

76 i‡(
	`ñf_ªad_fûe
 (&
em
, (*Ë
pi
->
fûíame
))

79 
îr‹
 = 
	`ñf_gë_£˘i⁄_by_«me
 (&
em
, ".vlib_plugin_registration",

80 &
£˘i⁄
);

81 i‡(
îr‹
)

83 
	`˛ib_w¨nög
 ("NŸáÖlugö: %s\n", (*Ë
pi
->
«me
);

87 
d©a
 = 
	`ñf_gë_£˘i⁄_c⁄ã¡s
 (&
em
, 
£˘i⁄
->
ödex
, 1);

88 
ªg
 = (
vlib_∂ugö_ªgi°øti⁄_t
 *Ë
d©a
;

90 i‡(
	`vec_Àn
 (
d©a
Ë! (*
ªg
))

92 
	`˛ib_w¨nög
 ("vlib_plugin_registration size mismatch inÖlugin %s\n",

93 (*Ë
pi
->
«me
);

94 
îr‹
;

97 
p
 = 
	`hash_gë_mem
 (
pm
->
c⁄fig_ödex_by_«me
, 
pi
->
«me
);

98 i‡(
p
)

100 
pc
 = 
	`vec_ñt_©_ödex
 (
pm
->
c⁄figs
, 
p
[0]);

101 i‡(
pc
->
is_dißbÀd
)

103 
	`˛ib_w¨nög
 ("Plugö dißbÀd: %s", 
pi
->
«me
);

104 
îr‹
;

106 i‡(
ªg
->
deÁu…_dißbÀd
 && 
pc
->
is_íabÀd
 == 0)

108 
	`˛ib_w¨nög
 ("Plugö dißbÀd (deÁu…): %s", 
pi
->
«me
);

109 
îr‹
;

112 i‡(
ªg
->
deÁu…_dißbÀd
)

114 
	`˛ib_w¨nög
 ("Plugö dißbÀd (deÁu…): %s", 
pi
->
«me
);

115 
îr‹
;

118 
vîsi⁄_ªquúed
 = 
	`°r_¨øy_to_vec
 ((*Ë&
ªg
->version_required,

119  (
ªg
->
vîsi⁄_ªquúed
));

121 i‡((
	`°æí
 (
vîsi⁄_ªquúed
) > 0) &&

122 (
	`°∫cmp
 (
vlib_∂ugö_≠p_vîsi⁄
, 
vîsi⁄_ªquúed
,

123 
	`°æí
 (
vîsi⁄_ªquúed
))))

125 
	`˛ib_w¨nög
 ("Plugin %s version mismatch: %s != %s",

126 
pi
->
«me
, 
vlib_∂ugö_≠p_vîsi⁄
, 
ªg
->
vîsi⁄_ªquúed
);

127 i‡(!(
pc
 &&Öc->
skù_vîsi⁄_check
 == 1))

129 
	`vec_‰ì
 (
vîsi⁄_ªquúed
);

130 
îr‹
;

134 
	`vec_‰ì
 (
vîsi⁄_ªquúed
);

135 
	`vec_‰ì
 (
d©a
);

136 
	`ñf_maö_‰ì
 (&
em
);

138 
h™dÀ
 = 
	`dl›í
 ((*Ë
pi
->
fûíame
, 
RTLD_LAZY
);

140 i‡(
h™dÀ
 == 0)

142 
	`˛ib_w¨nög
 ("%s", 
	`dÀº‹
 ());

143 
	`˛ib_w¨nög
 ("FaûedÅÿlﬂdÖlugö '%s'", 
pi
->
«me
);

144 
	`os_exô
 (1);

147 
pi
->
h™dÀ
 = handle;

149 
ªg
 = 
	`dlsym
 (
pi
->
h™dÀ
, "vlib_plugin_registration");

151 i‡(
ªg
 == 0)

154 
	`˛ib_w¨nög
 ("MissögÖlugöÑegi°øti⁄ i¿∂ugö '%s'", 
pi
->
«me
);

155 
	`os_exô
 (1);

158 
pi
->
ªg
 =Ñeg;

159 
pi
->
vîsi⁄
 = 
	`°r_¨øy_to_vec
 ((*Ë&
ªg
->version,

160  (
ªg
->
vîsi⁄
));

162 i‡(
ªg
->
óæy_öô
)

164 
˛ib_îr‹_t
 *(*
ei
Ë(
vlib_maö_t
 *);

165 *
h
;

167 
h
 = 
	`dlsym
 (
pi
->
h™dÀ
, 
ªg
->
óæy_öô
);

168 i‡(
h
)

170 
ei
 = 
h
;

171 
îr‹
 = (*
ei
Ë(
pm
->
vlib_maö
);

172 i‡(
îr‹
)

174 
	`˛ib_îr‹_ªp‹t
 (
îr‹
);

175 
	`os_exô
 (1);

179 
	`˛ib_w¨nög
 ("Plugin %s:Éarly init function %s set butÇot found",

180 (*Ë
pi
->
«me
, 
ªg
->
óæy_öô
);

183 i‡(
ªg
->
des¸ùti⁄
)

184 
	`˛ib_w¨nög
 ("LﬂdedÖlugö: %†(%s)", 
pi
->
«me
, 
ªg
->
des¸ùti⁄
);

186 
	`˛ib_w¨nög
 ("LﬂdedÖlugö: %s", 
pi
->
«me
);

189 
îr‹
:

190 
	`vec_‰ì
 (
d©a
);

191 
	`ñf_maö_‰ì
 (&
em
);

193 
	}
}

195 
u8
 **

196 
	$•lô_∂ugö_∑th
 (
∂ugö_maö_t
 * 
pm
)

198 
i
;

199 
u8
 **
rv
 = 0;

200 
u8
 *
∑th
 = 
pm
->
∂ugö_∑th
;

201 
u8
 *
this
 = 0;

203 
i
 = 0; i < 
	`vec_Àn
 (
pm
->
∂ugö_∑th
); i++)

205 i‡(
∑th
[
i
] != ':')

207 
	`vec_add1
 (
this
, 
∑th
[
i
]);

210 
	`vec_add1
 (
this
, 0);

211 
	`vec_add1
 (
rv
, 
this
);

212 
this
 = 0;

214 i‡(
this
)

216 
	`vec_add1
 (
this
, 0);

217 
	`vec_add1
 (
rv
, 
this
);

219  
rv
;

220 
	}
}

223 
	$∂ugö_«me_s‹t_cmp
 (*
a1
, *
a2
)

225 
∂ugö_öfo_t
 *
p1
 = 
a1
;

226 
∂ugö_öfo_t
 *
p2
 = 
a2
;

228  
	`°rcmp
 ((*Ë
p1
->
«me
, (*Ë
p2
->name);

229 
	}
}

232 
	$vlib_lﬂd_√w_∂ugös
 (
∂ugö_maö_t
 * 
pm
, 
‰om_óæy_öô
)

234 
DIR
 *
dp
;

235 
dúít
 *
íåy
;

236 
°©
 
°©b
;

237 
uw‹d
 *
p
;

238 
∂ugö_öfo_t
 *
pi
;

239 
u8
 **
∂ugö_∑th
;

240 
u32
 *
lﬂd_Áû_ödi˚s
 = 0;

241 
i
;

243 
∂ugö_∑th
 = 
	`•lô_∂ugö_∑th
 (
pm
);

245 
i
 = 0; i < 
	`vec_Àn
 (
∂ugö_∑th
); i++)

247 
dp
 = 
	`›ídú
 ((*Ë
∂ugö_∑th
[
i
]);

249 i‡(
dp
 == 0)

252 (
íåy
 = 
	`ªaddú
 (
dp
)))

254 
u8
 *
∂ugö_«me
;

255 
u8
 *
fûíame
;

257 i‡(
pm
->
∂ugö_«me_fûãr
)

259 
j
;

260 
j
 = 0; j < 
	`vec_Àn
 (
pm
->
∂ugö_«me_fûãr
); j++)

261 i‡(
íåy
->
d_«me
[
j
] !
pm
->
∂ugö_«me_fûãr
[j])

262 
√xt
;

265 
fûíame
 = 
	`f‹m©
 (0, "%s/%s%c", 
∂ugö_∑th
[
i
], 
íåy
->
d_«me
, 0);

268 *
ext
 = 
	`°ºchr
 ((c⁄° *Ë
fûíame
, '.');

270 i‡(!
ext
 || (
	`°rcmp
 (ext, ".so") != 0) ||

271 
	`°©
 ((*Ë
fûíame
, &
°©b
) < 0)

273 
ign‹e
:

274 
	`vec_‰ì
 (
fûíame
);

279 i‡(!
	`S_ISREG
 (
°©b
.
°_mode
))

280 
ign‹e
;

282 
∂ugö_«me
 = 
	`f‹m©
 (0, "%s%c", 
íåy
->
d_«me
, 0);

284 
p
 = 
	`hash_gë_mem
 (
pm
->
∂ugö_by_«me_hash
, 
∂ugö_«me
);

285 i‡(
p
 == 0)

288 
	`vec_add2
 (
pm
->
∂ugö_öfo
, 
pi
, 1);

289 
pi
->
«me
 = 
∂ugö_«me
;

290 
pi
->
fûíame
 = filename;

291 
pi
->
fûe_öfo
 = 
°©b
;

292 
	`hash_£t_mem
 (
pm
->
∂ugö_by_«me_hash
, 
∂ugö_«me
,

293 
pi
 - 
pm
->
∂ugö_öfo
);

295 
√xt
:

298 
	`˛o£dú
 (
dp
);

299 
	`vec_‰ì
 (
∂ugö_∑th
[
i
]);

301 
	`vec_‰ì
 (
∂ugö_∑th
);

310 
	`vec_s‹t_wôh_fun˘i⁄
 (
pm
->
∂ugö_öfo
, 
∂ugö_«me_s‹t_cmp
);

315 
i
 = 0; i < 
	`vec_Àn
 (
pm
->
∂ugö_öfo
); i++)

317 
pi
 = 
	`vec_ñt_©_ödex
 (
pm
->
∂ugö_öfo
, 
i
);

319 i‡(
	`lﬂd_⁄e_∂ugö
 (
pm
, 
pi
, 
‰om_óæy_öô
))

322 
	`vec_add1
 (
lﬂd_Áû_ödi˚s
, 
i
);

323 
	`hash_un£t_mem
 (
pm
->
∂ugö_by_«me_hash
, 
pi
->
«me
);

324 
	`vec_‰ì
 (
pi
->
«me
);

325 
	`vec_‰ì
 (
pi
->
fûíame
);

330 i‡(
	`vec_Àn
 (
lﬂd_Áû_ödi˚s
) > 0)

332 
i
 = 
	`vec_Àn
 (
lﬂd_Áû_ödi˚s
) - 1; i >= 0; i--)

333 
	`vec_dñëe
 (
pm
->
∂ugö_öfo
, 1, 
lﬂd_Áû_ödi˚s
[
i
]);

334 
	`vec_‰ì
 (
lﬂd_Áû_ödi˚s
);

338 
i
 = 0; i < 
	`vec_Àn
 (
pm
->
∂ugö_öfo
); i++)

340 
pi
 = 
	`vec_ñt_©_ödex
 (
pm
->
∂ugö_öfo
, 
i
);

341 
	`hash_un£t_mem
 (
pm
->
∂ugö_by_«me_hash
, 
pi
->
«me
);

342 
	`hash_£t_mem
 (
pm
->
∂ugö_by_«me_hash
, 
pi
->
«me
,Öò-Öm->
∂ugö_öfo
);

346 
	}
}

349 
	$vlib_∂ugö_óæy_öô
 (
vlib_maö_t
 * 
vm
)

351 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

353 i‡(
pm
->
∂ugö_∑th
 == 0)

354 
pm
->
∂ugö_∑th
 = 
	`f‹m©
 (0, "%s%c", 
vlib_∂ugö_∑th
, 0);

356 
	`˛ib_w¨nög
 ("∂ugöÖ©h %s", 
pm
->
∂ugö_∑th
);

358 
pm
->
∂ugö_by_«me_hash
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

359 
pm
->
vlib_maö
 = 
vm
;

361  
	`vlib_lﬂd_√w_∂ugös
 (
pm
, 1 );

362 
	}
}

364 
u8
 *

365 
	$vlib_gë_v©_∂ugö_∑th
 ()

367 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

368  (
pm
->
v©_∂ugö_∑th
);

369 
	}
}

371 
u8
 *

372 
	$vlib_gë_v©_∂ugö_«me_fûãr
 ()

374 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

375  (
pm
->
v©_∂ugö_«me_fûãr
);

376 
	}
}

378 
˛ib_îr‹_t
 *

379 
	$vlib_∂ugös_show_cmd_‚
 (
vlib_maö_t
 * 
vm
,

380 
unf‹m©_öput_t
 * 
öput
, 
vlib_˛i_comm™d_t
 * 
cmd
)

382 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

383 
u8
 *
s
 = 0;

384 
u8
 *
key
 = 0;

385 
uw‹d
 
vÆue
 = 0;

386 
ödex
 = 1;

387 
∂ugö_öfo_t
 *
pi
;

389 
s
 = 
	`f‹m©
 (s, " PlugöÖ©h is: %s\n\n", 
pm
->
∂ugö_∑th
);

390 
s
 = 
	`f‹m©
 (s, " %-41s%-33s%s\n", "Plugin", "Version", "Description");

393 
	`hash_f‹óch_mem
 (
key
, 
vÆue
, 
pm
->
∂ugö_by_«me_hash
,

395 i‡(
key
 != 0)

397 
pi
 = 
	`vec_ñt_©_ödex
 (
pm
->
∂ugö_öfo
, 
vÆue
);

398 
s
 = 
	`f‹m©
 (s, "%3d. %-40†%-32†%s\n", 
ödex
, 
key
, 
pi
->
vîsi⁄
,

399 
pi
->
ªg
->
des¸ùti⁄
 ?Öi->reg->description : "");

400 
ödex
++;

405 
	`vlib_˛i_ouçut
 (
vm
, "%v", 
s
);

406 
	`vec_‰ì
 (
s
);

408 
	}
}

411 
VLIB_CLI_COMMAND
 (
∂ugös_show_cmd
, ) =

413 .
∑th
 = "showÖlugins",

414 .
	gsh‹t_hñp
 = "showÜoadedÖlugins",

415 .
	gfun˘i⁄
 = 
vlib_∂ugös_show_cmd_‚
,

419 
˛ib_îr‹_t
 *

420 
	$c⁄fig_⁄e_∂ugö
 (
vlib_maö_t
 * 
vm
, *
«me
, 
unf‹m©_öput_t
 * 
öput
)

422 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

423 
∂ugö_c⁄fig_t
 *
pc
;

424 
˛ib_îr‹_t
 *
îr‹
 = 0;

425 
uw‹d
 *
p
;

426 
is_íabÀ
 = 0;

427 
is_dißbÀ
 = 0;

428 
skù_vîsi⁄_check
 = 0;

430 i‡(
pm
->
c⁄fig_ödex_by_«me
 == 0)

431 
pm
->
c⁄fig_ödex_by_«me
 = 
	`hash_¸óã_°rög
 (0,  (
uw‹d
));

433 
p
 = 
	`hash_gë_mem
 (
pm
->
c⁄fig_ödex_by_«me
, 
«me
);

435 i‡(
p
)

437 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "∂ugö '%s'áÃódy c⁄figuªd", 
«me
);

438 
d⁄e
;

441 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

443 i‡(
	`unf‹m©
 (
öput
, "enable"))

444 
is_íabÀ
 = 1;

445 i‡(
	`unf‹m©
 (
öput
, "disable"))

446 
is_dißbÀ
 = 1;

447 i‡(
	`unf‹m©
 (
öput
, "skip-version-check"))

448 
skù_vîsi⁄_check
 = 1;

451 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknown input '%U'",

452 
f‹m©_unf‹m©_îr‹
, 
öput
);

453 
d⁄e
;

457 i‡(
is_íabÀ
 && 
is_dißbÀ
)

459 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "please specifyÉitherÉnable or disable"

460 " f‹Ölugö '%s'", 
«me
);

461 
d⁄e
;

464 
	`vec_add2
 (
pm
->
c⁄figs
, 
pc
, 1);

465 
	`hash_£t_mem
 (
pm
->
c⁄fig_ödex_by_«me
, 
«me
, 
pc
 -Öm->
c⁄figs
);

466 
pc
->
is_íabÀd
 = 
is_íabÀ
;

467 
pc
->
is_dißbÀd
 = 
is_dißbÀ
;

468 
pc
->
skù_vîsi⁄_check
 = skip_version_check;

469 
pc
->
«me
 =Çame;

471 
d⁄e
:

472  
îr‹
;

473 
	}
}

475 
˛ib_îr‹_t
 *

476 
	$vlib_∂ugö_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

478 
∂ugö_maö_t
 *
pm
 = &
vlib_∂ugö_maö
;

479 
˛ib_îr‹_t
 *
îr‹
 = 0;

480 
unf‹m©_öput_t
 
ö
;

482 
	`unf‹m©_öô
 (&
ö
, 0, 0);

484 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

486 
u8
 *
s
, *
v
;

487 i‡(
	`unf‹m©
 (
öput
, "%†%v", &
s
, &
v
))

489 i‡(
	`°∫cmp
 ((c⁄° *Ë
s
, "plugins", 8) == 0)

491 i‡(
	`vec_Àn
 (
ö
.
buf„r
) > 0)

492 
	`vec_add1
 (
ö
.
buf„r
, ' ');

493 
	`vec_add
 (
ö
.
buf„r
, 
v
, 
	`vec_Àn
 (v));

498 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknown input '%U'",

499 
f‹m©_unf‹m©_îr‹
, 
öput
);

500 
d⁄e
;

503 
	`vec_‰ì
 (
v
);

504 
	`vec_‰ì
 (
s
);

506 
d⁄e
:

507 
öput
 = &
ö
;

508 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

510 
unf‹m©_öput_t
 
sub_öput
;

511 
u8
 *
s
 = 0;

512 i‡(
	`unf‹m©
 (
öput
, "∑th %s", &
s
))

513 
pm
->
∂ugö_∑th
 = 
s
;

514 i‡(
	`unf‹m©
 (
öput
, "«me-fûã∏%s", &
s
))

515 
pm
->
∂ugö_«me_fûãr
 = 
s
;

516 i‡(
	`unf‹m©
 (
öput
, "v©-∑th %s", &
s
))

517 
pm
->
v©_∂ugö_∑th
 = 
s
;

518 i‡(
	`unf‹m©
 (
öput
, "v©-«me-fûã∏%s", &
s
))

519 
pm
->
v©_∂ugö_«me_fûãr
 = 
s
;

520 i‡(
	`unf‹m©
 (
öput
, "∂ugö %†%U", &
s
,

521 
unf‹m©_vlib_˛i_sub_öput
, &
sub_öput
))

523 
îr‹
 = 
	`c⁄fig_⁄e_∂ugö
 (
vm
, (*Ë
s
, &
sub_öput
);

524 
	`unf‹m©_‰ì
 (&
sub_öput
);

525 i‡(
îr‹
)

526 
d⁄e2
;

530 
îr‹
 = 
	`˛ib_îr‹_ªtu∫
 (0, "unknown input '%U'",

531 
f‹m©_unf‹m©_îr‹
, 
öput
);

533 
	`vec_‰ì
 (
s
);

534 
d⁄e2
;

539 
d⁄e2
:

540 
	`unf‹m©_‰ì
 (&
ö
);

541  
îr‹
;

542 
	}
}

546 
˛ib_îr‹_t
 *

547 
	$∂ugös_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
)

549 
u8
 *
junk
;

551 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

553 i‡(
	`unf‹m©
 (
öput
, "%s", &
junk
))

555 
	`vec_‰ì
 (
junk
);

559  
	`˛ib_îr‹_ªtu∫
 (0, "unknown input '%U'",

560 
f‹m©_unf‹m©_îr‹
, 
öput
);

563 
	}
}

565 
VLIB_CONFIG_FUNCTION
 (
∂ugös_c⁄fig
, "plugins");

	@unix/plugin.h

18 #i‚de‡
__ö˛uded_∂ugö_h__


19 
	#__ö˛uded_∂ugö_h__


	)

21 
	~<vlib/vlib.h
>

22 
	~<vlib/unix/unix.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 
	~<uni°d.h
>

60 
CLIB_PACKED
(struct {

61 
u8
 
deÁu…_dißbÀd
;

62 c⁄° 
vîsi⁄
[32];

63 c⁄° 
vîsi⁄_ªquúed
[32];

64 c⁄° *
óæy_öô
;

65 c⁄° *
des¸ùti⁄
;

66 }Ë
	tvlib_∂ugö_ªgi°øti⁄_t
;

71 
u8
 *
	m«me
;

72 
u8
 *
	mfûíame
;

73 
°©
 
	mfûe_öfo
;

74 *
	mh™dÀ
;

77 
vlib_∂ugö_ªgi°øti⁄_t
 *
	mªg
;

78 *
	mvîsi⁄
;

79 } 
	t∂ugö_öfo_t
;

83 *
	m«me
;

84 
u8
 
	mis_dißbÀd
;

85 
u8
 
	mis_íabÀd
;

86 
u8
 
	mskù_vîsi⁄_check
;

87 } 
	t∂ugö_c⁄fig_t
;

92 
∂ugö_öfo_t
 *
	m∂ugö_öfo
;

93 
uw‹d
 *
	m∂ugö_by_«me_hash
;

96 
u8
 *
	m∂ugö_∑th
;

97 
u8
 *
	m∂ugö_«me_fûãr
;

98 
u8
 *
	mv©_∂ugö_∑th
;

99 
u8
 *
	mv©_∂ugö_«me_fûãr
;

102 
∂ugö_c⁄fig_t
 *
	mc⁄figs
;

103 
uw‹d
 *
	mc⁄fig_ödex_by_«me
;

106 
vlib_maö_t
 *
	mvlib_maö
;

107 } 
	t∂ugö_maö_t
;

109 
∂ugö_maö_t
 
vlib_∂ugö_maö
;

111 
˛ib_îr‹_t
 *
vlib_∂ugö_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
);

112 
vlib_∂ugö_óæy_öô
 (
vlib_maö_t
 * 
vm
);

113 
vlib_lﬂd_√w_∂ugös
 (
∂ugö_maö_t
 * 
pm
, 
‰om_óæy_öô
);

114 *
vlib_gë_∂ugö_symbﬁ
 (*
∂ugö_«me
, *
symbﬁ_«me
);

115 
u8
 *
vlib_gë_v©_∂ugö_∑th
 ();

117 
	#VLIB_PLUGIN_REGISTER
() \

118 
vlib_∂ugö_ªgi°øti⁄_t
 
vlib_∂ugö_ªgi°øti⁄
 \

119 
	`__©åibuã__
((
	`__£˘i⁄__
(".vlib_∂ugö_ªgi°øti⁄")))

	)

122 
	#vlib_ˇŒ_∂ugö_öô_fun˘i⁄
(
vm
,
p
,
x
) \

124 
˛ib_îr‹_t
 *(*
_f
)(
vlib_maö_t
 *); \

125 
uw‹d
 *
_Âå
 = 0; \

126 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

127 
_Âå

vlib_gë_∂ugö_symbﬁ
 \

128 (
p
, 
	`CLIB_STRING_MACRO
(
_vlib_öô_fun˘i⁄_
##
x
)); \

129 i‡(
_Âå
 == 0) \

131 
_îr‹
 = 
˛ib_îr‹_ªtu∫
 \

133 
p
, 
	`CLIB_STRING_MACRO
(
_vlib_öô_fun˘i⁄_
##
x
)); \

137 
_f
 = (*)(
_Âå
[0]); \

139 i‡(
_Âå
 && ! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

141 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

142 
_îr‹
 = 
	`_f
 (
vm
); \

144 
_îr‹
; \

145 })

	)

	@unix/unix.h

40 #i‚de‡
ö˛uded_unix_unix_h


41 
	#ö˛uded_unix_unix_h


	)

43 
	~<vµö‰a/fûe.h
>

44 
	~<vµö‰a/sockë.h
>

45 
	~<ãrmios.h
>

49 
f64
 
	mtime
;

50 
˛ib_îr‹_t
 *
	mîr‹
;

51 } 
	tunix_îr‹_hi°‹y_t
;

56 
vlib_maö_t
 *
	mvlib_maö
;

58 
u32
 
	mÊags
;

60 
	#UNIX_FLAG_INTERACTIVE
 (1 << 0)

	)

61 
	#UNIX_FLAG_NODAEMON
 (1 << 1)

	)

64 
˛ib_sockë_t
 
	m˛i_li°í_sockë
;

67 
unix_îr‹_hi°‹y_t
 
	mîr‹_hi°‹y
[128];

68 
u32
 
	mîr‹_hi°‹y_ödex
;

69 
u64
 
	mn_tŸÆ_îr‹s
;

72 
u8
 *
	m°¨tup_c⁄fig_fûíame
;

75 
u8
 *
	mru¡ime_dú
;

78 
u8
 *
	mpidfûe
;

81 vﬁ©ûê
	munix_c⁄fig_com∂ëe
;

84 
u8
 *
	mlog_fûíame
;

85 
	mlog_fd
;

88 
	m˛i_löe_mode
;

91 
u32
 
	m˛i_hi°‹y_limô
;

94 
	m˛i_no_b™√r
;

97 
u32
 
	m˛i_∑gî_buf„r_limô
;

100 
	m˛i_no_∑gî
;

103 
ãrmios
 
	mtio_°dö
;

104 
	mtio_is£t
;

105 } 
	tunix_maö_t
;

108 
unix_maö_t
 
unix_maö
;

109 
˛ib_fûe_maö_t
 
fûe_maö
;

111 
Æways_ölöe
 

112 
	$unix_ßve_îr‹
 (
unix_maö_t
 * 
um
, 
˛ib_îr‹_t
 * 
îr‹
)

114 
unix_îr‹_hi°‹y_t
 *
eh
 = 
um
->
îr‹_hi°‹y
 + um->
îr‹_hi°‹y_ödex
;

115 
	`˛ib_îr‹_‰ì_ve˘‹
 (
eh
->
îr‹
);

116 
eh
->
îr‹
 =Érror;

117 
eh
->
time
 = 
	`vlib_time_now
 (
um
->
vlib_maö
);

118 
um
->
n_tŸÆ_îr‹s
 += 1;

119 i‡(++
um
->
îr‹_hi°‹y_ödex
 >
	`ARRAY_LEN
 (um->
îr‹_hi°‹y
))

120 
um
->
îr‹_hi°‹y_ödex
 = 0;

121 
	}
}

124 
vlib_unix_maö
 (
¨gc
, *
¨gv
[]);

126 
˛ib_îr‹_t
 *
unix_physmem_öô
 (
vlib_maö_t
 * 
vm
);

129 
vlib_unix_˛i_£t_¥om±
 (*
¥om±
);

131 
ölöe
 
unix_maö_t
 *

132 
	$vlib_unix_gë_maö
 ()

134  &
unix_maö
;

135 
	}
}

137 
ölöe
 *

138 
	$vlib_unix_gë_ru¡ime_dú
 ()

140  (*Ë
unix_maö
.
ru¡ime_dú
;

141 
	}
}

144 
u8
 **
vlib_thªad_°acks
;

148 
˛ib_îr‹_t
 *
f‹óch_dúe˘‹y_fûe
 (*
dú_«me
,

149 
˛ib_îr‹_t
 * (*
f
Ë(*
¨g
,

150 
u8
 * 
∑th_«me
,

151 
u8
 * 
fûe_«me
),

152 *
¨g
, 
sˇn_dús
);

154 
˛ib_îr‹_t
 *
vlib_unix_ªcursive_mkdú
 (*
∑th
);

156 
˛ib_îr‹_t
 *
vlib_unix_vÆid©e_ru¡ime_fûe
 (
unix_maö_t
 * 
um
,

157 c⁄° *
∑th
,

158 
u8
 ** 
fuŒ_∑th
);

	@unix/util.c

40 
	~<vlib/vlib.h
>

41 
	~<vlib/unix/unix.h
>

43 
	~<sys/ty≥s.h
>

44 
	~<sys/°©.h
>

45 
	~<f˙é.h
>

46 
	~<dúít.h
>

48 
˛ib_îr‹_t
 *

49 
	$f‹óch_dúe˘‹y_fûe
 (*
dú_«me
,

50 
˛ib_îr‹_t
 * (*
f
Ë(*
¨g
, 
u8
 * 
∑th_«me
,

51 
u8
 * 
fûe_«me
), *
¨g
,

52 
sˇn_dús
)

54 
DIR
 *
d
;

55 
dúít
 *
e
;

56 
˛ib_îr‹_t
 *
îr‹
 = 0;

57 
u8
 *
s
, *
t
;

59 
d
 = 
	`›ídú
 (
dú_«me
);

60 i‡(!
d
)

62 i‡(
î∫o
 =
ENOENT
)

64  
	`˛ib_îr‹_ªtu∫_unix
 (0, "›í `%s'", 
dú_«me
);

67 
s
 = 
t
 = 0;

70 
e
 = 
	`ªaddú
 (
d
);

71 i‡(!
e
)

73 i‡(
sˇn_dús
)

75 i‡(
e
->
d_ty≥
 =
DT_DIR


76 && (!
	`°rcmp
 (
e
->
d_«me
, ".") || !strcmp (e->d_name, "..")))

81 i‡(
e
->
d_ty≥
 =
DT_DIR
)

85 
s
 = 
	`f‹m©
 (s, "%s/%s", 
dú_«me
, 
e
->
d_«me
);

86 
t
 = 
	`f‹m©
 (t, "%s", 
e
->
d_«me
);

87 
îr‹
 = 
	`f
 (
¨g
, 
s
, 
t
);

88 
	`_vec_Àn
 (
s
) = 0;

89 
	`_vec_Àn
 (
t
) = 0;

91 i‡(
îr‹
)

95 
	`vec_‰ì
 (
s
);

96 
	`˛o£dú
 (
d
);

98  
îr‹
;

99 
	}
}

101 
˛ib_îr‹_t
 *

102 
	$vlib_unix_ªcursive_mkdú
 (*
∑th
)

104 
˛ib_îr‹_t
 *
îr‹
 = 0;

105 *
c
 = 0;

106 
i
 = 0;

108 
∑th
[
i
] != 0)

110 i‡(
c
 && 
∑th
[
i
] == '/')

112 
	`vec_add1
 (
c
, 0);

113 i‡((
	`mkdú
 (
c
, 0755)Ë&& (
î∫o
 !
EEXIST
))

115 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "mkdú '%s'", 
c
);

116 
d⁄e
;

118 
	`_vec_Àn
 (
c
)--;

120 
	`vec_add1
 (
c
, 
∑th
[
i
]);

121 
i
++;

124 i‡((
	`mkdú
 (
∑th
, 0755)Ë&& (
î∫o
 !
EEXIST
))

126 
îr‹
 = 
	`˛ib_îr‹_ªtu∫_unix
 (0, "mkdú '%s'", 
∑th
);

127 
d⁄e
;

130 
d⁄e
:

131 
	`vec_‰ì
 (
c
);

133  
îr‹
;

134 
	}
}

136 
˛ib_îr‹_t
 *

137 
	$vlib_unix_vÆid©e_ru¡ime_fûe
 (
unix_maö_t
 * 
um
,

138 c⁄° *
∑th
, 
u8
 ** 
fuŒ_∑th
)

140 
u8
 *
Â
 = 0;

141 *
œ°_¶ash
 = 0;

143 i‡(
∑th
[0] == '\0')

145  
	`˛ib_îr‹_ªtu∫
 (0, "path isánÉmpty string");

147 i‡(
	`°∫cmp
 (
∑th
, "../", 3Ë=0 || 
	`°r°r
 (path, "/../"))

149  
	`˛ib_îr‹_ªtu∫
 (0, "'..'Çotállowed inÑuntimeÖath");

151 i‡(
∑th
[0] == '/')

154 i‡(
	`°∫cmp
 ((*Ë
um
->
ru¡ime_dú
, 
∑th
,

155 
	`°æí
 ((*Ë
um
->
ru¡ime_dú
)))

157  
	`˛ib_îr‹_ªtu∫
 (0,

159 
∑th
, 
um
->
ru¡ime_dú
);

161 
Â
 = 
	`f‹m©
 (0, "%s%c", 
∑th
, '\0');

166 
Â
 = 
	`f‹m©
 (0, "%s/%s%c", 
um
->
ru¡ime_dú
, 
∑th
, '\0');

170 i‡((
œ°_¶ash
 = 
	`°ºchr
 ((*Ë
Â
, '/')Ë!
NULL
)

171 *
œ°_¶ash
 = '\0';

173 
˛ib_îr‹_t
 *
îr‹
 = 
	`vlib_unix_ªcursive_mkdú
 ((*Ë
Â
);

175 i‡(
œ°_¶ash
 !
NULL
)

176 *
œ°_¶ash
 = '/';

178 i‡(
îr‹
)

179 
	`vec_‰ì
 (
Â
);

181 *
fuŒ_∑th
 = 
Â
;

182  
îr‹
;

183 
	}
}

	@vlib.h

40 #i‚de‡
ö˛uded_vlib_h


41 
	#ö˛uded_vlib_h


	)

43 
	~<vµö‰a/˛ib.h
>

44 
	~<vµö‰a/ñf_˛ib.h
>

47 
	~<vlib/defs.h
>

50 
	gvlib_maö_t
;

53 
	~<vlib/physmem.h
>

54 
	~<vlib/buf„r.h
>

55 
	~<vlib/˛i.h
>

56 
	~<vlib/cou¡î.h
>

57 
	~<vlib/îr‹.h
>

58 
	~<vlib/öô.h
>

59 
	~<vlib/mc.h
>

60 
	~<vlib/node.h
>

61 
	~<vlib/åa˚.h
>

64 
	~<vlib/maö.h
>

67 
	~<vlib/thªads.h
>

68 
	~<vlib/physmem_funcs.h
>

69 
	~<vlib/buf„r_funcs.h
>

70 
	~<vlib/˛i_funcs.h
>

71 
	~<vlib/îr‹_funcs.h
>

72 
	~<vlib/f‹m©_funcs.h
>

73 
	~<vlib/node_funcs.h
>

74 
	~<vlib/åa˚_funcs.h
>

75 
	~<vlib/globÆ_funcs.h
>

77 
	~<vlib/buf„r_node.h
>

	@vlib_process_doc.h

16 #îr‹ dÿ
nŸ
 #ö˛udê
this
 
fûe
!

	@/usr/include/arpa/telnet.h

32 #i‚de‡
_ARPA_TELNET_H


33 
	#_ARPA_TELNET_H
 1

	)

38 
	#IAC
 255

	)

39 
	#DONT
 254

	)

40 
	#DO
 253

	)

41 
	#WONT
 252

	)

42 
	#WILL
 251

	)

43 
	#SB
 250

	)

44 
	#GA
 249

	)

45 
	#EL
 248

	)

46 
	#EC
 247

	)

47 
	#AYT
 246

	)

48 
	#AO
 245

	)

49 
	#IP
 244

	)

50 
	#BREAK
 243

	)

51 
	#DM
 242

	)

52 
	#NOP
 241

	)

53 
	#SE
 240

	)

54 
	#EOR
 239

	)

55 
	#ABORT
 238

	)

56 
	#SUSP
 237

	)

57 
	#xEOF
 236

	)

59 
	#SYNCH
 242

	)

61 #ifde‡
TELCMDS


62 *
	gãlcmds
[] = {

68 *
ãlcmds
[];

71 
	#TELCMD_FIRST
 
xEOF


	)

72 
	#TELCMD_LAST
 
IAC


	)

73 
	#TELCMD_OK
(
x
Ë(()(xË<
TELCMD_LAST
 && \

74 ()(
x
Ë>
TELCMD_FIRST
)

	)

75 
	#TELCMD
(
x
Ë
ãlcmds
[(x)-
TELCMD_FIRST
]

	)

78 
	#TELOPT_BINARY
 0

	)

79 
	#TELOPT_ECHO
 1

	)

80 
	#TELOPT_RCP
 2

	)

81 
	#TELOPT_SGA
 3

	)

82 
	#TELOPT_NAMS
 4

	)

83 
	#TELOPT_STATUS
 5

	)

84 
	#TELOPT_TM
 6

	)

85 
	#TELOPT_RCTE
 7

	)

86 
	#TELOPT_NAOL
 8

	)

87 
	#TELOPT_NAOP
 9

	)

88 
	#TELOPT_NAOCRD
 10

	)

89 
	#TELOPT_NAOHTS
 11

	)

90 
	#TELOPT_NAOHTD
 12

	)

91 
	#TELOPT_NAOFFD
 13

	)

92 
	#TELOPT_NAOVTS
 14

	)

93 
	#TELOPT_NAOVTD
 15

	)

94 
	#TELOPT_NAOLFD
 16

	)

95 
	#TELOPT_XASCII
 17

	)

96 
	#TELOPT_LOGOUT
 18

	)

97 
	#TELOPT_BM
 19

	)

98 
	#TELOPT_DET
 20

	)

99 
	#TELOPT_SUPDUP
 21

	)

100 
	#TELOPT_SUPDUPOUTPUT
 22

	)

101 
	#TELOPT_SNDLOC
 23

	)

102 
	#TELOPT_TTYPE
 24

	)

103 
	#TELOPT_EOR
 25

	)

104 
	#TELOPT_TUID
 26

	)

105 
	#TELOPT_OUTMRK
 27

	)

106 
	#TELOPT_TTYLOC
 28

	)

107 
	#TELOPT_3270REGIME
 29

	)

108 
	#TELOPT_X3PAD
 30

	)

109 
	#TELOPT_NAWS
 31

	)

110 
	#TELOPT_TSPEED
 32

	)

111 
	#TELOPT_LFLOW
 33

	)

112 
	#TELOPT_LINEMODE
 34

	)

113 
	#TELOPT_XDISPLOC
 35

	)

114 
	#TELOPT_OLD_ENVIRON
 36

	)

115 
	#TELOPT_AUTHENTICATION
 37

	)

116 
	#TELOPT_ENCRYPT
 38

	)

117 
	#TELOPT_NEW_ENVIRON
 39

	)

118 
	#TELOPT_EXOPL
 255

	)

121 
	#NTELOPTS
 (1+
TELOPT_NEW_ENVIRON
)

	)

122 #ifde‡
TELOPTS


123 *
	gãl›ts
[
NTELOPTS
+1] = {

136 
	#TELOPT_FIRST
 
TELOPT_BINARY


	)

137 
	#TELOPT_LAST
 
TELOPT_NEW_ENVIRON


	)

138 
	#TELOPT_OK
(
x
Ë(()(xË<
TELOPT_LAST
)

	)

139 
	#TELOPT
(
x
Ë
ãl›ts
[(x)-
TELOPT_FIRST
]

	)

143 
	#TELQUAL_IS
 0

	)

144 
	#TELQUAL_SEND
 1

	)

145 
	#TELQUAL_INFO
 2

	)

146 
	#TELQUAL_REPLY
 2

	)

147 
	#TELQUAL_NAME
 3

	)

149 
	#LFLOW_OFF
 0

	)

150 
	#LFLOW_ON
 1

	)

151 
	#LFLOW_RESTART_ANY
 2

	)

152 
	#LFLOW_RESTART_XON
 3

	)

158 
	#LM_MODE
 1

	)

159 
	#LM_FORWARDMASK
 2

	)

160 
	#LM_SLC
 3

	)

162 
	#MODE_EDIT
 0x01

	)

163 
	#MODE_TRAPSIG
 0x02

	)

164 
	#MODE_ACK
 0x04

	)

165 
	#MODE_SOFT_TAB
 0x08

	)

166 
	#MODE_LIT_ECHO
 0x10

	)

168 
	#MODE_MASK
 0x1f

	)

171 
	#MODE_FLOW
 0x0100

	)

172 
	#MODE_ECHO
 0x0200

	)

173 
	#MODE_INBIN
 0x0400

	)

174 
	#MODE_OUTBIN
 0x0800

	)

175 
	#MODE_FORCE
 0x1000

	)

177 
	#SLC_SYNCH
 1

	)

178 
	#SLC_BRK
 2

	)

179 
	#SLC_IP
 3

	)

180 
	#SLC_AO
 4

	)

181 
	#SLC_AYT
 5

	)

182 
	#SLC_EOR
 6

	)

183 
	#SLC_ABORT
 7

	)

184 
	#SLC_EOF
 8

	)

185 
	#SLC_SUSP
 9

	)

186 
	#SLC_EC
 10

	)

187 
	#SLC_EL
 11

	)

188 
	#SLC_EW
 12

	)

189 
	#SLC_RP
 13

	)

190 
	#SLC_LNEXT
 14

	)

191 
	#SLC_XON
 15

	)

192 
	#SLC_XOFF
 16

	)

193 
	#SLC_FORW1
 17

	)

194 
	#SLC_FORW2
 18

	)

196 
	#NSLC
 18

	)

202 
	#SLC_NAMELIST
 "0", "SYNCH", "BRK", "IP", "AO", "AYT", "EOR", \

204 "LNEXT", "XON", "XOFF", "FORW1", "FORW2", 0,

	)

205 #ifdef 
SLC_NAMES


206 *
	g¶c_«mes
[] = {

207 
SLC_NAMELIST


210 *
¶c_«mes
[];

211 
	#SLC_NAMES
 
SLC_NAMELIST


	)

214 
	#SLC_NAME_OK
(
x
Ë(()(xË<
NSLC
)

	)

215 
	#SLC_NAME
(
x
Ë
¶c_«mes
[x]

	)

217 
	#SLC_NOSUPPORT
 0

	)

218 
	#SLC_CANTCHANGE
 1

	)

219 
	#SLC_VARIABLE
 2

	)

220 
	#SLC_DEFAULT
 3

	)

221 
	#SLC_LEVELBITS
 0x03

	)

223 
	#SLC_FUNC
 0

	)

224 
	#SLC_FLAGS
 1

	)

225 
	#SLC_VALUE
 2

	)

227 
	#SLC_ACK
 0x80

	)

228 
	#SLC_FLUSHIN
 0x40

	)

229 
	#SLC_FLUSHOUT
 0x20

	)

231 
	#OLD_ENV_VAR
 1

	)

232 
	#OLD_ENV_VALUE
 0

	)

233 
	#NEW_ENV_VAR
 0

	)

234 
	#NEW_ENV_VALUE
 1

	)

235 
	#ENV_ESC
 2

	)

236 
	#ENV_USERVAR
 3

	)

245 
	#AUTH_WHO_CLIENT
 0

	)

246 
	#AUTH_WHO_SERVER
 1

	)

247 
	#AUTH_WHO_MASK
 1

	)

252 
	#AUTH_HOW_ONE_WAY
 0

	)

253 
	#AUTH_HOW_MUTUAL
 2

	)

254 
	#AUTH_HOW_MASK
 2

	)

256 
	#AUTHTYPE_NULL
 0

	)

257 
	#AUTHTYPE_KERBEROS_V4
 1

	)

258 
	#AUTHTYPE_KERBEROS_V5
 2

	)

259 
	#AUTHTYPE_SPX
 3

	)

260 
	#AUTHTYPE_MINK
 4

	)

261 
	#AUTHTYPE_CNT
 5

	)

263 
	#AUTHTYPE_TEST
 99

	)

265 #ifdef 
AUTH_NAMES


266 *
	gauthty≥_«mes
[] = {

270 *
authty≥_«mes
[];

273 
	#AUTHTYPE_NAME_OK
(
x
Ë(()(xË< 
AUTHTYPE_CNT
)

	)

274 
	#AUTHTYPE_NAME
(
x
Ë
authty≥_«mes
[x]

	)

279 
	#ENCRYPT_IS
 0

	)

280 
	#ENCRYPT_SUPPORT
 1

	)

281 
	#ENCRYPT_REPLY
 2

	)

282 
	#ENCRYPT_START
 3

	)

283 
	#ENCRYPT_END
 4

	)

284 
	#ENCRYPT_REQSTART
 5

	)

285 
	#ENCRYPT_REQEND
 6

	)

286 
	#ENCRYPT_ENC_KEYID
 7

	)

287 
	#ENCRYPT_DEC_KEYID
 8

	)

288 
	#ENCRYPT_CNT
 9

	)

290 
	#ENCTYPE_ANY
 0

	)

291 
	#ENCTYPE_DES_CFB64
 1

	)

292 
	#ENCTYPE_DES_OFB64
 2

	)

293 
	#ENCTYPE_CNT
 3

	)

295 #ifdef 
ENCRYPT_NAMES


296 *
	gí¸y±_«mes
[] = {

301 *
	gí˘y≥_«mes
[] = {

305 *
í¸y±_«mes
[];

306 *
í˘y≥_«mes
[];

310 
	#ENCRYPT_NAME_OK
(
x
Ë(()(xË< 
ENCRYPT_CNT
)

	)

311 
	#ENCRYPT_NAME
(
x
Ë
í¸y±_«mes
[x]

	)

313 
	#ENCTYPE_NAME_OK
(
x
Ë(()(xË< 
ENCTYPE_CNT
)

	)

314 
	#ENCTYPE_NAME
(
x
Ë
í˘y≥_«mes
[x]

	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__ex˘y≥
 (
iß um
);

111 
__ex˘y≥
 (
ißÕha
);

112 
__ex˘y≥
 (
is˙ål
);

113 
__ex˘y≥
 (
isdigô
);

114 
__ex˘y≥
 (
i¶owî
);

115 
__ex˘y≥
 (
isgøph
);

116 
__ex˘y≥
 (
i•röt
);

117 
__ex˘y≥
 (
i•un˘
);

118 
__ex˘y≥
 (
is•a˚
);

119 
__ex˘y≥
 (
isuµî
);

120 
__ex˘y≥
 (
isxdigô
);

124 
	$tﬁowî
 (
__c
Ë
__THROW
;

127 
	$touµî
 (
__c
Ë
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__ex˘y≥
 (
isbœnk
);

138 
__END_NAMESPACE_C99


141 #ifde‡
__USE_GNU


143 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

146 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


150 
	$ißscii
 (
__c
Ë
__THROW
;

154 
	$tﬂscii
 (
__c
Ë
__THROW
;

158 
	`__ex˘y≥
 (
_touµî
);

159 
	`__ex˘y≥
 (
_tﬁowî
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

164 (
__exãnsi⁄__
 \

165 ({ 
__ªs
; \

166 i‡( (
c
) > 1) \

168 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

174 
__ªs
 = 
f
 
¨gs
; \

177 
__ªs
 = (
a
)[(Ë(
c
)]; \

178 
__ªs
; 
	}
}))

	)

180 #i‡!
deföed
 
__NO_CTYPE


181 #ifde‡
__is˘y≥_f


182 
	$__is˘y≥_f
 (
Ænum
)

183 
	$__is˘y≥_f
 (
Æpha
)

184 
	$__is˘y≥_f
 (
˙ål
)

185 
	$__is˘y≥_f
 (
digô
)

186 
	$__is˘y≥_f
 (
lowî
)

187 
	$__is˘y≥_f
 (
gøph
)

188 
	$__is˘y≥_f
 (
¥öt
)

189 
	$__is˘y≥_f
 (
pun˘
)

190 
	$__is˘y≥_f
 (
•a˚
)

191 
	$__is˘y≥_f
 (
uµî
)

192 
	$__is˘y≥_f
 (
xdigô
)

193 #ifde‡
__USE_ISOC99


194 
	$__is˘y≥_f
 (
bœnk
)

196 #ñi‡
deföed
 
__is˘y≥


197 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

198 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

199 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

200 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

201 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

202 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

203 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

204 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

205 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

206 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

207 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

208 #ifde‡
__USE_ISOC99


209 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

213 #ifde‡
__USE_EXTERN_INLINES


214 
__exã∫_ölöe
 

215 
	`__NTH
 (
	$tﬁowî
 (
__c
))

217  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

218 
	}
}

220 
__exã∫_ölöe
 

221 
__NTH
 (
	$touµî
 (
__c
))

223  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

224 
	}
}

227 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


228 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

229 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

232 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


233 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

234 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

236 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

237 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

243 #ifde‡
__USE_XOPEN2K8


257 
	~<xloˇÀ.h
>

261 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

262 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

264 
	#__ex˘y≥_l
(
«me
) \

265 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

271 
__ex˘y≥_l
 (
iß um_l
);

272 
__ex˘y≥_l
 (
ißÕha_l
);

273 
__ex˘y≥_l
 (
is˙ål_l
);

274 
__ex˘y≥_l
 (
isdigô_l
);

275 
__ex˘y≥_l
 (
i¶owî_l
);

276 
__ex˘y≥_l
 (
isgøph_l
);

277 
__ex˘y≥_l
 (
i•röt_l
);

278 
__ex˘y≥_l
 (
i•un˘_l
);

279 
__ex˘y≥_l
 (
is•a˚_l
);

280 
__ex˘y≥_l
 (
isuµî_l
);

281 
__ex˘y≥_l
 (
isxdigô_l
);

283 
__ex˘y≥_l
 (
isbœnk_l
);

287 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

288 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

291 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

292 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


295 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

296 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

297 
	#__touµî_l
(
c
, 
loˇÀ
) \

298 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

299 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

300 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

304 #i‚de‡
__NO_CTYPE


305 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

306 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

307 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

308 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

309 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

310 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

311 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

312 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

313 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

314 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

315 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

317 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

319 #ifde‡
__USE_MISC


320 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

321 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

324 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

325 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

326 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

327 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

328 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

329 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

330 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

331 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

332 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

333 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

334 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

336 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

338 #ifde‡
__USE_MISC


339 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

340 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/dirent.h

22 #i‚def 
_DIRENT_H


23 
	#_DIRENT_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 #ifde‡
__USE_XOPEN


32 #i‚de‡
__öo_t_deföed


33 #i‚de‡
__USE_FILE_OFFSET64


34 
__öo_t
 
	töo_t
;

36 
__öo64_t
 
	töo_t
;

38 
	#__öo_t_deföed


	)

40 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


41 
__öo64_t
 
	töo64_t
;

42 
	#__öo64_t_deföed


	)

61 
	~<bôs/dúít.h
>

63 #i‡
deföed
 
__USE_MISC
 && !deföed 
d_fûío


64 
	#d_öo
 
d_fûío


	)

81 #ifde‡
_DIRENT_HAVE_D_NAMLEN


82 
	#_D_EXACT_NAMLEN
(
d
Ë((d)->
d_«mÀn
)

	)

83 
	#_D_ALLOC_NAMLEN
(
d
Ë(
	`_D_EXACT_NAMLEN
 (dË+ 1)

	)

85 
	#_D_EXACT_NAMLEN
(
d
Ë(
	`°æí
 ((d)->
d_«me
))

	)

86 #ifde‡
_DIRENT_HAVE_D_RECLEN


87 
	#_D_ALLOC_NAMLEN
(
d
Ë(((*Ë(dË+ (d)->
d_ª˛í
Ë- &(d)->
d_«me
[0])

	)

89 
	#_D_ALLOC_NAMLEN
(
d
Ë( (d)->
d_«me
 > 1 ?  (d)->d_name : \

90 
	`_D_EXACT_NAMLEN
 (
d
Ë+ 1)

	)

95 #ifde‡
__USE_MISC


99 
	mDT_UNKNOWN
 = 0,

100 
	#DT_UNKNOWN
 
DT_UNKNOWN


	)

101 
	mDT_FIFO
 = 1,

102 
	#DT_FIFO
 
DT_FIFO


	)

103 
	mDT_CHR
 = 2,

104 
	#DT_CHR
 
DT_CHR


	)

105 
	mDT_DIR
 = 4,

106 
	#DT_DIR
 
DT_DIR


	)

107 
	mDT_BLK
 = 6,

108 
	#DT_BLK
 
DT_BLK


	)

109 
	mDT_REG
 = 8,

110 
	#DT_REG
 
DT_REG


	)

111 
	mDT_LNK
 = 10,

112 
	#DT_LNK
 
DT_LNK


	)

113 
	mDT_SOCK
 = 12,

114 
	#DT_SOCK
 
DT_SOCK


	)

115 
	mDT_WHT
 = 14

116 
	#DT_WHT
 
DT_WHT


	)

120 
	#IFTODT
(
mode
Ë(((modeË& 0170000Ë>> 12)

	)

121 
	#DTTOIF
(
dúty≥
Ë((dúty≥Ë<< 12)

	)

127 
__dú°ªam
 
	tDIR
;

134 
DIR
 *
	$›ídú
 (c⁄° *
__«me
Ë
	`__n⁄nuŒ
 ((1));

136 #ifde‡
__USE_XOPEN2K8


141 
DIR
 *
	`fd›ídú
 (
__fd
);

149 
	$˛o£dú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

161 #i‚de‡
__USE_FILE_OFFSET64


162 
dúít
 *
	$ªaddú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

164 #ifde‡
__REDIRECT


165 
dúít
 *
	`__REDIRECT
 (
ªaddú
, (
DIR
 *
__dúp
), 
ªaddú64
)

166 
	`__n⁄nuŒ
 ((1));

168 
	#ªaddú
 
ªaddú64


	)

172 #ifde‡
__USE_LARGEFILE64


173 
dúít64
 *
	$ªaddú64
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

176 #ifde‡
__USE_POSIX


182 #i‚de‡
__USE_FILE_OFFSET64


183 
	$ªaddú_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

184 
dúít
 *
__ª°ri˘
 
__íåy
,

185 
dúít
 **
__ª°ri˘
 
__ªsu…
)

186 
	`__n⁄nuŒ
 ((1, 2, 3));

188 #ifde‡
__REDIRECT


189 
	`__REDIRECT
 (
ªaddú_r
,

190 (
DIR
 *
__ª°ri˘
 
__dúp
,

191 
dúít
 *
__ª°ri˘
 
__íåy
,

192 
dúít
 **
__ª°ri˘
 
__ªsu…
),

193 
ªaddú64_r
Ë
	`__n⁄nuŒ
 ((1, 2, 3));

195 
	#ªaddú_r
 
ªaddú64_r


	)

199 #ifde‡
__USE_LARGEFILE64


200 
	$ªaddú64_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

201 
dúít64
 *
__ª°ri˘
 
__íåy
,

202 
dúít64
 **
__ª°ri˘
 
__ªsu…
)

203 
	`__n⁄nuŒ
 ((1, 2, 3));

208 
	$ªwöddú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

210 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


211 
	~<bôs/ty≥s.h
>

214 
	$£ekdú
 (
DIR
 *
__dúp
, 
__pos
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
	$ãŒdú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

220 #ifde‡
__USE_XOPEN2K8


223 
	$dúfd
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 #i‡
deföed
 
__OPTIMIZE__
 && deföed 
_DIR_dúfd


226 
	#dúfd
(
dúp
Ë
	`_DIR_dúfd
 (dúp)

	)

229 #ifde‡
__USE_MISC


230 #i‚de‡
MAXNAMLEN


232 
	~<bôs/posix1_lim.h
>

235 #ifde‡
NAME_MAX


236 
	#MAXNAMLEN
 
NAME_MAX


	)

238 
	#MAXNAMLEN
 255

	)

243 
	#__√ed_size_t


	)

244 
	~<°ddef.h
>

253 #i‚de‡
__USE_FILE_OFFSET64


254 
	$sˇndú
 (c⁄° *
__ª°ri˘
 
__dú
,

255 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

256 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

257 (*
__cmp
Ë(c⁄° 
dúít
 **,

258 c⁄° 
dúít
 **))

259 
	`__n⁄nuŒ
 ((1, 2));

261 #ifde‡
__REDIRECT


262 
	`__REDIRECT
 (
sˇndú
,

263 (c⁄° *
__ª°ri˘
 
__dú
,

264 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

265 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

266 (*
__cmp
Ë(c⁄° 
dúít
 **,

267 c⁄° 
dúít
 **)),

268 
sˇndú64
Ë
	`__n⁄nuŒ
 ((1, 2));

270 
	#sˇndú
 
sˇndú64


	)

274 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


277 
	$sˇndú64
 (c⁄° *
__ª°ri˘
 
__dú
,

278 
dúít64
 ***
__ª°ri˘
 
__«mñi°
,

279 (*
__£À˘‹
Ë(c⁄° 
dúít64
 *),

280 (*
__cmp
Ë(c⁄° 
dúít64
 **,

281 c⁄° 
dúít64
 **))

282 
	`__n⁄nuŒ
 ((1, 2));

285 #ifde‡
__USE_GNU


291 #i‚de‡
__USE_FILE_OFFSET64


292 
	$sˇndú©
 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

293 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

294 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

295 (*
__cmp
Ë(c⁄° 
dúít
 **,

296 c⁄° 
dúít
 **))

297 
	`__n⁄nuŒ
 ((2, 3));

299 #ifde‡
__REDIRECT


300 
	`__REDIRECT
 (
sˇndú©
,

301 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

302 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

303 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

304 (*
__cmp
Ë(c⁄° 
dúít
 **,

305 c⁄° 
dúít
 **)),

306 
sˇndú©64
Ë
	`__n⁄nuŒ
 ((2, 3));

308 
	#sˇndú©
 
sˇndú©64


	)

314 
	$sˇndú©64
 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

315 
dúít64
 ***
__ª°ri˘
 
__«mñi°
,

316 (*
__£À˘‹
Ë(c⁄° 
dúít64
 *),

317 (*
__cmp
Ë(c⁄° 
dúít64
 **,

318 c⁄° 
dúít64
 **))

319 
	`__n⁄nuŒ
 ((2, 3));

323 #i‚de‡
__USE_FILE_OFFSET64


324 
	$Æphas‹t
 (c⁄° 
dúít
 **
__e1
,

325 c⁄° 
dúít
 **
__e2
)

326 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

328 #ifde‡
__REDIRECT


329 
	`__REDIRECT_NTH
 (
Æphas‹t
,

330 (c⁄° 
dúít
 **
__e1
,

331 c⁄° 
dúít
 **
__e2
),

332 
Æphas‹t64
Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

334 
	#Æphas‹t
 
Æphas‹t64


	)

338 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


339 
	$Æphas‹t64
 (c⁄° 
dúít64
 **
__e1
,

340 c⁄° 
dúít64
 **
__e2
)

341 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

346 #ifde‡
__USE_MISC


351 #i‚de‡
__USE_FILE_OFFSET64


352 
__ssize_t
 
	$gëdúíåõs
 (
__fd
, *
__ª°ri˘
 
__buf
,

353 
size_t
 
__nbyãs
,

354 
__off_t
 *
__ª°ri˘
 
__ba£p
)

355 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

357 #ifde‡
__REDIRECT


358 
__ssize_t
 
	`__REDIRECT_NTH
 (
gëdúíåõs
,

359 (
__fd
, *
__ª°ri˘
 
__buf
,

360 
size_t
 
__nbyãs
,

361 
__off64_t
 *
__ª°ri˘
 
__ba£p
),

362 
gëdúíåõs64
Ë
	`__n⁄nuŒ
 ((2, 4));

364 
	#gëdúíåõs
 
gëdúíåõs64


	)

368 #ifde‡
__USE_LARGEFILE64


369 
__ssize_t
 
	$gëdúíåõs64
 (
__fd
, *
__ª°ri˘
 
__buf
,

370 
size_t
 
__nbyãs
,

371 
__off64_t
 *
__ª°ri˘
 
__ba£p
)

372 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

376 #ifde‡
__USE_GNU


378 #i‚de‡
__USE_FILE_OFFSET64


379 
	$vîsi⁄s‹t
 (c⁄° 
dúít
 **
__e1
,

380 c⁄° 
dúít
 **
__e2
)

381 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

383 #ifde‡
__REDIRECT


384 
	`__REDIRECT_NTH
 (
vîsi⁄s‹t
,

385 (c⁄° 
dúít
 **
__e1
,

386 c⁄° 
dúít
 **
__e2
),

387 
vîsi⁄s‹t64
)

388 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

390 
	#vîsi⁄s‹t
 
vîsi⁄s‹t64


	)

394 #ifde‡
__USE_LARGEFILE64


395 
	$vîsi⁄s‹t64
 (c⁄° 
dúít64
 **
__e1
,

396 c⁄° 
dúít64
 **
__e2
)

397 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

401 
__END_DECLS


	@/usr/include/dlfcn.h

19 #i‚def 
_DLFCN_H


20 
	#_DLFCN_H
 1

	)

22 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

27 
	~<bôs/dlf˙.h
>

30 #ifde‡
__USE_GNU


35 
	#RTLD_NEXT
 ((*Ë-1l)

	)

40 
	#RTLD_DEFAULT
 ((*Ë0)

	)

44 
	tLmid_t
;

47 
	#LM_ID_BASE
 0

	)

48 
	#LM_ID_NEWLM
 -1

	)

52 
__BEGIN_DECLS


56 *
	$dl›í
 (c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

60 
	$dl˛o£
 (*
__h™dÀ
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1));

64 *
	$dlsym
 (*
__ª°ri˘
 
__h™dÀ
,

65 c⁄° *
__ª°ri˘
 
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

67 #ifde‡
__USE_GNU


69 *
	$dlm›í
 (
Lmid_t
 
__nsid
, c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

73 *
	$dlvsym
 (*
__ª°ri˘
 
__h™dÀ
,

74 c⁄° *
__ª°ri˘
 
__«me
,

75 c⁄° *
__ª°ri˘
 
__vîsi⁄
)

76 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

82 *
	$dÀº‹
 (Ë
__THROW
;

85 #ifde‡
__USE_GNU


90 c⁄° *
dli_‚ame
;

91 *
dli_fba£
;

92 c⁄° *
dli_¢ame
;

93 *
dli_ßddr
;

94 } 
	tDl_öfo
;

98 
	$dœddr
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
)

99 
__THROW
 
	`__n⁄nuŒ
 ((2));

102 
	$dœddr1
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
,

103 **
__exåa_öfo
, 
__Êags
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

111 
RTLD_DL_SYMENT
 = 1,

114 
RTLD_DL_LINKMAP
 = 2

123 
	$dlöfo
 (*
__ª°ri˘
 
__h™dÀ
,

124 
__ªque°
, *
__ª°ri˘
 
__¨g
)

125 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

131 
RTLD_DI_LMID
 = 1,

135 
RTLD_DI_LINKMAP
 = 2,

137 
RTLD_DI_CONFIGADDR
 = 3,

144 
RTLD_DI_SERINFO
 = 4,

145 
RTLD_DI_SERINFOSIZE
 = 5,

149 
RTLD_DI_ORIGIN
 = 6,

151 
RTLD_DI_PROFILENAME
 = 7,

152 
RTLD_DI_PROFILEOUT
 = 8,

157 
RTLD_DI_TLS_MODID
 = 9,

163 
RTLD_DI_TLS_DATA
 = 10,

165 
RTLD_DI_MAX
 = 10

173 *
dls_«me
;

174 
dls_Êags
;

175 } 
	tDl_£Ω©h
;

181 
size_t
 
dls_size
;

182 
dls_˙t
;

183 
Dl_£Ω©h
 
dls_£Ω©h
[1];

184 } 
	tDl_£röfo
;

188 
__END_DECLS


	@/usr/include/fcntl.h

22 #i‚def 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

35 
	~<bôs/f˙é.h
>

39 #ifde‡
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oÊag
) \

41 (((
oÊag
Ë& 
O_CREAT
Ë!0 || ((oÊagË& 
__O_TMPFILE
Ë=__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oÊag
Ë(((oÊagË& 
O_CREAT
Ë!0)

	)

49 #i‚de‡
__mode_t_deföed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_deföed


	)

54 #i‚de‡
__off_t_deföed


55 #i‚de‡
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_deföed


	)

63 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_deföed


	)

68 #i‚de‡
__pid_t_deföed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_deföed


	)

74 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


75 
	#__√ed_time•ec


	)

76 
	~<time.h
>

77 
	~<bôs/°©.h
>

79 
	#S_IFMT
 
__S_IFMT


	)

80 
	#S_IFDIR
 
__S_IFDIR


	)

81 
	#S_IFCHR
 
__S_IFCHR


	)

82 
	#S_IFBLK
 
__S_IFBLK


	)

83 
	#S_IFREG
 
__S_IFREG


	)

84 #ifde‡
__S_IFIFO


85 
	#S_IFIFO
 
__S_IFIFO


	)

87 #ifde‡
__S_IFLNK


88 
	#S_IFLNK
 
__S_IFLNK


	)

90 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
Ë&& deföed 
__S_IFSOCK


91 
	#S_IFSOCK
 
__S_IFSOCK


	)

96 
	#S_ISUID
 
__S_ISUID


	)

97 
	#S_ISGID
 
__S_ISGID


	)

99 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


101 
	#S_ISVTX
 
__S_ISVTX


	)

104 
	#S_IRUSR
 
__S_IREAD


	)

105 
	#S_IWUSR
 
__S_IWRITE


	)

106 
	#S_IXUSR
 
__S_IEXEC


	)

108 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

110 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

111 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

112 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

114 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

116 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

117 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

118 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

120 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

123 #ifdef 
__USE_MISC


124 #i‚de‡
R_OK


127 
	#R_OK
 4

	)

128 
	#W_OK
 2

	)

129 
	#X_OK
 1

	)

130 
	#F_OK
 0

	)

135 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


136 
	#SEEK_SET
 0

	)

137 
	#SEEK_CUR
 1

	)

138 
	#SEEK_END
 2

	)

146 
f˙é
 (
__fd
, 
__cmd
, ...);

155 #i‚de‡
__USE_FILE_OFFSET64


156 
	$›í
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

158 #ifde‡
__REDIRECT


159 
	`__REDIRECT
 (
›í
, (c⁄° *
__fûe
, 
__oÊag
, ...), 
›í64
)

160 
	`__n⁄nuŒ
 ((1));

162 
	#›í
 
›í64


	)

165 #ifde‡
__USE_LARGEFILE64


166 
	$›í64
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

169 #ifde‡
__USE_ATFILE


179 #i‚de‡
__USE_FILE_OFFSET64


180 
	$›í©
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

181 
	`__n⁄nuŒ
 ((2));

183 #ifde‡
__REDIRECT


184 
	`__REDIRECT
 (
›í©
, (
__fd
, c⁄° *
__fûe
, 
__oÊag
,

185 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

187 
	#›í©
 
›í©64


	)

190 #ifde‡
__USE_LARGEFILE64


191 
	$›í©64
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

192 
	`__n⁄nuŒ
 ((2));

201 #i‚de‡
__USE_FILE_OFFSET64


202 
	$¸ót
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

204 #ifde‡
__REDIRECT


205 
	`__REDIRECT
 (
¸ót
, (c⁄° *
__fûe
, 
mode_t
 
__mode
),

206 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

208 
	#¸ót
 
¸ót64


	)

211 #ifde‡
__USE_LARGEFILE64


212 
	$¸ót64
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

215 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

216 && !
deföed
 
__USE_POSIX
))

225 
	#F_ULOCK
 0

	)

226 
	#F_LOCK
 1

	)

227 
	#F_TLOCK
 2

	)

228 
	#F_TEST
 3

	)

230 #i‚de‡
__USE_FILE_OFFSET64


231 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Àn
);

233 #ifde‡
__REDIRECT


234 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

236 
	#lockf
 
lockf64


	)

239 #ifde‡
__USE_LARGEFILE64


240 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Àn
);

244 #ifde‡
__USE_XOPEN2K


247 #i‚de‡
__USE_FILE_OFFSET64


248 
	$posix_Ádvi£
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
,

249 
__advi£
Ë
__THROW
;

251 #ifde‡
__REDIRECT_NTH


252 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

253 
__off64_t
 
__Àn
, 
__advi£
),

254 
posix_Ádvi£64
);

256 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

259 #ifde‡
__USE_LARGEFILE64


260 
	$posix_Ádvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
,

261 
__advi£
Ë
__THROW
;

269 #i‚de‡
__USE_FILE_OFFSET64


270 
	`posix_ÁŒoˇã
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
);

272 #ifde‡
__REDIRECT


273 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

274 
__off64_t
 
__Àn
),

275 
posix_ÁŒoˇã64
);

277 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

280 #ifde‡
__USE_LARGEFILE64


281 
	`posix_ÁŒoˇã64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
);

287 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄
 \

288 && 
deföed
 
__va_¨g_∑ck_Àn


289 
	~<bôs/f˙é2.h
>

292 
__END_DECLS


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<„©uªs.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

41 #i‚de‡
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<bôs/w‹dsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifde‡
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #i‡
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #i‡
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifde‡
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


123 #ö˛ude_√xà<
limôs
.
h
>

129 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


130 #i‚de‡
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #i‚de‡
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #i‚de‡
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<bôs/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<bôs/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<bôs/x›í_lim.h
>

	@/usr/include/linux/ethtool.h

13 #i‚de‡
_LINUX_ETHTOOL_H


14 
	#_LINUX_ETHTOOL_H


	)

16 
	~<löux/ty≥s.h
>

17 
	~<löux/if_ëhî.h
>

19 
	~<limôs.h
>

96 
	sëhtoﬁ_cmd
 {

97 
__u32
 
	mcmd
;

98 
__u32
 
	msuµ‹ãd
;

99 
__u32
 
	madvîtisög
;

100 
__u16
 
	m•ìd
;

101 
__u8
 
	mdu∂ex
;

102 
__u8
 
	mp‹t
;

103 
__u8
 
	mphy_addªss
;

104 
__u8
 
	må™s˚ivî
;

105 
__u8
 
	maut⁄eg
;

106 
__u8
 
	mmdio_suµ‹t
;

107 
__u32
 
	mmaxtxpkt
;

108 
__u32
 
	mmaxrxpkt
;

109 
__u16
 
	m•ìd_hi
;

110 
__u8
 
	mëh_ç_mdix
;

111 
__u8
 
	mëh_ç_mdix_˘æ
;

112 
__u32
 
	mÕ_advîtisög
;

113 
__u32
 
	mª£rved
[2];

116 
__ölöe__
 
	$ëhtoﬁ_cmd_•ìd_£t
(
ëhtoﬁ_cmd
 *
ï
,

117 
__u32
 
•ìd
)

120 
ï
->
•ìd
 = (
__u16
)speed;

121 
ï
->
•ìd_hi
 = (
__u16
)(
•ìd
 >> 16);

122 
	}
}

124 
__ölöe__
 
__u32
 
	$ëhtoﬁ_cmd_•ìd
(c⁄° 
ëhtoﬁ_cmd
 *
ï
)

126  (
ï
->
•ìd_hi
 << 16Ë|Ép->
•ìd
;

127 
	}
}

134 
	#ETH_MDIO_SUPPORTS_C22
 1

	)

141 
	#ETH_MDIO_SUPPORTS_C45
 2

	)

143 
	#ETHTOOL_FWVERS_LEN
 32

	)

144 
	#ETHTOOL_BUSINFO_LEN
 32

	)

145 
	#ETHTOOL_EROMVERS_LEN
 32

	)

178 
	sëhtoﬁ_drvöfo
 {

179 
__u32
 
	mcmd
;

180 
	mdrivî
[32];

181 
	mvîsi⁄
[32];

182 
	mfw_vîsi⁄
[
ETHTOOL_FWVERS_LEN
];

183 
	mbus_öfo
[
ETHTOOL_BUSINFO_LEN
];

184 
	mîom_vîsi⁄
[
ETHTOOL_EROMVERS_LEN
];

185 
	mª£rved2
[12];

186 
__u32
 
	mn_¥iv_Êags
;

187 
__u32
 
	mn_°©s
;

188 
__u32
 
	mã°öfo_Àn
;

189 
__u32
 
	mìdump_Àn
;

190 
__u32
 
	mªgdump_Àn
;

193 
	#SOPASS_MAX
 6

	)

204 
	sëhtoﬁ_wﬁöfo
 {

205 
__u32
 
	mcmd
;

206 
__u32
 
	msuµ‹ãd
;

207 
__u32
 
	mwﬁ›ts
;

208 
__u8
 
	ms›ass
[
SOPASS_MAX
];

212 
	sëhtoﬁ_vÆue
 {

213 
__u32
 
	mcmd
;

214 
__u32
 
	md©a
;

217 
	etu«bÀ_id
 {

218 
	mETHTOOL_ID_UNSPEC
,

219 
	mETHTOOL_RX_COPYBREAK
,

220 
	mETHTOOL_TX_COPYBREAK
,

225 
	m__ETHTOOL_TUNABLE_COUNT
,

228 
	etu«bÀ_ty≥_id
 {

229 
	mETHTOOL_TUNABLE_UNSPEC
,

230 
	mETHTOOL_TUNABLE_U8
,

231 
	mETHTOOL_TUNABLE_U16
,

232 
	mETHTOOL_TUNABLE_U32
,

233 
	mETHTOOL_TUNABLE_U64
,

234 
	mETHTOOL_TUNABLE_STRING
,

235 
	mETHTOOL_TUNABLE_S8
,

236 
	mETHTOOL_TUNABLE_S16
,

237 
	mETHTOOL_TUNABLE_S32
,

238 
	mETHTOOL_TUNABLE_S64
,

241 
	sëhtoﬁ_tu«bÀ
 {

242 
__u32
 
	mcmd
;

243 
__u32
 
	mid
;

244 
__u32
 
	mty≥_id
;

245 
__u32
 
	mÀn
;

246 *
	md©a
[0];

264 
	sëhtoﬁ_ªgs
 {

265 
__u32
 
	mcmd
;

266 
__u32
 
	mvîsi⁄
;

267 
__u32
 
	mÀn
;

268 
__u8
 
	md©a
[0];

289 
	sëhtoﬁ_ì¥om
 {

290 
__u32
 
	mcmd
;

291 
__u32
 
	mmagic
;

292 
__u32
 
	moff£t
;

293 
__u32
 
	mÀn
;

294 
__u8
 
	md©a
[0];

314 
	sëhtoﬁ_ìe
 {

315 
__u32
 
	mcmd
;

316 
__u32
 
	msuµ‹ãd
;

317 
__u32
 
	madvîti£d
;

318 
__u32
 
	mÕ_advîti£d
;

319 
__u32
 
	mìe_a˘ive
;

320 
__u32
 
	mìe_íabÀd
;

321 
__u32
 
	mtx_Õi_íabÀd
;

322 
__u32
 
	mtx_Õi_timî
;

323 
__u32
 
	mª£rved
[2];

336 
	sëhtoﬁ_modöfo
 {

337 
__u32
 
	mcmd
;

338 
__u32
 
	mty≥
;

339 
__u32
 
	mì¥om_Àn
;

340 
__u32
 
	mª£rved
[8];

416 
	sëhtoﬁ_cﬂÀs˚
 {

417 
__u32
 
	mcmd
;

418 
__u32
 
	mrx_cﬂÀs˚_u£cs
;

419 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames
;

420 
__u32
 
	mrx_cﬂÀs˚_u£cs_úq
;

421 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_úq
;

422 
__u32
 
	mtx_cﬂÀs˚_u£cs
;

423 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames
;

424 
__u32
 
	mtx_cﬂÀs˚_u£cs_úq
;

425 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_úq
;

426 
__u32
 
	m°©s_block_cﬂÀs˚_u£cs
;

427 
__u32
 
	mu£_ad≠tive_rx_cﬂÀs˚
;

428 
__u32
 
	mu£_ad≠tive_tx_cﬂÀs˚
;

429 
__u32
 
	mpkt_øã_low
;

430 
__u32
 
	mrx_cﬂÀs˚_u£cs_low
;

431 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_low
;

432 
__u32
 
	mtx_cﬂÀs˚_u£cs_low
;

433 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_low
;

434 
__u32
 
	mpkt_øã_high
;

435 
__u32
 
	mrx_cﬂÀs˚_u£cs_high
;

436 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_high
;

437 
__u32
 
	mtx_cﬂÀs˚_u£cs_high
;

438 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_high
;

439 
__u32
 
	møã_ßm∂e_öãrvÆ
;

467 
	sëhtoﬁ_rög∑øm
 {

468 
__u32
 
	mcmd
;

469 
__u32
 
	mrx_max_≥ndög
;

470 
__u32
 
	mrx_möi_max_≥ndög
;

471 
__u32
 
	mrx_jumbo_max_≥ndög
;

472 
__u32
 
	mtx_max_≥ndög
;

473 
__u32
 
	mrx_≥ndög
;

474 
__u32
 
	mrx_möi_≥ndög
;

475 
__u32
 
	mrx_jumbo_≥ndög
;

476 
__u32
 
	mtx_≥ndög
;

495 
	sëhtoﬁ_ch™√ls
 {

496 
__u32
 
	mcmd
;

497 
__u32
 
	mmax_rx
;

498 
__u32
 
	mmax_tx
;

499 
__u32
 
	mmax_Ÿhî
;

500 
__u32
 
	mmax_comböed
;

501 
__u32
 
	mrx_cou¡
;

502 
__u32
 
	mtx_cou¡
;

503 
__u32
 
	mŸhî_cou¡
;

504 
__u32
 
	mcomböed_cou¡
;

529 
	sëhtoﬁ_∑u£∑øm
 {

530 
__u32
 
	mcmd
;

531 
__u32
 
	maut⁄eg
;

532 
__u32
 
	mrx_∑u£
;

533 
__u32
 
	mtx_∑u£
;

536 
	#ETH_GSTRING_LEN
 32

	)

549 
	eëhtoﬁ_°rög£t
 {

550 
	mETH_SS_TEST
 = 0,

551 
	mETH_SS_STATS
,

552 
	mETH_SS_PRIV_FLAGS
,

553 
	mETH_SS_NTUPLE_FILTERS
,

554 
	mETH_SS_FEATURES
,

555 
	mETH_SS_RSS_HASH_FUNCS
,

556 
	mETH_SS_TUNABLES
,

571 
	sëhtoﬁ_g°rögs
 {

572 
__u32
 
	mcmd
;

573 
__u32
 
	m°rög_£t
;

574 
__u32
 
	mÀn
;

575 
__u8
 
	md©a
[0];

595 
	sëhtoﬁ_s£t_öfo
 {

596 
__u32
 
	mcmd
;

597 
__u32
 
	mª£rved
;

598 
__u64
 
	ms£t_mask
;

599 
__u32
 
	md©a
[0];

612 
	eëhtoﬁ_ã°_Êags
 {

613 
	mETH_TEST_FL_OFFLINE
 = (1 << 0),

614 
	mETH_TEST_FL_FAILED
 = (1 << 1),

615 
	mETH_TEST_FL_EXTERNAL_LB
 = (1 << 2),

616 
	mETH_TEST_FL_EXTERNAL_LB_DONE
 = (1 << 3),

633 
	sëhtoﬁ_ã°
 {

634 
__u32
 
	mcmd
;

635 
__u32
 
	mÊags
;

636 
__u32
 
	mª£rved
;

637 
__u32
 
	mÀn
;

638 
__u64
 
	md©a
[0];

652 
	sëhtoﬁ_°©s
 {

653 
__u32
 
	mcmd
;

654 
__u32
 
	mn_°©s
;

655 
__u64
 
	md©a
[0];

669 
	sëhtoﬁ_≥rm_addr
 {

670 
__u32
 
	mcmd
;

671 
__u32
 
	msize
;

672 
__u8
 
	md©a
[0];

684 
	eëhtoﬁ_Êags
 {

685 
	mETH_FLAG_TXVLAN
 = (1 << 7),

686 
	mETH_FLAG_RXVLAN
 = (1 << 8),

687 
	mETH_FLAG_LRO
 = (1 << 15),

688 
	mETH_FLAG_NTUPLE
 = (1 << 27),

689 
	mETH_FLAG_RXHASH
 = (1 << 28),

708 
	sëhtoﬁ_t˝ù4_•ec
 {

709 
__be32
 
	mù4§c
;

710 
__be32
 
	mù4d°
;

711 
__be16
 
	mp§c
;

712 
__be16
 
	mpd°
;

713 
__u8
 
	mtos
;

725 
	sëhtoﬁ_ah_e•ù4_•ec
 {

726 
__be32
 
	mù4§c
;

727 
__be32
 
	mù4d°
;

728 
__be32
 
	m•i
;

729 
__u8
 
	mtos
;

732 
	#ETH_RX_NFC_IP4
 1

	)

743 
	sëhtoﬁ_u§ù4_•ec
 {

744 
__be32
 
	mù4§c
;

745 
__be32
 
	mù4d°
;

746 
__be32
 
	ml4_4_byãs
;

747 
__u8
 
	mtos
;

748 
__u8
 
	mù_vî
;

749 
__u8
 
	m¥Ÿo
;

752 
	uëhtoﬁ_Êow_uni⁄
 {

753 
ëhtoﬁ_t˝ù4_•ec
 
	mt˝_ù4_•ec
;

754 
ëhtoﬁ_t˝ù4_•ec
 
	mudp_ù4_•ec
;

755 
ëhtoﬁ_t˝ù4_•ec
 
	ms˘p_ù4_•ec
;

756 
ëhtoﬁ_ah_e•ù4_•ec
 
	mah_ù4_•ec
;

757 
ëhtoﬁ_ah_e•ù4_•ec
 
	me•_ù4_•ec
;

758 
ëhtoﬁ_u§ù4_•ec
 
	mu§_ù4_•ec
;

759 
ëhhdr
 
	mëhî_•ec
;

760 
__u8
 
	mhd©a
[52];

774 
	sëhtoﬁ_Êow_ext
 {

775 
__u8
 
	m∑ddög
[2];

776 
	mh_de°
[
ETH_ALEN
];

777 
__be16
 
	mvœn_ëy≥
;

778 
__be16
 
	mvœn_tci
;

779 
__be32
 
	md©a
[2];

798 
	sëhtoﬁ_rx_Êow_•ec
 {

799 
__u32
 
	mÊow_ty≥
;

800 
ëhtoﬁ_Êow_uni⁄
 
	mh_u
;

801 
ëhtoﬁ_Êow_ext
 
	mh_ext
;

802 
ëhtoﬁ_Êow_uni⁄
 
	mm_u
;

803 
ëhtoﬁ_Êow_ext
 
	mm_ext
;

804 
__u64
 
	mrög_cookõ
;

805 
__u32
 
	mloˇti⁄
;

819 
	#ETHTOOL_RX_FLOW_SPEC_RING
 0x00000000FFFFFFFFLL

	)

820 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF
 0x000000FF00000000LL

	)

821 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
 32

	)

822 
__ölöe__
 
__u64
 
	$ëhtoﬁ_gë_Êow_•ec_rög
(
__u64
 
rög_cookõ
)

824  
ETHTOOL_RX_FLOW_SPEC_RING
 & 
rög_cookõ
;

825 
	}
};

827 
__ölöe__
 
__u64
 
	$ëhtoﬁ_gë_Êow_•ec_rög_vf
(
__u64
 
rög_cookõ
)

829  (
ETHTOOL_RX_FLOW_SPEC_RING_VF
 & 
rög_cookõ
) >>

830 
ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
;

831 
	}
};

885 
	sëhtoﬁ_rxnfc
 {

886 
__u32
 
	mcmd
;

887 
__u32
 
	mÊow_ty≥
;

888 
__u64
 
	md©a
;

889 
ëhtoﬁ_rx_Êow_•ec
 
	mfs
;

890 
__u32
 
	mruÀ_˙t
;

891 
__u32
 
	mruÀ_locs
[0];

908 
	sëhtoﬁ_rxfh_ödú
 {

909 
__u32
 
	mcmd
;

910 
__u32
 
	msize
;

911 
__u32
 
	mrög_ödex
[0];

938 
	sëhtoﬁ_rxfh
 {

939 
__u32
 
	mcmd
;

940 
__u32
 
	mrss_c⁄ãxt
;

941 
__u32
 
	mödú_size
;

942 
__u32
 
	mkey_size
;

943 
__u8
 
	mhfunc
;

944 
__u8
 
	mrsvd8
[3];

945 
__u32
 
	mrsvd32
;

946 
__u32
 
	mrss_c⁄fig
[0];

948 
	#ETH_RXFH_INDIR_NO_CHANGE
 0xffffffff

	)

966 
	sëhtoﬁ_rx_¡u∂e_Êow_•ec
 {

967 
__u32
 
	mÊow_ty≥
;

969 
ëhtoﬁ_t˝ù4_•ec
 
	mt˝_ù4_•ec
;

970 
ëhtoﬁ_t˝ù4_•ec
 
	mudp_ù4_•ec
;

971 
ëhtoﬁ_t˝ù4_•ec
 
	ms˘p_ù4_•ec
;

972 
ëhtoﬁ_ah_e•ù4_•ec
 
	mah_ù4_•ec
;

973 
ëhtoﬁ_ah_e•ù4_•ec
 
	me•_ù4_•ec
;

974 
ëhtoﬁ_u§ù4_•ec
 
	mu§_ù4_•ec
;

975 
ëhhdr
 
	mëhî_•ec
;

976 
__u8
 
	mhd©a
[72];

977 } 
	mh_u
, 
	mm_u
;

979 
__u16
 
	mvœn_èg
;

980 
__u16
 
	mvœn_èg_mask
;

981 
__u64
 
	md©a
;

982 
__u64
 
	md©a_mask
;

984 
__s32
 
	ma˘i⁄
;

985 
	#ETHTOOL_RXNTUPLE_ACTION_DROP
 (-1Ë

	)

986 
	#ETHTOOL_RXNTUPLE_ACTION_CLEAR
 (-2Ë

	)

994 
	sëhtoﬁ_rx_¡u∂e
 {

995 
__u32
 
	mcmd
;

996 
ëhtoﬁ_rx_¡u∂e_Êow_•ec
 
	mfs
;

999 
	#ETHTOOL_FLASH_MAX_FILENAME
 128

	)

1000 
	eëhtoﬁ_Êash_›_ty≥
 {

1001 
	mETHTOOL_FLASH_ALL_REGIONS
 = 0,

1005 
	sëhtoﬁ_Êash
 {

1006 
__u32
 
	mcmd
;

1007 
__u32
 
	mªgi⁄
;

1008 
	md©a
[
ETHTOOL_FLASH_MAX_FILENAME
];

1025 
	sëhtoﬁ_dump
 {

1026 
__u32
 
	mcmd
;

1027 
__u32
 
	mvîsi⁄
;

1028 
__u32
 
	mÊag
;

1029 
__u32
 
	mÀn
;

1030 
__u8
 
	md©a
[0];

1033 
	#ETH_FW_DUMP_DISABLE
 0

	)

1044 
	sëhtoﬁ_gë_„©uªs_block
 {

1045 
__u32
 
	mavaûabÀ
;

1046 
__u32
 
	mªque°ed
;

1047 
__u32
 
	ma˘ive
;

1048 
__u32
 
	m√vî_ch™ged
;

1059 
	sëhtoﬁ_g„©uªs
 {

1060 
__u32
 
	mcmd
;

1061 
__u32
 
	msize
;

1062 
ëhtoﬁ_gë_„©uªs_block
 
	m„©uªs
[0];

1070 
	sëhtoﬁ_£t_„©uªs_block
 {

1071 
__u32
 
	mvÆid
;

1072 
__u32
 
	mªque°ed
;

1081 
	sëhtoﬁ_s„©uªs
 {

1082 
__u32
 
	mcmd
;

1083 
__u32
 
	msize
;

1084 
ëhtoﬁ_£t_„©uªs_block
 
	m„©uªs
[0];

1105 
	sëhtoﬁ_ts_öfo
 {

1106 
__u32
 
	mcmd
;

1107 
__u32
 
	mso_time°ampög
;

1108 
__s32
 
	mphc_ödex
;

1109 
__u32
 
	mtx_ty≥s
;

1110 
__u32
 
	mtx_ª£rved
[3];

1111 
__u32
 
	mrx_fûãrs
;

1112 
__u32
 
	mrx_ª£rved
[3];

1140 
	eëhtoﬁ_s„©uªs_ªtvÆ_bôs
 {

1141 
	mETHTOOL_F_UNSUPPORTED__BIT
,

1142 
	mETHTOOL_F_WISH__BIT
,

1143 
	mETHTOOL_F_COMPAT__BIT
,

1146 
	#ETHTOOL_F_UNSUPPORTED
 (1 << 
ETHTOOL_F_UNSUPPORTED__BIT
)

	)

1147 
	#ETHTOOL_F_WISH
 (1 << 
ETHTOOL_F_WISH__BIT
)

	)

1148 
	#ETHTOOL_F_COMPAT
 (1 << 
ETHTOOL_F_COMPAT__BIT
)

	)

1152 
	#ETHTOOL_GSET
 0x00000001

	)

1155 
	#ETHTOOL_SSET
 0x00000002

	)

1158 
	#ETHTOOL_GDRVINFO
 0x00000003

	)

1159 
	#ETHTOOL_GREGS
 0x00000004

	)

1160 
	#ETHTOOL_GWOL
 0x00000005

	)

1161 
	#ETHTOOL_SWOL
 0x00000006

	)

1162 
	#ETHTOOL_GMSGLVL
 0x00000007

	)

1163 
	#ETHTOOL_SMSGLVL
 0x00000008

	)

1164 
	#ETHTOOL_NWAY_RST
 0x00000009

	)

1167 
	#ETHTOOL_GLINK
 0x0000000a

	)

1168 
	#ETHTOOL_GEEPROM
 0x0000000b

	)

1169 
	#ETHTOOL_SEEPROM
 0x0000000¯

	)

1170 
	#ETHTOOL_GCOALESCE
 0x0000000ê

	)

1171 
	#ETHTOOL_SCOALESCE
 0x0000000‡

	)

1172 
	#ETHTOOL_GRINGPARAM
 0x00000010

	)

1173 
	#ETHTOOL_SRINGPARAM
 0x00000011

	)

1174 
	#ETHTOOL_GPAUSEPARAM
 0x00000012

	)

1175 
	#ETHTOOL_SPAUSEPARAM
 0x00000013

	)

1176 
	#ETHTOOL_GRXCSUM
 0x00000014

	)

1177 
	#ETHTOOL_SRXCSUM
 0x00000015

	)

1178 
	#ETHTOOL_GTXCSUM
 0x00000016

	)

1179 
	#ETHTOOL_STXCSUM
 0x00000017

	)

1180 
	#ETHTOOL_GSG
 0x00000018

	)

1182 
	#ETHTOOL_SSG
 0x00000019

	)

1184 
	#ETHTOOL_TEST
 0x0000001®

	)

1185 
	#ETHTOOL_GSTRINGS
 0x0000001b

	)

1186 
	#ETHTOOL_PHYS_ID
 0x0000001¯

	)

1187 
	#ETHTOOL_GSTATS
 0x0000001d

	)

1188 
	#ETHTOOL_GTSO
 0x0000001ê

	)

1189 
	#ETHTOOL_STSO
 0x0000001‡

	)

1190 
	#ETHTOOL_GPERMADDR
 0x00000020

	)

1191 
	#ETHTOOL_GUFO
 0x00000021

	)

1192 
	#ETHTOOL_SUFO
 0x00000022

	)

1193 
	#ETHTOOL_GGSO
 0x00000023

	)

1194 
	#ETHTOOL_SGSO
 0x00000024

	)

1195 
	#ETHTOOL_GFLAGS
 0x00000025

	)

1196 
	#ETHTOOL_SFLAGS
 0x00000026

	)

1197 
	#ETHTOOL_GPFLAGS
 0x00000027

	)

1198 
	#ETHTOOL_SPFLAGS
 0x00000028

	)

1200 
	#ETHTOOL_GRXFH
 0x00000029

	)

1201 
	#ETHTOOL_SRXFH
 0x0000002®

	)

1202 
	#ETHTOOL_GGRO
 0x0000002b

	)

1203 
	#ETHTOOL_SGRO
 0x0000002¯

	)

1204 
	#ETHTOOL_GRXRINGS
 0x0000002d

	)

1205 
	#ETHTOOL_GRXCLSRLCNT
 0x0000002ê

	)

1206 
	#ETHTOOL_GRXCLSRULE
 0x0000002‡

	)

1207 
	#ETHTOOL_GRXCLSRLALL
 0x00000030

	)

1208 
	#ETHTOOL_SRXCLSRLDEL
 0x00000031

	)

1209 
	#ETHTOOL_SRXCLSRLINS
 0x00000032

	)

1210 
	#ETHTOOL_FLASHDEV
 0x00000033

	)

1211 
	#ETHTOOL_RESET
 0x00000034

	)

1212 
	#ETHTOOL_SRXNTUPLE
 0x00000035

	)

1213 
	#ETHTOOL_GRXNTUPLE
 0x00000036

	)

1214 
	#ETHTOOL_GSSET_INFO
 0x00000037

	)

1215 
	#ETHTOOL_GRXFHINDIR
 0x00000038

	)

1216 
	#ETHTOOL_SRXFHINDIR
 0x00000039

	)

1218 
	#ETHTOOL_GFEATURES
 0x0000003®

	)

1219 
	#ETHTOOL_SFEATURES
 0x0000003b

	)

1220 
	#ETHTOOL_GCHANNELS
 0x0000003¯

	)

1221 
	#ETHTOOL_SCHANNELS
 0x0000003d

	)

1222 
	#ETHTOOL_SET_DUMP
 0x0000003ê

	)

1223 
	#ETHTOOL_GET_DUMP_FLAG
 0x0000003‡

	)

1224 
	#ETHTOOL_GET_DUMP_DATA
 0x00000040

	)

1225 
	#ETHTOOL_GET_TS_INFO
 0x00000041

	)

1226 
	#ETHTOOL_GMODULEINFO
 0x00000042

	)

1227 
	#ETHTOOL_GMODULEEEPROM
 0x00000043

	)

1228 
	#ETHTOOL_GEEE
 0x00000044

	)

1229 
	#ETHTOOL_SEEE
 0x00000045

	)

1231 
	#ETHTOOL_GRSSH
 0x00000046

	)

1232 
	#ETHTOOL_SRSSH
 0x00000047

	)

1233 
	#ETHTOOL_GTUNABLE
 0x00000048

	)

1234 
	#ETHTOOL_STUNABLE
 0x00000049

	)

1236 
	#ETHTOOL_GLINKSETTINGS
 0x0000004¯

	)

1237 
	#ETHTOOL_SLINKSETTINGS
 0x0000004d

	)

1241 
	#SPARC_ETH_GSET
 
ETHTOOL_GSET


	)

1242 
	#SPARC_ETH_SSET
 
ETHTOOL_SSET


	)

1245 
	eëhtoﬁ_lök_mode_bô_ödi˚s
 {

1246 
	mETHTOOL_LINK_MODE_10ba£T_HÆf_BIT
 = 0,

1247 
	mETHTOOL_LINK_MODE_10ba£T_FuŒ_BIT
 = 1,

1248 
	mETHTOOL_LINK_MODE_100ba£T_HÆf_BIT
 = 2,

1249 
	mETHTOOL_LINK_MODE_100ba£T_FuŒ_BIT
 = 3,

1250 
	mETHTOOL_LINK_MODE_1000ba£T_HÆf_BIT
 = 4,

1251 
	mETHTOOL_LINK_MODE_1000ba£T_FuŒ_BIT
 = 5,

1252 
	mETHTOOL_LINK_MODE_Aut⁄eg_BIT
 = 6,

1253 
	mETHTOOL_LINK_MODE_TP_BIT
 = 7,

1254 
	mETHTOOL_LINK_MODE_AUI_BIT
 = 8,

1255 
	mETHTOOL_LINK_MODE_MII_BIT
 = 9,

1256 
	mETHTOOL_LINK_MODE_FIBRE_BIT
 = 10,

1257 
	mETHTOOL_LINK_MODE_BNC_BIT
 = 11,

1258 
	mETHTOOL_LINK_MODE_10000ba£T_FuŒ_BIT
 = 12,

1259 
	mETHTOOL_LINK_MODE_Pau£_BIT
 = 13,

1260 
	mETHTOOL_LINK_MODE_Asym_Pau£_BIT
 = 14,

1261 
	mETHTOOL_LINK_MODE_2500ba£X_FuŒ_BIT
 = 15,

1262 
	mETHTOOL_LINK_MODE_Back∂™e_BIT
 = 16,

1263 
	mETHTOOL_LINK_MODE_1000ba£KX_FuŒ_BIT
 = 17,

1264 
	mETHTOOL_LINK_MODE_10000ba£KX4_FuŒ_BIT
 = 18,

1265 
	mETHTOOL_LINK_MODE_10000ba£KR_FuŒ_BIT
 = 19,

1266 
	mETHTOOL_LINK_MODE_10000ba£R_FEC_BIT
 = 20,

1267 
	mETHTOOL_LINK_MODE_20000ba£MLD2_FuŒ_BIT
 = 21,

1268 
	mETHTOOL_LINK_MODE_20000ba£KR2_FuŒ_BIT
 = 22,

1269 
	mETHTOOL_LINK_MODE_40000ba£KR4_FuŒ_BIT
 = 23,

1270 
	mETHTOOL_LINK_MODE_40000ba£CR4_FuŒ_BIT
 = 24,

1271 
	mETHTOOL_LINK_MODE_40000ba£SR4_FuŒ_BIT
 = 25,

1272 
	mETHTOOL_LINK_MODE_40000ba£LR4_FuŒ_BIT
 = 26,

1273 
	mETHTOOL_LINK_MODE_56000ba£KR4_FuŒ_BIT
 = 27,

1274 
	mETHTOOL_LINK_MODE_56000ba£CR4_FuŒ_BIT
 = 28,

1275 
	mETHTOOL_LINK_MODE_56000ba£SR4_FuŒ_BIT
 = 29,

1276 
	mETHTOOL_LINK_MODE_56000ba£LR4_FuŒ_BIT
 = 30,

1284 
	m__ETHTOOL_LINK_MODE_LAST


1285 
ETHTOOL_LINK_MODE_56000ba£LR4_FuŒ_BIT
,

1288 
	#__ETHTOOL_LINK_MODE_LEGACY_MASK
(
ba£_«me
) \

1289 (1UL << (
ETHTOOL_LINK_MODE_
 ## 
ba£_«me
 ## 
_BIT
))

	)

1295 
	#SUPPORTED_10ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_HÆf
)

	)

1296 
	#SUPPORTED_10ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuŒ
)

	)

1297 
	#SUPPORTED_100ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_HÆf
)

	)

1298 
	#SUPPORTED_100ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuŒ
)

	)

1299 
	#SUPPORTED_1000ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_HÆf
)

	)

1300 
	#SUPPORTED_1000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuŒ
)

	)

1301 
	#SUPPORTED_Aut⁄eg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Aut⁄eg
)

	)

1302 
	#SUPPORTED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1303 
	#SUPPORTED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1304 
	#SUPPORTED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1305 
	#SUPPORTED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1306 
	#SUPPORTED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1307 
	#SUPPORTED_10000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuŒ
)

	)

1308 
	#SUPPORTED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1309 
	#SUPPORTED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1310 
	#SUPPORTED_2500ba£X_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuŒ
)

	)

1311 
	#SUPPORTED_Back∂™e
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back∂™e
)

	)

1312 
	#SUPPORTED_1000ba£KX_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuŒ
)

	)

1313 
	#SUPPORTED_10000ba£KX4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuŒ
)

	)

1314 
	#SUPPORTED_10000ba£KR_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuŒ
)

	)

1315 
	#SUPPORTED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1316 
	#SUPPORTED_20000ba£MLD2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuŒ
)

	)

1317 
	#SUPPORTED_20000ba£KR2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuŒ
)

	)

1318 
	#SUPPORTED_40000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuŒ
)

	)

1319 
	#SUPPORTED_40000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuŒ
)

	)

1320 
	#SUPPORTED_40000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuŒ
)

	)

1321 
	#SUPPORTED_40000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuŒ
)

	)

1322 
	#SUPPORTED_56000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuŒ
)

	)

1323 
	#SUPPORTED_56000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuŒ
)

	)

1324 
	#SUPPORTED_56000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuŒ
)

	)

1325 
	#SUPPORTED_56000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuŒ
)

	)

1335 
	#ADVERTISED_10ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_HÆf
)

	)

1336 
	#ADVERTISED_10ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuŒ
)

	)

1337 
	#ADVERTISED_100ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_HÆf
)

	)

1338 
	#ADVERTISED_100ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuŒ
)

	)

1339 
	#ADVERTISED_1000ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_HÆf
)

	)

1340 
	#ADVERTISED_1000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuŒ
)

	)

1341 
	#ADVERTISED_Aut⁄eg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Aut⁄eg
)

	)

1342 
	#ADVERTISED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1343 
	#ADVERTISED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1344 
	#ADVERTISED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1345 
	#ADVERTISED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1346 
	#ADVERTISED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1347 
	#ADVERTISED_10000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuŒ
)

	)

1348 
	#ADVERTISED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1349 
	#ADVERTISED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1350 
	#ADVERTISED_2500ba£X_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuŒ
)

	)

1351 
	#ADVERTISED_Back∂™e
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back∂™e
)

	)

1352 
	#ADVERTISED_1000ba£KX_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuŒ
)

	)

1353 
	#ADVERTISED_10000ba£KX4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuŒ
)

	)

1354 
	#ADVERTISED_10000ba£KR_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuŒ
)

	)

1355 
	#ADVERTISED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1356 
	#ADVERTISED_20000ba£MLD2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuŒ
)

	)

1357 
	#ADVERTISED_20000ba£KR2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuŒ
)

	)

1358 
	#ADVERTISED_40000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuŒ
)

	)

1359 
	#ADVERTISED_40000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuŒ
)

	)

1360 
	#ADVERTISED_40000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuŒ
)

	)

1361 
	#ADVERTISED_40000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuŒ
)

	)

1362 
	#ADVERTISED_56000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuŒ
)

	)

1363 
	#ADVERTISED_56000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuŒ
)

	)

1364 
	#ADVERTISED_56000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuŒ
)

	)

1365 
	#ADVERTISED_56000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuŒ
)

	)

1377 
	#SPEED_10
 10

	)

1378 
	#SPEED_100
 100

	)

1379 
	#SPEED_1000
 1000

	)

1380 
	#SPEED_2500
 2500

	)

1381 
	#SPEED_5000
 5000

	)

1382 
	#SPEED_10000
 10000

	)

1383 
	#SPEED_20000
 20000

	)

1384 
	#SPEED_25000
 25000

	)

1385 
	#SPEED_40000
 40000

	)

1386 
	#SPEED_50000
 50000

	)

1387 
	#SPEED_56000
 56000

	)

1388 
	#SPEED_100000
 100000

	)

1390 
	#SPEED_UNKNOWN
 -1

	)

1392 
__ölöe__
 
	$ëhtoﬁ_vÆid©e_•ìd
(
__u32
 
•ìd
)

1394  
•ìd
 <
INT_MAX
 || s≥ed =
SPEED_UNKNOWN
;

1395 
	}
}

1398 
	#DUPLEX_HALF
 0x00

	)

1399 
	#DUPLEX_FULL
 0x01

	)

1400 
	#DUPLEX_UNKNOWN
 0xff

	)

1402 
__ölöe__
 
	$ëhtoﬁ_vÆid©e_du∂ex
(
__u8
 
du∂ex
)

1404 
du∂ex
) {

1405 
DUPLEX_HALF
:

1406 
DUPLEX_FULL
:

1407 
DUPLEX_UNKNOWN
:

1412 
	}
}

1415 
	#PORT_TP
 0x00

	)

1416 
	#PORT_AUI
 0x01

	)

1417 
	#PORT_MII
 0x02

	)

1418 
	#PORT_FIBRE
 0x03

	)

1419 
	#PORT_BNC
 0x04

	)

1420 
	#PORT_DA
 0x05

	)

1421 
	#PORT_NONE
 0xef

	)

1422 
	#PORT_OTHER
 0xff

	)

1425 
	#XCVR_INTERNAL
 0x00

	)

1426 
	#XCVR_EXTERNAL
 0x01

	)

1427 
	#XCVR_DUMMY1
 0x02

	)

1428 
	#XCVR_DUMMY2
 0x03

	)

1429 
	#XCVR_DUMMY3
 0x04

	)

1432 
	#AUTONEG_DISABLE
 0x00

	)

1433 
	#AUTONEG_ENABLE
 0x01

	)

1438 
	#ETH_TP_MDI_INVALID
 0x00

	)

1439 
	#ETH_TP_MDI
 0x01

	)

1440 
	#ETH_TP_MDI_X
 0x02

	)

1441 
	#ETH_TP_MDI_AUTO
 0x03

	)

1444 
	#WAKE_PHY
 (1 << 0)

	)

1445 
	#WAKE_UCAST
 (1 << 1)

	)

1446 
	#WAKE_MCAST
 (1 << 2)

	)

1447 
	#WAKE_BCAST
 (1 << 3)

	)

1448 
	#WAKE_ARP
 (1 << 4)

	)

1449 
	#WAKE_MAGIC
 (1 << 5)

	)

1450 
	#WAKE_MAGICSECURE
 (1 << 6Ë

	)

1453 
	#TCP_V4_FLOW
 0x01

	)

1454 
	#UDP_V4_FLOW
 0x02

	)

1455 
	#SCTP_V4_FLOW
 0x03

	)

1456 
	#AH_ESP_V4_FLOW
 0x04

	)

1457 
	#TCP_V6_FLOW
 0x05

	)

1458 
	#UDP_V6_FLOW
 0x06

	)

1459 
	#SCTP_V6_FLOW
 0x07

	)

1460 
	#AH_ESP_V6_FLOW
 0x08

	)

1461 
	#AH_V4_FLOW
 0x09

	)

1462 
	#ESP_V4_FLOW
 0x0®

	)

1463 
	#AH_V6_FLOW
 0x0b

	)

1464 
	#ESP_V6_FLOW
 0x0¯

	)

1465 
	#IP_USER_FLOW
 0x0d

	)

1466 
	#IPV4_FLOW
 0x10

	)

1467 
	#IPV6_FLOW
 0x11

	)

1468 
	#ETHER_FLOW
 0x12

	)

1470 
	#FLOW_EXT
 0x80000000

	)

1471 
	#FLOW_MAC_EXT
 0x40000000

	)

1474 
	#RXH_L2DA
 (1 << 1)

	)

1475 
	#RXH_VLAN
 (1 << 2)

	)

1476 
	#RXH_L3_PROTO
 (1 << 3)

	)

1477 
	#RXH_IP_SRC
 (1 << 4)

	)

1478 
	#RXH_IP_DST
 (1 << 5)

	)

1479 
	#RXH_L4_B_0_1
 (1 << 6Ë

	)

1480 
	#RXH_L4_B_2_3
 (1 << 7Ë

	)

1481 
	#RXH_DISCARD
 (1 << 31)

	)

1483 
	#RX_CLS_FLOW_DISC
 0xffffffffffffffffULL

	)

1486 
	#RX_CLS_LOC_SPECIAL
 0x80000000

	)

1487 
	#RX_CLS_LOC_ANY
 0xffffffff

	)

1488 
	#RX_CLS_LOC_FIRST
 0xffffff„

	)

1489 
	#RX_CLS_LOC_LAST
 0xfffffffd

	)

1492 
	#ETH_MODULE_SFF_8079
 0x1

	)

1493 
	#ETH_MODULE_SFF_8079_LEN
 256

	)

1494 
	#ETH_MODULE_SFF_8472
 0x2

	)

1495 
	#ETH_MODULE_SFF_8472_LEN
 512

	)

1496 
	#ETH_MODULE_SFF_8636
 0x3

	)

1497 
	#ETH_MODULE_SFF_8636_LEN
 256

	)

1498 
	#ETH_MODULE_SFF_8436
 0x4

	)

1499 
	#ETH_MODULE_SFF_8436_LEN
 256

	)

1508 
	eëhtoﬁ_ª£t_Êags
 {

1514 
	mETH_RESET_MGMT
 = 1 << 0,

1515 
	mETH_RESET_IRQ
 = 1 << 1,

1516 
	mETH_RESET_DMA
 = 1 << 2,

1517 
	mETH_RESET_FILTER
 = 1 << 3,

1518 
	mETH_RESET_OFFLOAD
 = 1 << 4,

1519 
	mETH_RESET_MAC
 = 1 << 5,

1520 
	mETH_RESET_PHY
 = 1 << 6,

1521 
	mETH_RESET_RAM
 = 1 << 7,

1524 
	mETH_RESET_DEDICATED
 = 0x0000ffff,

1526 
	mETH_RESET_ALL
 = 0xffffffff,

1529 
	#ETH_RESET_SHARED_SHIFT
 16

	)

1631 
	sëhtoﬁ_lök_£âögs
 {

1632 
__u32
 
	mcmd
;

1633 
__u32
 
	m•ìd
;

1634 
__u8
 
	mdu∂ex
;

1635 
__u8
 
	mp‹t
;

1636 
__u8
 
	mphy_addªss
;

1637 
__u8
 
	maut⁄eg
;

1638 
__u8
 
	mmdio_suµ‹t
;

1639 
__u8
 
	mëh_ç_mdix
;

1640 
__u8
 
	mëh_ç_mdix_˘æ
;

1641 
__s8
 
	mlök_mode_masks_nw‹ds
;

1642 
__u32
 
	mª£rved
[8];

1643 
__u32
 
	mlök_mode_masks
[0];

	@/usr/include/linux/sched.h

1 #i‚de‡
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000f‡

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

24 
	#CLONE_NEWCGROUP
 0x02000000

	)

25 
	#CLONE_NEWUTS
 0x04000000

	)

26 
	#CLONE_NEWIPC
 0x08000000

	)

27 
	#CLONE_NEWUSER
 0x10000000

	)

28 
	#CLONE_NEWPID
 0x20000000

	)

29 
	#CLONE_NEWNET
 0x40000000

	)

30 
	#CLONE_IO
 0x80000000

	)

35 
	#SCHED_NORMAL
 0

	)

36 
	#SCHED_FIFO
 1

	)

37 
	#SCHED_RR
 2

	)

38 
	#SCHED_BATCH
 3

	)

40 
	#SCHED_IDLE
 5

	)

41 
	#SCHED_DEADLINE
 6

	)

44 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

49 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

	@/usr/include/linux/sockios.h

18 #i‚de‡
_LINUX_SOCKIOS_H


19 
	#_LINUX_SOCKIOS_H


	)

21 
	~<asm/sockios.h
>

24 
	#SIOCINQ
 
FIONREAD


	)

25 
	#SIOCOUTQ
 
TIOCOUTQ


	)

28 
	#SIOCADDRT
 0x890B

	)

29 
	#SIOCDELRT
 0x890C

	)

30 
	#SIOCRTMSG
 0x890D

	)

33 
	#SIOCGIFNAME
 0x8910

	)

34 
	#SIOCSIFLINK
 0x8911

	)

35 
	#SIOCGIFCONF
 0x8912

	)

36 
	#SIOCGIFFLAGS
 0x8913

	)

37 
	#SIOCSIFFLAGS
 0x8914

	)

38 
	#SIOCGIFADDR
 0x8915

	)

39 
	#SIOCSIFADDR
 0x8916

	)

40 
	#SIOCGIFDSTADDR
 0x8917

	)

41 
	#SIOCSIFDSTADDR
 0x8918

	)

42 
	#SIOCGIFBRDADDR
 0x8919

	)

43 
	#SIOCSIFBRDADDR
 0x891®

	)

44 
	#SIOCGIFNETMASK
 0x891b

	)

45 
	#SIOCSIFNETMASK
 0x891¯

	)

46 
	#SIOCGIFMETRIC
 0x891d

	)

47 
	#SIOCSIFMETRIC
 0x891ê

	)

48 
	#SIOCGIFMEM
 0x891‡

	)

49 
	#SIOCSIFMEM
 0x8920

	)

50 
	#SIOCGIFMTU
 0x8921

	)

51 
	#SIOCSIFMTU
 0x8922

	)

52 
	#SIOCSIFNAME
 0x8923

	)

53 
	#SIOCSIFHWADDR
 0x8924

	)

54 
	#SIOCGIFENCAP
 0x8925

	)

55 
	#SIOCSIFENCAP
 0x8926

	)

56 
	#SIOCGIFHWADDR
 0x8927

	)

57 
	#SIOCGIFSLAVE
 0x8929

	)

58 
	#SIOCSIFSLAVE
 0x8930

	)

59 
	#SIOCADDMULTI
 0x8931

	)

60 
	#SIOCDELMULTI
 0x8932

	)

61 
	#SIOCGIFINDEX
 0x8933

	)

62 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

63 
	#SIOCSIFPFLAGS
 0x8934

	)

64 
	#SIOCGIFPFLAGS
 0x8935

	)

65 
	#SIOCDIFADDR
 0x8936

	)

66 
	#SIOCSIFHWBROADCAST
 0x8937

	)

67 
	#SIOCGIFCOUNT
 0x8938

	)

69 
	#SIOCGIFBR
 0x8940

	)

70 
	#SIOCSIFBR
 0x8941

	)

72 
	#SIOCGIFTXQLEN
 0x8942

	)

73 
	#SIOCSIFTXQLEN
 0x8943

	)

78 
	#SIOCETHTOOL
 0x8946

	)

80 
	#SIOCGMIIPHY
 0x8947

	)

81 
	#SIOCGMIIREG
 0x8948

	)

82 
	#SIOCSMIIREG
 0x8949

	)

84 
	#SIOCWANDEV
 0x894A

	)

86 
	#SIOCOUTQNSD
 0x894B

	)

90 
	#SIOCDARP
 0x8953

	)

91 
	#SIOCGARP
 0x8954

	)

92 
	#SIOCSARP
 0x8955

	)

95 
	#SIOCDRARP
 0x8960

	)

96 
	#SIOCGRARP
 0x8961

	)

97 
	#SIOCSRARP
 0x8962

	)

101 
	#SIOCGIFMAP
 0x8970

	)

102 
	#SIOCSIFMAP
 0x8971

	)

106 
	#SIOCADDDLCI
 0x8980

	)

107 
	#SIOCDELDLCI
 0x8981

	)

109 
	#SIOCGIFVLAN
 0x8982

	)

110 
	#SIOCSIFVLAN
 0x8983

	)

114 
	#SIOCBONDENSLAVE
 0x8990

	)

115 
	#SIOCBONDRELEASE
 0x8991

	)

116 
	#SIOCBONDSETHWADDR
 0x8992

	)

117 
	#SIOCBONDSLAVEINFOQUERY
 0x8993

	)

118 
	#SIOCBONDINFOQUERY
 0x8994

	)

119 
	#SIOCBONDCHANGEACTIVE
 0x8995

	)

122 
	#SIOCBRADDBR
 0x89a0

	)

123 
	#SIOCBRDELBR
 0x89a1

	)

124 
	#SIOCBRADDIF
 0x89a2

	)

125 
	#SIOCBRDELIF
 0x89a3

	)

128 
	#SIOCSHWTSTAMP
 0x89b0

	)

129 
	#SIOCGHWTSTAMP
 0x89b1

	)

142 
	#SIOCDEVPRIVATE
 0x89F0

	)

148 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/math.h

23 #i‚def 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/m©h-ve˘‹.h
>

35 
	~<bôs/huge_vÆ.h
>

36 #ifde‡
__USE_ISOC99


37 
	~<bôs/huge_vÆf.h
>

38 
	~<bôs/huge_vÆl.h
>

41 
	~<bôs/öf.h
>

44 
	~<bôs/«n.h
>

48 
	~<bôs/m©hdef.h
>

55 
	#__SIMD_DECL
(
fun˘i⁄
Ë
	`__CONCAT
 (
__DECL_SIMD_
, fun˘i⁄)

	)

57 
	#__MATHCALL_VEC
(
fun˘i⁄
, 
suffix
, 
¨gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

59 
	`__MATHCALL
 (
fun˘i⁄
, 
suffix
, 
¨gs
)

	)

61 
	#__MATHDECL_VEC
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

63 
	`__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
)

	)

65 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

66 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

67 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

68 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

69 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

70 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

71 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

72 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

73 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

74 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

75 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

76 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

78 
	#_MdoubÀ_
 

	)

79 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<bôs/m©hˇŒs.h
>

84 #unde‡
_MdoubÀ_


85 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


86 #unde‡
_MdoubÀ_END_NAMESPACE


87 #unde‡
__MATH_PRECNAME


88 #unde‡
__MATH_DECLARING_DOUBLE


90 #ifde‡
__USE_ISOC99


96 #i‚de‡
_MÊﬂt_


97 
	#_MÊﬂt_
 

	)

99 
	#_MdoubÀ_
 
_MÊﬂt_


	)

100 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<bôs/m©hˇŒs.h
>

105 #unde‡
_MdoubÀ_


106 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


107 #unde‡
_MdoubÀ_END_NAMESPACE


108 #unde‡
__MATH_PRECNAME


109 #unde‡
__MATH_DECLARING_DOUBLE


111 #i‡!(
deföed
 
__NO_LONG_DOUBLE_MATH
 && deföed 
_LIBC
) \

112 || 
deföed
 
__LDBL_COMPAT
 \

113 || 
deföed
 
_LIBC_TEST


114 #ifde‡
__LDBL_COMPAT


116 #ifde‡
__USE_ISOC99


117 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

119 #ifde‡
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

121 
__∆dbl_√xâow¨df
)

122 
	`__©åibuã__
 ((
__c⁄°__
));

123 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

124 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

125 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

126 (
__x
, 
__y
),

127 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

131 #unde‡
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

133 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

134 
¨gs
, 
Æüs
)

	)

135 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

136 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

142 #i‚de‡
_Ml⁄g_doubÀ_


143 
	#_Ml⁄g_doubÀ_
 

	)

145 
	#_MdoubÀ_
 
_Ml⁄g_doubÀ_


	)

146 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<bôs/m©hˇŒs.h
>

152 #unde‡
_MdoubÀ_


153 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


154 #unde‡
_MdoubÀ_END_NAMESPACE


155 #unde‡
__MATH_PRECNAME


156 #unde‡
__MATH_DECLARING_DOUBLE


161 #unde‡
__MATHDECL_1


162 #unde‡
__MATHDECL


163 #unde‡
__MATHCALL


166 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


168 
signgam
;

173 #ifde‡
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
 \

234 && !
deföed
 
__OPTIMIZE_SIZE__


235 
	#Â˛assify
(
x
Ë
	`__buûtö_Â˛assify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


238 
	#Â˛assify
(
x
) \

239 ( (
x
Ë= (Ë? 
	`__Â˛assifyf
 (xË: 
	`__Â˛assify
 (x))

	)

241 
	#Â˛assify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__Â˛assifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__Â˛assify
 (
x
Ë: 
	`__Â˛assifyl
 (x))

	)

249 #i‡
	`__GNUC_PREREQ
 (4,0)

250 
	#signbô
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__buûtö_signbôf
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__buûtö_signbô
 (
x
Ë: 
	`__buûtö_signbôl
 (x))

	)

256 #ifde‡
__NO_LONG_DOUBLE_MATH


257 
	#signbô
(
x
) \

258 ( (
x
Ë= (Ë? 
	`__signbôf
 (xË: 
	`__signbô
 (x))

	)

260 
	#signbô
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signbôf
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signbô
 (
x
Ë: 
	`__signbôl
 (x))

	)

269 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


270 
	#isföôe
(
x
Ë
	`__buûtö_isföôe
 (x)

	)

271 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


272 
	#isföôe
(
x
) \

273 ( (
x
Ë= (Ë? 
	`__föôef
 (xË: 
	`__föôe
 (x))

	)

275 
	#isföôe
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__föôef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__föôe
 (
x
Ë: 
	`__föôñ
 (x))

	)

283 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


284 
	#i¢‹mÆ
(
x
Ë
	`__buûtö_i¢‹mÆ
 (x)

	)

286 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

291 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


292 
	#i¢™
(
x
Ë
	`__buûtö_i¢™
 (x)

	)

293 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢™
(
x
) \

295 ( (
x
Ë= (Ë? 
	`__i¢™f
 (xË: 
	`__i¢™
 (x))

	)

297 
	#i¢™
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢™f
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢™
 (
x
Ë: 
	`__i¢™l
 (x))

	)

305 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


306 
	#isöf
(
x
Ë
	`__buûtö_isöf_sign
 (x)

	)

307 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


308 
	#isöf
(
x
) \

309 ( (
x
Ë= (Ë? 
	`__isöff
 (xË: 
	`__isöf
 (x))

	)

311 
	#isöf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isöff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isöf
 (
x
Ë: 
	`__isöÊ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #i‚de‡
__FAST_MATH__


326 
	#m©h_îrh™dlög
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifde‡
__USE_GNU


333 #ifde‡
__NO_LONG_DOUBLE_MATH


334 
	#issig«lög
(
x
) \

335 ( (
x
Ë= (Ë? 
	`__issig«lögf
 (xË: 
	`__issig«lög
 (x))

	)

337 
	#issig«lög
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issig«lögf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issig«lög
 (
x
Ë: 
	`__issig«lögl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifde‡
__USE_MISC


369 #ifde‡
__˝lu•lus


370 
__ex˚±i⁄


372 
ex˚±i⁄


375 
ty≥
;

376 *
«me
;

377 
¨g1
;

378 
¨g2
;

379 
ªtvÆ
;

380 
	}
};

382 #ifde‡
__˝lu•lus


383 
	$m©hîr
 (
__ex˚±i⁄
 *
__exc
Ë
	`throw
 ();

385 
	`m©hîr
 (
ex˚±i⁄
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifde‡
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifde‡
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #i‡
deföed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

463 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

464 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

465 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

466 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

467 
	#isun‹dîed
(
u
, 
v
Ë
	`__buûtö_isun‹dîed
(u, v)

	)

471 #ifde‡
__USE_EXTERN_INLINES


472 
	~<bôs/m©hölöe.h
>

477 #i‡
deföed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<bôs/m©h-föôe.h
>

481 #ifde‡
__USE_ISOC99


485 #i‚de‡
isgª©î


486 
	#isgª©î
(
x
, 
y
) \

487 (
__exãnsi⁄__
 \

488 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

489 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; 
	}
}))

	)

493 #i‚de‡
isgª©îequÆ


494 
	#isgª©îequÆ
(
x
, 
y
) \

495 (
__exãnsi⁄__
 \

496 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

497 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

501 #i‚de‡
i¶ess


502 
	#i¶ess
(
x
, 
y
) \

503 (
__exãnsi⁄__
 \

504 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

505 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

509 #i‚de‡
i¶es£quÆ


510 
	#i¶es£quÆ
(
x
, 
y
) \

511 (
__exãnsi⁄__
 \

512 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

513 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

517 #i‚de‡
i¶essgª©î


518 
	#i¶essgª©î
(
x
, 
y
) \

519 (
__exãnsi⁄__
 \

520 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

521 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& (__x < __y || __y < __x); }))

	)

525 #i‚de‡
isun‹dîed


526 
	#isun‹dîed
(
u
, 
v
) \

527 (
__exãnsi⁄__
 \

528 ({ 
	`__ty≥of__
(
u
Ë
__u
 = (u); __ty≥of__(
v
Ë
__v
 = (v); \

529 
	`Â˛assify
 (
__u
Ë=
FP_NAN
 || fp˛assify (
__v
Ë=FP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/net/if.h

19 #i‚de‡
_NET_IF_H


20 
	#_NET_IF_H
 1

	)

22 
	~<„©uªs.h
>

24 #ifde‡
__USE_MISC


25 
	~<sys/ty≥s.h
>

26 
	~<sys/sockë.h
>

31 
	#IF_NAMESIZE
 16

	)

33 
	sif_«meödex


35 
	mif_ödex
;

36 *
	mif_«me
;

40 #ifde‡
__USE_MISC


44 
	mIFF_UP
 = 0x1,

45 
	#IFF_UP
 
IFF_UP


	)

46 
	mIFF_BROADCAST
 = 0x2,

47 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

48 
	mIFF_DEBUG
 = 0x4,

49 
	#IFF_DEBUG
 
IFF_DEBUG


	)

50 
	mIFF_LOOPBACK
 = 0x8,

51 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

52 
	mIFF_POINTOPOINT
 = 0x10,

53 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

54 
	mIFF_NOTRAILERS
 = 0x20,

55 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

56 
	mIFF_RUNNING
 = 0x40,

57 
	#IFF_RUNNING
 
IFF_RUNNING


	)

58 
	mIFF_NOARP
 = 0x80,

59 
	#IFF_NOARP
 
IFF_NOARP


	)

60 
	mIFF_PROMISC
 = 0x100,

61 
	#IFF_PROMISC
 
IFF_PROMISC


	)

64 
	mIFF_ALLMULTI
 = 0x200,

65 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

67 
	mIFF_MASTER
 = 0x400,

68 
	#IFF_MASTER
 
IFF_MASTER


	)

69 
	mIFF_SLAVE
 = 0x800,

70 
	#IFF_SLAVE
 
IFF_SLAVE


	)

72 
	mIFF_MULTICAST
 = 0x1000,

73 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

75 
	mIFF_PORTSEL
 = 0x2000,

76 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

77 
	mIFF_AUTOMEDIA
 = 0x4000,

78 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

79 
	mIFF_DYNAMIC
 = 0x8000

80 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

88 
	siÁddr


90 
sockaddr
 
	miÁ_addr
;

93 
sockaddr
 
	mifu_brﬂdaddr
;

94 
sockaddr
 
	mifu_d°addr
;

95 } 
	miÁ_ifu
;

96 
iÁ˚
 *
	miÁ_iÂ
;

97 
iÁddr
 *
	miÁ_√xt
;

100 
	#iÁ_brﬂdaddr
 
iÁ_ifu
.
ifu_brﬂdaddr


	)

101 
	#iÁ_d°addr
 
iÁ_ifu
.
ifu_d°addr


	)

111 
	sifm≠


113 
	mmem_°¨t
;

114 
	mmem_íd
;

115 
	mba£_addr
;

116 
	múq
;

117 
	mdma
;

118 
	mp‹t
;

126 
	si‰eq


128 
	#IFHWADDRLEN
 6

	)

129 
	#IFNAMSIZ
 
IF_NAMESIZE


	)

132 
	mi‰n_«me
[
IFNAMSIZ
];

133 } 
	mi‰_i‰n
;

137 
sockaddr
 
	mi‰u_addr
;

138 
sockaddr
 
	mi‰u_d°addr
;

139 
sockaddr
 
	mi‰u_brﬂdaddr
;

140 
sockaddr
 
	mi‰u_√tmask
;

141 
sockaddr
 
	mi‰u_hwaddr
;

142 
	mi‰u_Êags
;

143 
	mi‰u_ivÆue
;

144 
	mi‰u_mtu
;

145 
ifm≠
 
	mi‰u_m≠
;

146 
	mi‰u_¶ave
[
IFNAMSIZ
];

147 
	mi‰u_√w«me
[
IFNAMSIZ
];

148 
__ˇddr_t
 
	mi‰u_d©a
;

149 } 
	mi‰_i‰u
;

151 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

152 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

153 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

154 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

155 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

156 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

157 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

158 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

159 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

160 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

161 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

162 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

163 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

164 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

165 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

166 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

167 
	#_IOT_i‰eq
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),16,0,0)

	)

168 
	#_IOT_i‰eq_sh‹t
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

169 
	#_IOT_i‰eq_öt
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

176 
	sifc⁄f


178 
	mifc_Àn
;

181 
__ˇddr_t
 
	mifcu_buf
;

182 
i‰eq
 *
	mifcu_ªq
;

183 } 
	mifc_ifcu
;

185 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

186 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

187 
	#_IOT_ifc⁄f
 
	`_IOT
(
	`_IOTS
(
ifc⁄f
),1,0,0,0,0Ë

	)

190 
__BEGIN_DECLS


193 
	$if_«mëoödex
 (c⁄° *
__i‚ame
Ë
__THROW
;

194 *
	$if_ödext⁄ame
 (
__ifödex
, *
__i‚ame
Ë
__THROW
;

197 
if_«meödex
 *
	$if_«meödex
 (Ë
__THROW
;

200 
	$if_‰ì«meödex
 (
if_«meödex
 *
__±r
Ë
__THROW
;

202 
__END_DECLS


	@/usr/include/netinet/in.h

18 #i‚def 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<°döt.h
>

23 
	~<sys/sockë.h
>

24 
	~<bôs/ty≥s.h
>

27 
__BEGIN_DECLS


30 
uöt32_t
 
	tö_addr_t
;

31 
	sö_addr


33 
ö_addr_t
 
	ms_addr
;

37 
	~<bôs/ö.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #i‚de‡
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
uöt16_t
 
	tö_p‹t_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
Ë((((
ö_addr_t
)◊)Ë& 0x80000000Ë=0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffff‡& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xc0000000Ë=0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffff‡& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffff‡& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
Ë
	`IN_CLASSD
◊)

	)

186 
	#IN_EXPERIMENTAL
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xf0000000)

	)

190 
	#INADDR_ANY
 ((
ö_addr_t
Ë0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
ö_addr_t
Ë0xffffffff)

	)

194 
	#INADDR_NONE
 ((
ö_addr_t
Ë0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #i‚de‡
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
ö_addr_t
Ë0x7f000001Ë

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
ö_addr_t
Ë0xe0000000Ë

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
ö_addr_t
Ë0xe0000001Ë

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
ö_addr_t
Ë0xe0000002Ë

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
ö_addr_t
Ë0xe00000ffË

	)

209 #i‚de‡
__USE_KERNEL_IPV6_DEFS


211 
	sö6_addr


215 
uöt8_t
 
	m__u6_addr8
[16];

216 #ifde‡
__USE_MISC


217 
uöt16_t
 
	m__u6_addr16
[8];

218 
uöt32_t
 
	m__u6_addr32
[4];

220 } 
	m__ö6_u
;

221 
	#s6_addr
 
__ö6_u
.
__u6_addr8


	)

222 #ifde‡
__USE_MISC


223 
	#s6_addr16
 
__ö6_u
.
__u6_addr16


	)

224 
	#s6_addr32
 
__ö6_u
.
__u6_addr32


	)

229 c⁄° 
ö6_addr
 
ö6addr_™y
;

230 c⁄° 
ö6_addr
 
ö6addr_lo›back
;

231 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

232 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

234 
	#INET_ADDRSTRLEN
 16

	)

235 
	#INET6_ADDRSTRLEN
 46

	)

239 
	ssockaddr_ö


241 
__SOCKADDR_COMMON
 (
sö_
);

242 
ö_p‹t_t
 
	msö_p‹t
;

243 
ö_addr
 
	msö_addr
;

246 
	msö_zîo
[ (
sockaddr
) -

247 
__SOCKADDR_COMMON_SIZE
 -

248  (
ö_p‹t_t
) -

249  (
ö_addr
)];

252 #i‚de‡
__USE_KERNEL_IPV6_DEFS


254 
	ssockaddr_ö6


256 
__SOCKADDR_COMMON
 (
sö6_
);

257 
ö_p‹t_t
 
	msö6_p‹t
;

258 
uöt32_t
 
	msö6_Êowöfo
;

259 
ö6_addr
 
	msö6_addr
;

260 
uöt32_t
 
	msö6_sc›e_id
;

264 #ifde‡
__USE_MISC


266 
	sù_mªq


269 
ö_addr
 
	mimr_mu…üddr
;

272 
ö_addr
 
	mimr_öãrÁ˚
;

275 
	sù_mªq_sour˚


278 
ö_addr
 
	mimr_mu…üddr
;

281 
ö_addr
 
	mimr_öãrÁ˚
;

284 
ö_addr
 
	mimr_sour˚addr
;

288 #i‚de‡
__USE_KERNEL_IPV6_DEFS


290 
	sùv6_mªq


293 
ö6_addr
 
	mùv6mr_mu…üddr
;

296 
	mùv6mr_öãrÁ˚
;

300 #ifde‡
__USE_MISC


302 
	sgroup_ªq


305 
uöt32_t
 
	mgr_öãrÁ˚
;

308 
sockaddr_°‹age
 
	mgr_group
;

311 
	sgroup_sour˚_ªq


314 
uöt32_t
 
	mg§_öãrÁ˚
;

317 
sockaddr_°‹age
 
	mg§_group
;

320 
sockaddr_°‹age
 
	mg§_sour˚
;

325 
	sù_msfûãr


328 
ö_addr
 
	mimsf_mu…üddr
;

331 
ö_addr
 
	mimsf_öãrÁ˚
;

334 
uöt32_t
 
	mimsf_fmode
;

337 
uöt32_t
 
	mimsf_num§c
;

339 
ö_addr
 
	mimsf_¶i°
[1];

342 
	#IP_MSFILTER_SIZE
(
num§c
Ë( (
ù_msfûãr
) \

343 -  (
ö_addr
) \

344 + (
num§c
Ë*  (
ö_addr
))

	)

346 
	sgroup_fûãr


349 
uöt32_t
 
	mgf_öãrÁ˚
;

352 
sockaddr_°‹age
 
	mgf_group
;

355 
uöt32_t
 
	mgf_fmode
;

358 
uöt32_t
 
	mgf_num§c
;

360 
sockaddr_°‹age
 
	mgf_¶i°
[1];

363 
	#GROUP_FILTER_SIZE
(
num§c
Ë( (
group_fûãr
) \

364 -  (
sockaddr_°‹age
) \

365 + ((
num§c
) \

366 *  (
sockaddr_°‹age
)))

	)

376 
uöt32_t
 
	$¡ohl
 (
uöt32_t
 
__√é⁄g
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

377 
uöt16_t
 
	$¡ohs
 (
uöt16_t
 
__√tsh‹t
)

378 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

379 
uöt32_t
 
	$ht⁄l
 (
uöt32_t
 
__ho°l⁄g
)

380 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

381 
uöt16_t
 
	$ht⁄s
 (
uöt16_t
 
__ho°sh‹t
)

382 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

384 
	~<ídün.h
>

387 
	~<bôs/byãsw≠.h
>

389 #ifde‡
__OPTIMIZE__


393 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


396 
	#¡ohl
(
x
Ë(x)

	)

397 
	#¡ohs
(
x
Ë(x)

	)

398 
	#ht⁄l
(
x
Ë(x)

	)

399 
	#ht⁄s
(
x
Ë(x)

	)

401 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


402 
	#¡ohl
(
x
Ë
	`__bsw≠_32
 (x)

	)

403 
	#¡ohs
(
x
Ë
	`__bsw≠_16
 (x)

	)

404 
	#ht⁄l
(
x
Ë
	`__bsw≠_32
 (x)

	)

405 
	#ht⁄s
(
x
Ë
	`__bsw≠_16
 (x)

	)

410 #ifde‡
__GNUC__


411 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

412 (
__exãnsi⁄__
 \

413 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

414 
__a
->
s6_addr32
[0] == 0 \

415 && 
__a
->
s6_addr32
[1] == 0 \

416 && 
__a
->
s6_addr32
[2] == 0 \

417 && 
__a
->
s6_addr32
[3] =0; 
	}
}))

	)

419 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

420 (
__exãnsi⁄__
 \

421 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

422 
__a
->
s6_addr32
[0] == 0 \

423 && 
__a
->
s6_addr32
[1] == 0 \

424 && 
__a
->
s6_addr32
[2] == 0 \

425 && 
__a
->
s6_addr32
[3] =
	`ht⁄l
 (1); }))

	)

427 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

428 (
__exãnsi⁄__
 \

429 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

430 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„800000); }))

	)

432 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

433 (
__exãnsi⁄__
 \

434 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

435 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„c00000); }))

	)

437 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

438 (
__exãnsi⁄__
 \

439 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

440 
__a
->
s6_addr32
[0] == 0 \

441 && 
__a
->
s6_addr32
[1] == 0 \

442 && 
__a
->
s6_addr32
[2] =
	`ht⁄l
 (0xffff); }))

	)

444 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

445 (
__exãnsi⁄__
 \

446 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

447 
__a
->
s6_addr32
[0] == 0 \

448 && 
__a
->
s6_addr32
[1] == 0 \

449 && 
__a
->
s6_addr32
[2] == 0 \

450 && 
	`¡ohl
 (
__a
->
s6_addr32
[3]Ë> 1; }))

	)

452 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

453 (
__exãnsi⁄__
 \

454 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

455 c⁄° 
ö6_addr
 *
__b
 = (c⁄° ö6_add∏*Ë(
b
); \

456 
__a
->
s6_addr32
[0] =
__b
->s6_addr32[0] \

457 && 
__a
->
s6_addr32
[1] =
__b
->s6_addr32[1] \

458 && 
__a
->
s6_addr32
[2] =
__b
->s6_addr32[2] \

459 && 
__a
->
s6_addr32
[3] =
__b
->s6_addr32[3]; }))

	)

461 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

462 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

463 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

464 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

465 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =0)

	)

467 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

468 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

469 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

470 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

471 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =
	`ht⁄l
 (1))

	)

473 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

474 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

475 =
	`ht⁄l
 (0x„800000))

	)

477 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

478 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

479 =
	`ht⁄l
 (0x„c00000))

	)

481 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

482 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

483 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

484 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =
	`ht⁄l
 (0xffff)))

	)

486 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

487 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

488 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

489 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0) \

490 && (
	`¡ohl
 (((c⁄° 
uöt32_t
 *Ë(
a
))[3]Ë> 1))

	)

492 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

493 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] =((c⁄° uöt32_à*Ë(
b
))[0]) \

494 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] =((c⁄° uöt32_à*Ë(
b
))[1]) \

495 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =((c⁄° uöt32_à*Ë(
b
))[2]) \

496 && (((c⁄° 
uöt32_t
 *Ë(
a
))[3] =((c⁄° uöt32_à*Ë(
b
))[3]))

	)

499 
	#IN6_IS_ADDR_MULTICAST
(
a
Ë(((c⁄° 
uöt8_t
 *Ë◊))[0] =0xff)

	)

501 #ifde‡
__USE_MISC


503 
	$bödªsvp‹t
 (
__sockfd
, 
sockaddr_ö
 *
__sock_ö
Ë
__THROW
;

506 
	$bödªsvp‹t6
 (
__sockfd
, 
sockaddr_ö6
 *
__sock_ö
)

507 
__THROW
;

511 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

512 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

513 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x1))

	)

515 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

516 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

517 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x2))

	)

519 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

520 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

521 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x5))

	)

523 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

524 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

525 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x8))

	)

527 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

528 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

529 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0xe))

	)

532 #ifde‡
__USE_GNU


533 
cmsghdr
;

535 #i‚de‡
__USE_KERNEL_IPV6_DEFS


537 
	sö6_pktöfo


539 
ö6_addr
 
ùi6_addr
;

540 
ùi6_ifödex
;

544 
	sù6_mtuöfo


546 
sockaddr_ö6
 
ù6m_addr
;

547 
uöt32_t
 
ù6m_mtu
;

552 
	$öë6_›ti⁄_•a˚
 (
__nbyãs
)

553 
__THROW
 
__©åibuã_dïªˇãd__
;

554 
	$öë6_›ti⁄_öô
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

555 
__ty≥
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

556 
	$öë6_›ti⁄_≠≥nd
 (
cmsghdr
 *
__cmsg
,

557 c⁄° 
uöt8_t
 *
__ty≥p
, 
__mu…x
,

558 
__∂usy
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

559 
uöt8_t
 *
	$öë6_›ti⁄_Æloc
 (
cmsghdr
 *
__cmsg
, 
__d©Æí
,

560 
__mu…x
, 
__∂usy
)

561 
__THROW
 
__©åibuã_dïªˇãd__
;

562 
	$öë6_›ti⁄_√xt
 (c⁄° 
cmsghdr
 *
__cmsg
,

563 
uöt8_t
 **
__çåp
)

564 
__THROW
 
__©åibuã_dïªˇãd__
;

565 
	$öë6_›ti⁄_föd
 (c⁄° 
cmsghdr
 *
__cmsg
,

566 
uöt8_t
 **
__çåp
, 
__ty≥
)

567 
__THROW
 
__©åibuã_dïªˇãd__
;

571 
	$öë6_›t_öô
 (*
__extbuf
, 
sockÀn_t
 
__exéí
Ë
__THROW
;

572 
	$öë6_›t_≠≥nd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

573 
uöt8_t
 
__ty≥
, 
sockÀn_t
 
__Àn
, uöt8_à
__Æign
,

574 **
__d©abuÂ
Ë
__THROW
;

575 
	$öë6_›t_föish
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
)

576 
__THROW
;

577 
	$öë6_›t_£t_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

578 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

579 
	$öë6_›t_√xt
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

580 
uöt8_t
 *
__ty≥p
, 
sockÀn_t
 *
__À≈
,

581 **
__d©abuÂ
Ë
__THROW
;

582 
	$öë6_›t_föd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

583 
uöt8_t
 
__ty≥
, 
sockÀn_t
 *
__À≈
,

584 **
__d©abuÂ
Ë
__THROW
;

585 
	$öë6_›t_gë_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

586 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

590 
sockÀn_t
 
	$öë6_πh_•a˚
 (
__ty≥
, 
__£gmíts
Ë
__THROW
;

591 *
	$öë6_πh_öô
 (*
__bp
, 
sockÀn_t
 
__bp_Àn
, 
__ty≥
,

592 
__£gmíts
Ë
__THROW
;

593 
	$öë6_πh_add
 (*
__bp
, c⁄° 
ö6_addr
 *
__addr
Ë
__THROW
;

594 
	$öë6_πh_ªvî£
 (c⁄° *
__ö
, *
__out
Ë
__THROW
;

595 
	$öë6_πh_£gmíts
 (c⁄° *
__bp
Ë
__THROW
;

596 
ö6_addr
 *
	$öë6_πh_gëaddr
 (c⁄° *
__bp
, 
__ödex
)

597 
__THROW
;

603 
	$gëùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

604 
ö_addr
 
__group
, 
uöt32_t
 *
__fmode
,

605 
uöt32_t
 *
__num§c
, 
ö_addr
 *
__¶i°
)

606 
__THROW
;

609 
	$£tùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

610 
ö_addr
 
__group
, 
uöt32_t
 
__fmode
,

611 
uöt32_t
 
__num§c
,

612 c⁄° 
ö_addr
 *
__¶i°
)

613 
__THROW
;

617 
	$gësour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

618 c⁄° 
sockaddr
 *
__group
,

619 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 *
__fmode
,

620 
uöt32_t
 *
__num§c
,

621 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

624 
	$£tsour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

625 c⁄° 
sockaddr
 *
__group
,

626 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 
__fmode
,

627 
uöt32_t
 
__num§c
,

628 c⁄° 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

631 
__END_DECLS


	@/usr/include/netinet/tcp.h

32 #i‚de‡
_NETINET_TCP_H


33 
	#_NETINET_TCP_H
 1

	)

35 
	~<„©uªs.h
>

40 
	#TCP_NODELAY
 1

	)

41 
	#TCP_MAXSEG
 2

	)

42 
	#TCP_CORK
 3

	)

43 
	#TCP_KEEPIDLE
 4

	)

44 
	#TCP_KEEPINTVL
 5

	)

45 
	#TCP_KEEPCNT
 6

	)

46 
	#TCP_SYNCNT
 7

	)

47 
	#TCP_LINGER2
 8

	)

48 
	#TCP_DEFER_ACCEPT
 9

	)

49 
	#TCP_WINDOW_CLAMP
 10

	)

50 
	#TCP_INFO
 11

	)

51 
	#TCP_QUICKACK
 12

	)

52 
	#TCP_CONGESTION
 13

	)

53 
	#TCP_MD5SIG
 14

	)

54 
	#TCP_COOKIE_TRANSACTIONS
 15

	)

55 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

56 
	#TCP_THIN_DUPACK
 17

	)

57 
	#TCP_USER_TIMEOUT
 18

	)

58 
	#TCP_REPAIR
 19

	)

59 
	#TCP_REPAIR_QUEUE
 20

	)

60 
	#TCP_QUEUE_SEQ
 21

	)

61 
	#TCP_REPAIR_OPTIONS
 22

	)

62 
	#TCP_FASTOPEN
 23

	)

63 
	#TCP_TIMESTAMP
 24

	)

64 
	#TCP_NOTSENT_LOWAT
 25

	)

66 
	#TCP_CC_INFO
 26

	)

68 
	#TCP_SAVE_SYN
 27

	)

70 
	#TCP_SAVED_SYN
 28

	)

73 #ifde‡
__USE_MISC


74 
	~<sys/ty≥s.h
>

75 
	~<sys/sockë.h
>

77 
u_öt32_t
 
	tt˝_£q
;

82 
	st˝hdr


84 
__exãnsi⁄__
 union

88 
u_öt16_t
 
	mth_•‹t
;

89 
u_öt16_t
 
	mth_dp‹t
;

90 
t˝_£q
 
	mth_£q
;

91 
t˝_£q
 
	mth_ack
;

92 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


93 
u_öt8_t
 
	mth_x2
:4;

94 
u_öt8_t
 
	mth_off
:4;

96 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


97 
u_öt8_t
 
	mth_off
:4;

98 
u_öt8_t
 
	mth_x2
:4;

100 
u_öt8_t
 
	mth_Êags
;

101 
	#TH_FIN
 0x01

	)

102 
	#TH_SYN
 0x02

	)

103 
	#TH_RST
 0x04

	)

104 
	#TH_PUSH
 0x08

	)

105 
	#TH_ACK
 0x10

	)

106 
	#TH_URG
 0x20

	)

107 
u_öt16_t
 
	mth_wö
;

108 
u_öt16_t
 
	mth_sum
;

109 
u_öt16_t
 
	mth_uΩ
;

113 
u_öt16_t
 
	msour˚
;

114 
u_öt16_t
 
	mde°
;

115 
u_öt32_t
 
	m£q
;

116 
u_öt32_t
 
	mack_£q
;

117 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


118 
u_öt16_t
 
	mªs1
:4;

119 
u_öt16_t
 
	mdoff
:4;

120 
u_öt16_t
 
	mfö
:1;

121 
u_öt16_t
 
	msyn
:1;

122 
u_öt16_t
 
	mr°
:1;

123 
u_öt16_t
 
	mpsh
:1;

124 
u_öt16_t
 
	mack
:1;

125 
u_öt16_t
 
	murg
:1;

126 
u_öt16_t
 
	mªs2
:2;

127 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


128 
u_öt16_t
 
	mdoff
:4;

129 
u_öt16_t
 
	mªs1
:4;

130 
u_öt16_t
 
	mªs2
:2;

131 
u_öt16_t
 
	murg
:1;

132 
u_öt16_t
 
	mack
:1;

133 
u_öt16_t
 
	mpsh
:1;

134 
u_öt16_t
 
	mr°
:1;

135 
u_öt16_t
 
	msyn
:1;

136 
u_öt16_t
 
	mfö
:1;

140 
u_öt16_t
 
	mwödow
;

141 
u_öt16_t
 
	mcheck
;

142 
u_öt16_t
 
	murg_±r
;

149 
	mTCP_ESTABLISHED
 = 1,

150 
	mTCP_SYN_SENT
,

151 
	mTCP_SYN_RECV
,

152 
	mTCP_FIN_WAIT1
,

153 
	mTCP_FIN_WAIT2
,

154 
	mTCP_TIME_WAIT
,

155 
	mTCP_CLOSE
,

156 
	mTCP_CLOSE_WAIT
,

157 
	mTCP_LAST_ACK
,

158 
	mTCP_LISTEN
,

159 
	mTCP_CLOSING


162 
	#TCPOPT_EOL
 0

	)

163 
	#TCPOPT_NOP
 1

	)

164 
	#TCPOPT_MAXSEG
 2

	)

165 
	#TCPOLEN_MAXSEG
 4

	)

166 
	#TCPOPT_WINDOW
 3

	)

167 
	#TCPOLEN_WINDOW
 3

	)

168 
	#TCPOPT_SACK_PERMITTED
 4

	)

169 
	#TCPOLEN_SACK_PERMITTED
 2

	)

170 
	#TCPOPT_SACK
 5

	)

171 
	#TCPOPT_TIMESTAMP
 8

	)

172 
	#TCPOLEN_TIMESTAMP
 10

	)

173 
	#TCPOLEN_TSTAMP_APPA
 (
TCPOLEN_TIMESTAMP
+2Ë

	)

175 
	#TCPOPT_TSTAMP_HDR
 \

176 (
TCPOPT_NOP
<<24|TCPOPT_NOP<<16|
TCPOPT_TIMESTAMP
<<8|
TCPOLEN_TIMESTAMP
)

	)

184 
	#TCP_MSS
 512

	)

186 
	#TCP_MAXWIN
 65535

	)

188 
	#TCP_MAX_WINSHIFT
 14

	)

190 
	#SOL_TCP
 6

	)

193 
	#TCPI_OPT_TIMESTAMPS
 1

	)

194 
	#TCPI_OPT_SACK
 2

	)

195 
	#TCPI_OPT_WSCALE
 4

	)

196 
	#TCPI_OPT_ECN
 8

	)

197 
	#TCPI_OPT_ECN_SEEN
 16

	)

198 
	#TCPI_OPT_SYN_DATA
 32

	)

201 
	et˝_ˇ_°©e


203 
	mTCP_CA_O≥n
 = 0,

204 
	mTCP_CA_Dis‹dî
 = 1,

205 
	mTCP_CA_CWR
 = 2,

206 
	mTCP_CA_Recovîy
 = 3,

207 
	mTCP_CA_Loss
 = 4

210 
	st˝_öfo


212 
u_öt8_t
 
	mt˝i_°©e
;

213 
u_öt8_t
 
	mt˝i_ˇ_°©e
;

214 
u_öt8_t
 
	mt˝i_ªå™smôs
;

215 
u_öt8_t
 
	mt˝i_¥obes
;

216 
u_öt8_t
 
	mt˝i_backoff
;

217 
u_öt8_t
 
	mt˝i_›ti⁄s
;

218 
u_öt8_t
 
	mt˝i_¢d_wsˇÀ
 : 4, 
	mt˝i_rcv_wsˇÀ
 : 4;

220 
u_öt32_t
 
	mt˝i_πo
;

221 
u_öt32_t
 
	mt˝i_©o
;

222 
u_öt32_t
 
	mt˝i_¢d_mss
;

223 
u_öt32_t
 
	mt˝i_rcv_mss
;

225 
u_öt32_t
 
	mt˝i_u«cked
;

226 
u_öt32_t
 
	mt˝i_ßcked
;

227 
u_öt32_t
 
	mt˝i_lo°
;

228 
u_öt32_t
 
	mt˝i_ªå™s
;

229 
u_öt32_t
 
	mt˝i_Áckës
;

232 
u_öt32_t
 
	mt˝i_œ°_d©a_£¡
;

233 
u_öt32_t
 
	mt˝i_œ°_ack_£¡
;

234 
u_öt32_t
 
	mt˝i_œ°_d©a_ªcv
;

235 
u_öt32_t
 
	mt˝i_œ°_ack_ªcv
;

238 
u_öt32_t
 
	mt˝i_pmtu
;

239 
u_öt32_t
 
	mt˝i_rcv_s°hªsh
;

240 
u_öt32_t
 
	mt˝i_πt
;

241 
u_öt32_t
 
	mt˝i_πtv¨
;

242 
u_öt32_t
 
	mt˝i_¢d_s°hªsh
;

243 
u_öt32_t
 
	mt˝i_¢d_cwnd
;

244 
u_öt32_t
 
	mt˝i_advmss
;

245 
u_öt32_t
 
	mt˝i_ª‹dîög
;

247 
u_öt32_t
 
	mt˝i_rcv_πt
;

248 
u_öt32_t
 
	mt˝i_rcv_•a˚
;

250 
u_öt32_t
 
	mt˝i_tŸÆ_ªå™s
;

255 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

257 
	st˝_md5sig


259 
sockaddr_°‹age
 
	mt˝m_addr
;

260 
u_öt16_t
 
	m__t˝m_∑d1
;

261 
u_öt16_t
 
	mt˝m_keyÀn
;

262 
u_öt32_t
 
	m__t˝m_∑d2
;

263 
u_öt8_t
 
	mt˝m_key
[
TCP_MD5SIG_MAXKEYLEN
];

267 
	st˝_ª∑ú_›t


269 
u_öt32_t
 
	m›t_code
;

270 
u_öt32_t
 
	m›t_vÆ
;

276 
	mTCP_NO_QUEUE
,

277 
	mTCP_RECV_QUEUE
,

278 
	mTCP_SEND_QUEUE
,

279 
	mTCP_QUEUES_NR
,

283 
	#TCP_COOKIE_MIN
 8

	)

284 
	#TCP_COOKIE_MAX
 16

	)

285 
	#TCP_COOKIE_PAIR_SIZE
 (2*
TCP_COOKIE_MAX
)

	)

288 
	#TCP_COOKIE_IN_ALWAYS
 (1 << 0Ë

	)

289 
	#TCP_COOKIE_OUT_NEVER
 (1 << 1Ë

	)

293 
	#TCP_S_DATA_IN
 (1 << 2Ë

	)

294 
	#TCP_S_DATA_OUT
 (1 << 3Ë

	)

296 
	#TCP_MSS_DEFAULT
 536U

	)

297 
	#TCP_MSS_DESIRED
 1220U

	)

299 
	st˝_cookõ_å™ß˘i⁄s


301 
u_öt16_t
 
	mt˝˘_Êags
;

302 
u_öt8_t
 
	m__t˝˘_∑d1
;

303 
u_öt8_t
 
	mt˝˘_cookõ_desúed
;

304 
u_öt16_t
 
	mt˝˘_s_d©a_desúed
;

305 
u_öt16_t
 
	mt˝˘_u£d
;

306 
u_öt8_t
 
	mt˝˘_vÆue
[
TCP_MSS_DEFAULT
];

	@/usr/include/pthread.h

18 #i‚de‡
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<ídün.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<bôs/±hªadty≥s.h
>

27 
	~<bôs/£tjmp.h
>

28 
	~<bôs/w‹dsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifde‡
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifde‡
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


85 #ifde‡
__PTHREAD_MUTEX_HAVE_PREV


86 
	#PTHREAD_MUTEX_INITIALIZER
 \

87 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

88 #ifde‡
__USE_GNU


89 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

90 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

91 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

92 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

93 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

94 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

98 
	#PTHREAD_MUTEX_INITIALIZER
 \

99 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

100 #ifde‡
__USE_GNU


101 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

102 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

103 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

105 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

113 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


116 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

117 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

119 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


125 #i‚de‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


126 #i‡
__WORDSIZE
 == 64

127 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

132 
	#PTHREAD_RWLOCK_INITIALIZER
 \

133 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

134 #ifde‡
__USE_GNU


135 #ifde‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


136 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

137 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

138 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

140 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


141 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

142 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

143 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

145 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

146 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

147 0 } }

	)

157 
	mPTHREAD_INHERIT_SCHED
,

158 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

159 
	mPTHREAD_EXPLICIT_SCHED


160 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

167 
	mPTHREAD_SCOPE_SYSTEM
,

168 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

169 
	mPTHREAD_SCOPE_PROCESS


170 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

177 
	mPTHREAD_PROCESS_PRIVATE
,

178 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

179 
	mPTHREAD_PROCESS_SHARED


180 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

186 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*Ë0, 0, 0 } }

	)

190 
	s_±hªad_˛ónup_buf„r


192 (*
	m__routöe
) (*);

193 *
	m__¨g
;

194 
	m__ˇn˚…y≥
;

195 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

201 
	mPTHREAD_CANCEL_ENABLE
,

202 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

203 
	mPTHREAD_CANCEL_DISABLE


204 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

208 
	mPTHREAD_CANCEL_DEFERRED
,

209 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

210 
	mPTHREAD_CANCEL_ASYNCHRONOUS


211 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

213 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

217 
	#PTHREAD_ONCE_INIT
 0

	)

220 #ifde‡
__USE_XOPEN2K


224 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

228 
__BEGIN_DECLS


233 
	$±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

234 c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

235 *(*
__°¨t_routöe
) (*),

236 *
__ª°ri˘
 
__¨g
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

242 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

250 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

252 #ifde‡
__USE_GNU


255 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

263 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

264 c⁄° 
time•ec
 *
__ab°ime
);

271 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

275 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

278 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
)

279 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

287 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

290 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

291 
__THROW
 
	`__n⁄nuŒ
 ((1));

294 
	$±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 *
__©å
,

295 *
__dëach°©e
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

299 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

300 
__dëach°©e
)

301 
__THROW
 
	`__n⁄nuŒ
 ((1));

305 
	$±hªad_©å_gëgu¨dsize
 (c⁄° 
±hªad_©å_t
 *
__©å
,

306 
size_t
 *
__gu¨dsize
)

307 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

310 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

311 
size_t
 
__gu¨dsize
)

312 
__THROW
 
	`__n⁄nuŒ
 ((1));

316 
	$±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

317 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

318 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

321 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

322 c⁄° 
sched_∑øm
 *
__ª°ri˘


323 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

326 
	$±hªad_©å_gëschedpﬁicy
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


327 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

328 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

331 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

332 
__THROW
 
	`__n⁄nuŒ
 ((1));

335 
	$±hªad_©å_gëöhîôsched
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


336 
__©å
, *
__ª°ri˘
 
__öhîô
)

337 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

340 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

341 
__öhîô
)

342 
__THROW
 
	`__n⁄nuŒ
 ((1));

346 
	$±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

347 *
__ª°ri˘
 
__sc›e
)

348 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

351 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

352 
__THROW
 
	`__n⁄nuŒ
 ((1));

355 
	$±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


356 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

357 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

363 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

364 *
__°ackaddr
)

365 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

368 
	$±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


369 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

370 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

375 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

376 
size_t
 
__°acksize
)

377 
__THROW
 
	`__n⁄nuŒ
 ((1));

379 #ifde‡
__USE_XOPEN2K


381 
	$±hªad_©å_gë°ack
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

382 **
__ª°ri˘
 
__°ackaddr
,

383 
size_t
 *
__ª°ri˘
 
__°acksize
)

384 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

389 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

390 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 #ifde‡
__USE_GNU


396 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

397 
size_t
 
__˝u£tsize
,

398 c⁄° 
˝u_£t_t
 *
__˝u£t
)

399 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

403 
	$±hªad_©å_gëafföôy_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
,

404 
size_t
 
__˝u£tsize
,

405 
˝u_£t_t
 *
__˝u£t
)

406 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

409 
	$±hªad_gë©å_deÁu…_≈
 (
±hªad_©å_t
 *
__©å
)

410 
__THROW
 
	`__n⁄nuŒ
 ((1));

414 
	$±hªad_£èâr_deÁu…_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
)

415 
__THROW
 
	`__n⁄nuŒ
 ((1));

420 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

421 
__THROW
 
	`__n⁄nuŒ
 ((2));

429 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

430 c⁄° 
sched_∑øm
 *
__∑øm
)

431 
__THROW
 
	`__n⁄nuŒ
 ((3));

434 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

435 *
__ª°ri˘
 
__pﬁicy
,

436 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

437 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

440 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

441 
__THROW
;

444 #ifde‡
__USE_GNU


446 
	$±hªad_gë«me_≈
 (
±hªad_t
 
__èrgë_thªad
, *
__buf
,

447 
size_t
 
__buÊí
)

448 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, c⁄° *
__«me
)

452 
__THROW
 
	`__n⁄nuŒ
 ((2));

456 #ifde‡
__USE_UNIX98


458 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

461 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

464 #ifde‡
__USE_GNU


469 
	$±hªad_yõld
 (Ë
__THROW
;

474 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

475 c⁄° 
˝u_£t_t
 *
__˝u£t
)

476 
__THROW
 
	`__n⁄nuŒ
 ((3));

479 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

480 
˝u_£t_t
 *
__˝u£t
)

481 
__THROW
 
	`__n⁄nuŒ
 ((3));

494 
	$±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

495 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

506 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

510 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

513 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

518 
	`±hªad_ã°ˇn˚l
 ();

527 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

528 
__mask_was_ßved
;

529 } 
__ˇn˚l_jmp_buf
[1];

530 *
__∑d
[4];

531 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

534 #i‚de‡
__˛ónup_f˘_©åibuã


535 
	#__˛ónup_f˘_©åibuã


	)

540 
	s__±hªad_˛ónup_‰ame


542 (*
__ˇn˚l_routöe
) (*);

543 *
__ˇn˚l_¨g
;

544 
__do_ô
;

545 
__ˇn˚l_ty≥
;

548 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


549 #ifde‡
__˝lu•lus


551 ˛as†
	c__±hªad_˛ónup_˛ass


553 (*
__ˇn˚l_routöe
) (*);

554 *
__ˇn˚l_¨g
;

555 
__do_ô
;

556 
__ˇn˚l_ty≥
;

558 
public
:

559 
	$__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

560 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

561 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

562 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

563 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

564 &
__ˇn˚l_ty≥
); 
	}
}

565 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

575 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

577 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

581 
	#±hªad_˛ónup_p›
(
execuã
) \

582 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

583 } 0)

	)

585 #ifde‡
__USE_GNU


589 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

591 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

592 
__˛‰ame
.
	`__de„r
 ()

	)

597 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

598 
__˛‰ame
.
	`__ª°‹e
 (); \

599 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

600 } 0)

	)

607 
__exã∫_ölöe
 

608 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

610 i‡(
__‰ame
->
__do_ô
)

611 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

612 
	}
}

621 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

623 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

624 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

625 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

626 .
__do_ô
 = 1 };

	)

630 
	#±hªad_˛ónup_p›
(
execuã
) \

631 
__˛‰ame
.
__do_ô
 = (
execuã
); \

632 } 0)

	)

634 #ifde‡
__USE_GNU


638 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

640 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

641 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

642 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

643 .
__do_ô
 = 1 }; \

644 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

645 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

650 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

651 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

652 
__˛‰ame
.
__do_ô
 = (
execuã
); \

653 } 0)

	)

664 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

666 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

667 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

668 *
__ˇn˚l_¨g
 = (
¨g
); \

669 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

670 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

671 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

673 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

674 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

678 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

679 dÿ{

	)

680 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

681 
__˛ónup_f˘_©åibuã
;

685 
	#±hªad_˛ónup_p›
(
execuã
) \

688 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

689 i‡(
execuã
) \

690 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

691 } 0)

	)

692 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

693 
__˛ónup_f˘_©åibuã
;

695 #ifde‡
__USE_GNU


699 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

701 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

702 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

703 *
__ˇn˚l_¨g
 = (
¨g
); \

704 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

705 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

706 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

708 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

709 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

713 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

714 dÿ{

	)

715 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

716 
__˛ónup_f˘_©åibuã
;

721 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

724 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

725 i‡(
execuã
) \

726 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

727 
	}
} 0)

	)

728 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

729 
__˛ónup_f˘_©åibuã
;

733 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

734 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

735 #i‚de‡
SHARED


736 
	`__©åibuã__
 ((
__wók__
))

742 
__jmp_buf_èg
;

743 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROWNL
;

749 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

750 c⁄° 
±hªad_muãx©å_t
 *
__muãx©å
)

751 
__THROW
 
	`__n⁄nuŒ
 ((1));

754 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

755 
__THROW
 
	`__n⁄nuŒ
 ((1));

758 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

759 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

762 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

763 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

765 #ifde‡
__USE_XOPEN2K


767 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

768 c⁄° 
time•ec
 *
__ª°ri˘


769 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

773 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

774 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

778 
	$±hªad_muãx_gë¥io˚ûög
 (c⁄° 
±hªad_muãx_t
 *

779 
__ª°ri˘
 
__muãx
,

780 *
__ª°ri˘
 
__¥io˚ûög
)

781 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

785 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

786 
__¥io˚ûög
,

787 *
__ª°ri˘
 
__ﬁd_˚ûög
)

788 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

791 #ifde‡
__USE_XOPEN2K8


793 
	$±hªad_muãx_c⁄si°ít
 (
±hªad_muãx_t
 *
__muãx
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1));

795 #ifde‡
__USE_GNU


796 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

797 
__THROW
 
	`__n⁄nuŒ
 ((1));

806 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1));

810 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

811 
__THROW
 
	`__n⁄nuŒ
 ((1));

814 
	$±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t
 *

815 
__ª°ri˘
 
__©å
,

816 *
__ª°ri˘
 
__psh¨ed
)

817 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

820 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

821 
__psh¨ed
)

822 
__THROW
 
	`__n⁄nuŒ
 ((1));

824 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


826 
	$±hªad_muãx©å_gëty≥
 (c⁄° 
±hªad_muãx©å_t
 *
__ª°ri˘


827 
__©å
, *
__ª°ri˘
 
__köd
)

828 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

833 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

834 
__THROW
 
	`__n⁄nuŒ
 ((1));

838 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (c⁄° 
±hªad_muãx©å_t
 *

839 
__ª°ri˘
 
__©å
,

840 *
__ª°ri˘
 
__¥Ÿocﬁ
)

841 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

845 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

846 
__¥Ÿocﬁ
)

847 
__THROW
 
	`__n⁄nuŒ
 ((1));

850 
	$±hªad_muãx©å_gë¥io˚ûög
 (c⁄° 
±hªad_muãx©å_t
 *

851 
__ª°ri˘
 
__©å
,

852 *
__ª°ri˘
 
__¥io˚ûög
)

853 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

856 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

857 
__¥io˚ûög
)

858 
__THROW
 
	`__n⁄nuŒ
 ((1));

860 #ifde‡
__USE_XOPEN2K


862 
	$±hªad_muãx©å_gërobu°
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

863 *
__robu°√ss
)

864 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

865 #ifde‡
__USE_GNU


866 
	$±hªad_muãx©å_gërobu°_≈
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

867 *
__robu°√ss
)

868 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

872 
	$±hªad_muãx©å_£åobu°
 (
±hªad_muãx©å_t
 *
__©å
,

873 
__robu°√ss
)

874 
__THROW
 
	`__n⁄nuŒ
 ((1));

875 #ifde‡
__USE_GNU


876 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

877 
__robu°√ss
)

878 
__THROW
 
	`__n⁄nuŒ
 ((1));

883 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


888 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

889 c⁄° 
±hªad_rwlock©å_t
 *
__ª°ri˘


890 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

893 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

894 
__THROW
 
	`__n⁄nuŒ
 ((1));

897 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

898 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

901 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

902 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

904 #ifde‡
__USE_XOPEN2K


906 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

907 c⁄° 
time•ec
 *
__ª°ri˘


908 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

912 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

916 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

917 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

919 #ifde‡
__USE_XOPEN2K


921 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

922 c⁄° 
time•ec
 *
__ª°ri˘


923 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

927 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

934 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

935 
__THROW
 
	`__n⁄nuŒ
 ((1));

938 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

939 
__THROW
 
	`__n⁄nuŒ
 ((1));

942 
	$±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 *

943 
__ª°ri˘
 
__©å
,

944 *
__ª°ri˘
 
__psh¨ed
)

945 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

948 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

949 
__psh¨ed
)

950 
__THROW
 
	`__n⁄nuŒ
 ((1));

953 
	$±hªad_rwlock©å_gëköd_≈
 (c⁄° 
±hªad_rwlock©å_t
 *

954 
__ª°ri˘
 
__©å
,

955 *
__ª°ri˘
 
__¥ef
)

956 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

959 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

960 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

968 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

969 c⁄° 
±hªad_c⁄d©å_t
 *
__ª°ri˘
 
__c⁄d_©å
)

970 
__THROW
 
	`__n⁄nuŒ
 ((1));

973 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

974 
__THROW
 
	`__n⁄nuŒ
 ((1));

977 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

978 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

981 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

982 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

989 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

990 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

991 
	`__n⁄nuŒ
 ((1, 2));

1000 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

1001 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

1002 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

1003 
	`__n⁄nuŒ
 ((1, 2, 3));

1008 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1));

1012 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

1013 
__THROW
 
	`__n⁄nuŒ
 ((1));

1016 
	$±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 *

1017 
__ª°ri˘
 
__©å
,

1018 *
__ª°ri˘
 
__psh¨ed
)

1019 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1022 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

1023 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1025 #ifde‡
__USE_XOPEN2K


1027 
	$±hªad_c⁄d©å_gë˛ock
 (c⁄° 
±hªad_c⁄d©å_t
 *

1028 
__ª°ri˘
 
__©å
,

1029 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

1030 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1033 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

1034 
__˛ockid_t
 
__˛ock_id
)

1035 
__THROW
 
	`__n⁄nuŒ
 ((1));

1039 #ifde‡
__USE_XOPEN2K


1044 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1045 
__THROW
 
	`__n⁄nuŒ
 ((1));

1048 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1049 
__THROW
 
	`__n⁄nuŒ
 ((1));

1052 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1053 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1056 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1057 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1060 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1061 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1068 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1069 c⁄° 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1070 
__©å
, 
__cou¡
)

1071 
__THROW
 
	`__n⁄nuŒ
 ((1));

1074 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1075 
__THROW
 
	`__n⁄nuŒ
 ((1));

1078 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1079 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1083 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1084 
__THROW
 
	`__n⁄nuŒ
 ((1));

1087 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1088 
__THROW
 
	`__n⁄nuŒ
 ((1));

1091 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t
 *

1092 
__ª°ri˘
 
__©å
,

1093 *
__ª°ri˘
 
__psh¨ed
)

1094 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1097 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1098 
__psh¨ed
)

1099 
__THROW
 
	`__n⁄nuŒ
 ((1));

1111 
	$±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1112 (*
__de°r_fun˘i⁄
) (*))

1113 
__THROW
 
	`__n⁄nuŒ
 ((1));

1116 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1119 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1122 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1123 c⁄° *
__poöãr
Ë
__THROW
 ;

1126 #ifde‡
__USE_XOPEN2K


1128 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1129 
__˛ockid_t
 *
__˛ock_id
)

1130 
__THROW
 
	`__n⁄nuŒ
 ((2));

1145 
	$±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1146 (*
__∑ª¡
) (),

1147 (*
__chûd
Ë()Ë
__THROW
;

1150 #ifde‡
__USE_EXTERN_INLINES


1152 
__exã∫_ölöe
 

1153 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1155  
__thªad1
 =
__thªad2
;

1156 
	}
}

1159 
	g__END_DECLS


	@/usr/include/signal.h

22 #i‚def 
_SIGNAL_H


24 #i‡!
deföed
 
__√ed_sig_©omic_t
 && !deföed 
__√ed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


32 
	~<bôs/sig£t.h
>

36 #i‡
deföed
 
__√ed_sig_©omic_t
 || deföed 
_SIGNAL_H


37 #i‚de‡
__sig_©omic_t_deföed


38 
	#__sig_©omic_t_deföed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #unde‡
__√ed_sig_©omic_t


46 #i‡
deföed
 
__√ed_sig£t_t
 || (deföed 
_SIGNAL_H
 && deföed 
__USE_POSIX
)

47 #i‚de‡
__sig£t_t_deföed


48 
	#__sig£t_t_deföed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #unde‡
__√ed_sig£t_t


54 #ifde‡
_SIGNAL_H


56 
	~<bôs/ty≥s.h
>

57 
	~<bôs/signum.h
>

59 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


60 #i‚de‡
__pid_t_deföed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_deföed


	)

64 #ifde‡
__USE_XOPEN


66 #i‚de‡
__uid_t_deföed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_deföed


	)

72 #ifde‡
__USE_POSIX199309


74 
	#__√ed_time•ec


	)

75 
	~<time.h
>

78 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_XOPEN_EXTENDED


80 
	~<bôs/sigöfo.h
>

85 (*
	t__sigh™dÀr_t
) ();

90 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

91 
__THROW
;

92 #ifde‡
__USE_GNU


93 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifde‡
__USE_MISC


102 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

103 
__THROW
;

106 #ifde‡
__REDIRECT_NTH


107 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

108 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

109 
__sysv_sig«l
);

111 
	#sig«l
 
__sysv_sig«l


	)

114 
__END_NAMESPACE_STD


116 #ifde‡
__USE_XOPEN


119 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

120 
__THROW
;

126 #ifde‡
__USE_POSIX


127 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

130 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


134 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$øi£
 (
__sig
Ë
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifde‡
__USE_MISC


144 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

145 
__THROW
;

146 
	$gsig«l
 (
__sig
Ë
__THROW
;

149 #ifde‡
__USE_XOPEN2K8


151 
	`psig«l
 (
__sig
, c⁄° *
__s
);

154 
	`psigöfo
 (c⁄° 
sigöfo_t
 *
__pöfo
, c⁄° *
__s
);

166 #ifde‡
__USE_XOPEN


167 #ifde‡
__GNUC__


168 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

170 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

172 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

177 #ifde‡
__USE_MISC


184 
	#sigmask
(
sig
Ë
	`__sigmask
(sig)

	)

187 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

190 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

193 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

197 #ifde‡
__USE_MISC


198 
	#NSIG
 
_NSIG


	)

201 #ifde‡
__USE_GNU


202 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

206 #ifde‡
__USE_MISC


207 
__sigh™dÀr_t
 
	tsig_t
;

210 #ifde‡
__USE_POSIX


213 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

216 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

219 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

222 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 
	$sigismembî
 (c⁄° 
sig£t_t
 *
__£t
, 
__signo
)

226 
__THROW
 
	`__n⁄nuŒ
 ((1));

228 #ifde‡
__USE_GNU


230 
	$sigi£m±y£t
 (c⁄° 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

233 
	$sig™d£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

234 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

237 
	$sig‹£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

238 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

243 
	~<bôs/siga˘i⁄.h
>

246 
	$sig¥ocmask
 (
__how
, c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

247 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

254 
	$sigsu•íd
 (c⁄° 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

257 
	$siga˘i⁄
 (
__sig
, c⁄° 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

258 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

261 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

268 
	$sigwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

269 
	`__n⁄nuŒ
 ((1, 2));

271 #ifde‡
__USE_POSIX199309


276 
	$sigwaôöfo
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

277 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

284 
	$sigtimedwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

285 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

286 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
)

287 
	`__n⁄nuŒ
 ((1));

291 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, c⁄° 
sigvÆ
 
__vÆ
)

292 
__THROW
;

297 #ifde‡
__USE_MISC


301 c⁄° *c⁄° 
_sys_sigli°
[
_NSIG
];

302 c⁄° *c⁄° 
sys_sigli°
[
_NSIG
];

306 
	~<bôs/sigc⁄ãxt.h
>

309 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

314 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


315 
	#__√ed_size_t


	)

316 
	~<°ddef.h
>

321 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

323 
	~<bôs/sig°ack.h
>

324 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


326 
	~<sys/uc⁄ãxt.h
>

332 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

333 
__THROW
 
__©åibuã_dïªˇãd__
;

337 
	$sigÆt°ack
 (c⁄° 
sigÆt°ack
 *
__ª°ri˘
 
__ss
,

338 
sigÆt°ack
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

342 #ifde‡
__USE_XOPEN_EXTENDED


346 
	$sighﬁd
 (
__sig
Ë
__THROW
;

349 
	$sigªl£
 (
__sig
Ë
__THROW
;

352 
	$sigign‹e
 (
__sig
Ë
__THROW
;

355 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

358 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


361 
	~<bôs/±hªadty≥s.h
>

362 
	~<bôs/sigthªad.h
>

369 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

371 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

375 
__END_DECLS


	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


25 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	~<bôs/ty≥s.h
>

36 
	#__√ed_FILE


	)

37 
	#__√ed___FILE


	)

41 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_POSIX
 \

51 || 
deföed
 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

52 || 
deföed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_deföed
 1

	)

58 #unde‡
__√ed_FILE


61 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_deföed
 1

	)

68 #unde‡
__√ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


77 #ifde‡
__GNUC__


78 #i‚de‡
_VA_LIST_DEFINED


79 
_G_va_li°
 
	tva_li°
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<°d¨g.h
>

87 #ifde‡
__USE_XOPEN2K8


88 #i‚de‡
__off_t_deföed


89 #i‚de‡
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_deföed


	)

96 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_deföed


	)

101 #i‚de‡
__ssize_t_deföed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_deföed


	)

108 
__BEGIN_NAMESPACE_STD


109 #i‚de‡
__USE_FILE_OFFSET64


110 
_G_Âos_t
 
	tÂos_t
;

112 
_G_Âos64_t
 
	tÂos_t
;

114 
__END_NAMESPACE_STD


115 #ifde‡
__USE_LARGEFILE64


116 
_G_Âos64_t
 
	tÂos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #i‚de‡
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #i‚de‡
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde‡
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


151 
	#P_tmpdú
 "/tmp"

	)

164 
	~<bôs/°dio_lim.h
>

168 
_IO_FILE
 *
°dö
;

169 
_IO_FILE
 *
°dout
;

170 
_IO_FILE
 *
°dîr
;

172 
	#°dö
 
°dö


	)

173 
	#°dout
 
°dout


	)

174 
	#°dîr
 
°dîr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

180 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde‡
__USE_ATFILE


185 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

186 c⁄° *
__√w
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #i‚de‡
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

197 #ifde‡
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

200 
	#tmpfûe
 
tmpfûe64


	)

204 #ifde‡
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

209 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde‡
__USE_MISC


215 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

219 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


227 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

228 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`f˛o£
 (
FILE
 *
__°ªam
);

242 
	`fÊush
 (
FILE
 *
__°ªam
);

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_MISC


252 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

255 #ifde‡
__USE_GNU


262 
	`f˛o£Æl
 ();

266 
__BEGIN_NAMESPACE_STD


267 #i‚de‡
__USE_FILE_OFFSET64


272 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

279 c⁄° *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

282 #ifde‡
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

284 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

287 c⁄° *
__ª°ri˘
 
__modes
,

288 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

289 
__wur
;

291 
	#f›í
 
f›í64


	)

292 
	#‰e›í
 
‰e›í64


	)

295 
__END_NAMESPACE_STD


296 #ifde‡
__USE_LARGEFILE64


297 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

298 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

299 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

300 c⁄° *
__ª°ri˘
 
__modes
,

301 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

313 c⁄° *
__ª°ri˘
 
__modes
,

314 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

317 #ifde‡
__USE_XOPEN2K8


319 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

337 
__modes
, 
size_t
 
__n
Ë
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_MISC


343 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

344 
size_t
 
__size
Ë
__THROW
;

347 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

357 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

362 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

364 
	$•rötf
 (*
__ª°ri˘
 
__s
,

365 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

371 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

372 
_G_va_li°
 
__¨g
);

377 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

379 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

380 
_G_va_li°
 
__¨g
Ë
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

387 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

388 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

390 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

391 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

392 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde‡
__USE_GNU


399 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

400 
_G_va_li°
 
__¨g
)

401 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

402 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

403 c⁄° *
__ª°ri˘
 
__fmt
, ...)

404 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

405 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

406 c⁄° *
__ª°ri˘
 
__fmt
, ...)

407 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

410 #ifde‡
__USE_XOPEN2K8


412 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

413 
_G_va_li°
 
__¨g
)

414 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

415 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

426 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

431 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

434 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

436 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

437 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

438 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

439 #ifde‡
__REDIRECT


443 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

444 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

445 
__isoc99_fsˇnf
Ë
__wur
;

446 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_sˇnf
Ë
__wur
;

448 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

449 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

450 
__isoc99_ssˇnf
);

452 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

454 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

455 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

456 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

457 
	#fsˇnf
 
__isoc99_fsˇnf


	)

458 
	#sˇnf
 
__isoc99_sˇnf


	)

459 
	#ssˇnf
 
__isoc99_ssˇnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

472 
_G_va_li°
 
__¨g
)

473 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

480 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

483 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

484 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

485 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

487 #i‡!
deföed
 
__USE_GNU
 \

488 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

489 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

490 #ifde‡
__REDIRECT


494 
	`__REDIRECT
 (
vfsˇnf
,

495 (
FILE
 *
__ª°ri˘
 
__s
,

496 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

497 
__isoc99_vfsˇnf
)

498 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

499 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

500 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

501 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

502 
	`__REDIRECT_NTH
 (
vssˇnf
,

503 (c⁄° *
__ª°ri˘
 
__s
,

504 c⁄° *
__ª°ri˘
 
__f‹m©
,

505 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

506 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

508 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

509 c⁄° *
__ª°ri˘
 
__f‹m©
,

510 
_G_va_li°
 
__¨g
Ë
__wur
;

511 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

514 c⁄° *
__ª°ri˘
 
__f‹m©
,

515 
_G_va_li°
 
__¨g
Ë
__THROW
;

516 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

517 
	#vsˇnf
 
__isoc99_vsˇnf


	)

518 
	#vssˇnf
 
__isoc99_vssˇnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgëc
 (
FILE
 *
__°ªam
);

532 
	`gëc
 (
FILE
 *
__°ªam
);

538 
	`gëch¨
 ();

539 
__END_NAMESPACE_STD


543 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

545 #ifde‡
__USE_POSIX


550 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

551 
	`gëch¨_u∆ocked
 ();

554 #ifde‡
__USE_MISC


561 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

565 
__BEGIN_NAMESPACE_STD


573 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

574 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

580 
	`putch¨
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

587 #ifde‡
__USE_MISC


594 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

597 #ifde‡
__USE_POSIX


602 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

603 
	`putch¨_u∆ocked
 (
__c
);

607 #i‡
deföed
 
__USE_MISC
 \

608 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

610 
	`gëw
 (
FILE
 *
__°ªam
);

613 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

623 
__wur
;

625 #i‡!
deföed
 
__USE_ISOC11
 \

626 || (
deföed
 
__˝lu•lus
 && __cplusplus <= 201103L)

638 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

640 
__END_NAMESPACE_STD


642 #ifde‡
__USE_GNU


649 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

650 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

666 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

667 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

668 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

669 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

670 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

678 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

679 
size_t
 *
__ª°ri˘
 
__n
,

680 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

695 
	`puts
 (c⁄° *
__s
);

702 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

709 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_GNU


726 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

727 
FILE
 *
__ª°ri˘
 
__°ªam
);

730 #ifde‡
__USE_MISC


737 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

739 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

754 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

759 
	`ªwöd
 (
FILE
 *
__°ªam
);

760 
__END_NAMESPACE_STD


767 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


768 #i‚de‡
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

778 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

780 #ifde‡
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#·ñlo
 
·ñlo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #i‚de‡
__USE_FILE_OFFSET64


798 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

803 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

805 #ifde‡
__REDIRECT


806 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

807 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

808 
	`__REDIRECT
 (
f£ços
,

809 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

811 
	#fgëpos
 
fgëpos64


	)

812 
	#f£ços
 
f£ços64


	)

815 
__END_NAMESPACE_STD


817 #ifde‡
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

819 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

820 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

821 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

828 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde‡
__USE_MISC


835 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

836 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

837 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`≥º‹
 (c⁄° *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bôs/sys_îæi°.h
>

856 #ifdef 
__USE_POSIX


858 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

861 #ifde‡
__USE_MISC


863 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

867 #ifde‡
__USE_POSIX2


872 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

878 
	`p˛o£
 (
FILE
 *
__°ªam
);

882 #ifdef 
__USE_POSIX


884 *
	$˘îmid
 (*
__s
Ë
__THROW
;

888 #ifde‡
__USE_XOPEN


890 *
	`cu£rid
 (*
__s
);

894 #ifdef 
__USE_GNU


895 
ob°ack
;

898 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

899 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

900 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

901 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

902 c⁄° *
__ª°ri˘
 
__f‹m©
,

903 
_G_va_li°
 
__¨gs
)

904 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

908 #ifde‡
__USE_POSIX


912 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

916 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

919 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

922 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


926 
	#__√ed_gë›t


	)

927 
	~<gë›t.h
>

932 #ifde‡
__USE_EXTERN_INLINES


933 
	~<bôs/°dio.h
>

935 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


936 
	~<bôs/°dio2.h
>

938 #ifde‡
__LDBL_COMPAT


939 
	~<bôs/°dio-ldbl.h
>

942 
__END_DECLS


	@/usr/include/syslog.h

1 
	~<sys/sy¶og.h
>

	@/usr/include/termios.h

22 #i‚def 
_TERMIOS_H


23 
	#_TERMIOS_H
 1

	)

25 
	~<„©uªs.h
>

26 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


28 
	~<bôs/ty≥s.h
>

29 #i‚de‡
__pid_t_deföed


30 
__pid_t
 
	tpid_t
;

31 
	#__pid_t_deföed


	)

35 
	g__BEGIN_DECLS


39 
	~<bôs/ãrmios.h
>

41 #ifde‡
__USE_MISC


44 
	#CCEQ
(
vÆ
, 
c
Ë((cË=(vÆË&& (vÆË!
_POSIX_VDISABLE
)

	)

48 
•ìd_t
 
	$cfgëo•ìd
 (c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

51 
•ìd_t
 
	$cfgëi•ìd
 (c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

54 
	$cf£to•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

57 
	$cf£ti•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

59 #ifdef 
__USE_MISC


61 
	$cf£t•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

66 
	$tcgë©å
 (
__fd
, 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

70 
	$tc£èâr
 (
__fd
, 
__›ti⁄Æ_a˘i⁄s
,

71 c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

74 #ifdef 
__USE_MISC


76 
	$cfmakîaw
 (
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

80 
	$tc£ndbªak
 (
__fd
, 
__duøti⁄
Ë
__THROW
;

86 
	`tcdøö
 (
__fd
);

90 
	$tcÊush
 (
__fd
, 
__queue_£À˘‹
Ë
__THROW
;

94 
	$tcÊow
 (
__fd
, 
__a˘i⁄
Ë
__THROW
;

97 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


99 
__pid_t
 
	$tcgësid
 (
__fd
Ë
__THROW
;

103 #ifde‡
__USE_MISC


104 
	~<sys/âydeÁu…s.h
>

107 
__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifde‡
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #ñi‡
deföed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #ñi‡
deföed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<bôs/posix_›t.h
>

208 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


209 
	~<bôs/ívú⁄míts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<bôs/ty≥s.h
>

222 #i‚def 
__ssize_t_deföed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_deföed


	)

227 
	#__√ed_size_t


	)

228 
	#__√ed_NULL


	)

229 
	~<°ddef.h
>

231 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


234 #i‚de‡
__gid_t_deföed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_deföed


	)

239 #i‚de‡
__uid_t_deföed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_deföed


	)

244 #i‚de‡
__off_t_deföed


245 #i‚de‡
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_deföed


	)

252 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_deföed


	)

257 #i‚de‡
__u£c⁄ds_t_deföed


258 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

259 
	#__u£c⁄ds_t_deföed


	)

262 #i‚de‡
__pid_t_deföed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_deföed


	)

268 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


269 #i‚de‡
__öçå_t_deföed


270 
__öçå_t
 
	töçå_t
;

271 
	#__öçå_t_deföed


	)

275 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


276 #i‚de‡
__sockÀn_t_deföed


277 
__sockÀn_t
 
	tsockÀn_t
;

278 
	#__sockÀn_t_deföed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

292 #ifde‡
__USE_GNU


295 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1));

299 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

300 
__THROW
 
	`__n⁄nuŒ
 ((1));

303 #ifde‡
__USE_ATFILE


307 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

308 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

313 #i‚def 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifde‡
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #i‡
deföed
 
__USE_MISC
 && !deföed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #i‚de‡
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

339 #ifde‡
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifde‡
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

349 
__THROW
;

356 
	`˛o£
 (
__fd
);

363 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

369 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

371 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


372 #i‚de‡
__USE_FILE_OFFSET64


379 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

380 
__off_t
 
__off£t
Ë
__wur
;

387 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
Ë
__wur
;

390 #ifde‡
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

392 
__off64_t
 
__off£t
),

393 
¥ód64
Ë
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

395 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

396 
pwrôe64
Ë
__wur
;

398 
	#¥ód
 
¥ód64


	)

399 
	#pwrôe
 
pwrôe64


	)

403 #ifde‡
__USE_LARGEFILE64


407 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

408 
__off64_t
 
__off£t
Ë
__wur
;

411 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
Ë
__wur
;

420 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

422 #ifde‡
__USE_GNU


425 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

435 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

447 
	`¶ìp
 (
__£c⁄ds
);

449 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

450 || 
deföed
 
__USE_MISC


455 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

456 
__THROW
;

463 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

472 
	`∑u£
 ();

476 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

479 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

486 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

491 #ifde‡
__USE_ATFILE


494 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

495 
__gid_t
 
__group
, 
__Êag
)

496 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

500 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

502 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


504 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

514 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

523 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

524 || 
deföed
 
__USE_MISC


528 *
	$gëwd
 (*
__buf
)

529 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

534 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

539 #ifde‡
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

546 **
__ívú⁄
;

547 #ifde‡
__USE_GNU


548 **
ívú⁄
;

554 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

555 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifde‡
__USE_XOPEN2K8


560 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

561 
__THROW
 
	`__n⁄nuŒ
 ((2));

566 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

567 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

572 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

576 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

577 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

581 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

582 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

588 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

590 #ifde‡
__USE_GNU


593 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

594 *c⁄° 
__ívp
[])

595 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

599 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


601 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

606 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

612 
	~<bôs/c⁄‚ame.h
>

615 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

616 
__THROW
 
	`__n⁄nuŒ
 ((1));

619 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

622 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

631 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

637 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

640 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

641 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


642 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

649 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

651 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


663 
	$£çgΩ
 (Ë
__THROW
;

670 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

672 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


674 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

678 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

681 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

687 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

692 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

705 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


708 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

711 #ifde‡
__USE_XOPEN2K


713 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

722 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


725 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

728 #ifde‡
__USE_XOPEN2K


730 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

733 #ifde‡
__USE_GNU


736 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

737 
__THROW
;

741 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

742 
__THROW
;

746 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

747 
__THROW
 
__wur
;

751 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

761 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

762 || 
deföed
 
__USE_MISC


767 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

773 *
	$ây«me
 (
__fd
Ë
__THROW
;

777 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

778 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

782 
	$ißây
 (
__fd
Ë
__THROW
;

784 #i‡
deföed
 
__USE_MISC
 \

785 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

788 
	$ây¶Ÿ
 (Ë
__THROW
;

793 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

796 #ifde‡
__USE_ATFILE


799 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

800 c⁄° *
__to
, 
__Êags
)

801 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

804 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


806 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

812 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

813 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

814 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

817 #ifde‡
__USE_ATFILE


819 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

820 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

823 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

824 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

825 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

829 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

831 #ifde‡
__USE_ATFILE


833 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

834 
__THROW
 
	`__n⁄nuŒ
 ((2));

838 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

842 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

845 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

852 *
	`gëlogö
 ();

853 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


860 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

863 #ifdef 
__USE_MISC


865 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

869 #ifdef 
__USE_POSIX2


873 
	#__√ed_gë›t


	)

874 
	~<gë›t.h
>

878 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


882 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

886 #i‡
deföed
 
__USE_MISC


889 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

890 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

894 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

900 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

902 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

903 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

909 
	$vh™gup
 (Ë
__THROW
;

912 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

920 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

921 
size_t
 
__off£t
, 
__sˇÀ
)

922 
__THROW
 
	`__n⁄nuŒ
 ((1));

928 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

932 *
	$gëu£rshñl
 (Ë
__THROW
;

933 
	$ídu£rshñl
 (Ë
__THROW
;

934 
	$£tu£rshñl
 (Ë
__THROW
;

940 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

944 #i‡
deföed
 
__USE_MISC
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

947 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

951 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

959 
	`fsync
 (
__fd
);

962 #ifde‡
__USE_GNU


965 
	$syncfs
 (
__fd
Ë
__THROW
;

969 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


972 
	`gëho°id
 ();

975 
	$sync
 (Ë
__THROW
;

978 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K


981 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

986 
	$gëdèbÀsize
 (Ë
__THROW
;

992 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


995 #i‚de‡
__USE_FILE_OFFSET64


996 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

997 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

999 #ifde‡
__REDIRECT_NTH


1000 
	`__REDIRECT_NTH
 (
åunˇã
,

1001 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

1002 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1004 
	#åunˇã
 
åunˇã64


	)

1007 #ifde‡
__USE_LARGEFILE64


1008 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1014 #i‡
deföed
 
__USE_POSIX199309
 \

1015 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1018 #i‚de‡
__USE_FILE_OFFSET64


1019 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1021 #ifde‡
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1023 
·runˇã64
Ë
__wur
;

1025 
	#·runˇã
 
·runˇã64


	)

1028 #ifde‡
__USE_LARGEFILE64


1029 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1035 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1036 || 
deföed
 
__USE_MISC


1040 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1046 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1050 #ifde‡
__USE_MISC


1061 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1066 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #i‚de‡
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1086 #ifde‡
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1088 
lockf64
Ë
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifde‡
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1099 #ifde‡
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1105 (
__exãnsi⁄__
 \

1106 ({ 
__ªsu…
; \

1107 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1108 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1109 
__ªsu…
; 
	}
}))

	)

1112 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1115 
fd©async
 (
__fûdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1124 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1128 
	$í¸y±
 (*
__glibc_block
, 
__edÊag
)

1129 
__THROW
 
	`__n⁄nuŒ
 ((1));

1136 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1137 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1143 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1145 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1150 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1151 
	~<bôs/uni°d.h
>

1154 
__END_DECLS


	@/usr/include/vlib/buffer.h

40 #i‚de‡
ö˛uded_vlib_buf„r_h


41 
	#ö˛uded_vlib_buf„r_h


	)

43 
	~<vµö‰a/ty≥s.h
>

44 
	~<vµö‰a/ˇche.h
>

45 
	~<vµö‰a/£rülize.h
>

46 
	~<vµö‰a/ve˘‹.h
>

47 
	~<vµö‰a/lock.h
>

48 
	~<vlib/îr‹.h
>

50 
	~<vlib/c⁄fig.h
>

51 
	#VLIB_BUFFER_DATA_SIZE
 (2048)

	)

52 
	#VLIB_BUFFER_PRE_DATA_SIZE
 
__PRE_DATA_SIZE


	)

54 
u8
 
	tvlib_buf„r_‰ì_li°_ödex_t
;

66 
	#f‹óch_vlib_buf„r_Êag
 \

67 
	`_
–0, 
NON_DEFAULT_FREELIST
, "non-default-fl") \

68 
	`_
–1, 
IS_TRACED
, 0) \

69 
	`_
–2, 
NEXT_PRESENT
, 0) \

70 
	`_
–3, 
IS_RECYCLED
, "is-recycled") \

71 
	`_
–4, 
TOTAL_LENGTH_VALID
, 0) \

72 
	`_
–5, 
REPL_FAIL
, "repl-fail") \

73 
	`_
–6, 
RECYCLE
, "recycle") \

74 
	`_
–7, 
EXT_HDR_VALID
, "ext-hdr-vÆid")

	)

81 
	#_
(
bô
, 
«me
, 
v
Ë
VLIB_BUFFER_
##«mê(1 << (bô)),

	)

82 
	mf‹óch_vlib_buf„r_Êag


83 #unde‡
_


88 
	#_
(
bô
, 
«me
, 
v
Ë
VLIB_BUFFER_LOG2_
##«mê(bô),

	)

89 
	mf‹óch_vlib_buf„r_Êag


90 #unde‡
_


94 
	#LOG2_VLIB_BUFFER_FLAG_USER
(
n
Ë(32 - (n))

	)

95 
	#VLIB_BUFFER_FLAG_USER
(
n
Ë(1 << 
	`LOG2_VLIB_BUFFER_FLAG_USER
“))

	)

100 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

101 
STRUCT_MARK
 (
ãm∂©e_°¨t
);

104 
i16
 
	mcuºít_d©a
;

108 
u16
 
	mcuºít_Àngth
;

111 
u32
 
	mÊags
;

124 
STRUCT_MARK
 (
ãm∂©e_íd
);

126 
u32
 
	m√xt_buf„r
;

130 
vlib_îr‹_t
 
	mîr‹
;

133 
u32
 
	mcuºít_c⁄fig_ödex
;

137 
u8
 
	m„©uª_¨c_ödex
;

141 
u8
 
	mn_add_ªfs
;

143 
u8
 
	mbuf„r_poﬁ_ödex
;

144 
u8
 
	md⁄t_wa°e_me
[1];

149 
u32
 
	m›aque
[10];

152 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

154 
u32
 
	måa˚_ödex
;

157 
u32
 
	mªcy˛e_cou¡
;

159 
u32
 
	mtŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

163 
vlib_buf„r_‰ì_li°_ödex_t
 
	m‰ì_li°_ödex
;

166 
u8
 
	mÆign_∑d
[3];

167 
u32
 
	m›aque2
[12];

170 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe2
);

171 
u8
 
	m¥e_d©a
[
VLIB_BUFFER_PRE_DATA_SIZE
];

179 
u8
 
	md©a
[0];

180 } 
	tvlib_buf„r_t
;

182 
	#VLIB_BUFFER_HDR_SIZE
 ((
vlib_buf„r_t
Ë- 
VLIB_BUFFER_PRE_DATA_SIZE
)

	)

191 
	#vlib_¥e„tch_buf„r_hódî
(
b
,
ty≥
Ë
	`CLIB_PREFETCH
 (b, 64,Åy≥)

	)

193 
Æways_ölöe
 
vlib_buf„r_t
 *

194 
	$vlib_buf„r_√xt_c⁄tiguous
 (
vlib_buf„r_t
 * 
b
, 
u32
 
buf„r_byãs
)

196  (*Ë(
b
 + 1Ë+ 
buf„r_byãs
;

197 
	}
}

199 
Æways_ölöe
 

200 
	$vlib_buf„r_°ru˘_is_ß√
 (
vlib_buf„r_t
 * 
b
)

202 
	`ASSERT
 ( (
b
[0]) % 64 == 0);

205 
	`ASSERT
 (
b
->
¥e_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 =b->
d©a
);

206 
	}
}

214 
Æways_ölöe
 *

215 
	$vlib_buf„r_gë_cuºít
 (
vlib_buf„r_t
 * 
b
)

218 
	`ASSERT
 ((sig√dË
b
->
cuºít_d©a
 >(sig√dË-
VLIB_BUFFER_PRE_DATA_SIZE
);

219  
b
->
d©a
 + b->
cuºít_d©a
;

220 
	}
}

227 
Æways_ölöe
 

228 
	$vlib_buf„r_adv™˚
 (
vlib_buf„r_t
 * 
b
, 
w‹d
 
l
)

230 
	`ASSERT
 (
b
->
cuºít_Àngth
 >
l
);

231 
b
->
cuºít_d©a
 +
l
;

232 
b
->
cuºít_Àngth
 -
l
;

233 
	}
}

241 
Æways_ölöe
 
u8


242 
	$vlib_buf„r_has_•a˚
 (
vlib_buf„r_t
 * 
b
, 
w‹d
 
l
)

244  
b
->
cuºít_Àngth
 >
l
;

245 
	}
}

253 
Æways_ölöe
 

254 
	$vlib_buf„r_ª£t
 (
vlib_buf„r_t
 * 
b
)

256 
b
->
cuºít_Àngth
 +
	`˛ib_max
 (b->
cuºít_d©a
, 0);

257 
b
->
cuºít_d©a
 = 0;

258 
	}
}

265 
Æways_ölöe
 *

266 
	$vlib_gë_buf„r_›aque
 (
vlib_buf„r_t
 * 
b
)

268  (*Ë
b
->
›aque
;

269 
	}
}

276 
Æways_ölöe
 *

277 
	$vlib_gë_buf„r_›aque2
 (
vlib_buf„r_t
 * 
b
)

279  (*Ë
b
->
›aque2
;

280 
	}
}

286 
Æways_ölöe
 
u8
 *

287 
	$vlib_buf„r_gë_èû
 (
vlib_buf„r_t
 * 
b
)

289  
b
->
d©a
 + b->
cuºít_d©a
 + b->
cuºít_Àngth
;

290 
	}
}

297 
Æways_ölöe
 *

298 
	$vlib_buf„r_put_unöô
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

300 *
p
 = 
	`vlib_buf„r_gë_èû
 (
b
);

302 
b
->
cuºít_Àngth
 +
size
;

303  
p
;

304 
	}
}

311 
Æways_ölöe
 *

312 
	$vlib_buf„r_push_unöô
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

314 
	`ASSERT
 (
b
->
cuºít_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 >
size
);

315 
b
->
cuºít_d©a
 -
size
;

316 
b
->
cuºít_Àngth
 +
size
;

318  
	`vlib_buf„r_gë_cuºít
 (
b
);

319 
	}
}

326 
Æways_ölöe
 *

327 
	$vlib_buf„r_make_hódroom
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

329 
	`ASSERT
 (
b
->
cuºít_d©a
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 >
size
);

330 
b
->
cuºít_d©a
 +
size
;

331  
	`vlib_buf„r_gë_cuºít
 (
b
);

332 
	}
}

339 
Æways_ölöe
 *

340 
	$vlib_buf„r_puŒ
 (
vlib_buf„r_t
 * 
b
, 
u8
 
size
)

342 i‡(
b
->
cuºít_Àngth
 + 
VLIB_BUFFER_PRE_DATA_SIZE
 < 
size
)

345 *
d©a
 = 
	`vlib_buf„r_gë_cuºít
 (
b
);

346 
	`vlib_buf„r_adv™˚
 (
b
, 
size
);

347  
d©a
;

348 
	}
}

351 
	gvlib_maö_t
;

353 
	svlib_buf„r_‰ì_li°_t


357 
vlib_buf„r_t
 
	mbuf„r_öô_ãm∂©e
;

360 
vlib_buf„r_‰ì_li°_ödex_t
 
	mödex
;

363 
u32
 
	mn_d©a_byãs
;

367 
u32
 
	mmö_n_buf„rs_óch_physmem_Æloc
;

370 
u32
 
	mn_Æloc
;

373 
u32
 *
	mbuf„rs
;

378 
u32
 *
	mglobÆ_buf„rs
;

379 
˛ib_•ölock_t
 
	mglobÆ_buf„rs_lock
;

384 **
	mbuf„r_mem‹y_Æloˇãd
;

387 
u8
 *
	m«me
;

391 (*
	mbuf„r_öô_fun˘i⁄
Ë(
vlib_maö_t
 * 
	mvm
,

392 
vlib_buf„r_‰ì_li°_t
 * 
	mÊ
,

393 
u32
 * 
	mbuf„rs
, u32 
	mn_buf„rs
);

397 (*
	mbuf„rs_added_to_‰ìli°_fun˘i⁄
)

398 (
vlib_maö_t
 * 
	mvm
, 
vlib_buf„r_‰ì_li°_t
 * 
	mÊ
);

400 
uw‹d
 
	mbuf„r_öô_fun˘i⁄_›aque
;

401 } 
	t__©åibuã__
 ((
	tÆig√d
 (16))Ë
	tvlib_buf„r_‰ì_li°_t
;

403 
	$uw‹d
 (
	tvlib_buf„r_fûl_‰ì_li°_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

404 
	tvlib_buf„r_‰ì_li°_t
 * 
	tÊ
,

405 
	tuw‹d
 
	tmö_‰ì_buf„rs
);

406 (
	tvlib_buf„r_‰ì_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
, 
	tu32
 * 
	tbuf„rs
,

407 
	tu32
 
	tn_buf„rs
);

408 (
	tvlib_buf„r_‰ì_no_√xt_cb_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

409 
	tu32
 * 
	tbuf„rs
, u32 
	tn_buf„rs
);

413 
vlib_buf„r_fûl_‰ì_li°_cb_t
 *
vlib_buf„r_fûl_‰ì_li°_cb
;

414 
vlib_buf„r_‰ì_cb_t
 *
vlib_buf„r_‰ì_cb
;

415 
vlib_buf„r_‰ì_no_√xt_cb_t
 *
vlib_buf„r_‰ì_no_√xt_cb
;

416 (*
vlib_∑ckë_ãm∂©e_öô_cb
Ë(
vlib_maö_t
 * 
vm
, *
t
,

417 *
∑ckë_d©a
,

418 
uw‹d
 
n_∑ckë_d©a_byãs
,

419 
uw‹d


420 
mö_n_buf„rs_óch_physmem_Æloc
,

421 
u8
 * 
«me
);

422 (*
vlib_buf„r_dñëe_‰ì_li°_cb
Ë(
vlib_maö_t
 * 
vm
,

423 
vlib_buf„r_‰ì_li°_ödex_t


424 
‰ì_li°_ödex
);

425 } 
	tvlib_buf„r_ˇŒbacks_t
;

427 
vlib_buf„r_ˇŒbacks_t
 *
vlib_buf„r_ˇŒbacks
;

431 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

432 
uw‹d
 
°¨t
;

433 
uw‹d
 
size
;

434 
vlib_physmem_ªgi⁄_ödex_t
 
physmem_ªgi⁄
;

435 
Æloc_chunk_size
;

436 } 
	tvlib_buf„r_poﬁ_t
;

440 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

443 
uw‹d
 
buf„r_mem_°¨t
;

444 
uw‹d
 
buf„r_mem_size
;

445 
vlib_buf„r_poﬁ_t
 *
buf„r_poﬁs
;

448 
	`u32
 (*
buf„r_‰ì_ˇŒback
Ë(
vlib_maö_t
 * 
vm
,

449 
u32
 * 
buf„rs
,

450 
u32
 
n_buf„rs
, u32 
fﬁlow_buf„r_√xt
);

455 
vlib_buf„r_‰ì_li°_t
 *
buf„r_‰ì_li°_poﬁ
;

456 
	#VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
 (0)

	)

457 
	#VLIB_BUFFER_DEFAULT_FREE_LIST_BYTES
 
VLIB_BUFFER_DATA_SIZE


	)

461 
uw‹d
 *
‰ì_li°_by_size
;

467 
uw‹d
 *
buf„r_known_hash
;

468 
˛ib_•ölock_t
 
buf„r_known_hash_lockp
;

471 
vlib_buf„r_‰ì_li°_t
 **
™noun˚_li°
;

474 
vlib_buf„r_ˇŒbacks_t
 
cb
;

475 
ˇŒbacks_ªgi°îed
;

476 } 
	tvlib_buf„r_maö_t
;

478 
u8
 
	`vlib_buf„r_add_physmem_ªgi⁄
 (
vlib_maö_t
 *
vm
,

479 
vlib_physmem_ªgi⁄_ödex_t
 
ªgi⁄
);

481 
˛ib_îr‹_t
 *
	`vlib_buf„r_maö_öô
 (
vlib_maö_t
 *
vm
);

485 
vlib_maö_t
 *
vlib_maö
;

487 
u32
 
fú°_buf„r
, 
œ°_buf„r
;

494 
u32
 
n_tŸÆ_d©a_byãs
;

498 
u32
 
max_n_d©a_byãs_≥r_chaö
;

501 
u32
 
√xt_ödex
;

504 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
;

505 } 
tx
;

510 
u32
 *
buf„r_fifo
;

513 
uw‹d
 
ªady_⁄e_time_evít
;

514 } 
rx
;

516 } 
	tvlib_£rülize_buf„r_maö_t
;

518 
	`£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
, 
vlib_maö_t
 *
vm
,

519 
vlib_£rülize_buf„r_maö_t
 * 
sm
);

520 
	`un£rülize_›í_vlib_buf„r
 (
£rülize_maö_t
 * 
m
,

521 
vlib_maö_t
 *
vm
,

522 
vlib_£rülize_buf„r_maö_t
 * 
sm
);

524 
u32
 
	`£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
);

525 
	`un£rülize_˛o£_vlib_buf„r
 (
£rülize_maö_t
 * 
m
);

526 *
	`vlib_£t_buf„r_‰ì_ˇŒback
 (
vlib_maö_t
 *
vm
, *
Â
);

528 
Æways_ölöe
 
u32


529 
	$£rülize_vlib_buf„r_n_byãs
 (
£rülize_maö_t
 * 
m
)

531 
£rülize_°ªam_t
 *
s
 = &
m
->
°ªam
;

532 
vlib_£rülize_buf„r_maö_t
 *
sm


533 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

534 
vlib_£rülize_buf„r_maö_t
 *);

535  
sm
->
tx
.
n_tŸÆ_d©a_byãs
 + 
s
->
cuºít_buf„r_ödex
 +

536 
	`vec_Àn
 (
s
->
ovîÊow_buf„r
);

537 
	}
}

547 
	#VLIB_BUFFER_TRACE_TRAJECTORY
 0

	)

549 #i‡
VLIB_BUFFER_TRACE_TRAJECTORY
 > 0

550 (*
vlib_buf„r_åa˚_åaje˘‹y_cb
Ë(
vlib_buf„r_t
 * 
b
, 
u32
 
ödex
);

551 (*
vlib_buf„r_åa˚_åaje˘‹y_öô_cb
Ë(
vlib_buf„r_t
 * 
b
);

552 
	`vlib_buf„r_åa˚_åaje˘‹y_öô
 (
vlib_buf„r_t
 * 
b
);

553 
	#VLIB_BUFFER_TRACE_TRAJECTORY_INIT
(
b
) \

554 
	`vlib_buf„r_åa˚_åaje˘‹y_öô
 (
b
);

	)

556 
	#VLIB_BUFFER_TRACE_TRAJECTORY_INIT
(
b
)

	)

561 
	#VLIB_BUFFER_REGISTER_CALLBACKS
(
x
,...) \

562 
__VA_ARGS__
 
vlib_buf„r_ˇŒbacks_t
 
__
##
x
##
_buf„r_ˇŒbacks
; \

563 
__vlib_add_buf„r_ˇŒbacks_t_
##
	`x
 () \

564 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

565 
__vlib_add_buf„r_ˇŒbacks_t_
##
	`x
 () \

567 i‡(
vlib_buf„r_ˇŒbacks
) \

568 
	`˛ib_∑nic
 ("vlib buffer callbacksálreadyÑegistered"); \

569 
vlib_buf„r_ˇŒbacks
 = &
__
##
x
##
_buf„r_ˇŒbacks
; \

570 
	}
} \

571 
__VA_ARGS__
 
vlib_buf„r_ˇŒbacks_t
 
__
##
x
##
_buf„r_ˇŒbacks


	)

	@/usr/include/vlib/buffer_funcs.h

40 #i‚de‡
ö˛uded_vlib_buf„r_funcs_h


41 
	#ö˛uded_vlib_buf„r_funcs_h


	)

43 
	~<vµö‰a/hash.h
>

56 
Æways_ölöe
 
vlib_buf„r_t
 *

57 
	$vlib_gë_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

59 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

60 
uw‹d
 
off£t
 = ((uw‹dË
buf„r_ödex
Ë<< 
CLIB_LOG2_CACHE_LINE_BYTES
;

61 
	`ASSERT
 (
off£t
 < 
bm
->
buf„r_mem_size
);

63  
	`uw‹d_to_poöãr
 (
bm
->
buf„r_mem_°¨t
 + 
off£t
, *);

64 
	}
}

73 
Æways_ölöe
 
u32


74 
	$vlib_gë_buf„r_ödex
 (
vlib_maö_t
 * 
vm
, *
p
)

76 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

77 
uw‹d
 
off£t
 = 
	`poöãr_to_uw‹d
 (
p
Ë- 
bm
->
buf„r_mem_°¨t
;

78 
	`ASSERT
 (
	`poöãr_to_uw‹d
 (
p
Ë>
bm
->
buf„r_mem_°¨t
);

79 
	`ASSERT
 (
off£t
 < 
bm
->
buf„r_mem_size
);

80 
	`ASSERT
 ((
off£t
 % (1 << 
CLIB_LOG2_CACHE_LINE_BYTES
)) == 0);

81  
off£t
 >> 
CLIB_LOG2_CACHE_LINE_BYTES
;

82 
	}
}

90 
Æways_ölöe
 
vlib_buf„r_t
 *

91 
	$vlib_gë_√xt_buf„r
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

93  (
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT


94 ? 
	`vlib_gë_buf„r
 (
vm
, 
b
->
√xt_buf„r
) : 0);

95 
	}
}

97 
uw‹d
 
vlib_buf„r_Àngth_ö_chaö_¶ow_∑th
 (
vlib_maö_t
 * 
vm
,

98 
vlib_buf„r_t
 * 
b_fú°
);

106 
Æways_ölöe
 
uw‹d


107 
	$vlib_buf„r_Àngth_ö_chaö
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

109 
uw‹d
 
Àn
 = 
b
->
cuºít_Àngth
;

111 i‡(
	`PREDICT_TRUE
 ((
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
) == 0))

112  
Àn
;

114 i‡(
	`PREDICT_TRUE
 (
b
->
Êags
 & 
VLIB_BUFFER_TOTAL_LENGTH_VALID
))

115  
Àn
 + 
b
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

117  
	`vlib_buf„r_Àngth_ö_chaö_¶ow_∑th
 (
vm
, 
b
);

118 
	}
}

126 
Æways_ölöe
 
uw‹d


127 
	$vlib_buf„r_ödex_Àngth_ö_chaö
 (
vlib_maö_t
 * 
vm
, 
u32
 
bi
)

129 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
);

130  
	`vlib_buf„r_Àngth_ö_chaö
 (
vm
, 
b
);

131 
	}
}

140 
Æways_ölöe
 
uw‹d


141 
	$vlib_buf„r_c⁄ã¡s
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
, 
u8
 * 
c⁄ã¡s
)

143 
uw‹d
 
c⁄ã¡_Àn
 = 0;

144 
uw‹d
 
l
;

145 
vlib_buf„r_t
 *
b
;

149 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

150 
l
 = 
b
->
cuºít_Àngth
;

151 
	`˛ib_mem˝y
 (
c⁄ã¡s
 + 
c⁄ã¡_Àn
, 
b
->
d©a
 + b->
cuºít_d©a
, 
l
);

152 
c⁄ã¡_Àn
 +
l
;

153 i‡(!(
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

155 
buf„r_ödex
 = 
b
->
√xt_buf„r
;

158  
c⁄ã¡_Àn
;

159 
	}
}

162 
Æways_ölöe
 
u64


163 
	$vlib_gë_buf„r_d©a_physiˇl_addªss
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

165 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

166 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

167 
vlib_buf„r_poﬁ_t
 *
poﬁ
 = 
	`vec_ñt_©_ödex
 (
bm
->
buf„r_poﬁs
,

168 
b
->
buf„r_poﬁ_ödex
);

170  
	`vlib_physmem_vútuÆ_to_physiˇl
 (
vm
, 
poﬁ
->
physmem_ªgi⁄
, 
b
->
d©a
);

171 
	}
}

181 
	#vlib_¥e„tch_buf„r_wôh_ödex
(
vm
,
bi
,
ty≥
) \

183 
vlib_buf„r_t
 * 
_b
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi
); \

184 
	`vlib_¥e„tch_buf„r_hódî
 (
_b
, 
ty≥
); \

185 } 0)

	)

195 
	#vlib_buf„r_f‹óch_Æloˇãd
(
vm
,
bi
,
body
) \

197 
vlib_maö_t
 * 
_vmaö
 = (
vm
); \

198 
vlib_buf„r_maö_t
 * 
_bmaö
 = &
_vmaö
->
buf„r_maö
; \

199 
hash_∑ú_t
 * 
_vb∑ú
; \

200 
	`hash_f‹óch_∑ú
(
_vb∑ú
, 
_bmaö
->
buf„r_known_hash
, ({ \

201 i‡(
VLIB_BUFFER_KNOWN_ALLOCATED
 =
_vb∑ú
->
vÆue
[0]) { \

202 (
bi
Ë
_vb∑ú
->
key
; \

203 
body
; \

206 } 0)

	)

212 
	mVLIB_BUFFER_UNKNOWN
,

215 
	mVLIB_BUFFER_KNOWN_FREE
,

216 
	mVLIB_BUFFER_KNOWN_ALLOCATED
,

217 } 
	tvlib_buf„r_known_°©e_t
;

219 
vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
,

220 
uw‹d
 
n_buf„rs
,

221 
vlib_buf„r_known_°©e_t


222 
ex≥˘ed_°©e
);

224 
Æways_ölöe
 
vlib_buf„r_known_°©e_t


225 
	$vlib_buf„r_is_known
 (
u32
 
buf„r_ödex
)

227 
vlib_buf„r_maö_t
 *
bm
 = 
vlib_globÆ_maö
.
buf„r_maö
;

229 
	`˛ib_•ölock_lock
 (&
bm
->
buf„r_known_hash_lockp
);

230 
uw‹d
 *
p
 = 
	`hash_gë
 (
bm
->
buf„r_known_hash
, 
buf„r_ödex
);

231 
	`˛ib_•ölock_u∆ock
 (&
bm
->
buf„r_known_hash_lockp
);

232  
p
 ?Ö[0] : 
VLIB_BUFFER_UNKNOWN
;

233 
	}
}

235 
Æways_ölöe
 

236 
	$vlib_buf„r_£t_known_°©e
 (
u32
 
buf„r_ödex
,

237 
vlib_buf„r_known_°©e_t
 
°©e
)

239 
vlib_buf„r_maö_t
 *
bm
 = 
vlib_globÆ_maö
.
buf„r_maö
;

241 
	`˛ib_•ölock_lock
 (&
bm
->
buf„r_known_hash_lockp
);

242 
	`hash_£t
 (
bm
->
buf„r_known_hash
, 
buf„r_ödex
, 
°©e
);

243 
	`˛ib_•ölock_u∆ock
 (&
bm
->
buf„r_known_hash_lockp
);

244 
	}
}

248 
u8
 *
vlib_vÆid©e_buf„r
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
,

249 
uw‹d
 
fﬁlow_chaö
);

251 
Æways_ölöe
 
u32


252 
	$vlib_buf„r_round_size
 (
u32
 
size
)

254  
	`round_pow2
 (
size
,  (
vlib_buf„r_t
));

255 
	}
}

257 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_ödex_t


258 
	$vlib_buf„r_gë_‰ì_li°_ödex
 (
vlib_buf„r_t
 * 
b
)

260 i‡(
	`PREDICT_FALSE
 (
b
->
Êags
 & 
VLIB_BUFFER_NON_DEFAULT_FREELIST
))

261  
b
->
‰ì_li°_ödex
;

264 
	}
}

266 
Æways_ölöe
 

267 
	$vlib_buf„r_£t_‰ì_li°_ödex
 (
vlib_buf„r_t
 * 
b
,

268 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

270 i‡(
	`PREDICT_FALSE
 (
ödex
))

272 
b
->
Êags
 |
VLIB_BUFFER_NON_DEFAULT_FREELIST
;

273 
b
->
‰ì_li°_ödex
 = 
ödex
;

276 
b
->
Êags
 &~
VLIB_BUFFER_NON_DEFAULT_FREELIST
;

277 
	}
}

287 
Æways_ölöe
 
u32


288 
	$vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

289 
u32
 * 
buf„rs
,

290 
u32
 
n_buf„rs
,

291 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

293 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

294 
vlib_buf„r_‰ì_li°_t
 *
Ê
;

295 
u32
 *
§c
;

296 
uw‹d
 
Àn
;

298 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_fûl_‰ì_li°_cb
);

300 
Ê
 = 
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
ödex
);

302 
Àn
 = 
	`vec_Àn
 (
Ê
->
buf„rs
);

304 i‡(
	`PREDICT_FALSE
 (
Àn
 < 
n_buf„rs
))

306 
bm
->
cb
.
	`vlib_buf„r_fûl_‰ì_li°_cb
 (
vm
, 
Ê
, 
n_buf„rs
);

307 i‡(
	`PREDICT_FALSE
 ((
Àn
 = 
	`vec_Àn
 (
Ê
->
buf„rs
)) == 0))

312 
n_buf„rs
 = 
	`˛ib_mö
 (
Àn
,Ç_buffers);

316 
§c
 = 
Ê
->
buf„rs
 + 
Àn
 - 
n_buf„rs
;

317 
	`˛ib_mem˝y
 (
buf„rs
, 
§c
, 
n_buf„rs
 *  (
u32
));

318 
	`_vec_Àn
 (
Ê
->
buf„rs
Ë-
n_buf„rs
;

321 
	`vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vm
, 
buf„rs
, 
n_buf„rs
,

322 
VLIB_BUFFER_KNOWN_FREE
);

324  
n_buf„rs
;

327 
§c
 = 
Ê
->
buf„rs
 + 
Àn
 - 
n_buf„rs
;

328 
	`˛ib_mem˝y
 (
buf„rs
, 
§c
, 
n_buf„rs
 *  (
u32
));

329 
	`_vec_Àn
 (
Ê
->
buf„rs
Ë-
n_buf„rs
;

332 
	`vlib_buf„r_vÆid©e_Æloc_‰ì
 (
vm
, 
buf„rs
, 
n_buf„rs
,

333 
VLIB_BUFFER_KNOWN_FREE
);

335  
n_buf„rs
;

336 
	}
}

346 
Æways_ölöe
 
u32


347 
	$vlib_buf„r_Æloc
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
buf„rs
, u32 
n_buf„rs
)

349  
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, 
buf„rs
, 
n_buf„rs
,

350 
VLIB_BUFFER_DEFAULT_FREE_LIST_INDEX
);

351 
	}
}

363 
Æways_ölöe
 
u32


364 
	$vlib_buf„r_Æloc_to_rög
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
rög
, u32 
°¨t
,

365 
u32
 
rög_size
, u32 
n_buf„rs
)

367 
u32
 
n_Æloc
;

369 
	`ASSERT
 (
n_buf„rs
 <
rög_size
);

371 i‡(
	`PREDICT_TRUE
 (
°¨t
 + 
n_buf„rs
 <
rög_size
))

372  
	`vlib_buf„r_Æloc
 (
vm
, 
rög
 + 
°¨t
, 
n_buf„rs
);

374 
n_Æloc
 = 
	`vlib_buf„r_Æloc
 (
vm
, 
rög
 + 
°¨t
, 
rög_size
 - start);

376 i‡(
	`PREDICT_TRUE
 (
n_Æloc
 =
rög_size
 - 
°¨t
))

377 
n_Æloc
 +
	`vlib_buf„r_Æloc
 (
vm
, 
rög
, 
n_buf„rs
 -Ç_alloc);

379  
n_Æloc
;

380 
	}
}

390 
Æways_ölöe
 

391 
	$vlib_buf„r_‰ì
 (
vlib_maö_t
 * 
vm
,

393 
u32
 * 
buf„rs
,

395 
u32
 
n_buf„rs
)

397 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

399 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_‰ì_cb
);

401  
bm
->
cb
.
	`vlib_buf„r_‰ì_cb
 (
vm
, 
buf„rs
, 
n_buf„rs
);

402 
	}
}

411 
Æways_ölöe
 

412 
	$vlib_buf„r_‰ì_no_√xt
 (
vlib_maö_t
 * 
vm
,

414 
u32
 * 
buf„rs
,

416 
u32
 
n_buf„rs
)

418 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

420 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_‰ì_no_√xt_cb
);

422  
bm
->
cb
.
	`vlib_buf„r_‰ì_no_√xt_cb
 (
vm
, 
buf„rs
, 
n_buf„rs
);

423 
	}
}

431 
Æways_ölöe
 

432 
	$vlib_buf„r_‰ì_⁄e
 (
vlib_maö_t
 * 
vm
, 
u32
 
buf„r_ödex
)

434 
	`vlib_buf„r_‰ì
 (
vm
, &
buf„r_ödex
, 1);

435 
	}
}

445 
Æways_ölöe
 

446 
	$vlib_buf„r_‰ì_‰om_rög
 (
vlib_maö_t
 * 
vm
, 
u32
 * 
rög
, u32 
°¨t
,

447 
u32
 
rög_size
, u32 
n_buf„rs
)

449 
	`ASSERT
 (
n_buf„rs
 <
rög_size
);

451 i‡(
	`PREDICT_TRUE
 (
°¨t
 + 
n_buf„rs
 <
rög_size
))

453 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
 + 
°¨t
, 
n_buf„rs
);

457 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
 + 
°¨t
, 
rög_size
 - start);

458 
	`vlib_buf„r_‰ì
 (
vm
, 
rög
, 
n_buf„rs
 - (
rög_size
 - 
°¨t
));

460 
	}
}

464 
vlib_buf„r_‰ì_li°_ödex_t
 
vlib_buf„r_¸óã_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

465 
u32
 
n_d©a_byãs
,

466 *
fmt
, ...);

467 
Æways_ölöe
 

468 
	$vlib_buf„r_dñëe_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

469 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
)

471 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

473 
	`ASSERT
 (
bm
->
cb
.
vlib_buf„r_dñëe_‰ì_li°_cb
);

475 
bm
->
cb
.
	`vlib_buf„r_dñëe_‰ì_li°_cb
 (
vm
, 
‰ì_li°_ödex
);

476 
	}
}

479 
vlib_buf„r_‰ì_li°_ödex_t
 
vlib_buf„r_gë_‹_¸óã_‰ì_li°
 (
vlib_maö_t


480 * 
vm
,

481 
u32


482 
n_d©a_byãs
,

483 *
fmt
,

487 
vlib_buf„r_mîge_‰ì_li°s
 (
vlib_buf„r_‰ì_li°_t
 * 
d°
,

488 
vlib_buf„r_‰ì_li°_t
 * 
§c
);

491 
vlib_buf„r_‰ì_li°_fûl_u«lig√d
 (
vlib_maö_t
 * 
vm
,

492 
vlib_buf„r_‰ì_li°_t
 *

493 
‰ì_li°
,

494 
uw‹d
 
n_u«lig√d_buf„rs
);

496 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_ödex_t


497 
	$vlib_buf„r_gë_‰ì_li°_wôh_size
 (
vlib_maö_t
 * 
vm
, 
u32
 
size
)

499 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

501 
size
 = 
	`vlib_buf„r_round_size
 (size);

502 
uw‹d
 *
p
 = 
	`hash_gë
 (
bm
->
‰ì_li°_by_size
, 
size
);

503  
p
 ?Ö[0] : ~0;

504 
	}
}

506 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_t
 *

507 
	$vlib_buf„r_gë_buf„r_‰ì_li°
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
,

508 
vlib_buf„r_‰ì_li°_ödex_t
 * 
ödex
)

510 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

511 
vlib_buf„r_‰ì_li°_ödex_t
 
i
;

513 *
ödex
 = 
i
 = 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
b
);

514  
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
i
);

515 
	}
}

517 
Æways_ölöe
 
vlib_buf„r_‰ì_li°_t
 *

518 
	$vlib_buf„r_gë_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

519 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
)

521 
vlib_buf„r_maö_t
 *
bm
 = 
vm
->
buf„r_maö
;

522 
vlib_buf„r_‰ì_li°_t
 *
f
;

524 
f
 = 
	`poﬁ_ñt_©_ödex
 (
bm
->
buf„r_‰ì_li°_poﬁ
, 
‰ì_li°_ödex
);

527 
	`ASSERT
 (
f
->
ödex
 =
‰ì_li°_ödex
);

529  
f
;

530 
	}
}

532 
Æways_ölöe
 
u32


533 
	$vlib_buf„r_‰ì_li°_buf„r_size
 (
vlib_maö_t
 * 
vm
,

534 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
)

536 
vlib_buf„r_‰ì_li°_t
 *
f
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vm
, 
ödex
);

537  
f
->
n_d©a_byãs
;

538 
	}
}

540 
vlib_Æig√d_mem˝y
 (*
_d°
, *
_§c
, 
n_byãs
);

543 
Æways_ölöe
 

544 
	$vlib_c›y_buf„rs
 (
u32
 * 
d°
, u32 * 
§c
, u32 
n
)

546 
n
 >= 4)

548 
d°
[0] = 
§c
[0];

549 
d°
[1] = 
§c
[1];

550 
d°
[2] = 
§c
[2];

551 
d°
[3] = 
§c
[3];

552 
d°
 += 4;

553 
§c
 += 4;

554 
n
 -= 4;

556 
n
 > 0)

558 
d°
[0] = 
§c
[0];

559 
d°
 += 1;

560 
§c
 += 1;

561 
n
 -= 1;

563 
	}
}

566 
u32
 
vlib_buf„r_add_d©a
 (
vlib_maö_t
 * 
vm
,

567 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
,

568 
u32
 
buf„r_ödex
, *
d©a
, u32 
n_d©a_byãs
);

571 
Æways_ölöe
 
vlib_buf„r_t
 *

572 
	$vlib_buf„r_c›y
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

574 
vlib_buf„r_t
 *
s
, *
d
, *
fd
;

575 
uw‹d
 
n_Æloc
, 
n_buf„rs
 = 1;

576 
u32
 
Êag_mask
 = 
VLIB_BUFFER_NEXT_PRESENT
 | 
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

577 
i
;

579 
s
 = 
b
;

580 
s
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

582 
n_buf„rs
++;

583 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

585 
u32
 
√w_buf„rs
[
n_buf„rs
];

587 
n_Æloc
 = 
	`vlib_buf„r_Æloc
 (
vm
, 
√w_buf„rs
, 
n_buf„rs
);

590 i‡(
	`PREDICT_FALSE
 (
n_Æloc
 < 
n_buf„rs
))

592 i‡(
n_Æloc
 > 0)

593 
	`vlib_buf„r_‰ì
 (
vm
, 
√w_buf„rs
, 
n_Æloc
);

598 
s
 = 
b
;

599 
fd
 = 
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
√w_buf„rs
[0]);

600 
d
->
cuºít_d©a
 = 
s
->current_data;

601 
d
->
cuºít_Àngth
 = 
s
->current_length;

602 
d
->
Êags
 = 
s
->Êag†& 
Êag_mask
;

603 
d
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 =

604 
s
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

605 
	`˛ib_mem˝y
 (
d
->
›aque
, 
s
->opaque,  (s->opaque));

606 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
),

607 
	`vlib_buf„r_gë_cuºít
 (
s
), s->
cuºít_Àngth
);

610 
i
 = 1; i < 
n_buf„rs
; i++)

613 
d
->
√xt_buf„r
 = 
√w_buf„rs
[
i
];

615 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

616 
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
√w_buf„rs
[
i
]);

617 
d
->
cuºít_d©a
 = 
s
->current_data;

618 
d
->
cuºít_Àngth
 = 
s
->current_length;

619 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
),

620 
	`vlib_buf„r_gë_cuºít
 (
s
), s->
cuºít_Àngth
);

621 
d
->
Êags
 = 
s
->Êag†& 
Êag_mask
;

624  
fd
;

625 
	}
}

639 
Æways_ölöe
 
u16


640 
	$vlib_buf„r_˛⁄e_256
 (
vlib_maö_t
 * 
vm
, 
u32
 
§c_buf„r
, u32 * 
buf„rs
,

641 
u16
 
n_buf„rs
, u16 
hód_íd_off£t
)

643 
u16
 
i
;

644 
vlib_buf„r_t
 *
s
 = 
	`vlib_gë_buf„r
 (
vm
, 
§c_buf„r
);

646 
	`ASSERT
 (
s
->
n_add_ªfs
 == 0);

647 
	`ASSERT
 (
n_buf„rs
);

648 
	`ASSERT
 (
n_buf„rs
 <= 256);

650 i‡(
s
->
cuºít_Àngth
 <
hód_íd_off£t
 + 
CLIB_CACHE_LINE_BYTES
 * 2)

652 
buf„rs
[0] = 
§c_buf„r
;

653 
i
 = 1; i < 
n_buf„rs
; i++)

655 
vlib_buf„r_t
 *
d
;

656 
d
 = 
	`vlib_buf„r_c›y
 (
vm
, 
s
);

657 i‡(
d
 == 0)

658  
i
;

659 
buf„rs
[
i
] = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
d
);

662  
n_buf„rs
;

665 i‡(
	`PREDICT_FALSE
 (
n_buf„rs
 == 1))

667 
buf„rs
[0] = 
§c_buf„r
;

671 
n_buf„rs
 = 
	`vlib_buf„r_Æloc_‰om_‰ì_li°
 (
vm
, 
buf„rs
,Ç_buffers,

672 
vlib_buf„r_gë_‰ì_li°_ödex


673 (
s
));

675 
i
 = 0; i < 
n_buf„rs
; i++)

677 
vlib_buf„r_t
 *
d
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„rs
[
i
]);

678 
d
->
cuºít_d©a
 = 
s
->current_data;

679 
d
->
cuºít_Àngth
 = 
hód_íd_off£t
;

680 
	`vlib_buf„r_£t_‰ì_li°_ödex
 (
d
,

681 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
s
));

682 
d
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 =

683 
s
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 + s->
cuºít_Àngth
 -

684 
hód_íd_off£t
;

685 
d
->
Êags
 = 
s
->Êag†| 
VLIB_BUFFER_NEXT_PRESENT
;

686 
d
->
Êags
 &~
VLIB_BUFFER_EXT_HDR_VALID
;

687 
	`˛ib_mem˝y
 (
d
->
›aque
, 
s
->opaque,  (s->opaque));

688 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
d
), vlib_buf„r_gë_cuºíà(
s
),

689 
hód_íd_off£t
);

690 
d
->
√xt_buf„r
 = 
§c_buf„r
;

692 
	`vlib_buf„r_adv™˚
 (
s
, 
hód_íd_off£t
);

693 
s
->
n_add_ªfs
 = 
n_buf„rs
 - 1;

694 
s
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

696 
s
 = 
	`vlib_gë_buf„r
 (
vm
, s->
√xt_buf„r
);

697 
s
->
n_add_ªfs
 = 
n_buf„rs
 - 1;

700  
n_buf„rs
;

701 
	}
}

715 
Æways_ölöe
 
u16


716 
	$vlib_buf„r_˛⁄e
 (
vlib_maö_t
 * 
vm
, 
u32
 
§c_buf„r
, u32 * 
buf„rs
,

717 
u16
 
n_buf„rs
, u16 
hód_íd_off£t
)

719 
vlib_buf„r_t
 *
s
 = 
	`vlib_gë_buf„r
 (
vm
, 
§c_buf„r
);

720 
u16
 
n_˛⁄ed
 = 0;

722 
n_buf„rs
 > 256)

724 
vlib_buf„r_t
 *
c›y
;

725 
c›y
 = 
	`vlib_buf„r_c›y
 (
vm
, 
s
);

726 
n_˛⁄ed
 +
	`vlib_buf„r_˛⁄e_256
 (
vm
,

727 
	`vlib_gë_buf„r_ödex
 (
vm
, 
c›y
),

728 (
buf„rs
 + 
n_˛⁄ed
),

729 256, 
hód_íd_off£t
);

730 
n_buf„rs
 -= 256;

732 
n_˛⁄ed
 +
	`vlib_buf„r_˛⁄e_256
 (
vm
, 
§c_buf„r
,

733 
buf„rs
 + 
n_˛⁄ed
,

734 
n_buf„rs
, 
hód_íd_off£t
);

736  
n_˛⁄ed
;

737 
	}
}

746 
Æways_ölöe
 

747 
	$vlib_buf„r_©èch_˛⁄e
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
hód
,

748 
vlib_buf„r_t
 * 
èû
)

750 
	`ASSERT
 ((
hód
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
) == 0);

751 
	`ASSERT
 (
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
hód
) ==

752 
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
èû
));

754 
hód
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

755 
hód
->
Êags
 &~
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

756 
hód
->
Êags
 &~
VLIB_BUFFER_EXT_HDR_VALID
;

757 
hód
->
Êags
 |(
èû
->Êag†& 
VLIB_BUFFER_TOTAL_LENGTH_VALID
);

758 
hód
->
√xt_buf„r
 = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
èû
);

759 
hód
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 = 
èû
->
cuºít_Àngth
 +

760 
èû
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
;

762 
√xt_£gmít
:

763 
	`__sync_add_™d_„tch
 (&
èû
->
n_add_ªfs
, 1);

765 i‡(
èû
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

767 
èû
 = 
	`vlib_gë_buf„r
 (
vm
,Åaû->
√xt_buf„r
);

768 
√xt_£gmít
;

770 
	}
}

773 
Æways_ölöe
 

774 
	$vlib_buf„r_chaö_öô
 (
vlib_buf„r_t
 * 
fú°
)

776 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 = 0;

777 
fú°
->
cuºít_Àngth
 = 0;

778 
fú°
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

779 
fú°
->
Êags
 |
VLIB_BUFFER_TOTAL_LENGTH_VALID
;

780 
	}
}

783 
Æways_ölöe
 
vlib_buf„r_t
 *

784 
	$vlib_buf„r_chaö_buf„r
 (
vlib_maö_t
 * 
vm
,

785 
vlib_buf„r_t
 * 
fú°
,

786 
vlib_buf„r_t
 * 
œ°
, 
u32
 
√xt_bi
)

788 
vlib_buf„r_t
 *
√xt_buf„r
 = 
	`vlib_gë_buf„r
 (
vm
, 
√xt_bi
);

789 
œ°
->
√xt_buf„r
 = 
√xt_bi
;

790 
œ°
->
Êags
 |
VLIB_BUFFER_NEXT_PRESENT
;

791 
√xt_buf„r
->
cuºít_Àngth
 = 0;

792 
√xt_buf„r
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

793  
√xt_buf„r
;

794 
	}
}

800 
Æways_ölöe
 

801 
	$vlib_buf„r_chaö_ö¸ó£_Àngth
 (
vlib_buf„r_t
 * 
fú°
,

802 
vlib_buf„r_t
 * 
œ°
, 
i32
 
Àn
)

804 
œ°
->
cuºít_Àngth
 +
Àn
;

805 i‡(
fú°
 !
œ°
)

806 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 +
Àn
;

807 
	}
}

812 
Æways_ölöe
 
u16


813 
	$vlib_buf„r_chaö_≠≥nd_d©a
 (
vlib_maö_t
 * 
vm
,

814 
vlib_buf„r_‰ì_li°_ödex_t
 
‰ì_li°_ödex
,

815 
vlib_buf„r_t
 * 
fú°
,

816 
vlib_buf„r_t
 * 
œ°
, *
d©a
, 
u16
 
d©a_Àn
)

818 
u32
 
n_buf„r_byãs
 =

819 
	`vlib_buf„r_‰ì_li°_buf„r_size
 (
vm
, 
‰ì_li°_ödex
);

820 
	`ASSERT
 (
n_buf„r_byãs
 >
œ°
->
cuºít_Àngth
 +Üa°->
cuºít_d©a
);

821 
u16
 
Àn
 = 
	`˛ib_mö
 (
d©a_Àn
,

822 
n_buf„r_byãs
 - 
œ°
->
cuºít_Àngth
 -

823 
œ°
->
cuºít_d©a
);

824 
	`˛ib_mem˝y
 (
	`vlib_buf„r_gë_cuºít
 (
œ°
Ë+Üa°->
cuºít_Àngth
, 
d©a
,

825 
Àn
);

826 
	`vlib_buf„r_chaö_ö¸ó£_Àngth
 (
fú°
, 
œ°
, 
Àn
);

827  
Àn
;

828 
	}
}

835 
u16


836 
vlib_buf„r_chaö_≠≥nd_d©a_wôh_Æloc
 (
vlib_maö_t
 * 
vm
,

837 
vlib_buf„r_‰ì_li°_ödex_t


838 
‰ì_li°_ödex
,

839 
vlib_buf„r_t
 * 
fú°
,

840 
vlib_buf„r_t
 ** 
œ°
, *
d©a
,

841 
u16
 
d©a_Àn
);

842 
vlib_buf„r_chaö_vÆid©e
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
fú°
);

844 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_buf„r
, 
	gf‹m©_vlib_buf„r_™d_d©a
,

845 
	gf‹m©_vlib_buf„r_c⁄ã¡s
;

850 
u8
 *
	m∑ckë_d©a
;

854 
u32
 
	mmö_n_buf„rs_óch_physmem_Æloc
;

857 
vlib_buf„r_‰ì_li°_ödex_t
 
	m‰ì_li°_ödex
;

859 
u32
 *
	m‰ì_buf„rs
;

860 } 
	tvlib_∑ckë_ãm∂©e_t
;

862 
vlib_∑ckë_ãm∂©e_gë_∑ckë_hñ≥r
 (
vlib_maö_t
 * 
vm
,

863 
vlib_∑ckë_ãm∂©e_t
 * 
t
);

865 
vlib_∑ckë_ãm∂©e_öô
 (
vlib_maö_t
 * 
vm
,

866 
vlib_∑ckë_ãm∂©e_t
 * 
t
,

867 *
∑ckë_d©a
,

868 
uw‹d
 
n_∑ckë_d©a_byãs
,

869 
uw‹d
 
mö_n_buf„rs_óch_physmem_Æloc
,

870 *
fmt
, ...);

872 *
vlib_∑ckë_ãm∂©e_gë_∑ckë
 (
vlib_maö_t
 * 
vm
,

873 
vlib_∑ckë_ãm∂©e_t
 * 
t
,

874 
u32
 * 
bi_ªsu…
);

876 
Æways_ölöe
 

877 
	$vlib_∑ckë_ãm∂©e_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_∑ckë_ãm∂©e_t
 * 
t
)

879 
	`vec_‰ì
 (
t
->
∑ckë_d©a
);

880 
	}
}

882 
Æways_ölöe
 
u32


883 
	$un£rülize_vlib_buf„r_n_byãs
 (
£rülize_maö_t
 * 
m
)

885 
£rülize_°ªam_t
 *
s
 = &
m
->
°ªam
;

886 
vlib_£rülize_buf„r_maö_t
 *
sm


887 
	`uw‹d_to_poöãr
 (
m
->
°ªam
.
d©a_fun˘i⁄_›aque
,

888 
vlib_£rülize_buf„r_maö_t
 *);

889 
vlib_maö_t
 *
vm
 = 
sm
->
vlib_maö
;

890 
u32
 
n
, *
f
;

892 
n
 = 
s
->
n_buf„r_byãs
 - s->
cuºít_buf„r_ödex
;

893 i‡(
sm
->
œ°_buf„r
 != ~0)

895 
vlib_buf„r_t
 *
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
sm
->
œ°_buf„r
);

896 
b
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

898 
b
 = 
	`vlib_gë_buf„r
 (
vm
, b->
√xt_buf„r
);

899 
n
 +
b
->
cuºít_Àngth
;

904 
	`˛ib_fifo_f‹óch
 (
f
, 
sm
->
rx
.
buf„r_fifo
, ({

905 
n
 +
	`vlib_buf„r_ödex_Àngth_ö_chaö
 (
vm
, 
f
[0]);

909  
n
;

910 
	}
}

915 
Æways_ölöe
 

916 
	$vlib_buf„r_öô_f‹_‰ì_li°
 (
vlib_buf„r_t
 * 
d°
,

917 
vlib_buf„r_‰ì_li°_t
 * 
Ê
)

919 
vlib_buf„r_t
 *
§c
 = &
Ê
->
buf„r_öô_ãm∂©e
;

922 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe0
) == 0);

923 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe1
) ==

924 
CLIB_CACHE_LINE_BYTES
);

925 
	`ASSERT
 (
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ˇchñöe2
) ==

926 
CLIB_CACHE_LINE_BYTES
 * 2);

929 
	`ASSERT
 (
Ê
->
ödex
 =
	`vlib_buf„r_gë_‰ì_li°_ödex
 (
§c
));

931 
	`˛ib_mem˝y
 (
	`STRUCT_MARK_PTR
 (
d°
, 
ãm∂©e_°¨t
),

932 
	`STRUCT_MARK_PTR
 (
§c
, 
ãm∂©e_°¨t
),

933 
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ãm∂©e_íd
) -

934 
	`STRUCT_OFFSET_OF
 (
vlib_buf„r_t
, 
ãm∂©e_°¨t
));

937 
d°
->
n_add_ªfs
 = 
§c
->n_add_refs;

938 
	`vlib_buf„r_£t_‰ì_li°_ödex
 (
d°
, 
Ê
->
ödex
);

941 
	#_
(
f
Ë
	`ASSERT
 (
d°
->‡=
§c
->f);

	)

942 
	`_
(
cuºít_d©a
);

943 
	`_
(
cuºít_Àngth
);

944 
	`_
(
Êags
);

945 #unde‡
_


952 
	`ASSERT
 (
d°
->
n_add_ªfs
 == 0);

953 
	}
}

955 
Æways_ölöe
 

956 
	$vlib_buf„r_add_to_‰ì_li°
 (
vlib_maö_t
 * 
vm
,

957 
vlib_buf„r_‰ì_li°_t
 * 
f
,

958 
u32
 
buf„r_ödex
, 
u8
 
do_öô
)

960 
vlib_buf„r_t
 *
b
;

961 
b
 = 
	`vlib_gë_buf„r
 (
vm
, 
buf„r_ödex
);

962 i‡(
	`PREDICT_TRUE
 (
do_öô
))

963 
	`vlib_buf„r_öô_f‹_‰ì_li°
 (
b
, 
f
);

964 
	`vec_add1_Æig√d
 (
f
->
buf„rs
, 
buf„r_ödex
, 
CLIB_CACHE_LINE_BYTES
);

966 i‡(
	`vec_Àn
 (
f
->
buf„rs
Ë> 4 * 
VLIB_FRAME_SIZE
)

968 
vlib_buf„r_‰ì_li°_t
 *
mf
;

969 
mf
 = 
	`vlib_buf„r_gë_‰ì_li°
 (
vlib_maös
[0], 
f
->
ödex
);

970 
	`˛ib_•ölock_lock
 (&
mf
->
globÆ_buf„rs_lock
);

972 
	`vec_add_Æig√d
 (
mf
->
globÆ_buf„rs
, 
f
->
buf„rs
, 
VLIB_FRAME_SIZE
,

973 
CLIB_CACHE_LINE_BYTES
);

974 
	`vec_dñëe
 (
f
->
buf„rs
, 
VLIB_FRAME_SIZE
, 0);

975 
f
->
n_Æloc
 -
VLIB_FRAME_SIZE
;

976 
	`˛ib_•ölock_u∆ock
 (&
mf
->
globÆ_buf„rs_lock
);

978 
	}
}

980 #i‡
CLIB_DEBUG
 > 0

981 
u32
 *
vlib_buf„r_°©e_vÆid©i⁄_lock
;

982 
uw‹d
 *
vlib_buf„r_°©e_vÆid©i⁄_hash
;

983 *
vlib_buf„r_°©e_hóp
;

986 
ölöe
 

987 
	$vlib_vÆid©e_buf„r_ö_u£
 (
vlib_buf„r_t
 * 
b
, 
u32
 
ex≥˘ed
)

989 #i‡
CLIB_DEBUG
 > 0

990 
uw‹d
 *
p
;

991 *
ﬁdhóp
;

993 
ﬁdhóp
 = 
	`˛ib_mem_£t_hóp
 (
vlib_buf„r_°©e_hóp
);

995 
	`__sync_lock_ã°_™d_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_lock
, 1))

998 
p
 = 
	`hash_gë
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
);

1001 i‡(!
p
)

1003 
	`hash_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
, 
ex≥˘ed
);

1004 
out
;

1007 i‡(
p
[0] !
ex≥˘ed
)

1009 
	`cj_°›
 ();

1010 
u32
 
bi
;

1011 
vlib_maö_t
 *
vm
 = &
vlib_globÆ_maö
;

1013 
	`cj_°›
 ();

1015 
bi
 = 
	`vlib_gë_buf„r_ödex
 (
vm
, 
b
);

1017 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1018 
	`˛ib_w¨nög
 ("%.6f buffer %llx (%d): %s,Çot %s",

1019 
	`vlib_time_now
 (
vm
), 
bi
,

1020 
p
[0] ? "busy" : "‰ì", 
ex≥˘ed
 ? "busy" : "free");

1021 
	`os_∑nic
 ();

1023 
out
:

1024 
	`CLIB_MEMORY_BARRIER
 ();

1025 *
vlib_buf„r_°©e_vÆid©i⁄_lock
 = 0;

1026 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1028 
	}
}

1030 
ölöe
 

1031 
	$vlib_vÆid©e_buf„r_£t_ö_u£
 (
vlib_buf„r_t
 * 
b
, 
u32
 
ex≥˘ed
)

1033 #i‡
CLIB_DEBUG
 > 0

1034 *
ﬁdhóp
;

1036 
ﬁdhóp
 = 
	`˛ib_mem_£t_hóp
 (
vlib_buf„r_°©e_hóp
);

1038 
	`__sync_lock_ã°_™d_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_lock
, 1))

1041 
	`hash_£t
 (
vlib_buf„r_°©e_vÆid©i⁄_hash
, 
b
, 
ex≥˘ed
);

1043 
	`CLIB_MEMORY_BARRIER
 ();

1044 *
vlib_buf„r_°©e_vÆid©i⁄_lock
 = 0;

1045 
	`˛ib_mem_£t_hóp
 (
ﬁdhóp
);

1047 
	}
}

1050 
	#VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
 (256)

	)

1061 
Æways_ölöe
 

1062 
	$vlib_buf„r_chaö_com¥ess
 (
vlib_maö_t
 * 
vm
,

1063 
vlib_buf„r_t
 * 
fú°
, 
u32
 ** 
disˇrd_ve˘‹
)

1065 i‡(
fú°
->
cuºít_Àngth
 >
VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
 ||

1066 !(
fú°
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
))

1072 
vlib_buf„r_‰ì_li°_ödex_t
 
ödex
;

1073 
vlib_buf„r_‰ì_li°_t
 *
‰ì_li°
 =

1074 
	`vlib_buf„r_gë_buf„r_‰ì_li°
 (
vm
, 
fú°
, &
ödex
);

1076 
u32
 
w™t_fú°_size
 = 
	`˛ib_mö
 (
VLIB_BUFFER_CHAIN_MIN_FIRST_DATA_SIZE
,

1077 
‰ì_li°
->
n_d©a_byãs
 -

1078 
fú°
->
cuºít_d©a
);

1081 
vlib_buf„r_t
 *
£c⁄d
 = 
	`vlib_gë_buf„r
 (
vm
, 
fú°
->
√xt_buf„r
);

1082 
u32
 
√ed
 = 
w™t_fú°_size
 - 
fú°
->
cuºít_Àngth
;

1083 
u32
 
amou¡_to_c›y
 = 
	`˛ib_mö
 (
√ed
, 
£c⁄d
->
cuºít_Àngth
);

1084 
	`˛ib_mem˝y
 (((
u8
 *Ë
	`vlib_buf„r_gë_cuºít
 (
fú°
)) +

1085 
fú°
->
cuºít_Àngth
,

1086 
	`vlib_buf„r_gë_cuºít
 (
£c⁄d
), 
amou¡_to_c›y
);

1087 
fú°
->
cuºít_Àngth
 +
amou¡_to_c›y
;

1088 
	`vlib_buf„r_adv™˚
 (
£c⁄d
, 
amou¡_to_c›y
);

1089 i‡(
fú°
->
Êags
 & 
VLIB_BUFFER_TOTAL_LENGTH_VALID
)

1091 
fú°
->
tŸÆ_Àngth_nŸ_ö˛udög_fú°_buf„r
 -
amou¡_to_c›y
;

1093 i‡(!
£c⁄d
->
cuºít_Àngth
)

1095 
	`vec_add1
 (*
disˇrd_ve˘‹
, 
fú°
->
√xt_buf„r
);

1096 i‡(
£c⁄d
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
)

1098 
fú°
->
√xt_buf„r
 = 
£c⁄d
->next_buffer;

1102 
fú°
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

1104 
£c⁄d
->
Êags
 &~
VLIB_BUFFER_NEXT_PRESENT
;

1107 (
fú°
->
cuºít_Àngth
 < 
w™t_fú°_size
) &&

1108 (
fú°
->
Êags
 & 
VLIB_BUFFER_NEXT_PRESENT
));

1109 
	}
}

	@/usr/include/vlib/buffer_node.h

40 #i‚de‡
ö˛uded_vlib_buf„r_node_h


41 
	#ö˛uded_vlib_buf„r_node_h


	)

70 
	#vlib_vÆid©e_buf„r_íqueue_x2
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
bi1
,
√xt0
,
√xt1
) \

72 
íqueue_code
 = (
√xt0
 !
√xt_ödex
Ë+ 2*(
√xt1
 !=Çext_index); \

74 i‡(
	`PREDICT_FALSE
 (
íqueue_code
 != 0)) \

76 
íqueue_code
) \

80 
to_√xt
[-2] = 
bi1
; \

81 
to_√xt
 -= 1; \

82 
n_À·_to_√xt
 += 1; \

83 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

88 
to_√xt
 -= 1; \

89 
n_À·_to_√xt
 += 1; \

90 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

95 
to_√xt
 -= 2; \

96 
n_À·_to_√xt
 += 2; \

97 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

98 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

99 i‡(
√xt0
 =
√xt1
) \

101 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, \

102 
n_À·_to_√xt
); \

103 
√xt_ödex
 = 
√xt1
; \

104 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

108 } 0)

	)

138 
	#vlib_vÆid©e_buf„r_íqueue_x4
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
bi1
,
bi2
,
bi3
,
√xt0
,
√xt1
,
√xt2
,
√xt3
) \

141 
u32
 
fix_•ecuœti⁄
 = (
√xt_ödex
 ^ 
√xt0
Ë| (√xt_ödex ^ 
√xt1
) \

142 | (
√xt_ödex
 ^ 
√xt2
Ë| (√xt_ödex ^ 
√xt3
); \

143 i‡(
	`PREDICT_FALSE
(
fix_•ecuœti⁄
)) \

146 
to_√xt
 -= 4; \

147 
n_À·_to_√xt
 += 4; \

150 i‡(
√xt_ödex
 =
√xt0
) \

152 
to_√xt
[0] = 
bi0
; \

153 
to_√xt
++; \

154 
n_À·_to_√xt
 --; \

157 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt0
, 
bi0
); \

159 i‡(
√xt_ödex
 =
√xt1
) \

161 
to_√xt
[0] = 
bi1
; \

162 
to_√xt
++; \

163 
n_À·_to_√xt
 --; \

166 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt1
, 
bi1
); \

168 i‡(
√xt_ödex
 =
√xt2
) \

170 
to_√xt
[0] = 
bi2
; \

171 
to_√xt
++; \

172 
n_À·_to_√xt
 --; \

175 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt2
, 
bi2
); \

177 i‡(
√xt_ödex
 =
√xt3
) \

179 
to_√xt
[0] = 
bi3
; \

180 
to_√xt
++; \

181 
n_À·_to_√xt
 --; \

185 
	`vlib_£t_√xt_‰ame_buf„r
 (
vm
, 
node
, 
√xt3
, 
bi3
); \

188 i‡(
√xt2
 =
√xt3
) \

190 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
); \

191 
√xt_ödex
 = 
√xt3
; \

192 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

196 } 0);

	)

218 
	#vlib_vÆid©e_buf„r_íqueue_x1
(
vm
,
node
,
√xt_ödex
,
to_√xt
,
n_À·_to_√xt
,
bi0
,
√xt0
) \

220 i‡(
	`PREDICT_FALSE
 (
√xt0
 !
√xt_ödex
)) \

222 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
 + 1); \

223 
√xt_ödex
 = 
√xt0
; \

224 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
); \

226 
to_√xt
[0] = 
bi0
; \

227 
to_√xt
 += 1; \

228 
n_À·_to_√xt
 -= 1; \

230 } 0)

	)

232 
Æways_ölöe
 
uw‹d


233 
	$gíîic_buf„r_node_ölöe
 (
vlib_maö_t
 * 
vm
,

234 
vlib_node_ru¡ime_t
 * 
node
,

235 
vlib_‰ame_t
 * 
‰ame
,

236 
uw‹d
 
sizeof_åa˚
,

237 *
›aque1
,

238 
uw‹d
 
›aque2
,

239 (*
two_buf„rs
Ë(
vlib_maö_t
 * 
vm
,

240 *
›aque1
,

241 
uw‹d
 
›aque2
,

242 
vlib_buf„r_t
 * 
b0
,

243 
vlib_buf„r_t
 * 
b1
,

244 
u32
 * 
√xt0
, u32 * 
√xt1
),

245 (*
⁄e_buf„r
Ë(
vlib_maö_t
 * 
vm
,

246 *
›aque1
, 
uw‹d
 
›aque2
,

247 
vlib_buf„r_t
 * 
b0
,

248 
u32
 * 
√xt0
))

250 
u32
 
n_À·_‰om
, *
‰om
, *
to_√xt
;

251 
u32
 
√xt_ödex
;

253 
‰om
 = 
	`vlib_‰ame_ve˘‹_¨gs
 (
‰ame
);

254 
n_À·_‰om
 = 
‰ame
->
n_ve˘‹s
;

255 
√xt_ödex
 = 
node
->
ˇched_√xt_ödex
;

257 i‡(
node
->
Êags
 & 
VLIB_NODE_FLAG_TRACE
)

258 
	`vlib_åa˚_‰ame_buf„rs_⁄ly
 (
vm
, 
node
, 
‰om
, 
‰ame
->
n_ve˘‹s
,

259  1, 
sizeof_åa˚
);

261 
n_À·_‰om
 > 0)

263 
u32
 
n_À·_to_√xt
;

265 
	`vlib_gë_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
to_√xt
, 
n_À·_to_√xt
);

267 
n_À·_‰om
 >4 && 
n_À·_to_√xt
 >= 2)

269 
vlib_buf„r_t
 *
p0
, *
p1
;

270 
u32
 
pi0
, 
√xt0
;

271 
u32
 
pi1
, 
√xt1
;

275 
vlib_buf„r_t
 *
p2
, *
p3
;

277 
p2
 = 
	`vlib_gë_buf„r
 (
vm
, 
‰om
[2]);

278 
p3
 = 
	`vlib_gë_buf„r
 (
vm
, 
‰om
[3]);

280 
	`vlib_¥e„tch_buf„r_hódî
 (
p2
, 
LOAD
);

281 
	`vlib_¥e„tch_buf„r_hódî
 (
p3
, 
LOAD
);

283 
	`CLIB_PREFETCH
 (
p2
->
d©a
, 64, 
LOAD
);

284 
	`CLIB_PREFETCH
 (
p3
->
d©a
, 64, 
LOAD
);

287 
pi0
 = 
to_√xt
[0] = 
‰om
[0];

288 
pi1
 = 
to_√xt
[1] = 
‰om
[1];

289 
‰om
 += 2;

290 
to_√xt
 += 2;

291 
n_À·_‰om
 -= 2;

292 
n_À·_to_√xt
 -= 2;

294 
p0
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi0
);

295 
p1
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi1
);

297 
	`two_buf„rs
 (
vm
, 
›aque1
, 
›aque2
, 
p0
, 
p1
, &
√xt0
, &
√xt1
);

299 
	`vlib_vÆid©e_buf„r_íqueue_x2
 (
vm
, 
node
, 
√xt_ödex
,

300 
to_√xt
, 
n_À·_to_√xt
,

301 
pi0
, 
pi1
, 
√xt0
, 
√xt1
);

304 
n_À·_‰om
 > 0 && 
n_À·_to_√xt
 > 0)

306 
vlib_buf„r_t
 *
p0
;

307 
u32
 
pi0
, 
√xt0
;

309 
pi0
 = 
‰om
[0];

310 
to_√xt
[0] = 
pi0
;

311 
‰om
 += 1;

312 
to_√xt
 += 1;

313 
n_À·_‰om
 -= 1;

314 
n_À·_to_√xt
 -= 1;

316 
p0
 = 
	`vlib_gë_buf„r
 (
vm
, 
pi0
);

318 
	`⁄e_buf„r
 (
vm
, 
›aque1
, 
›aque2
, 
p0
, &
√xt0
);

320 
	`vlib_vÆid©e_buf„r_íqueue_x1
 (
vm
, 
node
, 
√xt_ödex
,

321 
to_√xt
, 
n_À·_to_√xt
,

322 
pi0
, 
√xt0
);

325 
	`vlib_put_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
, 
n_À·_to_√xt
);

328  
‰ame
->
n_ve˘‹s
;

329 
	}
}

	@/usr/include/vlib/cli.h

40 #i‚de‡
ö˛uded_vlib_˛i_h


41 
	#ö˛uded_vlib_˛i_h


	)

43 
	~<vµö‰a/f‹m©.h
>

45 
	gvlib_˛i_comm™d_t
;

49 
u32
 
	mmö_ch¨
;

52 
uw‹d
 **
	mbôm≠s
;

53 } 
	tvlib_˛i_∑r£_posôi⁄_t
;

57 
u8
 *
	m«me
;

59 
u32
 
	mödex
;

60 } 
	tvlib_˛i_sub_comm™d_t
;

64 
u8
 *
	m«me
;

66 
u32
 
	mruÀ_ödex
;

68 
u32
 
	mcomm™d_ödex
;

69 } 
	tvlib_˛i_sub_ruÀ_t
;

73 *
	m«me
;

74 *
	msh‹t_hñp
;

75 *
	ml⁄g_hñp
;

78 
uw‹d
 
	md©a_size
;

80 
unf‹m©_fun˘i⁄_t
 *
	munf‹m©_fun˘i⁄
;

83 
uw‹d
 
	munf‹m©_fun˘i⁄_¨g
[2];

84 } 
	tvlib_˛i_∑r£_ruÀ_t
;

87 
	g˛ib_îr‹_t
 *(
	tvlib_˛i_comm™d_fun˘i⁄_t
)

88 (
	tvlib_maö_t
 * 
	tvm
,

89 
	tunf‹m©_öput_t
 * 
	töput
, 
	tvlib_˛i_comm™d_t
 * 
	tcmd
);

91 
	svlib_˛i_comm™d_t


95 *
	m∑th
;

98 *
	msh‹t_hñp
;

99 *
	ml⁄g_hñp
;

102 
vlib_˛i_comm™d_fun˘i⁄_t
 *
	mfun˘i⁄
;

105 
uw‹d
 
	mfun˘i⁄_¨g
;

108 
uw‹d
 
	mis_mp_ß„
;

111 
vlib_˛i_sub_comm™d_t
 *
	msub_comm™ds
;

114 
uw‹d
 *
	msub_comm™d_ödex_by_«me
;

118 
vlib_˛i_∑r£_posôi⁄_t
 *
	msub_comm™d_posôi⁄s
;

121 
uw‹d
 *
	msub_ruÀ_ödex_by_«me
;

124 
vlib_˛i_sub_ruÀ_t
 *
	msub_ruÀs
;

127 
vlib_˛i_comm™d_t
 *
	m√xt_˛i_comm™d
;

129 } 
	tvlib_˛i_comm™d_t
;

131 (
	tvlib_˛i_ouçut_fun˘i⁄_t
Ë(
	tuw‹d
 
	t¨g
,

132 
	tu8
 * 
	tbuf„r
, 
	tuw‹d
 
	tbuf„r_byãs
);

136 
vlib_˛i_comm™d_t
 *
comm™ds
;

139 
uw‹d
 *
comm™d_ödex_by_∑th
;

142 
vlib_˛i_∑r£_ruÀ_t
 *
∑r£_ruÀs
;

145 
uw‹d
 *
∑r£_ruÀ_ödex_by_«me
;

148 **
∑r£_ruÀ_d©a
;

151 
vlib_˛i_comm™d_t
 *
˛i_comm™d_ªgi°øti⁄s
;

152 } 
	tvlib_˛i_maö_t
;

154 
	#VLIB_CLI_COMMAND
(
x
,...) \

155 
__VA_ARGS__
 
vlib_˛i_comm™d_t
 
x
; \

156 
__vlib_˛i_comm™d_ªgi°øti⁄_
##
	`x
 () \

157 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

158 
__vlib_˛i_comm™d_ªgi°øti⁄_
##
	`x
 () \

160 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

161 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
; \

162 
x
.
√xt_˛i_comm™d
 = 
cm
->
˛i_comm™d_ªgi°øti⁄s
; \

163 
cm
->
˛i_comm™d_ªgi°øti⁄s
 = &
x
; \

164 
	}
} \

165 
__VA_ARGS__
 
vlib_˛i_comm™d_t
 
x


	)

166 
	#VLIB_CLI_PARSE_RULE
(
x
) \

167 
vlib_˛i_∑r£_ruÀ_t
 
x


	)

169 
vlib_˛i_ouçut
 (
vlib_maö_t
 *
vm
, *
fmt
, ...);

172 
vlib_˛i_öput
 (
vlib_maö_t
 *
vm
,

173 
unf‹m©_öput_t
 * 
öput
,

174 
vlib_˛i_ouçut_fun˘i⁄_t
 * 
fun˘i⁄
,

175 
uw‹d
 
fun˘i⁄_¨g
);

177 
˛ib_îr‹_t
 *
vlib_˛i_ªgi°î
 (
vlib_maö_t
 *
vm
,

178 
vlib_˛i_comm™d_t
 * 
c
);

179 
˛ib_îr‹_t
 *
vlib_˛i_ªgi°î_∑r£_ruÀ
 (
vlib_maö_t
 *
vm
,

180 
vlib_˛i_∑r£_ruÀ_t
 * 
c
);

182 
uw‹d
 
unf‹m©_vlib_˛i_sub_öput
 (
unf‹m©_öput_t
 * 
i
, 
va_li°
 * 
¨gs
);

186 
u8
 **
vlib_˛i_gë_possibÀ_com∂ëi⁄s
 (u8 * 
öput_°r
);

	@/usr/include/vlib/cli_funcs.h

40 #i‚de‡
ö˛uded_vlib_˛i_funcs_h


41 
	#ö˛uded_vlib_˛i_funcs_h


	)

43 
Æways_ölöe
 *

44 
	$vlib_˛i_gë_∑r£_ruÀ_ªsu…
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
ödex
)

46 
vlib_˛i_maö_t
 *
cm
 = &
vm
->
˛i_maö
;

47  
	`vec_ñt
 (
cm
->
∑r£_ruÀ_d©a
, 
ödex
);

48 
	}
}

	@/usr/include/vlib/config.h

1 
	#__PRE_DATA_SIZE
 128

	)

	@/usr/include/vlib/counter.h

40 #i‚de‡
ö˛uded_vlib_cou¡î_h


41 
	#ö˛uded_vlib_cou¡î_h


	)

54 
u64
 
	tcou¡î_t
;

60 
cou¡î_t
 **
	mcou¡îs
;

61 
cou¡î_t
 *
	mvÆue_©_œ°_£rülize
;

62 
u32
 
	mœ°_ö¸emíèl_£rülize_ödex
;

65 *
	m«me
;

66 } 
	tvlib_sim∂e_cou¡î_maö_t
;

69 
u32
 
vlib_sim∂e_cou¡î_n_cou¡îs
 (c⁄° 
vlib_sim∂e_cou¡î_maö_t
 * 
cm
);

77 
Æways_ölöe
 

78 
	$vlib_ö¸emít_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
,

79 
u32
 
thªad_ödex
, u32 
ödex
, 
u64
 
ö¸emít
)

81 
cou¡î_t
 *
my_cou¡îs
;

83 
my_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

84 
my_cou¡îs
[
ödex
] +
ö¸emít
;

85 
	}
}

96 
Æways_ölöe
 
cou¡î_t


97 
	$vlib_gë_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

99 
cou¡î_t
 *
my_cou¡îs
;

100 
cou¡î_t
 
v
;

101 
i
;

103 
	`ASSERT
 (
ödex
 < 
	`vlib_sim∂e_cou¡î_n_cou¡îs
 (
cm
));

105 
v
 = 0;

107 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

109 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

110 
v
 +
my_cou¡îs
[
ödex
];

113  
v
;

114 
	}
}

122 
Æways_ölöe
 

123 
	$vlib_zîo_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

125 
cou¡î_t
 *
my_cou¡îs
;

126 
i
;

128 
	`ASSERT
 (
ödex
 < 
	`vlib_sim∂e_cou¡î_n_cou¡îs
 (
cm
));

130 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

132 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

133 
my_cou¡îs
[
ödex
] = 0;

135 
	}
}

141 
cou¡î_t
 
	m∑ckës
;

142 
cou¡î_t
 
	mbyãs
;

143 } 
	tvlib_cou¡î_t
;

150 
Æways_ölöe
 

151 
	$vlib_cou¡î_add
 (
vlib_cou¡î_t
 * 
a
, vlib_cou¡î_à* 
b
)

153 
a
->
∑ckës
 +
b
->packets;

154 
a
->
byãs
 +
b
->bytes;

155 
	}
}

161 
Æways_ölöe
 

162 
	$vlib_cou¡î_sub
 (
vlib_cou¡î_t
 * 
a
, vlib_cou¡î_à* 
b
)

164 
	`ASSERT
 (
a
->
∑ckës
 >
b
->packets);

165 
	`ASSERT
 (
a
->
byãs
 >
b
->bytes);

166 
a
->
∑ckës
 -
b
->packets;

167 
a
->
byãs
 -
b
->bytes;

168 
	}
}

173 
Æways_ölöe
 

174 
	$vlib_cou¡î_zîo
 (
vlib_cou¡î_t
 * 
a
)

176 
a
->
∑ckës
 =á->
byãs
 = 0;

177 
	}
}

182 
vlib_cou¡î_t
 **
	mcou¡îs
;

183 
vlib_cou¡î_t
 *
	mvÆue_©_œ°_£rülize
;

184 
u32
 
	mœ°_ö¸emíèl_£rülize_ödex
;

185 *
	m«me
;

186 } 
	tvlib_comböed_cou¡î_maö_t
;

189 
u32
 
vlib_comböed_cou¡î_n_cou¡îs
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 *

190 
cm
);

195 
vlib_˛ór_sim∂e_cou¡îs
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
);

200 
vlib_˛ór_comböed_cou¡îs
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
);

210 
Æways_ölöe
 

211 
	$vlib_ö¸emít_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
,

212 
u32
 
thªad_ödex
,

213 
u32
 
ödex
, 
u64
 
n_∑ckës
, u64 
n_byãs
)

215 
vlib_cou¡î_t
 *
my_cou¡îs
;

218 
my_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

220 
my_cou¡îs
[
ödex
].
∑ckës
 +
n_∑ckës
;

221 
my_cou¡îs
[
ödex
].
byãs
 +
n_byãs
;

222 
	}
}

225 
Æways_ölöe
 

226 
	$vlib_¥e„tch_comböed_cou¡î
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 * 
cm
,

227 
u32
 
thªad_ödex
, u32 
ödex
)

229 
vlib_cou¡î_t
 *
˝u_cou¡îs
;

234 
˝u_cou¡îs
 = 
cm
->
cou¡îs
[
thªad_ödex
];

235 
	`CLIB_PREFETCH
 (
˝u_cou¡îs
 + 
ödex
, 
CLIB_CACHE_LINE_BYTES
, 
STORE
);

236 
	}
}

249 
ölöe
 

250 
	$vlib_gë_comböed_cou¡î
 (c⁄° 
vlib_comböed_cou¡î_maö_t
 * 
cm
,

251 
u32
 
ödex
, 
vlib_cou¡î_t
 * 
ªsu…
)

253 
vlib_cou¡î_t
 *
my_cou¡îs
, *
cou¡î
;

254 
i
;

256 
ªsu…
->
∑ckës
 = 0;

257 
ªsu…
->
byãs
 = 0;

259 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

261 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

263 
cou¡î
 = 
	`vec_ñt_©_ödex
 (
my_cou¡îs
, 
ödex
);

264 
ªsu…
->
∑ckës
 +
cou¡î
->packets;

265 
ªsu…
->
byãs
 +
cou¡î
->bytes;

267 
	}
}

275 
Æways_ölöe
 

276 
	$vlib_zîo_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
, 
u32
 
ödex
)

278 
vlib_cou¡î_t
 *
my_cou¡îs
, *
cou¡î
;

279 
i
;

281 
i
 = 0; i < 
	`vec_Àn
 (
cm
->
cou¡îs
); i++)

283 
my_cou¡îs
 = 
cm
->
cou¡îs
[
i
];

285 
cou¡î
 = 
	`vec_ñt_©_ödex
 (
my_cou¡îs
, 
ödex
);

286 
cou¡î
->
∑ckës
 = 0;

287 
cou¡î
->
byãs
 = 0;

289 
	}
}

296 
vlib_vÆid©e_sim∂e_cou¡î
 (
vlib_sim∂e_cou¡î_maö_t
 * 
cm
,

297 
u32
 
ödex
);

304 
vlib_vÆid©e_comböed_cou¡î
 (
vlib_comböed_cou¡î_maö_t
 * 
cm
,

305 
u32
 
ödex
);

315 
	#vlib_cou¡î_Àn
(
cm
Ë
	`vec_Àn
((cm)->
maxi
)

	)

317 
£rülize_fun˘i⁄_t
 
	g£rülize_vlib_sim∂e_cou¡î_maö
,

318 
	gun£rülize_vlib_sim∂e_cou¡î_maö
;

319 
£rülize_fun˘i⁄_t
 
	g£rülize_vlib_comböed_cou¡î_maö
,

320 
	gun£rülize_vlib_comböed_cou¡î_maö
;

	@/usr/include/vlib/defs.h

40 #i‚de‡
ö˛uded_vlib_defs_h


41 
	#ö˛uded_vlib_defs_h


	)

46 
	mVLIB_RX
,

47 
	mVLIB_TX
,

48 
	mVLIB_N_RX_TX
 = 2,

49 } 
	tvlib_rx_‹_tx_t
;

51 
	#vlib_f‹óch_rx_tx
(
v
Ëv = 0; v < 
VLIB_N_RX_TX
; v++)

	)

56 
	mVLIB_READ
,

57 
	mVLIB_WRITE
,

58 } 
	tvlib_ªad_‹_wrôe_t
;

63 
	mVLIB_DOWN
 = 0,

64 
	mVLIB_UP
 = 1,

65 } 
	tvlib_up_‹_down_t
;

70 
	mVLIB_DISABLE
 = 0,

71 
	mVLIB_ENABLE
 = 1,

72 } 
	tvlib_íabÀ_‹_dißbÀ_t
;

	@/usr/include/vlib/error.h

40 #i‚de‡
ö˛uded_vlib_îr‹_h


41 
	#ö˛uded_vlib_îr‹_h


	)

44 
u32
 
	tvlib_îr‹_t
;

46 
Æways_ölöe
 
u32


47 
	$vlib_îr‹_gë_node
 (
vlib_îr‹_t
 
e
)

49  
e
 >> 12;

50 
	}
}

52 
Æways_ölöe
 
u32


53 
	$vlib_îr‹_gë_code
 (
vlib_îr‹_t
 
e
)

55  
e
 & 0xfff;

56 
	}
}

58 
Æways_ölöe
 
vlib_îr‹_t


59 
	$vlib_îr‹_£t
 (
u32
 
node_ödex
, u32 
code
)

61 
	`ASSERT
 (
node_ödex
 < (1 << 20));

62 
	`ASSERT
 (
code
 < (1 << 12));

63  (
node_ödex
 << 12Ë| 
code
;

64 
	}
}

66 
Æways_ölöe
 
vlib_îr‹_t


67 
	$vlib_îr‹_£t_code
 (
vlib_îr‹_t
 
e
, 
u32
 
code
)

69 
	`ASSERT
 (
	`vlib_îr‹_gë_code
 (
e
) == 0);

70 
	`ASSERT
 (
code
 < (1 << 12));

71 
e
 |
code
;

72  
e
;

73 
	}
}

78 
u64
 *
	mcou¡îs
;

81 
u64
 *
	mcou¡îs_œ°_˛ór
;

85 **
	mîr‹_°rögs_hóp
;

86 } 
	tvlib_îr‹_maö_t
;

89 
vlib_ªgi°î_îr‹s
 (
vlib_maö_t
 *
vm
,

90 
u32
 
node_ödex
,

91 
u32
 
n_îr‹s
, *
îr‹_°rögs
[]);

	@/usr/include/vlib/error_funcs.h

40 #i‚de‡
ö˛uded_vlib_îr‹_funcs_h


41 
	#ö˛uded_vlib_îr‹_funcs_h


	)

43 
	~<vlib/node_funcs.h
>

45 
Æways_ölöe
 

46 
	$vlib_îr‹_ñog_cou¡
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
cou¡î
, uw‹d 
ö¸emít
)

48 i‡(
VLIB_ELOG_MAIN_LOOP
 > 0 && 
ö¸emít
 > 0)

50 
ñog_maö_t
 *
em
 = &
vm
->
ñog_maö
;

51 
	`ñog
 (
em
, 
	`vec_ñt_©_ödex
 (
vm
->
îr‹_ñog_evít_ty≥s
, 
cou¡î
),

52 
ö¸emít
);

54 
	}
}

56 
Æways_ölöe
 

57 
	$vlib_îr‹_cou¡
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

58 
uw‹d
 
cou¡î
, uw‹d 
ö¸emít
)

60 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

61 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

63 
	`ASSERT
 (
cou¡î
 < 
n
->
n_îr‹s
);

64 
cou¡î
 +
n
->
îr‹_hóp_ödex
;

66 
	`ASSERT
 (
cou¡î
 < 
	`vec_Àn
 (
em
->
cou¡îs
));

67 
em
->
cou¡îs
[
cou¡î
] +
ö¸emít
;

69 
	`vlib_îr‹_ñog_cou¡
 (
vm
, 
cou¡î
, 
ö¸emít
);

70 
	}
}

73 
uw‹d


74 
vlib_îr‹_dr›_buf„rs
 (
vlib_maö_t
 * 
vm
,

75 
vlib_node_ru¡ime_t
 * 
node
,

76 
u32
 * 
buf„rs
,

77 
u32
 
√xt_buf„r_°ride
,

78 
u32
 
n_buf„rs
,

79 
u32
 
îr‹_√xt_ödex
,

80 
u32
 
îr‹_node
, u32 
îr‹_code
);

	@/usr/include/vlib/format_funcs.h

40 #i‚de‡
ö˛uded_vlib_f‹m©_h


41 
	#ö˛uded_vlib_f‹m©_h


	)

44 
u8
 *
f‹m©_vlib_rx_tx
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

45 
u8
 *
f‹m©_vlib_ªad_wrôe
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

48 
u8
 *
f‹m©_vlib_buf„r_d©a
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

51 
uw‹d
 
unf‹m©_vlib_íabÀ_dißbÀ
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

54 
uw‹d
 
unf‹m©_vlib_rx_tx
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

57 
uw‹d
 
unf‹m©_vlib_numbî_by_«me
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

60 
uw‹d
 
unf‹m©_vlib_numbî
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
¨gs
);

65 
	#FORMAT_VLIB_HEADER_NO_RECURSION
 (~0)

	)

	@/usr/include/vlib/global_funcs.h

19 #i‚de‡
ö˛uded_vlib_globÆ_funcs_h_


20 
	#ö˛uded_vlib_globÆ_funcs_h_


	)

22 
Æways_ölöe
 
vlib_maö_t
 *

23 
	$vlib_gë_maö
 ()

25 
vlib_maö_t
 *
vm
;

26 
vm
 = 
vlib_maös
[
	`vlib_gë_thªad_ödex
 ()];

27 
	`ASSERT
 (
vm
);

28  
vm
;

29 
	}
}

31 
Æways_ölöe
 
vlib_thªad_maö_t
 *

32 
	$vlib_gë_thªad_maö
 ()

34  &
vlib_thªad_maö
;

35 
	}
}

	@/usr/include/vlib/i2c.h

16 #i‚de‡
ö˛uded_vlib_i2c_h


17 
	#ö˛uded_vlib_i2c_h


	)

19 
	~<vµö‰a/ty≥s.h
>

22 
	#I2C_MSG_FLAG_WRITE
 0

	)

23 
	#I2C_MSG_FLAG_READ
 1

	)

27 
u8
 
	maddr
;

28 
u8
 
	mÊags
;

29 
u16
 
	mÀn
;

30 
u8
 *
	mbuf„r
;

31 } 
	ti2c_msg_t
;

33 
	si2c_bus_t


35 (*
	mput_bôs
Ë(
i2c_bus_t
 * 
	mb
, 
	ms˛
, 
	msda
);

36 (*
	mgë_bôs
Ë(
i2c_bus_t
 * 
	mb
, *
	ms˛
, *
	msda
);

38 
	mtimeout
;

39 
u32
 
	m˛ock
;

40 
f64
 
	mhﬁd_time
;

41 
f64
 
	mri£_ÁŒ_time
;

44 
uw‹d
 
	m¥iv©e_d©a
;

46 } 
	ti2c_bus_t
;

48 
vlib_i2c_öô
 (
i2c_bus_t
 * 
bus
);

49 
vlib_i2c_x„r
 (
i2c_bus_t
 * 
bus
, 
i2c_msg_t
 * 
msgs
);

50 
vlib_i2c_ªad_ì¥om
 (
i2c_bus_t
 * 
bus
, 
u8
 
i2c_addr
, 
u16
 
°¨t_addr
,

51 
u16
 
Àngth
, 
u8
 * 
d©a
);

53 
ölöe
 

54 
	$vlib_i2c_bus_timed_out
 (
i2c_bus_t
 * 
bus
)

56  
bus
->
timeout
;

57 
	}
}

	@/usr/include/vlib/init.h

40 #i‚de‡
ö˛uded_vlib_öô_h


41 
	#ö˛uded_vlib_öô_h


	)

43 
	~<vµö‰a/îr‹.h
>

44 
	~<vµö‰a/f‹m©.h
>

45 
	~<vµö‰a/hash.h
>

51 
	g˛ib_îr‹_t
 *(
	tvlib_öô_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
);

53 
	s_vlib_öô_fun˘i⁄_li°_ñt


55 
_vlib_öô_fun˘i⁄_li°_ñt
 *
	m√xt_öô_fun˘i⁄
;

56 
vlib_öô_fun˘i⁄_t
 *
	mf
;

57 } 
	t_vlib_öô_fun˘i⁄_li°_ñt_t
;

61 
	g˛ib_îr‹_t
 *(
	tvlib_c⁄fig_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

62 
	tunf‹m©_öput_t
 * 
	töput
);

64 
	svlib_c⁄fig_fun˘i⁄_ru¡ime_t


67 
vlib_c⁄fig_fun˘i⁄_t
 *
	mfun˘i⁄
;

70 
unf‹m©_öput_t
 
	möput
;

73 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 *
	m√xt_ªgi°øti⁄
;

76 
u8
 
	mis_óæy
;

79 
	m«me
[32];

80 } 
	tvlib_c⁄fig_fun˘i⁄_ru¡ime_t
;

82 
	#_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
ty≥
) \

83 
_vlib_
##
ty≥
##
_fun˘i⁄_
##
x


	)

85 
	#VLIB_INIT_FUNCTION_SYMBOL
(
x
) \

86 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
öô
)

	)

87 
	#VLIB_MAIN_LOOP_ENTER_FUNCTION_SYMBOL
(
x
) \

88 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
maö_lo›_íãr
)

	)

89 
	#VLIB_MAIN_LOOP_EXIT_FUNCTION_SYMBOL
(
x
) \

90 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
maö_lo›_exô
)

	)

91 
	#VLIB_CONFIG_FUNCTION_SYMBOL
(
x
) \

92 
	`_VLIB_INIT_FUNCTION_SYMBOL
(
x
, 
c⁄fig
)

	)

97 
	#VLIB_DECLARE_INIT_FUNCTION
(
x
, 
èg
) \

98 
vlib_öô_fun˘i⁄_t
 * 
	`_VLIB_INIT_FUNCTION_SYMBOL
 (
x
, 
èg
) = x; \

99 
__vlib_add_
##
èg
##
_fun˘i⁄_
##
	`x
 () \

100 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

101 
__vlib_add_
##
èg
##
_fun˘i⁄_
##
	`x
 () \

103 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

104 
_vlib_öô_fun˘i⁄_li°_ñt_t
 
_vlib_öô_fun˘i⁄
; \

105 
_vlib_öô_fun˘i⁄
.
√xt_öô_fun˘i⁄
 \

106 
vm
->
èg
##
_fun˘i⁄_ªgi°øti⁄s
; \

107 
vm
->
èg
##
_fun˘i⁄_ªgi°øti⁄s
 = &
_vlib_öô_fun˘i⁄
; \

108 
_vlib_öô_fun˘i⁄
.
f
 = &
x
; \

109 }

	)

111 
	#VLIB_INIT_FUNCTION
(
x
Ë
	`VLIB_DECLARE_INIT_FUNCTION
(x,
öô
)

	)

112 
	#VLIB_WORKER_INIT_FUNCTION
(
x
Ë
	`VLIB_DECLARE_INIT_FUNCTION
(x,
w‹kî_öô
)

	)

114 
	#VLIB_MAIN_LOOP_ENTER_FUNCTION
(
x
) \

115 
	`VLIB_DECLARE_INIT_FUNCTION
(
x
,
maö_lo›_íãr
)

	)

116 
	#VLIB_MAIN_LOOP_EXIT_FUNCTION
(
x
) \

117 
	`VLIB_DECLARE_INIT_FUNCTION
(
x
,
maö_lo›_exô
)

	)

119 
	#VLIB_CONFIG_FUNCTION
(
x
,
n
,...) \

120 
__VA_ARGS__
 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

121 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

122 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

123 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

124 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

126 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

127 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
).
√xt_ªgi°øti⁄
 \

128 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
; \

129 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
 \

130 &
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

132 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

133 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
) \

135 .
«me
 = 
n
, \

136 .
fun˘i⁄
 = 
x
, \

137 .
is_óæy
 = 0, \

138 }

	)

140 
	#VLIB_EARLY_CONFIG_FUNCTION
(
x
,
n
,...) \

141 
__VA_ARGS__
 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

142 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

143 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

144 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

145 
__vlib_add_c⁄fig_fun˘i⁄_
##
	`x
 () \

147 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

148 
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
).
√xt_ªgi°øti⁄
 \

149 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
; \

150 
vm
->
c⁄fig_fun˘i⁄_ªgi°øti⁄s
 \

151 &
	`VLIB_CONFIG_FUNCTION_SYMBOL
(
x
); \

153 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

154 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
) \

156 .
«me
 = 
n
, \

157 .
fun˘i⁄
 = 
x
, \

158 .
is_óæy
 = 1, \

159 }

	)

162 
	#vlib_ˇŒ_öô_fun˘i⁄
(
vm
, 
x
) \

164 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

165 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

166 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

167 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

169 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

170 
_îr‹
 = 
	`_f
 (
vm
); \

172 
_îr‹
; \

173 })

	)

176 
	#vlib_m¨k_öô_fun˘i⁄_com∂ëe
(
vm
, 
x
) \

178 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

179 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_INIT_FUNCTION_SYMBOL
 (
x
); \

180 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

181 })

	)

183 
	#vlib_ˇŒ_po°_gøph_öô_fun˘i⁄
(
vm
, 
x
) \

185 
vlib_öô_fun˘i⁄_t
 * 
	`VLIB_POST_GRAPH_INIT_FUNCTION_SYMBOL
 (
x
); \

186 
vlib_öô_fun˘i⁄_t
 * 
_f
 = 
	`VLIB_POST_GRAPH_INIT_FUNCTION_SYMBOL
 (
x
); \

187 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

188 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

190 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

191 
_îr‹
 = 
	`_f
 (
vm
); \

193 
_îr‹
; \

194 })

	)

196 
	#vlib_ˇŒ_c⁄fig_fun˘i⁄
(
vm
, 
x
) \

198 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 * 
_r
; \

199 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

200 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 \

201 
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
); \

203 
_r
 = &
	`VLIB_CONFIG_FUNCTION_SYMBOL
 (
x
); \

204 i‡(! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_r
->
fun˘i⁄
)) \

206 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_r
->
fun˘i⁄
); \

207 
_îr‹
 = 
_r
->
	`fun˘i⁄
 (
vm
, &_r->
öput
); \

209 
_îr‹
; \

210 })

	)

213 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_öô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
);

214 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_c⁄fig_fun˘i⁄s
 (
vlib_maö_t
 *
vm
,

215 
unf‹m©_öput_t
 * 
öput
,

216 
is_óæy
);

217 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_maö_lo›_íãr_fun˘i⁄s
 (
vlib_maö_t


218 *
vm
);

219 
˛ib_îr‹_t
 *
vlib_ˇŒ_Æl_maö_lo›_exô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
);

220 
˛ib_îr‹_t
 *
vlib_ˇŒ_öô_exô_fun˘i⁄s
 (
vlib_maö_t
 *
vm
,

221 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *

222 
hód
, 
ˇŒ_⁄˚
);

224 
	#f‹óch_vlib_moduÀ_ª„ªn˚
 \

225 
	`_
 (
node_˛i
) \

226 
	`_
 (
åa˚_˛i
)

	)

229 
	#_
(
x
Ë
vlib_
##x##
	`_ª„ªn˚
 ();

	)

230 
	gf‹óch_vlib_moduÀ_ª„ªn˚


231 #unde‡
_


	@/usr/include/vlib/linux/vfio.h

16 #i‚de‡
ö˛uded_vlib_löux_vfio_h


17 
	#ö˛uded_vlib_löux_vfio_h


	)

21 
	mgroup
;

22 
	mfd
;

23 
	mªf˙t
;

24 } 
	tlöux_pci_vfio_iommu_group_t
;

28 
u32
 
	mÊags
;

29 
	#LINUX_VFIO_F_HAVE_IOMMU
 (1 << 0)

	)

30 
	mc⁄èöî_fd
;

31 
	mext_c⁄èöî_fd
;

34 
	miommu_mode
;

37 
löux_pci_vfio_iommu_group_t
 *
	miommu_groups
;

40 
uw‹d
 *
	miommu_poﬁ_ödex_by_group
;

42 } 
	tlöux_vfio_maö_t
;

44 
löux_vfio_maö_t
 
vfio_maö
;

46 
˛ib_îr‹_t
 *
löux_vfio_öô
 (
vlib_maö_t
 * 
vm
);

47 
löux_vfio_dma_m≠_ªgi⁄s
 (
vlib_maö_t
 * 
vm
);

48 
˛ib_îr‹_t
 *
löux_vfio_group_gë_devi˚_fd
 (
vlib_pci_addr_t
 * 
addr
,

49 *
fd
);

	@/usr/include/vlib/main.h

40 #i‚de‡
ö˛uded_vlib_maö_h


41 
	#ö˛uded_vlib_maö_h


	)

43 
	~<vµö‰a/ñog.h
>

44 
	~<vµö‰a/f‹m©.h
>

45 
	~<vµö‰a/l⁄gjmp.h
>

46 
	~<vµö‰a/poﬁ.h
>

47 
	~<vµö‰a/øndom_buf„r.h
>

48 
	~<vµö‰a/time.h
>

50 
	~<±hªad.h
>

55 #i‚de‡
VLIB_ELOG_MAIN_LOOP


56 
	#VLIB_ELOG_MAIN_LOOP
 0

	)

59 
	svlib_maö_t


62 
˛ib_time_t
 
	m˛ib_time
;

65 
u64
 
	m˝u_time_œ°_node_di•©ch
;

68 
u64
 
	m˝u_time_maö_lo›_°¨t
;

71 
u32
 
	mmaö_lo›_cou¡
;

74 
u32
 
	mmaö_lo›_ve˘‹s_¥o˚s£d
;

75 
u32
 
	mmaö_lo›_nodes_¥o˚s£d
;

80 
u32
 
	mve˘‹_cou¡s_≥r_maö_lo›
[2];

81 
u32
 
	mnode_cou¡s_≥r_maö_lo›
[2];

84 
	#VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
 7

	)

87 
u32
 
	mmaö_lo›_exô_£t
;

89 vﬁ©ûê
u32
 
	mmaö_lo›_exô_now
;

90 
˛ib_l⁄gjmp_t
 
	mmaö_lo›_exô
;

91 
	#VLIB_MAIN_LOOP_EXIT_NONE
 0

	)

92 
	#VLIB_MAIN_LOOP_EXIT_PANIC
 1

	)

94 
	#VLIB_MAIN_LOOP_EXIT_CLI
 2

	)

97 
˛ib_îr‹_t
 *
	mmaö_lo›_îr‹
;

100 *
	m«me
;

103 *
	mhóp_ba£
;

104 
uw‹d
 
	mhóp_size
;

106 
vlib_buf„r_maö_t
 *
	mbuf„r_maö
;

111 
	m˛ib_îr‹_t
 *(*
	mos_physmem_ªgi⁄_Æloc
Ë(
vlib_maö_t
 * 
	mvm
,

112 *
	m«me
, 
u32
 
	msize
,

113 
u8
 
	mnuma_node
, 
u32
 
	mÊags
,

114 
vlib_physmem_ªgi⁄_ödex_t
 *

115 
	midx
);

117 (*
	mos_physmem_ªgi⁄_‰ì
Ë(
vlib_maö_t
 * 
	mvm
,

118 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
);

120 *(*
	mos_physmem_Æloc_Æig√d
Ë(
vlib_maö_t
 * 
	mvm
,

121 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
,

122 
uw‹d
 
	mn_byãs
, uw‹d 
	mÆignmít
);

123 (*
	mos_physmem_‰ì
Ë(
vlib_maö_t
 * 
	mvm
,

124 
vlib_physmem_ªgi⁄_ödex_t
 
	midx
, *
	mx
);

127 
vlib_node_maö_t
 
	mnode_maö
;

130 
vlib_˛i_maö_t
 
	m˛i_maö
;

133 
vlib_åa˚_maö_t
 
	måa˚_maö
;

136 
vlib_îr‹_maö_t
 
	mîr‹_maö
;

140 (*
	mos_pu¡_‰ame
Ë(
vlib_maö_t
 * 
	mvm
,

141 
vlib_node_ru¡ime_t
 * 
	mnode
,

142 
vlib_‰ame_t
 * 
	m‰ame
);

145 
mc_maö_t
 *
	mmc_maö
;

148 
u32
 
	mmc_°ªam_ödex
;

150 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_mc_°ªam_joö
;

153 
ñog_maö_t
 
	mñog_maö
;

156 
ñog_evít_ty≥_t
 *
	mnode_ˇŒ_ñog_evít_ty≥s
;

157 
ñog_evít_ty≥_t
 *
	mnode_ªtu∫_ñog_evít_ty≥s
;

159 
ñog_evít_ty≥_t
 *
	mîr‹_ñog_evít_ty≥s
;

162 
uw‹d
 
	møndom_£ed
;

165 
˛ib_øndom_buf„r_t
 
	møndom_buf„r
;

168 
uw‹d
 *
	möô_fun˘i⁄s_ˇŒed
;

171 
u32
 
	mthªad_ödex
;

173 **
	mmbuf_Æloc_li°
;

176 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	möô_fun˘i⁄_ªgi°øti⁄s
;

177 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mw‹kî_öô_fun˘i⁄_ªgi°øti⁄s
;

178 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mmaö_lo›_íãr_fun˘i⁄_ªgi°øti⁄s
;

179 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	mmaö_lo›_exô_fun˘i⁄_ªgi°øti⁄s
;

180 
_vlib_öô_fun˘i⁄_li°_ñt_t
 *
	m≠i_öô_fun˘i⁄_ªgi°øti⁄s
;

181 
vlib_c⁄fig_fun˘i⁄_ru¡ime_t
 *
	mc⁄fig_fun˘i⁄_ªgi°øti⁄s
;

182 
mc_£rülize_msg_t
 *
	mmc_msg_ªgi°øti⁄s
;

185 vﬁ©ûê
u32
 
	mqueue_sig«l_≥ndög
;

186 vﬁ©ûê
u32
 
	m≠i_queue_n⁄em±y
;

187 (*
	mqueue_sig«l_ˇŒback
Ë(
	mvlib_maö_t
 *);

188 
u8
 **
	m¨gv
;

191 vﬁ©ûê
	m∑rked_©_b¨rõr
;

194 
	mñog_po°_m‹ãm_dump
;

200 
	m√ed_vlib_w‹kî_thªad_node_ru¡ime_upd©e
;

206 
f64
 
	mb¨rõr_ïoch
;

209 
f64
 
	mb¨rõr_no_˛o£_bef‹e
;

212 
uw‹d
 *
	m≥ndög_Ωc_ªque°s
;

214 } 
	tvlib_maö_t
;

217 
vlib_maö_t
 
vlib_globÆ_maö
;

219 
vlib_w‹kî_lo›
 (
vlib_maö_t
 * 
vm
);

221 
Æways_ölöe
 
f64


222 
	$vlib_time_now
 (
vlib_maö_t
 * 
vm
)

224  
	`˛ib_time_now
 (&
vm
->
˛ib_time
);

225 
	}
}

227 
Æways_ölöe
 
f64


228 
	$vlib_time_now_ticks
 (
vlib_maö_t
 * 
vm
, 
u64
 
n
)

230  
	`˛ib_time_now_öã∫Æ
 (&
vm
->
˛ib_time
, 
n
);

231 
	}
}

234 
Æways_ölöe
 

235 
	$vlib_time_waô
 (
vlib_maö_t
 * 
vm
, 
f64
 
waô
)

237 
f64
 
t
 = 
	`vlib_time_now
 (
vm
);

238 
f64
 
limô
 = 
t
 + 
waô
;

239 
t
 < 
limô
)

240 
t
 = 
	`vlib_time_now
 (
vm
);

241 
	}
}

244 
	#vlib_time_code
(
vm
,
body
) \

246 
f64
 
_t
[2]; \

247 
_t
[0] = 
	`vlib_time_now
 (
vm
); \

248 dÿ{ 
body
; } 0); \

249 
_t
[1] = 
	`vlib_time_now
 (
vm
); \

250 
	`˛ib_w¨nög
 ("%.7e", 
_t
[1] - _t[0]); \

251 } 0)

	)

253 
	#vlib_waô_wôh_timeout
(
vm
,
su•íd_time
,
timeout_time
,
ã°
) \

255 
uw‹d
 
__vlib_waô_wôh_timeout
 = 0; \

256 
f64
 
__vlib_waô_time
 = 0; \

257 ! (
__vlib_waô_wôh_timeout
 = (
ã°
)) \

258 && 
__vlib_waô_time
 < (
timeout_time
)) \

260 
	`vlib_¥o˚ss_su•íd
 (
vm
, 
su•íd_time
); \

261 
__vlib_waô_time
 +
su•íd_time
; \

263 
__vlib_waô_wôh_timeout
; \

264 })

	)

266 
Æways_ölöe
 

267 
	$vlib_∑nic_wôh_îr‹
 (
vlib_maö_t
 * 
vm
, 
˛ib_îr‹_t
 * 
îr‹
)

269 
vm
->
maö_lo›_îr‹
 = 
îr‹
;

270 
	`˛ib_l⁄gjmp
 (&
vm
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_PANIC
);

271 
	}
}

273 
	#vlib_∑nic_wôh_msg
(
vm
,
¨gs
...) \

274 
	`vlib_∑nic_wôh_îr‹
 (
vm
, 
	`˛ib_îr‹_ªtu∫
 (0, 
¨gs
))

	)

276 
Æways_ölöe
 

277 
	$vlib_∑nic
 (
vlib_maö_t
 * 
vm
)

279 
	`vlib_∑nic_wôh_îr‹
 (
vm
, 0);

280 
	}
}

282 
Æways_ölöe
 
u32


283 
	$vlib_ve˘‹_öput_°©s_ödex
 (
vlib_maö_t
 * 
vm
, 
w‹d
 
dñè
)

285 
u32
 
i
;

286 
i
 = 
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

287 
	`ASSERT
 (
	`is_pow2
 (
	`ARRAY_LEN
 (
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
)));

288  (
i
 + 
dñè
Ë& (
	`ARRAY_LEN
 (
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
) - 1);

289 
	}
}

294 
Æways_ölöe
 
u32


295 
	$vlib_œ°_ve˘‹s_≥r_maö_lo›
 (
vlib_maö_t
 * 
vm
)

297 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

298 
u32
 
n
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

299  
n
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

300 
	}
}

303 
Æways_ölöe
 
f64


304 
	$vlib_œ°_ve˘‹s_≥r_maö_lo›_as_f64
 (
vlib_maö_t
 * 
vm
)

306 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

307 
u32
 
v
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

308  (
f64
Ë
v
 / (f64Ë(1 << 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
);

309 
	}
}

312 
Æways_ölöe
 
f64


313 
	$vlib_œ°_ve˘‹_Àngth_≥r_node
 (
vlib_maö_t
 * 
vm
)

315 
u32
 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, -1);

316 
u32
 
v
 = 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

317 
u32
 
n
 = 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
];

318  
n
 =0 ? 0 : (
f64
Ë
v
 / (f64)Ç;

319 
	}
}

321 
u32
 
wøps
;

323 
Æways_ölöe
 

324 
	$vlib_ö¸emít_maö_lo›_cou¡î
 (
vlib_maö_t
 * 
vm
)

326 
u32
 
i
, 
c
, 
n
, 
v
, 
is_wøp
;

328 
c
 = 
vm
->
maö_lo›_cou¡
++;

330 
is_wøp
 = (
c
 & 
	`pow2_mask
 (
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)) == 0;

332 i‡(
is_wøp
)

333 
wøps
++;

335 
i
 = 
	`vlib_ve˘‹_öput_°©s_ödex
 (
vm
, 
is_wøp
);

337 
v
 = 
is_wøp
 ? 0 : 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
];

338 
n
 = 
is_wøp
 ? 0 : 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
];

340 
v
 +
vm
->
maö_lo›_ve˘‹s_¥o˚s£d
;

341 
n
 +
vm
->
maö_lo›_nodes_¥o˚s£d
;

342 
vm
->
maö_lo›_ve˘‹s_¥o˚s£d
 = 0;

343 
vm
->
maö_lo›_nodes_¥o˚s£d
 = 0;

344 
vm
->
ve˘‹_cou¡s_≥r_maö_lo›
[
i
] = 
v
;

345 
vm
->
node_cou¡s_≥r_maö_lo›
[
i
] = 
n
;

347 i‡(
	`PREDICT_FALSE
 (
vm
->
maö_lo›_exô_now
))

348 
	`˛ib_l⁄gjmp
 (&
vm
->
maö_lo›_exô
, 
VLIB_MAIN_LOOP_EXIT_CLI
);

349 
	}
}

351 
Æways_ölöe
 
	gvlib_£t_queue_sig«l_ˇŒback


352 (
vlib_maö_t
 * 
	gvm
, (*
Â
) (vlib_main_t *))

354 
vm
->
queue_sig«l_ˇŒback
 = 
Â
;

355 
	}
}

358 
vlib_maö
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
);

361 
u8
 **
vlib_thªad_°acks
;

364 
u32
 
	$vlib_≠p_num_thªad_°acks_√eded
 (Ë
	`__©åibuã__
 ((
wók
));

366 
	`vlib_node_sync_°©s
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
n
);

	@/usr/include/vlib/mc.h

18 #i‚de‡
ö˛uded_vlib_mc_h


19 
	#ö˛uded_vlib_mc_h


	)

21 
	~<vµö‰a/ñog.h
>

22 
	~<vµö‰a/fifo.h
>

23 
	~<vµö‰a/mhash.h
>

24 
	~<vlib/node.h
>

26 #i‚de‡
MC_EVENT_LOGGING


27 
	#MC_EVENT_LOGGING
 1

	)

30 
Æways_ölöe
 
uw‹d


31 
	$mc_√ed_byã_sw≠
 ()

33  
CLIB_ARCH_IS_LITTLE_ENDIAN
;

34 
	}
}

42 
u8
 
	mas_u8
[8];

43 
u64
 
	mas_u64
;

44 } 
	tmc_≥î_id_t
;

46 
Æways_ölöe
 
mc_≥î_id_t


47 
	$mc_byã_sw≠_≥î_id
 (
mc_≥î_id_t
 
i
)

50  
i
;

51 
	}
}

53 
Æways_ölöe
 

54 
	$mc_≥î_id_com∑ª
 (
mc_≥î_id_t
 
a
, mc_≥î_id_à
b
)

56  
	`memcmp
 (
a
.
as_u8
, 
b
.as_u8,  (a.as_u8));

57 
	}
}

62 
CLIB_PACKED
 (struct

65 
mc_≥î_id_t
 
≥î_id
;

67 
u32
 
globÆ_£quí˚
;}Ë
	tmc_msg_ma°î_as£π_t
;

69 
Æways_ölöe
 

70 
	$mc_byã_sw≠_msg_ma°î_as£π
 (
mc_msg_ma°î_as£π_t
 * 
r
)

72 i‡(
	`mc_√ed_byã_sw≠
 ())

74 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

75 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

77 
	}
}

79 
	#f‹óch_mc_msg_ty≥
 \

80 
	`_
 (
ma°î_as£π
) \

81 
	`_
 (
joö_‹_Àave_ªque°
) \

82 
	`_
 (
joö_ª∂y
) \

83 
	`_
 (
u£r_ªque°
) \

84 
	`_
 (
u£r_ack
) \

85 
	`_
 (
ˇtchup_ªque°
) \

86 
	`_
 (
ˇtchup_ª∂y
)

	)

90 
	#_
(
f
Ë
MC_MSG_TYPE_
##f,

	)

91 
	mf‹óch_mc_msg_ty≥


92 #unde‡
_


93 } 
	tmc_ªœy_msg_ty≥_t
;

96 
CLIB_PACKED
 (struct

98 
mc_≥î_id_t
 
≥î_id
; 
mc_ªœy_msg_ty≥_t
 
ty≥
:32;

101 
u32
 
°ªam_ödex
;

103 
u8
 
is_joö
;}Ë
	tmc_msg_joö_‹_Àave_ªque°_t
;

105 
Æways_ölöe
 

106 
	$mc_byã_sw≠_msg_joö_‹_Àave_ªque°
 (
mc_msg_joö_‹_Àave_ªque°_t
 * 
r
)

108 i‡(
	`mc_√ed_byã_sw≠
 ())

110 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

111 
r
->
ty≥
 = 
	`˛ib_byã_sw≠_u32
 (r->type);

112 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

114 
	}
}

117 
CLIB_PACKED
 (struct

119 
mc_≥î_id_t
 
≥î_id
; 
mc_ªœy_msg_ty≥_t
 
ty≥
:32;

121 
u32
 
°ªam_ödex
;

123 
mc_≥î_id_t
 
ˇtchup_≥î_id
;}Ë
	tmc_msg_joö_ª∂y_t
;

125 
Æways_ölöe
 

126 
	$mc_byã_sw≠_msg_joö_ª∂y
 (
mc_msg_joö_ª∂y_t
 * 
r
)

128 i‡(
	`mc_√ed_byã_sw≠
 ())

130 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

131 
r
->
ty≥
 = 
	`˛ib_byã_sw≠_u32
 (r->type);

132 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

133 
r
->
ˇtchup_≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->catchup_peer_id);

135 
	}
}

139 
CLIB_PACKED
 (struct

141 
mc_≥î_id_t
 
≥î_id
; 
u32
 
°ªam_ödex
;

143 
u32
 
globÆ_£quí˚
;

145 
u32
 
loˇl_£quí˚
;

147 
u32
 
n_d©a_byãs
;

149 
u8
 
d©a
[0];}Ë
	tmc_msg_u£r_ªque°_t
;

151 
Æways_ölöe
 

152 
	$mc_byã_sw≠_msg_u£r_ªque°
 (
mc_msg_u£r_ªque°_t
 * 
r
)

154 i‡(
	`mc_√ed_byã_sw≠
 ())

156 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

157 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

158 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

159 
r
->
loˇl_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->local_sequence);

160 
r
->
n_d©a_byãs
 = 
	`˛ib_byã_sw≠_u32
 (r->n_data_bytes);

162 
	}
}

165 
CLIB_PACKED
 (struct

167 
mc_≥î_id_t
 
≥î_id
;

168 
u32
 
globÆ_£quí˚
; u32 
°ªam_ödex
;

169 
u32
 
loˇl_£quí˚
;

170 
i32
 
£q_cmp_ªsu…
;}Ë
	tmc_msg_u£r_ack_t
;

172 
Æways_ölöe
 

173 
	$mc_byã_sw≠_msg_u£r_ack
 (
mc_msg_u£r_ack_t
 * 
r
)

175 i‡(
	`mc_√ed_byã_sw≠
 ())

177 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

178 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

179 
r
->
globÆ_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->global_sequence);

180 
r
->
loˇl_£quí˚
 = 
	`˛ib_byã_sw≠_u32
 (r->local_sequence);

181 
r
->
£q_cmp_ªsu…
 = 
	`˛ib_byã_sw≠_i32
 (r->seq_cmp_result);

183 
	}
}

186 
CLIB_PACKED
 (struct

188 
mc_≥î_id_t
 
≥î_id
;

189 
u32
 
°ªam_ödex
;}Ë
	tmc_msg_ˇtchup_ªque°_t
;

191 
Æways_ölöe
 

192 
	$mc_byã_sw≠_msg_ˇtchup_ªque°
 (
mc_msg_ˇtchup_ªque°_t
 * 
r
)

194 i‡(
	`mc_√ed_byã_sw≠
 ())

196 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

197 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

199 
	}
}

202 
CLIB_PACKED
 (struct

204 
mc_≥î_id_t
 
≥î_id
; 
u32
 
°ªam_ödex
;

206 
u32
 
œ°_globÆ_£quí˚_ö˛uded
;

208 
u32
 
n_d©a_byãs
;

210 
u8
 
d©a
[0];}Ë
	tmc_msg_ˇtchup_ª∂y_t
;

212 
Æways_ölöe
 

213 
	$mc_byã_sw≠_msg_ˇtchup_ª∂y
 (
mc_msg_ˇtchup_ª∂y_t
 * 
r
)

215 i‡(
	`mc_√ed_byã_sw≠
 ())

217 
r
->
≥î_id
 = 
	`mc_byã_sw≠_≥î_id
 (r->peer_id);

218 
r
->
°ªam_ödex
 = 
	`˛ib_byã_sw≠_u32
 (r->stream_index);

219 
r
->
œ°_globÆ_£quí˚_ö˛uded
 =

220 
	`˛ib_byã_sw≠_u32
 (
r
->
œ°_globÆ_£quí˚_ö˛uded
);

221 
r
->
n_d©a_byãs
 = 
	`˛ib_byã_sw≠_u32
 (r->n_data_bytes);

223 
	}
}

225 
	s_mc_£rülize_msg


228 *
	m«me
;

231 
£rülize_fun˘i⁄_t
 *
	m£rülize
;

232 
£rülize_fun˘i⁄_t
 *
	mun£rülize
;

236 
u32
 
	mmax_n_byãs_£rülized
;

239 
u32
 
	m›aque
;

242 
u32
 
	mglobÆ_ödex
;

245 
_mc_£rülize_msg
 *
	m√xt_ªgi°øti⁄
;

246 } 
	tmc_£rülize_msg_t
;

251 
u32
 
	mglobÆ_ödex
;

252 } 
	tmc_£rülize_°ªam_msg_t
;

254 
	#MC_SERIALIZE_MSG
(
x
,...) \

255 
__VA_ARGS__
 
mc_£rülize_msg_t
 
x
; \

256 
__mc_£rülize_msg_ªgi°øti⁄_
##
	`x
 () \

257 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

258 
__mc_£rülize_msg_ªgi°øti⁄_
##
	`x
 () \

260 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

261 
x
.
√xt_ªgi°øti⁄
 = 
vm
->
mc_msg_ªgi°øti⁄s
; \

262 
vm
->
mc_msg_ªgi°øti⁄s
 = &
x
; \

264 
__VA_ARGS__
 
mc_£rülize_msg_t
 
x


	)

268 
	mMC_TRANSPORT_MASTERSHIP
,

269 
	mMC_TRANSPORT_JOIN
,

270 
	mMC_TRANSPORT_USER_REQUEST_TO_RELAY
,

271 
	mMC_TRANSPORT_USER_REQUEST_FROM_RELAY
,

272 
	mMC_N_TRANSPORT_TYPE
,

273 } 
	tmc_å™•‹t_ty≥_t
;

277 
	m˛ib_îr‹_t
 *(*
	mtx_buf„r
Ë(*
	m›aque
, 
mc_å™•‹t_ty≥_t
 
	mty≥
,

278 
u32
 
	mbuf„r_ödex
);

280 
	m˛ib_îr‹_t
 *(*
	mtx_ack
Ë(*
	m›aque
, 
mc_≥î_id_t
 
	m≥î_id
,

281 
u32
 
	mbuf„r_ödex
);

284 
uw‹d
 (*
ˇtchup_ªque°_fun
Ë(*
	m›aque
, 
u32
 
	m°ªam_ödex
,

285 
mc_≥î_id_t
 
	mˇtchup_≥î_id
);

287 (*
	mˇtchup_£nd_fun
Ë(*
	m›aque
, 
uw‹d
 
	mˇtchup_›aque
,

288 
u8
 * 
	md©a_ve˘‹
);

291 *
	m›aque
;

293 
mc_≥î_id_t
 
	mour_ack_≥î_id
;

294 
mc_≥î_id_t
 
	mour_ˇtchup_≥î_id
;

298 
u32
 
	mmax_∑ckë_size
;

300 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_≥î_id
;

301 } 
	tmc_å™•‹t_t
;

307 
u64
 
	mn_msgs_‰om_∑°
;

308 
u64
 
	mn_msgs_‰om_futuª
;

309 } 
	tmc_°ªam_≥î_°©s_t
;

314 
mc_≥î_id_t
 
	mid
;

317 
u32
 
	mœ°_£quí˚_ª˚ived
;

319 
mc_°ªam_≥î_°©s_t
 
	m°©s
, 
	m°©s_œ°_˛ór
;

320 } 
	tmc_°ªam_≥î_t
;

324 
u32
 
	mbuf„r_ödex
;

327 
u32
 
	mloˇl_£quí˚
;

330 
u32
 
	mn_ªåõs
;

333 
u32
 
	m¥ev_ödex
, 
	m√xt_ödex
;

336 
uw‹d
 *
	mu«cked_by_≥î_bôm≠
;

339 
f64
 
	m£¡_©
;

340 } 
	tmc_ªåy_t
;

345 
u64
 
	mn_ªåõs
;

346 } 
	tmc_°ªam_°©s_t
;

348 
	gmc_maö_t
;

349 
	gmc_°ªam_t
;

354 *
	m«me
;

357 
u32
 
	mwödow_size
;

360 
f64
 
	mªåy_öãrvÆ
;

363 
u32
 
	mªåy_limô
;

366 (*
	mrx_buf„r
Ë(
mc_maö_t
 * 
	mmc_maö
,

367 
mc_°ªam_t
 * 
	m°ªam
,

368 
mc_≥î_id_t
 
	m≥î_id
, 
u32
 
	mbuf„r_ödex
);

371 
	mu8
 *(*
	mˇtchup_¢≠shŸ
Ë(
mc_maö_t
 * 
	mmc_maö
,

372 
u8
 * 
	m¢≠shŸ_ve˘‹
,

373 
u32
 
	mœ°_globÆ_£quí˚_ö˛uded
);

376 (*
	mˇtchup
Ë(
mc_maö_t
 * 
	mmc_maö
,

377 
u8
 * 
	m¢≠shŸ_d©a
, 
u32
 
	mn_¢≠shŸ_d©a_byãs
);

380 (*
	mßve_¢≠shŸ
Ë(
mc_maö_t
 * 
	mmc_maö
,

381 
u32
 
	mis_ˇtchup
,

382 
u8
 * 
	m¢≠shŸ_d©a
, 
u32
 
	mn_¢≠shŸ_d©a_byãs
);

385 (*
	m≥î_dõd
Ë(
mc_maö_t
 * 
	mmc_maö
,

386 
mc_°ªam_t
 * 
	m°ªam
, 
mc_≥î_id_t
 
	m≥î_id
);

387 } 
	tmc_°ªam_c⁄fig_t
;

389 
	#f‹óch_mc_°ªam_°©e
 \

390 
	`_
 (
övÆid
) \

391 
	`_
 (
«me_known
) \

392 
	`_
 (
joö_ö_¥ogªss
) \

393 
	`_
 (
ˇtchup
) \

394 
	`_
 (
ªady
)

	)

398 
	#_
(
f
Ë
MC_STREAM_STATE_
##f,

	)

399 
	mf‹óch_mc_°ªam_°©e


400 #unde‡
_


401 } 
	tmc_°ªam_°©e_t
;

403 
	smc_°ªam_t


405 
mc_°ªam_c⁄fig_t
 
	mc⁄fig
;

407 
mc_°ªam_°©e_t
 
	m°©e
;

410 
u32
 
	mödex
;

413 
	#MC_STREAM_INDEX_INTERNAL
 0

	)

415 
mc_ªåy_t
 *
	mªåy_poﬁ
;

418 
u32
 
	mªåy_hód_ödex
, 
	mªåy_èû_ödex
;

426 
mc_ªåy_t
 *
	mªtúed_fifo
;

429 
uw‹d
 *
	mªåy_ödex_by_loˇl_£quí˚
;

433 
u32
 *
	mˇtchup_fifo
;

435 
mc_°ªam_°©s_t
 
	m°©s
, 
	m°©s_œ°_˛ór
;

438 
mc_°ªam_≥î_t
 *
	m≥îs
;

441 
uw‹d
 *
	mÆl_≥î_bôm≠
;

444 
mhash_t
 
	m≥î_ödex_by_id
;

447 
f64
 
	mjoö_timeout
;

449 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_joö_d⁄e
;

451 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
	m¥ocs_waôög_f‹_›í_wödow
;

454 
u32
 
	mour_loˇl_£quí˚
;

461 
u32
 
	mœ°_globÆ_£quí˚_¥o˚s£d
;

464 
mc_£rülize_°ªam_msg_t
 *
	m°ªam_msgs
;

467 
u32
 *
	m°ªam_msg_ödex_by_globÆ_ödex
;

470 
uw‹d
 *
	m°ªam_msg_ödex_by_«me
;

472 
u64
 
	mu£r_ªque°s_£¡
;

473 
u64
 
	mu£r_ªque°s_ª˚ived
;

474 } 
	tmc_°ªam_t
;

476 
Æways_ölöe
 

477 
	$mc_°ªam_‰ì
 (
mc_°ªam_t
 * 
s
)

479 
	`poﬁ_‰ì
 (
s
->
ªåy_poﬁ
);

480 
	`hash_‰ì
 (
s
->
ªåy_ödex_by_loˇl_£quí˚
);

481 
	`˛ib_fifo_‰ì
 (
s
->
ˇtchup_fifo
);

482 
	`poﬁ_‰ì
 (
s
->
≥îs
);

483 
	`mhash_‰ì
 (&
s
->
≥î_ödex_by_id
);

484 
	`vec_‰ì
 (
s
->
¥ocs_waôög_f‹_joö_d⁄e
);

485 
	`vec_‰ì
 (
s
->
¥ocs_waôög_f‹_›í_wödow
);

486 
	}
}

488 
Æways_ölöe
 

489 
	$mc_°ªam_öô
 (
mc_°ªam_t
 * 
s
)

491 
	`mem£t
 (
s
, 0,  (s[0]));

492 
s
->
ªåy_hód_ödex
 = s->
ªåy_èû_ödex
 = ~0;

493 
	}
}

497 
u32
 
	m°ªam_ödex
;

498 
u32
 
	mˇtchup_›aque
;

499 
u8
 *
	mˇtchup_¢≠shŸ
;

500 } 
	tmc_ˇtchup_¥o˚ss_¨g_t
;

504 
	mMC_RELAY_STATE_NEGOTIATE
,

505 
	mMC_RELAY_STATE_MASTER
,

506 
	mMC_RELAY_STATE_SLAVE
,

507 } 
	tmc_ªœy_°©e_t
;

511 
mc_≥î_id_t
 
	m≥î_id
;

513 
f64
 
	mtime_œ°_ma°î_as£π_ª˚ived
;

514 } 
	tmc_ma°îshù_≥î_t
;

518 
u32
 
	m°ªam_ödex
;

519 
u32
 
	mbuf„r_ödex
;

520 } 
	tmc_°ªam_™d_buf„r_t
;

522 
	smc_maö_t


524 
mc_ªœy_°©e_t
 
	mªœy_°©e
;

527 
u32
 
	mwe_ˇn_be_ªœy_ma°î
;

529 
u64
 
	mªœy_ma°î_≥î_id
;

531 
mc_ma°îshù_≥î_t
 *
	mma°îshù_≥îs
;

534 
mhash_t
 
	mma°îshù_≥î_ödex_by_id
;

537 
mc_å™•‹t_t
 
	må™•‹t
;

540 
u32
 
	mªœy_globÆ_£quí˚
;

543 
mc_°ªam_t
 *
	m°ªam_ve˘‹
;

546 
uw‹d
 *
	m°ªam_ödex_by_«me
;

548 
uw‹d
 *
	m¥ocs_waôög_f‹_°ªam_«me_by_«me
;

550 
vlib_⁄e_time_waôög_¥o˚ss_t
 **
	m¥ocs_waôög_f‹_°ªam_«me_poﬁ
;

552 
	mjoös_ö_¥ogªss
;

554 
mc_ˇtchup_¥o˚ss_¨g_t
 *
	mˇtchup_¥o˚ss_¨gs
;

558 
u32
 
	mma°îshù_¥o˚ss
;

559 
u32
 
	mjoö_agî_¥o˚ss
;

560 
u32
 
	mªåy_¥o˚ss
;

561 
u32
 
	mˇtchup_¥o˚ss
;

562 
u32
 
	mun£rülize_¥o˚ss
;

565 
mc_£rülize_msg_t
 **
	mglobÆ_msgs
;

568 
uw‹d
 *
	mglobÆ_msg_ödex_by_«me
;

571 
£rülize_maö_t
 
	m£rülize_maös
[
VLIB_N_RX_TX
];

573 
vlib_£rülize_buf„r_maö_t
 
	m£rülize_buf„r_maös
[
VLIB_N_RX_TX
];

576 
vlib_maö_t
 *
	mvlib_maö
;

577 
ñog_maö_t
 *
	mñog_maö
;

580 
mhash_t
 
	mñog_id_by_≥î_id
;

582 
uw‹d
 *
	mñog_id_by_msg_«me
;

585 
mc_°ªam_™d_buf„r_t
 *
	mmc_un£rülize_°ªam_™d_buf„rs
;

586 } 
	tmc_maö_t
;

588 
Æways_ölöe
 
mc_°ªam_t
 *

589 
	$mc_°ªam_by_«me
 (
mc_maö_t
 * 
m
, *
«me
)

591 
uw‹d
 *
p
 = 
	`hash_gë
 (
m
->
°ªam_ödex_by_«me
, 
«me
);

592  
p
 ? 
	`vec_ñt_©_ödex
 (
m
->
°ªam_ve˘‹
,Ö[0]) : 0;

593 
	}
}

595 
Æways_ölöe
 
mc_°ªam_t
 *

596 
	$mc_°ªam_by_ödex
 (
mc_maö_t
 * 
m
, 
u32
 
i
)

598  
i
 < 
	`vec_Àn
 (
m
->
°ªam_ve˘‹
) ? m->stream_vector + i : 0;

599 
	}
}

601 
Æways_ölöe
 

602 
	$mc_˛ór_°ªam_°©s
 (
mc_maö_t
 * 
m
)

604 
mc_°ªam_t
 *
s
;

605 
mc_°ªam_≥î_t
 *
p
;

606 
	`vec_f‹óch
 (
s
, 
m
->
°ªam_ve˘‹
)

608 
s
->
°©s_œ°_˛ór
 = s->
°©s
;

610 
	`poﬁ_f‹óch
 (
p
, 
s
->
≥îs
, ({

611 
p
->
°©s_œ°_˛ór
 =Ö->
°©s
;

615 
	}
}

618 
	#_
(
f
Ë
mc_msg_
##f##
	`_h™dÀr
 (
mc_maö_t
 * 
mcm
, mc_msg_##f##
_t
 * 
msg
, 
u32
 
buf„r_ödex
);

	)

619 
	gf‹óch_mc_msg_ty≥


620 #unde‡
_


621 
u32
 
mc_°ªam_joö
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_c⁄fig_t
 *);

623 
mc_°ªam_Àave
 (
mc_maö_t
 * 
mcm
, 
u32
 
°ªam_ödex
);

625 
mc_waô_f‹_°ªam_ªady
 (
mc_maö_t
 * 
m
, *
°ªam_«me
);

627 
u32
 
mc_°ªam_£nd
 (
mc_maö_t
 * 
mcm
, u32 
°ªam_ödex
, u32 
buf„r_ödex
);

629 
mc_maö_öô
 (
mc_maö_t
 * 
mcm
, *
èg
);

631 
mc_íabÀ_dißbÀ_ma°îshù
 (
mc_maö_t
 * 
mcm
, 
we_ˇn_be_ma°î
);

633 *
mc_gë_vlib_buf„r
 (
vlib_maö_t
 *
vm
, 
u32
 
n_byãs
,

634 
u32
 * 
bi_ªtu∫
);

636 
f‹m©_fun˘i⁄_t
 
	gf‹m©_mc_maö
;

638 
˛ib_îr‹_t
 *
mc_£rülize_öã∫Æ
 (
mc_maö_t
 * 
mc
,

639 
u32
 
°ªam_ödex
,

640 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

641 
mc_£rülize_msg_t
 * 
msg
, ...);

643 
˛ib_îr‹_t
 *
mc_£rülize_va
 (
mc_maö_t
 * 
mc
,

644 
u32
 
°ªam_ödex
,

645 
u32
 
mu…ùÀ_mesßges_≥r_vlib_buf„r
,

646 
mc_£rülize_msg_t
 * 
msg
, 
va_li°
 * 
va
);

648 
	#mc_£rülize_°ªam
(
mc
,
si
,
msg
,
¨gs
...) \

649 
	`mc_£rülize_öã∫Æ
((
mc
),(
si
),(0),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

651 
	#mc_£rülize
(
mc
,
msg
,
¨gs
...) \

652 
	`mc_£rülize_öã∫Æ
((
mc
),(~0),(0),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

654 
	#mc_£rülize2
(
mc
,
add
,
msg
,
¨gs
...) \

655 
	`mc_£rülize_öã∫Æ
((
mc
),(~0),(
add
),(
msg
),(msg)->
£rülize
,
¨gs
)

	)

657 
mc_un£rülize
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
, 
u32
 
buf„r_ödex
);

658 
uw‹d
 
mc_un£rülize_mesßge
 (
mc_maö_t
 * 
mcm
, 
mc_°ªam_t
 * 
s
,

659 
£rülize_maö_t
 * 
m
);

661 
£rülize_fun˘i⁄_t
 
	g£rülize_mc_maö
, 
	gun£rülize_mc_maö
;

663 
Æways_ölöe
 
uw‹d


664 
	$mc_max_mesßge_size_ö_byãs
 (
mc_maö_t
 * 
mcm
)

666  
mcm
->
å™•‹t
.
max_∑ckë_size
 -  (
mc_msg_u£r_ªque°_t
);

667 
	}
}

669 
Æways_ölöe
 
w‹d


670 
	$mc_£rülize_n_byãs_À·
 (
mc_maö_t
 * 
mcm
, 
£rülize_maö_t
 * 
m
)

672  
	`mc_max_mesßge_size_ö_byãs
 (
mcm
) -

673 
	`£rülize_vlib_buf„r_n_byãs
 (
m
);

674 
	}
}

676 
un£rülize_mc_°ªam
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
);

677 
mc_°ªam_joö_¥o˚ss_hﬁd
 ();

	@/usr/include/vlib/node.h

40 #i‚de‡
ö˛uded_vlib_node_h


41 
	#ö˛uded_vlib_node_h


	)

43 
	~<vµö‰a/˝u.h
>

44 
	~<vµö‰a/l⁄gjmp.h
>

45 
	~<vµö‰a/lock.h
>

46 
	~<vlib/åa˚.h
>

49 
	gvlib_node_ru¡ime_t
;

50 
	gvlib_‰ame_t
;

54 
	$uw‹d
 (
	tvlib_node_fun˘i⁄_t
Ë(
	tvlib_maö_t
 * 
	tvm
,

55 
	tvlib_node_ru¡ime_t
 * 
	tnode
,

56 
	tvlib_‰ame_t
 * 
	t‰ame
);

61 
VLIB_NODE_TYPE_INTERNAL
,

65 
VLIB_NODE_TYPE_INPUT
,

70 
VLIB_NODE_TYPE_PRE_INPUT
,

73 
VLIB_NODE_TYPE_PROCESS
,

75 
VLIB_N_NODE_TYPE
,

76 } 
	tvlib_node_ty≥_t
;

78 
	s_vlib_node_ªgi°øti⁄


81 
vlib_node_fun˘i⁄_t
 *
fun˘i⁄
;

84 *
«me
;

87 *
siblög_of
;

90 
u32
 
ödex
;

93 
vlib_node_ty≥_t
 
ty≥
;

96 **
îr‹_°rögs
;

99 
f‹m©_fun˘i⁄_t
 *
f‹m©_buf„r
;

100 
unf‹m©_fun˘i⁄_t
 *
unf‹m©_buf„r
;

103 
f‹m©_fun˘i⁄_t
 *
f‹m©_åa˚
;

104 
unf‹m©_fun˘i⁄_t
 *
unf‹m©_åa˚
;

107 
u8
 *(*
vÆid©e_‰ame
Ë(
vlib_maö_t
 * 
vm
,

108 
vlib_node_ru¡ime_t
 *,

109 
vlib_‰ame_t
 * 
f
);

112 *
ru¡ime_d©a
;

115 
u16
 
¥o˚ss_log2_n_°ack_byãs
;

118 
u8
 
ru¡ime_d©a_byãs
;

121 
u8
 
°©e
;

124 
u16
 
Êags
;

127 
u16
 
sˇœr_size
, 
ve˘‹_size
;

130 
u16
 
n_îr‹s
;

133 
u16
 
n_√xt_nodes
;

136 
_vlib_node_ªgi°øti⁄
 *
√xt_ªgi°øti⁄
;

139 *
√xt_nodes
[];

141 } 
	tvlib_node_ªgi°øti⁄_t
;

143 
	#VLIB_REGISTER_NODE
(
x
,...) \

144 
__VA_ARGS__
 
vlib_node_ªgi°øti⁄_t
 
x
; \

145 
__vlib_add_node_ªgi°øti⁄_
##
	`x
 () \

146 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

147 
__vlib_add_node_ªgi°øti⁄_
##
	`x
 () \

149 
vlib_maö_t
 * 
vm
 = 
	`vlib_gë_maö
(); \

150 
x
.
√xt_ªgi°øti⁄
 = 
vm
->
node_maö
.
node_ªgi°øti⁄s
; \

151 
vm
->
node_maö
.
node_ªgi°øti⁄s
 = &
x
; \

152 
	}
} \

153 
__VA_ARGS__
 
vlib_node_ªgi°øti⁄_t
 
x


	)

155 #i‡
CLIB_DEBUG
 > 0

156 
	#VLIB_NODE_FUNCTION_CLONE_TEMPLATE
(
¨ch
, 
‚
)

	)

157 
	#VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
)

	)

158 
	#VLIB_NODE_FUNCTION_MULTIARCH
(
node
, 
‚
)

	)

160 
	#VLIB_NODE_FUNCTION_CLONE_TEMPLATE
(
¨ch
, 
‚
, 
tgt
) \

161 
uw‹d
 \

162 
	`__©åibuã__
 ((
Ê©ãn
)) \

163 
	`__©åibuã__
 ((
	`èrgë
 (
tgt
))) \

164 
CLIB_CPU_OPTIMIZED
 \

165 
‚
 ## 
_
 ## 
	`¨ch
 ( 
vlib_maö_t
 * 
vm
, \

166 
vlib_node_ru¡ime_t
 * 
node
, \

167 
vlib_‰ame_t
 * 
‰ame
) \

168 {  
	`‚
 (
vm
, 
node
, 
‰ame
); }

	)

170 
	#VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
) \

171 
	`f‹óch_m¨ch_v¨ü¡
(
VLIB_NODE_FUNCTION_CLONE_TEMPLATE
, 
‚
)

	)

173 
	#VLIB_NODE_FUNCTION_MULTIARCH
(
node
, 
‚
) \

174 
	`VLIB_NODE_FUNCTION_MULTIARCH_CLONE
(
‚
) \

175 
	`CLIB_MULTIARCH_SELECT_FN
(
‚
, 
ölöe
) \

176 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) \

177 
__vlib_node_fun˘i⁄_mu…ürch_£À˘_
##
	`node
 () \

178 { 
node
.
fun˘i⁄
 = 
‚
 ## 
	`_mu…ürch_£À˘
(); }

	)

181 
Æways_ölöe
 
vlib_node_ªgi°øti⁄_t
 *

182 
	$vlib_node_√xt_ªgi°îed
 (
vlib_node_ªgi°øti⁄_t
 * 
c
)

184 
c
 =

185 
	`˛ib_ñf_£˘i⁄_d©a_√xt
 (
c
,

186 
c
->
n_√xt_nodes
 *  (c->
√xt_nodes
[0]));

187  
c
;

188 
	}
}

193 
u64
 
	mˇŒs
, 
	mve˘‹s
, 
	m˛ocks
, 
	msu•íds
;

194 
u64
 
	mmax_˛ock
;

195 
u64
 
	mmax_˛ock_n
;

196 } 
	tvlib_node_°©s_t
;

198 
	#f‹óch_vlib_node_°©e
 \

201 
	`_
 (
POLLING
) \

203 
	`_
 (
INTERRUPT
) \

205 
	`_
 (
DISABLED
)

	)

209 
	#_
(
f
Ë
VLIB_NODE_STATE_
##f,

	)

210 
	mf‹óch_vlib_node_°©e


211 #unde‡
_


212 
	mVLIB_N_NODE_STATE
,

213 } 
	tvlib_node_°©e_t
;

215 
	svlib_node_t


218 
vlib_node_fun˘i⁄_t
 *
	mfun˘i⁄
;

221 
u8
 *
	m«me
;

224 
u32
 
	m«me_ñog_°rög
;

227 
vlib_node_°©s_t
 
	m°©s_tŸÆ
;

231 
vlib_node_°©s_t
 
	m°©s_œ°_˛ór
;

234 
vlib_node_ty≥_t
 
	mty≥
;

237 
u32
 
	mödex
;

240 
u32
 
	mru¡ime_ödex
;

243 *
	mru¡ime_d©a
;

246 
u16
 
	mÊags
;

250 
	#VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH
 (1 << 0)

	)

253 
	#VLIB_NODE_FLAG_IS_OUTPUT
 (1 << 1)

	)

254 
	#VLIB_NODE_FLAG_IS_DROP
 (1 << 2)

	)

255 
	#VLIB_NODE_FLAG_IS_PUNT
 (1 << 3)

	)

256 
	#VLIB_NODE_FLAG_IS_HANDOFF
 (1 << 4)

	)

259 
	#VLIB_NODE_FLAG_TRACE
 (1 << 5)

	)

261 
	#VLIB_NODE_FLAG_SWITCH_FROM_INTERRUPT_TO_POLLING_MODE
 (1 << 6)

	)

262 
	#VLIB_NODE_FLAG_SWITCH_FROM_POLLING_TO_INTERRUPT_MODE
 (1 << 7)

	)

265 
u8
 
	m°©e
;

268 
u8
 
	mru¡ime_d©a_byãs
;

271 
u16
 
	mn_îr‹s
;

274 
u16
 
	msˇœr_size
, 
	mve˘‹_size
;

277 
u32
 
	mîr‹_hóp_h™dÀ
;

278 
u32
 
	mîr‹_hóp_ödex
;

281 **
	mîr‹_°rögs
;

285 **
	m√xt_node_«mes
;

288 
u32
 *
	m√xt_nodes
;

291 *
	msiblög_of
;

294 
uw‹d
 *
	msiblög_bôm≠
;

297 
u64
 *
	mn_ve˘‹s_by_√xt_node
;

302 
uw‹d
 *
	m√xt_¶Ÿ_by_node
;

305 
uw‹d
 *
	m¥ev_node_bôm≠
;

308 
u32
 
	mow√r_node_ödex
, 
	mow√r_√xt_ödex
;

311 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_buf„r
;

312 
unf‹m©_fun˘i⁄_t
 *
	munf‹m©_buf„r
;

315 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_åa˚
;

318 
	mu8
 *(*
	mvÆid©e_‰ame
Ë(
vlib_maö_t
 * 
	mvm
,

319 
	mvlib_node_ru¡ime_t
 *,

320 
vlib_‰ame_t
 * 
	mf
);

322 
u8
 *
	m°©e_°rög
;

323 } 
	tvlib_node_t
;

325 
	#VLIB_INVALID_NODE_INDEX
 ((
u32
Ë~0)

	)

328 
	#VLIB_FRAME_SIZE
 256

	)

329 
	#VLIB_FRAME_ALIGN
 
CLIB_CACHE_LINE_BYTES


	)

332 
	svlib_‰ame_t


335 
u16
 
	mÊags
;

338 
u8
 
	msˇœr_size
;

341 
u8
 
	mve˘‹_size
;

344 
u16
 
	mn_ve˘‹s
;

347 
u8
 
	m¨gumíts
[0];

348 } 
	tvlib_‰ame_t
;

353 
u32
 
	m‰ame_ödex
;

356 
u32
 
	mnode_ru¡ime_ödex
;

359 
u32
 
	mÊags
;

362 
	#VLIB_FRAME_NO_FREE_AFTER_DISPATCH
 \

363 
VLIB_NODE_FLAG_FRAME_NO_FREE_AFTER_DISPATCH


	)

367 
	#VLIB_FRAME_OWNER
 (1 << 15)

	)

370 
	#VLIB_FRAME_IS_ALLOCATED
 
VLIB_NODE_FLAG_IS_OUTPUT


	)

373 
	#VLIB_FRAME_PENDING
 
VLIB_NODE_FLAG_IS_DROP


	)

376 
	#VLIB_FRAME_FREE_AFTER_DISPATCH
 
VLIB_NODE_FLAG_IS_PUNT


	)

379 
	#VLIB_FRAME_TRACE
 
VLIB_NODE_FLAG_TRACE


	)

382 
u32
 
	mve˘‹s_sö˚_œ°_ovîÊow
;

383 } 
	tvlib_√xt_‰ame_t
;

385 
Æways_ölöe
 

386 
	$vlib_√xt_‰ame_öô
 (
vlib_√xt_‰ame_t
 * 
nf
)

388 
	`mem£t
 (
nf
, 0,  (nf[0]));

389 
nf
->
‰ame_ödex
 = ~0;

390 
nf
->
node_ru¡ime_ödex
 = ~0;

391 
	}
}

397 
u32
 
	mnode_ru¡ime_ödex
;

400 
u32
 
	m‰ame_ödex
;

403 
u32
 
	m√xt_‰ame_ödex
;

406 
	#VLIB_PENDING_FRAME_NO_NEXT_FRAME
 ((
u32
Ë~0)

	)

407 } 
	tvlib_≥ndög_‰ame_t
;

409 
	svlib_node_ru¡ime_t


411 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

413 
vlib_node_fun˘i⁄_t
 *
	mfun˘i⁄
;

415 
vlib_îr‹_t
 *
	mîr‹s
;

417 #i‡
__SIZEOF_POINTER__
 == 4

418 
u8
 
	m∑d
[8];

421 
u32
 
	m˛ocks_sö˚_œ°_ovîÊow
;

423 
u32
 
	mmax_˛ock
;

426 
u32
 
	mmax_˛ock_n
;

429 
u32
 
	mˇŒs_sö˚_œ°_ovîÊow
;

431 
u32
 
	mve˘‹s_sö˚_œ°_ovîÊow
;

434 
u32
 
	m√xt_‰ame_ödex
;

437 
u32
 
	mnode_ödex
;

439 
u32
 
	möput_maö_lo›s_≥r_ˇŒ
;

445 
u32
 
	mmaö_lo›_cou¡_œ°_di•©ch
;

448 
u32
 
	mmaö_lo›_ve˘‹_°©s
[2];

450 
u16
 
	mÊags
;

452 
u16
 
	m°©e
;

454 
u16
 
	mn_√xt_nodes
;

456 
u16
 
	mˇched_√xt_ödex
;

462 
u16
 
	mthªad_ödex
;

464 
u8
 
	mru¡ime_d©a
[0];

473 
	tvlib_node_ru¡ime_t
;

475 
	#VLIB_NODE_RUNTIME_DATA_SIZE
 ( (
vlib_node_ru¡ime_t
Ë- 
	`STRUCT_OFFSET_OF
 (vlib_node_ru¡ime_t, 
ru¡ime_d©a
))

	)

480 
u32
 
	mn_Æloc_‰ames
;

483 
u32
 *
	m‰ì_‰ame_ödi˚s
;

484 } 
	tvlib_‰ame_size_t
;

489 
uw‹d
 
	m›aque
;

490 } 
	tvlib_¥o˚ss_evít_ty≥_t
;

495 
vlib_node_ru¡ime_t
 
	mnode_ru¡ime
;

498 
˛ib_l⁄gjmp_t
 
	mªtu∫_l⁄gjmp
;

500 
	#VLIB_PROCESS_RETURN_LONGJMP_RETURN
 ((
uw‹d
Ë~0 - 0)

	)

501 
	#VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
 ((
uw‹d
Ë~0 - 1)

	)

504 
˛ib_l⁄gjmp_t
 
	mªsume_l⁄gjmp
;

505 
	#VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
 0

	)

506 
	#VLIB_PROCESS_RESUME_LONGJMP_RESUME
 1

	)

508 
u16
 
	mÊags
;

509 
	#VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
 (1 << 0)

	)

510 
	#VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
 (1 << 1)

	)

512 
	#VLIB_PROCESS_RESUME_PENDING
 (1 << 2)

	)

515 
	#VLIB_PROCESS_IS_RUNNING
 (1 << 3)

	)

518 
u16
 
	mlog2_n_°ack_byãs
;

520 
u32
 
	msu•íded_¥o˚ss_‰ame_ödex
;

523 
u32
 
	mn_su•íds
;

526 **
	m≥ndög_evít_d©a_by_ty≥_ödex
;

529 
uw‹d
 *
	mn⁄_em±y_evít_ty≥_bôm≠
;

532 
uw‹d
 *
	m⁄e_time_evít_ty≥_bôm≠
;

536 
uw‹d
 *
	mevít_ty≥_ödex_by_ty≥_›aque
;

539 
vlib_¥o˚ss_evít_ty≥_t
 *
	mevít_ty≥_poﬁ
;

545 
u64
 
	mªsume_˛ock_öãrvÆ
;

548 
u32
 
	m°›_timî_h™dÀ
;

552 
vlib_˛i_ouçut_fun˘i⁄_t
 *
	mouçut_fun˘i⁄
;

553 
uw‹d
 
	mouçut_fun˘i⁄_¨g
;

555 #ifde‡
CLIB_UNIX


557 
	#PAGE_SIZE_MULTIPLE
 0x1000

	)

558 
	#ALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT
 
	`__©åibuã__
 ((
	`Æig√d
 (
PAGE_SIZE_MULTIPLE
)))

	)

560 
	#ALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT


	)

566 
	#VLIB_PROCESS_STACK_MAGIC
 (0xdód7ód)

	)

567 
u32
 
	m°ack
[0] 
	mALIGN_ON_MULTIPLE_PAGE_BOUNDARY_FOR_MPROTECT
;

568 } 
	tvlib_¥o˚ss_t
 
	t__©åibuã__
 ((
	tÆig√d
 (
	tCLIB_CACHE_LINE_BYTES
)));

570 #ifde‡
CLIB_UNIX


573 
	tas£π_¥o˚ss_°ack_mu°_be_Æig√d_exa˘ly_to_∑ge_size_mu…ùÀ
[(

574 (
vlib_¥o˚ss_t
)

576 
PAGE_SIZE_MULTIPLE
)

584 
u32
 
	mnode_ödex
;

586 
u32
 
	m⁄e_time_evít
;

587 } 
	tvlib_⁄e_time_waôög_¥o˚ss_t
;

591 
u16
 
	mn_d©a_ñts
;

593 
u16
 
	mn_d©a_ñt_byãs
;

596 
u32
 
	mn_d©a_byãs
;

599 
u32
 
	m¥o˚ss_node_ödex
;

601 
u32
 
	mevít_ty≥_ödex
;

605 
u8
 
	mölöe_evít_d©a
[64 - 3 *  (
u32
Ë- 2 *  (
u16
)];

608 
u8
 *
	mevít_d©a_as_ve˘‹
;

611 
	tvlib_sig«l_timed_evít_d©a_t
;

613 
Æways_ölöe
 
uw‹d


614 
	$vlib_timög_whìl_d©a_is_timed_evít
 (
u32
 
d
)

616  
d
 & 1;

617 
	}
}

619 
Æways_ölöe
 
u32


620 
	$vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss
 (
u32
 
i
)

622  0 + 2 * 
i
;

623 
	}
}

625 
Æways_ölöe
 
u32


626 
	$vlib_timög_whìl_d©a_£t_timed_evít
 (
u32
 
i
)

628  1 + 2 * 
i
;

629 
	}
}

631 
Æways_ölöe
 
uw‹d


632 
	$vlib_timög_whìl_d©a_gë_ödex
 (
u32
 
d
)

634  
d
 / 2;

635 
	}
}

640 
vlib_node_t
 **
	mnodes
;

643 
uw‹d
 *
	mnode_by_«me
;

645 
u32
 
	mÊags
;

646 
	#VLIB_NODE_MAIN_RUNTIME_STARTED
 (1 << 0)

	)

650 
vlib_node_ru¡ime_t
 *
	mnodes_by_ty≥
[
VLIB_N_NODE_TYPE
];

653 
u32
 *
	m≥ndög_öãºu±_node_ru¡ime_ödi˚s
;

654 
˛ib_•ölock_t
 
	m≥ndög_öãºu±_lock
;

659 
u32
 
	mpﬁlög_thªshﬁd_ve˘‹_Àngth
;

660 
u32
 
	möãºu±_thªshﬁd_ve˘‹_Àngth
;

663 
vlib_√xt_‰ame_t
 *
	m√xt_‰ames
;

666 
vlib_≥ndög_‰ame_t
 *
	m≥ndög_‰ames
;

669 *
	mtimög_whìl
;

671 
vlib_sig«l_timed_evít_d©a_t
 *
	msig«l_timed_evít_d©a_poﬁ
;

674 
u32
 *
	md©a_‰om_adv™cög_timög_whìl
;

677 
f64
 
	mtime_√xt_¥o˚ss_ªady
;

681 
vlib_¥o˚ss_t
 **
	m¥o˚s£s
;

684 
u32
 
	mcuºít_¥o˚ss_ödex
;

687 
vlib_≥ndög_‰ame_t
 *
	msu•íded_¥o˚ss_‰ames
;

690 **
	mªcy˛ed_evít_d©a_ve˘‹s
;

693 
u32
 
	möput_node_cou¡s_by_°©e
[
VLIB_N_NODE_STATE
];

696 
uw‹d
 *
	m‰ame_size_hash
;

699 
vlib_‰ame_size_t
 *
	m‰ame_sizes
;

702 
f64
 
	mtime_œ°_ru¡ime_°©s_˛ór
;

705 
vlib_node_ªgi°øti⁄_t
 *
	mnode_ªgi°øti⁄s
;

706 } 
	tvlib_node_maö_t
;

709 
	#FRAME_QUEUE_MAX_NELTS
 32

	)

712 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

713 
u64
 
	mhód
;

714 
u64
 
	mhód_höt
;

715 
u64
 
	mèû
;

716 
u32
 
	mn_ö_u£
;

717 
u32
 
	m√…s
;

718 
u32
 
	mwrôãn
;

719 
u32
 
	mthªshﬁd
;

720 
i32
 
	mn_ve˘‹s
[
FRAME_QUEUE_MAX_NELTS
];

721 } 
	t‰ame_queue_åa˚_t
;

725 
u64
 
	mcou¡
[
FRAME_QUEUE_MAX_NELTS
];

726 } 
	t‰ame_queue_√…_cou¡î_t
;

	@/usr/include/vlib/node_funcs.h

45 #i‚de‡
ö˛uded_vlib_node_funcs_h


46 
	#ö˛uded_vlib_node_funcs_h


	)

48 
	~<vµö‰a/fifo.h
>

49 
	~<vµö‰a/tw_timî_1t_3w_1024¶_ov.h
>

58 
Æways_ölöe
 
vlib_node_t
 *

59 
	$vlib_gë_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
i
)

61  
	`vec_ñt
 (
vm
->
node_maö
.
nodes
, 
i
);

62 
	}
}

71 
Æways_ölöe
 
vlib_node_t
 *

72 
	$vlib_gë_√xt_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, u32 
√xt_ödex
)

74 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

75 
vlib_node_t
 *
n
;

77 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

78 
	`ASSERT
 (
√xt_ödex
 < 
	`vec_Àn
 (
n
->
√xt_nodes
));

79  
	`vlib_gë_node
 (
vm
, 
n
->
√xt_nodes
[
√xt_ödex
]);

80 
	}
}

88 
Æways_ölöe
 
vlib_node_ru¡ime_t
 *

89 
	$vlib_node_gë_ru¡ime
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

91 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

92 
vlib_node_t
 *
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

93 
vlib_¥o˚ss_t
 *
p
;

94 i‡(
n
->
ty≥
 !
VLIB_NODE_TYPE_PROCESS
)

95  
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

98 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

99  &
p
->
node_ru¡ime
;

101 
	}
}

109 
Æways_ölöe
 *

110 
	$vlib_node_gë_ru¡ime_d©a
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

112 
vlib_node_ru¡ime_t
 *
r
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

113  
r
->
ru¡ime_d©a
;

114 
	}
}

123 
Æways_ölöe
 

124 
	$vlib_node_£t_ru¡ime_d©a
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

125 *
ru¡ime_d©a
, 
u32
 
n_ru¡ime_d©a_byãs
)

127 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

128 
vlib_node_ru¡ime_t
 *
r
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

130 
n
->
ru¡ime_d©a_byãs
 = 
n_ru¡ime_d©a_byãs
;

131 
	`vec_‰ì
 (
n
->
ru¡ime_d©a
);

132 
	`vec_add
 (
n
->
ru¡ime_d©a
,Ñu¡ime_d©a, 
n_ru¡ime_d©a_byãs
);

134 
	`ASSERT
 (
	`vec_Àn
 (
n
->
ru¡ime_d©a
Ë< (
vlib_node_ru¡ime_t
) -

135 
	`STRUCT_OFFSET_OF
 (
vlib_node_ru¡ime_t
, 
ru¡ime_d©a
));

137 i‡(
	`vec_Àn
 (
n
->
ru¡ime_d©a
) > 0)

138 
	`˛ib_mem˝y
 (
r
->
ru¡ime_d©a
, 
n
->ru¡ime_d©a, 
	`vec_Àn
 (n->runtime_data));

139 
	}
}

146 
Æways_ölöe
 

147 
	$vlib_node_£t_°©e
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

148 
vlib_node_°©e_t
 
√w_°©e
)

150 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

151 
vlib_node_t
 *
n
;

152 
vlib_node_ru¡ime_t
 *
r
;

154 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

155 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
)

157 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

158 
r
 = &
p
->
node_ru¡ime
;

161 
p
->
Êags
 &~(
VLIB_PROCESS_RESUME_PENDING


162 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK


163 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
);

166 
r
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

168 
	`ASSERT
 (
√w_°©e
 < 
VLIB_N_NODE_STATE
);

170 i‡(
n
->
ty≥
 =
VLIB_NODE_TYPE_INPUT
)

172 
	`ASSERT
 (
nm
->
öput_node_cou¡s_by_°©e
[
n
->
°©e
] > 0);

173 
nm
->
öput_node_cou¡s_by_°©e
[
n
->
°©e
] -= 1;

174 
nm
->
öput_node_cou¡s_by_°©e
[
√w_°©e
] += 1;

177 
n
->
°©e
 = 
√w_°©e
;

178 
r
->
°©e
 = 
√w_°©e
;

179 
	}
}

186 
Æways_ölöe
 
vlib_node_°©e_t


187 
	$vlib_node_gë_°©e
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

189 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

190 
vlib_node_t
 *
n
;

191 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

192  
n
->
°©e
;

193 
	}
}

195 
Æways_ölöe
 

196 
	$vlib_node_£t_öãºu±_≥ndög
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

198 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

199 
vlib_node_t
 *
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

200 
	`ASSERT
 (
n
->
ty≥
 =
VLIB_NODE_TYPE_INPUT
);

201 
	`˛ib_•ölock_lock_if_öô
 (&
nm
->
≥ndög_öãºu±_lock
);

202 
	`vec_add1
 (
nm
->
≥ndög_öãºu±_node_ru¡ime_ödi˚s
, 
n
->
ru¡ime_ödex
);

203 
	`˛ib_•ölock_u∆ock_if_öô
 (&
nm
->
≥ndög_öãºu±_lock
);

204 
	}
}

206 
Æways_ölöe
 
vlib_¥o˚ss_t
 *

207 
	$vlib_gë_¥o˚ss_‰om_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
node
)

209 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

210 
	`ASSERT
 (
node
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
);

211  
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
node
->
ru¡ime_ödex
);

212 
	}
}

215 
Æways_ölöe
 
vlib_‰ame_t
 *

216 
	$vlib_gë_‰ame_no_check
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
‰ame_ödex
)

218 
vlib_‰ame_t
 *
f
;

219 
f
 = 
vm
->
hóp_ba£
 + (
‰ame_ödex
 * 
VLIB_FRAME_ALIGN
);

220  
f
;

221 
	}
}

223 
Æways_ölöe
 
u32


224 
	$vlib_‰ame_ödex_no_check
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_t
 * 
f
)

226 
uw‹d
 
i
;

228 
	`ASSERT
 (((
uw‹d
Ë
f
 & (
VLIB_FRAME_ALIGN
 - 1)) == 0);

230 
i
 = ((
u8
 *Ë
f
 - (u8 *Ë
vm
->
hóp_ba£
);

231 
	`ASSERT
 ((
i
 / 
VLIB_FRAME_ALIGN
) <= 0xFFFFFFFFULL);

233  
i
 / 
VLIB_FRAME_ALIGN
;

234 
	}
}

236 
Æways_ölöe
 
vlib_‰ame_t
 *

237 
	$vlib_gë_‰ame
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
‰ame_ödex
)

239 
vlib_‰ame_t
 *
f
 = 
	`vlib_gë_‰ame_no_check
 (
vm
, 
‰ame_ödex
);

240 
	`ASSERT
 (
f
->
Êags
 & 
VLIB_FRAME_IS_ALLOCATED
);

241  
f
;

242 
	}
}

244 
Æways_ölöe
 
u32


245 
	$vlib_‰ame_ödex
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_t
 * 
f
)

247 
uw‹d
 
i
 = 
	`vlib_‰ame_ödex_no_check
 (
vm
, 
f
);

248 
	`ASSERT
 (
	`vlib_gë_‰ame
 (
vm
, 
i
Ë=
f
);

249  
i
;

250 
	}
}

253 
	#VLIB_FRAME_VECTOR_ALIGN
 (1 << 4)

	)

255 
Æways_ölöe
 
u32


256 
	$vlib_‰ame_ve˘‹_byã_off£t
 (
u32
 
sˇœr_size
)

258  
	`round_pow2
 ( (
vlib_‰ame_t
Ë+ 
sˇœr_size
,

259 
VLIB_FRAME_VECTOR_ALIGN
);

260 
	}
}

266 
Æways_ölöe
 *

267 
	$vlib_‰ame_ve˘‹_¨gs
 (
vlib_‰ame_t
 * 
f
)

269  (*Ë
f
 + 
	`vlib_‰ame_ve˘‹_byã_off£t
 (f->
sˇœr_size
);

270 
	}
}

283 
Æways_ölöe
 *

284 
	$vlib_‰ame_¨gs
 (
vlib_‰ame_t
 * 
f
)

286  
	`vlib_‰ame_ve˘‹_¨gs
 (
f
Ë- f->
sˇœr_size
;

287 
	}
}

289 
Æways_ölöe
 
vlib_√xt_‰ame_t
 *

290 
	$vlib_node_ru¡ime_gë_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

291 
vlib_node_ru¡ime_t
 * 
n
, 
u32
 
√xt_ödex
)

293 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

294 
vlib_√xt_‰ame_t
 *
nf
;

296 
	`ASSERT
 (
√xt_ödex
 < 
n
->
n_√xt_nodes
);

297 
nf
 = 
	`vec_ñt_©_ödex
 (
nm
->
√xt_‰ames
, 
n
->
√xt_‰ame_ödex
 + 
√xt_ödex
);

299 i‡(
CLIB_DEBUG
 > 0)

301 
vlib_node_t
 *
node
, *
√xt
;

302 
node
 = 
	`vec_ñt
 (
nm
->
nodes
, 
n
->
node_ödex
);

303 
√xt
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node
->
√xt_nodes
[
√xt_ödex
]);

304 
	`ASSERT
 (
nf
->
node_ru¡ime_ödex
 =
√xt
->
ru¡ime_ödex
);

307  
nf
;

308 
	}
}

324 
Æways_ölöe
 
vlib_√xt_‰ame_t
 *

325 
	$vlib_node_gë_√xt_‰ame
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, u32 
√xt_ödex
)

327 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

328 
vlib_node_t
 *
n
;

329 
vlib_node_ru¡ime_t
 *
r
;

331 
n
 = 
	`vec_ñt
 (
nm
->
nodes
, 
node_ödex
);

332 
r
 = 
	`vec_ñt_©_ödex
 (
nm
->
nodes_by_ty≥
[
n
->
ty≥
],Ç->
ru¡ime_ödex
);

333  
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

334 
	}
}

336 
vlib_‰ame_t
 *
vlib_gë_√xt_‰ame_öã∫Æ
 (
vlib_maö_t
 * 
vm
,

337 
vlib_node_ru¡ime_t
 * 
node
,

338 
u32
 
√xt_ödex
,

339 
u32
 
Æloc_√w_‰ame
);

341 
	#vlib_gë_√xt_‰ame_ma¸o
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
,
Æloc_√w_‰ame
) \

343 
vlib_‰ame_t
 * 
_f
 \

344 
	`vlib_gë_√xt_‰ame_öã∫Æ
 ((
vm
), (
node
), (
√xt_ödex
), \

345 (
Æloc_√w_‰ame
)); \

346 
u32
 
_n
 = 
_f
->
n_ve˘‹s
; \

347 (
ve˘‹s
Ë
	`vlib_‰ame_ve˘‹_¨gs
 (
_f
Ë+ 
_n
 *  ((vectors)[0]); \

348 (
n_ve˘‹s_À·
Ë
VLIB_FRAME_SIZE
 - 
_n
; \

349 } 0)

	)

364 
	#vlib_gë_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
) \

365 
	`vlib_gë_√xt_‰ame_ma¸o
 (
vm
, 
node
, 
√xt_ödex
, \

366 
ve˘‹s
, 
n_ve˘‹s_À·
, \

367  0)

	)

369 
	#vlib_gë_√w_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
ve˘‹s
,
n_ve˘‹s_À·
) \

370 
	`vlib_gë_√xt_‰ame_ma¸o
 (
vm
, 
node
, 
√xt_ödex
, \

371 
ve˘‹s
, 
n_ve˘‹s_À·
, \

372  1)

	)

382 
vlib_put_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

383 
vlib_node_ru¡ime_t
 * 
r
,

384 
u32
 
√xt_ödex
, u32 
n_∑ckës_À·
);

387 
	#vlib_£t_√xt_‰ame
(
vm
,
node
,
√xt_ödex
,
v
) \

389 
uw‹d
 
_n_À·
; \

390 
	`vlib_gë_√xt_‰ame
 ((
vm
), (
node
), (
√xt_ödex
), (
v
), 
_n_À·
); \

391 
	`ASSERT
 (
_n_À·
 > 0); \

392 
	`vlib_put_√xt_‰ame
 ((
vm
), (
node
), (
√xt_ödex
), 
_n_À·
 - 1); \

393 (
v
); \

394 })

	)

396 
Æways_ölöe
 

397 
	$vlib_£t_√xt_‰ame_buf„r
 (
vlib_maö_t
 * 
vm
,

398 
vlib_node_ru¡ime_t
 * 
node
,

399 
u32
 
√xt_ödex
, u32 
buf„r_ödex
)

401 
u32
 *
p
;

402 
p
 = 
	`vlib_£t_√xt_‰ame
 (
vm
, 
node
, 
√xt_ödex
,Ö);

403 
p
[0] = 
buf„r_ödex
;

404 
	}
}

406 
vlib_‰ame_t
 *
vlib_gë_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
);

407 
vlib_put_‰ame_to_node
 (
vlib_maö_t
 * 
vm
, 
u32
 
to_node_ödex
,

408 
vlib_‰ame_t
 * 
f
);

410 
Æways_ölöe
 
uw‹d


411 
	$vlib_ö_¥o˚ss_c⁄ãxt
 (
vlib_maö_t
 * 
vm
)

413  
vm
->
node_maö
.
cuºít_¥o˚ss_ödex
 != ~0;

414 
	}
}

416 
Æways_ölöe
 
vlib_¥o˚ss_t
 *

417 
	$vlib_gë_cuºít_¥o˚ss
 (
vlib_maö_t
 * 
vm
)

419 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

420 i‡(
	`vlib_ö_¥o˚ss_c⁄ãxt
 (
vm
))

421  
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

423 
	}
}

425 
Æways_ölöe
 
uw‹d


426 
	$vlib_cuºít_¥o˚ss
 (
vlib_maö_t
 * 
vm
)

428  
	`vlib_gë_cuºít_¥o˚ss
 (
vm
)->
node_ru¡ime
.
node_ödex
;

429 
	}
}

435 
Æways_ölöe
 
uw‹d


436 
	$vlib_¥o˚ss_su•íd_time_is_zîo
 (
f64
 
dt
)

438  
dt
 < 10e-6;

439 
	}
}

447 
Æways_ölöe
 
uw‹d


448 
	$vlib_¥o˚ss_su•íd
 (
vlib_maö_t
 * 
vm
, 
f64
 
dt
)

450 
uw‹d
 
r
;

451 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

452 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

454 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
))

455  
VLIB_PROCESS_RESUME_LONGJMP_RESUME
;

457 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
;

458 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

459 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

462 
p
->
ªsume_˛ock_öãrvÆ
 = 
dt
 * 1e5;

463 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

466  
r
;

467 
	}
}

469 
Æways_ölöe
 

470 
	$vlib_¥o˚ss_‰ì_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
,

471 
uw‹d
 
is_⁄e_time_evít
)

473 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

474 
	`poﬁ_put_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

475 i‡(
is_⁄e_time_evít
)

476 
p
->
⁄e_time_evít_ty≥_bôm≠
 =

477 
	`˛ib_bôm≠_™dnŸi
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
);

478 
	}
}

480 
Æways_ölöe
 

481 
	$vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
)

483 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

484 i‡(
	`˛ib_bôm≠_gë
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
))

485 
	`vlib_¥o˚ss_‰ì_evít_ty≥
 (
p
, 
t
, 1);

486 
	}
}

488 
Æways_ölöe
 *

489 
	$vlib_¥o˚ss_gë_evít_d©a
 (
vlib_maö_t
 * 
vm
,

490 
uw‹d
 * 
ªtu∫_evít_ty≥_›aque
)

492 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

493 
vlib_¥o˚ss_t
 *
p
;

494 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

495 
uw‹d
 
t
;

496 *
evít_d©a_ve˘‹
;

498 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

502 
t
 = 
	`˛ib_bôm≠_fú°_£t
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
);

503 i‡(
t
 == ~0)

506 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

507 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

509 
	`ASSERT
 (
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) > 0);

510 
evít_d©a_ve˘‹
 = 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
];

511 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
] = 0;

513 
ë
 = 
	`poﬁ_ñt_©_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

516 *
ªtu∫_evít_ty≥_›aque
 = 
ë
->
›aque
;

518 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

520  
evít_d©a_ve˘‹
;

521 
	}
}

525 
Æways_ölöe
 

526 
	$vlib_¥o˚ss_put_evít_d©a
 (
vlib_maö_t
 * 
vm
, *
evít_d©a
)

528 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

529 
	`vec_add1
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
, 
evít_d©a
);

530 
	}
}

541 
Æways_ölöe
 
uw‹d


542 
	$vlib_¥o˚ss_gë_evíts
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 ** 
d©a_ve˘‹
)

544 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

545 
vlib_¥o˚ss_t
 *
p
;

546 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

547 
uw‹d
 
r
, 
t
, 
l
;

549 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

553 
t
 = 
	`˛ib_bôm≠_fú°_£t
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
);

554 i‡(
t
 == ~0)

555  
t
;

557 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

558 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

560 
l
 = 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]);

561 i‡(
d©a_ve˘‹
)

562 
	`vec_add
 (*
d©a_ve˘‹
, 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
], 
l
);

563 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) = 0;

565 
ë
 = 
	`poﬁ_ñt_©_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
);

568 
r
 = 
ë
->
›aque
;

570 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

572  
r
;

573 
	}
}

575 
Æways_ölöe
 
uw‹d


576 
	$vlib_¥o˚ss_gë_evíts_hñ≥r
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
t
,

577 
uw‹d
 ** 
d©a_ve˘‹
)

579 
uw‹d
 
l
;

581 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

582 
	`˛ib_bôm≠_™dnŸi
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

584 
l
 = 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]);

585 i‡(
d©a_ve˘‹
)

586 
	`vec_add
 (*
d©a_ve˘‹
, 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
], 
l
);

587 
	`_vec_Àn
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
]) = 0;

589 
	`vlib_¥o˚ss_maybe_‰ì_evít_ty≥
 (
p
, 
t
);

591  
l
;

592 
	}
}

596 
Æways_ölöe
 
uw‹d


597 
	$vlib_¥o˚ss_gë_evíts_wôh_ty≥
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 ** 
d©a_ve˘‹
,

598 
uw‹d
 
wôh_ty≥_›aque
)

600 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

601 
vlib_¥o˚ss_t
 *
p
;

602 
uw‹d
 
t
, *
h
;

604 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

605 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

606 i‡(!
h
)

611 
t
 = 
h
[0];

612 i‡(!
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
))

615  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
t
, 
d©a_ve˘‹
);

616 
	}
}

618 
Æways_ölöe
 
uw‹d
 *

619 
	$vlib_¥o˚ss_waô_f‹_evít
 (
vlib_maö_t
 * 
vm
)

621 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

622 
vlib_¥o˚ss_t
 *
p
;

623 
uw‹d
 
r
;

625 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

626 i‡(
	`˛ib_bôm≠_is_zîo
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
))

628 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

629 
r
 =

630 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

631 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

632 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

633 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

636  
p
->
n⁄_em±y_evít_ty≥_bôm≠
;

637 
	}
}

639 
Æways_ölöe
 
uw‹d


640 
	$vlib_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

641 
uw‹d
 ** 
d©a_ve˘‹
,

642 
uw‹d
 
wôh_ty≥_ödex
)

644 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

645 
vlib_¥o˚ss_t
 *
p
;

646 
uw‹d
 
r
;

648 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

649 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
wôh_ty≥_ödex
));

650 !
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
wôh_ty≥_ödex
))

652 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

653 
r
 =

654 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

655 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

656 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

657 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

660  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
wôh_ty≥_ödex
, 
d©a_ve˘‹
);

661 
	}
}

663 
Æways_ölöe
 
uw‹d


664 
	$vlib_¥o˚ss_waô_f‹_evít_wôh_ty≥
 (
vlib_maö_t
 * 
vm
,

665 
uw‹d
 ** 
d©a_ve˘‹
,

666 
uw‹d
 
wôh_ty≥_›aque
)

668 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

669 
vlib_¥o˚ss_t
 *
p
;

670 
uw‹d
 
r
, *
h
;

672 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

673 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

674 !
h
 || !
	`˛ib_bôm≠_gë
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, h[0]))

676 
p
->
Êags
 |
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
;

677 
r
 =

678 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

679 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

680 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
,

681 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

684 i‡(!
h
)

685 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
wôh_ty≥_›aque
);

688  
	`vlib_¥o˚ss_gë_evíts_hñ≥r
 (
p
, 
h
[0], 
d©a_ve˘‹
);

689 
	}
}

698 
Æways_ölöe
 
f64


699 
	$vlib_¥o˚ss_waô_f‹_evít_‹_˛ock
 (
vlib_maö_t
 * 
vm
, 
f64
 
dt
)

701 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

702 
vlib_¥o˚ss_t
 *
p
;

703 
f64
 
wakeup_time
;

704 
uw‹d
 
r
;

706 
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
,Çm->
cuºít_¥o˚ss_ödex
);

708 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
)

709 || !
	`˛ib_bôm≠_is_zîo
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
))

710  
dt
;

712 
wakeup_time
 = 
	`vlib_time_now
 (
vm
Ë+ 
dt
;

715 
p
->
Êags
 |(
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT


716 | 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
);

718 
r
 = 
	`˛ib_£tjmp
 (&
p
->
ªsume_l⁄gjmp
, 
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
);

719 i‡(
r
 =
VLIB_PROCESS_RESUME_LONGJMP_SUSPEND
)

721 
p
->
ªsume_˛ock_öãrvÆ
 = 
dt
 * 1e5;

722 
	`˛ib_l⁄gjmp
 (&
p
->
ªtu∫_l⁄gjmp
, 
VLIB_PROCESS_RETURN_LONGJMP_SUSPEND
);

727  
wakeup_time
 - 
	`vlib_time_now
 (
vm
);

728 
	}
}

730 
Æways_ölöe
 
vlib_¥o˚ss_evít_ty≥_t
 *

731 
	$vlib_¥o˚ss_√w_evít_ty≥
 (
vlib_¥o˚ss_t
 * 
p
, 
uw‹d
 
wôh_ty≥_›aque
)

733 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

734 
	`poﬁ_gë
 (
p
->
evít_ty≥_poﬁ
, 
ë
);

735 
ë
->
›aque
 = 
wôh_ty≥_›aque
;

736  
ë
;

737 
	}
}

739 
Æways_ölöe
 
uw‹d


740 
	$vlib_¥o˚ss_¸óã_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

741 
uw‹d
 
wôh_ty≥_›aque
)

743 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

744 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

745 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

746 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
;

747 
uw‹d
 
t
;

749 
ë
 = 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
wôh_ty≥_›aque
);

750 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

751 
p
->
⁄e_time_evít_ty≥_bôm≠
 =

752 
	`˛ib_bôm≠_‹i
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
);

753  
t
;

754 
	}
}

756 
Æways_ölöe
 

757 
	$vlib_¥o˚ss_dñëe_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node_ödex
,

758 
uw‹d
 
t
)

760 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

761 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

762 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

764 
	`ASSERT
 (
	`˛ib_bôm≠_gë
 (
p
->
⁄e_time_evít_ty≥_bôm≠
, 
t
));

765 
	`vlib_¥o˚ss_‰ì_evít_ty≥
 (
p
, 
t
, 1);

766 
	}
}

768 
Æways_ölöe
 *

769 
	$vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
vlib_node_maö_t
 * 
nm
,

770 
vlib_node_t
 * 
n
,

771 
vlib_¥o˚ss_t
 * 
p
,

772 
uw‹d
 
t
,

773 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

775 
uw‹d
 
p_Êags
, 
add_to_≥ndög
, 
dñëe_‰om_whìl
;

776 *
d©a_to_be_wrôãn_by_ˇŒî
;

778 
	`ASSERT
 (
n
->
ty≥
 =
VLIB_NODE_TYPE_PROCESS
);

780 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
p
->
evít_ty≥_poﬁ
, 
t
));

782 
	`vec_vÆid©e
 (
p
->
≥ndög_evít_d©a_by_ty≥_ödex
, 
t
);

786 *
d©a_vec
 = 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
];

787 
uw‹d
 
l
;

789 i‡(!
d©a_vec
 && 
	`vec_Àn
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
))

791 
d©a_vec
 = 
	`vec_p›
 (
nm
->
ªcy˛ed_evít_d©a_ve˘‹s
);

792 
	`_vec_Àn
 (
d©a_vec
) = 0;

795 
l
 = 
	`vec_Àn
 (
d©a_vec
);

797 
d©a_vec
 = 
	`_vec_ªsize
 (data_vec,

798  
n_d©a_ñts
,

800 (
l
 + 
n_d©a_ñts
Ë* 
n_d©a_ñt_byãs
,

803 
p
->
≥ndög_evít_d©a_by_ty≥_ödex
[
t
] = 
d©a_vec
;

804 
d©a_to_be_wrôãn_by_ˇŒî
 = 
d©a_vec
 + 
l
 * 
n_d©a_ñt_byãs
;

807 
p
->
n⁄_em±y_evít_ty≥_bôm≠
 =

808 
	`˛ib_bôm≠_‹i
 (
p
->
n⁄_em±y_evít_ty≥_bôm≠
, 
t
);

810 
p_Êags
 = 
p
->
Êags
;

813 
add_to_≥ndög
 = (
p_Êags
 & 
VLIB_PROCESS_RESUME_PENDING
) == 0;

816 
dñëe_‰om_whìl
 = 0;

817 i‡(
p_Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_CLOCK
)

820 i‡(
p_Êags
 & 
VLIB_PROCESS_IS_SUSPENDED_WAITING_FOR_EVENT
)

821 
dñëe_‰om_whìl
 = 1;

825 
add_to_≥ndög
 = 0;

830 
add_to_≥ndög
 &
nm
->
cuºít_¥o˚ss_ödex
 !
n
->
ru¡ime_ödex
;

832 i‡(
add_to_≥ndög
)

834 
u32
 
x
 = 
	`vlib_timög_whìl_d©a_£t_su•íded_¥o˚ss
 (
n
->
ru¡ime_ödex
);

835 
p
->
Êags
 = 
p_Êags
 | 
VLIB_PROCESS_RESUME_PENDING
;

836 
	`vec_add1
 (
nm
->
d©a_‰om_adv™cög_timög_whìl
, 
x
);

837 i‡(
dñëe_‰om_whìl
)

838 
	`TW
 (
tw_timî_°›
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

839 
p
->
°›_timî_h™dÀ
);

842  
d©a_to_be_wrôãn_by_ˇŒî
;

843 
	}
}

845 
Æways_ölöe
 *

846 
	$vlib_¥o˚ss_sig«l_evít_d©a
 (
vlib_maö_t
 * 
vm
,

847 
uw‹d
 
node_ödex
,

848 
uw‹d
 
ty≥_›aque
,

849 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

851 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

852 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

853 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

854 
uw‹d
 *
h
, 
t
;

857 
	`ASSERT
 (
	`vlib_gë_thªad_ödex
 () == 0);

859 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
);

860 i‡(!
h
)

862 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
 =

863 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
ty≥_›aque
);

864 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

865 
	`hash_£t
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
, 
t
);

868 
t
 = 
h
[0];

870  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
t
, 
n_d©a_ñts
,

871 
n_d©a_ñt_byãs
);

872 
	}
}

874 
Æways_ölöe
 *

875 
	$vlib_¥o˚ss_sig«l_evít_©_time
 (
vlib_maö_t
 * 
vm
,

876 
f64
 
dt
,

877 
uw‹d
 
node_ödex
,

878 
uw‹d
 
ty≥_›aque
,

879 
uw‹d
 
n_d©a_ñts
, uw‹d 
n_d©a_ñt_byãs
)

881 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

882 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

883 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

884 
uw‹d
 *
h
, 
t
;

886 
h
 = 
	`hash_gë
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
);

887 i‡(!
h
)

889 
vlib_¥o˚ss_evít_ty≥_t
 *
ë
 =

890 
	`vlib_¥o˚ss_√w_evít_ty≥
 (
p
, 
ty≥_›aque
);

891 
t
 = 
ë
 - 
p
->
evít_ty≥_poﬁ
;

892 
	`hash_£t
 (
p
->
evít_ty≥_ödex_by_ty≥_›aque
, 
ty≥_›aque
, 
t
);

895 
t
 = 
h
[0];

897 i‡(
	`vlib_¥o˚ss_su•íd_time_is_zîo
 (
dt
))

898  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
t
, 
n_d©a_ñts
,

899 
n_d©a_ñt_byãs
);

902 
vlib_sig«l_timed_evít_d©a_t
 *
ã
;

904 
	`poﬁ_gë_Æig√d
 (
nm
->
sig«l_timed_evít_d©a_poﬁ
, 
ã
,  (te[0]));

906 
ã
->
n_d©a_ñts
 =Ç_data_elts;

907 
ã
->
n_d©a_ñt_byãs
 =Ç_data_elt_bytes;

908 
ã
->
n_d©a_byãs
 = 
n_d©a_ñts
 * 
n_d©a_ñt_byãs
;

911 
	`ASSERT
 (
ã
->
n_d©a_ñts
 ==Ç_data_elts);

912 
	`ASSERT
 (
ã
->
n_d©a_ñt_byãs
 ==Ç_data_elt_bytes);

913 
	`ASSERT
 (
ã
->
n_d©a_byãs
 =
n_d©a_ñts
 * 
n_d©a_ñt_byãs
);

915 
ã
->
¥o˚ss_node_ödex
 = 
n
->
ru¡ime_ödex
;

916 
ã
->
evít_ty≥_ödex
 = 
t
;

918 
p
->
°›_timî_h™dÀ
 =

919 
	`TW
 (
tw_timî_°¨t
Ë((
	`TWT
 (
tw_timî_whìl
Ë*Ë
nm
->
timög_whìl
,

920 
vlib_timög_whìl_d©a_£t_timed_evít


921 (
ã
 - 
nm
->
sig«l_timed_evít_d©a_poﬁ
),

923 (
	`vlib_time_now
 (
vm
Ë+ 
dt
) * 1e5);

926 i‡(
ã
->
n_d©a_byãs
 <  (ã->
ölöe_evít_d©a
))

927  
ã
->
ölöe_evít_d©a
;

930 
ã
->
evít_d©a_as_ve˘‹
 = 0;

931 
	`vec_ªsize
 (
ã
->
evít_d©a_as_ve˘‹
,Åe->
n_d©a_byãs
);

932  
ã
->
evít_d©a_as_ve˘‹
;

935 
	}
}

937 
Æways_ölöe
 *

938 
	$vlib_¥o˚ss_sig«l_⁄e_time_evít_d©a
 (
vlib_maö_t
 * 
vm
,

939 
uw‹d
 
node_ödex
,

940 
uw‹d
 
ty≥_ödex
,

941 
uw‹d
 
n_d©a_ñts
,

942 
uw‹d
 
n_d©a_ñt_byãs
)

944 
vlib_node_maö_t
 *
nm
 = &
vm
->
node_maö
;

945 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

946 
vlib_¥o˚ss_t
 *
p
 = 
	`vec_ñt
 (
nm
->
¥o˚s£s
, 
n
->
ru¡ime_ödex
);

947  
	`vlib_¥o˚ss_sig«l_evít_hñ≥r
 (
nm
, 
n
, 
p
, 
ty≥_ödex
, 
n_d©a_ñts
,

948 
n_d©a_ñt_byãs
);

949 
	}
}

951 
Æways_ölöe
 

952 
	$vlib_¥o˚ss_sig«l_evít
 (
vlib_maö_t
 * 
vm
,

953 
uw‹d
 
node_ödex
, uw‹d 
ty≥_›aque
, uw‹d 
d©a
)

955 
uw‹d
 *
d
 = 
	`vlib_¥o˚ss_sig«l_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_›aque
,

956 1 ,  (
uw‹d
));

957 
d
[0] = 
d©a
;

958 
	}
}

960 
Æways_ölöe
 

961 
	$vlib_¥o˚ss_sig«l_evít_poöãr
 (
vlib_maö_t
 * 
vm
,

962 
uw‹d
 
node_ödex
,

963 
uw‹d
 
ty≥_›aque
, *
d©a
)

965 **
d
 = 
	`vlib_¥o˚ss_sig«l_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_›aque
,

966 1 ,  (
d©a
));

967 
d
[0] = 
d©a
;

968 
	}
}

975 
Æways_ölöe
 

976 
	$vlib_¥o˚ss_sig«l_evít_mt
 (
vlib_maö_t
 * 
vm
,

977 
uw‹d
 
node_ödex
, uw‹d 
ty≥_›aque
, uw‹d 
d©a
)

979 i‡(
	`vlib_gë_thªad_ödex
 () != 0)

981 
vlib_¥o˚ss_sig«l_evít_mt_¨gs_t
 
¨gs
 = {

982 .
node_ödex
 =Çode_index,

983 .
ty≥_›aque
 =Åype_opaque,

984 .
d©a
 = data,

986 
	`vlib_Ωc_ˇŒ_maö_thªad
 (
vlib_¥o˚ss_sig«l_evít_mt_hñ≥r
,

987 (
u8
 *Ë& 
¨gs
,  (args));

990 
	`vlib_¥o˚ss_sig«l_evít
 (
vm
, 
node_ödex
, 
ty≥_›aque
, 
d©a
);

991 
	}
}

993 
Æways_ölöe
 

994 
	$vlib_¥o˚ss_sig«l_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

995 
uw‹d
 
node_ödex
,

996 
uw‹d
 
ty≥_ödex
, uw‹d 
d©a
)

998 
uw‹d
 *
d
 =

999 
	`vlib_¥o˚ss_sig«l_⁄e_time_evít_d©a
 (
vm
, 
node_ödex
, 
ty≥_ödex
,

1000 1 ,  (
uw‹d
));

1001 
d
[0] = 
d©a
;

1002 
	}
}

1004 
Æways_ölöe
 

1005 
	$vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vlib_maö_t
 * 
vm
,

1006 
vlib_⁄e_time_waôög_¥o˚ss_t
 * 
p
)

1008 
	`vlib_¥o˚ss_sig«l_⁄e_time_evít
 (
vm
, 
p
->
node_ödex
,Ö->
⁄e_time_evít
,

1010 
	`mem£t
 (
p
, ~0,  (p[0]));

1011 
	}
}

1013 
Æways_ölöe
 

1014 
	$vlib_sig«l_⁄e_time_waôög_¥o˚ss_ve˘‹
 (
vlib_maö_t
 * 
vm
,

1015 
vlib_⁄e_time_waôög_¥o˚ss_t


1016 ** 
wps
)

1018 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
;

1019 
	`vec_f‹óch
 (
wp
, *
wps
Ë
	`vlib_sig«l_⁄e_time_waôög_¥o˚ss
 (
vm
, wp);

1020 
	`vec_‰ì
 (*
wps
);

1021 
	}
}

1023 
Æways_ölöe
 

1024 
	$vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vlib_maö_t
 * 
vm
,

1025 
vlib_⁄e_time_waôög_¥o˚ss_t


1026 * 
p
)

1028 
p
->
node_ödex
 = 
	`vlib_cuºít_¥o˚ss
 (
vm
);

1029 
p
->
⁄e_time_evít
 = 
	`vlib_¥o˚ss_¸óã_⁄e_time_evít
 (
vm
,Ö->
node_ödex
,

1031 
	`vlib_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
,

1033 
p
->
⁄e_time_evít
);

1034 
	}
}

1036 
Æways_ölöe
 

1037 
	$vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít_ve˘‹
 (
vlib_maö_t
 * 
vm
,

1038 
vlib_⁄e_time_waôög_¥o˚ss_t


1039 ** 
wps
)

1041 
vlib_⁄e_time_waôög_¥o˚ss_t
 *
wp
;

1042 
	`vec_add2
 (*
wps
, 
wp
, 1);

1043 
	`vlib_cuºít_¥o˚ss_waô_f‹_⁄e_time_evít
 (
vm
, 
wp
);

1044 
	}
}

1046 
Æways_ölöe
 
u32


1047 
	$vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vlib_maö_t
 * 
vm
,

1048 
vlib_node_ru¡ime_t
 * 
node
,

1049 
uw‹d
 
n_ve˘‹s
)

1051 
u32
 
i
, 
d
, 
vi0
, 
vi1
;

1052 
u32
 
i0
, 
i1
;

1054 
	`ASSERT
 (
	`is_pow2
 (
	`ARRAY_LEN
 (
node
->
maö_lo›_ve˘‹_°©s
)));

1055 
i
 = ((
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)

1056 & (
	`ARRAY_LEN
 (
node
->
maö_lo›_ve˘‹_°©s
) - 1));

1057 
i0
 = 
i
 ^ 0;

1058 
i1
 = 
i
 ^ 1;

1059 
d
 = ((
vm
->
maö_lo›_cou¡
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
)

1061 (
node
->
maö_lo›_cou¡_œ°_di•©ch
 >>

1062 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
));

1063 
vi0
 = 
node
->
maö_lo›_ve˘‹_°©s
[
i0
];

1064 
vi1
 = 
node
->
maö_lo›_ve˘‹_°©s
[
i1
];

1065 
vi0
 = 
d
 == 0 ? vi0 : 0;

1066 
vi1
 = 
d
 <= 1 ? vi1 : 0;

1067 
vi0
 +
n_ve˘‹s
;

1068 
node
->
maö_lo›_ve˘‹_°©s
[
i0
] = 
vi0
;

1069 
node
->
maö_lo›_ve˘‹_°©s
[
i1
] = 
vi1
;

1070 
node
->
maö_lo›_cou¡_œ°_di•©ch
 = 
vm
->
maö_lo›_cou¡
;

1072  
node
->
maö_lo›_ve˘‹_°©s
[
i1
];

1073 
	}
}

1075 
Æways_ölöe
 
f64


1076 
	$vlib_node_ve˘‹s_≥r_maö_lo›_as_Êﬂt
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

1078 
vlib_node_ru¡ime_t
 *
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

1079 
u32
 
v
;

1081 
v
 = 
	`vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vm
, 
π
,

1083  (
f64
Ë
v
 / (1 << 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
);

1084 
	}
}

1086 
Æways_ölöe
 
u32


1087 
	$vlib_node_ve˘‹s_≥r_maö_lo›_as_öãgî
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
)

1089 
vlib_node_ru¡ime_t
 *
π
 = 
	`vlib_node_gë_ru¡ime
 (
vm
, 
node_ödex
);

1090 
u32
 
v
;

1092 
v
 = 
	`vlib_node_ru¡ime_upd©e_maö_lo›_ve˘‹_°©s
 (
vm
, 
π
,

1094  
v
 >> 
VLIB_LOG2_MAIN_LOOPS_PER_STATS_UPDATE
;

1095 
	}
}

1098 
vlib_‰ame_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
r
, 
vlib_‰ame_t
 * 
f
);

1101 
uw‹d
 
vlib_node_gë_√xt
 (
vlib_maö_t
 * 
vm
, uw‹d 
node
, uw‹d 
√xt_node
);

1104 
uw‹d


1105 
vlib_node_add_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

1106 
uw‹d
 
node
, uw‹d 
√xt_node
, uw‹d 
¶Ÿ
);

1109 
Æways_ölöe
 
uw‹d


1110 
	$vlib_node_add_√xt
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node
, uw‹d 
√xt_node
)

1112  
	`vlib_node_add_√xt_wôh_¶Ÿ
 (
vm
, 
node
, 
√xt_node
, ~0);

1113 
	}
}

1116 
uw‹d


1117 
vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vlib_maö_t
 * 
vm
,

1118 
uw‹d
 
node
, *
√xt_«me
, uw‹d 
¶Ÿ
);

1121 
Æways_ölöe
 
uw‹d


1122 
	$vlib_node_add_«med_√xt
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
node
, *
«me
)

1124  
	`vlib_node_add_«med_√xt_wôh_¶Ÿ
 (
vm
, 
node
, 
«me
, ~0);

1125 
	}
}

1130 
vlib_node_t
 ***
vlib_node_gë_nodes
 (
vlib_maö_t
 * 
vm
, 
u32
 
max_thªads
,

1131 
ö˛ude_°©s
);

1134 
vlib_node_t
 *
vlib_gë_node_by_«me
 (
vlib_maö_t
 * 
vm
, 
u8
 * 
«me
);

1137 
vlib_node_ª«me
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
, *
fmt
, ...);

1142 
u32
 
vlib_ªgi°î_node
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ªgi°øti⁄_t
 * 
r
);

1145 
vlib_ªgi°î_Æl_°©ic_nodes
 (
vlib_maö_t
 * 
vm
);

1148 
vlib_°¨t_¥o˚ss
 (
vlib_maö_t
 * 
vm
, 
uw‹d
 
¥o˚ss_ödex
);

1151 
vlib_node_sync_°©s
 (
vlib_maö_t
 * 
vm
, 
vlib_node_t
 * 
n
);

1154 
˛ib_îr‹_t
 *
vlib_node_maö_öô
 (
vlib_maö_t
 * 
vm
);

1156 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_gøph
;

1157 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_«me
;

1158 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_√xt_node_«me
;

1159 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_node_™d_√xt
;

1160 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_˝u_time
;

1161 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_time
;

1163 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_vlib_node
;

1165 
Æways_ölöe
 

1166 
	$vlib_node_ö¸emít_cou¡î
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ödex
,

1167 
u32
 
cou¡î_ödex
, 
u64
 
ö¸emít
)

1169 
vlib_node_t
 *
n
 = 
	`vlib_gë_node
 (
vm
, 
node_ödex
);

1170 
vlib_îr‹_maö_t
 *
em
 = &
vm
->
îr‹_maö
;

1171 
u32
 
node_cou¡î_ba£_ödex
 = 
n
->
îr‹_hóp_ödex
;

1172 
em
->
cou¡îs
[
node_cou¡î_ba£_ödex
 + 
cou¡î_ödex
] +
ö¸emít
;

1173 
	}
}

	@/usr/include/vlib/pci/pci.h

40 #i‚de‡
ö˛uded_vlib_pci_h


41 
	#ö˛uded_vlib_pci_h


	)

43 
	~<vlib/vlib.h
>

44 
	~<vlib/pci/pci_c⁄fig.h
>

47 
CLIB_PACKED
 (union

51 
u16
 
domaö
;

52 
u8
 
bus
;

53 
u8
 
¶Ÿ
: 5;

54 
u8
 
fun˘i⁄
:3;

56 
u32
 
as_u32
;

57 }Ë
	tvlib_pci_addr_t
;

60 
	svlib_pci_devi˚_öfo


63 
vlib_pci_addr_t
 
	maddr
;

66 
	mnuma_node
;

69 
u16
 
	mdevi˚_˛ass
;

70 
u16
 
	mvíd‹_id
;

71 
u16
 
	mdevi˚_id
;

74 
u8
 *
	m¥odu˘_«me
;

75 
u8
 *
	mvpd_r
;

76 
u8
 *
	mvpd_w
;

79 
u8
 *
	mdrivî_«me
;

84 
pci_c⁄fig_ty≥0_ªgs_t
 
	mc⁄fig0
;

85 
pci_c⁄fig_ty≥1_ªgs_t
 
	mc⁄fig1
;

86 
u8
 
	mc⁄fig_d©a
[256];

90 
	miommu_group
;

92 } 
	tvlib_pci_devi˚_öfo_t
;

94 
u32
 
	tvlib_pci_dev_h™dÀ_t
;

96 
vlib_pci_devi˚_öfo_t
 *
vlib_pci_gë_devi˚_öfo
 (
vlib_pci_addr_t
 * 
addr
,

97 
˛ib_îr‹_t
 ** 
îr‹
);

98 
vlib_pci_addr_t
 *
vlib_pci_gë_Æl_dev_addrs
 ();

99 
vlib_pci_addr_t
 *
vlib_pci_gë_addr
 (
vlib_pci_dev_h™dÀ_t
 
h
);

100 
uw‹d
 
vlib_pci_gë_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
);

101 
vlib_pci_£t_¥iv©e_d©a
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
uw‹d
 
¥iv©e_d©a
);

103 
ölöe
 

104 
	$vlib_pci_‰ì_devi˚_öfo
 (
vlib_pci_devi˚_öfo_t
 * 
di
)

106 i‡(!
di
)

108 
	`vec_‰ì
 (
di
->
¥odu˘_«me
);

109 
	`vec_‰ì
 (
di
->
vpd_r
);

110 
	`vec_‰ì
 (
di
->
vpd_w
);

111 
	`vec_‰ì
 (
di
->
drivî_«me
);

112 
	`˛ib_mem_‰ì
 (
di
);

113 
	}
}

117 
u16
 
	mvíd‹_id
, 
	mdevi˚_id
;

118 } 
	tpci_devi˚_id_t
;

120 (
	tpci_ötx_h™dÀr_fun˘i⁄_t
Ë(
	tvlib_pci_dev_h™dÀ_t
 
	th™dÀ
);

121 (
	tpci_msix_h™dÀr_fun˘i⁄_t
Ë(
	tvlib_pci_dev_h™dÀ_t
 
	th™dÀ
,

122 
	tu16
 
	tlöe
);

124 
	s_pci_devi˚_ªgi°øti⁄


127 
˛ib_îr‹_t
 *(*
öô_fun˘i⁄
Ë(
vlib_maö_t
 * 
vm
,

128 
vlib_pci_dev_h™dÀ_t
 
h™dÀ
);

131 
pci_ötx_h™dÀr_fun˘i⁄_t
 *
öãºu±_h™dÀr
;

134 
_pci_devi˚_ªgi°øti⁄
 *
√xt_ªgi°øti⁄
;

137 
pci_devi˚_id_t
 
suµ‹ãd_devi˚s
[];

138 } 
	tpci_devi˚_ªgi°øti⁄_t
;

143 
vlib_maö_t
 *
vlib_maö
;

144 
pci_devi˚_ªgi°øti⁄_t
 *
pci_devi˚_ªgi°øti⁄s
;

145 } 
	tvlib_pci_maö_t
;

147 
vlib_pci_maö_t
 
pci_maö
;

149 
	#PCI_REGISTER_DEVICE
(
x
,...) \

150 
__VA_ARGS__
 
pci_devi˚_ªgi°øti⁄_t
 
x
; \

151 
__vlib_add_pci_devi˚_ªgi°øti⁄_
##
	`x
 () \

152 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

153 
__vlib_add_pci_devi˚_ªgi°øti⁄_
##
	`x
 () \

155 
vlib_pci_maö_t
 * 
pm
 = &
pci_maö
; \

156 
x
.
√xt_ªgi°øti⁄
 = 
pm
->
pci_devi˚_ªgi°øti⁄s
; \

157 
pm
->
pci_devi˚_ªgi°øti⁄s
 = &
x
; \

158 
	}
} \

159 
__VA_ARGS__
 
pci_devi˚_ªgi°øti⁄_t
 
x


	)

161 
˛ib_îr‹_t
 *
vlib_pci_böd_to_uio
 (
vlib_pci_addr_t
 * 
addr
,

162 *
uio_drivî_«me
);

165 
˛ib_îr‹_t
 *
vlib_pci_ªad_wrôe_c⁄fig
 (
vlib_pci_dev_h™dÀ_t
 
h™dÀ
,

166 
vlib_ªad_‹_wrôe_t
 
ªad_‹_wrôe
,

167 
uw‹d
 
addªss
,

168 *
d©a
, 
u32
 
n_byãs
);

170 
	#_
(
t
) \

171 
ölöe
 
˛ib_îr‹_t
 * \

172 
vlib_pci_ªad_c⁄fig_
##
	`t
 (
vlib_pci_dev_h™dÀ_t
 
h
, \

173 
uw‹d
 
addªss
, 
t
 * 
d©a
) \

175  
	`vlib_pci_ªad_wrôe_c⁄fig
 (
h
, 
VLIB_READ
,
addªss
, 
d©a
, \

176  (
d©a
[0])); \

177 }

	)

179 
_
(
u32
);

180 
_
(
u16
);

181 
_
(
u8
);

183 #unde‡
_


185 
	#_
(
t
) \

186 
ölöe
 
˛ib_îr‹_t
 * \

187 
vlib_pci_wrôe_c⁄fig_
##
	`t
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
uw‹d
 
addªss
, \

188 
t
 * 
d©a
) \

190  
	`vlib_pci_ªad_wrôe_c⁄fig
 (
h
, 
VLIB_WRITE
, \

191 
addªss
, 
d©a
,  (data[0])); \

192 }

	)

194 
_
(
u32
);

195 
_
(
u16
);

196 
_
(
u8
);

198 #unde‡
_


200 
ölöe
 
˛ib_îr‹_t
 *

201 
	$vlib_pci_öå_íabÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

203 
u16
 
comm™d
;

204 
˛ib_îr‹_t
 *
îr
;

206 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

208 i‡(
îr
)

209  
îr
;

211 
comm™d
 &~
PCI_COMMAND_INTX_DISABLE
;

213  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

214 
	}
}

216 
ölöe
 
˛ib_îr‹_t
 *

217 
	$vlib_pci_öå_dißbÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

219 
u16
 
comm™d
;

220 
˛ib_îr‹_t
 *
îr
;

222 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

224 i‡(
îr
)

225  
îr
;

227 
comm™d
 |
PCI_COMMAND_INTX_DISABLE
;

229  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

230 
	}
}

232 
ölöe
 
˛ib_îr‹_t
 *

233 
	$vlib_pci_bus_ma°î_íabÀ
 (
vlib_pci_dev_h™dÀ_t
 
h
)

235 
˛ib_îr‹_t
 *
îr
;

236 
u16
 
comm™d
;

239 
îr
 = 
	`vlib_pci_ªad_c⁄fig_u16
 (
h
, 4, &
comm™d
);

241 i‡(
îr
)

242  
îr
;

244 i‡(
comm™d
 & 
PCI_COMMAND_BUS_MASTER
)

247 
comm™d
 |
PCI_COMMAND_BUS_MASTER
;

249  
	`vlib_pci_wrôe_c⁄fig_u16
 (
h
, 4, &
comm™d
);

250 
	}
}

252 
˛ib_îr‹_t
 *
vlib_pci_devi˚_›í
 (
vlib_pci_addr_t
 * 
addr
,

253 
pci_devi˚_id_t
 
ids
[],

254 
vlib_pci_dev_h™dÀ_t
 * 
h™dÀ
);

255 
vlib_pci_devi˚_˛o£
 (
vlib_pci_dev_h™dÀ_t
 
h
);

257 
˛ib_îr‹_t
 *
vlib_pci_m≠_ªgi⁄
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u32
 
ªsour˚
,

258 **
ªsu…
);

260 
˛ib_îr‹_t
 *
vlib_pci_m≠_ªgi⁄_fixed
 (
vlib_pci_dev_h™dÀ_t
 
h
,

261 
u32
 
ªsour˚
, 
u8
 * 
addr
,

262 **
ªsu…
);

264 
˛ib_îr‹_t
 *
vlib_pci_ªgi°î_ötx_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
,

265 
pci_ötx_h™dÀr_fun˘i⁄_t
 *

266 
ötx_h™dÀr
);

267 
˛ib_îr‹_t
 *
vlib_pci_ªgi°î_msix_h™dÀr
 (
vlib_pci_dev_h™dÀ_t
 
h
,

268 
u32
 
°¨t
, u32 
cou¡
,

269 
pci_msix_h™dÀr_fun˘i⁄_t
 *

270 
msix_h™dÀr
);

271 
˛ib_îr‹_t
 *
vlib_pci_íabÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
,

272 
u16
 
cou¡
);

273 
˛ib_îr‹_t
 *
vlib_pci_dißbÀ_msix_úq
 (
vlib_pci_dev_h™dÀ_t
 
h
, 
u16
 
°¨t
,

274 
u16
 
cou¡
);

276 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_vlib_pci_addr
;

277 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_addr
;

278 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_lök_•ìd
;

279 
f‹m©_fun˘i⁄_t
 
	gf‹m©_vlib_pci_vpd
;

	@/usr/include/vlib/pci/pci_config.h

40 #i‚de‡
ö˛uded_vlib_pci_c⁄fig_h


41 
	#ö˛uded_vlib_pci_c⁄fig_h


	)

43 
	~<vµö‰a/byã_‹dî.h
>

44 
	~<vµö‰a/îr‹.h
>

48 
	mPCI_CLASS_NOT_DEFINED
 = 0x0000,

49 
	mPCI_CLASS_NOT_DEFINED_VGA
 = 0x0001,

51 
	mPCI_CLASS_STORAGE_SCSI
 = 0x0100,

52 
	mPCI_CLASS_STORAGE_IDE
 = 0x0101,

53 
	mPCI_CLASS_STORAGE_FLOPPY
 = 0x0102,

54 
	mPCI_CLASS_STORAGE_IPI
 = 0x0103,

55 
	mPCI_CLASS_STORAGE_RAID
 = 0x0104,

56 
	mPCI_CLASS_STORAGE_OTHER
 = 0x0180,

57 
	mPCI_CLASS_STORAGE
 = 0x0100,

59 
	mPCI_CLASS_NETWORK_ETHERNET
 = 0x0200,

60 
	mPCI_CLASS_NETWORK_TOKEN_RING
 = 0x0201,

61 
	mPCI_CLASS_NETWORK_FDDI
 = 0x0202,

62 
	mPCI_CLASS_NETWORK_ATM
 = 0x0203,

63 
	mPCI_CLASS_NETWORK_OTHER
 = 0x0280,

64 
	mPCI_CLASS_NETWORK
 = 0x0200,

66 
	mPCI_CLASS_DISPLAY_VGA
 = 0x0300,

67 
	mPCI_CLASS_DISPLAY_XGA
 = 0x0301,

68 
	mPCI_CLASS_DISPLAY_3D
 = 0x0302,

69 
	mPCI_CLASS_DISPLAY_OTHER
 = 0x0380,

70 
	mPCI_CLASS_DISPLAY
 = 0x0300,

72 
	mPCI_CLASS_MULTIMEDIA_VIDEO
 = 0x0400,

73 
	mPCI_CLASS_MULTIMEDIA_AUDIO
 = 0x0401,

74 
	mPCI_CLASS_MULTIMEDIA_PHONE
 = 0x0402,

75 
	mPCI_CLASS_MULTIMEDIA_OTHER
 = 0x0480,

76 
	mPCI_CLASS_MULTIMEDIA
 = 0x0400,

78 
	mPCI_CLASS_MEMORY_RAM
 = 0x0500,

79 
	mPCI_CLASS_MEMORY_FLASH
 = 0x0501,

80 
	mPCI_CLASS_MEMORY_OTHER
 = 0x0580,

81 
	mPCI_CLASS_MEMORY
 = 0x0500,

83 
	mPCI_CLASS_BRIDGE_HOST
 = 0x0600,

84 
	mPCI_CLASS_BRIDGE_ISA
 = 0x0601,

85 
	mPCI_CLASS_BRIDGE_EISA
 = 0x0602,

86 
	mPCI_CLASS_BRIDGE_MC
 = 0x0603,

87 
	mPCI_CLASS_BRIDGE_PCI
 = 0x0604,

88 
	mPCI_CLASS_BRIDGE_PCMCIA
 = 0x0605,

89 
	mPCI_CLASS_BRIDGE_NUBUS
 = 0x0606,

90 
	mPCI_CLASS_BRIDGE_CARDBUS
 = 0x0607,

91 
	mPCI_CLASS_BRIDGE_RACEWAY
 = 0x0608,

92 
	mPCI_CLASS_BRIDGE_OTHER
 = 0x0680,

93 
	mPCI_CLASS_BRIDGE
 = 0x0600,

95 
	mPCI_CLASS_COMMUNICATION_SERIAL
 = 0x0700,

96 
	mPCI_CLASS_COMMUNICATION_PARALLEL
 = 0x0701,

97 
	mPCI_CLASS_COMMUNICATION_MULTISERIAL
 = 0x0702,

98 
	mPCI_CLASS_COMMUNICATION_MODEM
 = 0x0703,

99 
	mPCI_CLASS_COMMUNICATION_OTHER
 = 0x0780,

100 
	mPCI_CLASS_COMMUNICATION
 = 0x0700,

102 
	mPCI_CLASS_SYSTEM_PIC
 = 0x0800,

103 
	mPCI_CLASS_SYSTEM_DMA
 = 0x0801,

104 
	mPCI_CLASS_SYSTEM_TIMER
 = 0x0802,

105 
	mPCI_CLASS_SYSTEM_RTC
 = 0x0803,

106 
	mPCI_CLASS_SYSTEM_PCI_HOTPLUG
 = 0x0804,

107 
	mPCI_CLASS_SYSTEM_OTHER
 = 0x0880,

108 
	mPCI_CLASS_SYSTEM
 = 0x0800,

110 
	mPCI_CLASS_INPUT_KEYBOARD
 = 0x0900,

111 
	mPCI_CLASS_INPUT_PEN
 = 0x0901,

112 
	mPCI_CLASS_INPUT_MOUSE
 = 0x0902,

113 
	mPCI_CLASS_INPUT_SCANNER
 = 0x0903,

114 
	mPCI_CLASS_INPUT_GAMEPORT
 = 0x0904,

115 
	mPCI_CLASS_INPUT_OTHER
 = 0x0980,

116 
	mPCI_CLASS_INPUT
 = 0x0900,

118 
	mPCI_CLASS_DOCKING_GENERIC
 = 0x0a00,

119 
	mPCI_CLASS_DOCKING_OTHER
 = 0x0a80,

120 
	mPCI_CLASS_DOCKING
 = 0x0a00,

122 
	mPCI_CLASS_PROCESSOR_386
 = 0x0b00,

123 
	mPCI_CLASS_PROCESSOR_486
 = 0x0b01,

124 
	mPCI_CLASS_PROCESSOR_PENTIUM
 = 0x0b02,

125 
	mPCI_CLASS_PROCESSOR_ALPHA
 = 0x0b10,

126 
	mPCI_CLASS_PROCESSOR_POWERPC
 = 0x0b20,

127 
	mPCI_CLASS_PROCESSOR_MIPS
 = 0x0b30,

128 
	mPCI_CLASS_PROCESSOR_CO
 = 0x0b40,

129 
	mPCI_CLASS_PROCESSOR
 = 0x0b00,

131 
	mPCI_CLASS_SERIAL_FIREWIRE
 = 0x0c00,

132 
	mPCI_CLASS_SERIAL_ACCESS
 = 0x0c01,

133 
	mPCI_CLASS_SERIAL_SSA
 = 0x0c02,

134 
	mPCI_CLASS_SERIAL_USB
 = 0x0c03,

135 
	mPCI_CLASS_SERIAL_FIBER
 = 0x0c04,

136 
	mPCI_CLASS_SERIAL_SMBUS
 = 0x0c05,

137 
	mPCI_CLASS_SERIAL
 = 0x0c00,

139 
	mPCI_CLASS_INTELLIGENT_I2O
 = 0x0e00,

140 
	mPCI_CLASS_INTELLIGENT
 = 0x0e00,

142 
	mPCI_CLASS_SATELLITE_TV
 = 0x0f00,

143 
	mPCI_CLASS_SATELLITE_AUDIO
 = 0x0f01,

144 
	mPCI_CLASS_SATELLITE_VOICE
 = 0x0f03,

145 
	mPCI_CLASS_SATELLITE_DATA
 = 0x0f04,

146 
	mPCI_CLASS_SATELLITE
 = 0x0f00,

148 
	mPCI_CLASS_CRYPT_NETWORK
 = 0x1000,

149 
	mPCI_CLASS_CRYPT_ENTERTAINMENT
 = 0x1001,

150 
	mPCI_CLASS_CRYPT_OTHER
 = 0x1080,

151 
	mPCI_CLASS_CRYPT
 = 0x1000,

153 
	mPCI_CLASS_SP_DPIO
 = 0x1100,

154 
	mPCI_CLASS_SP_OTHER
 = 0x1180,

155 
	mPCI_CLASS_SP
 = 0x1100,

156 } 
	tpci_devi˚_˛ass_t
;

158 
ölöe
 
pci_devi˚_˛ass_t


159 
	$pci_devi˚_˛ass_ba£
 (
pci_devi˚_˛ass_t
 
c
)

161  
c
 & ~0xff;

162 
	}
}

168 
	#VIRTIO_PCI_LEGACY_DEVICEID_NET
 0x1000

	)

169 
	#VIRTIO_PCI_MODERN_DEVICEID_NET
 0x1041

	)

177 
u16
 
	mvíd‹_id
;

178 
u16
 
	mdevi˚_id
;

180 
u16
 
	mcomm™d
;

181 
	#PCI_COMMAND_IO
 (1 << 0Ë

	)

182 
	#PCI_COMMAND_MEMORY
 (1 << 1Ë

	)

183 
	#PCI_COMMAND_BUS_MASTER
 (1 << 2Ë

	)

184 
	#PCI_COMMAND_SPECIAL
 (1 << 3Ë

	)

185 
	#PCI_COMMAND_WRITE_INVALIDATE
 (1 << 4Ë

	)

186 
	#PCI_COMMAND_VGA_PALETTE_SNOOP
 (1 << 5)

	)

187 
	#PCI_COMMAND_PARITY
 (1 << 6)

	)

188 
	#PCI_COMMAND_WAIT
 (1 << 7Ë

	)

189 
	#PCI_COMMAND_SERR
 (1 << 8Ë

	)

190 
	#PCI_COMMAND_BACK_TO_BACK_WRITE
 (1 << 9)

	)

191 
	#PCI_COMMAND_INTX_DISABLE
 (1 << 10Ë

	)

193 
u16
 
	m°©us
;

194 
	#PCI_STATUS_INTX_PENDING
 (1 << 3)

	)

195 
	#PCI_STATUS_CAPABILITY_LIST
 (1 << 4)

	)

196 
	#PCI_STATUS_66MHZ
 (1 << 5Ë

	)

197 
	#PCI_STATUS_UDF
 (1 << 6Ë

	)

198 
	#PCI_STATUS_BACK_TO_BACK_WRITE
 (1 << 7Ë

	)

199 
	#PCI_STATUS_PARITY_ERROR
 (1 << 8Ë

	)

200 
	#PCI_STATUS_DEVSEL_GET
(
x
Ë((x >> 9Ë& 3Ë

	)

201 
	#PCI_STATUS_DEVSEL_FAST
 (0 << 9)

	)

202 
	#PCI_STATUS_DEVSEL_MEDIUM
 (1 << 9)

	)

203 
	#PCI_STATUS_DEVSEL_SLOW
 (2 << 9)

	)

204 
	#PCI_STATUS_SIG_TARGET_ABORT
 (1 << 11Ë

	)

205 
	#PCI_STATUS_REC_TARGET_ABORT
 (1 << 12Ë

	)

206 
	#PCI_STATUS_REC_MASTER_ABORT
 (1 << 13Ë

	)

207 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 (1 << 14Ë

	)

208 
	#PCI_STATUS_DETECTED_PARITY_ERROR
 (1 << 15)

	)

210 
u8
 
	mªvisi⁄_id
;

211 
u8
 
	m¥ogømmög_öãrÁ˚_˛ass
;

213 
pci_devi˚_˛ass_t
 
	mdevi˚_˛ass
:16;

215 
u8
 
	mˇche_size
;

216 
u8
 
	mœãncy_timî
;

218 
u8
 
	mhódî_ty≥
;

219 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

220 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

221 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

223 
u8
 
	mbi°
;

224 
	#PCI_BIST_CODE_MASK
 0x0‡

	)

225 
	#PCI_BIST_START
 0x40

	)

226 
	#PCI_BIST_CAPABLE
 0x80

	)

227 } 
	tpci_c⁄fig_hódî_t
;

230 
Æways_ölöe
 

231 
	$pci_c⁄fig_hódî_lôée_to_ho°
 (
pci_c⁄fig_hódî_t
 * 
r
)

233 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

235 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

236 
	`_
(
víd‹_id
, 
u16
);

237 
	`_
(
devi˚_id
, 
u16
);

238 
	`_
(
comm™d
, 
u16
);

239 
	`_
(
°©us
, 
u16
);

240 
	`_
(
devi˚_˛ass
, 
u16
);

241 #unde‡
_


242 
	}
}

247 
pci_c⁄fig_hódî_t
 
	mhódî
;

255 
u32
 
	mba£_addªss
[6];

257 
u16
 
	mˇrdbus_cis
;

259 
u16
 
	msubsy°em_víd‹_id
;

260 
u16
 
	msubsy°em_id
;

262 
u32
 
	mrom_addªss
;

263 
	#PCI_ROM_ADDRESS
 0x30

	)

264 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

265 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffUL)

	)

267 
u8
 
	mfú°_ˇ∑bûôy_off£t
;

268 
CLIB_PAD_FROM_TO
 (0x35, 0x3c);

270 
u8
 
	möãºu±_löe
;

271 
u8
 
	möãºu±_pö
;

272 
u8
 
	mmö_gø¡
;

273 
u8
 
	mmax_œãncy
;

275 
u8
 
	mˇ∑bûôy_d©a
[0];

276 } 
	tpci_c⁄fig_ty≥0_ªgs_t
;

278 
Æways_ölöe
 

279 
	$pci_c⁄fig_ty≥0_lôée_to_ho°
 (
pci_c⁄fig_ty≥0_ªgs_t
 * 
r
)

281 
i
;

282 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

284 
	`pci_c⁄fig_hódî_lôée_to_ho°
 (&
r
->
hódî
);

285 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

286 
i
 = 0; i < 
	`ARRAY_LEN
 (
r
->
ba£_addªss
); i++)

287 
	`_
(
ba£_addªss
[
i
], 
u32
);

288 
	`_
(
ˇrdbus_cis
, 
u16
);

289 
	`_
(
subsy°em_víd‹_id
, 
u16
);

290 
	`_
(
subsy°em_id
, 
u16
);

291 
	`_
(
rom_addªss
, 
u32
);

292 #unde‡
_


293 
	}
}

298 
pci_c⁄fig_hódî_t
 
	mhódî
;

300 
u32
 
	mba£_addªss
[2];

303 
u8
 
	m¥im¨y_bus
;

304 
u8
 
	m£c⁄d¨y_bus
;

307 
u8
 
	msub‹dö©e_bus
;

309 
u8
 
	m£c⁄d¨y_bus_œãncy_timî
;

312 
u8
 
	mio_ba£
, 
	mio_limô
;

315 
u16
 
	m£c⁄d¨y_°©us
;

318 
u16
 
	mmem‹y_ba£
, 
	mmem‹y_limô
;

319 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

320 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

322 
u16
 
	m¥e„tchabÀ_mem‹y_ba£
, 
	m¥e„tchabÀ_mem‹y_limô
;

323 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

324 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

325 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

326 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

328 
u32
 
	m¥e„tchabÀ_mem‹y_ba£_uµî_32bôs
;

329 
u32
 
	m¥e„tchabÀ_mem‹y_limô_uµî_32bôs
;

330 
u16
 
	mio_ba£_uµî_16bôs
;

331 
u16
 
	mio_limô_uµî_16bôs
;

334 
u8
 
	mˇ∑bûôy_li°_off£t
;

335 
CLIB_PAD_FROM_TO
 (0x35, 0x37);

337 
u32
 
	mrom_addªss
;

338 
CLIB_PAD_FROM_TO
 (0x3c, 0x3e);

340 
u16
 
	mbridge_c⁄åﬁ
;

341 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

342 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

343 
	#PCI_BRIDGE_CTL_NO_ISA
 0x04

	)

344 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

345 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

346 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

347 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

349 
u8
 
	mˇ∑bûôy_d©a
[0];

350 } 
	tpci_c⁄fig_ty≥1_ªgs_t
;

352 
Æways_ölöe
 

353 
	$pci_c⁄fig_ty≥1_lôée_to_ho°
 (
pci_c⁄fig_ty≥1_ªgs_t
 * 
r
)

355 
i
;

356 i‡(!
CLIB_ARCH_IS_BIG_ENDIAN
)

358 
	`pci_c⁄fig_hódî_lôée_to_ho°
 (&
r
->
hódî
);

359 
	#_
(
f
,
t
Ë
r
->‡
˛ib_byã_sw≠_
##
	`t
 (r->f)

	)

360 
i
 = 0; i < 
	`ARRAY_LEN
 (
r
->
ba£_addªss
); i++)

361 
	`_
(
ba£_addªss
[
i
], 
u32
);

362 
	`_
(
£c⁄d¨y_°©us
, 
u16
);

363 
	`_
(
mem‹y_ba£
, 
u16
);

364 
	`_
(
mem‹y_limô
, 
u16
);

365 
	`_
(
¥e„tchabÀ_mem‹y_ba£
, 
u16
);

366 
	`_
(
¥e„tchabÀ_mem‹y_limô
, 
u16
);

367 
	`_
(
¥e„tchabÀ_mem‹y_ba£_uµî_32bôs
, 
u32
);

368 
	`_
(
¥e„tchabÀ_mem‹y_limô_uµî_32bôs
, 
u32
);

369 
	`_
(
io_ba£_uµî_16bôs
, 
u16
);

370 
	`_
(
io_limô_uµî_16bôs
, 
u16
);

371 
	`_
(
rom_addªss
, 
u32
);

372 
	`_
(
bridge_c⁄åﬁ
, 
u16
);

373 #unde‡
_


374 
	}
}

377 
	epci_ˇ∑bûôy_ty≥


380 
	mPCI_CAP_ID_PM
 = 1,

383 
	mPCI_CAP_ID_AGP
 = 2,

386 
	mPCI_CAP_ID_VPD
 = 3,

389 
	mPCI_CAP_ID_SLOTID
 = 4,

392 
	mPCI_CAP_ID_MSI
 = 5,

395 
	mPCI_CAP_ID_CHSWP
 = 6,

398 
	mPCI_CAP_ID_PCIX
 = 7,

401 
	mPCI_CAP_ID_HYPERTRANSPORT
 = 8,

404 
	mPCI_CAP_ID_SHPC
 = 0xc,

407 
	mPCI_CAP_ID_PCIE
 = 0x10,

410 
	mPCI_CAP_ID_MSIX
 = 0x11,

411 } 
	tpci_ˇ∑bûôy_ty≥_t
;

416 
pci_ˇ∑bûôy_ty≥
 
	mty≥
:8;

417 
u8
 
	m√xt_off£t
;

418 } 
	t__˛ib_∑cked
 
	tpci_ˇ∑bûôy_ªgs_t
;

420 
Æways_ölöe
 *

421 
	$pci_c⁄fig_föd_ˇ∑bûôy
 (
pci_c⁄fig_ty≥0_ªgs_t
 * 
t
, 
ˇp_ty≥
)

423 
pci_ˇ∑bûôy_ªgs_t
 *
c
;

424 
u32
 
√xt_off£t
;

425 
u32
 
âl
 = 48;

427 i‡(!(
t
->
hódî
.
°©us
 & 
PCI_STATUS_CAPABILITY_LIST
))

430 
√xt_off£t
 = 
t
->
fú°_ˇ∑bûôy_off£t
;

431 
âl
-- && 
√xt_off£t
 >= 0x40)

433 
c
 = (*Ë
t
 + (
√xt_off£t
 & ~3);

434 i‡((
u8
Ë
c
->
ty≥
 == 0xff)

436 i‡(
c
->
ty≥
 =
ˇp_ty≥
)

437  
c
;

438 
√xt_off£t
 = 
c
->next_offset;

441 
	}
}

446 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

447 
u16
 
	mˇ∑bûôõs
;

448 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

449 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

450 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

451 
	#PCI_PM_CAP_DSI
 0x0020

	)

452 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

453 
	#PCI_PM_CAP_D1
 0x0200

	)

454 
	#PCI_PM_CAP_D2
 0x0400

	)

455 
	#PCI_PM_CAP_PME
 0x0800

	)

456 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

457 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

458 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

459 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

460 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

461 
	#PCI_PM_CAP_PME_D3cﬁd
 0x8000

	)

462 
u16
 
	mc⁄åﬁ
;

463 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

464 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

465 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

466 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

467 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

468 
u8
 
	mexãnsi⁄s
;

469 
	#PCI_PM_PPB_B2_B3
 0x40

	)

470 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

471 
u8
 
	md©a
;

472 } 
	t__˛ib_∑cked
 
	tpci_powî_m™agemít_ªgs_t
;

477 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

478 
u8
 
	mvîsi⁄
;

479 
u8
 
	mª°_of_ˇ∑bûôy_Êags
;

480 
u32
 
	m°©us
;

481 
u32
 
	mcomm™d
;

483 
	#PCI_AGP_RQ_MASK
 0xff000000

	)

484 
	#PCI_AGP_SBA
 0x0200

	)

485 
	#PCI_AGP_64BIT
 0x0020

	)

486 
	#PCI_AGP_ALLOW_TRANSACTIONS
 0x0100

	)

487 
	#PCI_AGP_FW
 0x0010

	)

488 
	#PCI_AGP_RATE4
 0x0004

	)

489 
	#PCI_AGP_RATE2
 0x0002

	)

490 
	#PCI_AGP_RATE1
 0x0001

	)

491 } 
	t__˛ib_∑cked
 
	tpci_agp_ªgs_t
;

496 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

497 
u16
 
	maddªss
;

498 
	#PCI_VPD_ADDR_MASK
 0x7ff‡

	)

499 
	#PCI_VPD_ADDR_F
 0x8000

	)

500 
u32
 
	md©a
;

501 } 
	t__˛ib_∑cked
 
	tpci_vpd_ªgs_t
;

506 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

507 
u8
 
	me§
;

508 
	#PCI_SID_ESR_NSLOTS
 0x1‡

	)

509 
	#PCI_SID_ESR_FIC
 0x20

	)

510 
u8
 
	mchassis
;

511 } 
	t__˛ib_∑cked
 
	tpci_sid_ªgs_t
;

516 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

517 
u16
 
	mÊags
;

518 
	#PCI_MSI_FLAGS_ENABLE
 (1 << 0Ë

	)

519 
	#PCI_MSI_FLAGS_GET_MAX_QUEUE_SIZE
(
x
Ë((x >> 1Ë& 0x7)

	)

520 
	#PCI_MSI_FLAGS_MAX_QUEUE_SIZE
(
x
Ë(((xË& 0x7Ë<< 1)

	)

521 
	#PCI_MSI_FLAGS_GET_QUEUE_SIZE
(
x
Ë((x >> 4Ë& 0x7)

	)

522 
	#PCI_MSI_FLAGS_QUEUE_SIZE
(
x
Ë(((xË& 0x7Ë<< 4)

	)

523 
	#PCI_MSI_FLAGS_64BIT
 (1 << 7Ë

	)

524 
	#PCI_MSI_FLAGS_MASKBIT
 (1 << 8Ë

	)

525 
u32
 
	maddªss
;

526 
u32
 
	md©a
;

527 
u32
 
	mmask_bôs
;

528 } 
	t__˛ib_∑cked
 
	tpci_msi32_ªgs_t
;

532 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

533 
u16
 
	mÊags
;

534 
u32
 
	maddªss
[2];

535 
u32
 
	md©a
;

536 
u32
 
	mmask_bôs
;

537 } 
	t__˛ib_∑cked
 
	tpci_msi64_ªgs_t
;

542 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

543 
u16
 
	mc⁄åﬁ_°©us
;

544 
	#PCI_CHSWP_DHA
 0x01

	)

545 
	#PCI_CHSWP_EIM
 0x02

	)

546 
	#PCI_CHSWP_PIE
 0x04

	)

547 
	#PCI_CHSWP_LOO
 0x08

	)

548 
	#PCI_CHSWP_PI
 0x30

	)

549 
	#PCI_CHSWP_EXT
 0x40

	)

550 
	#PCI_CHSWP_INS
 0x80

	)

551 } 
	t__˛ib_∑cked
 
	tpci_chswp_ªgs_t
;

556 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

557 
u16
 
	mcomm™d
;

558 
	#PCIX_CMD_DPERR_E
 0x0001

	)

559 
	#PCIX_CMD_ERO
 0x0002

	)

560 
	#PCIX_CMD_MAX_READ
 0x000¯

	)

561 
	#PCIX_CMD_MAX_SPLIT
 0x0070

	)

562 
	#PCIX_CMD_VERSION
(
x
Ë(((xË>> 12Ë& 3Ë

	)

563 
u32
 
	m°©us
;

564 
	#PCIX_STATUS_DEVFN
 0x000000f‡

	)

565 
	#PCIX_STATUS_BUS
 0x0000ff00

	)

566 
	#PCIX_STATUS_64BIT
 0x00010000

	)

567 
	#PCIX_STATUS_133MHZ
 0x00020000

	)

568 
	#PCIX_STATUS_SPL_DISC
 0x00040000

	)

569 
	#PCIX_STATUS_UNX_SPL
 0x00080000

	)

570 
	#PCIX_STATUS_COMPLEX
 0x00100000

	)

571 
	#PCIX_STATUS_MAX_READ
 0x00600000

	)

572 
	#PCIX_STATUS_MAX_SPLIT
 0x03800000

	)

573 
	#PCIX_STATUS_MAX_CUM
 0x1c000000

	)

574 
	#PCIX_STATUS_SPL_ERR
 0x20000000

	)

575 
	#PCIX_STATUS_266MHZ
 0x40000000

	)

576 
	#PCIX_STATUS_533MHZ
 0x80000000

	)

577 } 
	t__˛ib_∑cked
 
	tpcix_c⁄fig_ªgs_t
;

579 
ölöe
 

580 
	$pcõ_size_to_code
 (
byãs
)

582 
	`ASSERT
 (
	`is_pow2
 (
byãs
));

583 
	`ASSERT
 (
byãs
 <= 4096);

584  
	`mö_log2
 (
byãs
) - 7;

585 
	}
}

587 
ölöe
 

588 
	$pcõ_code_to_size
 (
code
)

590 
size
 = 1 << (
code
 + 7);

591 
	`ASSERT
 (
size
 <= 4096);

592  
size
;

593 
	}
}

598 
pci_ˇ∑bûôy_ªgs_t
 
	mhódî
;

599 
u16
 
	mpcõ_ˇ∑bûôõs
;

600 
	#PCIE_CAP_VERSION
(
x
Ë(((xË>> 0Ë& 0xf)

	)

601 
	#PCIE_CAP_DEVICE_TYPE
(
x
Ë(((xË>> 4Ë& 0xf)

	)

602 
	#PCIE_DEVICE_TYPE_ENDPOINT
 0

	)

603 
	#PCIE_DEVICE_TYPE_LEGACY_ENDPOINT
 1

	)

604 
	#PCIE_DEVICE_TYPE_ROOT_PORT
 4

	)

606 
	#PCIE_DEVICE_TYPE_SWITCH_UPSTREAM
 5

	)

607 
	#PCIE_DEVICE_TYPE_SWITCH_DOWNSTREAM
 6

	)

608 
	#PCIE_DEVICE_TYPE_PCIE_TO_PCI_BRIDGE
 7

	)

609 
	#PCIE_DEVICE_TYPE_PCI_TO_PCIE_BRIDGE
 8

	)

611 
	#PCIE_DEVICE_TYPE_ROOT_COMPLEX_ENDPOINT
 9

	)

612 
	#PCIE_DEVICE_TYPE_ROOT_COMPLEX_EVENT_COLLECTOR
 10

	)

613 
	#PCIE_CAP_SLOW_IMPLEMENTED
 (1 << 8)

	)

614 
	#PCIE_CAP_MSI_IRQ
(
x
Ë(((xË>> 9Ë& 0x1f)

	)

615 
u32
 
	mdev_ˇ∑bûôõs
;

616 
	#PCIE_DEVCAP_MAX_PAYLOAD
(
x
Ë(128 << (((xË>> 0Ë& 0x7))

	)

617 
	#PCIE_DEVCAP_PHANTOM_BITS
(
x
Ë(((xË>> 3Ë& 0x3)

	)

618 
	#PCIE_DEVCAP_EXTENTED_TAG
 (1 << 5)

	)

619 
	#PCIE_DEVCAP_L0S
 0x1c0

	)

620 
	#PCIE_DEVCAP_L1
 0xe00

	)

621 
	#PCIE_DEVCAP_ATN_BUT
 0x1000

	)

622 
	#PCIE_DEVCAP_ATN_IND
 0x2000

	)

623 
	#PCIE_DEVCAP_PWR_IND
 0x4000

	)

624 
	#PCIE_DEVCAP_PWR_VAL
 0x3fc0000

	)

625 
	#PCIE_DEVCAP_PWR_SCL
 0xc000000

	)

626 
u16
 
	mdev_c⁄åﬁ
;

627 
	#PCIE_CTRL_CERE
 0x0001

	)

628 
	#PCIE_CTRL_NFERE
 0x0002

	)

629 
	#PCIE_CTRL_FERE
 0x0004

	)

630 
	#PCIE_CTRL_URRE
 0x0008

	)

631 
	#PCIE_CTRL_RELAX_EN
 0x0010

	)

632 
	#PCIE_CTRL_MAX_PAYLOAD
(
n
Ë((“Ë& 7Ë<< 5)

	)

633 
	#PCIE_CTRL_EXT_TAG
 0x0100

	)

634 
	#PCIE_CTRL_PHANTOM
 0x0200

	)

635 
	#PCIE_CTRL_AUX_PME
 0x0400

	)

636 
	#PCIE_CTRL_NOSNOOP_EN
 0x0800

	)

637 
	#PCIE_CTRL_MAX_READ_REQUEST
(
n
Ë((“Ë& 7Ë<< 12)

	)

638 
u16
 
	mdev_°©us
;

639 
	#PCIE_DEVSTA_AUXPD
 0x10

	)

640 
	#PCIE_DEVSTA_TRPND
 0x20

	)

641 
u32
 
	mlök_ˇ∑bûôõs
;

642 
u16
 
	mlök_c⁄åﬁ
;

643 
u16
 
	mlök_°©us
;

644 
u32
 
	m¶Ÿ_ˇ∑bûôõs
;

645 
u16
 
	m¶Ÿ_c⁄åﬁ
;

646 
u16
 
	m¶Ÿ_°©us
;

647 
u16
 
	mroŸ_c⁄åﬁ
;

648 
	#PCIE_RTCTL_SECEE
 0x01

	)

649 
	#PCIE_RTCTL_SENFEE
 0x02

	)

650 
	#PCIE_RTCTL_SEFEE
 0x04

	)

651 
	#PCIE_RTCTL_PMEIE
 0x08

	)

652 
	#PCIE_RTCTL_CRSSVE
 0x10

	)

653 
u16
 
	mroŸ_ˇ∑bûôõs
;

654 
u32
 
	mroŸ_°©us
;

655 
u32
 
	mdev_ˇ∑bûôõs2
;

656 
u16
 
	mdev_c⁄åﬁ2
;

657 
u16
 
	mdev_°©us2
;

658 
u32
 
	mlök_ˇ∑bûôõs2
;

659 
u16
 
	mlök_c⁄åﬁ2
;

660 
u16
 
	mlök_°©us2
;

661 
u32
 
	m¶Ÿ_ˇ∑bûôõs2
;

662 
u16
 
	m¶Ÿ_c⁄åﬁ2
;

663 
u16
 
	m¶Ÿ_°©us2
;

664 } 
	t__˛ib_∑cked
 
	tpcõ_c⁄fig_ªgs_t
;

667 
	epcõ_ˇ∑bûôy_ty≥


669 
	mPCIE_CAP_ADVANCED_ERROR
 = 1,

670 
	mPCIE_CAP_VC
 = 2,

671 
	mPCIE_CAP_DSN
 = 3,

672 
	mPCIE_CAP_PWR
 = 4,

673 } 
	tpcõ_ˇ∑bûôy_ty≥_t
;

678 
pcõ_ˇ∑bûôy_ty≥
 
	mty≥
:16;

679 
u16
 
	mvîsi⁄
:4;

680 
u16
 
	m√xt_ˇ∑bûôy
:12;

681 } 
	t__˛ib_∑cked
 
	tpcõ_ˇ∑bûôy_ªgs_t
;

685 
pcõ_ˇ∑bûôy_ªgs_t
 
	mhódî
;

686 
u32
 
	munc‹ª˘abÀ_°©us
;

687 
	#PCIE_ERROR_UNC_LINK_TRAINING
 (1 << 0)

	)

688 
	#PCIE_ERROR_UNC_DATA_LINK_PROTOCOL
 (1 << 4)

	)

689 
	#PCIE_ERROR_UNC_SURPRISE_DOWN
 (1 << 5)

	)

690 
	#PCIE_ERROR_UNC_POISONED_TLP
 (1 << 12)

	)

691 
	#PCIE_ERROR_UNC_FLOW_CONTROL
 (1 << 13)

	)

692 
	#PCIE_ERROR_UNC_COMPLETION_TIMEOUT
 (1 << 14)

	)

693 
	#PCIE_ERROR_UNC_COMPLETER_ABORT
 (1 << 15)

	)

694 
	#PCIE_ERROR_UNC_UNEXPECTED_COMPLETION
 (1 << 16)

	)

695 
	#PCIE_ERROR_UNC_RX_OVERFLOW
 (1 << 17)

	)

696 
	#PCIE_ERROR_UNC_MALFORMED_TLP
 (1 << 18)

	)

697 
	#PCIE_ERROR_UNC_CRC_ERROR
 (1 << 19)

	)

698 
	#PCIE_ERROR_UNC_UNSUPPORTED_REQUEST
 (1 << 20)

	)

699 
u32
 
	munc‹ª˘abÀ_mask
;

700 
u32
 
	munc‹ª˘abÀ_£vîôy
;

701 
u32
 
	mc‹ª˘abÀ_°©us
;

702 
	#PCIE_ERROR_COR_RX_ERROR
 (1 << 0)

	)

703 
	#PCIE_ERROR_COR_BAD_TLP
 (1 << 6)

	)

704 
	#PCIE_ERROR_COR_BAD_DLLP
 (1 << 7)

	)

705 
	#PCIE_ERROR_COR_REPLAY_ROLLOVER
 (1 << 8)

	)

706 
	#PCIE_ERROR_COR_REPLAY_TIMER
 (1 << 12)

	)

707 
	#PCIE_ERROR_COR_ADVISORY
 (1 << 13)

	)

708 
u32
 
	mc‹ª˘abÀ_mask
;

709 
u32
 
	mc⁄åﬁ
;

710 
u32
 
	mlog
[4];

711 
u32
 
	mroŸ_comm™d
;

712 
u32
 
	mroŸ_°©us
;

713 
u16
 
	mc‹ª˘abÀ_îr‹_sour˚
;

714 
u16
 
	mîr‹_sour˚
;

715 } 
	t__˛ib_∑cked
 
	tpcõ_adv™˚d_îr‹_ªgs_t
;

718 
	#PCI_VC_PORT_REG1
 4

	)

719 
	#PCI_VC_PORT_REG2
 8

	)

720 
	#PCI_VC_PORT_CTRL
 12

	)

721 
	#PCI_VC_PORT_STATUS
 14

	)

722 
	#PCI_VC_RES_CAP
 16

	)

723 
	#PCI_VC_RES_CTRL
 20

	)

724 
	#PCI_VC_RES_STATUS
 26

	)

727 
	#PCI_PWR_DSR
 4

	)

728 
	#PCI_PWR_DATA
 8

	)

729 
	#PCI_PWR_DATA_BASE
(
x
Ë((xË& 0xffË

	)

730 
	#PCI_PWR_DATA_SCALE
(
x
Ë(((xË>> 8Ë& 3Ë

	)

731 
	#PCI_PWR_DATA_PM_SUB
(
x
Ë(((xË>> 10Ë& 7Ë

	)

732 
	#PCI_PWR_DATA_PM_STATE
(
x
Ë(((xË>> 13Ë& 3Ë

	)

733 
	#PCI_PWR_DATA_TYPE
(
x
Ë(((xË>> 15Ë& 7Ë

	)

734 
	#PCI_PWR_DATA_RAIL
(
x
Ë(((xË>> 18Ë& 7Ë

	)

735 
	#PCI_PWR_CAP
 12

	)

736 
	#PCI_PWR_CAP_BUDGET
(
x
Ë((xË& 1Ë

	)

	@/usr/include/vlib/physmem.h

40 #i‚de‡
ö˛uded_vlib_physmem_h


41 
	#ö˛uded_vlib_physmem_h


	)

43 
u8
 
	tvlib_physmem_ªgi⁄_ödex_t
;

47 
vlib_physmem_ªgi⁄_ödex_t
 
	mödex
;

48 *
	mmem
;

49 
uw‹d
 
	msize
;

50 
	mfd
;

51 
u8
 
	mlog2_∑ge_size
;

52 
u16
 
	mn_∑ges
;

53 
u32
 
	m∑ge_mask
;

55 *
	mhóp
;

56 
u32
 
	mÊags
;

57 
	#VLIB_PHYSMEM_F_INIT_MHEAP
 (1 << 0)

	)

58 
	#VLIB_PHYSMEM_F_HUGETLB
 (1 << 1)

	)

59 
	#VLIB_PHYSMEM_F_SHARED
 (1 << 2)

	)

61 
u8
 
	mnuma_node
;

62 
u64
 *
	m∑ge_èbÀ
;

63 
u8
 *
	m«me
;

64 } 
	tvlib_physmem_ªgi⁄_t
;

70 
u32
 
	mÊags
;

71 
	#VLIB_PHYSMEM_MAIN_F_HAVE_PAGEMAP
 (1 << 0)

	)

72 
	#VLIB_PHYSMEM_MAIN_F_HAVE_IOMMU
 (1 << 1)

	)

73 
vlib_physmem_ªgi⁄_t
 *
	mªgi⁄s
;

74 } 
	tvlib_physmem_maö_t
;

76 
vlib_physmem_maö_t
 
physmem_maö
;

	@/usr/include/vlib/physmem_funcs.h

40 #i‚de‡
ö˛uded_vlib_physmem_funcs_h


41 
	#ö˛uded_vlib_physmem_funcs_h


	)

43 
Æways_ölöe
 
vlib_physmem_ªgi⁄_t
 *

44 
	$vlib_physmem_gë_ªgi⁄
 (
vlib_maö_t
 * 
vm
, 
u8
 
ödex
)

46 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

47  
	`poﬁ_ñt_©_ödex
 (
vpm
->
ªgi⁄s
, 
ödex
);

48 
	}
}

50 
Æways_ölöe
 
u64


51 
	$vlib_physmem_off£t_to_physiˇl
 (
vlib_maö_t
 * 
vm
,

52 
vlib_physmem_ªgi⁄_ödex_t
 
idx
, 
uw‹d
 
o
)

54 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

55 
uw‹d
 
∑ge_ödex
 = 
o
 >> 
¥
->
log2_∑ge_size
;

56 
	`ASSERT
 (
o
 < 
¥
->
size
);

57 
	`ASSERT
 (
¥
->
∑ge_èbÀ
[
∑ge_ödex
] != 0);

58  (
	`vec_ñt
 (
¥
->
∑ge_èbÀ
, 
∑ge_ödex
Ë+ (
o
 &Ör->
∑ge_mask
));

59 
	}
}

61 
Æways_ölöe
 

62 
	$vlib_physmem_is_vútuÆ
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

63 
uw‹d
 
p
)

65 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

66  
p
 >
	`poöãr_to_uw‹d
 (
¥
->
mem
)

67 && 
p
 < (
	`poöãr_to_uw‹d
 (
¥
->
mem
Ë+Ör->
size
);

68 
	}
}

70 
Æways_ölöe
 
uw‹d


71 
	$vlib_physmem_off£t_of
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

72 *
p
)

74 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

75 
uw‹d
 
a
 = 
	`poöãr_to_uw‹d
 (
p
);

76 
uw‹d
 
o
;

78 
	`ASSERT
 (
	`vlib_physmem_is_vútuÆ
 (
vm
, 
idx
, 
a
));

79 
o
 = 
a
 - 
	`poöãr_to_uw‹d
 (
¥
->
mem
);

82 
	`ASSERT
 ((
uw‹d
Ë
o
 =
a
 - 
	`poöãr_to_uw‹d
 (
¥
->
mem
));

84  
o
;

85 
	}
}

87 
Æways_ölöe
 *

88 
	$vlib_physmem_©_off£t
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

89 
uw‹d
 
off£t
)

91 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`vlib_physmem_gë_ªgi⁄
 (
vm
, 
idx
);

92 
	`ASSERT
 (
off£t
 < 
¥
->
size
);

93  
	`uw‹d_to_poöãr
 (
	`poöãr_to_uw‹d
 (
¥
->
mem
Ë+ 
off£t
, *);

94 
	}
}

96 
Æways_ölöe
 *

97 
	$vlib_physmem_Æloc_Æig√d
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

98 
˛ib_îr‹_t
 ** 
îr‹
,

99 
uw‹d
 
n_byãs
, uw‹d 
Æignmít
)

101 *
r
 = 
vm
->
	`os_physmem_Æloc_Æig√d
 (vm, 
idx
, 
n_byãs
, 
Æignmít
);

102 i‡(!
r
)

103 *
îr‹
 =

104 
	`˛ib_îr‹_ªtu∫
 (0, "failedÅoállocate %wd bytes of I/O memory",

105 
n_byãs
);

107 *
îr‹
 = 0;

108  
r
;

109 
	}
}

112 
Æways_ölöe
 *

113 
	$vlib_physmem_Æloc
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

114 
˛ib_îr‹_t
 ** 
îr‹
, 
uw‹d
 
n_byãs
)

116  
	`vlib_physmem_Æloc_Æig√d
 (
vm
, 
idx
, 
îr‹
, 
n_byãs
,

117 
CLIB_CACHE_LINE_BYTES
);

118 
	}
}

120 
Æways_ölöe
 

121 
	$vlib_physmem_‰ì
 (
vlib_maö_t
 * 
vm
, 
vlib_physmem_ªgi⁄_ödex_t
 
idx
,

122 *
mem
)

124 i‡(
mem
)

125 
vm
->
	`os_physmem_‰ì
 (vm, 
idx
, 
mem
);

126 
	}
}

128 
Æways_ölöe
 
u64


129 
	$vlib_physmem_vútuÆ_to_physiˇl
 (
vlib_maö_t
 * 
vm
,

130 
vlib_physmem_ªgi⁄_ödex_t
 
idx
, *
mem
)

132 
vlib_physmem_maö_t
 *
vpm
 = &
physmem_maö
;

133 
vlib_physmem_ªgi⁄_t
 *
¥
 = 
	`poﬁ_ñt_©_ödex
 (
vpm
->
ªgi⁄s
, 
idx
);

134 
uw‹d
 
o
 = 
mem
 - 
¥
->mem;

135  
	`vlib_physmem_off£t_to_physiˇl
 (
vm
, 
idx
, 
o
);

136 
	}
}

139 
Æways_ölöe
 
˛ib_îr‹_t
 *

140 
	$vlib_physmem_ªgi⁄_Æloc
 (
vlib_maö_t
 * 
vm
, *
«me
, 
u32
 
size
,

141 
u8
 
numa_node
, 
u32
 
Êags
,

142 
vlib_physmem_ªgi⁄_ödex_t
 * 
idx
)

144  
vm
->
	`os_physmem_ªgi⁄_Æloc
 (vm, 
«me
, 
size
, 
numa_node
, 
Êags
, 
idx
);

145 
	}
}

147 
Æways_ölöe
 

148 
	$vlib_physmem_ªgi⁄_‰ì
 (
vlib_maö_t
 *
vm
,

149 
vlib_physmem_ªgi⁄_ödex_t
 
idx
)

151 
vm
->
	`os_physmem_ªgi⁄_‰ì
 (vm, 
idx
);

152 
	}
}

	@/usr/include/vlib/threads.h

15 #i‚de‡
ö˛uded_vlib_thªads_h


16 
	#ö˛uded_vlib_thªads_h


	)

18 
	~<vlib/maö.h
>

19 
	~<löux/sched.h
>

37 
vlib_maö_t
 **
vlib_maös
;

39 
vlib_£t_thªad_«me
 (*
«me
);

42 (
	tvlib_thªad_fun˘i⁄_t
Ë(*
	t¨g
);

44 
	svlib_thªad_ªgi°øti⁄_


47 
vlib_thªad_ªgi°øti⁄_
 *
√xt
;

50 *
«me
;

51 *
sh‹t_«me
;

52 
vlib_thªad_fun˘i⁄_t
 *
fun˘i⁄
;

53 
uw‹d
 
mhóp_size
;

54 
fixed_cou¡
;

55 
u32
 
cou¡
;

56 
no_d©a_°ru˘uª_˛⁄e
;

57 
u32
 
‰ame_queue_√…s
;

60 
u£_±hªads
;

61 
u32
 
fú°_ödex
;

62 
uw‹d
 *
c‹emask
;

63 } 
	tvlib_thªad_ªgi°øti⁄_t
;

70 #i‚de‡
VLIB_MAX_CPUS


71 
	#VLIB_MAX_CPUS
 256

	)

74 #i‡
VLIB_MAX_CPUS
 > 
CLIB_MAX_MHEAPS


75 #îr‹ 
PÀa£
 
ö¸ó£
 
numbî
 
of
 
≥r
-
˝u
 
mhóps


78 
	#VLIB_CPU_MASK
 (
VLIB_MAX_CPUS
 - 1Ë

	)

79 
	#VLIB_OFFSET_MASK
 (~
VLIB_CPU_MASK
)

	)

81 
	#VLIB_LOG2_THREAD_STACK_SIZE
 (21)

	)

82 
	#VLIB_THREAD_STACK_SIZE
 (1<<
VLIB_LOG2_THREAD_STACK_SIZE
)

	)

86 
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
,

87 } 
	tvlib_‰ame_queue_msg_ty≥_t
;

91 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

92 vﬁ©ûê
u32
 
vÆid
;

93 
u32
 
msg_ty≥
;

94 
u32
 
n_ve˘‹s
;

95 
u32
 
œ°_n_ve˘‹s
;

98 
u32
 
buf„r_ödex
[
VLIB_FRAME_SIZE
];

100 
	tvlib_‰ame_queue_ñt_t
;

105 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

106 vﬁ©ûê
u32
 *
waô_©_b¨rõr
;

107 vﬁ©ûê
u32
 *
w‹kîs_©_b¨rõr
;

110 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

111 *
thªad_mhóp
;

112 
u8
 *
thªad_°ack
;

113 (*
thªad_fun˘i⁄
) (*);

114 *
thªad_fun˘i⁄_¨g
;

115 
i64
 
ªcursi⁄_Àvñ
;

116 
ñog_åack_t
 
ñog_åack
;

117 
u32
 
ö°™˚_id
;

118 
vlib_thªad_ªgi°øti⁄_t
 *
ªgi°øti⁄
;

119 
u8
 *
«me
;

120 
u64
 
b¨rõr_sync_cou¡
;

121 #ifde‡
BARRIER_TRACING


122 c⁄° *
b¨rõr_ˇŒî
;

123 c⁄° *
b¨rõr_c⁄ãxt
;

125 vﬁ©ûê
u32
 *
node_ªf‹ks_ªquúed
;

127 
lwp
;

128 
lc‹e_id
;

129 
±hªad_t
 
thªad_id
;

130 } 
	tvlib_w‹kî_thªad_t
;

132 
vlib_w‹kî_thªad_t
 *
vlib_w‹kî_thªads
;

137 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

138 vﬁ©ûê
u64
 
èû
;

139 
u64
 
íqueues
;

140 
u64
 
íqueue_ticks
;

141 
u64
 
íqueue_ve˘‹s
;

142 
u32
 
íqueue_fuŒ_evíts
;

145 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe1
);

146 vﬁ©ûê
u64
 
hód
;

147 
u64
 
dequeues
;

148 
u64
 
dequeue_ticks
;

149 
u64
 
dequeue_ve˘‹s
;

150 
u64
 
åa˚
;

151 
u64
 
ve˘‹_thªshﬁd
;

154 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe2
);

155 vﬁ©ûê
u64
 
hód_höt
;

158 
	`CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe3
);

159 
vlib_‰ame_queue_ñt_t
 *
ñts
;

160 
u32
 
√…s
;

162 
	tvlib_‰ame_queue_t
;

166 
u32
 
node_ödex
;

167 
vlib_‰ame_queue_t
 **
vlib_‰ame_queues
;

170 
‰ame_queue_åa˚_t
 *
‰ame_queue_åa˚s
;

171 
‰ame_queue_√…_cou¡î_t
 *
‰ame_queue_hi°ogøm
;

172 } 
	tvlib_‰ame_queue_maö_t
;

176 
uw‹d
 
node_ödex
;

177 
uw‹d
 
ty≥_›aque
;

178 
uw‹d
 
d©a
;

179 } 
	tvlib_¥o˚ss_sig«l_evít_mt_¨gs_t
;

182 
˛ib_îr‹_t
 *
	`vlib_thªad_öô
 (
vlib_maö_t
 * 
vm
);

184 
	`vlib_‰ame_queue_íqueue
 (
vlib_maö_t
 * 
vm
, 
u32
 
node_ru¡ime_ödex
,

185 
u32
 
‰ame_queue_ödex
, 
vlib_‰ame_t
 * 
‰ame
,

186 
vlib_‰ame_queue_msg_ty≥_t
 
ty≥
);

189 
	`vlib_‰ame_queue_dequeue
 (
vlib_maö_t
 * 
vm
, 
vlib_‰ame_queue_maö_t
 * 
fqm
);

191 
	`vlib_w‹kî_thªad_node_ru¡ime_upd©e
 ();

193 
	`vlib_¸óã_w‹kî_thªads
 (
vlib_maö_t
 * 
vm
, 
n
,

194 (*
thªad_fun˘i⁄
) (*));

196 
	`vlib_w‹kî_thªad_öô
 (
vlib_w‹kî_thªad_t
 * 
w
);

197 
u32
 
	`vlib_‰ame_queue_maö_öô
 (u32 
node_ödex
, u32 
‰ame_queue_√…s
);

200 
	#BARRIER_SYNC_DELAY
 (0.030000)

	)

202 #i‡
CLIB_DEBUG
 > 0

204 
	#BARRIER_SYNC_TIMEOUT
 (600.1)

	)

206 
	#BARRIER_SYNC_TIMEOUT
 (1.0)

	)

209 #ifde‡
BARRIER_TRACING


210 
	#vlib_w‹kî_thªad_b¨rõr_sync
(
X
Ë{
vlib_w‹kî_thªads
[0].
b¨rõr_ˇŒî
=
__FUNCTION__
;
	`vlib_w‹kî_thªad_b¨rõr_sync_öt
(X);
	}

	)
}

212 
	#vlib_w‹kî_thªad_b¨rõr_sync
(
X
Ë
	`vlib_w‹kî_thªad_b¨rõr_sync_öt
(X)

	)

216 
vlib_w‹kî_thªad_b¨rõr_sync_öt
 (
vlib_maö_t
 * 
vm
);

217 
vlib_w‹kî_thªad_b¨rõr_ªÀa£
 (
vlib_maö_t
 * 
vm
);

218 
vlib_w‹kî_thªad_node_ªf‹k
 ();

220 
°©ic_Æways_ölöe
 
uw‹d


221 
	$vlib_gë_thªad_ödex
 ()

223  
__os_thªad_ödex
;

224 
	}
}

226 
Æways_ölöe
 

227 
	$vlib_smp_unß„_w¨nög
 ()

229 i‡(
CLIB_DEBUG
 > 0)

231 i‡(
	`vlib_gë_thªad_ödex
 ())

232 
	`ff‹m©
 (
°dîr
, "%s: SMP unß„ w¨nög...\n", 
__FUNCTION__
);

234 
	}
}

238 
	mVLIB_WORKER_THREAD_FORK_FIXUP_ILLEGAL
 = 0,

239 
	mVLIB_WORKER_THREAD_FORK_FIXUP_NEW_SW_IF_INDEX
,

240 } 
	tvlib_f‹k_fixup_t
;

242 
vlib_w‹kî_thªad_f‹k_fixup
 (
vlib_f‹k_fixup_t
 
which
);

244 
	#f‹óch_vlib_maö
(
body
) \

246 
vlib_maö_t
 ** 
__vlib_maös
 = 0, *
this_vlib_maö
; \

247 
ii
; \

249 
ii
 = 0; iò< 
	`vec_Àn
 (
vlib_maös
); ii++) \

251 
this_vlib_maö
 = 
vlib_maös
[
ii
]; \

252 
	`ASSERT
 (
ii
 == 0 || \

253 
this_vlib_maö
->
∑rked_©_b¨rõr
 == 1); \

254 i‡(
this_vlib_maö
) \

255 
	`vec_add1
 (
__vlib_maös
, 
this_vlib_maö
); \

258 
ii
 = 0; iò< 
	`vec_Àn
 (
__vlib_maös
); ii++) \

260 
this_vlib_maö
 = 
__vlib_maös
[
ii
]; \

262 (
body
); \

264 
	`vec_‰ì
 (
__vlib_maös
); \

265 } 0);

	)

267 
	#f‹óch_sched_pﬁicy
 \

268 
	`_
(
SCHED_OTHER
, 
OTHER
, "other") \

269 
	`_
(
SCHED_BATCH
, 
BATCH
, "batch") \

270 
	`_
(
SCHED_IDLE
, 
IDLE
, "idle") \

271 
	`_
(
SCHED_FIFO
, 
FIFO
, "fifo") \

272 
	`_
(
SCHED_RR
, 
RR
, "º")

	)

276 
	#_
(
v
,
f
,
s
Ë
SCHED_POLICY_
##‡v,

	)

277 
	mf‹óch_sched_pﬁicy


278 #unde‡
_


279 
	mSCHED_POLICY_N
,

280 } 
	tsched_pﬁicy_t
;

284 
	m˛ib_îr‹_t
 *(*
	mvlib_œunch_thªad_cb
Ë(*
	mÂ
, 
vlib_w‹kî_thªad_t
 * 
	mw
,

285 
	mlc‹e_id
);

286 
	m˛ib_îr‹_t
 *(*
	mvlib_thªad_£t_lc‹e_cb
Ë(
u32
 
	mthªad
, 
u16
 
	mlc‹e
);

287 } 
	tvlib_thªad_ˇŒbacks_t
;

292 
vlib_thªad_ªgi°øti⁄_t
 *
	m√xt
;

295 
vlib_thªad_ªgi°øti⁄_t
 **
	mªgi°øti⁄s
;

297 
uw‹d
 *
	mthªad_ªgi°øti⁄s_by_«me
;

299 
vlib_w‹kî_thªad_t
 *
	mw‹kî_thªads
;

305 
	mu£_±hªads
;

308 
u32
 
	mn_vlib_maös
;

311 
u32
 
	mn_thªad_°acks
;

314 
u32
 
	mn_±hªads
;

317 
u32
 
	mn_thªads
;

320 
u32
 
	mskù_c‹es
;

323 
u8
 *
	mthªad_¥efix
;

326 
u8
 
	mmaö_lc‹e
;

329 
uw‹d
 *
	m˝u_c‹e_bôm≠
;

332 
uw‹d
 *
	m˝u_sockë_bôm≠
;

335 
vlib_‰ame_queue_maö_t
 *
	m‰ame_queue_maös
;

338 vﬁ©ûê
u32
 
	mw‹kî_thªad_ªÀa£
;

341 
u32
 
	msched_pﬁicy
;

344 
u32
 
	msched_¥i‹ôy
;

347 
vlib_thªad_ˇŒbacks_t
 
	mcb
;

348 
	mexã∫_thªad_mgmt
;

349 } 
	tvlib_thªad_maö_t
;

351 
vlib_thªad_maö_t
 
vlib_thªad_maö
;

353 
	~<vlib/globÆ_funcs.h
>

355 
	#VLIB_REGISTER_THREAD
(
x
,...) \

356 
__VA_ARGS__
 
vlib_thªad_ªgi°øti⁄_t
 
x
; \

357 
__vlib_add_thªad_ªgi°øti⁄_
##
	`x
 () \

358 
	`__©åibuã__
((
__c⁄°ru˘‹__
)) ; \

359 
__vlib_add_thªad_ªgi°øti⁄_
##
	`x
 () \

361 
vlib_thªad_maö_t
 * 
tm
 = &
vlib_thªad_maö
; \

362 
x
.
√xt
 = 
tm
->next; \

363 
tm
->
√xt
 = &
x
; \

365 
__VA_ARGS__
 
vlib_thªad_ªgi°øti⁄_t
 
x


	)

367 
Æways_ölöe
 
u32


368 
	$vlib_num_w‹kîs
 ()

370  
vlib_thªad_maö
.
n_vlib_maös
 - 1;

371 
	}
}

373 
Æways_ölöe
 
u32


374 
	$vlib_gë_w‹kî_thªad_ödex
 (
u32
 
w‹kî_ödex
)

376  
w‹kî_ödex
 + 1;

377 
	}
}

379 
Æways_ölöe
 
u32


380 
	$vlib_gë_w‹kî_ödex
 (
u32
 
thªad_ödex
)

382  
thªad_ödex
 - 1;

383 
	}
}

385 
Æways_ölöe
 
u32


386 
	$vlib_gë_cuºít_w‹kî_ödex
 ()

388  
	`vlib_gë_thªad_ödex
 () - 1;

389 
	}
}

391 
ölöe
 

392 
	$vlib_w‹kî_thªad_b¨rõr_check
 ()

394 i‡(
	`PREDICT_FALSE
 (*
vlib_w‹kî_thªads
->
waô_©_b¨rõr
))

396 
vlib_maö_t
 *
vm
;

397 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, 1);

398 i‡(
CLIB_DEBUG
 > 0)

400 
vm
 = 
	`vlib_gë_maö
 ();

401 
vm
->
∑rked_©_b¨rõr
 = 1;

403 *
vlib_w‹kî_thªads
->
waô_©_b¨rõr
)

405 i‡(
CLIB_DEBUG
 > 0)

406 
vm
->
∑rked_©_b¨rõr
 = 0;

407 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
w‹kîs_©_b¨rõr
, -1);

409 i‡(
	`PREDICT_FALSE
 (*
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
))

411 
	`vlib_w‹kî_thªad_node_ªf‹k
 ();

412 
	`˛ib_smp_©omic_add
 (
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
,

414 *
vlib_w‹kî_thªads
->
node_ªf‹ks_ªquúed
)

418 
	}
}

420 
Æways_ölöe
 
vlib_maö_t
 *

421 
	$vlib_gë_w‹kî_vlib_maö
 (
u32
 
w‹kî_ödex
)

423 
vlib_maö_t
 *
vm
;

424 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

425 
	`ASSERT
 (
w‹kî_ödex
 < 
tm
->
n_vlib_maös
 - 1);

426 
vm
 = 
vlib_maös
[
w‹kî_ödex
 + 1];

427 
	`ASSERT
 (
vm
);

428  
vm
;

429 
	}
}

431 
ölöe
 

432 
	$vlib_put_‰ame_queue_ñt
 (
vlib_‰ame_queue_ñt_t
 * 
hf
)

434 
	`CLIB_MEMORY_BARRIER
 ();

435 
hf
->
vÆid
 = 1;

436 
	}
}

438 
ölöe
 
vlib_‰ame_queue_ñt_t
 *

439 
	$vlib_gë_‰ame_queue_ñt
 (
u32
 
‰ame_queue_ödex
, u32 
ödex
)

441 
vlib_‰ame_queue_t
 *
fq
;

442 
vlib_‰ame_queue_ñt_t
 *
ñt
;

443 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

444 
vlib_‰ame_queue_maö_t
 *
fqm
 =

445 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
‰ame_queue_ödex
);

446 
u64
 
√w_èû
;

448 
fq
 = 
fqm
->
vlib_‰ame_queues
[
ödex
];

449 
	`ASSERT
 (
fq
);

451 
√w_èû
 = 
	`__sync_add_™d_„tch
 (&
fq
->
èû
, 1);

454 
√w_èû
 >
fq
->
hód_höt
 + fq->
√…s
)

455 
	`vlib_w‹kî_thªad_b¨rõr_check
 ();

457 
ñt
 = 
fq
->
ñts
 + (
√w_èû
 & (fq->
√…s
 - 1));

460 
ñt
->
vÆid
)

463 
ñt
->
msg_ty≥
 = 
VLIB_FRAME_QUEUE_ELT_DISPATCH_FRAME
;

464 
ñt
->
œ°_n_ve˘‹s
 =É…->
n_ve˘‹s
 = 0;

466  
ñt
;

467 
	}
}

469 
ölöe
 
vlib_‰ame_queue_t
 *

470 
	$is_vlib_‰ame_queue_c⁄ge°ed
 (
u32
 
‰ame_queue_ödex
,

471 
u32
 
ödex
,

472 
u32
 
queue_hi_thªsh
,

473 
vlib_‰ame_queue_t
 **

474 
h™doff_queue_by_w‹kî_ödex
)

476 
vlib_‰ame_queue_t
 *
fq
;

477 
vlib_thªad_maö_t
 *
tm
 = &
vlib_thªad_maö
;

478 
vlib_‰ame_queue_maö_t
 *
fqm
 =

479 
	`vec_ñt_©_ödex
 (
tm
->
‰ame_queue_maös
, 
‰ame_queue_ödex
);

481 
fq
 = 
h™doff_queue_by_w‹kî_ödex
[
ödex
];

482 i‡(
fq
 !(
vlib_‰ame_queue_t
 *) (~0))

483  
fq
;

485 
fq
 = 
fqm
->
vlib_‰ame_queues
[
ödex
];

486 
	`ASSERT
 (
fq
);

488 i‡(
	`PREDICT_FALSE
 (
fq
->
èû
 >(fq->
hód_höt
 + 
queue_hi_thªsh
)))

493 
h™doff_queue_by_w‹kî_ödex
[
ödex
] = 
fq
;

494 
fq
->
íqueue_fuŒ_evíts
++;

495  
fq
;

498  
NULL
;

499 
	}
}

501 
ölöe
 
vlib_‰ame_queue_ñt_t
 *

502 
	$vlib_gë_w‹kî_h™doff_queue_ñt
 (
u32
 
‰ame_queue_ödex
,

503 
u32
 
vlib_w‹kî_ödex
,

504 
vlib_‰ame_queue_ñt_t
 **

505 
h™doff_queue_ñt_by_w‹kî_ödex
)

507 
vlib_‰ame_queue_ñt_t
 *
ñt
;

509 i‡(
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
])

510  
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
];

512 
ñt
 = 
	`vlib_gë_‰ame_queue_ñt
 (
‰ame_queue_ödex
, 
vlib_w‹kî_ödex
);

514 
h™doff_queue_ñt_by_w‹kî_ödex
[
vlib_w‹kî_ödex
] = 
ñt
;

516  
ñt
;

517 
	}
}

519 
u8
 *
vlib_thªad_°ack_öô
 (
uw‹d
 
thªad_ödex
);

520 
vlib_thªad_cb_ªgi°î
 (
vlib_maö_t
 *
vm
,

521 
vlib_thªad_ˇŒbacks_t
 * 
cb
);

522 *
Ωc_ˇŒ_maö_thªad_cb_‚
;

525 
vlib_¥o˚ss_sig«l_evít_mt_hñ≥r
 (
vlib_¥o˚ss_sig«l_evít_mt_¨gs_t
 *

526 
¨gs
);

527 
vlib_Ωc_ˇŒ_maö_thªad
 (*
fun˘i⁄
, 
u8
 * 
¨gs
, 
u32
 
size
);

	@/usr/include/vlib/trace.h

40 #i‚de‡
ö˛uded_vlib_åa˚_h


41 
	#ö˛uded_vlib_åa˚_h


	)

43 
	~<vµö‰a/poﬁ.h
>

48 
u64
 
	mtime
;

51 
u32
 
	mnode_ödex
;

54 
u32
 
	mn_d©a
;

57 
u8
 
	md©a
[0];

58 } 
	tvlib_åa˚_hódî_t
;

63 
u32
 
	mcou¡
;

66 
u32
 
	mlimô
;

67 } 
	tvlib_åa˚_node_t
;

72 
vlib_åa˚_hódî_t
 **
	måa˚_buf„r_poﬁ
;

74 
u32
 
	mœ°_maö_lo›_cou¡
;

75 
u32
 
	mfûãr_node_ödex
;

76 
u32
 
	mfûãr_Êag
;

77 
	#FILTER_FLAG_NONE
 0

	)

78 
	#FILTER_FLAG_INCLUDE
 1

	)

79 
	#FILTER_FLAG_EXCLUDE
 2

	)

80 
u32
 
	mfûãr_cou¡
;

83 
u32
 
	måa˚_a˘ive_höt
;

86 
vlib_åa˚_node_t
 *
	mnodes
;

89 
	mvîbo£
;

90 } 
	tvlib_åa˚_maö_t
;

	@/usr/include/vlib/trace_funcs.h

40 #i‚de‡
ö˛uded_vlib_åa˚_funcs_h


41 
	#ö˛uded_vlib_åa˚_funcs_h


	)

43 
Æways_ölöe
 

44 
	$vlib_vÆid©e_åa˚
 (
vlib_åa˚_maö_t
 * 
tm
, 
vlib_buf„r_t
 * 
b
)

50 
	`ASSERT
 (1 || 
b
->
Êags
 & 
VLIB_BUFFER_IS_TRACED
);

51 
	`ASSERT
 (!
	`poﬁ_is_‰ì_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
b
->
åa˚_ödex
));

52 
	}
}

54 
Æways_ölöe
 *

55 
	$vlib_add_åa˚
 (
vlib_maö_t
 * 
vm
,

56 
vlib_node_ru¡ime_t
 * 
r
, 
vlib_buf„r_t
 * 
b
, 
u32
 
n_d©a_byãs
)

58 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

59 
vlib_åa˚_hódî_t
 *
h
;

60 
u32
 
n_d©a_w‹ds
;

62 
	`vlib_vÆid©e_åa˚
 (
tm
, 
b
);

64 
n_d©a_byãs
 = 
	`round_pow2
 (n_d©a_byãs,  (
h
[0]));

65 
n_d©a_w‹ds
 = 
n_d©a_byãs
 /  (
h
[0]);

66 
	`vec_add2_Æig√d
 (
tm
->
åa˚_buf„r_poﬁ
[
b
->
åa˚_ödex
], 
h
,

67 1 + 
n_d©a_w‹ds
,  (
h
[0]));

69 
h
->
time
 = 
vm
->
˝u_time_œ°_node_di•©ch
;

70 
h
->
n_d©a
 = 
n_d©a_w‹ds
;

71 
h
->
node_ödex
 = 
r
->node_index;

73  
h
->
d©a
;

74 
	}
}

76 
Æways_ölöe
 
vlib_åa˚_hódî_t
 *

77 
	$vlib_åa˚_hódî_√xt
 (
vlib_åa˚_hódî_t
 * 
h
)

79  
h
 + 1 + h->
n_d©a
;

80 
	}
}

82 
Æways_ölöe
 

83 
	$vlib_‰ì_åa˚
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
)

85 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

86 
	`vlib_vÆid©e_åa˚
 (
tm
, 
b
);

87 
	`_vec_Àn
 (
tm
->
åa˚_buf„r_poﬁ
[
b
->
åa˚_ödex
]) = 0;

88 
	`poﬁ_put_ödex
 (
tm
->
åa˚_buf„r_poﬁ
, 
b
->
åa˚_ödex
);

89 
	}
}

91 
Æways_ölöe
 

92 
	$vlib_åa˚_√xt_‰ame
 (
vlib_maö_t
 * 
vm
,

93 
vlib_node_ru¡ime_t
 * 
r
, 
u32
 
√xt_ödex
)

95 
vlib_√xt_‰ame_t
 *
nf
;

96 
nf
 = 
	`vlib_node_ru¡ime_gë_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

97 
nf
->
Êags
 |
VLIB_FRAME_TRACE
;

98 
	}
}

100 
åa˚_≠∂y_fûãr
 (
vlib_maö_t
 * 
vm
);

103 
Æways_ölöe
 

104 
	$vlib_åa˚_buf„r
 (
vlib_maö_t
 * 
vm
,

105 
vlib_node_ru¡ime_t
 * 
r
,

106 
u32
 
√xt_ödex
, 
vlib_buf„r_t
 * 
b
, 
fﬁlow_chaö
)

108 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

109 
vlib_åa˚_hódî_t
 **
h
;

115 i‡(
tm
->
œ°_maö_lo›_cou¡
 !
vm
->
maö_lo›_cou¡
)

117 
tm
->
œ°_maö_lo›_cou¡
 = 
vm
->
maö_lo›_cou¡
;

118 
	`åa˚_≠∂y_fûãr
 (
vm
);

121 
	`vlib_åa˚_√xt_‰ame
 (
vm
, 
r
, 
√xt_ödex
);

123 
	`poﬁ_gë
 (
tm
->
åa˚_buf„r_poﬁ
, 
h
);

127 
b
->
Êags
 |
VLIB_BUFFER_IS_TRACED
;

128 
b
->
åa˚_ödex
 = 
h
 - 
tm
->
åa˚_buf„r_poﬁ
;

130 
fﬁlow_chaö
 && (
b
 = 
	`vlib_gë_√xt_buf„r
 (
vm
, b)));

131 
	}
}

133 
Æways_ölöe
 

134 
	$vlib_buf„r_c›y_åa˚_Êag
 (
vlib_maö_t
 * 
vm
, 
vlib_buf„r_t
 * 
b
,

135 
u32
 
bi_èrgë
)

137 
vlib_buf„r_t
 *
b_èrgë
 = 
	`vlib_gë_buf„r
 (
vm
, 
bi_èrgë
);

138 
b_èrgë
->
Êags
 |
b
->Êag†& 
VLIB_BUFFER_IS_TRACED
;

139 
b_èrgë
->
åa˚_ödex
 = 
b
->trace_index;

140 
	}
}

142 
Æways_ölöe
 
u32


143 
	$vlib_gë_åa˚_cou¡
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
π
)

145 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

146 
vlib_åa˚_node_t
 *
ä
;

147 
n
;

149 i‡(
π
->
node_ödex
 >
	`vec_Àn
 (
tm
->
nodes
))

151 
ä
 = 
tm
->
nodes
 + 
π
->
node_ödex
;

152 
n
 = 
ä
->
limô
 -Ån->
cou¡
;

153 
	`ASSERT
 (
n
 >= 0);

155  
n
;

156 
	}
}

158 
Æways_ölöe
 

159 
	$vlib_£t_åa˚_cou¡
 (
vlib_maö_t
 * 
vm
, 
vlib_node_ru¡ime_t
 * 
π
, 
u32
 
cou¡
)

161 
vlib_åa˚_maö_t
 *
tm
 = &
vm
->
åa˚_maö
;

162 
vlib_åa˚_node_t
 *
ä
 = 
	`vec_ñt_©_ödex
 (
tm
->
nodes
, 
π
->
node_ödex
);

164 
	`ASSERT
 (
cou¡
 <
ä
->
limô
);

165 
ä
->
cou¡
 =Ån->
limô
 - count;

166 
	}
}

170 
vlib_åa˚_‰ame_buf„rs_⁄ly
 (
vlib_maö_t
 * 
vm
,

171 
vlib_node_ru¡ime_t
 * 
node
,

172 
u32
 * 
buf„rs
,

173 
uw‹d
 
n_buf„rs
,

174 
uw‹d
 
√xt_buf„r_°ride
,

175 
uw‹d
 
n_buf„r_d©a_byãs_ö_åa˚
);

	@/usr/include/vlib/unix/cj.h

20 #i‚de‡
__ö˛uded_cj_h__


21 
	#__ö˛uded_cj_h__


	)

25 
f64
 
	mtime
;

26 
u32
 
	mthªad_ödex
;

27 
u32
 
	mty≥
;

28 
u64
 
	md©a
[2];

29 } 
	tcj_ªc‹d_t
;

33 vﬁ©ûê
u64
 
	mèû
;

34 
cj_ªc‹d_t
 *
	mªc‹ds
;

35 
u32
 
	mnum_ªc‹ds
;

36 vﬁ©ûê
u32
 
	míabÀ
;

38 
vlib_maö_t
 *
	mvlib_maö
;

39 } 
	tcj_maö_t
;

41 
cj_log
 (
u32
 
ty≥
, *
d©a0
, *
d©a1
);

48 
	#DECLARE_CJ_GLOBAL_LOG
 \

49 
	`cj_globÆ_log
 (
ty≥
, * 
d©a0
, * 
d©a1
) \

50 
	`__©åibuã__
 ((
wók
)); \

52 
__cj_ty≥
; \

53 * 
__cj_d©a0
; \

54 * 
__cj_d©a1
; \

57 
	`cj_globÆ_log
 (
ty≥
, * 
d©a0
, * 
d©a1
) \

59 
__cj_ty≥
 = 
ty≥
; \

60 
__cj_d©a0
 = 
d©a0
; \

61 
__cj_d©a1
 = 
d©a1
; \

62 }

	)

64 
	#CJ_GLOBAL_LOG_PROTOTYPE


	)

66 
	$cj_globÆ_log
 (
ty≥
, *
d©a0
, *
d©a1
)

67 
	`__©åibuã__
 ((
wók
));

69 
	`cj_°›
 ();

	@/usr/include/vlib/unix/mc_socket.h

18 #i‚de‡
__ö˛uded_mc_sockë_h__


19 
	#__ö˛uded_mc_sockë_h__


	)

21 
	~<vlib/unix/unix.h
>

22 
	~<√töë/ö.h
>

26 
	msockë
;

27 
sockaddr_ö
 
	mtx_addr
;

28 } 
	tmc_mu…iˇ°_sockë_t
;

33 
	msockë
;

34 
u32
 
	m˛ib_fûe_ödex
;

36 
u8
 *
	möput_ve˘‹
;

37 
u8
 *
	mouçut_ve˘‹
;

38 
u32
 
	mouçut_ve˘‹_n_wrôãn
;

40 
u32
 
	mc⁄√˘_ö_¥ogªss
;

41 } 
	tmc_sockë_ˇtchup_t
;

43 
	smc_sockë_maö_t


45 
mc_maö_t
 
	mmc_maö
;

48 
mc_mu…iˇ°_sockë_t
 
	mmu…iˇ°_sockës
[
MC_N_TRANSPORT_TYPE
];

51 
	mack_sockë
;

54 
	mˇtchup_£rvî_sockë
;

57 
mc_sockë_ˇtchup_t
 *
	mˇtchups
;

59 
uw‹d
 *
	mˇtchup_ödex_by_fûe_des¸ùt‹
;

61 
u32
 
	mrx_mtu_n_byãs
;

64 
u32
 
	mrx_mtu_n_buf„rs
;

67 
u32
 *
	mrx_buf„rs
;

70 
iovec
 *
	miovecs
;

73 
u32
 
	mif_ù4_addªss_√t_byã_‹dî
;

75 
u32
 
	mack_udp_p‹t
;

76 
u32
 
	mˇtchup_t˝_p‹t
;

79 *
	mmu…iˇ°_öãrÁ˚_«me
;

83 
u32
 
	mmu…iˇ°_tx_ù4_addªss_ho°_byã_‹dî
;

86 
u32
 
	mmu…iˇ°_âl
;

91 
u32
 
	mba£_mu…iˇ°_udp_p‹t_ho°_byã_‹dî
;

92 } 
	tmc_sockë_maö_t
;

94 
Æways_ölöe
 
u32


95 
	$mc_sockë_≥î_id_gë_addªss
 (
mc_≥î_id_t
 
i
)

97 
u32
 
a
 = ((
i
.
as_u8
[0] << 24)

98 | (
i
.
as_u8
[1] << 16) | (i.as_u8[2] << 8) | (i.as_u8[3] << 0));

99  
	`˛ib_ho°_to_√t_u32
 (
a
);

100 
	}
}

102 
Æways_ölöe
 
u32


103 
	$mc_sockë_≥î_id_gë_p‹t
 (
mc_≥î_id_t
 
i
)

105  
	`˛ib_ho°_to_√t_u16
 ((
i
.
as_u8
[4] << 8) | i.as_u8[5]);

106 
	}
}

108 
°©ic_Æways_ölöe
 
mc_≥î_id_t


109 
	$mc_sockë_£t_≥î_id
 (
u32
 
addªss_√t_byã_‹dî
, u32 
p‹t_ho°_byã_‹dî
)

111 
mc_≥î_id_t
 
i
;

112 
u32
 
a
 = 
	`¡ohl
 (
addªss_√t_byã_‹dî
);

113 
u32
 
p
 = 
p‹t_ho°_byã_‹dî
;

114 
i
.
as_u8
[0] = (
a
 >> 24) & 0xff;

115 
i
.
as_u8
[1] = (
a
 >> 16) & 0xff;

116 
i
.
as_u8
[2] = (
a
 >> 8) & 0xff;

117 
i
.
as_u8
[3] = (
a
 >> 0) & 0xff;

118 
i
.
as_u8
[4] = (
p
 >> 8) & 0xff;

119 
i
.
as_u8
[5] = (
p
 >> 0) & 0xff;

120 
i
.
as_u8
[6] = 0;

121 
i
.
as_u8
[7] = 0;

122  
i
;

123 
	}
}

125 
˛ib_îr‹_t
 *
mc_sockë_maö_öô
 (
mc_sockë_maö_t
 * 
msm
,

126 **
ötfc_¥obe_li°
,

127 
n_ötfcs_to_¥obe
);

	@/usr/include/vlib/unix/plugin.h

18 #i‚de‡
__ö˛uded_∂ugö_h__


19 
	#__ö˛uded_∂ugö_h__


	)

21 
	~<vlib/vlib.h
>

22 
	~<vlib/unix/unix.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 
	~<uni°d.h
>

60 
CLIB_PACKED
(struct {

61 
u8
 
deÁu…_dißbÀd
;

62 c⁄° 
vîsi⁄
[32];

63 c⁄° 
vîsi⁄_ªquúed
[32];

64 c⁄° *
óæy_öô
;

65 c⁄° *
des¸ùti⁄
;

66 }Ë
	tvlib_∂ugö_ªgi°øti⁄_t
;

71 
u8
 *
	m«me
;

72 
u8
 *
	mfûíame
;

73 
°©
 
	mfûe_öfo
;

74 *
	mh™dÀ
;

77 
vlib_∂ugö_ªgi°øti⁄_t
 *
	mªg
;

78 *
	mvîsi⁄
;

79 } 
	t∂ugö_öfo_t
;

83 *
	m«me
;

84 
u8
 
	mis_dißbÀd
;

85 
u8
 
	mis_íabÀd
;

86 
u8
 
	mskù_vîsi⁄_check
;

87 } 
	t∂ugö_c⁄fig_t
;

92 
∂ugö_öfo_t
 *
	m∂ugö_öfo
;

93 
uw‹d
 *
	m∂ugö_by_«me_hash
;

96 
u8
 *
	m∂ugö_∑th
;

97 
u8
 *
	m∂ugö_«me_fûãr
;

98 
u8
 *
	mv©_∂ugö_∑th
;

99 
u8
 *
	mv©_∂ugö_«me_fûãr
;

102 
∂ugö_c⁄fig_t
 *
	mc⁄figs
;

103 
uw‹d
 *
	mc⁄fig_ödex_by_«me
;

106 
vlib_maö_t
 *
	mvlib_maö
;

107 } 
	t∂ugö_maö_t
;

109 
∂ugö_maö_t
 
vlib_∂ugö_maö
;

111 
˛ib_îr‹_t
 *
vlib_∂ugö_c⁄fig
 (
vlib_maö_t
 * 
vm
, 
unf‹m©_öput_t
 * 
öput
);

112 
vlib_∂ugö_óæy_öô
 (
vlib_maö_t
 * 
vm
);

113 
vlib_lﬂd_√w_∂ugös
 (
∂ugö_maö_t
 * 
pm
, 
‰om_óæy_öô
);

114 *
vlib_gë_∂ugö_symbﬁ
 (*
∂ugö_«me
, *
symbﬁ_«me
);

115 
u8
 *
vlib_gë_v©_∂ugö_∑th
 ();

117 
	#VLIB_PLUGIN_REGISTER
() \

118 
vlib_∂ugö_ªgi°øti⁄_t
 
vlib_∂ugö_ªgi°øti⁄
 \

119 
	`__©åibuã__
((
	`__£˘i⁄__
(".vlib_∂ugö_ªgi°øti⁄")))

	)

122 
	#vlib_ˇŒ_∂ugö_öô_fun˘i⁄
(
vm
,
p
,
x
) \

124 
˛ib_îr‹_t
 *(*
_f
)(
vlib_maö_t
 *); \

125 
uw‹d
 *
_Âå
 = 0; \

126 
˛ib_îr‹_t
 * 
_îr‹
 = 0; \

127 
_Âå

vlib_gë_∂ugö_symbﬁ
 \

128 (
p
, 
	`CLIB_STRING_MACRO
(
_vlib_öô_fun˘i⁄_
##
x
)); \

129 i‡(
_Âå
 == 0) \

131 
_îr‹
 = 
˛ib_îr‹_ªtu∫
 \

133 
p
, 
	`CLIB_STRING_MACRO
(
_vlib_öô_fun˘i⁄_
##
x
)); \

137 
_f
 = (*)(
_Âå
[0]); \

139 i‡(
_Âå
 && ! 
	`hash_gë
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
)) \

141 
	`hash_£t1
 (
vm
->
öô_fun˘i⁄s_ˇŒed
, 
_f
); \

142 
_îr‹
 = 
	`_f
 (
vm
); \

144 
_îr‹
; \

145 })

	)

	@/usr/include/vlib/unix/unix.h

40 #i‚de‡
ö˛uded_unix_unix_h


41 
	#ö˛uded_unix_unix_h


	)

43 
	~<vµö‰a/fûe.h
>

44 
	~<vµö‰a/sockë.h
>

45 
	~<ãrmios.h
>

49 
f64
 
	mtime
;

50 
˛ib_îr‹_t
 *
	mîr‹
;

51 } 
	tunix_îr‹_hi°‹y_t
;

56 
vlib_maö_t
 *
	mvlib_maö
;

58 
u32
 
	mÊags
;

60 
	#UNIX_FLAG_INTERACTIVE
 (1 << 0)

	)

61 
	#UNIX_FLAG_NODAEMON
 (1 << 1)

	)

64 
˛ib_sockë_t
 
	m˛i_li°í_sockë
;

67 
unix_îr‹_hi°‹y_t
 
	mîr‹_hi°‹y
[128];

68 
u32
 
	mîr‹_hi°‹y_ödex
;

69 
u64
 
	mn_tŸÆ_îr‹s
;

72 
u8
 *
	m°¨tup_c⁄fig_fûíame
;

75 
u8
 *
	mru¡ime_dú
;

78 
u8
 *
	mpidfûe
;

81 vﬁ©ûê
	munix_c⁄fig_com∂ëe
;

84 
u8
 *
	mlog_fûíame
;

85 
	mlog_fd
;

88 
	m˛i_löe_mode
;

91 
u32
 
	m˛i_hi°‹y_limô
;

94 
	m˛i_no_b™√r
;

97 
u32
 
	m˛i_∑gî_buf„r_limô
;

100 
	m˛i_no_∑gî
;

103 
ãrmios
 
	mtio_°dö
;

104 
	mtio_is£t
;

105 } 
	tunix_maö_t
;

108 
unix_maö_t
 
unix_maö
;

109 
˛ib_fûe_maö_t
 
fûe_maö
;

111 
Æways_ölöe
 

112 
	$unix_ßve_îr‹
 (
unix_maö_t
 * 
um
, 
˛ib_îr‹_t
 * 
îr‹
)

114 
unix_îr‹_hi°‹y_t
 *
eh
 = 
um
->
îr‹_hi°‹y
 + um->
îr‹_hi°‹y_ödex
;

115 
	`˛ib_îr‹_‰ì_ve˘‹
 (
eh
->
îr‹
);

116 
eh
->
îr‹
 =Érror;

117 
eh
->
time
 = 
	`vlib_time_now
 (
um
->
vlib_maö
);

118 
um
->
n_tŸÆ_îr‹s
 += 1;

119 i‡(++
um
->
îr‹_hi°‹y_ödex
 >
	`ARRAY_LEN
 (um->
îr‹_hi°‹y
))

120 
um
->
îr‹_hi°‹y_ödex
 = 0;

121 
	}
}

124 
vlib_unix_maö
 (
¨gc
, *
¨gv
[]);

126 
˛ib_îr‹_t
 *
unix_physmem_öô
 (
vlib_maö_t
 * 
vm
);

129 
vlib_unix_˛i_£t_¥om±
 (*
¥om±
);

131 
ölöe
 
unix_maö_t
 *

132 
	$vlib_unix_gë_maö
 ()

134  &
unix_maö
;

135 
	}
}

137 
ölöe
 *

138 
	$vlib_unix_gë_ru¡ime_dú
 ()

140  (*Ë
unix_maö
.
ru¡ime_dú
;

141 
	}
}

144 
u8
 **
vlib_thªad_°acks
;

148 
˛ib_îr‹_t
 *
f‹óch_dúe˘‹y_fûe
 (*
dú_«me
,

149 
˛ib_îr‹_t
 * (*
f
Ë(*
¨g
,

150 
u8
 * 
∑th_«me
,

151 
u8
 * 
fûe_«me
),

152 *
¨g
, 
sˇn_dús
);

154 
˛ib_îr‹_t
 *
vlib_unix_ªcursive_mkdú
 (*
∑th
);

156 
˛ib_îr‹_t
 *
vlib_unix_vÆid©e_ru¡ime_fûe
 (
unix_maö_t
 * 
um
,

157 c⁄° *
∑th
,

158 
u8
 ** 
fuŒ_∑th
);

	@/usr/include/vlib/vlib.h

40 #i‚de‡
ö˛uded_vlib_h


41 
	#ö˛uded_vlib_h


	)

43 
	~<vµö‰a/˛ib.h
>

44 
	~<vµö‰a/ñf_˛ib.h
>

47 
	~<vlib/defs.h
>

50 
	gvlib_maö_t
;

53 
	~<vlib/physmem.h
>

54 
	~<vlib/buf„r.h
>

55 
	~<vlib/˛i.h
>

56 
	~<vlib/cou¡î.h
>

57 
	~<vlib/îr‹.h
>

58 
	~<vlib/öô.h
>

59 
	~<vlib/mc.h
>

60 
	~<vlib/node.h
>

61 
	~<vlib/åa˚.h
>

64 
	~<vlib/maö.h
>

67 
	~<vlib/thªads.h
>

68 
	~<vlib/physmem_funcs.h
>

69 
	~<vlib/buf„r_funcs.h
>

70 
	~<vlib/˛i_funcs.h
>

71 
	~<vlib/îr‹_funcs.h
>

72 
	~<vlib/f‹m©_funcs.h
>

73 
	~<vlib/node_funcs.h
>

74 
	~<vlib/åa˚_funcs.h
>

75 
	~<vlib/globÆ_funcs.h
>

77 
	~<vlib/buf„r_node.h
>

	@/usr/include/vppinfra/bitmap.h

38 #i‚de‡
ö˛uded_˛ib_bôm≠_h


39 
	#ö˛uded_˛ib_bôm≠_h


	)

45 
	~<vµö‰a/vec.h
>

46 
	~<vµö‰a/øndom.h
>

47 
	~<vµö‰a/îr‹.h
>

48 
	~<vµö‰a/bô›s.h
>

50 
uw‹d
 
	t˛ib_bôm≠_t
;

56 
Æways_ölöe
 
uw‹d


57 
	$˛ib_bôm≠_is_zîo
 (
uw‹d
 * 
ai
)

59 
uw‹d
 
i
;

60 
i
 = 0; i < 
	`vec_Àn
 (
ai
); i++)

61 i‡(
ai
[
i
] != 0)

64 
	}
}

71 
Æways_ölöe
 
uw‹d


72 
	$˛ib_bôm≠_is_equÆ
 (
uw‹d
 * 
a
, uw‹d * 
b
)

74 
uw‹d
 
i
;

75 i‡(
	`vec_Àn
 (
a
Ë!vec_À¿(
b
))

77 
i
 = 0; i < 
	`vec_Àn
 (
a
); i++)

78 i‡(
a
[
i
] !
b
[i])

81 
	}
}

87 
	#˛ib_bôm≠_dup
(
v
Ë
	`vec_dup
(v)

	)

92 
	#˛ib_bôm≠_‰ì
(
v
Ë
	`vec_‰ì
(v)

	)

97 
	#˛ib_bôm≠_byãs
(
v
Ë
	`vec_byãs
(v)

	)

102 
	#˛ib_bôm≠_zîo
(
v
Ë
	`vec_zîo
(v)

	)

109 
	#˛ib_bôm≠_Æloc
(
v
,
n_bôs
) \

110 
v
 = 
	`vec_√w
 (
uw‹d
, ((
n_bôs
Ë+ 
	`BITS
 (uw‹dË- 1Ë/ BITS (uw‹d))

	)

112 
	#˛ib_bôm≠_vec_vÆid©e
(
v
,
i
Ë
	`vec_vÆid©e_Æig√d
((v),(i),(
uw‹d
))

	)

115 
	#˛ib_bôm≠_vÆid©e
(
v
,
n_bôs
) \

116 
	`˛ib_bôm≠_vec_vÆid©e
 ((
v
), ((
n_bôs
Ë- 1Ë/ 
	`BITS
 (
uw‹d
))

	)

119 
Æways_ölöe
 
uw‹d
 *

120 
	$_˛ib_bôm≠_ªmove_åaûög_zîos
 (
uw‹d
 * 
a
)

122 
w‹d
 
i
;

123 i‡(
a
)

125 
i
 = 
	`_vec_Àn
 (
a
) - 1; i >= 0; i--)

126 i‡(
a
[
i
] != 0)

128 
	`_vec_Àn
 (
a
Ë
i
 + 1;

130  
a
;

131 
	}
}

140 
Æways_ölöe
 
uw‹d


141 
	$˛ib_bôm≠_£t_no_check
 (
uw‹d
 * 
a
, uw‹d 
i
, uw‹d 
√w_vÆue
)

143 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
a
[0]);

144 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
a
[0]);

145 
uw‹d
 
bô
 = (uw‹dË1 << 
i1
;

146 
uw‹d
 
ai
, 
ﬁd_vÆue
;

151 
ai
 = 
a
[
i0
];

152 
ﬁd_vÆue
 = (
ai
 & 
bô
) != 0;

153 
ai
 &~
bô
;

154 
ai
 |((
uw‹d
Ë(
√w_vÆue
 !0)Ë<< 
i1
;

155 
a
[
i0
] = 
ai
;

156  
ﬁd_vÆue
;

157 
	}
}

166 
Æways_ölöe
 
uw‹d
 *

167 
	$˛ib_bôm≠_£t
 (
uw‹d
 * 
ai
, uw‹d 
i
, uw‹d 
vÆue
)

169 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

170 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

171 
uw‹d
 
a
;

174 i‡(
vÆue
 =0 && 
i0
 >
	`vec_Àn
 (
ai
))

175  
ai
;

177 
	`˛ib_bôm≠_vec_vÆid©e
 (
ai
, 
i0
);

179 
a
 = 
ai
[
i0
];

180 
a
 &~((
uw‹d
Ë1 << 
i1
);

181 
a
 |((
uw‹d
Ë(
vÆue
 !0)Ë<< 
i1
;

182 
ai
[
i0
] = 
a
;

185 i‡(
a
 == 0)

186 
ai
 = 
	`_˛ib_bôm≠_ªmove_åaûög_zîos
 (ai);

188  
ai
;

189 
	}
}

196 
Æways_ölöe
 
uw‹d


197 
	$˛ib_bôm≠_gë
 (
uw‹d
 * 
ai
, uw‹d 
i
)

199 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

200 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

201  
i0
 < 
	`vec_Àn
 (
ai
Ë&& 0 !(◊i[i0] >> 
i1
) & 1);

202 
	}
}

211 
Æways_ölöe
 
uw‹d


212 
	$˛ib_bôm≠_gë_no_check
 (
uw‹d
 * 
ai
, uw‹d 
i
)

214 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

215 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

216  0 !((
ai
[
i0
] >> 
i1
) & 1);

217 
	}
}

219 
Æways_ölöe
 
uw‹d


220 
	$˛ib_bôm≠_gë_mu…ùÀ_no_check
 (
uw‹d
 * 
ai
, uw‹d 
i
, uw‹d 
n_bôs
)

222 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

223 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

224 
	`ASSERT
 (
i1
 + 
n_bôs
 <
	`BITS
 (
uw‹d
));

225  0 !((
ai
[
i0
] >> 
i1
Ë& 
	`pow2_mask
 (
n_bôs
));

226 
	}
}

234 
Æways_ölöe
 
uw‹d


235 
	$˛ib_bôm≠_gë_mu…ùÀ
 (
uw‹d
 * 
bôm≠
, uw‹d 
i
, uw‹d 
n_bôs
)

237 
uw‹d
 
i0
, 
i1
, 
ªsu…
;

238 
uw‹d
 
l
 = 
	`vec_Àn
 (
bôm≠
);

240 
	`ASSERT
 (
n_bôs
 <
	`BITS
 (
ªsu…
));

242 
i0
 = 
i
 / 
	`BITS
 (
bôm≠
[0]);

243 
i1
 = 
i
 % 
	`BITS
 (
bôm≠
[0]);

246 
ªsu…
 = 0;

247 i‡(
i0
 < 
l
)

249 
ªsu…
 |(
bôm≠
[
i0
] >> 
i1
);

250 i‡(
n_bôs
 < 
	`BITS
 (
bôm≠
[0]))

251 
ªsu…
 &(((
uw‹d
Ë1 << 
n_bôs
) - 1);

255 
i0
++;

256 i‡(
i1
 + 
n_bôs
 > 
	`BITS
 (
bôm≠
[0]Ë&& 
i0
 < 
l
)

258 
n_bôs
 -
	`BITS
 (
bôm≠
[0]Ë- 
i1
;

259 
ªsu…
 |=

260 (
bôm≠
[
i0
] & (((
uw‹d
Ë1 << 
n_bôs
Ë- 1)Ë<< (
	`BITS
 (bôm≠[0]Ë- 
i1
);

263  
ªsu…
;

264 
	}
}

274 
Æways_ölöe
 
uw‹d
 *

275 
	$˛ib_bôm≠_£t_mu…ùÀ
 (
uw‹d
 * 
bôm≠
, uw‹d 
i
, uw‹d 
vÆue
, uw‹d 
n_bôs
)

277 
uw‹d
 
i0
, 
i1
, 
l
, 
t
, 
m
;

279 
	`ASSERT
 (
n_bôs
 <
	`BITS
 (
vÆue
));

281 
i0
 = 
i
 / 
	`BITS
 (
bôm≠
[0]);

282 
i1
 = 
i
 % 
	`BITS
 (
bôm≠
[0]);

285 
	`˛ib_bôm≠_vec_vÆid©e
 (
bôm≠
, (
i
 + 
n_bôs
Ë/ 
	`BITS
 (bitmap[0]));

286 
l
 = 
	`vec_Àn
 (
bôm≠
);

288 
m
 = ~0;

289 i‡(
n_bôs
 < 
	`BITS
 (
vÆue
))

290 
m
 = (((
uw‹d
Ë1 << 
n_bôs
) - 1);

291 
vÆue
 &
m
;

294 
t
 = 
bôm≠
[
i0
];

295 
t
 &~(
m
 << 
i1
);

296 
t
 |
vÆue
 << 
i1
;

297 
bôm≠
[
i0
] = 
t
;

300 
i0
++;

301 i‡(
i1
 + 
n_bôs
 > 
	`BITS
 (
bôm≠
[0]Ë&& 
i0
 < 
l
)

303 
t
 = 
	`BITS
 (
bôm≠
[0]Ë- 
i1
;

304 
vÆue
 >>
t
;

305 
n_bôs
 -
t
;

306 
t
 = 
bôm≠
[
i0
];

307 
m
 = ((
uw‹d
Ë1 << 
n_bôs
) - 1;

308 
t
 &~
m
;

309 
t
 |
vÆue
;

310 
bôm≠
[
i0
] = 
t
;

313  
bôm≠
;

314 
	}
}

316 
Æways_ölöe
 
uw‹d
 *

317 
	$˛fib_bôm≠_£t_ªgi⁄
 (
uw‹d
 * 
bôm≠
, uw‹d 
i
, uw‹d 
vÆue
, uw‹d 
n_bôs
)

319 
uw‹d
 
a0
, 
a1
, 
b0
;

320 
uw‹d
 
i_íd
, 
mask
;

322 
a0
 = 
i
 / 
	`BITS
 (
bôm≠
[0]);

323 
a1
 = 
i
 % 
	`BITS
 (
bôm≠
[0]);

325 
i_íd
 = 
i
 + 
n_bôs
;

326 
b0
 = 
i_íd
 / 
	`BITS
 (
bôm≠
[0]);

328 
	`˛ib_bôm≠_vec_vÆid©e
 (
bôm≠
, 
b0
);

331 
mask
 = 
n_bôs
 < 
	`BITS
 (
bôm≠
[0]Ë? 
	`pow2_mask
 (n_bits) : ~0;

332 
mask
 <<
a1
;

334 i‡(
vÆue
)

335 
bôm≠
[
a0
] |
mask
;

337 
bôm≠
[
a0
] &~
mask
;

339 
a0
++;á0 < 
b0
;á0++)

340 
bôm≠
[
a0
] = 
vÆue
 ? ~0 : 0;

342 i‡(
a0
 =
b0
)

344 
w‹d
 
n_bôs_À·
 = 
n_bôs
 - (
	`BITS
 (
bôm≠
[0]Ë- 
a1
);

345 
mask
 = 
	`pow2_mask
 (
n_bôs_À·
);

346 i‡(
vÆue
)

347 
bôm≠
[
a0
] |
mask
;

349 
bôm≠
[
a0
] &~
mask
;

352  
bôm≠
;

353 
	}
}

361 
	#˛ib_bôm≠_f‹óch
(
i
,
ai
,
body
) \

363 
uw‹d
 
__bôm≠_i
, 
__bôm≠_ai
, 
__bôm≠_Àn
, 
__bôm≠_fú°_£t
; \

364 
__bôm≠_Àn
 = 
	`vec_Àn
 ((
ai
)); \

365 
__bôm≠_i
 = 0; __bôm≠_ò< 
__bôm≠_Àn
; __bitmap_i++) \

367 
__bôm≠_ai
 = (
ai
)[
__bôm≠_i
]; \

368 
__bôm≠_ai
 != 0) \

370 
__bôm≠_fú°_£t
 = 
	`fú°_£t
 (
__bôm≠_ai
); \

371 (
i
Ë(
__bôm≠_i
 * 
	`BITS
 ((
ai
)[0]) \

372 + 
	`mö_log2
 (
__bôm≠_fú°_£t
)); \

373 dÿ{ 
body
; } 0); \

374 
__bôm≠_ai
 ^
__bôm≠_fú°_£t
; \

377 } 0)

	)

384 
Æways_ölöe
 
uw‹d


385 
	$˛ib_bôm≠_fú°_£t
 (
uw‹d
 * 
ai
)

387 
uw‹d
 
i
;

388 
i
 = 0; i < 
	`vec_Àn
 (
ai
); i++)

390 
uw‹d
 
x
 = 
ai
[
i
];

391 i‡(
x
 != 0)

392  
i
 * 
	`BITS
 (
ai
[0]Ë+ 
	`log2_fú°_£t
 (
x
);

395 
	}
}

401 
Æways_ölöe
 
uw‹d


402 
	$˛ib_bôm≠_œ°_£t
 (
uw‹d
 * 
ai
)

404 
uw‹d
 
i
;

406 
i
 = 
	`vec_Àn
 (
ai
); i > 0; i--)

408 
uw‹d
 
x
 = 
ai
[
i
 - 1];

409 i‡(
x
 != 0)

411 
uw‹d
 
fú°_bô
;

412 
	`cou¡_Àadög_zîos
 (
fú°_bô
, 
x
);

413  (
i
Ë* 
	`BITS
 (
ai
[0]Ë- 
fú°_bô
 - 1;

417 
	}
}

423 
Æways_ölöe
 
uw‹d


424 
	$˛ib_bôm≠_fú°_˛ór
 (
uw‹d
 * 
ai
)

426 
uw‹d
 
i
;

427 
i
 = 0; i < 
	`vec_Àn
 (
ai
); i++)

429 
uw‹d
 
x
 = ~
ai
[
i
];

430 i‡(
x
 != 0)

431  
i
 * 
	`BITS
 (
ai
[0]Ë+ 
	`log2_fú°_£t
 (
x
);

433  
i
 * 
	`BITS
 (
ai
[0]);

434 
	}
}

440 
Æways_ölöe
 
uw‹d


441 
	$˛ib_bôm≠_cou¡_£t_bôs
 (
uw‹d
 * 
ai
)

443 
uw‹d
 
i
;

444 
uw‹d
 
n_£t
 = 0;

445 
i
 = 0; i < 
	`vec_Àn
 (
ai
); i++)

446 
n_£t
 +
	`cou¡_£t_bôs
 (
ai
[
i
]);

447  
n_£t
;

448 
	}
}

456 
Æways_ölöe
 
uw‹d
 *
˛ib_bôm≠_™d
 (uw‹d * 
ai
, uw‹d * 
bi
);

464 
Æways_ölöe
 
uw‹d
 *
˛ib_bôm≠_™dnŸ
 (uw‹d * 
ai
, uw‹d * 
bi
);

472 
Æways_ölöe
 
uw‹d
 *
˛ib_bôm≠_‹
 (uw‹d * 
ai
, uw‹d * 
bi
);

479 
Æways_ölöe
 
uw‹d
 *
˛ib_bôm≠_‹
 (uw‹d * 
ai
, uw‹d * 
bi
);

487 
Æways_ölöe
 
uw‹d
 *
˛ib_bôm≠_x‹
 (uw‹d * 
ai
, uw‹d * 
bi
);

490 
	#_
(
«me
, 
body
, 
check_zîo
) \

491 
Æways_ölöe
 
uw‹d
 * \

492 
˛ib_bôm≠_
##
	`«me
 (
uw‹d
 * 
ai
, uw‹d * 
bi
) \

494 
uw‹d
 
i
, 
a
, 
b
, 
bi_Àn
, 
n_åaûög_zîos
; \

496 
n_åaûög_zîos
 = 0; \

497 
bi_Àn
 = 
	`vec_Àn
 (
bi
); \

498 i‡(
bi_Àn
 > 0) \

499 
	`˛ib_bôm≠_vec_vÆid©e
 (
ai
, 
bi_Àn
 - 1); \

500 
i
 = 0; i < 
	`vec_Àn
 (
ai
); i++) \

502 
a
 = 
ai
[
i
]; \

503 
b
 = 
i
 < 
bi_Àn
 ? 
bi
[i] : 0; \

504 dÿ{ 
body
; } 0); \

505 
ai
[
i
] = 
a
; \

506 i‡(
check_zîo
) \

507 
n_åaûög_zîos
 = 
a
 ? 0 : (n_trailing_zeros + 1); \

509 i‡(
check_zîo
) \

510 
	`_vec_Àn
 (
ai
Ë-
n_åaûög_zîos
; \

511  
ai
; \

512 }

	)

515 
	$_
(
™d
, 
a
 =á & 
b
, 1)

516 
	`_
(
™dnŸ
, 
a
 =á & ~
b
, 1Ë_(
‹
,á =á | b, 0Ë_(
x‹
,á =á ^ b, 1)

517 #unde‡
_


524 
Æways_ölöe
 
uw‹d
 *

525 
	`˛ib_bôm≠_dup_™d
 (
uw‹d
 * 
ai
, uw‹d * 
bi
);

533 
Æways_ölöe
 
uw‹d
 *

534 
	`˛ib_bôm≠_dup_™dnŸ
 (
uw‹d
 * 
ai
, uw‹d * 
bi
);

542 
Æways_ölöe
 
uw‹d
 *

543 
	`˛ib_bôm≠_dup_‹
 (
uw‹d
 * 
ai
, uw‹d * 
bi
);

551 
Æways_ölöe
 
uw‹d
 *

552 
	`˛ib_bôm≠_dup_x‹
 (
uw‹d
 * 
ai
, uw‹d * 
bi
);

554 
	#_
(
«me
) \

555 
Æways_ölöe
 
uw‹d
 * \

556 
˛ib_bôm≠_dup_
##
	`«me
 (
uw‹d
 * 
ai
, uw‹d * 
bi
) \

557 {  
˛ib_bôm≠_
##
	`«me
 (
	`˛ib_bôm≠_dup
 (
ai
), 
bi
); 
	}

	)
}

559 
_
(
™d
);

560 
_
(
™dnŸ
);

561 
_
(
‹
);

562 
_
(
x‹
);

564 #unde‡
_


567 
	#_
(
«me
, 
body
, 
check_zîo
) \

568 
Æways_ölöe
 
uw‹d
 * \

569 
˛ib_bôm≠_
##
	`«me
 (
uw‹d
 * 
ai
, uw‹d 
i
) \

571 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]); \

572 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]); \

573 
uw‹d
 
a
, 
b
; \

574 
	`˛ib_bôm≠_vec_vÆid©e
 (
ai
, 
i0
); \

575 
a
 = 
ai
[
i0
]; \

576 
b
 = (
uw‹d
Ë1 << 
i1
; \

577 dÿ{ 
body
; } 0); \

578 
ai
[
i0
] = 
a
; \

579 i‡(
check_zîo
 && 
a
 == 0) \

580 
ai
 = 
	`_˛ib_bôm≠_ªmove_åaûög_zîos
 (ai); \

581  
ai
; \

582 }

	)

585 
	$_
(
™di
, 
a
 =á & 
b
, 1)

586 
	`_
(
™dnŸi
, 
a
 =á & ~
b
, 1Ë_(
‹i
,á =á | b, 0Ë_(
x‹i
,á =á ^ b, 1)

587 #unde‡
_


594 
Æways_ölöe
 
uw‹d
 *

595 
	$˛ib_bôm≠_øndom
 (
uw‹d
 * 
ai
, uw‹d 
n_bôs
, 
u32
 * 
£ed
)

597 
	`vec_ª£t_Àngth
 (
ai
);

599 i‡(
n_bôs
 > 0)

601 
uw‹d
 
i
 = 
n_bôs
 - 1;

602 
uw‹d
 
i0
, 
i1
;

603 
uw‹d
 
log2_ønd_max
;

605 
log2_ønd_max
 = 
	`mö_log2
 (
	`øndom_u32_max
 ());

607 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

608 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

610 
	`˛ib_bôm≠_vec_vÆid©e
 (
ai
, 
i0
);

611 
i
 = 0; i <
i0
; i++)

613 
uw‹d
 
n
;

614 
n
 = 0;Ç < 
	`BITS
 (
ai
[
i
]);Ç +
log2_ønd_max
)

615 
ai
[
i
] |
	`øndom_u32
 (
£ed
Ë<< 
n
;

617 i‡(
i1
 + 1 < 
	`BITS
 (
ai
[0]))

618 
ai
[
i0
] &(((
uw‹d
Ë1 << (
i1
 + 1)) - 1);

620  
ai
;

621 
	}
}

629 
Æways_ölöe
 
uw‹d


630 
	$˛ib_bôm≠_√xt_£t
 (
uw‹d
 * 
ai
, uw‹d 
i
)

632 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

633 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

634 
uw‹d
 
t
;

636 i‡(
i0
 < 
	`vec_Àn
 (
ai
))

638 
t
 = (
ai
[
i0
] >> 
i1
) << i1;

639 i‡(
t
)

640  
	`log2_fú°_£t
 (
t
Ë+ 
i0
 * 
	`BITS
 (
ai
[0]);

642 
i0
++; i0 < 
	`vec_Àn
 (
ai
); i0++)

644 
t
 = 
ai
[
i0
];

645 i‡(
t
)

646  
	`log2_fú°_£t
 (
t
Ë+ 
i0
 * 
	`BITS
 (
ai
[0]);

651 
	}
}

658 
Æways_ölöe
 
uw‹d


659 
	$˛ib_bôm≠_√xt_˛ór
 (
uw‹d
 * 
ai
, uw‹d 
i
)

661 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
ai
[0]);

662 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
ai
[0]);

663 
uw‹d
 
t
;

665 i‡(
i0
 < 
	`vec_Àn
 (
ai
))

667 
t
 = (~
ai
[
i0
] >> 
i1
) << i1;

668 i‡(
t
)

669  
	`log2_fú°_£t
 (
t
Ë+ 
i0
 * 
	`BITS
 (
ai
[0]);

671 
i0
++; i0 < 
	`vec_Àn
 (
ai
); i0++)

673 
t
 = ~
ai
[
i0
];

674 i‡(
t
)

675  
	`log2_fú°_£t
 (
t
Ë+ 
i0
 * 
	`BITS
 (
ai
[0]);

678  
i
;

679 
	}
}

692 
ölöe
 
uw‹d


693 
	$unf‹m©_bôm≠_li°
 (
unf‹m©_öput_t
 * 
öput
, 
va_li°
 * 
va
)

695 
uw‹d
 **
bôm≠_ªtu∫
 = 
	`va_¨g
 (*
va
, uword **);

696 
uw‹d
 *
bôm≠
 = 0;

698 
u32
 
a
, 
b
;

700 
	`unf‹m©_check_öput
 (
öput
Ë!
UNFORMAT_END_OF_INPUT
)

702 
i
;

703 i‡(
	`unf‹m©
 (
öput
, "%u-%u,", &
a
, &
b
))

705 i‡(
	`unf‹m©
 (
öput
, "%u,", &
a
))

706 
b
 = 
a
;

707 i‡(
	`unf‹m©
 (
öput
, "%u-%u", &
a
, &
b
))

709 i‡(
	`unf‹m©
 (
öput
, "%u", &
a
))

710 
b
 = 
a
;

711 i‡(
bôm≠
)

713 
	`unf‹m©_put_öput
 (
öput
);

717 
îr‹
;

719 i‡(
b
 < 
a
)

720 
îr‹
;

722 
i
 = 
a
; i <
b
; i++)

723 
bôm≠
 = 
	`˛ib_bôm≠_£t
 (bôm≠, 
i
, 1);

725 *
bôm≠_ªtu∫
 = 
bôm≠
;

727 
îr‹
:

728 
	`˛ib_bôm≠_‰ì
 (
bôm≠
);

730 
	}
}

743 
ölöe
 
u8
 *

744 
	$f‹m©_bôm≠_hex
 (
u8
 * 
s
, 
va_li°
 * 
¨gs
)

746 
uw‹d
 *
bôm≠
 = 
	`va_¨g
 (*
¨gs
, uword *);

747 
i
, 
is_åaûög_zîo
 = 1;

749 i‡(!
bôm≠
)

750  
	`f‹m©
 (
s
, "0");

752 
i
 = 
	`vec_byãs
 (
bôm≠
) * 2;

754 
i
 > 0)

756 
u8
 
x
 = 
	`˛ib_bôm≠_gë_mu…ùÀ
 (
bôm≠
, --
i
 * 4, 4);

758 i‡(
x
 && 
is_åaûög_zîo
)

759 
is_åaûög_zîo
 = 0;

761 i‡(
x
 || !
is_åaûög_zîo
)

762 
s
 = 
	`f‹m©
 (s, "%x", 
x
);

764  
s
;

765 
	}
}

	@/usr/include/vppinfra/byte_order.h

38 #i‚de‡
ö˛uded_˛ib_byã_‹dî_h


39 
	#ö˛uded_˛ib_byã_‹dî_h


	)

41 
	~<vµö‰a/˛ib.h
>

43 #i‡(
__BYTE_ORDER__
)==–
__ORDER_LITTLE_ENDIAN__
)

44 
	#CLIB_ARCH_IS_BIG_ENDIAN
 (0)

	)

45 
	#CLIB_ARCH_IS_LITTLE_ENDIAN
 (1)

	)

48 
	#CLIB_ARCH_IS_BIG_ENDIAN
 (1)

	)

49 
	#CLIB_ARCH_IS_LITTLE_ENDIAN
 (0)

	)

53 
	#˛ib_¨ch_is_big_ídün
 
CLIB_ARCH_IS_BIG_ENDIAN


	)

54 
	#˛ib_¨ch_is_lôée_ídün
 
CLIB_ARCH_IS_LITTLE_ENDIAN


	)

56 
Æways_ölöe
 
u16


57 
	$˛ib_byã_sw≠_u16
 (
u16
 
x
)

59 #i‡
	`deföed
 (
__Ørch64__
)

60 i‡(!
	`__buûtö_c⁄°™t_p
 (
x
))

62 
	`__asm__
 ("ªv16 %w0, %w0":"+r" (
x
));

63  
x
;

66  (
x
 >> 8) | (x << 8);

67 
	}
}

69 
Æways_ölöe
 
i16


70 
	$˛ib_byã_sw≠_i16
 (
i16
 
x
)

72  
	`˛ib_byã_sw≠_u16
 (
x
);

73 
	}
}

75 
Æways_ölöe
 
u32


76 
	$˛ib_byã_sw≠_u32
 (
u32
 
x
)

78 #i‡
	`deföed
 (
i386
Ë|| deföed (
__x86_64__
)

79 i‡(!
	`__buûtö_c⁄°™t_p
 (
x
))

81 
asm
 vﬁ©ûê("bsw≠ %0":"Ù" (
x
):"0" (x));

82  
x
;

84 #ñi‡
	`deföed
 (
__Ørch64__
)

85 i‡(!
	`__buûtö_c⁄°™t_p
 (
x
))

87 
	`__asm__
 ("ªv %w0, %w0":"+r" (
x
));

88  
x
;

91  ((
x
 << 24) | ((x & 0xff00) << 8) | ((x >> 8) & 0xff00) | (x >> 24));

92 
	}
}

94 
Æways_ölöe
 
i32


95 
	$˛ib_byã_sw≠_i32
 (
i32
 
x
)

97  
	`˛ib_byã_sw≠_u32
 (
x
);

98 
	}
}

100 
Æways_ölöe
 
u64


101 
	$˛ib_byã_sw≠_u64
 (
u64
 
x
)

103 #i‡
	`deföed
 (
__x86_64__
)

104 i‡(!
	`__buûtö_c⁄°™t_p
 (
x
))

106 
asm
 vﬁ©ûê("bsw≠q %0":"Ù" (
x
):"0" (x));

107  
x
;

109 #ñi‡
	`deföed
 (
__Ørch64__
)

110 i‡(!
	`__buûtö_c⁄°™t_p
 (
x
))

112 
	`__asm__
 ("ªv %0, %0":"+r" (
x
));

113  
x
;

116 
	#_
(
x
,
n
,
i
) \

117 ((((
x
Ë>> (8*(
i
))Ë& 0xffË<< (8*((
n
)-(i)-1)))

	)

118  (
	`_
(
x
, 8, 0) | _(x, 8, 1)

119 | 
	`_
(
x
, 8, 2) | _(x, 8, 3)

120 | 
	`_
(
x
, 8, 4) | _(x, 8, 5) | _(x, 8, 6) | _(x, 8, 7));

121 #unde‡
_


122 
	}
}

124 
Æways_ölöe
 
i64


125 
	$˛ib_byã_sw≠_i64
 (
i64
 
x
)

127  
	`˛ib_byã_sw≠_u64
 (
x
);

128 
	}
}

130 
	#_
(
£x
,
ty≥
) \

132 
Æways_ölöe
 
ty≥
 \

133 
˛ib_ho°_to_
##
£x
##
_
##
	`ty≥
 (
ty≥
 
x
) \

135 i‡(! 
˛ib_¨ch_is_
##
£x
##
_ídün
) \

136 
x
 = 
˛ib_byã_sw≠_
##
	`ty≥
 (x); \

137  
x
; \

140 
Æways_ölöe
 
ty≥
 \

141 
˛ib_ho°_to_
##
£x
##
_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

143 
ty≥
 
v
 = 
x
[0]; \

144  
˛ib_ho°_to_
##
£x
##
_
##
	`ty≥
 (
v
); \

147 
Æways_ölöe
 
ty≥
 \

148 
˛ib_ho°_to_
##
£x
##
_u«lig√d_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

150 
ty≥
 
v
 = 
	`˛ib_mem_u«lig√d
 (
x
,Åype); \

151  
˛ib_ho°_to_
##
£x
##
_
##
	`ty≥
 (
v
); \

155 
Æways_ölöe
 
ty≥
 \

156 
˛ib_
##
£x
##
_to_ho°_
##
	`ty≥
 (
ty≥
 
x
) \

157 {  
˛ib_ho°_to_
##
£x
##
_
##
	`ty≥
 (
x
); } \

159 
Æways_ölöe
 
ty≥
 \

160 
˛ib_
##
£x
##
_to_ho°_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

161 {  
˛ib_ho°_to_
##
£x
##
_mem_
##
	`ty≥
 (
x
); } \

163 
Æways_ölöe
 
ty≥
 \

164 
˛ib_
##
£x
##
_to_ho°_u«lig√d_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

165 {  
˛ib_ho°_to_
##
£x
##
_u«lig√d_mem_
##
	`ty≥
 (
x
); }

	)

167 #i‚de‡
__˝lu•lus


168 
	$_
(
lôée
, 
u16
)

169 
	$_
(
lôée
, 
u32
)

170 
	$_
(
lôée
, 
u64
)

171 
	$_
(
lôée
, 
i16
)

172 
	$_
(
lôée
, 
i32
)

173 
	$_
(
lôée
, 
i64
)

174 
	$_
(
big
, 
u16
Ë
	$_
(
big
, 
u32
Ë
	$_
(
big
, 
u64
Ë
	$_
(
big
, 
i16
Ë
	$_
(
big
, 
i32
Ë
	$_
(
big
, 
i64
)

176 #unde‡
_


178 
	#_
(
ty≥
) \

179 
Æways_ölöe
 
ty≥
 \

180 
˛ib_√t_to_ho°_
##
	`ty≥
 (
ty≥
 
x
) \

181 {  
˛ib_big_to_ho°_
##
	`ty≥
 (
x
); 
	}
} \

183 
Æways_ölöe
 
ty≥
 \

184 
˛ib_√t_to_ho°_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

185 {  
˛ib_big_to_ho°_mem_
##
	`ty≥
 (
x
); } \

187 
Æways_ölöe
 
ty≥
 \

188 
˛ib_√t_to_ho°_u«lig√d_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

189 {  
˛ib_big_to_ho°_u«lig√d_mem_
##
	`ty≥
 (
x
); } \

191 
Æways_ölöe
 
ty≥
 \

192 
˛ib_ho°_to_√t_
##
	`ty≥
 (
ty≥
 
x
) \

193 {  
˛ib_ho°_to_big_
##
	`ty≥
 (
x
); } \

195 
Æways_ölöe
 
ty≥
 \

196 
˛ib_ho°_to_√t_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

197 {  
˛ib_ho°_to_big_mem_
##
	`ty≥
 (
x
); } \

199 
Æways_ölöe
 
ty≥
 \

200 
˛ib_ho°_to_√t_u«lig√d_mem_
##
	`ty≥
 (
ty≥
 * 
x
) \

201 {  
˛ib_ho°_to_big_u«lig√d_mem_
##
	`ty≥
 (
x
); }

	)

202 #i‚de‡
__˝lu•lus


203 
_
(
u16
);

204 
_
(
i16
);

205 
_
(
u32
);

206 
_
(
i32
);

207 
_
(
u64
);

208 
_
(
i64
);

211 #unde‡
_


	@/usr/include/vppinfra/cache.h

38 #i‚de‡
ö˛uded_˛ib_ˇche_h


39 
	#ö˛uded_˛ib_ˇche_h


	)

41 
	~<vµö‰a/îr‹_boŸ°øp.h
>

46 #i‚de‡
CLIB_LOG2_CACHE_LINE_BYTES


49 #i‚de‡
CLIB_LOG2_CACHE_LINE_BYTES


50 
	#CLIB_LOG2_CACHE_LINE_BYTES
 6

	)

55 #i‡(
CLIB_LOG2_CACHE_LINE_BYTES
 >= 9)

56 #îr‹ 
Cache
 
löe
 
size
 512 
byãs
 
‹
 
gª©î


59 
	#CLIB_CACHE_LINE_BYTES
 (1 << 
CLIB_LOG2_CACHE_LINE_BYTES
)

	)

60 
	#CLIB_CACHE_LINE_ALIGN_MARK
(
m¨k
Ë
u8
 m¨k[0] 
	`__©åibuã__
((
	`Æig√d
(
CLIB_CACHE_LINE_BYTES
)))

	)

63 
	#CLIB_PREFETCH_READ
 0

	)

64 
	#CLIB_PREFETCH_LOAD
 0

	)

65 
	#CLIB_PREFETCH_WRITE
 1

	)

66 
	#CLIB_PREFETCH_STORE
 1

	)

68 
	#_CLIB_PREFETCH
(
n
,
size
,
ty≥
) \

69 i‡((
size
Ë> (
n
)*
CLIB_CACHE_LINE_BYTES
) \

70 
	`__buûtö_¥e„tch
 (
_addr
 + (
n
)*
CLIB_CACHE_LINE_BYTES
, \

71 
CLIB_PREFETCH_
##
ty≥
, \

72  3);

	)

74 
	#CLIB_PREFETCH
(
addr
,
size
,
ty≥
) \

76 * 
_addr
 = (
addr
); \

78 
	`ASSERT
 ((
size
Ë<4*
CLIB_CACHE_LINE_BYTES
); \

79 
	`_CLIB_PREFETCH
 (0, 
size
, 
ty≥
); \

80 
	`_CLIB_PREFETCH
 (1, 
size
, 
ty≥
); \

81 
	`_CLIB_PREFETCH
 (2, 
size
, 
ty≥
); \

82 
	`_CLIB_PREFETCH
 (3, 
size
, 
ty≥
); \

83 } 0)

	)

85 #unde‡
_


	@/usr/include/vppinfra/clib.h

38 #i‚de‡
ö˛uded_˛ib_h


39 
	#ö˛uded_˛ib_h


	)

42 #i‡! 
deföed
 (
CLIB_STANDALONE
Ë&& ! deföed (
CLIB_LINUX_KERNEL
)

43 
	#CLIB_UNIX


	)

46 
	~<vµö‰a/ty≥s.h
>

50 #i‚de‡
CLIB_DEBUG


51 
	#CLIB_DEBUG
 0

	)

54 #i‚de‡
NULL


55 
	#NULL
 ((*Ë0)

	)

58 
	#BITS
(
x
Ë(8*(x))

	)

59 
	#ARRAY_LEN
(
x
Ë( (x)/ (x[0]))

	)

61 
	#_STRUCT_FIELD
(
t
,
f
Ë((— *Ë0)->f)

	)

62 
	#STRUCT_OFFSET_OF
(
t
,
f
Ë((
uw‹d
Ë& 
	`_STRUCT_FIELD
 (t, f))

	)

63 
	#STRUCT_BIT_OFFSET_OF
(
t
,
f
Ë(
	`BITS
(
u8
Ë* (
uw‹d
Ë& 
	`_STRUCT_FIELD
 (t, f))

	)

64 
	#STRUCT_SIZE_OF
(
t
,
f
Ë( (
	`_STRUCT_FIELD
 (t, f)))

	)

65 
	#STRUCT_BITS_OF
(
t
,
f
Ë(
	`BITS
 (
	`_STRUCT_FIELD
 (t, f)))

	)

66 
	#STRUCT_ARRAY_LEN
(
t
,
f
Ë
	`ARRAY_LEN
 (
	`_STRUCT_FIELD
 (t, f))

	)

67 
	#STRUCT_MARK
(
m¨k
Ë
u8
 m¨k[0]

	)

68 
	#STRUCT_MARK_PTR
(
v
, 
f
Ë&(v)->
	)
f

71 
	#STRUCT_STRIDE_OF
(
t
,
f
) \

72 –((
uw‹d
Ë& (((
t
 *Ë0)[1].
f
)) \

73 - ((
uw‹d
Ë& (((
t
 *Ë0)[0].
f
)))

	)

75 
	#STRUCT_OFFSET_OF_VAR
(
v
,
f
Ë((
uw‹d
Ë(&(v)->fË- (uw‹dË(v))

	)

78 
	#CLIB_PACKED
(
x
Ëx 
	`__©åibuã__
 ((
∑cked
))

	)

79 
	#CLIB_UNUSED
(
x
Ëx 
	`__©åibuã__
 ((
unu£d
))

	)

82 
	#CLIB_STRING_MACRO
(
x
Ë#x

	)

84 
	#__˛ib_unu£d
 
	`__©åibuã__
 ((
unu£d
))

	)

85 
	#__˛ib_wók
 
	`__©åibuã__
 ((
wók
))

	)

86 
	#__˛ib_∑cked
 
	`__©åibuã__
 ((
∑cked
))

	)

87 
	#__˛ib_c⁄°ru˘‹
 
	`__©åibuã__
 ((
c⁄°ru˘‹
))

	)

89 
	#√vî_ölöe
 
	`__©åibuã__
 ((
__noölöe__
))

	)

91 #i‡
CLIB_DEBUG
 > 0

92 
	#Æways_ölöe
 
ölöe


	)

93 
	#°©ic_Æways_ölöe
 
ölöe


	)

95 
	#Æways_ölöe
 
ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

96 
	#°©ic_Æways_ölöe
 
ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

102 
	#CLIB_PAD_FROM_TO
(
‰om
,
to
Ë
u8
 
∑d_
##‰om[—oË- (‰om)]

	)

105 
	#PREDICT_FALSE
(
x
Ë
	`__buûtö_ex≥˘
((x),0)

	)

106 
	#PREDICT_TRUE
(
x
Ë
	`__buûtö_ex≥˘
((x),1)

	)

109 
	#CLIB_MEMORY_BARRIER
(Ë
	`__sync_synchr⁄ize
 ()

	)

111 #i‡
__x86_64__


112 
	#CLIB_MEMORY_STORE_BARRIER
(Ë
	`__buûtö_ü32_s„n˚
 ()

	)

114 
	#CLIB_MEMORY_STORE_BARRIER
(Ë
	`__sync_synchr⁄ize
 ()

	)

118 
	#INIT_FUNCTION
(
de˛
) \

119 
de˛
 
	`__©åibuã
 ((
c⁄°ru˘‹
)); \

120 
de˛


	)

123 
	#EXIT_FUNCTION
(
de˛
) \

124 
de˛
 
	`__©åibuã
 ((
de°ru˘‹
)); \

125 
de˛


	)

128 #ifde‡
__GNUC__


129 
	~<„©uªs.h
>

130 #i‡
__GNUC_PREREQ
(3, 4)

131 #i‡
uw‹d_bôs
 == 64

132 
	#cou¡_Àadög_zîos
(
cou¡
,
x
Ëcou¡ = 
	`__buûtö_˛zŒ
 (x)

	)

133 
	#cou¡_åaûög_zîos
(
cou¡
,
x
Ëcou¡ = 
	`__buûtö_˘zŒ
 (x)

	)

135 
	#cou¡_Àadög_zîos
(
cou¡
,
x
Ëcou¡ = 
	`__buûtö_˛zl
 (x)

	)

136 
	#cou¡_åaûög_zîos
(
cou¡
,
x
Ëcou¡ = 
	`__buûtö_˘zl
 (x)

	)

141 #i‚de‡
cou¡_Àadög_zîos


144 #i‡
deföed
 (
i386
)

145 
	#cou¡_Àadög_zîos
(
cou¡
, 
x
) \

147 
w‹d
 
_˛z
; \

148 
	`__asm__
 ("bsrl %1,%0" \

149 : "Ù" (
_˛z
Ë: "rm" ((
w‹d
Ë(
x
)));\

150 (
cou¡
Ë
_˛z
 ^ 31; \

151 } 0)

	)

153 
	#cou¡_åaûög_zîos
(
cou¡
, 
x
) \

154 
	`__asm__
 ("bsÊ %1,%0" : "Ù" (
cou¡
Ë: "rm" ((
w‹d
)(
x
)))

	)

157 #i‡
deföed
 (
__Æpha__
Ë&& deföed (
HAVE_CIX
)

158 
	#cou¡_Àadög_zîos
(
cou¡
, 
x
) \

159 
	`__asm__
 ("ctlz %1,%0" \

160 : "Ù" ((
w‹d
Ë(
cou¡
)) \

161 : "r" ((
w‹d
Ë(
x
)))

	)

162 
	#cou¡_åaûög_zîos
(
cou¡
, 
x
) \

163 
	`__asm__
 ("cttz %1,%0" \

164 : "Ù" ((
w‹d
Ë(
cou¡
)) \

165 : "r" ((
w‹d
Ë(
x
)))

	)

168 #i‡
__mùs
 >= 4

171 #i‡
uw‹d_bôs
 == 32

172 
	#cou¡_Àadög_zîos
(
_cou¡
, 
_x
) \

173 
	`__asm__
 ("clz %[count],%[x]" \

174 : [
cou¡
] "Ù" ((
w‹d
Ë(
_cou¡
)) \

175 : [
x
] "r" ((
w‹d
Ë(
_x
)))

	)

177 
	#cou¡_Àadög_zîos
(
_cou¡
, 
_x
) \

178 
	`__asm__
 ("dclz %[count],%[x]" \

179 : [
cou¡
] "Ù" ((
w‹d
Ë(
_cou¡
)) \

180 : [
x
] "r" ((
w‹d
Ë(
_x
)))

	)

187 #i‡
deföed
 (
cou¡_Àadög_zîos
)

188 
Æways_ölöe
 
uw‹d


189 
	$mö_log2
 (
uw‹d
 
x
)

191 
uw‹d
 
n
;

192 
	`cou¡_Àadög_zîos
 (
n
, 
x
);

193  
	`BITS
 (
uw‹d
Ë- 
n
 - 1;

194 
	}
}

196 
Æways_ölöe
 
uw‹d


197 
	$mö_log2
 (
uw‹d
 
x
)

199 
uw‹d
 
a
 = 
x
, 
b
 = 
	`BITS
 (uw‹dË/ 2, 
c
 = 0, 
r
 = 0;

202 
	#_
 \

204 
c
 = 
a
 >> 
b
; \

205 i‡(
c
Ë
a
 = c; \

206 i‡(
c
Ë
r
 +
b
; \

207 
b
 /= 2; \

208 }

	)

210 i‡(
	`BITS
 (
uw‹d
) > 32)

211 
_
;

212 
_
;

213 
_
;

214 
_
;

215 #unde‡
_


218 i‡(
	`BITS
 (
uw‹d
) > 32)

220 c⁄° 
u64
 
èbÀ
 = 0x3333333322221104LL;

221 
uw‹d
 
t
 = (
èbÀ
 >> (4 * 
a
)) & 0xf;

222 
r
 = 
t
 < 4 ?Ñ +Å : ~0;

226 c⁄° 
u32
 
èbÀ
 = 0x22221104;

227 
uw‹d
 
t
 = (
a
 & 8Ë? 3 : ((
èbÀ
 >> (4 *á)) & 0xf);

228 
r
 = 
t
 < 4 ?Ñ +Å : ~0;

231  
r
;

232 
	}
}

235 
Æways_ölöe
 
uw‹d


236 
	$max_log2
 (
uw‹d
 
x
)

238 
uw‹d
 
l
 = 
	`mö_log2
 (
x
);

239 i‡(
x
 > ((
uw‹d
Ë1 << 
l
))

240 
l
++;

241  
l
;

242 
	}
}

244 
Æways_ölöe
 
u64


245 
	$mö_log2_u64
 (
u64
 
x
)

247 i‡(
	`BITS
 (
uw‹d
) == 64)

248  
	`mö_log2
 (
x
);

251 
uw‹d
 
l
, 
y
;

252 
y
 = 
x
;

253 
l
 = 0;

254 i‡(
y
 == 0)

256 
l
 += 32;

257 
x
 >>= 32;

259 
l
 +
	`mö_log2
 (
x
);

260  
l
;

262 
	}
}

264 
Æways_ölöe
 
uw‹d


265 
	$pow2_mask
 (
uw‹d
 
x
)

267  ((
uw‹d
Ë1 << 
x
) - (uword) 1;

268 
	}
}

270 
Æways_ölöe
 
uw‹d


271 
	$max_pow2
 (
uw‹d
 
x
)

273 
w‹d
 
y
 = (w‹dË1 << 
	`mö_log2
 (
x
);

274 i‡(
x
 > 
y
)

275 
y
 *= 2;

276  
y
;

277 
	}
}

279 
Æways_ölöe
 
uw‹d


280 
	$is_pow2
 (
uw‹d
 
x
)

282  0 =(
x
 & (x - 1));

283 
	}
}

285 
Æways_ölöe
 
uw‹d


286 
	$round_pow2
 (
uw‹d
 
x
, uw‹d 
pow2
)

288  (
x
 + 
pow2
 - 1) & ~(pow2 - 1);

289 
	}
}

291 
Æways_ölöe
 
u64


292 
	$round_pow2_u64
 (
u64
 
x
, u64 
pow2
)

294  (
x
 + 
pow2
 - 1) & ~(pow2 - 1);

295 
	}
}

297 
Æways_ölöe
 
uw‹d


298 
	$fú°_£t
 (
uw‹d
 
x
)

300  
x
 & -x;

301 
	}
}

303 
Æways_ölöe
 
uw‹d


304 
	$log2_fú°_£t
 (
uw‹d
 
x
)

306 
uw‹d
 
ªsu…
;

307 #ifde‡
cou¡_åaûög_zîos


308 
	`cou¡_åaûög_zîos
 (
ªsu…
, 
x
);

310 
ªsu…
 = 
	`mö_log2
 (
	`fú°_£t
 (
x
));

312  
ªsu…
;

313 
	}
}

315 
Æways_ölöe
 
f64


316 
	$Êt_round_down
 (
f64
 
x
)

318  (Ë
x
;

319 
	}
}

321 
Æways_ölöe
 
w‹d


322 
	$Êt_round_√¨e°
 (
f64
 
x
)

324  (
w‹d
Ë(
x
 + .5);

325 
	}
}

327 
Æways_ölöe
 
f64


328 
	$Êt_round_to_mu…ùÀ
 (
f64
 
x
, f64 
f
)

330  
f
 * 
	`Êt_round_√¨e°
 (
x
 / f);

331 
	}
}

333 
	#˛ib_max
(
x
,
y
) \

335 
	`__ty≥of__
 (
x
Ë
_x
 = (x); \

336 
	`__ty≥of__
 (
y
Ë
_y
 = (y); \

337 
_x
 > 
_y
 ? _x : _y; \

338 })

	)

340 
	#˛ib_mö
(
x
,
y
) \

342 
	`__ty≥of__
 (
x
Ë
_x
 = (x); \

343 
	`__ty≥of__
 (
y
Ë
_y
 = (y); \

344 
_x
 < 
_y
 ? _x : _y; \

345 })

	)

347 
	#˛ib_abs
(
x
) \

349 
	`__ty≥of__
 (
x
Ë
_x
 = (x); \

350 
_x
 < 0 ? -_x : _x; \

351 })

	)

354 #i‚de‡
CLIB_UNIX


355 
˛ib_°™dÆ⁄e_öô
 (*
mem‹y
, 
uw‹d
 
mem‹y_byãs
);

357 
qs‹t
 (*
ba£
, 
uw‹d
 
n
, uw‹d 
size
,

362 
uw‹d


363 
	`˛ib_backåa˚
 (
uw‹d
 * 
ˇŒîs
, uw‹d 
max_ˇŒîs
, uw‹d 
n_‰ames_to_skù
);

	@/usr/include/vppinfra/cpu.h

16 #i‚de‡
ö˛uded_˛ib_˝u_h


17 
	#ö˛uded_˛ib_˝u_h


	)

19 
	~<vµö‰a/f‹m©.h
>

28 #i‡
__x86_64__
 && 
CLIB_DEBUG
 == 0

29 
	#f‹óch_m¨ch_v¨ü¡
(
ma¸o
, 
x
) \

30 
	`ma¸o
(
avx2
, 
x
, "¨ch=c‹e-avx2")

	)

32 
	#f‹óch_m¨ch_v¨ü¡
(
ma¸o
, 
x
)

	)

36 #i‡
__GNUC__
 > 4 && !
__˛™g__


37 
	#CLIB_CPU_OPTIMIZED
 
	`__©åibuã__
 ((
	`›timize
 ("åì-ve˘‹ize")))

	)

39 
	#CLIB_CPU_OPTIMIZED


	)

43 
	#CLIB_MULTIARCH_ARCH_CHECK
(
¨ch
, 
‚
, 
tgt
) \

44 i‡(
˛ib_˝u_suµ‹ts_
 ## 
	`¨ch
()) \

45  & 
‚
 ## 
_
 ##
¨ch
;

	)

47 
	#CLIB_MULTIARCH_SELECT_FN
(
‚
,...) \

48 
__VA_ARGS__
 * 
‚
 ## 
	`_mu…ürch_£À˘
() \

50 
	`f‹óch_m¨ch_v¨ü¡
(
CLIB_MULTIARCH_ARCH_CHECK
, 
‚
) \

51  & 
‚
; \

52 }

	)

54 #ifde‡
CLIB_MULTIARCH_VARIANT


55 
	#__CLIB_MULTIARCH_FN
(
a
,
b
Ëa##
_
##
	)
b

56 
	#_CLIB_MULTIARCH_FN
(
a
,
b
Ë
	`__CLIB_MULTIARCH_FN
◊,b)

	)

57 
	#CLIB_MULTIARCH_FN
(
‚
Ë
	`_CLIB_MULTIARCH_FN
(‚,
CLIB_MULTIARCH_VARIANT
)

	)

59 
	#CLIB_MULTIARCH_FN
(
‚
Ë
	)
fn

62 
	#f‹óch_x86_64_Êags
 \

63 
	`_
 (
s£3
, 1, 
ecx
, 0) \

64 
	`_
 (
ss£3
, 1, 
ecx
, 9) \

65 
	`_
 (
s£41
, 1, 
ecx
, 19) \

66 
	`_
 (
s£42
, 1, 
ecx
, 20) \

67 
	`_
 (
avx
, 1, 
ecx
, 28) \

68 
	`_
 (
avx2
, 7, 
ebx
, 5) \

69 
	`_
 (
avx512f
, 7, 
ebx
, 16) \

70 
	`_
 (
x86_´s
, 1, 
ecx
, 25) \

71 
	`_
 (
sha
, 7, 
ebx
, 29) \

72 
	`_
 (
öv¨ü¡_tsc
, 0x80000007, 
edx
, 8)

	)

75 
	#f‹óch_Ørch64_Êags
 \

76 
	`_
 (
Â
, 0) \

77 
	`_
 (
asimd
, 1) \

78 
	`_
 (
evt°rm
, 2) \

79 
	`_
 (
Ørch64_´s
, 3) \

80 
	`_
 (
pmuŒ
, 4) \

81 
	`_
 (
sha1
, 5) \

82 
	`_
 (
sha2
, 6) \

83 
	`_
 (
¸c32
, 7) \

84 
	`_
 (
©omics
, 8) \

85 
	`_
 (
Âhp
, 9) \

86 
	`_
 (
asimdhp
, 10) \

87 
	`_
 (
˝uid
, 11) \

88 
	`_
 (
asimdrdm
, 12) \

89 
	`_
 (
jscvt
, 13) \

90 
	`_
 (
fcma
, 14) \

91 
	`_
 (
Ã˝c
, 15) \

92 
	`_
 (
d˝›
, 16) \

93 
	`_
 (
sha3
, 17) \

94 
	`_
 (
sm3
, 18) \

95 
	`_
 (
sm4
, 19) \

96 
	`_
 (
asimddp
, 20) \

97 
	`_
 (
sha512
, 21) \

98 
	`_
 (
sve
, 22)

	)

100 #i‡
deföed
(
__x86_64__
)

101 
	~"˝uid.h
"

103 
ölöe
 

104 
	$˛ib_gë_˝uid
 (c⁄° 
u32
 
Àv
, u32 * 
óx
, u32 * 
ebx
, u32 * 
ecx
, u32 * 
edx
)

106 i‡((
u32
Ë
	`__gë_˝uid_max
 (0x80000000 & 
Àv
, 0) <Üev)

108 i‡(
Àv
 == 7)

109 
	`__˝uid_cou¡
 (
Àv
, 0, *
óx
, *
ebx
, *
ecx
, *
edx
);

111 
	`__˝uid
 (
Àv
, *
óx
, *
ebx
, *
ecx
, *
edx
);

113 
	}
}

116 
	#_
(
Êag
, 
func
, 
ªg
, 
bô
) \

117 
ölöe
 \

118 
˛ib_˝u_suµ‹ts_
 ## 
	`Êag
() \

120 
u32
 
	`__©åibuã__
((
unu£d
)Ë
óx
, 
ebx
 = 0, 
ecx
 = 0, 
edx
 = 0; \

121 
	`˛ib_gë_˝uid
 (
func
, &
óx
, &
ebx
, &
ecx
, &
edx
); \

123  ((
ªg
 & (1 << 
bô
)) != 0); \

124 }

	)

125 
	gf‹óch_x86_64_Êags


126 #unde‡
_


129 
	#_
(
Êag
, 
func
, 
ªg
, 
bô
) \

130 
ölöe
 
˛ib_˝u_suµ‹ts_
 ## 
	`Êag
(Ë{  0; }

	)

131 
	gf‹óch_x86_64_Êags


132 #unde‡
_


134 #i‡
deföed
(
__Ørch64__
)

135 
	~<sys/auxv.h
>

136 
	#_
(
Êag
, 
bô
) \

137 
ölöe
 \

138 
˛ib_˝u_suµ‹ts_
 ## 
	`Êag
() \

140 
hwˇp
 = 
	`gëauxvÆ
(
AT_HWCAP
); \

141  (
hwˇp
 & (1 << 
bô
)); \

142 }

	)

143 
	gf‹óch_Ørch64_Êags


144 #unde‡
_


146 
	#_
(
Êag
, 
bô
) \

147 
ölöe
 
˛ib_˝u_suµ‹ts_
 ## 
	`Êag
(Ë{  0; }

	)

148 
	gf‹óch_Ørch64_Êags


149 #unde‡
_


156 
ölöe
 

157 
	$˛ib_˝u_suµ‹ts_´s
 ()

159 #i‡
	`deföed
 (
__Ørch64__
)

160  
	`˛ib_˝u_suµ‹ts_x86_´s
 ();

161 #ñi‡
	`deföed
 (
__Ørch64__
)

162  
	`˛ib_˝u_suµ‹ts_Ørch64_´s
 ();

166 
	}
}

170 
f‹m©_fun˘i⁄_t
 
	gf‹m©_˝u_u¨ch
;

171 
f‹m©_fun˘i⁄_t
 
	gf‹m©_˝u_modñ_«me
;

172 
f‹m©_fun˘i⁄_t
 
	gf‹m©_˝u_Êags
;

	@/usr/include/vppinfra/elf.h

38 #i‚de‡
ö˛uded_˛ib_ñf_h


39 
	#ö˛uded_˛ib_ñf_h


	)

41 
	~<vµö‰a/f‹m©.h
>

42 
	~<vµö‰a/hash.h
>

43 
	~<vµö‰a/vec.h
>

44 
	~<vµö‰a/byã_‹dî.h
>

46 
	#f‹óch_ñf_fûe_˛ass
 \

47 
	`_
 (
CLASS_NONE
Ë_ (32B
IT
Ë_ (64BIT)

	)

49 
	#f‹óch_ñf_d©a_ícodög
 \

50 
	`_
 (
ENCODING_NONE
) \

51 
	`_
 (
TWOS_COMPLEMENT_LITTLE_ENDIAN
) \

52 
	`_
 (
TWOS_COMPLEMENT_BIG_ENDIAN
)

	)

54 
	#ELF_VERSION_NONE
 (0)

	)

55 
	#ELF_VERSION_CURRENT
 (1)

	)

57 
	#f‹óch_ñf_abi
 \

58 
	`_
 (
SYSV
, 0) \

59 
	`_
 (
HPUX
, 1) \

60 
	`_
 (
NETBSD
, 2) \

61 
	`_
 (
LINUX
, 3) \

62 
	`_
 (
SOLARIS
, 6) \

63 
	`_
 (
AIX
, 7) \

64 
	`_
 (
IRIX
, 8) \

65 
	`_
 (
FREEBSD
, 9) \

66 
	`_
 (
COMPAQ_TRU64
, 10) \

67 
	`_
 (
MODESTO
, 11) \

68 
	`_
 (
OPENBSD
, 12) \

69 
	`_
 (
ARM
, 97) \

70 
	`_
 (
STANDALONE
, 255)

	)

73 
	#f‹óch_ñf_fûe_ty≥
 \

74 
	`_
 (
NONE
, 0) \

75 
	`_
 (
RELOC
, 1) \

76 
	`_
 (
EXEC
, 2) \

77 
	`_
 (
SHARED
, 3) \

78 
	`_
 (
CORE
, 4) \

79 
	`_
 (
OS_SPECIFIC_LO
, 0xfe00) \

80 
	`_
 (
OS_SPECIFIC_HI
, 0xfeff) \

81 
	`_
 (
ARCH_SPECIFIC_LO
, 0xff00) \

82 
	`_
 (
ARCH_SPECIFIC_HI
, 0xffff)

	)

85 
	#f‹óch_ñf_¨chôe˘uª
 \

86 
	`_
 (
NONE
, 0) \

87 
	`_
 (
M32
, 1) \

88 
	`_
 (
SPARC
, 2) \

89 
	`_
 (386, 3) \

90 
	`_
 (68
K
, 4) \

91 
	`_
 (88
K
, 5) \

92 
	`_
 (860, 7) \

93 
	`_
 (
MIPS
, 8) \

94 
	`_
 (
S370
, 9) \

95 
	`_
 (
MIPS_RS3_LE
, 10) \

96 
	`_
 (
PARISC
, 15) \

97 
	`_
 (
VPP500
, 17) \

98 
	`_
 (
SPARC32PLUS
, 18) \

99 
	`_
 (960, 19) \

100 
	`_
 (
PPC
, 20) \

101 
	`_
 (
PPC64
, 21) \

102 
	`_
 (
S390
, 22) \

103 
	`_
 (
V800
, 36) \

104 
	`_
 (
FR20
, 37) \

105 
	`_
 (
RH32
, 38) \

106 
	`_
 (
RCE
, 39) \

107 
	`_
 (
ARM
, 40) \

108 
	`_
 (
FAKE_ALPHA
, 41) \

109 
	`_
 (
SH
, 42) \

110 
	`_
 (
SPARCV9
, 43) \

111 
	`_
 (
TRICORE
, 44) \

112 
	`_
 (
ARC
, 45) \

113 
	`_
 (
H8_300
, 46) \

114 
	`_
 (
H8_300H
, 47) \

115 
	`_
 (
H8S
, 48) \

116 
	`_
 (
H8_500
, 49) \

117 
	`_
 (
IA_64
, 50) \

118 
	`_
 (
MIPS_X
, 51) \

119 
	`_
 (
COLDFIRE
, 52) \

120 
	`_
 (68
HC12
, 53) \

121 
	`_
 (
MMA
, 54) \

122 
	`_
 (
PCP
, 55) \

123 
	`_
 (
NCPU
, 56) \

124 
	`_
 (
NDR1
, 57) \

125 
	`_
 (
STARCORE
, 58) \

126 
	`_
 (
ME16
, 59) \

127 
	`_
 (
ST100
, 60) \

128 
	`_
 (
TINYJ
, 61) \

129 
	`_
 (
X86_64
, 62) \

130 
	`_
 (
PDSP
, 63) \

131 
	`_
 (
FX66
, 66) \

132 
	`_
 (
ST9PLUS
, 67) \

133 
	`_
 (
ST7
, 68) \

134 
	`_
 (68
HC16
, 69) \

135 
	`_
 (68
HC11
, 70) \

136 
	`_
 (68
HC08
, 71) \

137 
	`_
 (68
HC05
, 72) \

138 
	`_
 (
SVX
, 73) \

139 
	`_
 (
ST19
, 74) \

140 
	`_
 (
VAX
, 75) \

141 
	`_
 (
CRIS
, 76) \

142 
	`_
 (
JAVELIN
, 77) \

143 
	`_
 (
FIREPATH
, 78) \

144 
	`_
 (
ZSP
, 79) \

145 
	`_
 (
MMIX
, 80) \

146 
	`_
 (
HUANY
, 81) \

147 
	`_
 (
PRISM
, 82) \

148 
	`_
 (
AVR
, 83) \

149 
	`_
 (
FR30
, 84) \

150 
	`_
 (
D10V
, 85) \

151 
	`_
 (
D30V
, 86) \

152 
	`_
 (
V850
, 87) \

153 
	`_
 (
M32R
, 88) \

154 
	`_
 (
MN10300
, 89) \

155 
	`_
 (
MN10200
, 90) \

156 
	`_
 (
PJ
, 91) \

157 
	`_
 (
OPENRISC
, 92) \

158 
	`_
 (
ARC_A5
, 93) \

159 
	`_
 (
XTENSA
, 94) \

160 
	`_
 (
ALPHA
, 0x9026)

	)

162 
	#_
(
f
Ë
ELF_
##f,

	)

166 
f‹óch_ñf_fûe_˛ass
 
	mELF_N_FILE_CLASS
,

167 } 
	tñf_fûe_˛ass_t
;

171 
f‹óch_ñf_d©a_ícodög
 
	mELF_N_DATA_ENCODING
,

172 } 
	tñf_d©a_ícodög_t
;

174 #unde‡
_


176 
	#_
(
f
,
i
Ë
ELF_
##‡i,

	)

180 
	mf‹óch_ñf_abi


181 } 
	tñf_abi_t
;

185 
	mf‹óch_ñf_fûe_ty≥


186 } 
	tñf_fûe_ty≥_t
;

188 #unde‡
_


192 
	#_
(
f
,
i
Ë
ELF_ARCH_
##‡i,

	)

193 
	mf‹óch_ñf_¨chôe˘uª


194 #unde‡
_


195 } 
	tñf_¨chôe˘uª_t
;

200 
u8
 
	mmagic
[4];

202 
ñf_fûe_˛ass_t
 
	mfûe_˛ass
:8;

203 
ñf_d©a_ícodög_t
 
	md©a_ícodög
:8;

204 
u8
 
	mfûe_vîsi⁄_idít
;

205 
ñf_abi_t
 
	mabi
:8;

206 
u8
 
	mabi_vîsi⁄
;

208 
u8
 
	m∑d
[7];

210 
ñf_fûe_ty≥_t
 
	mfûe_ty≥
:16;

211 
ñf_¨chôe˘uª_t
 
	m¨chôe˘uª
:16;

213 
u32
 
	mfûe_vîsi⁄
;

214 } 
	tñf_fú°_hódî_t
;

217 
	#f‹óch_ñf32_fûe_hódî
 \

218 
	`_
 (
u32
, 
íåy_poöt
) \

219 
	`_
 (
u32
, 
£gmít_hódî_fûe_off£t
) \

220 
	`_
 (
u32
, 
£˘i⁄_hódî_fûe_off£t
) \

221 
	`_
 (
u32
, 
Êags
) \

222 
	`_
 (
u16
, 
n_byãs_this_hódî
) \

223 
	`_
 (
u16
, 
£gmít_hódî_size
) \

224 
	`_
 (
u16
, 
£gmít_hódî_cou¡
) \

225 
	`_
 (
u16
, 
£˘i⁄_hódî_size
) \

226 
	`_
 (
u16
, 
£˘i⁄_hódî_cou¡
) \

227 
	`_
 (
u16
, 
£˘i⁄_hódî_°rög_èbÀ_ödex
)

	)

229 
	#f‹óch_ñf64_fûe_hódî
 \

230 
	`_
 (
u64
, 
íåy_poöt
) \

231 
	`_
 (
u64
, 
£gmít_hódî_fûe_off£t
) \

232 
	`_
 (
u64
, 
£˘i⁄_hódî_fûe_off£t
) \

233 
	`_
 (
u32
, 
Êags
) \

234 
	`_
 (
u16
, 
n_byãs_this_hódî
) \

235 
	`_
 (
u16
, 
£gmít_hódî_size
) \

236 
	`_
 (
u16
, 
£gmít_hódî_cou¡
) \

237 
	`_
 (
u16
, 
£˘i⁄_hódî_size
) \

238 
	`_
 (
u16
, 
£˘i⁄_hódî_cou¡
) \

239 
	`_
 (
u16
, 
£˘i⁄_hódî_°rög_èbÀ_ödex
)

	)

242 
	#f‹óch_ñf32_£˘i⁄_hódî
 \

243 
	`_
 (
u32
, 
«me
) \

244 
	`_
 (
u32
, 
ty≥
) \

245 
	`_
 (
u32
, 
Êags
) \

246 
	`_
 (
u32
, 
exec_addªss
) \

247 
	`_
 (
u32
, 
fûe_off£t
) \

248 
	`_
 (
u32
, 
fûe_size
) \

249 
	`_
 (
u32
, 
lök
) \

250 
	`_
 (
u32
, 
addôi⁄Æ_öfo
) \

251 
	`_
 (
u32
, 
Æign
) \

252 
	`_
 (
u32
, 
íåy_size
)

	)

254 
	#f‹óch_ñf64_£˘i⁄_hódî
 \

255 
	`_
 (
u32
, 
«me
) \

256 
	`_
 (
u32
, 
ty≥
) \

257 
	`_
 (
u64
, 
Êags
) \

258 
	`_
 (
u64
, 
exec_addªss
) \

259 
	`_
 (
u64
, 
fûe_off£t
) \

260 
	`_
 (
u64
, 
fûe_size
) \

261 
	`_
 (
u32
, 
lök
) \

262 
	`_
 (
u32
, 
addôi⁄Æ_öfo
) \

263 
	`_
 (
u64
, 
Æign
) \

264 
	`_
 (
u64
, 
íåy_size
)

	)

267 
	#f‹óch_ñf32_£gmít_hódî
 \

268 
	`_
 (
u32
, 
ty≥
) \

269 
	`_
 (
u32
, 
fûe_off£t
) \

270 
	`_
 (
u32
, 
vútuÆ_addªss
) \

271 
	`_
 (
u32
, 
physiˇl_addªss
) \

272 
	`_
 (
u32
, 
fûe_size
) \

273 
	`_
 (
u32
, 
mem‹y_size
) \

274 
	`_
 (
u32
, 
Êags
) \

275 
	`_
 (
u32
, 
Æign
)

	)

277 
	#f‹óch_ñf64_£gmít_hódî
 \

278 
	`_
 (
u32
, 
ty≥
) \

279 
	`_
 (
u32
, 
Êags
) \

280 
	`_
 (
u64
, 
fûe_off£t
) \

281 
	`_
 (
u64
, 
vútuÆ_addªss
) \

282 
	`_
 (
u64
, 
physiˇl_addªss
) \

283 
	`_
 (
u64
, 
fûe_size
) \

284 
	`_
 (
u64
, 
mem‹y_size
) \

285 
	`_
 (
u64
, 
Æign
)

	)

288 
	#f‹óch_ñf32_symbﬁ_hódî
 \

289 
	`_
 (
u32
, 
«me
) \

290 
	`_
 (
u32
, 
vÆue
) \

291 
	`_
 (
u32
, 
size
) \

293 
	`_
 (
u8
, 
bödög_™d_ty≥
) \

294 
	`_
 (
u8
, 
visibûôy
) \

295 
	`_
 (
u16
, 
£˘i⁄_ödex
)

	)

297 
	#f‹óch_ñf64_symbﬁ_hódî
 \

298 
	`_
 (
u32
, 
«me
) \

299 
	`_
 (
u8
, 
bödög_™d_ty≥
) \

300 
	`_
 (
u8
, 
visibûôy
) \

301 
	`_
 (
u16
, 
£˘i⁄_ödex
) \

302 
	`_
 (
u64
, 
vÆue
) \

303 
	`_
 (
u64
, 
size
)

	)

305 
	#_
(
t
,
f
Ëàf;

	)

309 
	mf‹óch_ñf32_fûe_hódî
} 
	tñf32_fûe_hódî_t
;

313 
	mf‹óch_ñf64_fûe_hódî
} 
	tñf64_fûe_hódî_t
;

317 
	mf‹óch_ñf32_£˘i⁄_hódî
} 
	tñf32_£˘i⁄_hódî_t
;

321 
	mf‹óch_ñf64_£˘i⁄_hódî
} 
	tñf64_£˘i⁄_hódî_t
;

325 
	mf‹óch_ñf32_£gmít_hódî
} 
	tñf32_£gmít_hódî_t
;

329 
	mf‹óch_ñf64_£gmít_hódî
} 
	tñf64_£gmít_hódî_t
;

333 
	mf‹óch_ñf32_symbﬁ_hódî
} 
	tñf32_symbﬁ_t
;

337 
	mf‹óch_ñf64_symbﬁ_hódî
} 
	tñf64_symbﬁ_t
;

338 #unde‡
_


341 
	#f‹óch_ñf_symbﬁ_ª£rved_£˘i⁄_ödex
 \

342 
	`_
 (
ABSOLUTE
, 0xfff1) \

343 
	`_
 (
COMMON
, 0xfff2) \

344 
	`_
 (
XINDEX
, 0xffffË

	)

346 
	#ELF_SYMBOL_SECTION_RESERVED_LO
 0xff00

	)

347 
	#ELF_SYMBOL_SECTION_RESERVED_HI
 0xffff

	)

348 
	#ELF_SYMBOL_SECTION_ARCH_SPECIFIC_LO
 0xff00

	)

349 
	#ELF_SYMBOL_SECTION_ARCH_SPECIFIC_HI
 0xff1f

	)

350 
	#ELF_SYMBOL_SECTION_OS_SPECIFIC_LO
 0xff20

	)

351 
	#ELF_SYMBOL_SECTION_OS_SPECIFIC_HI
 0xff3f

	)

354 
	#f‹óch_ñf_£˘i⁄_ty≥
 \

355 
	`_
 (
UNUSED
, 0) \

356 
	`_
 (
PROGRAM_DATA
, 1) \

357 
	`_
 (
SYMBOL_TABLE
, 2) \

358 
	`_
 (
STRING_TABLE
, 3) \

359 
	`_
 (
RELOCATION_ADD
, 4) \

360 
	`_
 (
SYMBOL_TABLE_HASH
, 5) \

361 
	`_
 (
DYNAMIC
, 6) \

362 
	`_
 (
NOTE
, 7) \

363 
	`_
 (
NO_BITS
, 8) \

364 
	`_
 (
RELOCATION
, 9) \

365 
	`_
 (
DYNAMIC_SYMBOL_TABLE
, 11) \

366 
	`_
 (
INIT_ARRAY
, 14) \

367 
	`_
 (
FINI_ARRAY
, 15) \

368 
	`_
 (
PREINIT_ARRAY
, 16) \

369 
	`_
 (
GROUP
, 17) \

370 
	`_
 (
SYMTAB_SHNDX
, 18) \

371 
	`_
 (
OS_SPECIFIC_LO
, 0x60000000) \

372 
	`_
 (
GNU_LIBLIST
, 0x6ffffff7) \

373 
	`_
 (
CHECKSUM
, 0x6ffffff8) \

374 
	`_
 (
SUNW_MOVE
, 0x6ffffffa) \

375 
	`_
 (
SUNW_COMDAT
, 0x6ffffffb) \

376 
	`_
 (
SUNW_SYMINFO
, 0x6ffffffc) \

377 
	`_
 (
GNU_VERDEF
, 0x6ffffffd) \

378 
	`_
 (
GNU_VERNEED
, 0x6ffffffe) \

379 
	`_
 (
GNU_VERSYM
, 0x6fffffff) \

380 
	`_
 (
ARCH_SPECIFIC_LO
, 0x70000000) \

381 
	`_
 (
ARCH_SPECIFIC_HI
, 0x7fffffff) \

382 
	`_
 (
APP_SPECIFIC_LO
, 0x80000000) \

383 
	`_
 (
APP_SPECIFIC_HI
, 0x8fffffffË

	)

386 
	#f‹óch_ñf_£˘i⁄_Êag
 \

387 
	`_
 (
WRITE
, 0) \

388 
	`_
 (
ALLOC
, 1) \

389 
	`_
 (
EXEC
, 2) \

390 
	`_
 (
MERGE
, 3) \

391 
	`_
 (
STRING_TABLE
, 5) \

392 
	`_
 (
INFO_LINK
, 6) \

393 
	`_
 (
PRESERVE_LINK_ORDER
, 7) \

394 
	`_
 (
OS_NON_CONFORMING
, 8) \

395 
	`_
 (
GROUP
, 9) \

396 
	`_
 (
TLS
, 10) \

397 
	`_
 (
OS_SPECIFIC_LO
, 20) \

398 
	`_
 (
OS_SPECIFIC_HI
, 27) \

399 
	`_
 (
ARCH_SPECIFIC_LO
, 28) \

400 
	`_
 (
ARCH_SPECIFIC_HI
, 31)

	)

404 
	#_
(
f
,
i
Ë
ELF_SECTION_
##‡i,

	)

405 
	mf‹óch_ñf_£˘i⁄_ty≥


406 #unde‡
_


407 
	mELF_SECTION_OS_SPECIFIC_HI
 = 0x6fffffff,

408 } 
	tñf_£˘i⁄_ty≥_t
;

412 
	#_
(
f
,
i
Ë
ELF_SECTION_FLAG_BIT_
##‡i,

	)

413 
	mf‹óch_ñf_£˘i⁄_Êag


414 #unde‡
_


415 } 
	tñf_£˘i⁄_Êag_bô_t
;

419 
	#_
(
f
,
i
Ë
ELF_SECTION_FLAG_
##‡1 << 
ELF_SECTION_FLAG_BIT_
##f,

	)

420 
	mf‹óch_ñf_£˘i⁄_Êag


421 #unde‡
_


422 } 
	tñf_£˘i⁄_Êag_t
;

425 
	#f‹óch_ñf_symbﬁ_bödög
 \

426 
	`_
 (
LOCAL
, 0) \

427 
	`_
 (
GLOBAL
, 1) \

428 
	`_
 (
WEAK
, 2) \

429 
	`_
 (
OS_SPECIFIC_LO
, 10) \

430 
	`_
 (
OS_SPECIFIC_HI
, 12) \

431 
	`_
 (
ARCH_SPECIFIC_LO
, 13) \

432 
	`_
 (
ARCH_SPECIFIC_HI
, 15Ë

	)

435 
	#f‹óch_ñf_symbﬁ_ty≥
 \

436 
	`_
 (
NONE
, 0) \

437 
	`_
 (
DATA
, 1) \

438 
	`_
 (
CODE
, 2) \

439 
	`_
 (
SECTION
, 3) \

440 
	`_
 (
FILE
, 4) \

441 
	`_
 (
COMMON
, 5) \

442 
	`_
 (
TLS
, 6) \

443 
	`_
 (
OS_SPECIFIC_LO
, 10) \

444 
	`_
 (
OS_SPECIFIC_HI
, 12) \

445 
	`_
 (
ARCH_SPECIFIC_LO
, 13) \

446 
	`_
 (
ARCH_SPECIFIC_HI
, 15Ë

	)

449 
	#f‹óch_ñf_symbﬁ_visibûôy
 \

450 
	`_
 (
DEFAULT
, 0) \

451 
	`_
 (
INTERNAL
, 1) \

452 
	`_
 (
HIDDEN
, 2) \

453 
	`_
 (
PROTECTED
, 3Ë

	)

459 
u16
 
	mbound_to
;

460 
u16
 
	mÊags
;

461 } 
	tñf_symbﬁ_öfo_t
;

464 
	#f‹óch_ñf_symbﬁ_öfo_bound_to
 \

465 
	`_
 (
SELF
, 0xffff) \

466 
	`_
 (
PARENT
, 0xfffe) \

467 
	`_
 (
RESERVED_LO
, 0xff00) \

468 
	`_
 (
RESERVED_HI
, 0xffff)

	)

471 
	#f‹óch_ñf_symbﬁ_öfo_Êags
 \

472 
	`_
 (
DIRECT
) \

473 
	`_
 (
PASS_THRU
) \

474 
	`_
 (
COPY
) \

475 
	`_
 (
LAZY_LOAD
Ë

	)

480 
u32
 
	maddªss
;

481 
u32
 
	msymbﬁ_™d_ty≥
;

482 
i32
 
	maddíd
[0];

483 } 
	tñf32_ªloˇti⁄_t
;

487 
u64
 
	maddªss
;

488 
u64
 
	msymbﬁ_™d_ty≥
;

489 
i64
 
	maddíd
[0];

490 } 
	tñf64_ªloˇti⁄_t
;

494 
u64
 
	maddªss
;

495 
u64
 
	msymbﬁ_™d_ty≥
;

496 
u64
 
	maddíd
;

497 } 
	tñf_ªloˇti⁄_wôh_addíd_t
;

499 
	#ñf_ªloˇti⁄_√xt
(
r
,
ty≥
) \

500 ((*Ë((
r
) + 1) \

501 + ((
ty≥
Ë=
ELF_SECTION_RELOCATION_ADD
 ?  ((
r
)->
addíd
[0]Ë: 0))

	)

504 
	#f‹óch_ñf_£gmít_ty≥
 \

505 
	`_
 (
UNUSED
, 0) \

506 
	`_
 (
LOAD
, 1) \

507 
	`_
 (
DYNAMIC
, 2) \

508 
	`_
 (
INTERP
, 3) \

509 
	`_
 (
NOTE
, 4) \

510 
	`_
 (
SEGMENT_TABLE
, 6) \

511 
	`_
 (
TLS
, 7) \

512 
	`_
 (
OS_SPECIFIC_LO
, 0x60000000) \

513 
	`_
 (
GNU_EH_FRAME
, 0x6474e550) \

514 
	`_
 (
GNU_STACK
, 0x6474e551) \

515 
	`_
 (
GNU_RELRO
, 0x6474e552) \

516 
	`_
 (
SUNW_BSS
, 0x6ffffffa) \

517 
	`_
 (
SUNW_STACK
, 0x6ffffffb) \

518 
	`_
 (
OS_SPECIFIC_HI
, 0x6fffffff) \

519 
	`_
 (
ARCH_SPECIFIC_LO
, 0x70000000) \

520 
	`_
 (
ARCH_SPECIFIC_HI
, 0x7fffffffË

	)

523 
	#f‹óch_ñf_£gmít_Êag
 \

524 
	`_
 (
EXEC
, 0) \

525 
	`_
 (
WRITE
, 1) \

526 
	`_
 (
READ
, 2) \

527 
	`_
 (
OS_SPECIFIC_LO
, 20) \

528 
	`_
 (
OS_SPECIFIC_HI
, 27) \

529 
	`_
 (
ARCH_SPECIFIC_LO
, 28) \

530 
	`_
 (
ARCH_SPECIFIC_HI
, 31)

	)

534 
	#_
(
f
,
i
Ë
ELF_SEGMENT_
##‡i,

	)

535 
	mf‹óch_ñf_£gmít_ty≥


536 #unde‡
_


537 } 
	tñf_£gmít_ty≥_t
;

541 
	#_
(
f
,
i
Ë
ELF_SEGMENT_FLAG_BIT_
##‡i,

	)

542 
	mf‹óch_ñf_£gmít_Êag


543 #unde‡
_


544 } 
	tñf_£gmít_Êag_bô_t
;

548 
	#_
(
f
,
i
Ë
ELF_SEGMENT_FLAG_
##‡1 << 
ELF_SEGMENT_FLAG_BIT_
##f,

	)

549 
	mf‹óch_ñf_£gmít_Êag


550 #unde‡
_


551 } 
	tñf_£gmít_Êag_t
;

553 
	#f‹óch_ñf32_dy«mic_íåy_hódî
 \

554 
	`_
 (
u32
, 
ty≥
) \

555 
	`_
 (
u32
, 
d©a
)

	)

557 
	#f‹óch_ñf64_dy«mic_íåy_hódî
 \

558 
	`_
 (
u64
, 
ty≥
) \

559 
	`_
 (
u64
, 
d©a
)

	)

561 
	#_
(
t
,
f
Ëàf;

	)

565 
	mf‹óch_ñf32_dy«mic_íåy_hódî
} 
	tñf32_dy«mic_íåy_t
;

569 
	mf‹óch_ñf64_dy«mic_íåy_hódî
} 
	tñf64_dy«mic_íåy_t
;

571 #unde‡
_


573 
	#f‹óch_ñf_dy«mic_íåy_ty≥
 \

574 
	`_
 (
END
, 0) \

575 
	`_
 (
NEEDED_LIBRARY
, 1) \

576 
	`_
 (
PLT_RELOCATION_SIZE
, 2) \

577 
	`_
 (
PLT_GOT
, 3) \

578 
	`_
 (
SYMBOL_HASH
, 4) \

579 
	`_
 (
STRING_TABLE
, 5) \

580 
	`_
 (
SYMBOL_TABLE
, 6) \

581 
	`_
 (
RELA_ADDRESS
, 7) \

582 
	`_
 (
RELA_SIZE
, 8) \

583 
	`_
 (
RELA_ENTRY_SIZE
, 9) \

584 
	`_
 (
STRING_TABLE_SIZE
, 10) \

585 
	`_
 (
SYMBOL_TABLE_ENTRY_SIZE
, 11) \

586 
	`_
 (
INIT_FUNCTION
, 12) \

587 
	`_
 (
FINI_FUNCTION
, 13) \

588 
	`_
 (
SONAME
, 14) \

589 
	`_
 (
RPATH
, 15) \

590 
	`_
 (
SYMBOLIC
, 16) \

591 
	`_
 (
REL
, 17) \

592 
	`_
 (
RELSZ
, 18) \

593 
	`_
 (
RELENT
, 19) \

594 
	`_
 (
PLT_RELOCATION_TYPE
, 20) \

595 
	`_
 (
DEBUG
, 21) \

596 
	`_
 (
TEXTREL
, 22) \

597 
	`_
 (
PLT_RELOCATION_ADDRESS
, 23) \

598 
	`_
 (
BIND_NOW
, 24) \

599 
	`_
 (
INIT_ARRAY
, 25) \

600 
	`_
 (
FINI_ARRAY
, 26) \

601 
	`_
 (
INIT_ARRAYSZ
, 27) \

602 
	`_
 (
FINI_ARRAYSZ
, 28) \

603 
	`_
 (
RUN_PATH
, 29) \

604 
	`_
 (
FLAGS
, 30) \

605 
	`_
 (
ENCODING
, 31) \

606 
	`_
 (
PREINIT_ARRAY
, 32) \

607 
	`_
 (
PREINIT_ARRAY_SIZE
, 33) \

608 
	`_
 (
GNU_PRELINKED
, 0x6ffffdf5) \

609 
	`_
 (
GNU_CONFLICTSZ
, 0x6ffffdf6) \

610 
	`_
 (
GNU_LIBLISTSZ
, 0x6ffffdf7) \

611 
	`_
 (
CHECKSUM
, 0x6ffffdf8) \

612 
	`_
 (
PLTPADSZ
, 0x6ffffdf9) \

613 
	`_
 (
MOVEENT
, 0x6ffffdfa) \

614 
	`_
 (
MOVESZ
, 0x6ffffdfb) \

615 
	`_
 (
FEATURE_1
, 0x6ffffdfc) \

616 
	`_
 (
POSFLAG_1
, 0x6ffffdfd) \

617 
	`_
 (
SYMINSZ
, 0x6ffffdfe) \

618 
	`_
 (
SYMINENT
, 0x6ffffdff) \

619 
	`_
 (
GNU_HASH
, 0x6ffffef5) \

620 
	`_
 (
GNU_CONFLICT
, 0x6ffffef8) \

621 
	`_
 (
GNU_LIBLIST
, 0x6ffffef9) \

622 
	`_
 (
CONFIG
, 0x6ffffefa) \

623 
	`_
 (
DEPAUDIT
, 0x6ffffefb) \

624 
	`_
 (
AUDIT
, 0x6ffffefc) \

625 
	`_
 (
PLTPAD
, 0x6ffffefd) \

626 
	`_
 (
MOVETAB
, 0x6ffffefe) \

627 
	`_
 (
SYMINFO
, 0x6ffffeff) \

628 
	`_
 (
VERSYM
, 0x6ffffff0) \

629 
	`_
 (
RELACOUNT
, 0x6ffffff9) \

630 
	`_
 (
RELCOUNT
, 0x6ffffffa) \

631 
	`_
 (
FLAGS_1
, 0x6ffffffb) \

632 
	`_
 (
VERSION_DEF
, 0x6ffffffc) \

633 
	`_
 (
VERSION_DEF_COUNT
, 0x6ffffffd) \

634 
	`_
 (
VERSION_NEED
, 0x6ffffffe) \

635 
	`_
 (
VERSION_NEED_COUNT
, 0x6fffffff) \

636 
	`_
 (
AUXILIARY
, 0x7ffffffd) \

637 
	`_
 (
FILTER
, 0x7fffffffË

	)

641 
	#_
(
f
,
n
Ë
ELF_DYNAMIC_ENTRY_
##‡“),

	)

642 
	mf‹óch_ñf_dy«mic_íåy_ty≥


643 #unde‡
_


644 } 
	tñf_dy«mic_íåy_ty≥_t
;

647 
	#ELF_DYNAMIC_FLAGS_ORIGIN
 (1 << 0Ë

	)

648 
	#ELF_DYNAMIC_FLAGS_SYMBOLIC
 (1 << 1Ë

	)

649 
	#ELF_DYNAMIC_FLAGS_TEXT_RELOCATIONS
 (1 << 2Ë

	)

650 
	#ELF_DYNAMIC_FLAGS_BIND_NOW
 (1 << 3Ë

	)

651 
	#ELF_DYNAMIC_FLAGS_STATIC_TLS
 (1 << 4Ë

	)

655 
	#DF_1_NOW
 0x00000001

	)

656 
	#DF_1_GLOBAL
 0x00000002

	)

657 
	#DF_1_GROUP
 0x00000004

	)

658 
	#DF_1_NODELETE
 0x00000008

	)

659 
	#DF_1_LOADFLTR
 0x00000010

	)

660 
	#DF_1_INITFIRST
 0x00000020

	)

661 
	#DF_1_NOOPEN
 0x00000040

	)

662 
	#DF_1_ORIGIN
 0x00000080

	)

663 
	#DF_1_DIRECT
 0x00000100

	)

664 
	#DF_1_TRANS
 0x00000200

	)

665 
	#DF_1_INTERPOSE
 0x00000400

	)

666 
	#DF_1_NODEFLIB
 0x00000800

	)

667 
	#DF_1_NODUMP
 0x00001000

	)

668 
	#DF_1_CONFALT
 0x00002000

	)

669 
	#DF_1_ENDFILTEE
 0x00004000

	)

670 
	#DF_1_DISPRELDNE
 0x00008000

	)

671 
	#DF_1_DISPRELPND
 0x00010000

	)

674 
	#DTF_1_PARINIT
 0x00000001

	)

675 
	#DTF_1_CONFEXP
 0x00000002

	)

678 
	#DF_P1_LAZYLOAD
 0x00000001

	)

679 
	#DF_P1_GROUPPERM
 0x00000002

	)

685 
u16
 
	mvîsi⁄
;

686 
u16
 
	mÊags
;

687 
u16
 
	mödex
;

688 
u16
 
	maux_cou¡
;

689 
u32
 
	m«me_hash
;

690 
u32
 
	maux_byã_off£t
;

691 
u32
 
	mbyã_off£t_√xt_vîsi⁄_deföôi⁄
;

692 } 
	tñf_dy«mic_vîsi⁄_deföôi⁄_t
;

696 
u32
 
	m«me
;

697 
u32
 
	m√xt_off£t
;

698 } 
	tñf_dy«mic_vîsi⁄_deföôi⁄_aux_t
;

701 
	#ELF_DYNAMIC_VERSION_FILE
 (1 << 0Ë

	)

702 
	#ELF_DYNAMIC_VERSION_WEAK
 (1 << 1Ë

	)

705 
	#ELF_DYNAMIC_VERSYM_LOCAL
 0

	)

706 
	#ELF_DYNAMIC_VERSYM_GLOBAL
 1

	)

707 
	#ELF_DYNAMIC_VERSYM_RESERVED_LO
 0xff00

	)

708 
	#ELF_DYNAMIC_VERSYM_ELIMINATE
 0xff01

	)

711 
	#f‹óch_ñf_dy«mic_vîsi⁄_√ed_fõld
 \

712 
	`_
 (
u16
, 
vîsi⁄
) \

713 
	`_
 (
u16
, 
aux_cou¡
) \

714 
	`_
 (
u32
, 
fûe_«me_off£t
) \

715 
	`_
 (
u32
, 
fú°_aux_off£t
) \

716 
	`_
 (
u32
, 
√xt_off£t
)

	)

718 
	#f‹óch_ñf_dy«mic_vîsi⁄_√ed_aux_fõld
 \

719 
	`_
 (
u32
, 
hash
) \

720 
	`_
 (
u16
, 
Êags
) \

721 
	`_
 (
u16
, 
vîsym_ödex
) \

722 
	`_
 (
u32
, 
«me
) \

723 
	`_
 (
u32
, 
√xt_off£t
)

	)

727 
	#_
(
t
,
f
Ëàf;

	)

728 
	mf‹óch_ñf_dy«mic_vîsi⁄_√ed_fõld


729 #unde‡
_


730 } 
	tñf_dy«mic_vîsi⁄_√ed_t
;

734 
	#_
(
t
,
f
Ëàf;

	)

735 
	mf‹óch_ñf_dy«mic_vîsi⁄_√ed_aux_fõld


736 #unde‡
_


737 } 
	tñf_dy«mic_vîsi⁄_√ed_aux_t
;

741 
ñf_dy«mic_vîsi⁄_√ed_t
 
	m√ed
;

742 
ñf_dy«mic_vîsi⁄_√ed_aux_t
 
	maux
;

743 } 
	tñf_dy«mic_vîsi⁄_√ed_uni⁄_t
;

750 
u32
 
	m«me_size
;

751 
u32
 
	mdes¸ùt‹_size
;

752 
u32
 
	mty≥
;

753 } 
	tñf_nŸe_t
;

758 
	#ELF_NOTE_SOLARIS
 "SUNW Sﬁ¨is"

	)

761 
	#ELF_NOTE_GNU
 "GNU"

	)

767 
	#ELF_NOTE_PAGESIZE_HINT
 1

	)

778 #i‚de‡
ELF_NOTE_ABI


779 
	#ELF_NOTE_ABI
 1

	)

784 
	#ELF_NOTE_OS_LINUX
 0

	)

785 
	#ELF_NOTE_OS_GNU
 1

	)

786 
	#ELF_NOTE_OS_SOLARIS2
 2

	)

787 
	#ELF_NOTE_OS_FREEBSD
 3

	)

790 
	#f‹óch_ñf_x86_64_ªloˇti⁄_ty≥
 \

791 
	`_
 (
NONE
, 0) \

792 
	`_
 (
DIRECT_64
, 1) \

793 
	`_
 (
PC_REL_I32
, 2) \

794 
	`_
 (
GOT_REL_32
, 3) \

795 
	`_
 (
PLT_REL_32
, 4) \

796 
	`_
 (
COPY
, 5) \

797 
	`_
 (
CREATE_GOT
, 6) \

798 
	`_
 (
CREATE_PLT
, 7) \

799 
	`_
 (
RELATIVE
, 8) \

800 
	`_
 (
PC_REL_I32_GOT
, 9) \

801 
	`_
 (
DIRECT_U32
, 10) \

802 
	`_
 (
DIRECT_I32
, 11) \

803 
	`_
 (
DIRECT_U16
, 12) \

804 
	`_
 (
PC_REL_I16
, 13) \

805 
	`_
 (
DIRECT_I8
, 14) \

806 
	`_
 (
PC_REL_I8
, 15) \

807 
	`_
 (
DTPMOD64
, 16) \

808 
	`_
 (
DTPOFF64
, 17) \

809 
	`_
 (
TPOFF64
, 18) \

810 
	`_
 (
TLSGD
, 19) \

811 
	`_
 (
TLSLD
, 20) \

812 
	`_
 (
DTPOFF32
, 21) \

813 
	`_
 (
GOTTPOFF
, 22) \

814 
	`_
 (
TPOFF32
, 23Ë

	)

818 
ñf64_symbﬁ_t
 *
	msymbﬁs
;

820 
u32
 
	m£˘i⁄_ödex
;

822 
u8
 *
	m°rög_èbÀ
;

824 
uw‹d
 *
	msymbﬁ_by_«me
;

825 } 
	tñf_symbﬁ_èbÀ_t
;

827 
Æways_ölöe
 

828 
	$ñf_symbﬁ_èbÀ_‰ì
 (
ñf_symbﬁ_èbÀ_t
 * 
s
)

830 
	`vec_‰ì
 (
s
->
symbﬁs
);

831 
	`hash_‰ì
 (
s
->
symbﬁ_by_«me
);

832 
	}
}

834 
Æways_ölöe
 
u8
 *

835 
	$ñf_symbﬁ_«me
 (
ñf_symbﬁ_èbÀ_t
 * 
t
, 
ñf64_symbﬁ_t
 * 
sym
)

837  
	`vec_ñt_©_ödex
 (
t
->
°rög_èbÀ
, 
sym
->
«me
);

838 
	}
}

842 
ñf_ªloˇti⁄_wôh_addíd_t
 *
	mªloˇti⁄s
;

844 
u32
 
	m£˘i⁄_ödex
;

845 } 
	tñf_ªloˇti⁄_èbÀ_t
;

847 
Æways_ölöe
 

848 
	$ñf_ªloˇti⁄_èbÀ_‰ì
 (
ñf_ªloˇti⁄_èbÀ_t
 * 
r
)

850 
	`vec_‰ì
 (
r
->
ªloˇti⁄s
);

851 
	}
}

855 
ñf64_£˘i⁄_hódî_t
 
	mhódî
;

857 
u32
 
	mödex
;

860 
uw‹d
 *
	m£gmít_ödex_bôm≠
;

864 
u64
 
	mÆign_size
;

866 
i64
 
	mexec_addªss_ch™ge
;

868 
u8
 *
	mc⁄ã¡s
;

869 } 
	tñf_£˘i⁄_t
;

873 
ñf64_£gmít_hódî_t
 
	mhódî
;

876 
uw‹d
 *
	m£˘i⁄_ödex_bôm≠
;

878 
u32
 
	mödex
;

880 
u8
 *
	mc⁄ã¡s
;

881 } 
	tñf_£gmít_t
;

885 
u8
 
	m√ed_byã_sw≠
;

887 
u8
 
	m∑r£d_symbﬁs
;

889 *
	mfûe_«me
;

891 
ñf_fú°_hódî_t
 
	mfú°_hódî
;

893 
ñf64_fûe_hódî_t
 
	mfûe_hódî
;

895 
ñf_£gmít_t
 *
	m£gmíts
;

897 
ñf_£˘i⁄_t
 *
	m£˘i⁄s
;

899 
uw‹d
 *
	m£˘i⁄_by_«me
;

900 
uw‹d
 *
	m£˘i⁄_by_°¨t_addªss
;

902 
ñf_symbﬁ_èbÀ_t
 *
	msymbﬁ_èbÀs
;

903 
ñf_ªloˇti⁄_èbÀ_t
 *
	mªloˇti⁄_èbÀs
;

905 *
	möãΩªãr
;

907 
ñf64_dy«mic_íåy_t
 *
	mdy«mic_íåõs
;

908 
u8
 *
	mdy«mic_°rög_èbÀ
;

909 
u32
 
	mdy«mic_°rög_èbÀ_£˘i⁄_ödex
;

910 
u32
 
	mdy«mic_symbﬁ_èbÀ_£˘i⁄_ödex
;

911 
u32
 
	mdy«mic_symbﬁ_èbÀ_ödex
;

912 
u32
 
	mdy«mic_£˘i⁄_ödex
;

913 
u16
 *
	mvîsym
;

914 
u32
 
	mvîsym_£˘i⁄_ödex
;

915 
ñf_dy«mic_vîsi⁄_√ed_uni⁄_t
 *
	mvî√ed
;

916 
u32
 
	mvî√ed_£˘i⁄_ödex
;

917 } 
	tñf_maö_t
;

919 
Æways_ölöe
 

920 
	$ñf_maö_öô
 (
ñf_maö_t
 * 
em
)

922 
	`mem£t
 (
em
, 0,  (em[0]));

923 
	}
}

925 
Æways_ölöe
 

926 
	$ñf_maö_‰ì
 (
ñf_maö_t
 * 
em
)

928 
uw‹d
 
i
;

930 
i
 = 0; i < 
	`vec_Àn
 (
em
->
£gmíts
); i++)

931 
	`vec_‰ì
 (
em
->
£gmíts
[
i
].
c⁄ã¡s
);

932 
	`vec_‰ì
 (
em
->
£gmíts
);

934 
i
 = 0; i < 
	`vec_Àn
 (
em
->
£˘i⁄s
); i++)

935 
	`vec_‰ì
 (
em
->
£˘i⁄s
[
i
].
c⁄ã¡s
);

936 
	`vec_‰ì
 (
em
->
£˘i⁄s
);

938 
	`hash_‰ì
 (
em
->
£˘i⁄_by_«me
);

939 
i
 = 0; i < 
	`vec_Àn
 (
em
->
symbﬁ_èbÀs
); i++)

940 
	`ñf_symbﬁ_èbÀ_‰ì
 (
em
->
symbﬁ_èbÀs
 + 
i
);

941 
i
 = 0; i < 
	`vec_Àn
 (
em
->
ªloˇti⁄_èbÀs
); i++)

942 
	`ñf_ªloˇti⁄_èbÀ_‰ì
 (
em
->
ªloˇti⁄_èbÀs
 + 
i
);

944 
	`vec_‰ì
 (
em
->
dy«mic_íåõs
);

945 
	`vec_‰ì
 (
em
->
öãΩªãr
);

946 
	}
}

948 
Æways_ölöe
 

949 
	$ñf_gë_£gmít_c⁄ã¡s
 (
ñf_maö_t
 * 
em
, *
d©a
, 
uw‹d
 
£gmít_ödex
)

951 
ñf_£gmít_t
 *
g
 = 
	`vec_ñt_©_ödex
 (
em
->
£gmíts
, 
£gmít_ödex
);

952 i‡(!
g
->
c⁄ã¡s
)

953 
	`vec_add
 (
g
->
c⁄ã¡s
, 
d©a
 + g->
hódî
.
fûe_off£t
,

954 
g
->
hódî
.
mem‹y_size
);

955 
	}
}

957 
Æways_ölöe
 *

958 
	$ñf_gë_£˘i⁄_c⁄ã¡s
 (
ñf_maö_t
 * 
em
,

959 
uw‹d
 
£˘i⁄_ödex
, uw‹d 
ñt_size
)

961 
ñf_£˘i⁄_t
 *
s
;

962 *
ªsu…
;

964 
s
 = 
	`vec_ñt_©_ödex
 (
em
->
£˘i⁄s
, 
£˘i⁄_ödex
);

966 
ªsu…
 = 0;

967 i‡(
	`vec_Àn
 (
s
->
c⁄ã¡s
) > 0)

970 
ªsu…
 = 
	`_vec_ªsize
 (result,

971 
	`vec_Àn
 (
s
->
c⁄ã¡s
Ë/ 
ñt_size
,

972 
	`vec_Àn
 (
s
->
c⁄ã¡s
),

975 
	`˛ib_mem˝y
 (
ªsu…
, 
s
->
c⁄ã¡s
, 
	`vec_Àn
 (s->contents));

978  
ªsu…
;

979 
	}
}

981 
Æways_ölöe
 

982 
	$ñf_£t_£˘i⁄_c⁄ã¡s
 (
ñf_maö_t
 * 
em
,

983 
uw‹d
 
£˘i⁄_ödex
,

984 *
√w_c⁄ã¡s
, 
uw‹d
 
n_c⁄ã¡_byãs
)

986 
ñf_£˘i⁄_t
 *
s
;

988 
s
 = 
	`vec_ñt_©_ödex
 (
em
->
£˘i⁄s
, 
£˘i⁄_ödex
);

989 
	`vec_‰ì
 (
s
->
c⁄ã¡s
);

990 
	`vec_add
 (
s
->
c⁄ã¡s
, 
√w_c⁄ã¡s
, 
n_c⁄ã¡_byãs
);

991 
	}
}

993 
Æways_ölöe
 
u8
 *

994 
	$ñf_£˘i⁄_«me
 (
ñf_maö_t
 * 
em
, 
ñf_£˘i⁄_t
 * 
s
)

996 
ñf_£˘i⁄_t
 *
es
 = 
	`vec_ñt_©_ödex
 (
em
->
£˘i⁄s
,

997 
em
->

998 
fûe_hódî
.
£˘i⁄_hódî_°rög_èbÀ_ödex
);

999  
	`vec_ñt_©_ödex
 (
es
->
c⁄ã¡s
, 
s
->
hódî
.
«me
);

1000 
	}
}

1002 
Æways_ölöe
 
u8


1003 
	$ñf_sw≠_u8
 (
ñf_maö_t
 * 
em
, 
u8
 
x
)

1005  
x
;

1006 
	}
}

1008 
Æways_ölöe
 
u16


1009 
	$ñf_sw≠_u16
 (
ñf_maö_t
 * 
em
, 
u16
 
x
)

1011  
em
->
√ed_byã_sw≠
 ? 
	`˛ib_byã_sw≠_u16
 (
x
) : x;

1012 
	}
}

1014 
Æways_ölöe
 
u32


1015 
	$ñf_sw≠_u32
 (
ñf_maö_t
 * 
em
, 
u32
 
x
)

1017  
em
->
√ed_byã_sw≠
 ? 
	`˛ib_byã_sw≠_u32
 (
x
) : x;

1018 
	}
}

1020 
Æways_ölöe
 
u64


1021 
	$ñf_sw≠_u64
 (
ñf_maö_t
 * 
em
, 
u64
 
x
)

1023  
em
->
√ed_byã_sw≠
 ? 
	`˛ib_byã_sw≠_u64
 (
x
) : x;

1024 
	}
}

1026 
	#FORMAT_ELF_MAIN_SYMBOLS
 (1 << 0)

	)

1027 
	#FORMAT_ELF_MAIN_RELOCATIONS
 (1 << 1)

	)

1028 
	#FORMAT_ELF_MAIN_DYNAMIC
 (1 << 2)

	)

1030 
f‹m©_fun˘i⁄_t
 
	gf‹m©_ñf_maö
;

1031 
f‹m©_fun˘i⁄_t
 
	gf‹m©_ñf_symbﬁ
;

1033 
˛ib_îr‹_t
 *
ñf_ªad_fûe
 (
ñf_maö_t
 * 
em
, *
fûe_«me
);

1034 
˛ib_îr‹_t
 *
ñf_wrôe_fûe
 (
ñf_maö_t
 * 
em
, *
fûe_«me
);

1035 
˛ib_îr‹_t
 *
ñf_dñëe_«med_£˘i⁄
 (
ñf_maö_t
 * 
em
, *
£˘i⁄_«me
);

1036 
˛ib_îr‹_t
 *
ñf_∑r£
 (
ñf_maö_t
 * 
em
, *
d©a
, 
uw‹d
 
d©a_byãs
);

1037 
ñf_∑r£_symbﬁs
 (
ñf_maö_t
 * 
em
);

1039 
˛ib_îr‹_t
 *
ñf_gë_£˘i⁄_by_«me
 (
ñf_maö_t
 * 
em
, *
£˘i⁄_«me
,

1040 
ñf_£˘i⁄_t
 ** 
ªsu…
);

1041 
˛ib_îr‹_t
 *
ñf_gë_£˘i⁄_by_°¨t_addªss
 (
ñf_maö_t
 * 
em
,

1042 
uw‹d
 
°¨t_addªss
,

1043 
ñf_£˘i⁄_t
 ** 
ªsu…
);

1046 
ñf_¸óã_£˘i⁄_wôh_c⁄ã¡s
 (
ñf_maö_t
 * 
em
,

1047 *
£˘i⁄_«me
,

1048 
ñf64_£˘i⁄_hódî_t
 * 
hódî
,

1049 *
c⁄ã¡s
, 
uw‹d
 
n_c⁄ã¡_byãs
);

1050 
uw‹d
 
ñf_dñëe_£gmít_wôh_ty≥
 (
ñf_maö_t
 * 
em
,

1051 
ñf_£gmít_ty≥_t
 
£gmít_ty≥
);

1052 
ñf_£t_dy«mic_íåõs
 (
ñf_maö_t
 * 
em
);

	@/usr/include/vppinfra/elf_clib.h

38 #i‚de‡
ö˛uded_˛ib_ñf_£lf_h


39 
	#ö˛uded_˛ib_ñf_£lf_h


	)

41 
	~<vµö‰a/ñf.h
>

42 
	~<vµö‰a/hash.h
>

44 
	#CLIB_ELF_SECTION_DATA_ALIGN
 32

	)

46 
	#CLIB_ELF_SECTION_ADD_PREFIX
(
n
Ë"˛ib_ñf_£˘i⁄_" 
	)
n

50 
	#CLIB_ELF_SECTION
(
SECTION
) \

51 
	`__©åibuã__
 ((
u£d
, \

52 
	`Æig√d
 (
CLIB_ELF_SECTION_DATA_ALIGN
), \

53 
	`£˘i⁄
 (
	`CLIB_ELF_SECTION_ADD_PREFIX
 (
SECTION
))))

	)

57 
	#˛ib_ñf_£˘i⁄_d©a_√xt
(
a
,
exåa
) \

58 
	`uw‹d_to_poöãr
 (
	`round_pow2
 (
	`poöãr_to_uw‹d
 (
a
 + 1Ë+ (
exåa
), \

59 
CLIB_ELF_SECTION_DATA_ALIGN
), \

60 *)

	)

64 *
	mlo
, *
	mhi
;

65 } 
	t˛ib_ñf_£˘i⁄_bounds_t
;

71 
˛ib_ñf_£˘i⁄_bounds_t
 *
	mbounds
;

74 
u8
 *
	m«me
;

75 } 
	t˛ib_ñf_£˘i⁄_t
;

80 
˛ib_ñf_£˘i⁄_t
 *
	m£˘i⁄s
;

83 
uw‹d
 *
	m£˘i⁄_by_«me
;

86 *
	mexec_∑th
;

88 
ñf_maö_t
 *
	mñf_maös
;

89 } 
	t˛ib_ñf_maö_t
;

91 
Æways_ölöe
 

92 
	$˛ib_ñf_maö_‰ì
 (
˛ib_ñf_maö_t
 * 
m
)

94 
˛ib_ñf_£˘i⁄_t
 *
s
;

95 
	`vec_f‹óch
 (
s
, 
m
->
£˘i⁄s
)

97 
	`vec_‰ì
 (
s
->
bounds
);

98 
	`vec_‰ì
 (
s
->
«me
);

100 
	`vec_‰ì
 (
m
->
£˘i⁄s
);

101 
	`hash_‰ì
 (
m
->
£˘i⁄_by_«me
);

104 
ñf_maö_t
 *
em
;

105 
	`vec_f‹óch
 (
em
, 
m
->
ñf_maös
)

107 
	`ñf_maö_‰ì
 (
em
);

109 
	`vec_‰ì
 (
m
->
ñf_maös
);

111 
	}
}

114 
˛ib_ñf_maö_öô
 (*
exec_∑th
);

116 
˛ib_ñf_£˘i⁄_bounds_t
 *
˛ib_ñf_gë_£˘i⁄_bounds
 (*
«me
);

121 
ñf64_symbﬁ_t
 
	msymbﬁ
;

124 
u32
 
	mñf_maö_ödex
;

127 
u32
 
	msymbﬁ_èbÀ_ödex
;

128 } 
	t˛ib_ñf_symbﬁ_t
;

131 
uw‹d
 
˛ib_ñf_symbﬁ_by_«me
 (*
«me
, 
˛ib_ñf_symbﬁ_t
 * 
ªsu…
);

132 
uw‹d
 
˛ib_ñf_symbﬁ_by_addªss
 (uw‹d 
addªss
, 
˛ib_ñf_symbﬁ_t
 * 
ªsu…
);

134 
f‹m©_fun˘i⁄_t
 
	gf‹m©_˛ib_ñf_symbﬁ
, 
	gf‹m©_˛ib_ñf_symbﬁ_wôh_addªss
;

	@/usr/include/vppinfra/elog.h

49 #i‚de‡
ö˛uded_˛ib_ñog_h


50 
	#ö˛uded_˛ib_ñog_h


	)

52 
	~<vµö‰a/ˇche.h
>

53 
	~<vµö‰a/îr‹.h
>

54 
	~<vµö‰a/£rülize.h
>

55 
	~<vµö‰a/time.h
>

56 
	~<vµö‰a/mhash.h
>

63 
u64
 
	mtime_cy˛es
;

66 
f64
 
	mtime
;

70 
u16
 
	mty≥
;

75 
u16
 
	måack
;

78 
u8
 
	md©a
[20];

79 } 
	tñog_evít_t
;

85 
u32
 
	mty≥_ödex_∂us_⁄e
;

88 **
	míum_°rögs_ve˘‹
;

91 *
	mf‹m©
;

100 *
	mf‹m©_¨gs
;

103 *
	mfun˘i⁄
;

106 
u32
 
	mn_íum_°rögs
;

109 *
	míum_°rögs
[];

110 } 
	tñog_evít_ty≥_t
;

115 *
	m«me
;

119 
u32
 
	måack_ödex_∂us_⁄e
;

120 } 
	tñog_åack_t
;

125 
u64
 
	m˝u
;

128 
u64
 
	mos_n£c
;

129 } 
	tñog_time_°amp_t
;

134 
u32
 
	mn_tŸÆ_evíts
;

138 
u32
 
	mn_tŸÆ_evíts_dißbÀ_limô
;

141 
ñog_evít_t
 
	mdummy_evít
;

144 
uw‹d
 
	mevít_rög_size
;

148 
ñog_evít_t
 *
	mevít_rög
;

151 
ñog_evít_ty≥_t
 *
	mevít_ty≥s
;

154 
uw‹d
 *
	mevít_ty≥_by_f‹m©
;

157 *
	m°rög_èbÀ
;

160 
ñog_åack_t
 *
	måacks
;

163 
ñog_åack_t
 
	mdeÁu…_åack
;

166 
˛ib_time_t
 
	m˝u_timî
;

169 
ñog_time_°amp_t
 
	möô_time
, 
	m£rülize_time
;

172 
uw‹d
 *
	mlock
;

176 
f64
 
	mn£c_≥r_˝u_˛ock
;

179 
ñog_evít_t
 *
	mevíts
;

180 } 
	tñog_maö_t
;

187 
Æways_ölöe
 
uw‹d


188 
	$ñog_n_evíts_ö_buf„r
 (
ñog_maö_t
 * 
em
)

190  
	`˛ib_mö
 (
em
->
n_tŸÆ_evíts
,Ém->
evít_rög_size
);

191 
	}
}

197 
Æways_ölöe
 
uw‹d


198 
	$ñog_buf„r_ˇ∑côy
 (
ñog_maö_t
 * 
em
)

200  
em
->
evít_rög_size
;

201 
	}
}

206 
Æways_ölöe
 

207 
	$ñog_ª£t_buf„r
 (
ñog_maö_t
 * 
em
)

209 
em
->
n_tŸÆ_evíts
 = 0;

210 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 = ~0;

211 
	}
}

216 
Æways_ölöe
 

217 
	$ñog_íabÀ_dißbÀ
 (
ñog_maö_t
 * 
em
, 
is_íabÀd
)

219 
em
->
n_tŸÆ_evíts
 = 0;

220 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 = 
is_íabÀd
 ? ~0 : 0;

221 
	}
}

232 
Æways_ölöe
 

233 
	$ñog_dißbÀ_a·î_evíts
 (
ñog_maö_t
 * 
em
, 
uw‹d
 
n
)

235 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 =Ém->
n_tŸÆ_evíts
 + 
n
;

236 
	}
}

244 
Æways_ölöe
 

245 
	$ñog_dißbÀ_åiggî
 (
ñog_maö_t
 * 
em
)

247 
em
->
n_tŸÆ_evíts_dißbÀ_limô
 =

248 
em
->
n_tŸÆ_evíts
 + 
	`vec_Àn
 (em->
evít_rög
) / 2;

249 
	}
}

258 
w‹d
 
ñog_evít_ty≥_ªgi°î
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
t
);

266 
w‹d
 
ñog_åack_ªgi°î
 (
ñog_maö_t
 * 
em
, 
ñog_åack_t
 * 
t
);

272 
Æways_ölöe
 
uw‹d


273 
	$ñog_is_íabÀd
 (
ñog_maö_t
 * 
em
)

275  
em
->
n_tŸÆ_evíts
 <Ém->
n_tŸÆ_evíts_dißbÀ_limô
;

276 
	}
}

289 
Æways_ölöe
 *

290 
	$ñog_evít_d©a_ölöe
 (
ñog_maö_t
 * 
em
,

291 
ñog_evít_ty≥_t
 * 
ty≥
,

292 
ñog_åack_t
 * 
åack
, 
u64
 
˝u_time
)

294 
ñog_evít_t
 *
e
;

295 
uw‹d
 
ei
;

296 
w‹d
 
ty≥_ödex
, 
åack_ödex
;

299 i‡(
	`PREDICT_FALSE
 (!
	`ñog_is_íabÀd
 (
em
)))

300  
em
->
dummy_evít
.
d©a
;

302 
ty≥_ödex
 = (
w‹d
Ë
ty≥
->
ty≥_ödex_∂us_⁄e
 - 1;

303 
åack_ödex
 = (
w‹d
Ë
åack
->
åack_ödex_∂us_⁄e
 - 1;

304 i‡(
	`PREDICT_FALSE
 ((
ty≥_ödex
 | 
åack_ödex
) < 0))

306 i‡(
ty≥_ödex
 < 0)

307 
ty≥_ödex
 = 
	`ñog_evít_ty≥_ªgi°î
 (
em
, 
ty≥
);

308 i‡(
åack_ödex
 < 0)

309 
åack_ödex
 = 
	`ñog_åack_ªgi°î
 (
em
, 
åack
);

312 
	`ASSERT
 (
åack_ödex
 < 
	`vec_Àn
 (
em
->
åacks
));

313 
	`ASSERT
 (
	`is_pow2
 (
	`vec_Àn
 (
em
->
evít_rög
)));

315 i‡(
em
->
lock
)

316 
ei
 = 
	`˛ib_smp_©omic_add
 (&
em
->
n_tŸÆ_evíts
, 1);

318 
ei
 = 
em
->
n_tŸÆ_evíts
++;

320 
ei
 &
em
->
evít_rög_size
 - 1;

321 
e
 = 
	`vec_ñt_©_ödex
 (
em
->
evít_rög
, 
ei
);

323 
e
->
time_cy˛es
 = 
˝u_time
;

324 
e
->
ty≥
 = 
ty≥_ödex
;

325 
e
->
åack
 = 
åack_ödex
;

328  
e
->
d©a
;

329 
	}
}

332 *
ñog_evít_d©a
 (
ñog_maö_t
 * 
em
,

333 
ñog_evít_ty≥_t
 * 
ty≥
,

334 
ñog_åack_t
 * 
åack
, 
u64
 
˝u_time
);

347 
Æways_ölöe
 *

348 
	$ñog_evít_d©a_nŸ_ölöe
 (
ñog_maö_t
 * 
em
,

349 
ñog_evít_ty≥_t
 * 
ty≥
,

350 
ñog_åack_t
 * 
åack
, 
u64
 
˝u_time
)

353 i‡(
	`PREDICT_FALSE
 (!
	`ñog_is_íabÀd
 (
em
)))

354  
em
->
dummy_evít
.
d©a
;

355  
	`ñog_evít_d©a
 (
em
, 
ty≥
, 
åack
, 
˝u_time
);

356 
	}
}

363 
Æways_ölöe
 

364 
	$ñog
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
, 
u32
 
d©a
)

366 
u32
 *
d
 = 
	`ñog_evít_d©a_nŸ_ölöe
 (
em
,

367 
ty≥
,

368 &
em
->
deÁu…_åack
,

369 
	`˛ib_˝u_time_now
 ());

370 
d
[0] = 
d©a
;

371 
	}
}

378 
Æways_ölöe
 

379 
	$ñog_ölöe
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
, 
u32
 
d©a
)

381 
u32
 *
d
 = 
	`ñog_evít_d©a_ölöe
 (
em
,

382 
ty≥
,

383 &
em
->
deÁu…_åack
,

384 
	`˛ib_˝u_time_now
 ());

385 
d
[0] = 
d©a
;

386 
	}
}

394 
Æways_ölöe
 

395 
	$ñog_åack
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
, 
ñog_åack_t
 * 
åack
,

396 
u32
 
d©a
)

398 
u32
 *
d
 = 
	`ñog_evít_d©a_nŸ_ölöe
 (
em
,

399 
ty≥
,

400 
åack
,

401 
	`˛ib_˝u_time_now
 ());

402 
d
[0] = 
d©a
;

403 
	}
}

411 
Æways_ölöe
 

412 
	$ñog_åack_ölöe
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
,

413 
ñog_åack_t
 * 
åack
, 
u32
 
d©a
)

415 
u32
 *
d
 = 
	`ñog_evít_d©a_ölöe
 (
em
,

416 
ty≥
,

417 
åack
,

418 
	`˛ib_˝u_time_now
 ());

419 
d
[0] = 
d©a
;

420 
	}
}

422 
Æways_ölöe
 *

423 
	$ñog_d©a
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
, 
ñog_åack_t
 * 
åack
)

425  
	`ñog_evít_d©a_nŸ_ölöe
 (
em
, 
ty≥
, 
åack
, 
	`˛ib_˝u_time_now
 ());

426 
	}
}

428 
Æways_ölöe
 *

429 
	$ñog_d©a_ölöe
 (
ñog_maö_t
 * 
em
, 
ñog_evít_ty≥_t
 * 
ty≥
,

430 
ñog_åack_t
 * 
åack
)

432  
	`ñog_evít_d©a_ölöe
 (
em
, 
ty≥
, 
åack
, 
	`˛ib_˝u_time_now
 ());

433 
	}
}

436 
	#__ELOG_TYPE_VAR
(
f
Ë
	)
f

437 
	#__ELOG_TRACK_VAR
(
f
Ë
	)
f

439 
	#ELOG_TYPE_DECLARE
(
f
Ë
ñog_evít_ty≥_t
 
	`__ELOG_TYPE_VAR
(f)

	)

441 
	#ELOG_TYPE_INIT_FORMAT_AND_FUNCTION
(
fmt
,
func
) \

442 { .
f‹m©
 = 
fmt
, .
fun˘i⁄
 = 
func
, }

	)

444 
	#ELOG_TYPE_INIT
(
fmt
) \

445 
	`ELOG_TYPE_INIT_FORMAT_AND_FUNCTION
(
fmt
,(*Ë
__FUNCTION__
)

	)

447 
	#ELOG_TYPE_DECLARE_HELPER
(
f
,
fmt
,
func
) \

448 
ñog_evít_ty≥_t
 
	`__ELOG_TYPE_VAR
(
f
) = \

449 
	`ELOG_TYPE_INIT_FORMAT_AND_FUNCTION
 (
fmt
, 
func
)

	)

451 
	#ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
(
f
,
fmt
) \

452 
	`ELOG_TYPE_DECLARE_HELPER
 (
f
, 
fmt
, (*Ë
__FUNCTION__
)

	)

454 
	#ELOG_TYPE_DECLARE_FORMAT
(
f
,
fmt
) \

455 
	`ELOG_TYPE_DECLARE_HELPER
 (
f
, 
fmt
, 0)

	)

459 
	#ELOG_TYPE
(
f
,
fmt
Ë
	`ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
(f,fmt)

	)

460 
	#ELOG_TYPE_D
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT
 (f, #‡" %d")

	)

461 
	#ELOG_TYPE_X
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT
 (f, #‡" 0x%x")

	)

462 
	#ELOG_TYPE_DF
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
 (f, #‡" %d")

	)

463 
	#ELOG_TYPE_XF
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
 (f, #‡" 0x%x")

	)

464 
	#ELOG_TYPE_FD
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
 (f, #‡" %d")

	)

465 
	#ELOG_TYPE_FX
(
f
Ë
	`ELOG_TYPE_DECLARE_FORMAT_AND_FUNCTION
 (f, #‡" 0x%x")

	)

467 
	#ELOG_TRACK_DECLARE
(
f
Ë
ñog_åack_t
 
	`__ELOG_TRACK_VAR
(f)

	)

468 
	#ELOG_TRACK
(
f
Ë
	`ELOG_TRACK_DECLARE
(fË{ .
«me
 = #f, }

	)

471 
	#ELOG
(
em
,
f
,
d©a
Ë
	`ñog
 (”m), &
	`__ELOG_TYPE_VAR
(f), d©a)

	)

472 
	#ELOG_INLINE
(
em
,
f
,
d©a
Ë
	`ñog_ölöe
 (”m), &
	`__ELOG_TYPE_VAR
(f), d©a)

	)

475 
	#ELOG_TRACK_DATA
(
em
,
f
,
åack
) \

476 
	`ñog_d©a
 ((
em
), &
	`__ELOG_TYPE_VAR
(
f
), &
	`__ELOG_TRACK_VAR
(
åack
))

	)

477 
	#ELOG_TRACK_DATA_INLINE
(
em
,
f
,
åack
) \

478 
	`ñog_d©a_ölöe
 ((
em
), &
	`__ELOG_TYPE_VAR
(
f
), &
	`__ELOG_TRACK_VAR
(
åack
))

	)

481 
	#ELOG_DATA
(
em
,
f
Ë
	`ñog_d©a
 (”m), &
	`__ELOG_TYPE_VAR
 (f), &”m)->
deÁu…_åack
)

	)

482 
	#ELOG_DATA_INLINE
(
em
,
f
Ë
	`ñog_d©a_ölöe
 (”m), &
	`__ELOG_TYPE_VAR
 (f), &”m)->
deÁu…_åack
)

	)

494 
u32
 
ñog_°rög
 (
ñog_maö_t
 * 
em
, *
f‹m©
, ...);

496 
ñog_time_now
 (
ñog_time_°amp_t
 * 
ë
);

503 
ñog_evít_t
 *
ñog_gë_evíts
 (
ñog_maö_t
 * 
em
);

510 
ñog_evít_t
 *
ñog_≥ek_evíts
 (
ñog_maö_t
 * 
em
);

513 
ñog_mîge
 (
ñog_maö_t
 * 
d°
, 
u8
 * 
d°_èg
,

514 
ñog_maö_t
 * 
§c
, 
u8
 * 
§c_èg
, 
f64
 
Æign_twók
);

517 
u8
 *
f‹m©_ñog_evít
 (u8 * 
s
, 
va_li°
 * 
va
);

518 
u8
 *
f‹m©_ñog_åack
 (u8 * 
s
, 
va_li°
 * 
va
);

520 
£rülize_ñog_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
);

521 
un£rülize_ñog_maö
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
);

523 
ñog_öô
 (
ñog_maö_t
 * 
em
, 
u32
 
n_evíts
);

524 
ñog_Æloc
 (
ñog_maö_t
 * 
em
, 
u32
 
n_evíts
);

526 #ifde‡
CLIB_UNIX


527 
Æways_ölöe
 
˛ib_îr‹_t
 *

528 
	$ñog_wrôe_fûe
 (
ñog_maö_t
 * 
em
, *
˛ib_fûe
, 
Êush_rög
)

530 
£rülize_maö_t
 
m
;

531 
˛ib_îr‹_t
 *
îr‹
;

533 
îr‹
 = 
	`£rülize_›í_˛ib_fûe
 (&
m
, 
˛ib_fûe
);

534 i‡(
îr‹
)

535  
îr‹
;

536 
îr‹
 = 
	`£rülize
 (&
m
, 
£rülize_ñog_maö
, 
em
, 
Êush_rög
);

537 i‡(!
îr‹
)

538 
	`£rülize_˛o£
 (&
m
);

539  
îr‹
;

540 
	}
}

542 
Æways_ölöe
 
˛ib_îr‹_t
 *

543 
	$ñog_ªad_fûe
 (
ñog_maö_t
 * 
em
, *
˛ib_fûe
)

545 
£rülize_maö_t
 
m
;

546 
˛ib_îr‹_t
 *
îr‹
;

548 
îr‹
 = 
	`un£rülize_›í_˛ib_fûe
 (&
m
, 
˛ib_fûe
);

549 i‡(
îr‹
)

550  
îr‹
;

551 
îr‹
 = 
	`un£rülize
 (&
m
, 
un£rülize_ñog_maö
, 
em
);

552 i‡(!
îr‹
)

553 
	`un£rülize_˛o£
 (&
m
);

554  
îr‹
;

555 
	}
}

	@/usr/include/vppinfra/error.h

38 #i‚de‡
ö˛uded_îr‹_h


39 
	#ö˛uded_îr‹_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/îr‹_boŸ°øp.h
>

44 #ifde‡
CLIB_UNIX


45 
	~<î∫o.h
>

48 #ifde‡
CLIB_LINUX_KERNEL


49 
	~<löux/î∫o.h
>

52 
	~<°d¨g.h
>

53 
	~<vµö‰a/vec.h
>

56 
	t˛ib_îr‹_h™dÀr_func_t
 (*
	t¨g
, 
	tu8
 * 
	tmsg
, 
	tmsg_Àn
);

57 
˛ib_îr‹_ªgi°î_h™dÀr
 (
˛ib_îr‹_h™dÀr_func_t
 
func
, *
¨g
);

59 
	#˛ib_w¨nög
(
f‹m©
,
¨gs
...) \

60 
	`_˛ib_îr‹
 (
CLIB_ERROR_WARNING
, 
˛ib_îr‹_fun˘i⁄
, 
__LINE__
, 
f‹m©
, ## 
¨gs
)

	)

62 
	#˛ib_îr‹
(
f‹m©
,
¨gs
...) \

63 
	`_˛ib_îr‹
 (
CLIB_ERROR_FATAL
, 
˛ib_îr‹_fun˘i⁄
, 
__LINE__
, 
f‹m©
, ## 
¨gs
)

	)

65 
	#˛ib_unix_îr‹
(
f‹m©
,
¨gs
...) \

66 
	`_˛ib_îr‹
 (
CLIB_ERROR_FATAL
 | 
CLIB_ERROR_ERRNO_VALID
, 
˛ib_îr‹_fun˘i⁄
, 
__LINE__
, 
f‹m©
, ## 
¨gs
)

	)

68 
	#˛ib_unix_w¨nög
(
f‹m©
,
¨gs
...) \

69 
	`_˛ib_îr‹
 (
CLIB_ERROR_WARNING
 | 
CLIB_ERROR_ERRNO_VALID
, 
˛ib_îr‹_fun˘i⁄
, 
__LINE__
, 
f‹m©
, ## 
¨gs
)

	)

72 
	#˛ib_∑nic
(
f‹m©
,
¨gs
...) \

73 
	`_˛ib_îr‹
 (
CLIB_ERROR_ABORT
, (*Ë
˛ib_îr‹_fun˘i⁄
, 
__LINE__
, 
f‹m©
, ## 
¨gs
)

	)

75 
	~<vµö‰a/˛ib_îr‹.h
>

77 
	#˛ib_îr‹_gë_code
(
îr
Ë(”ºË? (îr)->
code
 : 0)

	)

78 
	#˛ib_îr‹_£t_code
(
îr
, 
c
) \

80 i‡(
îr
) \

81 (
îr
)->
code
 = (
c
); \

82 } 0)

	)

84 *
˛ib_îr‹_‰ì_ve˘‹
 (
˛ib_îr‹_t
 * 
îr‹s
);

86 
	#˛ib_îr‹_‰ì
(
e
Ëê
	`˛ib_îr‹_‰ì_ve˘‹
”)

	)

88 
˛ib_îr‹_t
 *
_˛ib_îr‹_ªtu∫
 (˛ib_îr‹_à* 
îr‹s
,

89 
™y
 
code
,

90 
uw‹d
 
Êags
,

91 *
whîe
, *
fmt
, ...);

93 
	#˛ib_îr‹_ªtu∫_code
(
e
,
code
,
Êags
,
¨gs
...) \

94 
	`_˛ib_îr‹_ªtu∫
((
e
),(
code
),(
Êags
),(*)
˛ib_îr‹_fun˘i⁄
,
¨gs
)

	)

96 
	#˛ib_îr‹_¸óã
(
¨gs
...) \

97 
	`˛ib_îr‹_ªtu∫_code
(0,0,0,
¨gs
)

	)

99 
	#˛ib_îr‹_ªtu∫
(
e
,
¨gs
...) \

100 
	`˛ib_îr‹_ªtu∫_code
(
e
,0,0,
¨gs
)

	)

102 
	#˛ib_îr‹_ªtu∫_unix
(
e
,
¨gs
...) \

103 
	`˛ib_îr‹_ªtu∫_code
(
e
,
î∫o
,
CLIB_ERROR_ERRNO_VALID
,
¨gs
)

	)

105 
	#˛ib_îr‹_ªtu∫_Áèl
(
e
,
¨gs
...) \

106 
	`˛ib_îr‹_ªtu∫_code
(
e
,0,
CLIB_ERROR_FATAL
,
¨gs
)

	)

108 
	#˛ib_îr‹_ªtu∫_unix_Áèl
(
e
,
¨gs
...) \

109 
	`˛ib_îr‹_ªtu∫_code
(
e
,
î∫o
,
CLIB_ERROR_ERRNO_VALID
|
CLIB_ERROR_FATAL
,
¨gs
)

	)

111 
˛ib_îr‹_t
 *
_˛ib_îr‹_ªp‹t
 (˛ib_îr‹_à* 
îr‹s
);

113 
	#˛ib_îr‹_ªp‹t
(
e
Ëdÿ{ (eË
	`_˛ib_îr‹_ªp‹t
 (e); } 0)

	)

115 
u8
 *
f‹m©_˛ib_îr‹
 (u8 * 
s
, 
va_li°
 * 
va
);

117 
Æways_ölöe
 
w‹d


118 
	$unix_îr‹_is_Áèl
 (
w‹d
 
îr‹
)

120 #ifde‡
CLIB_UNIX


121 
îr‹
)

123 
EWOULDBLOCK
:

124 
EINTR
:

129 
	}
}

131 
	#IF_ERROR_IS_FATAL_RETURN_ELSE_FREE
(
e
) \

133 i‡(
e
) \

135 i‡(
	`unix_îr‹_is_Áèl
 (
	`˛ib_îr‹_gë_code
 (
e
))) \

136  (
e
); \

138 
	`˛ib_îr‹_‰ì
 (
e
); \

140 } 0)

	)

142 
	#ERROR_RETURN_IF
(
x
) \

144 
˛ib_îr‹_t
 * 
_îr‹_ªtu∫_if
 = (
x
); \

145 i‡(
_îr‹_ªtu∫_if
) \

146  
	`˛ib_îr‹_ªtu∫
 (
_îr‹_ªtu∫_if
, 0); \

147 } 0)

	)

149 
	#ERROR_ASSERT
(
åuth
) \

151 
˛ib_îr‹_t
 * 
_îr‹_as£π
 = 0; \

152 i‡(
CLIB_DEBUG
 > 0 && ! (
åuth
)) \

154 
_îr‹_as£π
 = 
˛ib_îr‹_ªtu∫_Áèl
 \

156 
__FILE__
, \

157 (
uw‹d
Ë
__LINE__
, \

158 
˛ib_îr‹_fun˘i⁄
, \

161 
_îr‹_as£π
; \

162 })

	)

165 
	#CLIB_ERROR_ASSERT
(
åuth
) \

167 
˛ib_îr‹_t
 * 
_îr‹_as£π
 = 0; \

168 i‡(! (
åuth
)) \

170 
_îr‹_as£π
 = \

171 
˛ib_îr‹_ªtu∫_Áèl
 \

173 
__FILE__
, \

174 (
uw‹d
Ë
__LINE__
, \

175 
˛ib_îr‹_fun˘i⁄
, \

178 
_îr‹_as£π
; \

179 })

	)

185 #ifde‡
__COVERITY__


186 #i‚de‡
_Sètic_as£π


187 
	#_Sètic_as£π
(
x
,
y
)

	)

	@/usr/include/vppinfra/fifo.h

38 #i‚de‡
ö˛uded_fifo_h


39 
	#ö˛uded_fifo_h


	)

41 
	~<vµö‰a/ˇche.h
>

42 
	~<vµö‰a/îr‹.h
>

43 
	~<vµö‰a/vec.h
>

48 
u32
 
	mhód_ödex
;

51 
u32
 
	mèû_ödex
;

52 } 
	t˛ib_fifo_hódî_t
;

54 
Æways_ölöe
 
˛ib_fifo_hódî_t
 *

55 
	$˛ib_fifo_hódî
 (*
f
)

57  
	`vec_hódî
 (
f
,  (
˛ib_fifo_hódî_t
));

58 
	}
}

61 
	#˛ib_fifo_Àn
(
v
Ë
	`vec_Àn
(v)

	)

62 
	#_˛ib_fifo_Àn
(
v
Ë
	`_vec_Àn
(v)

	)

63 
	#˛ib_fifo_íd
(
v
Ë
	`vec_íd
(v)

	)

65 
Æways_ölöe
 
uw‹d


66 
	$˛ib_fifo_ñts
 (*
v
)

68 
w‹d
 
l
, 
r
;

69 
˛ib_fifo_hódî_t
 *
f
 = 
	`˛ib_fifo_hódî
 (
v
);

71 i‡(!
v
)

74 
l
 = 
	`_˛ib_fifo_Àn
 (
v
);

75 
r
 = (
w‹d
Ë
f
->
èû_ödex
 - (w‹dËf->
hód_ödex
;

76 
r
 =Ñ < 0 ?Ñ + 
l
 :Ñ;

77 
	`ASSERT
 (
r
 >0 &&Ñ <
l
);

78  
r
;

79 
	}
}

81 
Æways_ölöe
 
uw‹d


82 
	$˛ib_fifo_‰ì_ñts
 (*
v
)

84  
	`˛ib_fifo_Àn
 (
v
Ë- 
	`˛ib_fifo_ñts
 (v);

85 
	}
}

87 
Æways_ölöe
 

88 
	$˛ib_fifo_ª£t
 (*
v
)

90 
˛ib_fifo_hódî_t
 *
f
 = 
	`˛ib_fifo_hódî
 (
v
);

91 i‡(
v
)

93 
f
->
hód_ödex
 = f->
èû_ödex
 = 0;

94 
	`_vec_Àn
 (
v
) = 0;

96 
	}
}

99 *
_˛ib_fifo_ªsize
 (*
v
, 
uw‹d
 
n_ñts
, uw‹d 
ñt_byãs
);

101 
	#˛ib_fifo_ªsize
(
f
,
n_ñts
) \

102 
f
 = 
	`_˛ib_fifo_ªsize
 ((f), (
n_ñts
),  ((f)[0]))

	)

104 
Æways_ölöe
 *

105 
	$_˛ib_fifo_vÆid©e
 (*
v
, 
uw‹d
 
n_ñts
, uw‹d 
ñt_byãs
)

107 i‡(
	`˛ib_fifo_‰ì_ñts
 (
v
Ë< 
n_ñts
)

108 
v
 = 
	`_˛ib_fifo_ªsize
 (v, 
n_ñts
, 
ñt_byãs
);

109  
v
;

110 
	}
}

112 
	#˛ib_fifo_vÆid©e
(
f
,
n_ñts
) \

113 
f
 = 
	`_˛ib_fifo_vÆid©e
 ((f), (
n_ñts
),  (f[0]))

	)

116 
Æways_ölöe
 *

117 
	$_˛ib_fifo_adv™˚_èû
 (*
v
, 
w‹d
 
n_ñts
, 
uw‹d
 
ñt_byãs
,

118 
uw‹d
 * 
èû_ªtu∫
)

120 
w‹d
 
i
, 
l
, 
n_‰ì
;

121 
˛ib_fifo_hódî_t
 *
f
;

123 
n_‰ì
 = 
	`˛ib_fifo_‰ì_ñts
 (
v
);

124 i‡(
n_‰ì
 < 
n_ñts
)

126 
v
 = 
	`_˛ib_fifo_ªsize
 (v, 
n_ñts
, 
ñt_byãs
);

127 
n_‰ì
 = 
	`˛ib_fifo_‰ì_ñts
 (
v
);

130 
	`ASSERT
 (
n_‰ì
 >
n_ñts
);

131 
n_‰ì
 -
n_ñts
;

133 
f
 = 
	`˛ib_fifo_hódî
 (
v
);

134 
l
 = 
	`_˛ib_fifo_Àn
 (
v
);

135 
i
 = 
f
->
èû_ödex
;

137 i‡(
n_‰ì
 == 0)

140 
f
->
èû_ödex
 = f->
hód_ödex
 + 
l
;

144 
w‹d
 
n
 = 
f
->
èû_ödex
 + 
n_ñts
;

145 i‡(
n
 >
l
)

146 
n
 -
l
;

147 i‡(
n
 < 0)

148 
n
 +
l
;

149 
	`ASSERT
 (
n
 >0 &&Ç < 
l
);

150 
f
->
èû_ödex
 = 
n
;

153 
	`ASSERT
 (
	`˛ib_fifo_‰ì_ñts
 (
v
Ë=
n_‰ì
);

155 i‡(
èû_ªtu∫
)

156 *
èû_ªtu∫
 = 
n_ñts
 > 0 ? 
i
 : 
f
->
èû_ödex
;

158  
v
;

159 
	}
}

161 
	#˛ib_fifo_adv™˚_èû
(
f
,
n_ñts
) \

163 
uw‹d
 
_i
; \

164 (
f
Ë
	`_˛ib_fifo_adv™˚_èû
 ((f), (
n_ñts
),  ((f)[0]), &
_i
); \

165 (
f
Ë+ 
_i
; \

166 })

	)

168 
Æways_ölöe
 
uw‹d


169 
	$˛ib_fifo_adv™˚_hód
 (*
v
, 
uw‹d
 
n_ñts
)

171 
˛ib_fifo_hódî_t
 *
f
;

172 
uw‹d
 
l
, 
i
, 
n
;

174 
	`ASSERT
 (
	`˛ib_fifo_ñts
 (
v
Ë>
n_ñts
);

175 
f
 = 
	`˛ib_fifo_hódî
 (
v
);

176 
l
 = 
	`_˛ib_fifo_Àn
 (
v
);

179 i‡(
f
->
èû_ödex
 =f->
hód_ödex
 + 
l
)

180 
f
->
èû_ödex
 = f->
hód_ödex
;

182 
n
 = 
i
 = 
f
->
hód_ödex
;

183 
n
 +
n_ñts
;

184 
n
 =Ç >
l
 ?Ç -Ü :Ç;

185 
	`ASSERT
 (
n
 < 
l
);

186 
f
->
hód_ödex
 = 
n
;

188  
i
;

189 
	}
}

192 
	#˛ib_fifo_add1
(
f
,
e
) \

194 
uw‹d
 
_i
; \

195 (
f
Ë
	`_˛ib_fifo_adv™˚_èû
 ((f), 1,  ((f)[0]), &
_i
); \

196 (
f
)[
_i
] = (
e
); \

197 } 0)

	)

200 
	#˛ib_fifo_add2
(
f
,
p
) \

202 
uw‹d
 
_i
; \

203 (
f
Ë
	`_˛ib_fifo_adv™˚_èû
 ((f), 1,  ((f)[0]), &
_i
); \

204 (
p
Ë(
f
Ë+ 
_i
; \

205 } 0)

	)

208 
	#˛ib_fifo_add
(
f
,
e
,
n
) \

210 
uw‹d
 
_i
, 
_l
; 
w‹d
 
_n0
, 
_n1
; \

212 
_n0
 = (
n
); \

213 (
f
Ë
	`_˛ib_fifo_adv™˚_èû
 ((f), 
_n0
,  ((f)[0]), &
_i
); \

214 
_l
 = 
	`˛ib_fifo_Àn
 (
f
); \

215 
_n1
 = 
_i
 + 
_n0
 - 
_l
; \

216 
_n1
 = _n1 < 0 ? 0 : _n1; \

217 
_n0
 -
_n1
; \

218 
	`˛ib_mem˝y
 ((
f
Ë+ 
_i
, (
e
), 
_n0
 *  ((f)[0])); \

219 i‡(
_n1
) \

220 
	`˛ib_mem˝y
 ((
f
Ë+ 0, (
e
Ë+ 
_n0
, 
_n1
 *  ((f)[0])); \

221 } 0)

	)

224 
	#˛ib_fifo_sub1
(
f
,
e
) \

226 
uw‹d
 
_i
; \

227 
	`ASSERT
 (
	`˛ib_fifo_ñts
 (
f
) >= 1); \

228 
_i
 = 
	`˛ib_fifo_adv™˚_hód
 ((
f
), 1); \

229 (
e
Ë(
f
)[
_i
]; \

230 } 0)

	)

232 
	#˛ib_fifo_sub2
(
f
,
p
) \

234 
uw‹d
 
_i
; \

235 
	`ASSERT
 (
	`˛ib_fifo_ñts
 (
f
) >= 1); \

236 
_i
 = 
	`˛ib_fifo_adv™˚_hód
 ((
f
), 1); \

237 (
p
Ë(
f
Ë+ 
_i
; \

238 } 0)

	)

240 
Æways_ölöe
 
uw‹d


241 
	$˛ib_fifo_hód_ödex
 (*
v
)

243 
˛ib_fifo_hódî_t
 *
f
 = 
	`˛ib_fifo_hódî
 (
v
);

244  
v
 ? 
f
->
hód_ödex
 : 0;

245 
	}
}

247 
Æways_ölöe
 
uw‹d


248 
	$˛ib_fifo_èû_ödex
 (*
v
)

250 
˛ib_fifo_hódî_t
 *
f
 = 
	`˛ib_fifo_hódî
 (
v
);

251  
v
 ? 
f
->
èû_ödex
 : 0;

252 
	}
}

254 
	#˛ib_fifo_hód
(
v
Ë((vË+ 
	`˛ib_fifo_hód_ödex
 (v))

	)

255 
	#˛ib_fifo_èû
(
v
Ë((vË+ 
	`˛ib_fifo_èû_ödex
 (v))

	)

257 
	#˛ib_fifo_‰ì
(
f
Ë
	`vec_‰ì_h
((f),(
˛ib_fifo_hódî_t
))

	)

259 
Æways_ölöe
 
uw‹d


260 
	$˛ib_fifo_ñt_ödex
 (*
v
, 
uw‹d
 
i
)

262 
˛ib_fifo_hódî_t
 *
f
 = 
	`˛ib_fifo_hódî
 (
v
);

263 
uw‹d
 
ªsu…
 = 0;

265 
	`ASSERT
 (
i
 < 
	`˛ib_fifo_ñts
 (
v
));

267 i‡(
v
)

269 
ªsu…
 = 
f
->
hód_ödex
 + 
i
;

270 i‡(
ªsu…
 >
	`_vec_Àn
 (
v
))

271 
ªsu…
 -
	`_vec_Àn
 (
v
);

274  
ªsu…
;

275 
	}
}

277 
	#˛ib_fifo_ñt_©_ödex
(
v
,
i
Ë((vË+ 
	`˛ib_fifo_ñt_ödex
 (v, (i)))

	)

279 
	#˛ib_fifo_f‹óch
(
v
,
f
,
body
) \

281 
uw‹d
 
_i
, 
_l
, 
_n
; \

283 
_i
 = 
	`˛ib_fifo_hód_ödex
 (
f
); \

284 
_l
 = 
	`˛ib_fifo_Àn
 (
f
); \

285 
_n
 = 
	`˛ib_fifo_ñts
 (
f
); \

286 
_n
 > 0) \

288 (
v
Ë(
f
Ë+ 
_i
; \

289 dÿ{ 
body
; } 0); \

290 
_n
--; \

291 
_i
++; \

292 
_i
 = _ò>
_l
 ? 0 : _i; \

294 } 0)

	)

	@/usr/include/vppinfra/file.h

40 #i‚de‡
ö˛uded_˛ib_fûe_h


41 
	#ö˛uded_˛ib_fûe_h


	)

43 
	~<vµö‰a/sockë.h
>

44 
	~<vµö‰a/poﬁ.h
>

45 
	~<ãrmios.h
>

48 
	g˛ib_fûe
;

49 
	g˛ib_îr‹_t
 *(
	t˛ib_fûe_fun˘i⁄_t
Ë(
	t˛ib_fûe
 * 
	tf
);

51 
	s˛ib_fûe


54 
u32
 
	mfûe_des¸ùt‹
;

56 
u32
 
	mÊags
;

57 
	#UNIX_FILE_DATA_AVAILABLE_TO_WRITE
 (1 << 0)

	)

58 
	#UNIX_FILE_EVENT_EDGE_TRIGGERED
 (1 << 1)

	)

61 
u32
 
	mpﬁlög_thªad_ödex
;

64 
uw‹d
 
	m¥iv©e_d©a
;

67 
˛ib_fûe_fun˘i⁄_t
 *
	mªad_fun˘i⁄
, *
	mwrôe_fun˘i⁄
, *
	mîr‹_fun˘i⁄
;

70 
u8
 *
	mdes¸ùti⁄
;

73 
u64
 
	mªad_evíts
;

74 
u64
 
	mwrôe_evíts
;

75 
u64
 
	mîr‹_evíts
;

76 } 
	t˛ib_fûe_t
;

80 
	mUNIX_FILE_UPDATE_ADD
,

81 
	mUNIX_FILE_UPDATE_MODIFY
,

82 
	mUNIX_FILE_UPDATE_DELETE
,

83 } 
	t˛ib_fûe_upd©e_ty≥_t
;

88 
˛ib_fûe_t
 *
	mfûe_poﬁ
;

90 (*
	mfûe_upd©e
Ë(
˛ib_fûe_t
 * 
	mfûe
,

91 
˛ib_fûe_upd©e_ty≥_t
 
	mupd©e_ty≥
);

93 } 
	t˛ib_fûe_maö_t
;

95 
Æways_ölöe
 
uw‹d


96 
	$˛ib_fûe_add
 (
˛ib_fûe_maö_t
 * 
um
, 
˛ib_fûe_t
 * 
ãm∂©e
)

98 
˛ib_fûe_t
 *
f
;

99 
	`poﬁ_gë
 (
um
->
fûe_poﬁ
, 
f
);

100 
f
[0] = 
ãm∂©e
[0];

101 
f
->
ªad_evíts
 = 0;

102 
f
->
wrôe_evíts
 = 0;

103 
f
->
îr‹_evíts
 = 0;

104 
um
->
	`fûe_upd©e
 (
f
, 
UNIX_FILE_UPDATE_ADD
);

105  
f
 - 
um
->
fûe_poﬁ
;

106 
	}
}

108 
Æways_ölöe
 

109 
	$˛ib_fûe_dñ
 (
˛ib_fûe_maö_t
 * 
um
, 
˛ib_fûe_t
 * 
f
)

111 
um
->
	`fûe_upd©e
 (
f
, 
UNIX_FILE_UPDATE_DELETE
);

112 
	`˛o£
 (
f
->
fûe_des¸ùt‹
);

113 
f
->
fûe_des¸ùt‹
 = ~0;

114 
	`vec_‰ì
 (
f
->
des¸ùti⁄
);

115 
	`poﬁ_put
 (
um
->
fûe_poﬁ
, 
f
);

116 
	}
}

118 
Æways_ölöe
 

119 
	$˛ib_fûe_dñ_by_ödex
 (
˛ib_fûe_maö_t
 * 
um
, 
uw‹d
 
ödex
)

121 
˛ib_fûe_t
 *
uf
;

122 
uf
 = 
	`poﬁ_ñt_©_ödex
 (
um
->
fûe_poﬁ
, 
ödex
);

123 
	`˛ib_fûe_dñ
 (
um
, 
uf
);

124 
	}
}

126 
Æways_ölöe
 

127 
	$˛ib_fûe_£t_pﬁlög_thªad
 (
˛ib_fûe_maö_t
 * 
um
, 
uw‹d
 
ödex
,

128 
u32
 
thªad_ödex
)

130 
˛ib_fûe_t
 *
f
 = 
	`poﬁ_ñt_©_ödex
 (
um
->
fûe_poﬁ
, 
ödex
);

131 
um
->
	`fûe_upd©e
 (
f
, 
UNIX_FILE_UPDATE_DELETE
);

132 
f
->
pﬁlög_thªad_ödex
 = 
thªad_ödex
;

133 
um
->
	`fûe_upd©e
 (
f
, 
UNIX_FILE_UPDATE_ADD
);

134 
	}
}

136 
Æways_ölöe
 
uw‹d


137 
	$˛ib_fûe_£t_d©a_avaûabÀ_to_wrôe
 (
˛ib_fûe_maö_t
 * 
um
,

138 
u32
 
˛ib_fûe_ödex
,

139 
uw‹d
 
is_avaûabÀ
)

141 
˛ib_fûe_t
 *
uf
 = 
	`poﬁ_ñt_©_ödex
 (
um
->
fûe_poﬁ
, 
˛ib_fûe_ödex
);

142 
uw‹d
 
was_avaûabÀ
 = (
uf
->
Êags
 & 
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
);

143 i‡((
was_avaûabÀ
 !0Ë!(
is_avaûabÀ
 != 0))

145 
uf
->
Êags
 ^
UNIX_FILE_DATA_AVAILABLE_TO_WRITE
;

146 
um
->
	`fûe_upd©e
 (
uf
, 
UNIX_FILE_UPDATE_MODIFY
);

148  
was_avaûabÀ
 != 0;

149 
	}
}

151 
Æways_ölöe
 
˛ib_fûe_t
 *

152 
	$˛ib_fûe_gë
 (
˛ib_fûe_maö_t
 * 
fm
, 
u32
 
fûe_ödex
)

154 i‡(
	`poﬁ_is_‰ì_ödex
 (
fm
->
fûe_poﬁ
, 
fûe_ödex
))

156  
	`poﬁ_ñt_©_ödex
 (
fm
->
fûe_poﬁ
, 
fûe_ödex
);

157 
	}
}

	@/usr/include/vppinfra/format.h

38 #i‚de‡
ö˛uded_f‹m©_h


39 
	#ö˛uded_f‹m©_h


	)

41 
	~<°d¨g.h
>

43 
	~<vµö‰a/˛ib.h
>

44 
	~<vµö‰a/vec.h
>

45 
	~<vµö‰a/îr‹.h
>

46 
	~<vµö‰a/°rög.h
>

48 
	gu8
 *(
	tf‹m©_fun˘i⁄_t
Ë(
	tu8
 * 
	ts
, 
	tva_li°
 * 
	t¨gs
);

50 
u8
 *
va_f‹m©
 (u8 * 
s
, c⁄° *
f‹m©
, 
va_li°
 * 
¨gs
);

51 
u8
 *
f‹m©
 (u8 * 
s
, const *format, ...);

53 #ifde‡
CLIB_UNIX


55 
	~<°dio.h
>

60 
	#FILE
 

	)

61 
	#°dö
 ((
FILE
 *Ë0)

	)

62 
	#°dout
 ((
FILE
 *Ë1)

	)

63 
	#°dîr
 ((
FILE
 *Ë2)

	)

67 
w‹d
 
va_ff‹m©
 (
FILE
 * 
f
, *
fmt
, 
va_li°
 * 
va
);

68 
w‹d
 
ff‹m©
 (
FILE
 * 
f
, *
fmt
, ...);

69 
w‹d
 
fdf‹m©
 (
fd
, *
fmt
, ...);

71 
Æways_ölöe
 
u32


72 
	$f‹m©_gë_ödít
 (
u8
 * 
s
)

74 
u32
 
ödít
 = 0;

75 
u8
 *
∆
;

77 i‡(!
s
)

78  
ödít
;

80 
∆
 = 
	`vec_íd
 (
s
) - 1;

81 
∆
 >
s
)

83 i‡(*
∆
-- == '\n')

85 
ödít
++;

87  
ödít
;

88 
	}
}

90 
	#_
(
f
Ë
u8
 * 
	`f
 (u8 * 
s
, 
va_li°
 * 
va
)

	)

93 
_
(
f‹m©_vec32
);

94 
_
(
f‹m©_vec_uw‹d
);

95 
_
(
f‹m©_ascii_byãs
);

96 
_
(
f‹m©_hex_byãs
);

97 
_
(
f‹m©_whôe_•a˚
);

98 
_
(
f‹m©_f64
);

99 
_
(
f‹m©_time_öãrvÆ
);

101 #ifde‡
CLIB_UNIX


103 
_
(
f‹m©_addªss_Ámûy
);

104 
_
(
f‹m©_unix_¨phrd
);

105 
_
(
f‹m©_unix_öãrÁ˚_Êags
);

106 
_
(
f‹m©_√tw‹k_addªss
);

107 
_
(
f‹m©_√tw‹k_¥Ÿocﬁ
);

108 
_
(
f‹m©_√tw‹k_p‹t
);

109 
_
(
f‹m©_sockaddr
);

110 
_
(
f‹m©_ù4_tos_byã
);

111 
_
(
f‹m©_ù4_∑ckë
);

112 
_
(
f‹m©_icmp4_ty≥_™d_code
);

113 
_
(
f‹m©_ëhî√t_∑ckë
);

114 
_
(
f‹m©_ho°«me
);

115 
_
(
f‹m©_timevÆ
);

116 
_
(
f‹m©_time_Êﬂt
);

117 
_
(
f‹m©_sig«l
);

118 
_
(
f‹m©_uc⁄ãxt_pc
);

121 #unde‡
_


125 
	s_unf‹m©_öput_t


128 
u8
 *
	mbuf„r
;

131 
uw‹d
 
	mödex
;

135 
uw‹d
 *
	mbuf„r_m¨ks
;

139 
uw‹d
 (*
fûl_buf„r
Ë(
_unf‹m©_öput_t
 * 
	mi
);

143 
	#UNFORMAT_END_OF_INPUT
 (~0)

	)

144 
	#UNFORMAT_MORE_INPUT
 0

	)

147 *
	mfûl_buf„r_¨g
;

148 } 
	tunf‹m©_öput_t
;

150 
Æways_ölöe
 

151 
	$unf‹m©_öô
 (
unf‹m©_öput_t
 * 
i
,

152 
	$uw‹d
 (*
fûl_buf„r
Ë(
unf‹m©_öput_t
 *),

153 *
fûl_buf„r_¨g
)

155 
	`mem£t
 (
i
, 0,  (i[0]));

156 
i
->
fûl_buf„r
 = fill_buffer;

157 
i
->
fûl_buf„r_¨g
 = fill_buffer_arg;

158 
	}
}

160 
Æways_ölöe
 

161 
	$unf‹m©_‰ì
 (
unf‹m©_öput_t
 * 
i
)

163 
	`vec_‰ì
 (
i
->
buf„r
);

164 
	`vec_‰ì
 (
i
->
buf„r_m¨ks
);

165 
	`mem£t
 (
i
, 0,  (i[0]));

166 
	}
}

168 
Æways_ölöe
 
uw‹d


169 
	$unf‹m©_check_öput
 (
unf‹m©_öput_t
 * 
i
)

172 
uw‹d
 
	`_unf‹m©_fûl_öput
 (
unf‹m©_öput_t
 * 
i
);

174 i‡(
i
->
ödex
 >
	`vec_Àn
 (i->
buf„r
Ë&& i->ödex !
UNFORMAT_END_OF_INPUT
)

175 
	`_unf‹m©_fûl_öput
 (
i
);

177  
i
->
ödex
;

178 
	}
}

181 
Æways_ölöe
 
uw‹d


182 
	$unf‹m©_is_eof
 (
unf‹m©_öput_t
 * 
öput
)

184  
	`unf‹m©_check_öput
 (
öput
Ë=
UNFORMAT_END_OF_INPUT
;

185 
	}
}

189 
Æways_ölöe
 
uw‹d


190 
	$unf‹m©_gë_öput
 (
unf‹m©_öput_t
 * 
öput
)

192 
uw‹d
 
i
 = 
	`unf‹m©_check_öput
 (
öput
);

193 i‡(
i
 < 
	`vec_Àn
 (
öput
->
buf„r
))

195 
öput
->
ödex
 = 
i
 + 1;

196 
i
 = 
öput
->
buf„r
[i];

198  
i
;

199 
	}
}

202 
Æways_ölöe
 

203 
	$unf‹m©_put_öput
 (
unf‹m©_öput_t
 * 
öput
)

205 
öput
->
ödex
 -= 1;

206 
	}
}

209 
Æways_ölöe
 
uw‹d


210 
	$unf‹m©_≥ek_öput
 (
unf‹m©_öput_t
 * 
öput
)

212 
uw‹d
 
c
 = 
	`unf‹m©_gë_öput
 (
öput
);

213 i‡(
c
 !
UNFORMAT_END_OF_INPUT
)

214 
	`unf‹m©_put_öput
 (
öput
);

215  
c
;

216 
	}
}

219 
Æways_ölöe
 

220 
	$unf‹m©_skù_löe
 (
unf‹m©_öput_t
 * 
i
)

222 
uw‹d
 
c
;

224 (
c
 = 
	`unf‹m©_gë_öput
 (
i
)Ë!
UNFORMAT_END_OF_INPUT
 && c != '\n')

226 
	}
}

228 
uw‹d
 
unf‹m©_skù_whôe_•a˚
 (
unf‹m©_öput_t
 * 
öput
);

231 
	$uw‹d
 (
	tunf‹m©_fun˘i⁄_t
Ë(
	tunf‹m©_öput_t
 * 
	töput
,

232 
	tva_li°
 * 
	t¨gs
);

237 
uw‹d
 
	`unf‹m©
 (
unf‹m©_öput_t
 * 
i
, c⁄° *
fmt
, ...);

241 
uw‹d
 
	`unf‹m©_u£r
 (
unf‹m©_öput_t
 * 
öput
, 
unf‹m©_fun˘i⁄_t
 * 
func
,

245 
uw‹d
 
	`va_unf‹m©
 (
unf‹m©_öput_t
 * 
i
, c⁄° *
fmt
, 
va_li°
 * 
¨gs
);

248 
	`unf‹m©_öô_comm™d_löe
 (
unf‹m©_öput_t
 * 
öput
, *
¨gv
[]);

251 
	`unf‹m©_öô_°rög
 (
unf‹m©_öput_t
 * 
öput
,

252 *
°rög
, 
°rög_Àn
);

254 
Æways_ölöe
 

255 
	$unf‹m©_öô_c°rög
 (
unf‹m©_öput_t
 * 
öput
, *
°rög
)

257 
	`unf‹m©_öô_°rög
 (
öput
, 
°rög
, 
	`°æí
 (string));

258 
	}
}

261 
unf‹m©_öô_ve˘‹
 (
unf‹m©_öput_t
 * 
öput
, 
u8
 * 
ve˘‹_°rög
);

265 
u8
 *
f‹m©_unf‹m©_îr‹
 (u8 * 
s
, 
va_li°
 * 
va
);

267 
	#unf‹m©_∑r£_îr‹
(
öput
) \

268 
	`˛ib_îr‹_ªtu∫
 (0, "∑r£Éº‹ `%U'", 
f‹m©_unf‹m©_îr‹
, 
öput
)

	)

271 
u8
 *
f‹m©_unf‹m©_öput
 (u8 * 
s
, 
va_li°
 * 
va
);

275 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_öput
;

278 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_löe
;

281 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_löe_öput
;

284 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_tokí
;

287 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_hex_°rög
;

291 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_eof
;

294 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_mem‹y_size
;

297 
u8
 *
f‹m©_mem‹y_size
 (u8 * 
s
, 
va_li°
 * 
va
);

300 
u8
 *
f‹m©_c_idítifõr
 (u8 * 
s
, 
va_li°
 * 
va
);

303 
u8
 *
f‹m©_hexdump
 (u8 * 
s
, 
va_li°
 * 
va
);

306 #ifde‡
CLIB_UNIX


308 
unf‹m©_öô_˛ib_fûe
 (
unf‹m©_öput_t
 * 
öput
, 
fûe_des¸ùt‹
);

312 
uw‹d
 
unf‹m©_öô_unix_ív
 (
unf‹m©_öput_t
 * 
öput
, *
v¨
);

315 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_unix_gid
;

319 
ã°_f‹m©_maö
 (
unf‹m©_öput_t
 * 
öput
);

320 
ã°_unf‹m©_maö
 (
unf‹m©_öput_t
 * 
öput
);

324 
ã°_vec_maö
 (
unf‹m©_öput_t
 * 
öput
);

	@/usr/include/vppinfra/hash.h

38 #i‚de‡
ö˛uded_hash_h


39 
	#ö˛uded_hash_h


	)

41 
	~<vµö‰a/îr‹.h
>

42 
	~<vµö‰a/f‹m©.h
>

43 
	~<vµö‰a/vec.h
>

44 
	~<vµö‰a/ve˘‹.h
>

46 
	ghash_hódî
;

48 
	$uw‹d
 (
	thash_key_sum_fun˘i⁄_t
Ë(
	thash_hódî
 *, 
	tuw‹d
 
	tkey
);

49 
	$uw‹d
 (
	thash_key_equÆ_fun˘i⁄_t
)

50 (
	thash_hódî
 *, 
	tuw‹d
 
	tkey1
, uw‹d 
	tkey2
);

53 
	shash_hódî


56 
uw‹d
 
ñts
;

59 
u32
 
Êags
;

62 
	#HASH_FLAG_NO_AUTO_GROW
 (1 << 0)

	)

64 
	#HASH_FLAG_NO_AUTO_SHRINK
 (1 << 1)

	)

66 
	#HASH_FLAG_HASH_NEXT_IN_PROGRESS
 (1 << 2)

	)

68 
u32
 
log2_∑ú_size
;

73 
hash_key_sum_fun˘i⁄_t
 *
key_sum
;

76 
	#KEY_FUNC_NONE
 (0Ë

	)

77 
	#KEY_FUNC_POINTER_UWORD
 (1Ë

	)

78 
	#KEY_FUNC_POINTER_U32
 (2Ë

	)

79 
	#KEY_FUNC_STRING
 (3Ë

	)

82 
hash_key_equÆ_fun˘i⁄_t
 *
key_equÆ
;

85 
™y
 
u£r
;

88 
f‹m©_fun˘i⁄_t
 *
f‹m©_∑ú
;

91 *
f‹m©_∑ú_¨g
;

95 
uw‹d
 
is_u£r
[0];

96 } 
	thash_t
;

99 
Æways_ölöe
 
uw‹d


100 
	$hash_hódî_byãs
 (*
v
)

102 
hash_t
 *
h
;

103 
uw‹d
 
is_u£r_byãs
 =

104 ( (
h
->
is_u£r
[0]Ë* 
	`vec_Àn
 (
v
)Ë/ 
	`BITS
 (h->is_user[0]);

105   (
h
[0]Ë+ 
is_u£r_byãs
;

106 
	}
}

109 
Æways_ölöe
 
hash_t
 *

110 
	$hash_hódî
 (*
v
)

112  
	`vec_hódî
 (
v
, 
	`hash_hódî_byãs
 (v));

113 
	}
}

116 
Æways_ölöe
 
uw‹d


117 
	$hash_ñts
 (*
v
)

119 
hash_t
 *
h
 = 
	`hash_hódî
 (
v
);

120  
v
 ? 
h
->
ñts
 : 0;

121 
	}
}

124 
Æways_ölöe
 
uw‹d


125 
	$hash_ˇ∑côy
 (*
v
)

127  
	`vec_Àn
 (
v
);

128 
	}
}

131 
Æways_ölöe
 
uw‹d


132 
	$hash_is_u£r
 (*
v
, 
uw‹d
 
i
)

134 
hash_t
 *
h
 = 
	`hash_hódî
 (
v
);

135 
uw‹d
 
i0
 = 
i
 / 
	`BITS
 (
h
->
is_u£r
[0]);

136 
uw‹d
 
i1
 = 
i
 % 
	`BITS
 (
h
->
is_u£r
[0]);

137  (
h
->
is_u£r
[
i0
] & ((
uw‹d
Ë1 << 
i1
)) != 0;

138 
	}
}

141 
Æways_ölöe
 

142 
	$hash_£t_∑ú_f‹m©
 (*
v
,

143 
f‹m©_fun˘i⁄_t
 * 
f‹m©_∑ú
, *
f‹m©_∑ú_¨g
)

145 
hash_t
 *
h
 = 
	`hash_hódî
 (
v
);

146 
h
->
f‹m©_∑ú
 = format_pair;

147 
h
->
f‹m©_∑ú_¨g
 = format_pair_arg;

148 
	}
}

151 
Æways_ölöe
 

152 
	$hash_£t_Êags
 (*
v
, 
uw‹d
 
Êags
)

154 
	`hash_hódî
 (
v
)->
Êags
 |= flags;

155 
	}
}

161 
uw‹d
 
	mkey
;

164 
uw‹d
 
	mvÆue
[0];

165 } 
	thash_∑ú_t
;

175 
hash_∑ú_t
 *
	m∑ús
;

177 
u8
 
	m∑d
[ (
uw‹d
Ë-  (
hash_∑ú_t
 *)];

179 
uw‹d
 
	mÆloc_Àn
;

181 
	thash_∑ú_ödúe˘_t
;

186 
hash_∑ú_t
 
	mdúe˘
;

187 
hash_∑ú_ödúe˘_t
 
	mödúe˘
;

188 } 
	thash_∑ú_uni⁄_t
;

190 
	#LOG2_ALLOC_BITS
 (5)

	)

191 
	#PAIR_BITS
 (
	`BITS
 (
uw‹d
Ë- 
LOG2_ALLOC_BITS
)

	)

194 
Æways_ölöe
 
uw‹d


195 
	$ödúe˘_∑ú_gë_log2_byãs
 (
hash_∑ú_ödúe˘_t
 * 
p
)

197  
p
->
Æloc_Àn
 >> 
PAIR_BITS
;

198 
	}
}

201 
Æways_ölöe
 
uw‹d


202 
	$ödúe˘_∑ú_gë_Àn
 (
hash_∑ú_ödúe˘_t
 * 
p
)

204 i‡(!
p
->
∑ús
)

207  
p
->
Æloc_Àn
 & (((
uw‹d
Ë1 << 
PAIR_BITS
) - 1);

208 
	}
}

211 
Æways_ölöe
 

212 
	$ödúe˘_∑ú_£t
 (
hash_∑ú_ödúe˘_t
 * 
p
, 
uw‹d
 
log2_Æloc
, uw‹d 
Àn
)

214 
	`ASSERT
 (
Àn
 < ((
uw‹d
Ë1 << 
PAIR_BITS
));

215 
	`ASSERT
 (
log2_Æloc
 < ((
uw‹d
Ë1 << 
LOG2_ALLOC_BITS
));

216 
p
->
Æloc_Àn
 = (
log2_Æloc
 << 
PAIR_BITS
Ë| 
Àn
;

217 
	}
}

220 
uw‹d
 *
_hash_gë
 (*
v
, uw‹d 
key
);

223 
hash_∑ú_t
 *
_hash_gë_∑ú
 (*
v
, 
uw‹d
 
key
);

226 *
_hash_un£t
 (*
v
, 
uw‹d
 
key
, *
ﬁd_vÆue
);

229 *
_hash_£t3
 (*
v
, 
uw‹d
 
key
, *
vÆue
, *
ﬁd_vÆue
);

232 *
hash_ªsize
 (*
ﬁd
, 
uw‹d
 
√w_size
);

235 *
hash_dup
 (*
ﬁd
);

238 
uw‹d
 
hash_byãs
 (*
v
);

241 
	#hash_£t3
(
h
,
key
,
vÆue
,
ﬁd_vÆue
) \

243 
uw‹d
 
_v
 = (uw‹dË(
vÆue
); \

244 (
h
Ë
	`_hash_£t3
 ((h), (
uw‹d
Ë(
key
), (*Ë&
_v
, (
ﬁd_vÆue
)); \

245 })

	)

248 
	#hash_gë
(
h
,
key
Ë
	`_hash_gë
 ((h), (
uw‹d
Ë(key))

	)

251 
	#hash_gë_∑ú
(
h
,
key
Ë
	`_hash_gë_∑ú
 ((h), (
uw‹d
Ë(key))

	)

254 
	#hash_£t
(
h
,
key
,
vÆue
Ë
	`hash_£t3
(h,key,vÆue,0)

	)

257 
	#hash_£t1
(
h
,
key
Ë(hË
	`_hash_£t3
(h,(
uw‹d
Ë(key),0,0)

	)

260 
	#hash_un£t
(
h
,
key
Ë((hË
	`_hash_un£t
 ((h), (
uw‹d
Ë(key),0))

	)

263 
	#hash_un£t3
(
h
,
key
,
ﬁd_vÆue
Ë((hË
	`_hash_un£t
 ((h), (
uw‹d
Ë(key), (*Ë(ﬁd_vÆue)))

	)

268 
	#hash_gë_mem
(
h
,
key
Ë
	`_hash_gë
 ((h), 
	`poöãr_to_uw‹d
 (key))

	)

271 
	#hash_gë_∑ú_mem
(
h
,
key
Ë
	`_hash_gë_∑ú
 ((h), 
	`poöãr_to_uw‹d
 (key))

	)

274 
	#hash_£t_mem
(
h
,
key
,
vÆue
Ë
	`hash_£t3
 (h, 
	`poöãr_to_uw‹d
 (key), (vÆue), 0)

	)

277 
Æways_ölöe
 

278 
	$hash_£t_mem_Æloc
 (
uw‹d
 ** 
h
, *
key
, uw‹d 
v
)

280 
size_t
 
ksz
 = 
	`hash_hódî
 (*
h
)->
u£r
;

281 *
c›y
 = 
	`˛ib_mem_Æloc
 (
ksz
);

282 
	`˛ib_mem˝y
 (
c›y
, 
key
, 
ksz
);

283 
	`hash_£t_mem
 (*
h
, 
c›y
, 
v
);

284 
	}
}

287 
	#hash_£t1_mem
(
h
,
key
Ë
	`hash_£t3
 ((h), 
	`poöãr_to_uw‹d
 (key), 0, 0)

	)

290 
	#hash_un£t_mem
(
h
,
key
Ë((hË
	`_hash_un£t
 ((h), 
	`poöãr_to_uw‹d
 (key),0))

	)

293 
Æways_ölöe
 

294 
	$hash_un£t_mem_‰ì
 (
uw‹d
 ** 
h
, *
key
)

296 
hash_∑ú_t
 *
hp
 = 
	`hash_gë_∑ú_mem
 (*
h
, 
key
);

297 i‡(
	`PREDICT_TRUE
 (
hp
 !
NULL
))

299 
key
 = 
	`uw‹d_to_poöãr
 (
hp
->key, *);

300 
	`hash_un£t_mem
 (*
h
, 
key
);

301 
	`˛ib_mem_‰ì
 (
key
);

303 
	}
}

306 *
_hash_‰ì
 (*
v
);

309 
	#hash_‰ì
(
h
Ë(hË
	`_hash_‰ì
 ((h))

	)

311 
˛ib_îr‹_t
 *
hash_vÆid©e
 (*
v
);

314 
Æways_ölöe
 
uw‹d


315 
	$hash_vÆue_byãs
 (
hash_t
 * 
h
)

317 
hash_∑ú_t
 *
p
;

318  ( (
p
->
vÆue
[0]Ë<< 
h
->
log2_∑ú_size
Ë-  (p->
key
);

319 
	}
}

322 
Æways_ölöe
 
uw‹d


323 
	$hash_∑ú_log2_byãs
 (
hash_t
 * 
h
)

325 
uw‹d
 
log2_byãs
 = 
h
->
log2_∑ú_size
;

326 
	`ASSERT
 (
	`BITS
 (
hash_∑ú_t
) == 32 || BITS (hash_pair_t) == 64);

327 i‡(
	`BITS
 (
hash_∑ú_t
) == 32)

328 
log2_byãs
 += 2;

329 i‡(
	`BITS
 (
hash_∑ú_t
) == 64)

330 
log2_byãs
 += 3;

331  
log2_byãs
;

332 
	}
}

335 
Æways_ölöe
 
uw‹d


336 
	$hash_∑ú_byãs
 (
hash_t
 * 
h
)

338  (
uw‹d
Ë1 << 
	`hash_∑ú_log2_byãs
 (
h
);

339 
	}
}

342 
Æways_ölöe
 *

343 
	$hash_f‹w¨d1
 (
hash_t
 * 
h
, *
v
)

345  (
u8
 *Ë
v
 + 
	`hash_∑ú_byãs
 (
h
);

346 
	}
}

349 
Æways_ölöe
 *

350 
	$hash_f‹w¨d
 (
hash_t
 * 
h
, *
v
, 
uw‹d
 
n
)

352  (
u8
 *Ë
v
 + ((
n
 *  (
hash_∑ú_t
)Ë<< 
h
->
log2_∑ú_size
);

353 
	}
}

372 
	#hash_f‹óch_∑ú
(
p
,
v
,
body
) \

374 
__œbñ__
 
_hash_f‹óch_d⁄e
; \

375 
hash_t
 * 
_h
 = 
	`hash_hódî
 (
v
); \

376 * 
_p
; \

377 
hash_∑ú_t
 * 
_q
, * 
_q_íd
; \

378 
uw‹d
 
_i
, 
_i1
, 
_id
, 
_∑ú_ö¸emít
; \

380 
_p
 = (
v
); \

381 
_i
 = 0; \

382 
_∑ú_ö¸emít
 = 1; \

383 i‡((
v
)) \

384 
_∑ú_ö¸emít
 = 1 << 
_h
->
log2_∑ú_size
; \

385 
_i
 < 
	`hash_ˇ∑côy
 (
v
)) \

387 
_id
 = 
_h
->
is_u£r
[
_i
 / 
	`BITS
 (_h->is_user[0])]; \

388 
_i1
 = 
_i
 + 
	`BITS
 (
_h
->
is_u£r
[0]); \

391 i‡(
_id
 & 1) \

393 
_q
 = 
_p
; \

394 
_q_íd
 = 
_q
 + 
_∑ú_ö¸emít
; \

398 
hash_∑ú_ödúe˘_t
 * 
_pi
 = 
_p
; \

399 
_q
 = 
_pi
->
∑ús
; \

400 i‡(
_h
->
log2_∑ú_size
 > 0) \

401 
_q_íd
 = 
	`hash_f‹w¨d
 (
_h
, 
_q
, 
	`ödúe˘_∑ú_gë_Àn
 (
_pi
)); \

403 
_q_íd
 = 
	`vec_íd
 (
_q
); \

408 
_q
 < 
_q_íd
) \

410 
uw‹d
 
_bªak_ö_body
 = 1; \

411 (
p
Ë
_q
; \

413 
body
; \

414 
_bªak_ö_body
 = 0; \

416 i‡(
_bªak_ö_body
) \

417 
_hash_f‹óch_d⁄e
; \

418 
_q
 +
_∑ú_ö¸emít
; \

421 
_p
 = (
hash_∑ú_t
 *)_∞+ 
_∑ú_ö¸emít
; \

422 
_id
 = _id / 2; \

423 
_i
++; \

424 } 
_i
 < 
_i1
); \

426 
_hash_f‹óch_d⁄e
: \

429 } 0)

	)

441 
	#hash_f‹óch
(
key_v¨
,
vÆue_v¨
,
h
,
body
) \

443 
hash_∑ú_t
 * 
_r
; \

444 
	`hash_f‹óch_∑ú
 (
_r
, (
h
), { \

445 (
key_v¨
Ë(
	`__ty≥of__
 (key_v¨)Ë
_r
->
key
; \

446 (
vÆue_v¨
Ë(
	`__ty≥of__
 (vÆue_v¨)Ë
_r
->
vÆue
[0]; \

447 dÿ{ 
body
; } 0); \

449 } 0)

	)

460 
	#hash_f‹óch_mem
(
key_v¨
,
vÆue_v¨
,
h
,
body
) \

462 
hash_∑ú_t
 * 
_r
; \

463 
	`hash_f‹óch_∑ú
 (
_r
, (
h
), { \

464 (
key_v¨
Ë(
	`__ty≥of__
 (key_v¨)Ë
	`uw‹d_to_poöãr
 (
_r
->
key
, *); \

465 (
vÆue_v¨
Ë(
	`__ty≥of__
 (vÆue_v¨)Ë
_r
->
vÆue
[0]; \

466 dÿ{ 
body
; } 0); \

468 } 0)

	)

477 
uw‹d
 
	mi
, 
	mj
, 
	mf
;

478 } 
	thash_√xt_t
;

480 
hash_∑ú_t
 *
hash_√xt
 (*
v
, 
hash_√xt_t
 * 
hn
);

482 *
_hash_¸óã
 (
uw‹d
 
ñts
, 
hash_t
 * 
h
);

484 
Æways_ölöe
 

485 
	$hash_£t_vÆue_byãs
 (
hash_t
 * 
h
, 
uw‹d
 
vÆue_byãs
)

487 
hash_∑ú_t
 *
p
;

488 
h
->
log2_∑ú_size
 =

489 
	`max_log2
 (( (
p
->
key
Ë+ 
vÆue_byãs
 +  (p->key) -

490 1Ë/  (
p
->
key
));

491 
	}
}

493 
	#hash_¸óã2
(
_ñts
,
_u£r
,
_vÆue_byãs
, \

494 
_key_sum
,
_key_equÆ
, \

495 
_f‹m©_∑ú
,
_f‹m©_∑ú_¨g
) \

497 
hash_t
 
_h
; \

498 
	`mem£t
 (&
_h
, 0,  (_h)); \

499 
_h
.
u£r
 = (
_u£r
); \

500 
_h
.
key_sum
 = (
hash_key_sum_fun˘i⁄_t
 *Ë(
_key_sum
); \

501 
_h
.
key_equÆ
 = (
_key_equÆ
); \

502 
	`hash_£t_vÆue_byãs
 (&
_h
, (
_vÆue_byãs
)); \

503 
_h
.
f‹m©_∑ú
 = (
f‹m©_fun˘i⁄_t
 *Ë(
_f‹m©_∑ú
); \

504 
_h
.
f‹m©_∑ú_¨g
 = (
_f‹m©_∑ú_¨g
); \

505 
	`_hash_¸óã
 ((
_ñts
), &
_h
); \

506 })

	)

512 
	#hash_mix_°ï
(
a
,
b
,
c
,
s0
,
s1
,
s2
) \

514 (
a
Ë-(
b
Ë+ (
c
); (aË^(cË>> (
s0
); \

515 (
b
Ë-(
c
Ë+ (
a
); (bË^◊Ë<< (
s1
); \

516 (
c
Ë-(
a
Ë+ (
b
); (cË^(bË>> (
s2
); \

517 } 0)

	)

519 
	#hash_mix32_°ï_1
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,13,8,13)

	)

520 
	#hash_mix32_°ï_2
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,12,16,5)

	)

521 
	#hash_mix32_°ï_3
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,3,10,15)

	)

523 
	#hash_mix64_°ï_1
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,43,9,8)

	)

524 
	#hash_mix64_°ï_2
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,38,23,5)

	)

525 
	#hash_mix64_°ï_3
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,35,49,11)

	)

526 
	#hash_mix64_°ï_4
(
a
,
b
,
c
Ë
	`hash_mix_°ï
◊,b,c,12,18,22)

	)

530 
	#hash_mix64
(
a0
,
b0
,
c0
) \

532 
	`hash_mix64_°ï_1
 (
a0
, 
b0
, 
c0
); \

533 
	`hash_mix64_°ï_2
 (
a0
, 
b0
, 
c0
); \

534 
	`hash_mix64_°ï_3
 (
a0
, 
b0
, 
c0
); \

535 
	`hash_mix64_°ï_4
 (
a0
, 
b0
, 
c0
); \

537 

	)

538 
	#hash_mix32
(
a0
,
b0
,
c0
) \

540 
	`hash_mix32_°ï_1
 (
a0
, 
b0
, 
c0
); \

541 
	`hash_mix32_°ï_2
 (
a0
, 
b0
, 
c0
); \

542 
	`hash_mix32_°ï_3
 (
a0
, 
b0
, 
c0
); \

544 

	)

547 
Æways_ölöe
 
uw‹d


548 
	$hash32_rŸ©e_À·
 (
u32
 
x
, u32 
i
)

550  (
x
 << 
i
Ë| (x >> (
	`BITS
 (i) - i));

551 
	}
}

553 
	#hash_v3_mix32
(
a
,
b
,
c
) \

555 (
a
Ë-(
c
); (aË^
	`hash32_rŸ©e_À·
 ((c), 4); (cË+(
b
); \

556 (
b
Ë-(
a
); (bË^
	`hash32_rŸ©e_À·
 (◊), 6); (aË+(
c
); \

557 (
c
Ë-(
b
); (cË^
	`hash32_rŸ©e_À·
 ((b), 8); (bË+(
a
); \

558 (
a
Ë-(
c
); (aË^
	`hash32_rŸ©e_À·
 ((c),16); (cË+(
b
); \

559 (
b
Ë-(
a
); (bË^
	`hash32_rŸ©e_À·
 (◊),19); (aË+(
c
); \

560 (
c
Ë-(
b
); (cË^
	`hash32_rŸ©e_À·
 ((b), 4); (bË+(
a
); \

561 } 0)

	)

563 
	#hash_v3_föÆize32
(
a
,
b
,
c
) \

565 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 14); \

566 (
a
Ë^(
c
); (aË-
	`hash32_rŸ©e_À·
 ((c), 11); \

567 (
b
Ë^(
a
); (bË-
	`hash32_rŸ©e_À·
 ((a), 25); \

568 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 16); \

569 (
a
Ë^(
c
); (aË-
	`hash32_rŸ©e_À·
 ((c), 4); \

570 (
b
Ë^(
a
); (bË-
	`hash32_rŸ©e_À·
 ((a), 14); \

571 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 24); \

572 } 0)

	)

576 
	#hash_v3_mix32_°ï1
(
a
,
b
,
c
) \

578 (
a
Ë-(
c
); (aË^
	`hash32_rŸ©e_À·
 ((c), 4); (cË+(
b
); \

579 (
b
Ë-(
a
); (bË^
	`hash32_rŸ©e_À·
 (◊), 6); (aË+(
c
); \

580 } 0)

	)

582 
	#hash_v3_mix32_°ï2
(
a
,
b
,
c
) \

584 (
c
Ë-(
b
); (cË^
	`hash32_rŸ©e_À·
 ((b), 8); (bË+(
a
); \

585 (
a
Ë-(
c
); (aË^
	`hash32_rŸ©e_À·
 ((c),16); (cË+(
b
); \

586 } 0)

	)

588 
	#hash_v3_mix32_°ï3
(
a
,
b
,
c
) \

590 (
b
Ë-(
a
); (bË^
	`hash32_rŸ©e_À·
 (◊),19); (aË+(
c
); \

591 (
c
Ë-(
b
); (cË^
	`hash32_rŸ©e_À·
 ((b), 4); (bË+(
a
); \

592 } 0)

	)

594 
	#hash_v3_föÆize32_°ï1
(
a
,
b
,
c
) \

596 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 14); \

597 (
a
Ë^(
c
); (aË-
	`hash32_rŸ©e_À·
 ((c), 11); \

598 } 0)

	)

600 
	#hash_v3_föÆize32_°ï2
(
a
,
b
,
c
) \

602 (
b
Ë^(
a
); (bË-
	`hash32_rŸ©e_À·
 ((a), 25); \

603 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 16); \

604 } 0)

	)

606 
	#hash_v3_föÆize32_°ï3
(
a
,
b
,
c
) \

608 (
a
Ë^(
c
); (aË-
	`hash32_rŸ©e_À·
 ((c), 4); \

609 (
b
Ë^(
a
); (bË-
	`hash32_rŸ©e_À·
 ((a), 14); \

610 (
c
Ë^(
b
); (cË-
	`hash32_rŸ©e_À·
 ((b), 24); \

611 } 0)

	)

614 
	#hash_v3_mix_°ï_1_u32x
(
a
,
b
,
c
) \

616 (
a
Ë-(
c
); (aË^
	`u32x_úŸ©e_À·
 ((c), 4); (cË+(
b
); \

617 (
b
Ë-(
a
); (bË^
	`u32x_úŸ©e_À·
 (◊), 6); (aË+(
c
); \

618 (
c
Ë-(
b
); (cË^
	`u32x_úŸ©e_À·
 ((b), 8); (bË+(
a
); \

619 } 0)

	)

621 
	#hash_v3_mix_°ï_2_u32x
(
a
,
b
,
c
) \

623 (
a
Ë-(
c
); (aË^
	`u32x_úŸ©e_À·
 ((c),16); (cË+(
b
); \

624 (
b
Ë-(
a
); (bË^
	`u32x_úŸ©e_À·
 (◊),19); (aË+(
c
); \

625 (
c
Ë-(
b
); (cË^
	`u32x_úŸ©e_À·
 ((b), 4); (bË+(
a
); \

626 } 0)

	)

628 
	#hash_v3_föÆize_°ï_1_u32x
(
a
,
b
,
c
) \

630 (
c
Ë^(
b
); (cË-
	`u32x_úŸ©e_À·
 ((b), 14); \

631 (
a
Ë^(
c
); (aË-
	`u32x_úŸ©e_À·
 ((c), 11); \

632 (
b
Ë^(
a
); (bË-
	`u32x_úŸ©e_À·
 ((a), 25); \

633 } 0)

	)

635 
	#hash_v3_föÆize_°ï_2_u32x
(
a
,
b
,
c
) \

637 (
c
Ë^(
b
); (cË-
	`u32x_úŸ©e_À·
 ((b), 16); \

638 (
a
Ë^(
c
); (aË-
	`u32x_úŸ©e_À·
 ((c), 4); \

639 (
b
Ë^(
a
); (bË-
	`u32x_úŸ©e_À·
 ((a), 14); \

640 (
c
Ë^(
b
); (cË-
	`u32x_úŸ©e_À·
 ((b), 24); \

641 } 0)

	)

643 
	#hash_v3_mix_u32x
(
a
,
b
,
c
) \

645 
	`hash_v3_mix_°ï_1_u32x
(
a
,
b
,
c
); \

646 
	`hash_v3_mix_°ï_2_u32x
(
a
,
b
,
c
); \

647 } 0)

	)

649 
	#hash_v3_föÆize_u32x
(
a
,
b
,
c
) \

651 
	`hash_v3_föÆize_°ï_1_u32x
(
a
,
b
,
c
); \

652 
	`hash_v3_föÆize_°ï_2_u32x
(
a
,
b
,
c
); \

653 } 0)

	)

655 
uw‹d
 
hash_mem‹y
 (*
p
, 
w‹d
 
n_byãs
, uw‹d 
°©e
);

657 
uw‹d
 
mem_key_sum
 (
hash_t
 * 
h
, uw‹d 
key
);

658 
uw‹d
 
mem_key_equÆ
 (
hash_t
 * 
h
, uw‹d 
key1
, uw‹d 
key2
);

660 
	#hash_¸óã_mem
(
ñts
,
key_byãs
,
vÆue_byãs
) \

661 
	`hash_¸óã2
((
ñts
),(
key_byãs
),(
vÆue_byãs
),
mem_key_sum
,
mem_key_equÆ
,0,0)

	)

663 
uw‹d
 
vec_key_sum
 (
hash_t
 * 
h
, uw‹d 
key
);

664 
uw‹d
 
vec_key_equÆ
 (
hash_t
 * 
h
, uw‹d 
key1
, uw‹d 
key2
);

665 
u8
 *
vec_key_f‹m©_∑ú
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

667 
	#hash_¸óã_vec
(
ñts
,
key_byãs
,
vÆue_byãs
) \

668 
	`hash_¸óã2
((
ñts
),(
key_byãs
),(
vÆue_byãs
),\

669 
vec_key_sum
,
vec_key_equÆ
,
vec_key_f‹m©_∑ú
,0)

	)

671 
uw‹d
 
°rög_key_sum
 (
hash_t
 * 
h
, uw‹d 
key
);

672 
uw‹d
 
°rög_key_equÆ
 (
hash_t
 * 
h
, uw‹d 
key1
, uw‹d 
key2
);

673 
u8
 *
°rög_key_f‹m©_∑ú
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

675 
	#hash_¸óã_°rög
(
ñts
,
vÆue_byãs
) \

676 
	`hash_¸óã2
((
ñts
),0,(
vÆue_byãs
), \

677 (
hash_key_sum_fun˘i⁄_t
 *Ë
KEY_FUNC_STRING
, \

678 (
hash_key_equÆ_fun˘i⁄_t
 *)
KEY_FUNC_STRING
, \

679 0, 0)

	)

681 
	#hash_¸óã
(
ñts
,
vÆue_byãs
) \

682 
	`hash_¸óã2
((
ñts
),0,(
vÆue_byãs
), \

683 (
hash_key_sum_fun˘i⁄_t
 *Ë
KEY_FUNC_NONE
, \

684 (
hash_key_equÆ_fun˘i⁄_t
 *Ë
KEY_FUNC_NONE
, \

685 0,0)

	)

687 
	#hash_¸óã_uw‹d
(
ñts
,
vÆue_byãs
) \

688 
	`hash_¸óã2
((
ñts
),0,(
vÆue_byãs
), \

689 (
hash_key_sum_fun˘i⁄_t
 *Ë
KEY_FUNC_POINTER_UWORD
, \

690 (
hash_key_equÆ_fun˘i⁄_t
 *Ë
KEY_FUNC_POINTER_UWORD
, \

691 0,0)

	)

693 
	#hash_¸óã_u32
(
ñts
,
vÆue_byãs
) \

694 
	`hash_¸óã2
((
ñts
),0,(
vÆue_byãs
), \

695 (
hash_key_sum_fun˘i⁄_t
 *Ë
KEY_FUNC_POINTER_U32
, \

696 (
hash_key_equÆ_fun˘i⁄_t
 *Ë
KEY_FUNC_POINTER_U32
, \

697 0,0)

	)

699 
u8
 *
f‹m©_hash
 (u8 * 
s
, 
va_li°
 * 
va
);

703 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_hash_vec_°rög
;

704 
unf‹m©_fun˘i⁄_t
 
	gunf‹m©_hash_°rög
;

707 
ã°_hash_maö
 (
unf‹m©_öput_t
 * 
öput
);

	@/usr/include/vppinfra/heap.h

61 #i‚de‡
ö˛uded_hóp_h


62 
	#ö˛uded_hóp_h


	)

64 
	~<vµö‰a/˛ib.h
>

65 
	~<vµö‰a/ˇche.h
>

66 
	~<vµö‰a/hash.h
>

67 
	~<vµö‰a/f‹m©.h
>

68 
	~<vµö‰a/bôm≠.h
>

75 
u32
 
	moff£t
;

78 
i32
 
	m√xt
, 
	m¥ev
;

79 } 
	thóp_ñt_t
;

82 
	#HEAP_ELT_FREE_BIT
 (1 << 31)

	)

84 
Æways_ölöe
 
uw‹d


85 
	$hóp_is_‰ì
 (
hóp_ñt_t
 * 
e
)

87  (
e
->
off£t
 & 
HEAP_ELT_FREE_BIT
) != 0;

88 
	}
}

90 
Æways_ölöe
 
uw‹d


91 
	$hóp_off£t
 (
hóp_ñt_t
 * 
e
)

93  
e
->
off£t
 & ~
HEAP_ELT_FREE_BIT
;

94 
	}
}

96 
Æways_ölöe
 
hóp_ñt_t
 *

97 
	$hóp_√xt
 (
hóp_ñt_t
 * 
e
)

99  
e
 +É->
√xt
;

100 
	}
}

102 
Æways_ölöe
 
hóp_ñt_t
 *

103 
	$hóp_¥ev
 (
hóp_ñt_t
 * 
e
)

105  
e
 +É->
¥ev
;

106 
	}
}

108 
Æways_ölöe
 
uw‹d


109 
	$hóp_ñt_size
 (*
v
, 
hóp_ñt_t
 * 
e
)

111 
hóp_ñt_t
 *
n
 = 
	`hóp_√xt
 (
e
);

112 
uw‹d
 
√xt_off£t
 = 
n
 !
e
 ? 
	`hóp_off£t
 (nË: 
	`vec_Àn
 (
v
);

113  
√xt_off£t
 - 
	`hóp_off£t
 (
e
);

114 
	}
}

118 
	#HEAP_LOG2_SMALL_BINS
 (5)

	)

119 
	#HEAP_SMALL_BINS
 (1 << 
HEAP_LOG2_SMALL_BINS
)

	)

120 
	#HEAP_N_BINS
 (2 * 
HEAP_SMALL_BINS
)

	)

126 
hóp_ñt_t
 *
	mñts
;

130 
u32
 *
	msmÆl_‰ì_ñt_‰ì_ödex
;

133 
u32
 *
	m‰ì_ñts
;

136 
u32
 **
	m‰ì_li°s
;

138 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_ñt
;

141 
uw‹d
 *
	mu£d_ñt_bôm≠
;

144 
u32
 
	mhód
, 
	mèû
;

146 
u32
 
	mu£d_cou¡
, 
	mmax_Àn
;

149 
u32
 
	mñt_byãs
;

151 
u32
 
	mÊags
;

154 
	#HEAP_IS_STATIC
 (1)

	)

155 } 
	thóp_hódî_t
;

158 
	#HEAP_DATA_ALIGN
 (
CLIB_CACHE_LINE_BYTES
)

	)

160 
Æways_ölöe
 
hóp_hódî_t
 *

161 
	$hóp_hódî
 (*
v
)

163  
	`vec_hódî
 (
v
,  (
hóp_hódî_t
));

164 
	}
}

166 
Æways_ölöe
 
uw‹d


167 
	$hóp_hódî_byãs
 ()

169  
	`vec_hódî_byãs
 ( (
hóp_hódî_t
));

170 
	}
}

172 
Æways_ölöe
 

173 
	$hóp_dup_hódî
 (
hóp_hódî_t
 * 
ﬁd
, hóp_hódî_à* 
√w
)

175 
uw‹d
 
i
;

177 
√w
[0] = 
ﬁd
[0];

178 
√w
->
ñts
 = 
	`vec_dup
 (new->elts);

179 
√w
->
‰ì_ñts
 = 
	`vec_dup
 (new->free_elts);

180 
√w
->
‰ì_li°s
 = 
	`vec_dup
 (new->free_lists);

181 
i
 = 0; i < 
	`vec_Àn
 (
√w
->
‰ì_li°s
); i++)

182 
√w
->
‰ì_li°s
[
i
] = 
	`vec_dup
 (new->free_lists[i]);

183 
√w
->
u£d_ñt_bôm≠
 = 
	`˛ib_bôm≠_dup
 (new->used_elt_bitmap);

184 
√w
->
smÆl_‰ì_ñt_‰ì_ödex
 = 
	`vec_dup
 (new->small_free_elt_free_index);

185 
	}
}

188 
	#hóp_dup
(
v
Ë
	`_hóp_dup
(v, 
	`vec_Àn
 (vË*  (v[0]))

	)

190 
Æways_ölöe
 *

191 
	$_hóp_dup
 (*
v_ﬁd
, 
uw‹d
 
v_byãs
)

193 
hóp_hódî_t
 *
h_ﬁd
, *
h_√w
;

194 *
v_√w
;

196 
h_ﬁd
 = 
	`hóp_hódî
 (
v_ﬁd
);

198 i‡(!
v_ﬁd
)

199  
v_ﬁd
;

201 
v_√w
 = 0;

202 
v_√w
 =

203 
	`_vec_ªsize
 (
v_√w
, 
	`_vec_Àn
 (
v_ﬁd
), 
v_byãs
,  (
hóp_hódî_t
),

204 
HEAP_DATA_ALIGN
);

205 
h_√w
 = 
	`hóp_hódî
 (
v_√w
);

206 
	`hóp_dup_hódî
 (
h_ﬁd
, 
h_√w
);

207 
	`˛ib_mem˝y
 (
v_√w
, 
v_ﬁd
, 
v_byãs
);

208  
v_√w
;

209 
	}
}

211 
Æways_ölöe
 
uw‹d


212 
	$hóp_ñts
 (*
v
)

214 
hóp_hódî_t
 *
h
 = 
	`hóp_hódî
 (
v
);

215  
h
->
u£d_cou¡
;

216 
	}
}

218 
uw‹d
 
hóp_byãs
 (*
v
);

220 
Æways_ölöe
 *

221 
	$_hóp_√w
 (
u32
 
Àn
, u32 
n_ñt_byãs
)

223 *
v
 = 
	`_vec_ªsize
 (0, 
Àn
, (
uw‹d
ËÀ¿* 
n_ñt_byãs
,

224  (
hóp_hódî_t
),

225 
HEAP_DATA_ALIGN
);

226 
	`hóp_hódî
 (
v
)->
ñt_byãs
 = 
n_ñt_byãs
;

227  
v
;

228 
	}
}

230 
	#hóp_√w
(
v
Ë(vË
	`_hóp_√w
 (0,  ((v)[0]))

	)

232 
Æways_ölöe
 

233 
	$hóp_£t_f‹m©
 (*
v
, 
f‹m©_fun˘i⁄_t
 * 
f‹m©_ñt
)

235 
	`ASSERT
 (
v
);

236 
	`hóp_hódî
 (
v
)->
f‹m©_ñt
 = format_elt;

237 
	}
}

239 
Æways_ölöe
 

240 
	$hóp_£t_max_Àn
 (*
v
, 
uw‹d
 
max_Àn
)

242 
	`ASSERT
 (
v
);

243 
	`hóp_hódî
 (
v
)->
max_Àn
 = max_len;

244 
	}
}

246 
Æways_ölöe
 
uw‹d


247 
	$hóp_gë_max_Àn
 (*
v
)

249  
v
 ? 
	`hóp_hódî
 (v)->
max_Àn
 : 0;

250 
	}
}

253 
Æways_ölöe
 *

254 
	$hóp_¸óã_‰om_mem‹y
 (*
mem‹y
, 
uw‹d
 
max_Àn
, uw‹d 
ñt_byãs
)

256 
hóp_hódî_t
 *
h
;

257 *
v
;

259 i‡(
max_Àn
 * 
ñt_byãs
 <  (
h
[0]))

262 
h
 = 
mem‹y
;

263 
	`mem£t
 (
h
, 0,  (h[0]));

264 
h
->
max_Àn
 = max_len;

265 
h
->
ñt_byãs
 =Élt_bytes;

266 
h
->
Êags
 = 
HEAP_IS_STATIC
;

268 
v
 = (*Ë(
mem‹y
 + 
	`hóp_hódî_byãs
 ());

269 
	`_vec_Àn
 (
v
) = 0;

270  
v
;

271 
	}
}

274 
	#hóp_f‹óch
(
v¨
,
Àn
,
hóp
,
body
) \

276 i‡(
	`vec_Àn
 (
hóp
) > 0) \

278 
hóp_hódî_t
 * 
_h
 = 
	`hóp_hódî
 (
hóp
); \

279 
hóp_ñt_t
 * 
_e
 = 
_h
->
ñts
 + _h->
hód
; \

280 
hóp_ñt_t
 * 
_íd
 = 
_h
->
ñts
 + _h->
èû
; \

283 i‡(! 
	`hóp_is_‰ì
 (
_e
)) \

285 (
v¨
Ë(
hóp
Ë+ 
	`hóp_off£t
 (
_e
); \

286 (
Àn
Ë
	`hóp_ñt_size
 ((
hóp
), 
_e
); \

287 dÿ{ 
body
; } 0); \

289 i‡(
_e
 =
_íd
) \

291 
_e
 = 
	`hóp_√xt
 (_e); \

294 } 0)

	)

296 
	#hóp_ñt_©_ödex
(
v
,
ödex
Ë
	`vec_ñt_©_ödex
(v,ödex)

	)

298 
Æways_ölöe
 
hóp_ñt_t
 *

299 
	$hóp_gë_ñt
 (*
v
, 
uw‹d
 
h™dÀ
)

301 
hóp_hódî_t
 *
h
 = 
	`hóp_hódî
 (
v
);

302 
hóp_ñt_t
 *
e
 = 
	`vec_ñt_©_ödex
 (
h
->
ñts
, 
h™dÀ
);

303 
	`ASSERT
 (!
	`hóp_is_‰ì
 (
e
));

304  
e
;

305 
	}
}

307 
	#hóp_ñt_wôh_h™dÀ
(
v
,
h™dÀ
) \

309 
hóp_ñt_t
 * 
_e
 = 
	`hóp_gë_ñt
 ((
v
), (
h™dÀ
)); \

310 (
v
Ë+ 
	`hóp_off£t
 (
_e
); \

311 })

	)

313 
Æways_ölöe
 
uw‹d


314 
	$hóp_is_‰ì_h™dÀ
 (*
v
, 
uw‹d
 
hóp_h™dÀ
)

316 
hóp_hódî_t
 *
h
 = 
	`hóp_hódî
 (
v
);

317 
hóp_ñt_t
 *
e
 = 
	`vec_ñt_©_ödex
 (
h
->
ñts
, 
hóp_h™dÀ
);

318  
	`hóp_is_‰ì
 (
e
);

319 
	}
}

321 
uw‹d
 
hóp_Àn
 (*
v
, 
w‹d
 
h™dÀ
);

324 *
_hóp_Æloc
 (*
v
, 
uw‹d
 
size
, uw‹d 
Æignmít
,

325 
uw‹d
 
ñt_byãs
, uw‹d * 
off£t
, uw‹d * 
h™dÀ
);

327 
	#hóp_Æloc_Æig√d
(
v
,
size
,
Æign
,
h™dÀ
) \

329 
uw‹d
 
_o
, 
_h
; \

330 
uw‹d
 
_a
 = (
Æign
); \

331 
uw‹d
 
_s
 = (
size
); \

332 (
v
Ë
	`_hóp_Æloc
 ((v), 
_s
, 
_a
,  ((v)[0]), &
_o
, &
_h
); \

333 (
h™dÀ
Ë
_h
; \

334 
_o
; \

335 })

	)

337 
	#hóp_Æloc
(
v
,
size
,
h™dÀ
Ë
	`hóp_Æloc_Æig√d
((v),(size),0,(h™dÀ))

	)

339 
hóp_dóŒoc
 (*
v
, 
uw‹d
 
h™dÀ
);

340 
hóp_vÆid©e
 (*
v
);

343 
u8
 *
f‹m©_hóp
 (u8 * 
s
, 
va_li°
 * 
va
);

345 *
_hóp_‰ì
 (*
v
);

347 
	#hóp_‰ì
(
v
Ë(v)=
	`_hóp_‰ì
(v)

	)

	@/usr/include/vppinfra/linux/syscall.h

16 #i‚de‡
ö˛uded_löux_sysˇŒ_h


17 
	#ö˛uded_löux_sysˇŒ_h


	)

19 
	~<uni°d.h
>

20 
	~<sys/sysˇŒ.h
>

22 
ölöe
 

23 
	$£t_mempﬁicy
 (
mode
, c⁄° *
nodemask
, 
maxnode
)

25  
	`sysˇŒ
 (
__NR_£t_mempﬁicy
, 
mode
, 
nodemask
, 
maxnode
);

26 
	}
}

28 
ölöe
 

29 
	$gë_mempﬁicy
 (*
mode
, *
nodemask
, 
maxnode
,

30 *
addr
, 
Êags
)

32  
	`sysˇŒ
 (
__NR_gë_mempﬁicy
, 
mode
, 
nodemask
, 
maxnode
, 
addr
, 
Êags
);

33 
	}
}

35 
ölöe
 

36 
	$move_∑ges
 (
pid
, 
cou¡
, **
∑ges
, c⁄° *
nodes
,

37 *
°©us
, 
Êags
)

39  
	`sysˇŒ
 (
__NR_move_∑ges
, 
pid
, 
cou¡
, 
∑ges
, 
nodes
, 
°©us
, 
Êags
);

40 
	}
}

42 #i‚de‡
HAVE_MEMFD_CREATE


43 
ölöe
 

44 
	$memfd_¸óã
 (c⁄° *
«me
, 
Êags
)

46  
	`sysˇŒ
 (
__NR_memfd_¸óã
, 
«me
, 
Êags
);

47 
	}
}

	@/usr/include/vppinfra/linux/sysfs.h

16 #i‚de‡
ö˛uded_löux_sysfs_h


17 
	#ö˛uded_löux_sysfs_h


	)

19 
	~<vµö‰a/îr‹.h
>

21 
˛ib_îr‹_t
 *
˛ib_sysfs_wrôe
 (*
fûe_«me
, *
fmt
, ...);

23 
˛ib_îr‹_t
 *
˛ib_sysfs_ªad
 (*
fûe_«me
, *
fmt
, ...);

25 
u8
 *
˛ib_sysfs_lök_to_«me
 (*
lök
);

27 
˛ib_îr‹_t
 *
˛ib_sysfs_£t_ƒ_hugïages
 (
numa_node
,

28 
∑ge_size
, 
ƒ
);

29 
˛ib_îr‹_t
 *
˛ib_sysfs_gë_ƒ_hugïages
 (
numa_node
,

30 
∑ge_size
, *
v
);

31 
˛ib_îr‹_t
 *
˛ib_sysfs_gë_‰ì_hugïages
 (
numa_node
,

32 
∑ge_size
, *
v
);

33 
˛ib_îr‹_t
 *
˛ib_sysfs_gë_suΩlus_hugïages
 (
numa_node
,

34 
∑ge_size
, *
v
);

35 
˛ib_îr‹_t
 *
˛ib_sysfs_¥óŒoc_hugïages
 (
numa_node
,

36 
∑ge_size
, 
ƒ
);

	@/usr/include/vppinfra/lock.h

16 #i‚de‡
ö˛uded_˛ib_lock_h


17 
	#ö˛uded_˛ib_lock_h


	)

19 
	~<vµö‰a/˛ib.h
>

21 #i‡
__x86_64__


22 
	#CLIB_PAUSE
(Ë
	`__buûtö_ü32_∑u£
 ()

	)

24 
	#CLIB_PAUSE
()

	)

27 #i‡
CLIB_DEBUG
 > 1

28 
	#CLIB_LOCK_DBG
(
_p
) \

30 (*
_p
)->
‰ame_addªss
 = 
	`__buûtö_‰ame_addªss
 (0); \

31 (*
_p
)->
pid
 = 
	`gëpid
 (); \

32 (*
_p
)->
thªad_ödex
 = 
	`os_gë_thªad_ödex
 (); \

33 } 0)

	)

34 
	#CLIB_LOCK_DBG_CLEAR
(
_p
) \

36 (*
_p
)->
‰ame_addªss
 = 0; \

37 (*
_p
)->
pid
 = 0; \

38 (*
_p
)->
thªad_ödex
 = 0; \

39 } 0)

	)

41 
	#CLIB_LOCK_DBG
(
_p
)

	)

42 
	#CLIB_LOCK_DBG_CLEAR
(
_p
)

	)

47 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

48 
u32
 
	mlock
;

49 #i‡
CLIB_DEBUG
 > 0

50 
pid_t
 
	mpid
;

51 
uw‹d
 
	mthªad_ödex
;

52 *
	m‰ame_addªss
;

54 } *
	t˛ib_•ölock_t
;

56 
ölöe
 

57 
	$˛ib_•ölock_öô
 (
˛ib_•ölock_t
 * 
p
)

59 *
p
 = 
	`˛ib_mem_Æloc_Æig√d
 (
CLIB_CACHE_LINE_BYTES
, CLIB_CACHE_LINE_BYTES);

60 
	`mem£t
 ((*Ë*
p
, 0, 
CLIB_CACHE_LINE_BYTES
);

61 
	}
}

63 
ölöe
 

64 
	$˛ib_•ölock_‰ì
 (
˛ib_•ölock_t
 * 
p
)

66 i‡(*
p
)

68 
	`˛ib_mem_‰ì
 ((*Ë*
p
);

69 *
p
 = 0;

71 
	}
}

73 
°©ic_Æways_ölöe
 

74 
	$˛ib_•ölock_lock
 (
˛ib_•ölock_t
 * 
p
)

76 
	`__sync_lock_ã°_™d_£t
 (&(*
p
)->
lock
, 1))

77 
	`CLIB_PAUSE
 ();

78 
	`CLIB_LOCK_DBG
 (
p
);

79 
	}
}

81 
°©ic_Æways_ölöe
 

82 
	$˛ib_•ölock_lock_if_öô
 (
˛ib_•ölock_t
 * 
p
)

84 i‡(
	`PREDICT_FALSE
 (*
p
 != 0))

85 
	`˛ib_•ölock_lock
 (
p
);

86 
	}
}

88 
°©ic_Æways_ölöe
 

89 
	$˛ib_•ölock_u∆ock
 (
˛ib_•ölock_t
 * 
p
)

91 
	`CLIB_LOCK_DBG_CLEAR
 (
p
);

93 
	`CLIB_MEMORY_BARRIER
 ();

94 (*
p
)->
lock
 = 0;

95 
	}
}

97 
°©ic_Æways_ölöe
 

98 
	$˛ib_•ölock_u∆ock_if_öô
 (
˛ib_•ölock_t
 * 
p
)

100 i‡(
	`PREDICT_FALSE
 (*
p
 != 0))

101 
	`˛ib_•ölock_u∆ock
 (
p
);

102 
	}
}

108 
	s˛ib_rw_lock_


110 
CLIB_CACHE_LINE_ALIGN_MARK
 (
ˇchñöe0
);

111 vﬁ©ûê
u32
 
	mn_ªadîs
;

112 vﬁ©ûê
u32
 
	mn_ªadîs_lock
;

113 vﬁ©ûê
u32
 
	mwrôî_lock
;

114 #i‡
CLIB_DEBUG
 > 0

115 
pid_t
 
	mpid
;

116 
uw‹d
 
	mthªad_ödex
;

117 *
	m‰ame_addªss
;

119 } *
	t˛ib_rwlock_t
;

121 
Æways_ölöe
 

122 
	$˛ib_rwlock_öô
 (
˛ib_rwlock_t
 * 
p
)

124 *
p
 = 
	`˛ib_mem_Æloc_Æig√d
 (
CLIB_CACHE_LINE_BYTES
, CLIB_CACHE_LINE_BYTES);

125 
	`mem£t
 ((*Ë*
p
, 0, 
CLIB_CACHE_LINE_BYTES
);

126 
	}
}

128 
Æways_ölöe
 

129 
	$˛ib_rwlock_‰ì
 (
˛ib_rwlock_t
 * 
p
)

131 i‡(*
p
)

133 
	`˛ib_mem_‰ì
 ((*Ë*
p
);

134 *
p
 = 0;

136 
	}
}

138 
Æways_ölöe
 

139 
	$˛ib_rwlock_ªadî_lock
 (
˛ib_rwlock_t
 * 
p
)

141 
	`__sync_lock_ã°_™d_£t
 (&(*
p
)->
n_ªadîs_lock
, 1))

142 
	`CLIB_PAUSE
 ();

144 (*
p
)->
n_ªadîs
 += 1;

145 i‡((*
p
)->
n_ªadîs
 == 1)

147 
	`__sync_lock_ã°_™d_£t
 (&(*
p
)->
wrôî_lock
, 1))

148 
	`CLIB_PAUSE
 ();

150 
	`CLIB_MEMORY_BARRIER
 ();

151 (*
p
)->
n_ªadîs_lock
 = 0;

153 
	`CLIB_LOCK_DBG
 (
p
);

154 
	}
}

156 
Æways_ölöe
 

157 
	$˛ib_rwlock_ªadî_u∆ock
 (
˛ib_rwlock_t
 * 
p
)

159 
	`ASSERT
 ((*
p
)->
n_ªadîs
 > 0);

160 
	`CLIB_LOCK_DBG_CLEAR
 (
p
);

162 
	`__sync_lock_ã°_™d_£t
 (&(*
p
)->
n_ªadîs_lock
, 1))

163 
	`CLIB_PAUSE
 ();

165 (*
p
)->
n_ªadîs
 -= 1;

166 i‡((*
p
)->
n_ªadîs
 == 0)

168 
	`CLIB_MEMORY_BARRIER
 ();

169 (*
p
)->
wrôî_lock
 = 0;

172 
	`CLIB_MEMORY_BARRIER
 ();

173 (*
p
)->
n_ªadîs_lock
 = 0;

174 
	}
}

176 
Æways_ölöe
 

177 
	$˛ib_rwlock_wrôî_lock
 (
˛ib_rwlock_t
 * 
p
)

179 
	`__sync_lock_ã°_™d_£t
 (&(*
p
)->
wrôî_lock
, 1))

180 
	`CLIB_PAUSE
 ();

181 
	`CLIB_LOCK_DBG
 (
p
);

182 
	}
}

184 
Æways_ölöe
 

185 
	$˛ib_rwlock_wrôî_u∆ock
 (
˛ib_rwlock_t
 * 
p
)

187 
	`CLIB_LOCK_DBG_CLEAR
 (
p
);

188 
	`CLIB_MEMORY_BARRIER
 ();

189 (*
p
)->
wrôî_lock
 = 0;

190 
	}
}

	@/usr/include/vppinfra/longjmp.h

38 #i‚de‡
ö˛uded_˛ib_l⁄gjmp_h


39 
	#ö˛uded_˛ib_l⁄gjmp_h


	)

41 
	~<vµö‰a/ty≥s.h
>

43 #i‡
deföed
(
__x86_64__
)

45 
	#CLIB_ARCH_LONGJMP_REGS
 8

	)

47 #ñi‡
deföed
(
i386
)

49 
	#CLIB_ARCH_LONGJMP_REGS
 6

	)

51 #ñi‡(
deföed
(
__powîpc64__
Ë|| deföed(
__powîpc__
))

53 #ifde‡
__ALTIVEC__


54 
	#CLIB_POWERPC_ALTIVEC_N_REGS
 12

	)

56 
	#CLIB_POWERPC_ALTIVEC_N_REGS
 0

	)

60 
	#CLIB_ARCH_LONGJMP_REGS
 \

66 + ( (
f64
Ë/  (
uw‹d
)) * (31 - 14 + 1) \

68 + (16 /  (
uw‹d
)Ë* 
CLIB_POWERPC_ALTIVEC_N_REGS
)

	)

70 #ñi‡
deföed
(
__SPU__
)

72 
	#CLIB_ARCH_LONGJMP_REGS
 (10)

	)

74 #ñi‡
deföed
(
__¨m__
)

76 #i‚de‡
__IWMMXT__


78 
	#CLIB_ARCH_LONGJMP_REGS
 (10)

	)

81 
	#CLIB_ARCH_LONGJMP_REGS
 (10 + (6*2))

	)

84 #ñi‡
deföed
(
__xãnß__
)

87 
	#CLIB_ARCH_LONGJMP_REGS
 0

	)

89 #ñi‡
deföed
(
__TMS320C6X__
)

92 
	#CLIB_ARCH_LONGJMP_REGS
 0

	)

94 #ñi‡
deföed
(
__Ørch64__
)

95 
	#CLIB_ARCH_LONGJMP_REGS
 (22)

	)

102 
uw‹d
 
	mªgs
[
CLIB_ARCH_LONGJMP_REGS
];

103 } 
	t˛ib_l⁄gjmp_t
 
	t__©åibuã__
 ((
	tÆig√d
 (16)));

106 
˛ib_l⁄gjmp
 (
˛ib_l⁄gjmp_t
 * 
ßve
, 
uw‹d
 
ªtu∫_vÆue
);

110 
uw‹d
 
˛ib_£tjmp
 (
˛ib_l⁄gjmp_t
 * 
ßve
, uw‹d 
ªtu∫_vÆue_nŸ_èkí
);

113 
uw‹d
 
˛ib_ˇŒjmp
 (
	$uw‹d
 (*
func
Ë(
uw‹d
 
func_¨g
),

114 
uw‹d
 
func_¨g
, *
°ack
);

	@/usr/include/vppinfra/mhash.h

15 #i‚de‡
ö˛uded_˛ib_mhash_h


16 
	#ö˛uded_˛ib_mhash_h


	)

41 
	~<vµö‰a/f‹m©.h
>

42 
	~<vµö‰a/hash.h
>

43 
	~<vµö‰a/hóp.h
>

50 
u8
 *
	mkey_ve˘‹_‹_hóp
;

54 
u32
 *
	mkey_ve˘‹_‰ì_ödi˚s
;

56 
u8
 **
	mkey_tmps
;

61 
	#MHASH_VEC_STRING_KEY
 0

	)

62 
	#MHASH_C_STRING_KEY
 1

	)

63 
u32
 
	mn_key_byãs
;

66 
u32
 
	mhash_£ed
;

69 
uw‹d
 *
	mhash
;

72 
f‹m©_fun˘i⁄_t
 *
	mf‹m©_key
;

73 } 
	tmhash_t
;

75 
mhash_öô
 (
mhash_t
 * 
h
, 
uw‹d
 
n_vÆue_byãs
, uw‹d 
n_key_byãs
);

77 
Æways_ölöe
 

78 
	$mhash_öô_c_°rög
 (
mhash_t
 * 
h
, 
uw‹d
 
n_vÆue_byãs
)

80 
	`mhash_öô
 (
h
, 
n_vÆue_byãs
, 
MHASH_C_STRING_KEY
);

81 
	}
}

83 
Æways_ölöe
 

84 
	$mhash_öô_vec_°rög
 (
mhash_t
 * 
h
, 
uw‹d
 
n_vÆue_byãs
)

86 
	`mhash_öô
 (
h
, 
n_vÆue_byãs
, 
MHASH_VEC_STRING_KEY
);

87 
	}
}

89 
Æways_ölöe
 *

90 
	$mhash_key_to_mem
 (
mhash_t
 * 
h
, 
uw‹d
 
key
)

92 i‡(
key
 == ~0)

94 
u8
 *
key_tmp
;

96 
my_˝u
 = 
	`os_gë_thªad_ödex
 ();

97 
	`vec_vÆid©e
 (
h
->
key_tmps
, 
my_˝u
);

98 
key_tmp
 = 
h
->
key_tmps
[
my_˝u
];

99  
key_tmp
;

101  
	`vec_ñt_©_ödex
 (
h
->
key_ve˘‹_‹_hóp
, 
key
);

102 
	}
}

104 
hash_∑ú_t
 *
mhash_gë_∑ú
 (
mhash_t
 * 
h
, c⁄° *
key
);

105 
uw‹d
 
mhash_£t_mem
 (
mhash_t
 * 
h
, *
key
, uw‹d * 
√w_vÆue
,

106 
uw‹d
 * 
ﬁd_vÆue
);

107 
uw‹d
 
mhash_un£t
 (
mhash_t
 * 
h
, *
key
, uw‹d * 
ﬁd_vÆue
);

109 
Æways_ölöe
 
uw‹d
 *

110 
	$mhash_gë
 (
mhash_t
 * 
h
, c⁄° *
key
)

112 
hash_∑ú_t
 *
p
 = 
	`mhash_gë_∑ú
 (
h
, 
key
);

113  
p
 ? &p->
vÆue
[0] : 0;

114 
	}
}

116 
Æways_ölöe
 
uw‹d


117 
	$mhash_£t
 (
mhash_t
 * 
h
, *
key
, 
uw‹d
 
√w_vÆue
, uw‹d * 
ﬁd_vÆue
)

119  
	`mhash_£t_mem
 (
h
, 
key
, &
√w_vÆue
, 
ﬁd_vÆue
);

120 
	}
}

122 
Æways_ölöe
 
uw‹d


123 
	$mhash_un£t_key
 (
mhash_t
 * 
h
, 
uw‹d
 
key
, uw‹d * 
ﬁd_vÆue
)

125 *
k
 = 
	`mhash_key_to_mem
 (
h
, 
key
);

126  
	`mhash_un£t
 (
h
, 
k
, 
ﬁd_vÆue
);

127 
	}
}

129 
Æways_ölöe
 
uw‹d


130 
	$mhash_vÆue_byãs
 (
mhash_t
 * 
m
)

132 
hash_t
 *
h
 = 
	`hash_hódî
 (
m
->
hash
);

133  
	`hash_vÆue_byãs
 (
h
);

134 
	}
}

136 
Æways_ölöe
 
uw‹d


137 
	$mhash_ñts
 (
mhash_t
 * 
m
)

139  
	`hash_ñts
 (
m
->
hash
);

140 
	}
}

142 
Æways_ölöe
 
uw‹d


143 
	$mhash_key_ve˘‹_is_hóp
 (
mhash_t
 * 
h
)

145  
h
->
n_key_byãs
 <= 1;

146 
	}
}

148 
Æways_ölöe
 

149 
	$mhash_‰ì
 (
mhash_t
 * 
h
)

151 i‡(
	`mhash_key_ve˘‹_is_hóp
 (
h
))

152 
	`hóp_‰ì
 (
h
->
key_ve˘‹_‹_hóp
);

154 
	`vec_‰ì
 (
h
->
key_ve˘‹_‹_hóp
);

155 
	`vec_‰ì
 (
h
->
key_ve˘‹_‰ì_ödi˚s
);

156 
	`hash_‰ì
 (
h
->
hash
);

157 
	}
}

159 
	#mhash_f‹óch
(
k
,
v
,
mh
,
body
) \

161 
hash_∑ú_t
 * 
_mhash_f‹óch_p
; \

162 
	`hash_f‹óch_∑ú
 (
_mhash_f‹óch_p
, (
mh
)->
hash
, ({ \

163 (
k
Ë
	`mhash_key_to_mem
 ((
mh
), 
_mhash_f‹óch_p
->
key
); \

164 (
v
Ë&
_mhash_f‹óch_p
->
vÆue
[0]; \

165 
body
; \

167 } 0)

	)

169 
f‹m©_fun˘i⁄_t
 
	gf‹m©_mhash_key
;

	@/usr/include/vppinfra/pool.h

44 #i‚de‡
ö˛uded_poﬁ_h


45 
	#ö˛uded_poﬁ_h


	)

47 
	~<vµö‰a/bôm≠.h
>

48 
	~<vµö‰a/îr‹.h
>

49 
	~<vµö‰a/mhóp.h
>

55 
uw‹d
 *
	m‰ì_bôm≠
;

58 
u32
 *
	m‰ì_ödi˚s
;

63 
u32
 
	mmax_ñts
;

66 
u8
 *
	mmm≠_ba£
;

67 
u64
 
	mmm≠_size
;

69 } 
	tpoﬁ_hódî_t
;

72 
	#poﬁ_Æig√d_hódî_byãs
 \

73 
	`vec_Æig√d_hódî_byãs
 ( (
poﬁ_hódî_t
),  (*))

	)

76 
Æways_ölöe
 
poﬁ_hódî_t
 *

77 
	$poﬁ_hódî
 (*
v
)

79  
	`vec_Æig√d_hódî
 (
v
,  (
poﬁ_hódî_t
),  (*));

80 
	}
}

82 
_poﬁ_öô_fixed
 (**, 
u32
, u32);

83 
Âoﬁ_‰ì
 (*);

86 
	#poﬁ_öô_fixed
(
poﬁ
,
max_ñts
) \

88 
	`_poﬁ_öô_fixed
((**)&(
poﬁ
),’oﬁ[0]),
max_ñts
); \

89 }

	)

92 
Æways_ölöe
 

93 
	$poﬁ_vÆid©e
 (*
v
)

95 
poﬁ_hódî_t
 *
p
 = 
	`poﬁ_hódî
 (
v
);

96 
uw‹d
 
i
, 
n_‰ì_bôm≠
;

98 i‡(!
v
)

101 
n_‰ì_bôm≠
 = 
	`˛ib_bôm≠_cou¡_£t_bôs
 (
p
->
‰ì_bôm≠
);

102 
	`ASSERT
 (
n_‰ì_bôm≠
 =
	`vec_Àn
 (
p
->
‰ì_ödi˚s
));

103 
i
 = 0; i < 
	`vec_Àn
 (
p
->
‰ì_ödi˚s
); i++)

104 
	`ASSERT
 (
	`˛ib_bôm≠_gë
 (
p
->
‰ì_bôm≠
,Ö->
‰ì_ödi˚s
[
i
]) == 1);

105 
	}
}

107 
Æways_ölöe
 

108 
	$poﬁ_hódî_vÆid©e_ödex
 (*
v
, 
uw‹d
 
ödex
)

110 
poﬁ_hódî_t
 *
p
 = 
	`poﬁ_hódî
 (
v
);

112 i‡(
v
)

113 
	`vec_vÆid©e
 (
p
->
‰ì_bôm≠
, 
ödex
 / 
	`BITS
 (
uw‹d
));

114 
	}
}

116 
	#poﬁ_vÆid©e_ödex
(
v
,
i
) \

118 
uw‹d
 
__poﬁ_vÆid©e_ödex
 = (
i
); \

119 
	`vec_vÆid©e_ha
 ((
v
), 
__poﬁ_vÆid©e_ödex
, \

120 
poﬁ_Æig√d_hódî_byãs
, 0); \

121 
	`poﬁ_hódî_vÆid©e_ödex
 ((
v
), 
__poﬁ_vÆid©e_ödex
); \

122 } 0)

	)

127 
Æways_ölöe
 
uw‹d


128 
	$poﬁ_ñts
 (*
v
)

130 
uw‹d
 
ªt
 = 
	`vec_Àn
 (
v
);

131 i‡(
v
)

132 
ªt
 -
	`vec_Àn
 (
	`poﬁ_hódî
 (
v
)->
‰ì_ödi˚s
);

133  
ªt
;

134 
	}
}

140 
	#poﬁ_Àn
(
p
Ë
	`vec_Àn
’)

	)

146 
	#_poﬁ_Àn
(
p
Ë
	`_vec_Àn
’)

	)

149 
Æways_ölöe
 
uw‹d


150 
	$poﬁ_hódî_byãs
 (*
v
)

152 
poﬁ_hódî_t
 *
p
 = 
	`poﬁ_hódî
 (
v
);

154 i‡(!
v
)

157  
	`vec_byãs
 (
p
->
‰ì_bôm≠
Ë+ vec_byã†’->
‰ì_ödi˚s
);

158 
	}
}

161 
	#poﬁ_byãs
(
P
Ë(
	`vec_byãs
 (PË+ 
	`poﬁ_hódî_byãs
 (P))

	)

164 
	#_poﬁ_v¨
(
v
Ë
_poﬁ_
##
	)
v

167 
Æways_ölöe
 
uw‹d


168 
	$poﬁ_‰ì_ñts
 (*
v
)

170 
poﬁ_hódî_t
 *
p
 = 
	`poﬁ_hódî
 (
v
);

171 
uw‹d
 
n_‰ì
 = 0;

173 i‡(
v
)

175 
n_‰ì
 +
	`vec_Àn
 (
p
->
‰ì_ödi˚s
);

178 
n_‰ì
 +
	`vec_ˇ∑côy
 (
v
,  (
p
[0])Ë- 
	`vec_Àn
 (v);

181  
n_‰ì
;

182 
	}
}

188 
	#poﬁ_gë_Æig√d
(
P
,
E
,
A
) \

190 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
P
); \

191 
uw‹d
 
	`_poﬁ_v¨
 (
l
); \

193 
	`_poﬁ_v¨
 (
l
) = 0; \

194 i‡(
P
) \

195 
	`_poﬁ_v¨
 (
l
Ë
	`vec_Àn
 (_poﬁ_v¨ (
p
)->
‰ì_ödi˚s
); \

197 i‡(
	`_poﬁ_v¨
 (
l
) > 0) \

200 
uw‹d
 
	`_poﬁ_v¨
 (
i
Ë_poﬁ_v¨ (
p
)->
‰ì_ödi˚s
[_poﬁ_v¨ (
l
) - 1]; \

201 (
E
Ë(
P
Ë+ 
	`_poﬁ_v¨
 (
i
); \

202 
	`_poﬁ_v¨
 (
p
)->
‰ì_bôm≠
 = \

203 
	`˛ib_bôm≠_™dnŸi
 (
	`_poﬁ_v¨
 (
p
)->
‰ì_bôm≠
, _poﬁ_v¨ (
i
)); \

204 
	`_vec_Àn
 (
	`_poﬁ_v¨
 (
p
)->
‰ì_ödi˚s
Ë_poﬁ_v¨ (
l
) - 1; \

209 i‡((
P
Ë&& 
	`_poﬁ_v¨
(
p
)->
max_ñts
) \

211 
	`˛ib_w¨nög
 ("can'tÉxpand fixed-sizeÖool"); \

212 
	`os_out_of_mem‹y
(); \

215 
P
 = 
	`_vec_ªsize
 (P, \

217  (
	`vec_Àn
 (
P
) + 1) *  (P[0]), \

218 
poﬁ_Æig√d_hódî_byãs
, \

219  (
A
)); \

220 
E
 = 
	`vec_íd
 (
P
) - 1; \

222 } 0)

	)

225 
	#poﬁ_gë
(
P
,
E
Ë
	`poﬁ_gë_Æig√d
(P,E,0)

	)

228 
	#poﬁ_gë_Æig√d_wûl_ex∑nd
(
P
,
YESNO
,
A
) \

230 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
P
); \

231 
uw‹d
 
	`_poﬁ_v¨
 (
l
); \

233 
	`_poﬁ_v¨
 (
l
) = 0; \

234 i‡(
P
) \

236 i‡(
	`_poﬁ_v¨
 (
p
)->
max_ñts
) \

237 
	`_poﬁ_v¨
 (
l
Ë_poﬁ_v¨ (
p
)->
max_ñts
; \

239 
	`_poﬁ_v¨
 (
l
Ë
	`vec_Àn
 (_poﬁ_v¨ (
p
)->
‰ì_ödi˚s
); \

243 i‡(
	`_poﬁ_v¨
 (
l
) > 0) \

244 
YESNO
=0; \

248 
YESNO
 = 
_vec_ªsize_wûl_ex∑nd
 \

249 (
P
, \

251  (
	`vec_Àn
 (
P
) + 1) *  (P[0]), \

252 
poﬁ_Æig√d_hódî_byãs
, \

253  (
A
)); \

255 } 0)

	)

257 
	#poﬁ_gë_wûl_ex∑nd
(
P
,
YESNO
Ë
	`poﬁ_gë_Æig√d_wûl_ex∑nd
(P,YESNO,0)

	)

260 
	#poﬁ_is_‰ì
(
P
,
E
) \

262 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
P
); \

263 
uw‹d
 
	`_poﬁ_v¨
 (
i
Ë(
E
Ë- (
P
); \

264 (
	`_poﬁ_v¨
 (
i
Ë< 
	`vec_Àn
 (
P
)Ë? 
	`˛ib_bôm≠_gë
 (_poﬁ_v¨ (
p
)->
‰ì_bôm≠
, 
_poﬁ_i
) : 1; \

265 })

	)

268 
	#poﬁ_is_‰ì_ödex
(
P
,
I
Ë
	`poﬁ_is_‰ì
((P),(P)+(I))

	)

271 
	#poﬁ_put
(
P
,
E
) \

273 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
P
); \

274 
uw‹d
 
	`_poﬁ_v¨
 (
l
Ë(
E
Ë- (
P
); \

275 
	`ASSERT
 (
	`vec_is_membî
 (
P
, 
E
)); \

276 
	`ASSERT
 (! 
	`poﬁ_is_‰ì
 (
P
, 
E
)); \

279 
	`_poﬁ_v¨
 (
p
)->
‰ì_bôm≠
 = \

280 
	`˛ib_bôm≠_‹i
 (
	`_poﬁ_v¨
 (
p
)->
‰ì_bôm≠
, _poﬁ_v¨ (
l
)); \

282 i‡(
	`_poﬁ_v¨
 (
p
)->
max_ñts
) \

284 
	`ASSERT
(
	`_poﬁ_v¨
(
l
Ë< _poﬁ_v¨ (
p
)->
max_ñts
); \

285 
	`_poﬁ_v¨
(
p
)->
‰ì_ödi˚s
[
	`_vec_Àn
(_pool_var(p)->free_indices)] = \

286 
	`_poﬁ_v¨
(
l
); \

287 
	`_vec_Àn
(
	`_poﬁ_v¨
(
p
)->
‰ì_ödi˚s
) += 1; \

290 
	`vec_add1
 (
	`_poﬁ_v¨
 (
p
)->
‰ì_ödi˚s
, _poﬁ_v¨ (
l
)); \

291 } 0)

	)

294 
	#poﬁ_put_ödex
(
p
,
i
) \

296 
	`ty≥of
 (
p
Ë
_e
 = (pË+ (
i
); \

297 
	`poﬁ_put
 (
p
, 
_e
); \

298 } 0)

	)

301 
	#poﬁ_Æloc_Æig√d
(
P
,
N
,
A
) \

303 
poﬁ_hódî_t
 * 
_p
; \

305 i‡((
P
)) \

307 
_p
 = 
	`poﬁ_hódî
 (
P
); \

308 i‡(
_p
->
max_ñts
) \

310 
	`˛ib_w¨nög
 ("Can'tÉxpand fixed-sizeÖool"); \

311 
	`os_out_of_mem‹y
(); \

315 (
P
Ë
	`_vec_ªsize
 ((P), 0, (
	`vec_Àn
 (PË+ (
N
)) *  (P[0]), \

316 
poﬁ_Æig√d_hódî_byãs
, \

317 (
A
)); \

318 
_p
 = 
	`poﬁ_hódî
 (
P
); \

319 
	`vec_ªsize
 (
_p
->
‰ì_ödi˚s
, (
N
)); \

320 
	`_vec_Àn
 (
_p
->
‰ì_ödi˚s
Ë-(
N
); \

321 } 0)

	)

324 
	#poﬁ_Æloc
(
P
,
N
Ë
	`poﬁ_Æloc_Æig√d
(P,N,0)

	)

327 
Æways_ölöe
 *

328 
	$_poﬁ_‰ì
 (*
v
)

330 
poﬁ_hódî_t
 *
p
 = 
	`poﬁ_hódî
 (
v
);

331 i‡(!
v
)

332  
v
;

333 
	`˛ib_bôm≠_‰ì
 (
p
->
‰ì_bôm≠
);

335 i‡(
p
->
max_ñts
)

337 
rv
;

339 
rv
 = 
	`munm≠
 (
p
->
mm≠_ba£
,Ö->
mm≠_size
);

340 i‡(
rv
)

341 
	`˛ib_unix_w¨nög
 ("munmap");

345 
	`vec_‰ì
 (
p
->
‰ì_ödi˚s
);

346 
	`vec_‰ì_h
 (
v
, 
poﬁ_Æig√d_hódî_byãs
);

349 
	}
}

352 
	#poﬁ_‰ì
(
p
Ë’Ë
	`_poﬁ_‰ì
’)

	)

364 
	#poﬁ_f‹óch_ªgi⁄
(
LO
,
HI
,
POOL
,
BODY
) \

366 
uw‹d
 
	`_poﬁ_v¨
 (
i
), _poﬁ_v¨ (
lo
), _poﬁ_v¨ (
hi
), _poﬁ_v¨ (
Àn
); \

367 
uw‹d
 
	`_poﬁ_v¨
 (
bl
), * _poﬁ_v¨ (
b
); \

368 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
); \

370 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
POOL
); \

371 
	`_poﬁ_v¨
 (
b
Ë(
POOL
Ë? _poﬁ_v¨ (
p
)->
‰ì_bôm≠
 : 0; \

372 
	`_poﬁ_v¨
 (
bl
Ë
	`vec_Àn
 (_poﬁ_v¨ (
b
)); \

373 
	`_poﬁ_v¨
 (
Àn
Ë
	`vec_Àn
 (
POOL
); \

374 
	`_poﬁ_v¨
 (
lo
) = 0; \

376 
	`_poﬁ_v¨
 (
i
) = 0; \

377 
	`_poﬁ_v¨
 (
i
Ë<_poﬁ_v¨ (
bl
); \

378 
	`_poﬁ_v¨
 (
i
)++) \

380 
uw‹d
 
	`_poﬁ_v¨
 (
m
), _poﬁ_v¨ (
f
); \

381 
	`_poﬁ_v¨
 (
m
Ë(_poﬁ_v¨ (
i
Ë< _poﬁ_v¨ (
bl
) \

382 ? 
	`_poﬁ_v¨
 (
b
Ë[_poﬁ_v¨ (
i
)] \

384 
	`_poﬁ_v¨
 (
m
) != 0) \

386 
	`_poﬁ_v¨
 (
f
Ë
	`fú°_£t
 (_poﬁ_v¨ (
m
)); \

387 
	`_poﬁ_v¨
 (
hi
Ë(_poﬁ_v¨ (
i
Ë* 
	`BITS
 (_poﬁ_v¨ (
b
)[0]) \

388 + 
	`mö_log2
 (
	`_poﬁ_v¨
 (
f
))); \

389 
	`_poﬁ_v¨
 (
hi
Ë(_poﬁ_v¨ (
i
Ë< _poﬁ_v¨ (
bl
) \

390 ? 
	`_poﬁ_v¨
 (
hi
Ë: _poﬁ_v¨ (
Àn
)); \

391 
	`_poﬁ_v¨
 (
m
Ë^_poﬁ_v¨ (
f
); \

392 i‡(
	`_poﬁ_v¨
 (
hi
Ë> _poﬁ_v¨ (
lo
)) \

394 (
LO
Ë
	`_poﬁ_v¨
 (
lo
); \

395 (
HI
Ë
	`_poﬁ_v¨
 (
hi
); \

396 dÿ{ 
BODY
; } 0); \

398 
	`_poﬁ_v¨
 (
lo
Ë_poﬁ_v¨ (
hi
) + 1; \

401 } 0)

	)

438 
	#poﬁ_f‹óch
(
VAR
,
POOL
,
BODY
) \

440 
uw‹d
 
_poﬁ_f‹óch_lo
, 
_poﬁ_f‹óch_hi
; \

441 
	`poﬁ_f‹óch_ªgi⁄
 (
_poﬁ_f‹óch_lo
, 
_poﬁ_f‹óch_hi
, (
POOL
), \

443 (
VAR
Ë(
POOL
Ë+ 
_poﬁ_f‹óch_lo
; \

444 (
VAR
Ë< (
POOL
Ë+ 
_poﬁ_f‹óch_hi
; \

445 (
VAR
)++) \

446 dÿ{ 
BODY
; } 0); \

448 } 0)

	)

459 
	#poﬁ_ñt_©_ödex
(
p
,
i
) \

461 
	`ty≥of
 (
p
Ë
_e
 = (pË+ (
i
); \

462 
	`ASSERT
 (! 
	`poﬁ_is_‰ì
 (
p
, 
_e
)); \

463 
_e
; \

464 })

	)

467 
	#poﬁ_√xt_ödex
(
P
,
I
) \

469 
poﬁ_hódî_t
 * 
	`_poﬁ_v¨
 (
p
Ë
	`poﬁ_hódî
 (
P
); \

470 
uw‹d
 
	`_poﬁ_v¨
 (
rv
Ë(
I
) + 1; \

472 
	`_poﬁ_v¨
(
rv
) = \

473 (
	`_poﬁ_v¨
 (
rv
Ë< 
	`vec_Àn
 (
P
) ? \

474 
	`˛ib_bôm≠_√xt_˛ór
 (
	`_poﬁ_v¨
 (
p
)->
‰ì_bôm≠
, _poﬁ_v¨(
rv
)) \

476 
	`_poﬁ_v¨
(
rv
); \

477 })

	)

480 
	#poﬁ_f‹óch_ödex
(
i
,
v
,
body
) \

481 (
i
Ë0; (iË< 
	`vec_Àn
 (
v
); (i)++) \

483 i‡(! 
	`poﬁ_is_‰ì_ödex
 ((
v
), (
i
))) \

484 dÿ{ 
body
; } 0); \

485 }

	)

495 
	#poﬁ_Êush
(
VAR
, 
POOL
, 
BODY
) \

497 
uw‹d
 *
	`_poﬁ_v¨
(
ii
), *_poﬁ_v¨(
dv
Ë
NULL
; \

499 
	`poﬁ_f‹óch
((
VAR
), (
POOL
), \

501 
	`vec_add1
(
	`_poﬁ_v¨
(
dv
), (
VAR
Ë- (
POOL
)); \

503 
	`vec_f‹óch
(
	`_poﬁ_v¨
(
ii
), _poﬁ_v¨(
dv
)) \

505 (
VAR
Ë
	`poﬁ_ñt_©_ödex
((
POOL
), *
	`_poﬁ_v¨
(
ii
)); \

506 dÿ{ 
BODY
; } 0); \

507 
	`poﬁ_put
((
POOL
), (
VAR
)); \

509 
	`vec_‰ì
(
	`_poﬁ_v¨
(
dv
)); \

510 }

	)

	@/usr/include/vppinfra/random_buffer.h

38 #i‚de‡
ö˛uded_˛ib_øndom_buf„r_h


39 
	#ö˛uded_˛ib_øndom_buf„r_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/øndom_ißac.h
>

47 
ißac_t
 
	m˘x
[2];

50 
uw‹d
 *
	mbuf„r
;

54 
uw‹d
 
	mn_ˇched_byãs
;

58 
u8
 
	mˇched_byãs
[ (
uw‹d
)];

59 
uw‹d
 
	mˇched_w‹d
;

62 
	t˛ib_øndom_buf„r_t
;

64 
Æways_ölöe
 

65 
	$˛ib_øndom_buf„r_‰ì
 (
˛ib_øndom_buf„r_t
 * 
b
)

67 
	`vec_‰ì
 (
b
->
buf„r
);

68 
	}
}

71 
˛ib_øndom_buf„r_fûl
 (
˛ib_øndom_buf„r_t
 * 
b
, 
uw‹d
 
n_w‹ds
);

74 
˛ib_øndom_buf„r_öô
 (
˛ib_øndom_buf„r_t
 * 
b
, 
uw‹d
 
£ed
);

77 
Æways_ölöe
 *

78 
	$˛ib_øndom_buf„r_gë_d©a
 (
˛ib_øndom_buf„r_t
 * 
b
, 
uw‹d
 
n_byãs
)

80 
uw‹d
 
n_w‹ds
, 
i
, 
l
;

82 
l
 = 
b
->
n_ˇched_byãs
;

83 i‡(
n_byãs
 <
l
)

85 
b
->
n_ˇched_byãs
 = 
l
 - 
n_byãs
;

86  &
b
->
ˇched_byãs
[
l
];

89 
n_w‹ds
 = 
n_byãs
 /  (
uw‹d
);

90 i‡(
n_byãs
 %  (
uw‹d
))

91 
n_w‹ds
++;

94 i‡(
	`PREDICT_FALSE
 (
n_w‹ds
 > 
	`vec_Àn
 (
b
->
buf„r
)))

95 
	`˛ib_øndom_buf„r_fûl
 (
b
, 
n_w‹ds
);

97 
i
 = 
	`vec_Àn
 (
b
->
buf„r
Ë- 
n_w‹ds
;

98 
	`_vec_Àn
 (
b
->
buf„r
Ë
i
;

100 i‡(
n_byãs
 <  (
uw‹d
))

102 
b
->
ˇched_w‹d
 = b->
buf„r
[
i
];

103 
b
->
n_ˇched_byãs
 =  (
uw‹d
Ë- 
n_byãs
;

104  
b
->
ˇched_byãs
;

107  
b
->
buf„r
 + 
i
;

108 
	}
}

	@/usr/include/vppinfra/serialize.h

38 #i‚de‡
ö˛uded_˛ib_£rülize_h


39 
	#ö˛uded_˛ib_£rülize_h


	)

41 
	~<°d¨g.h
>

42 
	~<vµö‰a/byã_‹dî.h
>

43 
	~<vµö‰a/ty≥s.h
>

44 
	~<vµö‰a/vec.h
>

45 
	~<vµö‰a/l⁄gjmp.h
>

47 
	g£rülize_maö_hódî_t
;

48 
	g£rülize_°ªam_t
;

50 (
	t£rülize_d©a_fun˘i⁄_t
Ë(
	t£rülize_maö_hódî_t
 * 
	th
,

51 
	t£rülize_°ªam_t
 * 
	ts
);

53 
	s£rülize_°ªam_t


56 
u8
 *
buf„r
;

59 
u32
 
n_buf„r_byãs
;

62 
u32
 
cuºít_buf„r_ödex
;

66 
u8
 *
ovîÊow_buf„r
;

69 
u32
 
cuºít_ovîÊow_ödex
;

71 
u32
 
Êags
;

72 
	#SERIALIZE_END_OF_STREAM
 (1 << 0)

	)

74 
uw‹d
 
d©a_fun˘i⁄_›aque
;

76 
u32
 
›aque
[64 - 4 *  (u32Ë- 1 *  (
uw‹d
) -

78 } 
	t£rülize_°ªam_t
;

80 
Æways_ölöe
 

81 
	$£rülize_°ªam_£t_íd_of_°ªam
 (
£rülize_°ªam_t
 * 
s
)

83 
s
->
Êags
 |
SERIALIZE_END_OF_STREAM
;

84 
	}
}

86 
Æways_ölöe
 
uw‹d


87 
	$£rülize_°ªam_is_íd_of_°ªam
 (
£rülize_°ªam_t
 * 
s
)

89  (
s
->
Êags
 & 
SERIALIZE_END_OF_STREAM
) != 0;

90 
	}
}

92 
	s£rülize_maö_hódî_t


94 
u32
 
	mªcursi⁄_Àvñ
;

97 
£rülize_d©a_fun˘i⁄_t
 *
	md©a_fun˘i⁄
;

100 
˛ib_îr‹_t
 *
	mîr‹
;

103 
˛ib_l⁄gjmp_t
 
	mîr‹_l⁄gjmp
;

104 } 
	t£rülize_maö_hódî_t
;

106 
Æways_ölöe
 

107 
	$£rülize_îr‹
 (
£rülize_maö_hódî_t
 * 
m
, 
˛ib_îr‹_t
 * 
îr‹
)

109 
	`˛ib_l⁄gjmp
 (&
m
->
îr‹_l⁄gjmp
, 
	`poöãr_to_uw‹d
 (
îr‹
));

110 
	}
}

112 
	#£rülize_îr‹_ªtu∫
(
m
,
¨gs
...) \

113 
	`£rülize_îr‹
 (&(
m
)->
hódî
, 
	`˛ib_îr‹_ªtu∫
 (0, 
¨gs
))

	)

115 *
£rülize_ªad_wrôe_nŸ_ölöe
 (
£rülize_maö_hódî_t
 * 
m
,

116 
£rülize_°ªam_t
 * 
s
,

117 
uw‹d
 
n_byãs
, uw‹d 
Êags
);

119 
	#SERIALIZE_FLAG_IS_READ
 (1 << 0)

	)

120 
	#SERIALIZE_FLAG_IS_WRITE
 (1 << 1)

	)

122 
Æways_ölöe
 *

123 
	$£rülize_°ªam_ªad_wrôe
 (
£rülize_maö_hódî_t
 * 
hódî
,

124 
£rülize_°ªam_t
 * 
s
,

125 
uw‹d
 
n_byãs
, uw‹d 
Êags
)

127 
uw‹d
 
i
, 
j
, 
l
;

129 
l
 = 
	`vec_Àn
 (
s
->
ovîÊow_buf„r
);

130 
i
 = 
s
->
cuºít_buf„r_ödex
;

131 
j
 = 
i
 + 
n_byãs
;

132 
s
->
cuºít_buf„r_ödex
 = 
j
;

133 i‡(
l
 =0 && 
j
 <
s
->
n_buf„r_byãs
)

135  
s
->
buf„r
 + 
i
;

139 
s
->
cuºít_buf„r_ödex
 = 
i
;

140  
	`£rülize_ªad_wrôe_nŸ_ölöe
 (
hódî
, 
s
, 
n_byãs
, 
Êags
);

142 
	}
}

146 
£rülize_maö_hódî_t
 
	mhódî
;

147 
£rülize_°ªam_t
 
	m°ªam
;

148 } 
	t£rülize_maö_t
;

150 
Æways_ölöe
 

151 
	$£rülize_£t_íd_of_°ªam
 (
£rülize_maö_t
 * 
m
)

153 
	`£rülize_°ªam_£t_íd_of_°ªam
 (&
m
->
°ªam
);

154 
	}
}

156 
Æways_ölöe
 
uw‹d


157 
	$£rülize_is_íd_of_°ªam
 (
£rülize_maö_t
 * 
m
)

159  
	`£rülize_°ªam_is_íd_of_°ªam
 (&
m
->
°ªam
);

160 
	}
}

164 
£rülize_maö_hódî_t
 
	mhódî
;

165 
£rülize_°ªam_t
 *
	m°ªams
;

166 } 
	t£rülize_mu…ùÀ_maö_t
;

168 (
	t£rülize_fun˘i⁄_t
Ë(
	t£rülize_maö_t
 * 
	tm
, 
	tva_li°
 * 
	tva
);

170 
Æways_ölöe
 *

171 
	$un£rülize_gë
 (
£rülize_maö_t
 * 
m
, 
uw‹d
 
n_byãs
)

173  
	`£rülize_°ªam_ªad_wrôe
 (&
m
->
hódî
, &m->
°ªam
, 
n_byãs
,

174 
SERIALIZE_FLAG_IS_READ
);

175 
	}
}

177 
Æways_ölöe
 *

178 
	$£rülize_gë
 (
£rülize_maö_t
 * 
m
, 
uw‹d
 
n_byãs
)

180  
	`£rülize_°ªam_ªad_wrôe
 (&
m
->
hódî
, &m->
°ªam
, 
n_byãs
,

181 
SERIALIZE_FLAG_IS_WRITE
);

182 
	}
}

184 
Æways_ölöe
 

185 
	$£rülize_öãgî
 (
£rülize_maö_t
 * 
m
, 
u64
 
x
, 
u32
 
n_byãs
)

187 
u8
 *
p
 = 
	`£rülize_gë
 (
m
, 
n_byãs
);

188 i‡(
n_byãs
 == 1)

189 
p
[0] = 
x
;

190 i‡(
n_byãs
 == 2)

191 
	`˛ib_mem_u«lig√d
 (
p
, 
u16
Ë
	`˛ib_ho°_to_√t_u16
 (
x
);

192 i‡(
n_byãs
 == 4)

193 
	`˛ib_mem_u«lig√d
 (
p
, 
u32
Ë
	`˛ib_ho°_to_√t_u32
 (
x
);

194 i‡(
n_byãs
 == 8)

195 
	`˛ib_mem_u«lig√d
 (
p
, 
u64
Ë
	`˛ib_ho°_to_√t_u64
 (
x
);

197 
	`ASSERT
 (0);

198 
	}
}

200 
Æways_ölöe
 

201 
	$un£rülize_öãgî
 (
£rülize_maö_t
 * 
m
, *
x
, 
u32
 
n_byãs
)

203 
u8
 *
p
 = 
	`un£rülize_gë
 (
m
, 
n_byãs
);

204 i‡(
n_byãs
 == 1)

205 *(
u8
 *Ë
x
 = 
p
[0];

206 i‡(
n_byãs
 == 2)

207 *(
u16
 *Ë
x
 = 
	`˛ib_√t_to_ho°_u«lig√d_mem_u16
 ((u16 *Ë
p
);

208 i‡(
n_byãs
 == 4)

209 *(
u32
 *Ë
x
 = 
	`˛ib_√t_to_ho°_u«lig√d_mem_u32
 ((u32 *Ë
p
);

210 i‡(
n_byãs
 == 8)

211 *(
u64
 *Ë
x
 = 
	`˛ib_√t_to_ho°_u«lig√d_mem_u64
 ((u64 *Ë
p
);

213 
	`ASSERT
 (0);

214 
	}
}

217 
Æways_ölöe
 

218 
	$£rülize_likñy_smÆl_unsig√d_öãgî
 (
£rülize_maö_t
 * 
m
, 
u64
 
x
)

220 
u64
 
r
 = 
x
;

221 
u8
 *
p
;

224 i‡(
r
 < (1 << 7))

226 
p
 = 
	`£rülize_gë
 (
m
, 1);

227 
p
[0] = 1 + 2 * 
r
;

232 
r
 -= (1 << 7);

233 i‡(
r
 < (1 << 14))

235 
p
 = 
	`£rülize_gë
 (
m
, 2);

236 
	`˛ib_mem_u«lig√d
 (
p
, 
u16
Ë
	`˛ib_ho°_to_lôée_u16
 (4 * 
r
 + 2);

240 
r
 -= (1 << 14);

241 i‡(
r
 < (1 << 29))

243 
p
 = 
	`£rülize_gë
 (
m
, 4);

244 
	`˛ib_mem_u«lig√d
 (
p
, 
u32
Ë
	`˛ib_ho°_to_lôée_u32
 (8 * 
r
 + 4);

248 
p
 = 
	`£rülize_gë
 (
m
, 9);

249 
p
[0] = 0;

250 
	`˛ib_mem_u«lig√d
 (
p
 + 1, 
u64
Ë
	`˛ib_ho°_to_lôée_u64
 (
x
);

251 
	}
}

253 
Æways_ölöe
 
u64


254 
	$un£rülize_likñy_smÆl_unsig√d_öãgî
 (
£rülize_maö_t
 * 
m
)

256 
u8
 *
p
 = 
	`un£rülize_gë
 (
m
, 1);

257 
u64
 
r
;

258 
u32
 
y
 = 
p
[0];

260 i‡(
y
 & 1)

261  
y
 / 2;

263 
r
 = 1 << 7;

264 i‡(
y
 & 2)

266 
p
 = 
	`un£rülize_gë
 (
m
, 1);

267 
r
 +(
y
 / 4Ë+ (
p
[0] << 6);

268  
r
;

271 
r
 += 1 << 14;

272 i‡(
y
 & 4)

274 
p
 = 
	`un£rülize_gë
 (
m
, 3);

275 
r
 +((
y
 / 8)

276 + (
p
[0] << (5 + 8 * 0))

277 + (
p
[1] << (5 + 8 * 1)) + (p[2] << (5 + 8 * 2)));

278  
r
;

281 
p
 = 
	`un£rülize_gë
 (
m
, 8);

282 
r
 = 
	`˛ib_mem_u«lig√d
 (
p
, 
u64
);

283 
r
 = 
	`˛ib_lôée_to_ho°_u64
 (r);

285  
r
;

286 
	}
}

288 
Æways_ölöe
 

289 
	$£rülize_likñy_smÆl_sig√d_öãgî
 (
£rülize_maö_t
 * 
m
, 
i64
 
s
)

291 
u64
 
u
 = 
s
 < 0 ? -(2 * s + 1) : 2 * s;

292 
	`£rülize_likñy_smÆl_unsig√d_öãgî
 (
m
, 
u
);

293 
	}
}

295 
Æways_ölöe
 
i64


296 
	$un£rülize_likñy_smÆl_sig√d_öãgî
 (
£rülize_maö_t
 * 
m
)

298 
u64
 
u
 = 
	`un£rülize_likñy_smÆl_unsig√d_öãgî
 (
m
);

299 
i64
 
s
 = 
u
 / 2;

300  (
u
 & 1Ë? -
s
 : s;

301 
	}
}

304 
£rülize_mu…ùÀ_1
 (
£rülize_maö_t
 * 
m
,

305 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

307 
£rülize_mu…ùÀ_2
 (
£rülize_maö_t
 * 
m
,

308 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

310 
£rülize_mu…ùÀ_4
 (
£rülize_maö_t
 * 
m
,

311 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

314 
un£rülize_mu…ùÀ_1
 (
£rülize_maö_t
 * 
m
,

315 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

317 
un£rülize_mu…ùÀ_2
 (
£rülize_maö_t
 * 
m
,

318 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

320 
un£rülize_mu…ùÀ_4
 (
£rülize_maö_t
 * 
m
,

321 *
d©a
, 
uw‹d
 
d©a_°ride
, uw‹d 
n_d©a
);

323 
Æways_ölöe
 

324 
	$£rülize_mu…ùÀ
 (
£rülize_maö_t
 * 
m
,

325 *
d©a
,

326 
uw‹d
 
n_d©a_byãs
, uw‹d 
d©a_°ride
, uw‹d 
n_d©a
)

328 i‡(
n_d©a_byãs
 == 1)

329 
	`£rülize_mu…ùÀ_1
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

330 i‡(
n_d©a_byãs
 == 2)

331 
	`£rülize_mu…ùÀ_2
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

332 i‡(
n_d©a_byãs
 == 4)

333 
	`£rülize_mu…ùÀ_4
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

335 
	`ASSERT
 (0);

336 
	}
}

338 
Æways_ölöe
 

339 
	$un£rülize_mu…ùÀ
 (
£rülize_maö_t
 * 
m
,

340 *
d©a
,

341 
uw‹d
 
n_d©a_byãs
, uw‹d 
d©a_°ride
, uw‹d 
n_d©a
)

343 i‡(
n_d©a_byãs
 == 1)

344 
	`un£rülize_mu…ùÀ_1
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

345 i‡(
n_d©a_byãs
 == 2)

346 
	`un£rülize_mu…ùÀ_2
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

347 i‡(
n_d©a_byãs
 == 4)

348 
	`un£rülize_mu…ùÀ_4
 (
m
, 
d©a
, 
d©a_°ride
, 
n_d©a
);

350 
	`ASSERT
 (0);

351 
	}
}

354 
£rülize_fun˘i⁄_t
 
	g£rülize_64
, 
	gun£rülize_64
;

355 
£rülize_fun˘i⁄_t
 
	g£rülize_32
, 
	gun£rülize_32
;

356 
£rülize_fun˘i⁄_t
 
	g£rülize_16
, 
	gun£rülize_16
;

357 
£rülize_fun˘i⁄_t
 
	g£rülize_8
, 
	gun£rülize_8
;

358 
£rülize_fun˘i⁄_t
 
	g£rülize_f64
, 
	gun£rülize_f64
;

359 
£rülize_fun˘i⁄_t
 
	g£rülize_f32
, 
	gun£rülize_f32
;

362 
£rülize_fun˘i⁄_t
 
	g£rülize_vec_8
, 
	gun£rülize_vec_8
;

363 
£rülize_fun˘i⁄_t
 
	g£rülize_vec_16
, 
	gun£rülize_vec_16
;

364 
£rülize_fun˘i⁄_t
 
	g£rülize_vec_32
, 
	gun£rülize_vec_32
;

365 
£rülize_fun˘i⁄_t
 
	g£rülize_vec_64
, 
	gun£rülize_vec_64
;

368 
£rülize_fun˘i⁄_t
 
	g£rülize_ve˘‹
, 
	gun£rülize_ve˘‹
,

369 
	gun£rülize_Æig√d_ve˘‹
;

371 
	#vec_£rülize
(
m
,
v
,
f
) \

372 
	`£rülize
 ((
m
), 
£rülize_ve˘‹
, (
v
),  ((v)[0]), (
f
))

	)

374 
	#vec_un£rülize
(
m
,
v
,
f
) \

375 
	`un£rülize
 ((
m
), 
un£rülize_ve˘‹
, (
v
),  ((*(v))[0]), (
f
))

	)

377 
	#vec_un£rülize_Æig√d
(
m
,
v
,
f
) \

378 
	`un£rülize
 ((
m
), 
un£rülize_Æig√d_ve˘‹
, (
v
),  ((*(v))[0]), (
f
))

	)

381 
£rülize_fun˘i⁄_t
 
	g£rülize_poﬁ
, 
	gun£rülize_poﬁ
,

382 
	gun£rülize_Æig√d_poﬁ
;

384 
	#poﬁ_£rülize
(
m
,
v
,
f
) \

385 
	`£rülize
 ((
m
), 
£rülize_poﬁ
, (
v
),  ((v)[0]), (
f
))

	)

387 
	#poﬁ_un£rülize
(
m
,
v
,
f
) \

388 
	`un£rülize
 ((
m
), 
un£rülize_poﬁ
, (
v
),  ((*(v))[0]), (
f
))

	)

390 
	#poﬁ_un£rülize_Æig√d
(
m
,
v
,
a
,
f
) \

391 
	`un£rülize
 ((
m
), 
un£rülize_Æig√d_poﬁ
, (
v
),  ((*(v))[0]), (
a
), (
f
))

	)

394 
£rülize_fun˘i⁄_t
 
	g£rülize_hóp
, 
	gun£rülize_hóp
;

396 
£rülize_bôm≠
 (
£rülize_maö_t
 * 
m
, 
uw‹d
 * 
b
);

397 
uw‹d
 *
un£rülize_bôm≠
 (
£rülize_maö_t
 * 
m
);

399 
£rülize_c°rög
 (
£rülize_maö_t
 * 
m
, *
°rög
);

400 
un£rülize_c°rög
 (
£rülize_maö_t
 * 
m
, **
°rög
);

402 
£rülize_˛o£
 (
£rülize_maö_t
 * 
m
);

403 
un£rülize_˛o£
 (
£rülize_maö_t
 * 
m
);

405 
£rülize_›í_d©a
 (
£rülize_maö_t
 * 
m
, 
u8
 * 
d©a
,

406 
uw‹d
 
n_d©a_byãs
);

407 
un£rülize_›í_d©a
 (
£rülize_maö_t
 * 
m
, 
u8
 * 
d©a
,

408 
uw‹d
 
n_d©a_byãs
);

411 
£rülize_›í_ve˘‹
 (
£rülize_maö_t
 * 
m
, 
u8
 * 
ve˘‹
);

414 *
£rülize_˛o£_ve˘‹
 (
£rülize_maö_t
 * 
m
);

416 
un£rülize_›í_ve˘‹
 (
£rülize_maö_t
 * 
m
, 
u8
 * 
ve˘‹
);

418 #ifde‡
CLIB_UNIX


419 
˛ib_îr‹_t
 *
£rülize_›í_˛ib_fûe
 (
£rülize_maö_t
 * 
m
, *
fûe
);

420 
˛ib_îr‹_t
 *
un£rülize_›í_˛ib_fûe
 (
£rülize_maö_t
 * 
m
, *
fûe
);

422 
£rülize_›í_˛ib_fûe_des¸ùt‹
 (
£rülize_maö_t
 * 
m
, 
fd
);

423 
un£rülize_›í_˛ib_fûe_des¸ùt‹
 (
£rülize_maö_t
 * 
m
, 
fd
);

427 
˛ib_îr‹_t
 *
£rülize
 (
£rülize_maö_t
 * 
m
, ...);

428 
˛ib_îr‹_t
 *
un£rülize
 (
£rülize_maö_t
 * 
m
, ...);

429 
˛ib_îr‹_t
 *
va_£rülize
 (
£rülize_maö_t
 * 
m
, 
va_li°
 * 
va
);

431 
£rülize_magic
 (
£rülize_maö_t
 * 
m
, *
magic
, 
u32
 
magic_byãs
);

432 
un£rülize_check_magic
 (
£rülize_maö_t
 * 
m
, *
magic
,

433 
u32
 
magic_byãs
);

	@/usr/include/vppinfra/socket.h

38 #i‚de‡
_˛ib_ö˛uded_sockë_h


39 
	#_˛ib_ö˛uded_sockë_h


	)

41 
	~<sys/ty≥s.h
>

42 
	~<sys/sockë.h
>

43 
	~<√töë/ö.h
>

45 
	~<vµö‰a/˛ib.h
>

46 
	~<vµö‰a/îr‹.h
>

47 
	~<vµö‰a/f‹m©.h
>

49 
	s_sockë_t


52 
i32
 
	mfd
;

55 *
	mc⁄fig
;

57 
u32
 
	mÊags
;

58 
	#CLIB_SOCKET_F_IS_SERVER
 (1 << 0)

	)

59 
	#CLIB_SOCKET_F_IS_CLIENT
 (0 << 0)

	)

60 
	#CLIB_SOCKET_F_RX_END_OF_FILE
 (1 << 2)

	)

61 
	#CLIB_SOCKET_F_NON_BLOCKING_CONNECT
 (1 << 3)

	)

62 
	#CLIB_SOCKET_F_ALLOW_GROUP_WRITE
 (1 << 4)

	)

63 
	#CLIB_SOCKET_F_SEQPACKET
 (1 << 5)

	)

64 
	#CLIB_SOCKET_F_PASSCRED
 (1 << 6)

	)

68 
u8
 *
	mtx_buf„r
;

71 
u8
 *
	mrx_buf„r
;

74 
sockaddr_ö
 
	m≥î
;

77 
pid_t
 
	mpid
;

78 
uid_t
 
	muid
;

79 
gid_t
 
	mgid
;

81 
	m˛ib_îr‹_t
 *(*
	mwrôe_func
Ë(
_sockë_t
 * 
	msock
);

82 
	m˛ib_îr‹_t
 *(*
	mªad_func
Ë(
_sockë_t
 * 
	msock
, 
	mmö_byãs
);

83 
	m˛ib_îr‹_t
 *(*
	m˛o£_func
Ë(
_sockë_t
 * 
	msock
);

84 
	m˛ib_îr‹_t
 *(*
	mªcvmsg_func
Ë(
_sockë_t
 * 
	ms
, *
	mmsg
, 
	mmsgÀn
,

85 
	mfds
[], 
	mnum_fds
);

86 
	m˛ib_îr‹_t
 *(*
	m£ndmsg_func
Ë(
_sockë_t
 * 
	ms
, *
	mmsg
, 
	mmsgÀn
,

87 
	mfds
[], 
	mnum_fds
);

88 
uw‹d
 
	m¥iv©e_d©a
;

89 } 
	t˛ib_sockë_t
;

94 
˛ib_îr‹_t
 *
˛ib_sockë_öô
 (
˛ib_sockë_t
 * 
sockë
);

96 
˛ib_îr‹_t
 *
˛ib_sockë_ac˚±
 (
˛ib_sockë_t
 * 
£rvî
,

97 
˛ib_sockë_t
 * 
˛õ¡
);

99 
Æways_ölöe
 
uw‹d


100 
	$˛ib_sockë_is_£rvî
 (
˛ib_sockë_t
 * 
sock
)

102  (
sock
->
Êags
 & 
CLIB_SOCKET_F_IS_SERVER
) != 0;

103 
	}
}

105 
Æways_ölöe
 
uw‹d


106 
	$˛ib_sockë_is_˛õ¡
 (
˛ib_sockë_t
 * 
s
)

108  !
	`˛ib_sockë_is_£rvî
 (
s
);

109 
	}
}

111 
Æways_ölöe
 
uw‹d


112 
	$˛ib_sockë_is_c⁄√˘ed
 (
˛ib_sockë_t
 * 
sock
)

114  
sock
->
fd
 > 0;

115 
	}
}

118 
Æways_ölöe
 

119 
	$˛ib_sockë_rx_íd_of_fûe
 (
˛ib_sockë_t
 * 
s
)

121  
s
->
Êags
 & 
CLIB_SOCKET_F_RX_END_OF_FILE
;

122 
	}
}

124 
Æways_ölöe
 *

125 
	$˛ib_sockë_tx_add
 (
˛ib_sockë_t
 * 
s
, 
n_byãs
)

127 
u8
 *
ªsu…
;

128 
	`vec_add2
 (
s
->
tx_buf„r
, 
ªsu…
, 
n_byãs
);

129  
ªsu…
;

130 
	}
}

132 
Æways_ölöe
 

133 
	$˛ib_sockë_tx_add_va_f‹m©ãd
 (
˛ib_sockë_t
 * 
s
, *
fmt
, 
va_li°
 * 
va
)

135 
s
->
tx_buf„r
 = 
	`va_f‹m©
 (s->tx_buf„r, 
fmt
, 
va
);

136 
	}
}

138 
Æways_ölöe
 
˛ib_îr‹_t
 *

139 
	$˛ib_sockë_tx
 (
˛ib_sockë_t
 * 
s
)

141  
s
->
	`wrôe_func
 (s);

142 
	}
}

144 
Æways_ölöe
 
˛ib_îr‹_t
 *

145 
	$˛ib_sockë_rx
 (
˛ib_sockë_t
 * 
s
, 
n_byãs
)

147  
s
->
	`ªad_func
 (s, 
n_byãs
);

148 
	}
}

150 
Æways_ölöe
 
˛ib_îr‹_t
 *

151 
	$˛ib_sockë_£ndmsg
 (
˛ib_sockë_t
 * 
s
, *
msg
, 
msgÀn
,

152 
fds
[], 
num_fds
)

154  
s
->
	`£ndmsg_func
 (s, 
msg
, 
msgÀn
, 
fds
, 
num_fds
);

155 
	}
}

157 
Æways_ölöe
 
˛ib_îr‹_t
 *

158 
	$˛ib_sockë_ªcvmsg
 (
˛ib_sockë_t
 * 
s
, *
msg
, 
msgÀn
,

159 
fds
[], 
num_fds
)

161  
s
->
	`ªcvmsg_func
 (s, 
msg
, 
msgÀn
, 
fds
, 
num_fds
);

162 
	}
}

164 
Æways_ölöe
 

165 
	$˛ib_sockë_‰ì
 (
˛ib_sockë_t
 * 
s
)

167 
	`vec_‰ì
 (
s
->
tx_buf„r
);

168 
	`vec_‰ì
 (
s
->
rx_buf„r
);

169 i‡(
	`˛ib_mem_is_hóp_obje˘
 (
s
->
c⁄fig
))

170 
	`vec_‰ì
 (
s
->
c⁄fig
);

171 
	`mem£t
 (
s
, 0,  (s[0]));

172 
	}
}

174 
Æways_ölöe
 
˛ib_îr‹_t
 *

175 
	$˛ib_sockë_˛o£
 (
˛ib_sockë_t
 * 
sock
)

177 
˛ib_îr‹_t
 *
îr
;

178 
îr
 = (*
sock
->
˛o£_func
) (sock);

179  
îr
;

180 
	}
}

182 
˛ib_sockë_tx_add_f‹m©ãd
 (
˛ib_sockë_t
 * 
s
, *
fmt
, ...);

	@/usr/include/vppinfra/time.h

38 #i‚de‡
ö˛uded_time_h


39 
	#ö˛uded_time_h


	)

41 
	~<vµö‰a/˛ib.h
>

47 
u64
 
	mtŸÆ_˝u_time
;

50 
u64
 
	mœ°_˝u_time
;

53 
f64
 
	m˛ocks_≥r_£c⁄d
;

57 
f64
 
	m£c⁄ds_≥r_˛ock
;

60 
u64
 
	möô_˝u_time
;

62 
u64
 
	mœ°_vîify_˝u_time
;

65 
f64
 
	mœ°_vîify_ª„ªn˚_time
;

67 
u32
 
	mlog2_˛ocks_≥r_£c⁄d
, 
	mlog2_˛ocks_≥r_‰equícy_vîify
;

68 } 
	t˛ib_time_t
;

71 #i‡
deföed
(
__x86_64__
Ë|| deföed(
i386
)

72 
Æways_ölöe
 
u64


73 
	$˛ib_˝u_time_now
 ()

75 
u32
 
a
, 
d
;

76 
asm
 vﬁ©ûê("rdtsc":"˜" (
a
), "=d" (
d
));

77  (
u64
Ë
a
 + ((u64Ë
d
 << (u64) 32);

78 
	}
}

80 #ñi‡
deföed
 (
__powîpc64__
)

82 
Æways_ölöe
 
u64


83 
	$˛ib_˝u_time_now
 ()

85 
u64
 
t
;

86 
asm
 vﬁ©ûê("m·b %0":"Ù" (
t
));

87  
t
;

88 
	}
}

90 #ñi‡
deföed
 (
__SPU__
)

92 
Æways_ölöe
 
u64


93 
	$˛ib_˝u_time_now
 ()

95 #ifde‡
_XLC


96  
	`•u_rdch
 (0x8);

100 
	}
}

102 #ñi‡
deföed
 (
__powîpc__
)

104 
Æways_ölöe
 
u64


105 
	$˛ib_˝u_time_now
 ()

107 
u32
 
hi1
, 
hi2
, 
lo
;

108 
asm
 volatile ("1:\n"

113 "b√ 1b\n":[
hi1
] "Ù" (hi1),[
hi2
] "Ù" (hi2),[
lo
] "=r" (lo));

114  (
u64
Ë
lo
 + ((u64Ë
hi2
 << (u64) 32);

115 
	}
}

117 #ñi‡
deföed
 (
__Ørch64__
)

118 
Æways_ölöe
 
u64


119 
	$˛ib_˝u_time_now
 ()

121 
u64
 
v˘
;

123 
asm
 vﬁ©ûê("mr†%0, c¡v˘_ñ0":"Ù" (
v˘
));

124  
v˘
;

125 
	}
}

127 #ñi‡
deföed
 (
__¨m__
)

128 #i‡
deföed
(
__ARM_ARCH_8A__
)

129 
Æways_ölöe
 
u64


130 
	$˛ib_˝u_time_now
 ()

132 
u64
 
tsc
;

133 
asm
 vﬁ©ûê("mº¯p15, 0, %Q0, %R0, c9":"Ù" (
tsc
));

134  
tsc
;

135 
	}
}

136 #ñi‡
deföed
(
__ARM_ARCH_7A__
)

137 
Æways_ölöe
 
u64


138 
	$˛ib_˝u_time_now
 ()

140 
u32
 
tsc
;

141 
asm
 vﬁ©ûê("mr¯p15, 0, %0, c9, c13, 0":"Ù" (
tsc
));

142  (
u64
Ë
tsc
;

143 
	}
}

145 
Æways_ölöe
 
u64


146 
	$˛ib_˝u_time_now
 ()

148 
u32
 
lo
;

149 
asm
 vﬁ©ûê("mr¯p15, 0, %[lo], c15, c12, 1":[
lo
] "=r" (lo));

150  (
u64
Ë
lo
;

151 
	}
}

154 #ñi‡
deföed
 (
__xãnß__
)

157 
Æways_ölöe
 
u64


158 
	$˛ib_˝u_time_now
 ()

161 
	}
}

163 #ñi‡
deföed
 (
__TMS320C6X__
)

165 
Æways_ölöe
 
u64


166 
	$˛ib_˝u_time_now
 ()

168 
u32
 
l
, 
h
;

170 
asm
 volatile (" dint\n"

172 " mv¯.s2 TSCH,%1\n" "Ñöt\n":"=b" (
l
), "=b" (
h
));

174  ((
u64
Ë
h
 << 32Ë| 
l
;

175 
	}
}

182 
˛ib_time_vîify_‰equícy
 (
˛ib_time_t
 * 
c
);

184 
Æways_ölöe
 
f64


185 
	$˛ib_time_now_öã∫Æ
 (
˛ib_time_t
 * 
c
, 
u64
 
n
)

187 
u64
 
l
 = 
c
->
œ°_˝u_time
;

188 
u64
 
t
 = 
c
->
tŸÆ_˝u_time
;

189 
t
 +
n
 - 
l
;

190 
c
->
tŸÆ_˝u_time
 = 
t
;

191 
c
->
œ°_˝u_time
 = 
n
;

192 i‡(
PREDICT_FALSE


193 ((
c
->
œ°_˝u_time
 -

194 
c
->
œ°_vîify_˝u_time
Ë>> c->
log2_˛ocks_≥r_‰equícy_vîify
))

195 
	`˛ib_time_vîify_‰equícy
 (
c
);

196  
t
 * 
c
->
£c⁄ds_≥r_˛ock
;

197 
	}
}

199 
Æways_ölöe
 
f64


200 
	$˛ib_time_now
 (
˛ib_time_t
 * 
c
)

202  
	`˛ib_time_now_öã∫Æ
 (
c
, 
	`˛ib_˝u_time_now
 ());

203 
	}
}

205 
Æways_ölöe
 

206 
	$˛ib_˝u_time_waô
 (
u64
 
dt
)

208 
u64
 
t_íd
 = 
	`˛ib_˝u_time_now
 (Ë+ 
dt
;

209 
	`˛ib_˝u_time_now
 (Ë< 
t_íd
)

211 
	}
}

213 
˛ib_time_öô
 (
˛ib_time_t
 * 
c
);

215 #ifde‡
CLIB_UNIX


217 
	~<time.h
>

218 
	~<sys/time.h
>

219 
	~<sys/ªsour˚.h
>

220 
	~<uni°d.h
>

221 
	~<sys/sysˇŒ.h
>

224 
Æways_ölöe
 
f64


225 
	$unix_time_now
 ()

229 
time•ec
 
ts
;

230 
	`sysˇŒ
 (
SYS_˛ock_gëtime
, 
CLOCK_REALTIME
, &
ts
);

231  
ts
.
tv_£c
 + 1e-9 *Ås.
tv_n£c
;

232 
	}
}

235 
Æways_ölöe
 
u64


236 
	$unix_time_now_n£c
 ()

238 
time•ec
 
ts
;

239 
	`sysˇŒ
 (
SYS_˛ock_gëtime
, 
CLOCK_REALTIME
, &
ts
);

240  1e9 * 
ts
.
tv_£c
 +Ås.
tv_n£c
;

241 
	}
}

243 
Æways_ölöe
 

244 
	$unix_time_now_n£c_‰a˘i⁄
 (
u32
 * 
£c
, u32 * 
n£c
)

246 
time•ec
 
ts
;

247 
	`sysˇŒ
 (
SYS_˛ock_gëtime
, 
CLOCK_REALTIME
, &
ts
);

248 *
£c
 = 
ts
.
tv_£c
;

249 *
n£c
 = 
ts
.
tv_n£c
;

250 
	}
}

252 
Æways_ölöe
 
f64


253 
	$unix_ußge_now
 ()

255 
rußge
 
u
;

256 
	`gërußge
 (
RUSAGE_SELF
, &
u
);

257  
u
.
ru_utime
.
tv_£c
 + 1e-6 * u.ru_utime.
tv_u£c


258 + 
u
.
ru_°ime
.
tv_£c
 + 1e-6 * u.ru_°ime.
tv_u£c
;

259 
	}
}

261 
Æways_ölöe
 

262 
	$unix_¶ìp
 (
f64
 
dt
)

264 
time•ec
 
ts
, 
t§em
;

265 
ts
.
tv_£c
 = 
dt
;

266 
ts
.
tv_n£c
 = 1e9 * (
dt
 - (
f64
Ëts.
tv_£c
);

268 
	`«no¶ìp
 (&
ts
, &
t§em
) < 0)

269 
ts
 = 
t§em
;

270 
	}
}

274 
Æways_ölöe
 
f64


275 
	$unix_time_now
 ()

278 
	}
}

280 
Æways_ölöe
 
u64


281 
	$unix_time_now_n£c
 ()

284 
	}
}

286 
Æways_ölöe
 

287 
	$unix_time_now_n£c_‰a˘i⁄
 (
u32
 * 
£c
, u32 * 
n£c
)

289 
	}
}

291 
Æways_ölöe
 
f64


292 
	$unix_ußge_now
 ()

295 
	}
}

297 
Æways_ölöe
 

298 
	$unix_¶ìp
 (
f64
 
dt
)

300 
	}
}

	@/usr/include/vppinfra/timer.h

24 #i‚de‡
ö˛uded_timî_h


25 
	#ö˛uded_timî_h


	)

27 
	~<sig«l.h
>

29 (
	ttimî_func_t
Ë(
	t™y
 
	t¨g
, 
	tf64
 
	tdñay
);

32 
	`timî_ˇŒ
 (
timî_func_t
 * 
func
, 
™y
 
¨g
, 
f64
 
time_öãrvÆ
);

35 
	`timî_block
 (
sig£t_t
 * 
ßve
);

36 
	`timî_unblock
 (
sig£t_t
 * 
ßve
);

	@/usr/include/vppinfra/tw_timer_1t_3w_1024sl_ov.h

16 #i‚de‡
__ö˛uded_tw_timî_1t_3w_1024¶_ov_h__


17 
	#__ö˛uded_tw_timî_1t_3w_1024¶_ov_h__


	)

20 #unde‡
TW_TIMER_WHEELS


21 #unde‡
TW_SLOTS_PER_RING


22 #unde‡
TW_RING_SHIFT


23 #unde‡
TW_RING_MASK


24 #unde‡
TW_TIMERS_PER_OBJECT


25 #unde‡
LOG2_TW_TIMERS_PER_OBJECT


26 #unde‡
TW_SUFFIX


27 #unde‡
TW_OVERFLOW_VECTOR


28 #unde‡
TW_FAST_WHEEL_BITMAP


29 #unde‡
TW_TIMER_ALLOW_DUPLICATE_STOP


30 #unde‡
TW_START_STOP_TRACE_SIZE


32 
	#TW_TIMER_WHEELS
 3

	)

33 
	#TW_SLOTS_PER_RING
 1024

	)

34 
	#TW_RING_SHIFT
 10

	)

35 
	#TW_RING_MASK
 (
TW_SLOTS_PER_RING
 -1)

	)

36 
	#TW_TIMERS_PER_OBJECT
 1

	)

37 
	#LOG2_TW_TIMERS_PER_OBJECT
 0

	)

38 
	#TW_SUFFIX
 
_1t_3w_1024¶_ov


	)

39 
	#TW_OVERFLOW_VECTOR
 1

	)

40 
	#TW_FAST_WHEEL_BITMAP
 1

	)

41 
	#TW_TIMER_ALLOW_DUPLICATE_STOP
 1

	)

43 
	~<vµö‰a/tw_timî_ãm∂©e.h
>

	@/usr/include/vppinfra/types.h

38 #i‚de‡
ö˛uded_˛ib_ty≥s_h


39 
	#ö˛uded_˛ib_ty≥s_h


	)

45 
	ti8
;

46 
	ti16
;

49 #i‡
deföed
(
CLIB_LINUX_KERNEL
)

51 
	~<asm/ty≥s.h
>

52 
	#CLIB_AVOID_CLASH_WITH_LINUX_TYPES


	)

56 
	tu8
;

57 
	tu16
;

60 #i‡
deföed
 (
__x86_64__
)

61 #i‚de‡
__COVERITY__


62 
	ti128
 
	t__©åibuã__
 ((
	tmode
 (
	tTI
)));

63 
	tu128
 
	t__©åibuã__
 ((
	tmode
 (
	tTI
)));

67 #i‡(
deföed
(
i386
Ë|| deföed(
_mùs
Ë|| deföed(
powîpc
Ë|| deföed (
__SPU__
Ë|| deföed(
__•¨c__
Ë|| deföed(
__¨m__
Ë|| deföed (
__xãnß__
Ë|| deföed(
__TMS320C6X__
))

68 
	ti32
;

69 
	ti64
;

71 #i‚de‡
CLIB_AVOID_CLASH_WITH_LINUX_TYPES


72 
	tu32
;

73 
	tu64
;

76 #ñi‡
deföed
(
_mùs
Ë&& 
__mùs
 == 64

77 
	#log2_uw‹d_bôs
 6

	)

78 
	#˛ib_addªss_bôs
 
_MIPS_SZPTR


	)

80 #ñi‡
deföed
(
Æpha
Ë|| deföed(
__x86_64__
Ë|| deföed (
__powîpc64__
Ë|| deföed (
__Ørch64__
)

81 
	ti32
;

82 
	ti64
;

84 
	#log2_uw‹d_bôs
 6

	)

85 
	#˛ib_addªss_bôs
 64

	)

87 #i‚de‡
CLIB_AVOID_CLASH_WITH_LINUX_TYPES


88 
	tu32
;

89 
	tu64
;

97 #i‚de‡
log2_uw‹d_bôs


98 
	#log2_uw‹d_bôs
 5

	)

102 
	#uw‹d_bôs
 (1 << 
log2_uw‹d_bôs
)

	)

104 #i‚de‡
˛ib_addªss_bôs


105 
	#˛ib_addªss_bôs
 32

	)

109 #i‡
uw‹d_bôs
 == 64

111 
i64
 
	tw‹d
;

112 
u64
 
	tuw‹d
;

115 
i32
 
	tw‹d
;

116 
u32
 
	tuw‹d
;

120 #i‡
˛ib_addªss_bôs
 == 64

121 
u64
 
	t˛ib_addªss_t
;

123 
u32
 
	t˛ib_addªss_t
;

130 
ölöe
 
__©åibuã__
 ((
Æways_ölöe
)Ë
uw‹d


131 
	$poöãr_to_uw‹d
 (c⁄° *
p
)

133  (
uw‹d
Ë(
˛ib_addªss_t
Ë
p
;

134 
	}
}

136 
	#uw‹d_to_poöãr
(
u
,
ty≥
Ë(—y≥Ë(
˛ib_addªss_t
Ë(u))

	)

139 
w‹d
 
	t™y
;

142 
	tf64
;

143 
	tf32
;

145 
__com∂ex__
 
	tcf32
;

146 
__com∂ex__
 
	tcf64
;

149 
f64
 
	tfw‹d
;

155 
	#˛ib_mem_u«lig√d
(
poöãr
,
ty≥
) \

156 (((°ru˘ { 
	`CLIB_PACKED
 (
ty≥
 
_d©a
); } *Ë(
poöãr
))->_d©a)

	)

160 
	#˛ib_mem_Æig√d
(
addr
,
ty≥
,
Æign
) \

162 
ty≥
 
_d©a
 \

163 
	`__©åibuã__
 ((
	`Æig√d
 (
Æign
), 
∑cked
)); \

164 } *Ë(
addr
))->
_d©a
)

	)

	@/usr/include/vppinfra/vector.h

38 #i‚de‡
ö˛uded_˛ib_ve˘‹_h


39 
	#ö˛uded_˛ib_ve˘‹_h


	)

41 
	~<vµö‰a/˛ib.h
>

45 #i‡
deföed
 (
__MMX__
Ë|| deföed (
__IWMMXT__
Ë|| deföed (
__Ørch64__
)

46 
	#CLIB_HAVE_VEC64


	)

49 #i‡
deföed
 (
__Ørch64__
Ë&& deföed(
__ARM_NEON
)

50 
	#CLIB_HAVE_VEC128


	)

53 #i‡
deföed
 (
__SSE4_2__
Ë&& 
__GNUC__
 >= 4

54 
	#CLIB_HAVE_VEC128


	)

57 #i‡
deföed
 (
__ALTIVEC__
)

58 
	#CLIB_HAVE_VEC128


	)

61 #i‡
deföed
 (
__AVX__
)

62 
	#CLIB_HAVE_VEC256


	)

65 #i‡
deföed
 (
__AVX512F__
)

66 
	#CLIB_HAVE_VEC512


	)

70 #ifde‡
CLIB_HAVE_VEC128


71 
	#CLIB_HAVE_VEC64


	)

74 
	#_ve˘‹_size
(
n
Ë
	`__©åibuã__
 ((
	`ve˘‹_size
 (n)))

	)

76 
	#f‹óch_vec64i
 
	`_
(
i
,8,8Ë_(i,16,4Ë_(i,32,2)

	)

77 
	#f‹óch_vec64u
 
	`_
(
u
,8,8Ë_(u,16,4Ë_(u,32,2)

	)

78 
	#f‹óch_vec64f
 
	`_
(
f
,32,2)

	)

79 
	#f‹óch_vec128i
 
	`_
(
i
,8,16Ë_(i,16,8Ë_(i,32,4Ë_(i,64,2)

	)

80 
	#f‹óch_vec128u
 
	`_
(
u
,8,16Ë_(u,16,8Ë_(u,32,4Ë_(u,64,2)

	)

81 
	#f‹óch_vec128f
 
	`_
(
f
,32,4Ë_(f,64,2)

	)

82 
	#f‹óch_vec256i
 
	`_
(
i
,8,32Ë_(i,16,16Ë_(i,32,8Ë_(i,64,4)

	)

83 
	#f‹óch_vec256u
 
	`_
(
u
,8,32Ë_(u,16,16Ë_(u,32,8Ë_(u,64,4)

	)

84 
	#f‹óch_vec256f
 
	`_
(
f
,32,8Ë_(f,64,4)

	)

85 
	#f‹óch_vec512i
 
	`_
(
i
,8,64Ë_(i,16,32Ë_(i,32,16Ë_(i,64,8)

	)

86 
	#f‹óch_vec512u
 
	`_
(
u
,8,64Ë_(u,16,32Ë_(u,32,16Ë_(u,64,8)

	)

87 
	#f‹óch_vec512f
 
	`_
(
f
,32,16Ë_(f,64,8)

	)

89 #i‡
deföed
 (
CLIB_HAVE_VEC512
)

90 
	#f‹óch_öt_vec
 
f‹óch_vec64i
 
f‹óch_vec128i
 
f‹óch_vec256i
 
f‹óch_vec512i


	)

91 
	#f‹óch_uöt_vec
 
f‹óch_vec64u
 
f‹óch_vec128u
 
f‹óch_vec256u
 
f‹óch_vec512u


	)

92 
	#f‹óch_Êﬂt_vec
 
f‹óch_vec64f
 
f‹óch_vec128f
 
f‹óch_vec256f
 
f‹óch_vec512f


	)

93 #ñi‡
deföed
 (
CLIB_HAVE_VEC256
)

94 
	#f‹óch_öt_vec
 
f‹óch_vec64i
 
f‹óch_vec128i
 
f‹óch_vec256i


	)

95 
	#f‹óch_uöt_vec
 
f‹óch_vec64u
 
f‹óch_vec128u
 
f‹óch_vec256u


	)

96 
	#f‹óch_Êﬂt_vec
 
f‹óch_vec64f
 
f‹óch_vec128f
 
f‹óch_vec256f


	)

98 
	#f‹óch_öt_vec
 
f‹óch_vec64i
 
f‹óch_vec128i


	)

99 
	#f‹óch_uöt_vec
 
f‹óch_vec64u
 
f‹óch_vec128u


	)

100 
	#f‹óch_Êﬂt_vec
 
f‹óch_vec64f
 
f‹óch_vec128f


	)

103 
	#f‹óch_vec
 
f‹óch_öt_vec
 
f‹óch_uöt_vec
 
f‹óch_Êﬂt_vec


	)

108 
	#_
(
t
,
s
,
c
) \

109 
t
##
	ts
 
	tt
##s##
	tx
##
	tc
 
	t_ve˘‹_size
 (s/8*c); \

111 
t
##
s
##
x
##
c
 
as_
##t##s##x##c; \

112 
t
##
s
 
as_
##t##s[
c
]; \

113 } 
	tt
##
	ts
##
	tx
##
	tc
##
	t_uni⁄_t
;

	)

115 
f‹óch_vec64i
 
f‹óch_vec64u
 
f‹óch_vec64f


116 
f‹óch_vec128i
 
f‹óch_vec128u
 
f‹óch_vec128f


117 
f‹óch_vec256i
 
f‹óch_vec256u
 
f‹óch_vec256f


118 
f‹óch_vec512i
 
f‹óch_vec512u
 
	gf‹óch_vec512f


119 #unde‡
_


122 #i‚de‡
CLIB_VECTOR_WORD_BITS


123 #ifde‡
CLIB_HAVE_VEC128


124 
	#CLIB_VECTOR_WORD_BITS
 128

	)

126 
	#CLIB_VECTOR_WORD_BITS
 64

	)

131 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

132 
i8
 
	ti8x
 
	t_ve˘‹_size
 (16);

133 
i16
 
	ti16x
 
	t_ve˘‹_size
 (16);

134 
i32
 
	ti32x
 
	t_ve˘‹_size
 (16);

135 
i64
 
	ti64x
 
	t_ve˘‹_size
 (16);

136 
u8
 
	tu8x
 
	t_ve˘‹_size
 (16);

137 
u16
 
	tu16x
 
	t_ve˘‹_size
 (16);

138 
u32
 
	tu32x
 
	t_ve˘‹_size
 (16);

139 
u64
 
	tu64x
 
	t_ve˘‹_size
 (16);

141 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

142 
i8
 
	ti8x
 
	t_ve˘‹_size
 (8);

143 
i16
 
	ti16x
 
	t_ve˘‹_size
 (8);

144 
i32
 
	ti32x
 
	t_ve˘‹_size
 (8);

145 
i64
 
	ti64x
 
	t_ve˘‹_size
 (8);

146 
u8
 
	tu8x
 
	t_ve˘‹_size
 (8);

147 
u16
 
	tu16x
 
	t_ve˘‹_size
 (8);

148 
u32
 
	tu32x
 
	t_ve˘‹_size
 (8);

149 
u64
 
	tu64x
 
	t_ve˘‹_size
 (8);

152 #unde‡
_ve˘‹_size


154 
	#VECTOR_WORD_TYPE
(
t
Ët##
x


	)

155 
	#VECTOR_WORD_TYPE_LEN
(
t
Ë( (
	`VECTOR_WORD_TYPE
—)Ë/  (t))

	)

159 
	#_
(
t
, 
s
, 
c
) \

160 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

161 
t
##
s
##
x
##
c
##
	`_is_equÆ
 (t##s##x##¯
v1
,Å##s##x##¯
v2
) \

162 {  (
v1
 =
v2
); } \

164 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

165 
t
##
s
##
x
##
c
##
	`_is_gª©î
 (t##s##x##¯
v1
,Å##s##x##¯
v2
) \

166 {  (
v1
 > 
v2
); } \

168 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

169 
t
##
s
##
x
##
c
##
	`_is_zîo
 (t##s##x##¯
v1
) \

170 { 
t
##
s
##
x
##
c
 
z
 = {0};  (
v1
 == z); } \

172 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

173 
t
##
s
##
x
##
c
##
	`_add
 (t##s##x##¯
v1
,Å##s##x##¯
v2
) \

174 {  (
v1
 + 
v2
); } \

176 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

177 
t
##
s
##
x
##
c
##
	`_sub
 (t##s##x##¯
v1
,Å##s##x##¯
v2
) \

178 {  (
v1
 - 
v2
); }

	)

179 
	gf‹óch_vec


180 #unde‡
_


183 
	#_
(
t
, 
s
, 
c
) \

184 
°©ic_Æways_ölöe
 
t
##
s
##
x
##
c
 \

185 
t
##
s
##
x
##
c
##
	`_•œt
 (t##s x) \

187 
t
##
s
##
x
##
c
 
r
; \

188 
i
; \

190 
i
 = 0; i < 
c
; i++) \

191 
r
[
i
] = 
x
; \

193  
r
; \

194 }

	)

195 
f‹óch_öt_vec
 
	gf‹óch_uöt_vec


196 #unde‡
_


198 #i‡
deföed
 (
__SSE4_2__
Ë&& 
__GNUC__
 >= 4

199 
	~<vµö‰a/ve˘‹_s£42.h
>

202 #i‡
deföed
 (
__ALTIVEC__
)

203 
	~<vµö‰a/ve˘‹_Ætivec.h
>

206 #i‡
deföed
 (
__Ørch64__
)

207 
	~<vµö‰a/ve˘‹_√⁄.h
>

210 #i‡(
deföed
(
CLIB_HAVE_VEC128
Ë|| deföed(
CLIB_HAVE_VEC64
))

211 
	~<vµö‰a/ve˘‹_funcs.h
>

	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_MISC
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

74 
	#htﬁe64
(
x
Ë(x)

	)

75 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

76 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/errno.h

22 #i‚def 
_ERRNO_H


26 #i‚def 
__√ed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 
	~<bôs/î∫o.h
>

36 #unde‡
__√ed_Em©h


38 #ifdef 
_ERRNO_H


45 #i‚def 
î∫o


46 
î∫o
;

49 #ifde‡
__USE_GNU


54 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

58 
	g__END_DECLS


66 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


67 #i‚de‡
__îr‹_t_deföed


68 
	tîr‹_t
;

69 
	#__îr‹_t_deföed
 1

	)

71 #unde‡
__√ed_îr‹_t


	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #unde‡
__USE_ISOC11


98 #unde‡
__USE_ISOC99


99 #unde‡
__USE_ISOC95


100 #unde‡
__USE_ISOCXX11


101 #unde‡
__USE_POSIX


102 #unde‡
__USE_POSIX2


103 #unde‡
__USE_POSIX199309


104 #unde‡
__USE_POSIX199506


105 #unde‡
__USE_XOPEN


106 #unde‡
__USE_XOPEN_EXTENDED


107 #unde‡
__USE_UNIX98


108 #unde‡
__USE_XOPEN2K


109 #unde‡
__USE_XOPEN2KXSI


110 #unde‡
__USE_XOPEN2K8


111 #unde‡
__USE_XOPEN2K8XSI


112 #unde‡
__USE_LARGEFILE


113 #unde‡
__USE_LARGEFILE64


114 #unde‡
__USE_FILE_OFFSET64


115 #unde‡
__USE_MISC


116 #unde‡
__USE_ATFILE


117 #unde‡
__USE_GNU


118 #unde‡
__USE_REENTRANT


119 #unde‡
__USE_FORTIFY_LEVEL


120 #unde‡
__KERNEL_STRICT_NAMES


124 #i‚de‡
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

137 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

146 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

147 && !
deföed
 
	g_DEFAULT_SOURCE


152 #unde‡
_DEFAULT_SOURCE


153 
	#_DEFAULT_SOURCE
 1

	)

157 #ifde‡
_GNU_SOURCE


158 #unde‡
_ISOC95_SOURCE


159 
	#_ISOC95_SOURCE
 1

	)

160 #unde‡
_ISOC99_SOURCE


161 
	#_ISOC99_SOURCE
 1

	)

162 #unde‡
_ISOC11_SOURCE


163 
	#_ISOC11_SOURCE
 1

	)

164 #unde‡
_POSIX_SOURCE


165 
	#_POSIX_SOURCE
 1

	)

166 #unde‡
_POSIX_C_SOURCE


167 
	#_POSIX_C_SOURCE
 200809L

	)

168 #unde‡
_XOPEN_SOURCE


169 
	#_XOPEN_SOURCE
 700

	)

170 #unde‡
_XOPEN_SOURCE_EXTENDED


171 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

172 #unde‡
_LARGEFILE64_SOURCE


173 
	#_LARGEFILE64_SOURCE
 1

	)

174 #unde‡
_DEFAULT_SOURCE


175 
	#_DEFAULT_SOURCE
 1

	)

176 #unde‡
_ATFILE_SOURCE


177 
	#_ATFILE_SOURCE
 1

	)

182 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

183 || (!
deföed
 
	g__STRICT_ANSI__
 \

184 && !
deföed
 
	g_ISOC99_SOURCE
 \

185 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

186 && !
deföed
 
	g_XOPEN_SOURCE
))

187 #unde‡
_DEFAULT_SOURCE


188 
	#_DEFAULT_SOURCE
 1

	)

192 #i‡(
deföed
 
_ISOC11_SOURCE
 \

193 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

194 
	#__USE_ISOC11
 1

	)

198 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

199 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

200 
	#__USE_ISOC99
 1

	)

204 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

205 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

206 
	#__USE_ISOC95
 1

	)

213 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

214 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

215 
	#__USE_ISOCXX11
 1

	)

221 #ifde‡
_DEFAULT_SOURCE


222 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


223 
	#__USE_POSIX_IMPLICITLY
 1

	)

225 #unde‡
_POSIX_SOURCE


226 
	#_POSIX_SOURCE
 1

	)

227 #unde‡
_POSIX_C_SOURCE


228 
	#_POSIX_C_SOURCE
 200809L

	)

230 #i‡((!
deföed
 
__STRICT_ANSI__
 \

231 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

232 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

233 
	#_POSIX_SOURCE
 1

	)

234 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

235 
	#_POSIX_C_SOURCE
 2

	)

236 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

237 
	#_POSIX_C_SOURCE
 199506L

	)

238 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

239 
	#_POSIX_C_SOURCE
 200112L

	)

241 
	#_POSIX_C_SOURCE
 200809L

	)

243 
	#__USE_POSIX_IMPLICITLY
 1

	)

246 #i‡(
deföed
 
_POSIX_SOURCE
 \

247 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

248 || 
deföed
 
_XOPEN_SOURCE
)

249 
	#__USE_POSIX
 1

	)

252 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


253 
	#__USE_POSIX2
 1

	)

256 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

257 
	#__USE_POSIX199309
 1

	)

260 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

261 
	#__USE_POSIX199506
 1

	)

264 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

265 
	#__USE_XOPEN2K
 1

	)

266 #unde‡
__USE_ISOC95


267 
	#__USE_ISOC95
 1

	)

268 #unde‡
__USE_ISOC99


269 
	#__USE_ISOC99
 1

	)

272 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

273 
	#__USE_XOPEN2K8
 1

	)

274 #unde‡
_ATFILE_SOURCE


275 
	#_ATFILE_SOURCE
 1

	)

278 #ifdef 
_XOPEN_SOURCE


279 
	#__USE_XOPEN
 1

	)

280 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

281 
	#__USE_XOPEN_EXTENDED
 1

	)

282 
	#__USE_UNIX98
 1

	)

283 #unde‡
_LARGEFILE_SOURCE


284 
	#_LARGEFILE_SOURCE
 1

	)

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

286 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

287 
	#__USE_XOPEN2K8
 1

	)

288 
	#__USE_XOPEN2K8XSI
 1

	)

290 
	#__USE_XOPEN2K
 1

	)

291 
	#__USE_XOPEN2KXSI
 1

	)

292 #unde‡
__USE_ISOC95


293 
	#__USE_ISOC95
 1

	)

294 #unde‡
__USE_ISOC99


295 
	#__USE_ISOC99
 1

	)

298 #ifde‡
_XOPEN_SOURCE_EXTENDED


299 
	#__USE_XOPEN_EXTENDED
 1

	)

304 #ifde‡
_LARGEFILE_SOURCE


305 
	#__USE_LARGEFILE
 1

	)

308 #ifde‡
_LARGEFILE64_SOURCE


309 
	#__USE_LARGEFILE64
 1

	)

312 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

313 
	#__USE_FILE_OFFSET64
 1

	)

316 #i‡
deföed
 
_DEFAULT_SOURCE


317 
	#__USE_MISC
 1

	)

320 #ifdef 
_ATFILE_SOURCE


321 
	#__USE_ATFILE
 1

	)

324 #ifdef 
_GNU_SOURCE


325 
	#__USE_GNU
 1

	)

328 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


329 
	#__USE_REENTRANT
 1

	)

332 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

333 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

334 #i‡
_FORTIFY_SOURCE
 > 1

335 
	#__USE_FORTIFY_LEVEL
 2

	)

337 
	#__USE_FORTIFY_LEVEL
 1

	)

340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<°dc-¥edef.h
>

353 #unde‡
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 23

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

362 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

365 #i‚de‡
__ASSEMBLER__


366 #i‚de‡
_SYS_CDEFS_H


367 
	~<sys/cdefs.h
>

372 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


373 
	#__USE_LARGEFILE
 1

	)

374 
	#__USE_LARGEFILE64
 1

	)

380 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

381 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

382 && 
deföed
 
	g__exã∫_ölöe


383 
	#__USE_EXTERN_INLINES
 1

	)

391 
	~<gnu/°ubs.h
>

	@/usr/include/getopt.h

19 #i‚de‡
_GETOPT_H


21 #i‚de‡
__√ed_gë›t


22 
	#_GETOPT_H
 1

	)

32 #i‡!
deföed
 
__GNU_LIBRARY__


33 
	~<˘y≥.h
>

36 #i‚de‡
__THROW


37 #i‚de‡
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

40 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__˝lu•lus


57 *
›èrg
;

71 
›töd
;

76 
›ãº
;

80 
›t›t
;

82 #i‚de‡
__√ed_gë›t


104 
	s›ti⁄


106 c⁄° *
	g«me
;

109 
	ghas_¨g
;

110 *
	gÊag
;

111 
	gvÆ
;

116 
	#no_¨gumít
 0

	)

117 
	#ªquúed_¨gumít
 1

	)

118 
	#›ti⁄Æ_¨gumít
 2

	)

146 #ifde‡
__GNU_LIBRARY__


150 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

151 
__THROW
;

153 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

154 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


158 #ifde‡
__REDIRECT


159 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
),

161 
__posix_gë›t
);

163 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
Ë
__THROW
;

165 
	#gë›t
 
__posix_gë›t


	)

169 
gë›t
 ();

172 #i‚de‡
__√ed_gë›t


173 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

174 c⁄° *
__sh‹t›ts
,

175 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

176 
__THROW
;

177 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

178 c⁄° *
__sh‹t›ts
,

179 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

180 
__THROW
;

184 #ifdef 
__˝lu•lus


189 #unde‡
__√ed_gë›t


	@/usr/include/libio.h

28 #i‚de‡
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_c⁄fig.h
>

33 
	#_IO_Âos_t
 
_G_Âos_t


	)

34 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li°
 
_G_va_li°


	)

45 
	#_IO_wöt_t
 
wöt_t


	)

48 
	#__√ed___va_li°


	)

49 
	~<°d¨g.h
>

50 #ifde‡
__GNUC_VA_LIST


51 #unde‡
_IO_va_li°


52 
	#_IO_va_li°
 
__gnuc_va_li°


	)

55 #i‚de‡
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #i‚de‡
EOF


62 
	#EOF
 (-1)

	)

64 #i‚de‡
NULL


65 #i‡
deföed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuŒ
)

	)

69 #i‡!
deföed
(
__˝lu•lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifde‡
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifde‡
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifde‡
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¨kî
 {

157 
_IO_m¨kî
 *
	m_√xt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

165 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

166 
	mpublic
:

167 
°ªamm¨kî
(
°ªambuf
 *
sb
);

168 ~
°ªamm¨kî
();

169 
ßvög
(Ë{  
	m_•os
 == -2; }

170 
dñè
(
°ªamm¨kî
&);

171 
dñè
();

176 
	e__codecvt_ªsu…


178 
	m__codecvt_ok
,

179 
	m__codecvt_∑πül
,

180 
	m__codecvt_îr‹
,

181 
	m__codecvt_noc⁄v


184 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

190 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

191 
	m__mb°©e_t
 *,

192 c⁄° 
	mwch¨_t
 *,

193 c⁄° 
	mwch¨_t
 *,

194 c⁄° 
	mwch¨_t
 **, *,

196 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

197 
	m__mb°©e_t
 *, *,

199 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

200 
	m__mb°©e_t
 *,

202 c⁄° **, 
	mwch¨_t
 *,

203 
	mwch¨_t
 *, wchar_t **);

204 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

207 c⁄° *, c⁄° *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

210 
_IO_ic⁄v_t
 
	m__cd_ö
;

211 
_IO_ic⁄v_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¨_t
 *
	m_IO_ªad_±r
;

218 
wch¨_t
 *
	m_IO_ªad_íd
;

219 
wch¨_t
 *
	m_IO_ªad_ba£
;

220 
wch¨_t
 *
	m_IO_wrôe_ba£
;

221 
wch¨_t
 *
	m_IO_wrôe_±r
;

222 
wch¨_t
 *
	m_IO_wrôe_íd
;

223 
wch¨_t
 *
	m_IO_buf_ba£
;

224 
wch¨_t
 *
	m_IO_buf_íd
;

226 
wch¨_t
 *
	m_IO_ßve_ba£
;

227 
wch¨_t
 *
	m_IO_backup_ba£
;

229 
wch¨_t
 *
	m_IO_ßve_íd
;

231 
__mb°©e_t
 
	m_IO_°©e
;

232 
__mb°©e_t
 
	m_IO_œ°_°©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¨_t
 
	m_sh‹tbuf
[1];

237 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

241 
	s_IO_FILE
 {

242 
	m_Êags
;

243 
	#_IO_fûe_Êags
 
_Êags


	)

247 * 
	m_IO_ªad_±r
;

248 * 
	m_IO_ªad_íd
;

249 * 
	m_IO_ªad_ba£
;

250 * 
	m_IO_wrôe_ba£
;

251 * 
	m_IO_wrôe_±r
;

252 * 
	m_IO_wrôe_íd
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_íd
;

256 *
	m_IO_ßve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_ßve_íd
;

260 
_IO_m¨kî
 *
	m_m¨kîs
;

262 
_IO_FILE
 *
	m_chaö
;

264 
	m_fûío
;

266 
	m_blksize
;

268 
	m_Êags2
;

270 
_IO_off_t
 
	m_ﬁd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cﬁumn
;

275 sig√d 
	m_vèbÀ_off£t
;

276 
	m_sh‹tbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifde‡
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com∂ëe


286 
_IO_FILE
 
	m_fûe
;

288 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_‰ìªs_li°
;

295 *
	m_‰ìªs_buf
;

297 *
	m__∑d1
;

298 *
	m__∑d2
;

299 *
	m__∑d3
;

300 *
	m__∑d4
;

302 
size_t
 
	m__∑d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

309 #i‚de‡
__˝lu•lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_∂us
;

315 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

316 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

317 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

318 #i‚de‡
_LIBC


319 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

320 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

321 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

323 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

324 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

325 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

333 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

341 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, c⁄° *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_˛o£_‚
 (*
	t__cookõ
);

356 #ifde‡
_GNU_SOURCE


358 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

359 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

360 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

361 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

366 
__io_ªad_‚
 *
	mªad
;

367 
__io_wrôe_‚
 *
	mwrôe
;

368 
__io_£ek_‚
 *
	m£ek
;

369 
__io_˛o£_‚
 *
	m˛o£
;

370 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

371 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

373 
	g_IO_cookõ_fûe
;

376 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

377 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

381 #ifde‡
__˝lu•lus


385 
__undîÊow
 (
_IO_FILE
 *);

386 
__uÊow
 (
_IO_FILE
 *);

387 
__ovîÊow
 (
_IO_FILE
 *, );

388 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

390 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

391 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

394 #i‡ 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

397 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

400 
	#_IO_gëc_u∆ocked
(
_Â
) \

401 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

402 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

403 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

404 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

405 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

406 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

407 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

408 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

409 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

410 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

412 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_gëwc_u∆ocked
(
_Â
) \

414 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

415 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

416 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

417 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

418 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

419 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

420 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

421 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

422 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

423 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

426 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

427 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

429 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

431 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

432 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

434 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

438 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

440 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

441 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

442 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

444 #ifde‡
_IO_MTSAFE_IO


445 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

446 
	#_IO_Êockfûe
(
_Â
) \

447 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

448 
	#_IO_fu∆ockfûe
(
_Â
) \

449 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

451 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

452 
	#_IO_Êockfûe
(
_Â
Ë

	)

453 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

454 
	#_IO_·rylockfûe
(
_Â
Ë

	)

455 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

456 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

459 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

460 
_IO_va_li°
, *
__ª°ri˘
);

461 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

462 
_IO_va_li°
);

463 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

471 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

473 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

474 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

475 #i‡
__GNUC__
 >= 2

478 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


479 
	~<shlib-com∑t.h
>

480 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

482 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

483 c⁄° 
_IO_°dö_u£d
;

484 
wók_exã∫
 (
_IO_°dö_u£d
);

487 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


488 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

492 
	#_IO_fwide
(
__Â
, 
__mode
) \

493 ({ 
__ªsu…
 = (
__mode
); \

494 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

496 i‡((
__Â
)->
_mode
 == 0) \

498 (
__Â
)->
_mode
 = -1; \

499 
__ªsu…
 = (
__Â
)->
_mode
; \

501 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

502 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

504 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

505 
__ªsu…
; })

	)

508 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

509 
_IO_va_li°
, *
__ª°ri˘
);

510 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

511 
_IO_va_li°
);

512 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

513 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

516 #ifde‡
__LDBL_COMPAT


517 
	~<bôs/libio-ldbl.h
>

520 #ifde‡
__˝lu•lus


	@/usr/include/linux/errno.h

1 
	~<asm/î∫o.h
>

	@/usr/include/linux/if_ether.h

21 #i‚de‡
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<löux/ty≥s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_TSN
 0x22F0

	)

46 
	#ETH_P_IP
 0x0800

	)

47 
	#ETH_P_X25
 0x0805

	)

48 
	#ETH_P_ARP
 0x0806

	)

49 
	#ETH_P_BPQ
 0x08FF

	)

50 
	#ETH_P_IEEEPUP
 0x0a00

	)

51 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

52 
	#ETH_P_BATMAN
 0x4305

	)

53 
	#ETH_P_DEC
 0x6000

	)

54 
	#ETH_P_DNA_DL
 0x6001

	)

55 
	#ETH_P_DNA_RC
 0x6002

	)

56 
	#ETH_P_DNA_RT
 0x6003

	)

57 
	#ETH_P_LAT
 0x6004

	)

58 
	#ETH_P_DIAG
 0x6005

	)

59 
	#ETH_P_CUST
 0x6006

	)

60 
	#ETH_P_SCA
 0x6007

	)

61 
	#ETH_P_TEB
 0x6558

	)

62 
	#ETH_P_RARP
 0x8035

	)

63 
	#ETH_P_ATALK
 0x809B

	)

64 
	#ETH_P_AARP
 0x80F3

	)

65 
	#ETH_P_8021Q
 0x8100

	)

66 
	#ETH_P_IPX
 0x8137

	)

67 
	#ETH_P_IPV6
 0x86DD

	)

68 
	#ETH_P_PAUSE
 0x8808

	)

69 
	#ETH_P_SLOW
 0x8809

	)

70 
	#ETH_P_WCCP
 0x883E

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884¯

	)

75 
	#ETH_P_PPP_DISC
 0x8863

	)

76 
	#ETH_P_PPP_SES
 0x8864

	)

77 
	#ETH_P_LINK_CTL
 0x886¯

	)

78 
	#ETH_P_ATMFATE
 0x8884

	)

81 
	#ETH_P_PAE
 0x888E

	)

82 
	#ETH_P_AOE
 0x88A2

	)

83 
	#ETH_P_8021AD
 0x88A8

	)

84 
	#ETH_P_802_EX1
 0x88B5

	)

85 
	#ETH_P_TIPC
 0x88CA

	)

86 
	#ETH_P_8021AH
 0x88E7

	)

87 
	#ETH_P_MVRP
 0x88F5

	)

88 
	#ETH_P_1588
 0x88F7

	)

89 
	#ETH_P_PRP
 0x88FB

	)

90 
	#ETH_P_FCOE
 0x8906

	)

91 
	#ETH_P_TDLS
 0x890D

	)

92 
	#ETH_P_FIP
 0x8914

	)

93 
	#ETH_P_80221
 0x8917

	)

94 
	#ETH_P_LOOPBACK
 0x9000

	)

95 
	#ETH_P_QINQ1
 0x9100

	)

96 
	#ETH_P_QINQ2
 0x9200

	)

97 
	#ETH_P_QINQ3
 0x9300

	)

98 
	#ETH_P_EDSA
 0xDADA

	)

99 
	#ETH_P_AF_IUCV
 0xFBFB

	)

101 
	#ETH_P_802_3_MIN
 0x0600

	)

108 
	#ETH_P_802_3
 0x0001

	)

109 
	#ETH_P_AX25
 0x0002

	)

110 
	#ETH_P_ALL
 0x0003

	)

111 
	#ETH_P_802_2
 0x0004

	)

112 
	#ETH_P_SNAP
 0x0005

	)

113 
	#ETH_P_DDCMP
 0x0006

	)

114 
	#ETH_P_WAN_PPP
 0x0007

	)

115 
	#ETH_P_PPP_MP
 0x0008

	)

116 
	#ETH_P_LOCALTALK
 0x0009

	)

117 
	#ETH_P_CAN
 0x000C

	)

118 
	#ETH_P_CANFD
 0x000D

	)

119 
	#ETH_P_PPPTALK
 0x0010

	)

120 
	#ETH_P_TR_802_2
 0x0011

	)

121 
	#ETH_P_MOBITEX
 0x0015

	)

122 
	#ETH_P_CONTROL
 0x0016

	)

123 
	#ETH_P_IRDA
 0x0017

	)

124 
	#ETH_P_ECONET
 0x0018

	)

125 
	#ETH_P_HDLC
 0x0019

	)

126 
	#ETH_P_ARCNET
 0x001A

	)

127 
	#ETH_P_DSA
 0x001B

	)

128 
	#ETH_P_TRAILER
 0x001C

	)

129 
	#ETH_P_PHONET
 0x00F5

	)

130 
	#ETH_P_IEEE802154
 0x00F6

	)

131 
	#ETH_P_CAIF
 0x00F7

	)

132 
	#ETH_P_XDSA
 0x00F8

	)

138 
	sëhhdr
 {

139 
	mh_de°
[
ETH_ALEN
];

140 
	mh_sour˚
[
ETH_ALEN
];

141 
__be16
 
	mh_¥Ÿo
;

142 } 
__©åibuã__
((
∑cked
));

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/sched.h

19 #i‚def 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<„©uªs.h
>

25 
	~<bôs/ty≥s.h
>

27 
	#__√ed_size_t


	)

28 
	~<°ddef.h
>

30 #ifde‡
__USE_XOPEN2K


31 
	#__√ed_time_t


	)

32 
	#__√ed_time•ec


	)

34 
	~<time.h
>

36 #i‚de‡
__pid_t_deföed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_deföed


	)

43 
	~<bôs/sched.h
>

45 
	#sched_¥i‹ôy
 
__sched_¥i‹ôy


	)

48 
__BEGIN_DECLS


51 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, c⁄° 
sched_∑øm
 *
__∑øm
)

52 
__THROW
;

55 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

58 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

59 c⁄° 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

62 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

65 
	$sched_yõld
 (Ë
__THROW
;

68 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

71 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

74 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

77 #ifde‡
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

81 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

82 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

83 
˝u£ç
)

	)

84 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

85 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

87 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

88 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

89 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
˝u£ç
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

94 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

95 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

99 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

100 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

101 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

102 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

103 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

104 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

113 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

114 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

118 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

119 c⁄° 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

122 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

123 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

126 
__END_DECLS


	@/usr/include/stdint.h

22 #i‚de‡
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/wch¨.h
>

27 
	~<bôs/w‹dsize.h
>

34 #i‚de‡
__öt8_t_deföed


35 
	#__öt8_t_deföed


	)

36 sig√d 
	töt8_t
;

37 
	töt16_t
;

38 
	töt32_t
;

39 #i‡
__WORDSIZE
 == 64

40 
	töt64_t
;

42 
__exãnsi⁄__


43 
	töt64_t
;

48 
	tuöt8_t
;

49 
	tuöt16_t
;

50 #i‚de‡
__uöt32_t_deföed


51 
	tuöt32_t
;

52 
	#__uöt32_t_deföed


	)

54 #i‡
__WORDSIZE
 == 64

55 
	tuöt64_t
;

57 
__exãnsi⁄__


58 
	tuöt64_t
;

65 sig√d 
	töt_Àa°8_t
;

66 
	töt_Àa°16_t
;

67 
	töt_Àa°32_t
;

68 #i‡
__WORDSIZE
 == 64

69 
	töt_Àa°64_t
;

71 
__exãnsi⁄__


72 
	töt_Àa°64_t
;

76 
	tuöt_Àa°8_t
;

77 
	tuöt_Àa°16_t
;

78 
	tuöt_Àa°32_t
;

79 #i‡
__WORDSIZE
 == 64

80 
	tuöt_Àa°64_t
;

82 
__exãnsi⁄__


83 
	tuöt_Àa°64_t
;

90 sig√d 
	töt_Á°8_t
;

91 #i‡
__WORDSIZE
 == 64

92 
	töt_Á°16_t
;

93 
	töt_Á°32_t
;

94 
	töt_Á°64_t
;

96 
	töt_Á°16_t
;

97 
	töt_Á°32_t
;

98 
__exãnsi⁄__


99 
	töt_Á°64_t
;

103 
	tuöt_Á°8_t
;

104 #i‡
__WORDSIZE
 == 64

105 
	tuöt_Á°16_t
;

106 
	tuöt_Á°32_t
;

107 
	tuöt_Á°64_t
;

109 
	tuöt_Á°16_t
;

110 
	tuöt_Á°32_t
;

111 
__exãnsi⁄__


112 
	tuöt_Á°64_t
;

117 #i‡
__WORDSIZE
 == 64

118 #i‚de‡
__öçå_t_deföed


119 
	töçå_t
;

120 
	#__öçå_t_deföed


	)

122 
	tuöçå_t
;

124 #i‚de‡
__öçå_t_deföed


125 
	töçå_t
;

126 
	#__öçå_t_deföed


	)

128 
	tuöçå_t
;

133 #i‡
__WORDSIZE
 == 64

134 
	tötmax_t
;

135 
	tuötmax_t
;

137 
__exãnsi⁄__


138 
	tötmax_t
;

139 
__exãnsi⁄__


140 
	tuötmax_t
;

144 #i‡
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
Ë¯## 
L


	)

146 
	#__UINT64_C
(
c
Ë¯## 
UL


	)

148 
	#__INT64_C
(
c
Ë¯## 
LL


	)

149 
	#__UINT64_C
(
c
Ë¯## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #i‡
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #i‡
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #i‡
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #i‡
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #i‡
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #i‡
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 #ifde‡
__WORDSIZE32_SIZE_ULONG


264 
	#SIZE_MAX
 (4294967295UL)

	)

266 
	#SIZE_MAX
 (4294967295U)

	)

271 #i‚de‡
WCHAR_MIN


273 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

274 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

278 
	#WINT_MIN
 (0u)

	)

279 
	#WINT_MAX
 (4294967295u)

	)

282 
	#INT8_C
(
c
Ë
	)
c

283 
	#INT16_C
(
c
Ë
	)
c

284 
	#INT32_C
(
c
Ë
	)
c

285 #i‡
__WORDSIZE
 == 64

286 
	#INT64_C
(
c
Ë¯## 
L


	)

288 
	#INT64_C
(
c
Ë¯## 
LL


	)

292 
	#UINT8_C
(
c
Ë
	)
c

293 
	#UINT16_C
(
c
Ë
	)
c

294 
	#UINT32_C
(
c
Ë¯## 
U


	)

295 #i‡
__WORDSIZE
 == 64

296 
	#UINT64_C
(
c
Ë¯## 
UL


	)

298 
	#UINT64_C
(
c
Ë¯## 
ULL


	)

302 #i‡
__WORDSIZE
 == 64

303 
	#INTMAX_C
(
c
Ë¯## 
L


	)

304 
	#UINTMAX_C
(
c
Ë¯## 
UL


	)

306 
	#INTMAX_C
(
c
Ë¯## 
LL


	)

307 
	#UINTMAX_C
(
c
Ë¯## 
ULL


	)

	@/usr/include/time.h

22 #i‚def 
_TIME_H


24 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

25 ! 
deföed
 
	g__√ed_time•ec
)

26 
	#_TIME_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__√ed_size_t


	)

36 
	#__√ed_NULL


	)

37 
	~<°ddef.h
>

41 
	~<bôs/time.h
>

44 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


45 #i‚de‡
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

53 
	#__˛ock_t_deföed
 1

	)

55 
	~<bôs/ty≥s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__˛ock_t
 
	t˛ock_t
;

60 
	g__END_NAMESPACE_STD


61 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


62 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

66 #unde‡
__√ed_˛ock_t


68 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

69 
	#__time_t_deföed
 1

	)

71 
	~<bôs/ty≥s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ifde‡
__USE_POSIX


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde‡
__√ed_time_t


84 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

85 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

86 
	#__˛ockid_t_deföed
 1

	)

88 
	~<bôs/ty≥s.h
>

91 
__˛ockid_t
 
	t˛ockid_t
;

94 #unde‡
__˛ockid_time_t


96 #i‡!
deföed
 
__timî_t_deföed
 && \

97 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

98 
	#__timî_t_deföed
 1

	)

100 
	~<bôs/ty≥s.h
>

103 
__timî_t
 
	ttimî_t
;

106 #unde‡
__√ed_timî_t


109 #i‡(!
deföed
 
__time•ec_deföed
 \

110 && ((
deföed
 
_TIME_H
 \

111 && (
deföed
 
__USE_POSIX199309
 \

112 || 
deföed
 
__USE_ISOC11
)) \

113 || 
deföed
 
__√ed_time•ec
))

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
__sysˇŒ_¶⁄g_t
 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_MISC


146 
tm_gmtoff
;

147 c⁄° *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 c⁄° *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 #ifde‡
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

195 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

196 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

199 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

205 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

206 c⁄° *
__ª°ri˘
 
__f‹m©
,

207 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde‡
__USE_XOPEN


213 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

214 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

215 
__THROW
;

218 #ifde‡
__USE_XOPEN2K8


221 
	~<xloˇÀ.h
>

223 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

224 c⁄° *
__ª°ri˘
 
__f‹m©
,

225 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 #ifde‡
__USE_GNU


230 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

231 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

232 
__loˇÀ_t
 
__loc
Ë
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

243 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

244 
__END_NAMESPACE_STD


246 #ifde‡
__USE_POSIX


249 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

250 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

254 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

255 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

264 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

265 
__END_NAMESPACE_STD


267 #ifde‡
__USE_POSIX


272 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

273 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

277 *
__ª°ri˘
 
__buf
Ë
__THROW
;

282 *
__tz«me
[2];

283 
__daylight
;

284 
__timez⁄e
;

287 #ifdef 
__USE_POSIX


289 *
tz«me
[2];

293 
	$tz£t
 (Ë
__THROW
;

296 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


297 
daylight
;

298 
timez⁄e
;

301 #ifde‡
__USE_MISC


304 
	$°ime
 (c⁄° 
time_t
 *
__whí
Ë
__THROW
;

310 
	#__i¶óp
(
yór
) \

311 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

314 #ifde‡
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

322 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

325 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

329 #ifde‡
__USE_POSIX199309


334 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

335 
time•ec
 *
__ªmaöög
);

339 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

342 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

345 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

346 
__THROW
;

348 #ifde‡
__USE_XOPEN2K


353 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

354 c⁄° 
time•ec
 *
__ªq
,

355 
time•ec
 *
__ªm
);

358 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

363 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

364 
sigevít
 *
__ª°ri˘
 
__evp
,

365 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

368 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

371 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

372 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

373 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

376 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

377 
__THROW
;

380 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

384 #ifde‡
__USE_ISOC11


386 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__n⁄nuŒ
 ((1));

391 #ifde‡
__USE_XOPEN_EXTENDED


403 
gëd©e_îr
;

412 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

415 #ifde‡
__USE_GNU


426 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

427 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

430 
__END_DECLS


	@/usr/include/vppinfra/bitops.h

38 #i‚de‡
ö˛uded_˛ib_bô›s_h


39 
	#ö˛uded_˛ib_bô›s_h


	)

41 
	~<vµö‰a/˛ib.h
>

44 
Æways_ölöe
 
uw‹d


45 
	$cou¡_£t_bôs
 (
uw‹d
 
x
)

47 #i‡
uw‹d_bôs
 == 64

48 c⁄° 
uw‹d
 
c1
 = 0x5555555555555555;

49 c⁄° 
uw‹d
 
c2
 = 0x3333333333333333;

50 c⁄° 
uw‹d
 
c3
 = 0x0f0f0f0f0f0f0f0f;

52 c⁄° 
uw‹d
 
c1
 = 0x55555555;

53 c⁄° 
uw‹d
 
c2
 = 0x33333333;

54 c⁄° 
uw‹d
 
c3
 = 0x0f0f0f0f;

58 
x
 = x - ((x >> (
uw‹d
Ë1Ë& 
c1
);

61 
x
 = (x & 
c2
Ë+ ((x >> (
uw‹d
) 2) & c2);

64 
x
 = (x + (x >> (
uw‹d
Ë4)Ë& 
c3
;

67 
x
 = x + (x >> (
uw‹d
) 8);

68 
x
 = x + (x >> (
uw‹d
) 16);

69 #i‡
uw‹d_bôs
 == 64

70 
x
 = x + (x >> (
uw‹d
) 32);

73  
x
 & (2 * 
	`BITS
 (
uw‹d
) - 1);

74 
	}
}

79 
uw‹d
 
	mmasks
[1 + 
log2_uw‹d_bôs
];

80 } 
	tcom¥ess_maö_t
;

82 
Æways_ölöe
 

83 
	$com¥ess_öô
 (
com¥ess_maö_t
 * 
cm
, 
uw‹d
 
mask
)

85 
uw‹d
 
q
, 
m
, 
zm
, 
n
, 
i
;

87 
m
 = ~
mask
;

88 
zm
 = 
mask
;

90 
cm
->
masks
[0] = 
mask
;

91 
i
 = 0; i < 
log2_uw‹d_bôs
; i++)

93 
q
 = 
m
;

94 
m
 ^= m << 1;

95 
m
 ^= m << 2;

96 
m
 ^= m << 4;

97 
m
 ^= m << 8;

98 
m
 ^= m << 16;

99 #i‡
uw‹d_bôs
 > 32

100 
m
 ^m << (
uw‹d
) 32;

102 
cm
->
masks
[1 + 
i
] = 
n
 = (
m
 << 1Ë& 
zm
;

103 
m
 = 
q
 & ~m;

104 
q
 = 
zm
 & 
n
;

105 
zm
 = zm ^ 
q
 ^ (q >> (1 << 
i
));

107 
	}
}

109 
Æways_ölöe
 
uw‹d


110 
	$com¥ess_bôs
 (
com¥ess_maö_t
 * 
cm
, 
uw‹d
 
x
)

112 
uw‹d
 
q
, 
r
;

114 
r
 = 
x
 & 
cm
->
masks
[0];

115 
q
 = 
r
 & 
cm
->
masks
[1];

116 
r
 ^
q
 ^ (q >> 1);

117 
q
 = 
r
 & 
cm
->
masks
[2];

118 
r
 ^
q
 ^ (q >> 2);

119 
q
 = 
r
 & 
cm
->
masks
[3];

120 
r
 ^
q
 ^ (q >> 4);

121 
q
 = 
r
 & 
cm
->
masks
[4];

122 
r
 ^
q
 ^ (q >> 8);

123 
q
 = 
r
 & 
cm
->
masks
[5];

124 
r
 ^
q
 ^ (q >> 16);

125 #i‡
uw‹d_bôs
 > 32

126 
q
 = 
r
 & 
cm
->
masks
[6];

127 
r
 ^
q
 ^ (q >> (
uw‹d
) 32);

130  
r
;

131 
	}
}

133 
Æways_ölöe
 
uw‹d


134 
	$rŸ©e_À·
 (
uw‹d
 
x
, uw‹d 
i
)

136  (
x
 << 
i
Ë| (x >> (
	`BITS
 (i) - i));

137 
	}
}

139 
Æways_ölöe
 
uw‹d


140 
	$rŸ©e_right
 (
uw‹d
 
x
, uw‹d 
i
)

142  (
x
 >> 
i
Ë| (x << (
	`BITS
 (i) - i));

143 
	}
}

147 
Æways_ölöe
 
uw‹d


148 
	$√xt_wôh_ßme_numbî_of_£t_bôs
 (
uw‹d
 
x
)

150 
uw‹d
 
smÆÀ°
, 
rù∂e
, 
⁄es
;

151 
smÆÀ°
 = 
x
 & -x;

152 
rù∂e
 = 
x
 + 
smÆÀ°
;

153 
⁄es
 = 
x
 ^ 
rù∂e
;

154 
⁄es
 = o√†>> (2 + 
	`log2_fú°_£t
 (
x
));

155  
rù∂e
 | 
⁄es
;

156 
	}
}

158 
	#f‹óch_£t_bô
(
v¨
,
mask
,
body
) \

160 
uw‹d
 
_f‹óch_£t_bô_m_
##
v¨
 = (
mask
); \

161 
uw‹d
 
_f‹óch_£t_bô_f_
##
v¨
; \

162 
_f‹óch_£t_bô_m_
##
v¨
 != 0) \

164 
_f‹óch_£t_bô_f_
##
v¨
 = 
	`fú°_£t
 (
_f‹óch_£t_bô_m_
##var); \

165 
_f‹óch_£t_bô_m_
##
v¨
 ^
_f‹óch_£t_bô_f_
##var; \

166 (
v¨
Ë
	`mö_log2
 (
_f‹óch_£t_bô_f_
##var); \

167 dÿ{ 
body
; } 0); \

169 } 0)

	)

	@/usr/include/vppinfra/clib_error.h

16 #i‚de‡
ö˛uded_˛ib_îr‹_h


17 
	#ö˛uded_˛ib_îr‹_h


	)

19 
	~<vµö‰a/ty≥s.h
>

24 
u8
 *
	mwh©
;

27 c⁄° 
u8
 *
	mwhîe
;

29 
uw‹d
 
	mÊags
;

32 
™y
 
	mcode
;

33 } 
	t˛ib_îr‹_t
;

	@/usr/include/vppinfra/error_bootstrap.h

38 #i‚de‡
ö˛uded_îr‹_boŸ°øp_h


39 
	#ö˛uded_îr‹_boŸ°øp_h


	)

44 
	~<vµö‰a/˛ib.h
>

48 
	mCLIB_ERROR_FATAL
 = 1 << 0,

49 
	mCLIB_ERROR_ABORT
 = 1 << 1,

50 
	mCLIB_ERROR_WARNING
 = 1 << 2,

51 
	mCLIB_ERROR_ERRNO_VALID
 = 1 << 16,

52 
	mCLIB_ERROR_NO_RATE_LIMIT
 = 1 << 17,

56 
	#˛ib_îr‹_fun˘i⁄
 ((*Ë
__FUNCTION__
)

	)

58 #i‚de‡
CLIB_ASSERT_ENABLE


59 
	#CLIB_ASSERT_ENABLE
 (
CLIB_DEBUG
 > 0)

	)

65 
_˛ib_îr‹
 (
code
,

66 *
fun˘i⁄_«me
,

67 
uw‹d
 
löe_numbî
, *
f‹m©
, ...);

69 
	#ASSERT
(
åuth
) \

71 i‡(
CLIB_ASSERT_ENABLE
 && ! (
åuth
)) \

73 
	`_˛ib_îr‹
 (
CLIB_ERROR_ABORT
, 0, 0, \

75 
__FILE__
, \

76 (
uw‹d
Ë
__LINE__
, \

77 
˛ib_îr‹_fun˘i⁄
, \

80 } 0)

	)

82 #i‡
deföed
(
__˛™g__
)

83 
	#STATIC_ASSERT
(
åuth
,...)

	)

85 
	#STATIC_ASSERT
(
åuth
,...Ë
	`_Sètic_as£π
—ruth, 
__VA_ARGS__
)

	)

88 
	#STATIC_ASSERT_SIZEOF
(
d
, 
s
) \

89 
	`STATIC_ASSERT
 ( (
d
Ë=
s
, "Sizêo‡" #d " mu° bê" #†" byãs")

	)

92 
	#ASSERT_AND_PANIC
(
åuth
) \

94 i‡(
CLIB_ASSERT_ENABLE
 && ! (
åuth
)) \

95 
	`os_∑nic
 (); \

96 } 0)

	)

	@/usr/include/vppinfra/mheap.h

38 #i‚de‡
ö˛uded_mhóp_h


39 
	#ö˛uded_mhóp_h


	)

41 
	~<vµö‰a/vec.h
>

42 
	~<vµö‰a/îr‹.h
>

43 
	~<vµö‰a/mem.h
>

44 
	~<vµö‰a/f‹m©.h
>

48 
Æways_ölöe
 *

49 
	$mhóp_gë
 (*
v
, 
uw‹d
 
size
, uw‹d * 
off£t_ªtu∫
)

51  
	`mhóp_gë_Æig√d
 (
v
, 
size
, 0, 0, 
off£t_ªtu∫
);

52 
	}
}

59 *
mhóp_Æloc
 (*
mem‹y
, 
uw‹d
 
mem‹y_byãs
);

60 *
mhóp_Æloc_wôh_Êags
 (*
mem‹y
, 
uw‹d
 
mem‹y_byãs
, uw‹d 
Êags
);

62 
	#mhóp_‰ì
(
v
Ë(vË
	`_mhóp_‰ì
(v)

	)

63 *
_mhóp_‰ì
 (*
v
);

65 
mhóp_f‹óch
 (*
v
,

66 
	$uw‹d
 (*
func
Ë(*
¨g
, *
v
, *
ñt_d©a
,

67 
uw‹d
 
ñt_size
), *
¨g
);

70 
u8
 *
	`f‹m©_mhóp
 (u8 * 
s
, 
va_li°
 * 
va
);

73 
	`mhóp_vÆid©e
 (*
h
);

76 
uw‹d
 
	`mhóp_byãs
 (*
v
);

78 
	`mhóp_ußge
 (*
v
, 
˛ib_mem_ußge_t
 * 
ußge
);

81 
	`mhóp_åa˚
 (*
v
, 
íabÀ
);

84 
	`ã°_mhóp_maö
 (
unf‹m©_öput_t
 * 
öput
);

	@/usr/include/vppinfra/random.h

38 #i‚de‡
ö˛uded_øndom_h


39 
	#ö˛uded_øndom_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/vec.h
>

43 
	~<vµö‰a/f‹m©.h
>

68 
Æways_ölöe
 
u32


69 
	$øndom_u32
 (
u32
 * 
£ed
)

71 *
£ed
 = (1664525 * *seed) + 1013904223;

72  *
£ed
;

73 
	}
}

76 
ã°_øndom_maö
 (
unf‹m©_öput_t
 * 
öput
);

79 
Æways_ölöe
 
u32


80 
	$øndom_u32_max
 ()

83 
	}
}

85 #ifde‡
CLIB_UNIX


87 
	~<uni°d.h
>

90 
Æways_ölöe
 
uw‹d


91 
	$øndom_deÁu…_£ed
 ()

93  
	`gëpid
 ();

94 
	}
}

98 #ifde‡
CLIB_LINUX_KERNEL


100 
	~<löux/sched.h
>

103 
Æways_ölöe
 
uw‹d


104 
	$øndom_deÁu…_£ed
 ()

106  
jiffõs
;

107 
	}
}

111 #ifde‡
CLIB_STANDALONE


112 
u32
 
°™dÆ⁄e_øndom_deÁu…_£ed
;

114 
Æways_ölöe
 
u32


115 
	$øndom_deÁu…_£ed
 ()

117  
°™dÆ⁄e_øndom_deÁu…_£ed
;

118 
	}
}

125 
Æways_ölöe
 
u64


126 
	$øndom_u64
 (
u64
 * 
£ed
)

128 *
£ed
 = 6364136223846793005ULL * *seed + 1442695040888963407ULL;

129  *
£ed
;

130 
	}
}

134 
Æways_ölöe
 
uw‹d


135 
	$øndom_uw‹d
 (
u32
 * 
£ed
)

137 i‡( (
uw‹d
Ë= (
u64
))

138  
	`øndom_u64
 ((
u64
 *Ë
£ed
);

140  
	`øndom_u32
 (
£ed
);

141 
	}
}

144 
Æways_ölöe
 
f64


145 
	$øndom_f64
 (
u32
 * 
£ed
)

147  (
f64
Ë
	`øndom_u32
 (
£ed
Ë/ (f64Ë
	`øndom_u32_max
 ();

148 
	}
}

156 
Æways_ölöe
 
u8
 *

157 
	$øndom_°rög
 (
u32
 * 
£ed
, 
uw‹d
 
Àn
)

159 
u8
 *
Æphabë
 = (u8 *) "abcdefghijklmnopqrstuvwxyz";

160 
u8
 *
s
 = 0;

161 
w‹d
 
i
;

163 
	`vec_ªsize
 (
s
, 
Àn
);

164 
i
 = 0; i < 
Àn
; i++)

165 
s
[
i
] = 
Æphabë
[
	`øndom_u32
 (
£ed
) % 26];

167  
s
;

168 
	}
}

170 
f64
 
˛ib_chisqu¨e
 (
u64
 * 
vÆues
);

	@/usr/include/vppinfra/random_isaac.h

51 #i‚de‡
ö˛uded_øndom_ißac_h


52 
	#ö˛uded_øndom_ißac_h


	)

54 
	~<vµö‰a/˛ib.h
>

55 
	~<vµö‰a/f‹m©.h
>

58 
	#ISAAC_LOG2_SIZE
 (4)

	)

59 
	#ISAAC_SIZE
 (1 << 
ISAAC_LOG2_SIZE
)

	)

63 
uw‹d
 
	mmem‹y
[
ISAAC_SIZE
];

64 
uw‹d
 
	ma
, 
	mb
, 
	mc
;

65 } 
	tißac_t
;

67 
ißac
 (
ißac_t
 * 
˘x
, 
uw‹d
 * 
ªsu…s
);

68 
ißac2
 (
ißac_t
 * 
˘x
, 
uw‹d
 * 
ªsu…s
);

69 
ißac_öô
 (
ißac_t
 * 
˘x
, 
uw‹d
 * 
ªsu…s
);

71 
ã°_ißac_maö
 (
unf‹m©_öput_t
 * 
öput
);

	@/usr/include/vppinfra/string.h

38 #i‚de‡
ö˛uded_˛ib_°rög_h


39 
	#ö˛uded_˛ib_°rög_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/ve˘‹.h
>

44 #ifde‡
CLIB_LINUX_KERNEL


45 
	~<löux/°rög.h
>

48 #ifde‡
CLIB_UNIX


49 
	~<°rög.h
>

52 #ifde‡
CLIB_STANDALONE


53 
	~<vµö‰a/°™dÆ⁄e_°rög.h
>

56 #i‡
_x86_64_


57 
	~<x86öåö.h
>

61 
˛ib_memsw≠
 (*
_a
, *
_b
, 
uw‹d
 
byãs
);

67 #i‚de‡
__COVERITY__


68 #i‡
__AVX512F__


69 
	~<vµö‰a/mem˝y_avx512.h
>

70 #ñi‡
__AVX2__


71 
	~<vµö‰a/mem˝y_avx2.h
>

72 #ñi‡
__SSSE3__


73 
	~<vµö‰a/mem˝y_s£3.h
>

75 
	#˛ib_mem˝y
(
a
,
b
,
c
Ë
	`mem˝y
◊,b,c)

	)

78 
	#˛ib_mem˝y
(
a
,
b
,
c
Ë
	`mem˝y
◊,b,c)

	)

88 
°©ic_Æways_ölöe
 

89 
	$˛ib_mem˝y64_x4
 (*
d0
, *
d1
, *
d2
, *
d3
, *
s
)

91 #i‡
	`deföed
 (
__AVX512F__
)

92 
__m512i
 
r0
 = 
	`_mm512_lﬂdu_si512
 (
s
);

94 
	`_mm512_°‹eu_si512
 (
d0
, 
r0
);

95 
	`_mm512_°‹eu_si512
 (
d1
, 
r0
);

96 
	`_mm512_°‹eu_si512
 (
d2
, 
r0
);

97 
	`_mm512_°‹eu_si512
 (
d3
, 
r0
);

99 #ñi‡
	`deföed
 (
__AVX2__
)

100 
__m256i
 
r0
 = 
	`_mm256_lﬂdu_si256
 ((__m256ò*Ë(
s
 + 0 * 32));

101 
__m256i
 
r1
 = 
	`_mm256_lﬂdu_si256
 ((__m256ò*Ë(
s
 + 1 * 32));

103 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d0
 + 0 * 32), 
r0
);

104 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d0
 + 1 * 32), 
r1
);

106 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d1
 + 0 * 32), 
r0
);

107 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d1
 + 1 * 32), 
r1
);

109 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d2
 + 0 * 32), 
r0
);

110 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d2
 + 1 * 32), 
r1
);

112 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d3
 + 0 * 32), 
r0
);

113 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë(
d3
 + 1 * 32), 
r1
);

115 #ñi‡
	`deföed
 (
__SSSE3__
)

116 
__m128i
 
r0
 = 
	`_mm_lﬂdu_si128
 ((__m128ò*Ë(
s
 + 0 * 16));

117 
__m128i
 
r1
 = 
	`_mm_lﬂdu_si128
 ((__m128ò*Ë(
s
 + 1 * 16));

118 
__m128i
 
r2
 = 
	`_mm_lﬂdu_si128
 ((__m128ò*Ë(
s
 + 2 * 16));

119 
__m128i
 
r3
 = 
	`_mm_lﬂdu_si128
 ((__m128ò*Ë(
s
 + 3 * 16));

121 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d0
 + 0 * 16), 
r0
);

122 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d0
 + 1 * 16), 
r1
);

123 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d0
 + 2 * 16), 
r2
);

124 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d0
 + 3 * 16), 
r3
);

126 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d1
 + 0 * 16), 
r0
);

127 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d1
 + 1 * 16), 
r1
);

128 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d1
 + 2 * 16), 
r2
);

129 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d1
 + 3 * 16), 
r3
);

131 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d2
 + 0 * 16), 
r0
);

132 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d2
 + 1 * 16), 
r1
);

133 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d2
 + 2 * 16), 
r2
);

134 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d2
 + 3 * 16), 
r3
);

136 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d3
 + 0 * 16), 
r0
);

137 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d3
 + 1 * 16), 
r1
);

138 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d3
 + 2 * 16), 
r2
);

139 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë(
d3
 + 3 * 16), 
r3
);

142 
	`˛ib_mem˝y
 (
d0
, 
s
, 64);

143 
	`˛ib_mem˝y
 (
d1
, 
s
, 64);

144 
	`˛ib_mem˝y
 (
d2
, 
s
, 64);

145 
	`˛ib_mem˝y
 (
d3
, 
s
, 64);

147 
	}
}

	@/usr/include/vppinfra/tw_timer_template.h

16 #i‚de‡
TW_SUFFIX


17 #îr‹ dÿ
nŸ
 
ö˛ude
 
tw_timî_ãm∂©e
.
h
 
dúe˘ly


20 
	~<vµö‰a/˛ib.h
>

21 
	~<vµö‰a/poﬁ.h
>

22 
	~<vµö‰a/bôm≠.h
>

24 #i‚de‡
_twt


25 
	#_twt
(
a
,
b
Ëa##b##
_t


	)

26 
	#__twt
(
a
,
b
Ë
	`_twt
◊,b)

	)

27 
	#TWT
(
a
Ë
	`__twt
◊,
TW_SUFFIX
)

	)

29 
	#_tw
(
a
,
b
Ëa##
	)
b

30 
	#__tw
(
a
,
b
Ë
	`_tw
◊,b)

	)

31 
	#TW
(
a
Ë
	`__tw
◊,
TW_SUFFIX
)

	)

114 #i‡(
TW_TIMER_WHEELS
 != 1 && TW_TIMER_WHEELS != 2 && TW_TIMER_WHEELS != 3)

115 #îr‹ 
TW_TIMER_WHEELS
 
mu°
 
be
 1, 2 
‹
 3

121 
u32
 
	m√xt
;

122 
u32
 
	m¥ev
;

128 #i‡(
TW_TIMER_WHEELS
 == 3)

130 
u16
 
	mÁ°_rög_off£t
;

132 
u16
 
	m¶ow_rög_off£t
;

134 #i‡(
TW_TIMER_WHEELS
 == 2)

136 
u16
 
	mÁ°_rög_off£t
;

138 
u16
 
	m∑d
;

142 #i‡(
TW_OVERFLOW_VECTOR
 > 0)

143 
u64
 
	mexpú©i⁄_time
;

148 
u32
 
	mu£r_h™dÀ
;

149 } 
	tTWT
 (
	ttw_timî
);

155 #i‚de‡
__deföed_tw_timî_whìl_¶Ÿ__


156 
	#__deföed_tw_timî_whìl_¶Ÿ__


	)

160 
u32
 
	mhód_ödex
;

161 } 
	ttw_timî_whìl_¶Ÿ_t
;

165 
	mTW_TIMER_RING_FAST
,

167 
	mTW_TIMER_RING_SLOW
,

169 
	mTW_TIMER_RING_GLACIER
,

170 } 
	ttw_rög_ödex_t
;

173 
CLIB_PACKED
 (struct

175 
u8
 
timî_id
;

176 
u32
 
poﬁ_ödex
;

177 
u32
 
h™dÀ
;

178 }Ë
	tTWT
 (
	tåa˚
);

183 
TWT
 (
tw_timî
Ë* 
	mtimîs
;

186 
f64
 
	m√xt_run_time
;

189 
f64
 
	mœ°_run_time
;

192 
f64
 
	mticks_≥r_£c⁄d
;

195 
f64
 
	mtimî_öãrvÆ
;

198 
u64
 
	mcuºít_tick
;

201 
u64
 
	mfú°_expúes_tick
;

204 
u32
 
	mcuºít_ödex
[
TW_TIMER_WHEELS
];

207 
tw_timî_whìl_¶Ÿ_t
 
	mw
[
TW_TIMER_WHEELS
][
TW_SLOTS_PER_RING
];

209 #i‡
TW_OVERFLOW_VECTOR
 > 0

210 
tw_timî_whìl_¶Ÿ_t
 
	movîÊow
;

213 #i‡
TW_FAST_WHEEL_BITMAP
 > 0

215 
uw‹d
 *
	mÁ°_¶Ÿ_bôm≠
;

219 (*
	mexpúed_timî_ˇŒback
Ë(
u32
 * 
	mexpúed_timî_h™dÀs
);

222 
u32
 *
	mexpúed_timî_h™dÀs
;

225 
u32
 
	mmax_expú©i⁄s
;

228 #i‡
TW_START_STOP_TRACE_SIZE
 > 0

230 
u32
 
	måa˚_ödex
;

231 
u32
 
	måa˚_wøµed
;

232 
TWT
 (
åa˚
Ë
	måa˚s
[
TW_START_STOP_TRACE_SIZE
];

235 } 
	tTWT
 (
	ttw_timî_whìl
);

237 
u32
 
	$TW
 (
tw_timî_°¨t
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
,

238 
u32
 
poﬁ_ödex
, u32 
timî_id
, 
u64
 
öãrvÆ
);

240 
	$TW
 (
tw_timî_°›
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
, 
u32
 
h™dÀ
);

242 
	$TW
 (
tw_timî_whìl_öô
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
,

243 *
expúed_timî_ˇŒback
,

244 
f64
 
timî_öãrvÆ
, 
u32
 
max_expú©i⁄s
);

246 
	$TW
 (
tw_timî_whìl_‰ì
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
);

248 
u32
 *
	$TW
 (
tw_timî_expúe_timîs
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
, 
f64
 
now
);

249 
u32
 *
	$TW
 (
tw_timî_expúe_timîs_vec
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
, 
f64
 
now
,

250 
u32
 * 
vec
);

251 #i‡
TW_FAST_WHEEL_BITMAP


252 
u32
 
	$TW
 (
tw_timî_fú°_expúes_ö_ticks
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
);

255 #i‡
TW_START_STOP_TRACE_SIZE
 > 0

256 
	$TW
 (
tw_£¨ch_åa˚
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
, 
u32
 
h™dÀ
);

257 
	$TW
 (
tw_timî_åa˚
Ë(
	`TWT
 (
tw_timî_whìl
Ë* 
tw
, 
u32
 
timî_id
,

258 
u32
 
poﬁ_ödex
, u32 
h™dÀ
);

	@/usr/include/vppinfra/vec.h

38 #i‚de‡
ö˛uded_vec_h


39 
	#ö˛uded_vec_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/mem.h
>

43 
	~<vµö‰a/°rög.h
>

44 
	~<vµö‰a/vec_boŸ°øp.h
>

99 *
vec_ªsize_Æloˇã_mem‹y
 (*
v
,

100 
w‹d
 
Àngth_ö¸emít
,

101 
uw‹d
 
d©a_byãs
,

102 
uw‹d
 
hódî_byãs
, uw‹d 
d©a_Æign
);

114 
Æways_ölöe
 *

115 
	$_vec_ªsize
 (*
v
,

116 
w‹d
 
Àngth_ö¸emít
,

117 
uw‹d
 
d©a_byãs
, uw‹d 
hódî_byãs
, uw‹d 
d©a_Æign
)

119 
vec_hódî_t
 *
vh
 = 
	`_vec_föd
 (
v
);

120 
uw‹d
 
√w_d©a_byãs
, 
Æig√d_hódî_byãs
;

122 
Æig√d_hódî_byãs
 = 
	`vec_hódî_byãs
 (
hódî_byãs
);

124 
√w_d©a_byãs
 = 
d©a_byãs
 + 
Æig√d_hódî_byãs
;

126 i‡(
	`PREDICT_TRUE
 (
v
 != 0))

128 *
p
 = 
v
 - 
Æig√d_hódî_byãs
;

131 
	`ASSERT
 (
	`˛ib_mem_is_hóp_obje˘
 (
p
));

134 i‡(
√w_d©a_byãs
 <
	`˛ib_mem_size
 (
p
))

136 
vh
->
Àn
 +
Àngth_ö¸emít
;

137  
v
;

142  
	`vec_ªsize_Æloˇã_mem‹y
 (
v
, 
Àngth_ö¸emít
, 
d©a_byãs
,

143 
hódî_byãs
,

144 
	`˛ib_max
 ( (
vec_hódî_t
),

145 
d©a_Æign
));

146 
	}
}

158 
Æways_ölöe
 

159 
	$_vec_ªsize_wûl_ex∑nd
 (*
v
,

160 
w‹d
 
Àngth_ö¸emít
,

161 
uw‹d
 
d©a_byãs
, uw‹d 
hódî_byãs
,

162 
uw‹d
 
d©a_Æign
)

164 
uw‹d
 
√w_d©a_byãs
, 
Æig√d_hódî_byãs
;

166 
Æig√d_hódî_byãs
 = 
	`vec_hódî_byãs
 (
hódî_byãs
);

168 
√w_d©a_byãs
 = 
d©a_byãs
 + 
Æig√d_hódî_byãs
;

170 i‡(
	`PREDICT_TRUE
 (
v
 != 0))

172 *
p
 = 
v
 - 
Æig√d_hódî_byãs
;

175 
	`ASSERT
 (
	`˛ib_mem_is_hóp_obje˘
 (
p
));

178 i‡(
√w_d©a_byãs
 <
	`˛ib_mem_size
 (
p
))

182 
	}
}

191 
uw‹d
 
˛ib_mem_is_vec_h
 (*
v
, uw‹d 
hódî_byãs
);

200 
Æways_ölöe
 
uw‹d


201 
	$˛ib_mem_is_vec
 (*
v
)

203  
	`˛ib_mem_is_vec_h
 (
v
, 0);

204 
	}
}

207 
	#_v
(
v¨
Ë
_vec_
##
	)
var

221 
	#vec_ªsize_ha
(
V
,
N
,
H
,
A
) \

223 
w‹d
 
	`_v
(
n
Ë(
N
); \

224 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

225 
V
 = 
	`_vec_ªsize
 ((V), 
	`_v
(
n
), (_v(
l
Ë+ _v“)Ë*  ((V)[0]), (
H
), (
A
)); \

226 } 0)

	)

237 
	#vec_ªsize
(
V
,
N
Ë
	`vec_ªsize_ha
(V,N,0,0)

	)

250 
	#vec_ªsize_Æig√d
(
V
,
N
,
A
Ë
	`vec_ªsize_ha
(V,N,0,A)

	)

261 
	#vec_Æloc_ha
(
V
,
N
,
H
,
A
) \

263 
uw‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

264 
	`vec_ªsize_ha
 (
V
, 
N
, 
H
, 
A
); \

265 
	`_vec_Àn
 (
V
Ë
	`_v
(
l
); \

266 } 0)

	)

275 
	#vec_Æloc
(
V
,
N
Ë
	`vec_Æloc_ha
(V,N,0,0)

	)

284 
	#vec_Æloc_Æig√d
(
V
,
N
,
A
Ë
	`vec_Æloc_ha
(V,N,0,A)

	)

293 
	#vec_√w_ha
(
T
,
N
,
H
,
A
) \

295 
w‹d
 
	`_v
(
n
Ë(
N
); \

296 
	`_vec_ªsize
 ((
T
 *Ë0, 
	`_v
(
n
), _v“Ë*  (T), (
H
), (
A
)); \

297 })

	)

306 
	#vec_√w
(
T
,
N
Ë
	`vec_√w_ha
(T,N,0,0)

	)

315 
	#vec_√w_Æig√d
(
T
,
N
,
A
Ë
	`vec_√w_ha
(T,N,0,A)

	)

323 
	#vec_‰ì_h
(
V
,
H
) \

325 i‡(
V
) \

327 
	`˛ib_mem_‰ì
 (
	`vec_hódî
 ((
V
), (
H
))); \

328 
V
 = 0; \

330 } 0)

	)

336 
	#vec_‰ì
(
V
Ë
	`vec_‰ì_h
(V,0)

	)

342 
	#vec_‰ì_hódî
(
h
Ë
	`˛ib_mem_‰ì
 (h)

	)

353 
	#vec_dup_ha
(
V
,
H
,
A
) \

355 
	`__ty≥of__
 ((
V
)[0]Ë* 
	`_v
(
v
) = 0; \

356 
uw‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

357 i‡(
	`_v
(
l
) > 0) \

359 
	`vec_ªsize_ha
 (
	`_v
(
v
), _v(
l
), (
H
), (
A
)); \

360 
	`˛ib_mem˝y
 (
	`_v
(
v
), (
V
), _v(
l
) *  ((V)[0]));\

362 
	`_v
(
v
); \

363 })

	)

370 
	#vec_dup
(
V
Ë
	`vec_dup_ha
(V,0,0)

	)

379 
	#vec_dup_Æig√d
(
V
,
A
Ë
	`vec_dup_ha
(V,0,A)

	)

387 
	#vec_c›y
(
DST
,
SRC
Ë
	`˛ib_mem˝y
 (DST, SRC, 
	`vec_Àn
 (DST) * \

388  ((
DST
)[0]))

	)

396 
	#vec_˛⁄e
(
NEW_V
,
OLD_V
) \

398 (
NEW_V
) = 0; \

399 (
NEW_V
Ë
	`_vec_ªsize
 ((NEW_V), 
	`vec_Àn
 (
OLD_V
), \

400 
	`vec_Àn
 (
OLD_V
Ë*  ((
NEW_V
)[0]), (0), (0)); \

401 } 0)

	)

412 
	#vec_vÆid©e_ha
(
V
,
I
,
H
,
A
) \

414 
w‹d
 
	`_v
(
i
Ë(
I
); \

415 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

416 i‡(
	`_v
(
i
Ë>_v(
l
)) \

418 
	`vec_ªsize_ha
 ((
V
), 1 + (
	`_v
(
i
Ë- _v(
l
)), (
H
), (
A
)); \

421 
	`mem£t
 ((
V
Ë+ 
	`_v
(
l
), 0, (1 + (_v(
i
) - _v(l))) *  ((V)[0])); \

423 } 0)

	)

432 
	#vec_vÆid©e
(
V
,
I
Ë
	`vec_vÆid©e_ha
(V,I,0,0)

	)

443 
	#vec_vÆid©e_Æig√d
(
V
,
I
,
A
Ë
	`vec_vÆid©e_ha
(V,I,0,A)

	)

455 
	#vec_vÆid©e_öô_em±y_ha
(
V
,
I
,
INIT
,
H
,
A
) \

457 
w‹d
 
	`_v
(
i
Ë(
I
); \

458 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

459 i‡(
	`_v
(
i
Ë>_v(
l
)) \

461 
	`vec_ªsize_ha
 ((
V
), 1 + (
	`_v
(
i
Ë- _v(
l
)), (
H
), (
A
)); \

462 
	`_v
(
l
Ë<_v(
i
)) \

464 (
V
)[
	`_v
(
l
)] = (
INIT
); \

465 
	`_v
(
l
)++; \

468 } 0)

	)

481 
	#vec_vÆid©e_öô_em±y
(
V
,
I
,
INIT
) \

482 
	`vec_vÆid©e_öô_em±y_ha
(
V
,
I
,
INIT
,0,0)

	)

494 
	#vec_vÆid©e_öô_em±y_Æig√d
(
V
,
I
,
INIT
,
A
) \

495 
	`vec_vÆid©e_öô_em±y_ha
(
V
,
I
,
INIT
,0,
A
)

	)

505 
	#vec_add1_ha
(
V
,
E
,
H
,
A
) \

507 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

508 
V
 = 
	`_vec_ªsize
 ((V), 1, (
	`_v
(
l
Ë+ 1Ë*  ((V)[0]), (
H
), (
A
)); \

509 (
V
)[
	`_v
(
l
)] = (
E
); \

510 } 0)

	)

518 
	#vec_add1
(
V
,
E
Ë
	`vec_add1_ha
(V,E,0,0)

	)

528 
	#vec_add1_Æig√d
(
V
,
E
,
A
Ë
	`vec_add1_ha
(V,E,0,A)

	)

540 
	#vec_add2_ha
(
V
,
P
,
N
,
H
,
A
) \

542 
w‹d
 
	`_v
(
n
Ë(
N
); \

543 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

544 
V
 = 
	`_vec_ªsize
 ((V), 
	`_v
(
n
), (_v(
l
Ë+ _v“)Ë*  ((V)[0]), (
H
), (
A
)); \

545 
P
 = (
V
Ë+ 
	`_v
(
l
); \

546 } 0)

	)

557 
	#vec_add2
(
V
,
P
,
N
Ë
	`vec_add2_ha
(V,P,N,0,0)

	)

569 
	#vec_add2_Æig√d
(
V
,
P
,
N
,
A
Ë
	`vec_add2_ha
(V,P,N,0,A)

	)

580 
	#vec_add_ha
(
V
,
E
,
N
,
H
,
A
) \

582 
w‹d
 
	`_v
(
n
Ë(
N
); \

583 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

584 
V
 = 
	`_vec_ªsize
 ((V), 
	`_v
(
n
), (_v(
l
Ë+ _v“)Ë*  ((V)[0]), (
H
), (
A
)); \

585 
	`˛ib_mem˝y
 ((
V
Ë+ 
	`_v
(
l
), (
E
), _v(
n
) *  ((V)[0])); \

586 } 0)

	)

595 
	#vec_add
(
V
,
E
,
N
Ë
	`vec_add_ha
(V,E,N,0,0)

	)

605 
	#vec_add_Æig√d
(
V
,
E
,
N
,
A
Ë
	`vec_add_ha
(V,E,N,0,A)

	)

612 
	#vec_p›
(
V
) \

614 
uw‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

615 
	`ASSERT
 (
	`_v
(
l
) > 0); \

616 
	`_v
(
l
) -= 1; \

617 
	`_vec_Àn
 (
V
Ë
	`_v
 (
l
); \

618 (
V
)[
	`_v
(
l
)]; \

619 })

	)

628 
	#vec_p›2
(
V
,
E
) \

630 
uw‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

631 i‡(
	`_v
(
l
Ë> 0Ë(
E
Ë
	`vec_p›
 (
V
); \

632 
	`_v
(
l
) > 0; \

633 })

	)

646 
	#vec_ö£π_öô_em±y_ha
(
V
,
N
,
M
,
INIT
,
H
,
A
) \

648 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

649 
w‹d
 
	`_v
(
n
Ë(
N
); \

650 
w‹d
 
	`_v
(
m
Ë(
M
); \

651 
V
 = 
	`_vec_ªsize
 ((V), \

652 
	`_v
(
n
), \

653 (
	`_v
(
l
Ë+ _v(
n
))*((
V
)[0]), \

654 (
H
), (
A
)); \

655 
	`ASSERT
 (
	`_v
(
m
Ë<_v(
l
)); \

656 
	`memmove
 ((
V
Ë+ 
	`_v
(
m
Ë+ _v(
n
), \

657 (
V
Ë+ 
	`_v
(
m
), \

658 (
	`_v
(
l
Ë- _v(
m
)Ë*  ((
V
)[0])); \

659 
	`mem£t
 ((
V
Ë+ 
	`_v
(
m
), 
INIT
, _v(
n
) *  ((V)[0])); \

660 } 0)

	)

672 
	#vec_ö£π_ha
(
V
,
N
,
M
,
H
,
A
Ë
	`vec_ö£π_öô_em±y_ha
(V,N,M,0,H,A)

	)

682 
	#vec_ö£π
(
V
,
N
,
M
Ë
	`vec_ö£π_ha
(V,N,M,0,0)

	)

693 
	#vec_ö£π_Æig√d
(
V
,
N
,
M
,
A
Ë
	`vec_ö£π_ha
(V,N,M,0,A)

	)

705 
	#vec_ö£π_öô_em±y
(
V
,
N
,
M
,
INIT
) \

706 
	`vec_ö£π_öô_em±y_ha
(
V
,
N
,
M
,
INIT
,0,0)

	)

719 
	#vec_ö£π_öô_em±y_Æig√d
(
V
,
N
,
M
,
INIT
,
A
) \

720 
	`vec_ö£π_öô_em±y_ha
(
V
,
N
,
M
,
INIT
,0,
A
)

	)

734 
	#vec_ö£π_ñts_ha
(
V
,
E
,
N
,
M
,
H
,
A
) \

736 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

737 
w‹d
 
	`_v
(
n
Ë(
N
); \

738 
w‹d
 
	`_v
(
m
Ë(
M
); \

739 
V
 = 
	`_vec_ªsize
 ((V), \

740 
	`_v
(
n
), \

741 (
	`_v
(
l
Ë+ _v(
n
))*((
V
)[0]), \

742 (
H
), (
A
)); \

743 
	`ASSERT
 (
	`_v
(
m
Ë<_v(
l
)); \

744 
	`memmove
 ((
V
Ë+ 
	`_v
(
m
Ë+ _v(
n
), \

745 (
V
Ë+ 
	`_v
(
m
), \

746 (
	`_v
(
l
Ë- _v(
m
)Ë*  ((
V
)[0])); \

747 
	`˛ib_mem˝y
 ((
V
Ë+ 
	`_v
(
m
), (
E
), \

748 
	`_v
(
n
Ë*  ((
V
)[0])); \

749 } 0)

	)

760 
	#vec_ö£π_ñts
(
V
,
E
,
N
,
M
Ë
	`vec_ö£π_ñts_ha
(V,E,N,M,0,0)

	)

772 
	#vec_ö£π_ñts_Æig√d
(
V
,
E
,
N
,
M
,
A
Ë
	`vec_ö£π_ñts_ha
(V,E,N,M,0,A)

	)

781 
	#vec_dñëe
(
V
,
N
,
M
) \

783 
w‹d
 
	`_v
(
l
Ë
	`vec_Àn
 (
V
); \

784 
w‹d
 
	`_v
(
n
Ë(
N
); \

785 
w‹d
 
	`_v
(
m
Ë(
M
); \

787 i‡(
	`_v
(
l
Ë- _v(
n
Ë- _v(
m
) > 0) \

788 
	`memmove
 ((
V
Ë+ 
	`_v
(
m
), (VË+ _v(mË+ _v(
n
), \

789 (
	`_v
(
l
Ë- _v(
n
Ë- _v(
m
)Ë*  ((
V
)[0])); \

791 i‡(
	`_v
(
n
) > 0) \

792 
	`mem£t
 ((
V
Ë+ 
	`_v
(
l
Ë- _v(
n
), 0, _v(n) *  ((V)[0])); \

793 
	`_vec_Àn
 (
V
Ë-
	`_v
(
n
); \

794 } 0)

	)

801 
	#vec_dñ1
(
v
,
i
) \

803 
uw‹d
 
_vec_dñ_l
 = 
	`_vec_Àn
 (
v
) - 1; \

804 
uw‹d
 
_vec_dñ_i
 = (
i
); \

805 i‡(
_vec_dñ_i
 < 
_vec_dñ_l
) \

806 (
v
)[
_vec_dñ_i
] = (v)[
_vec_dñ_l
]; \

807 
	`_vec_Àn
 (
v
Ë
_vec_dñ_l
; \

808 } 0)

	)

815 
	#vec_≠≥nd
(
v1
,
v2
) \

817 
uw‹d
 
	`_v
(
l1
Ë
	`vec_Àn
 (
v1
); \

818 
uw‹d
 
	`_v
(
l2
Ë
	`vec_Àn
 (
v2
); \

820 
v1
 = 
	`_vec_ªsize
 ((v1), 
	`_v
(
l2
), \

821 (
	`_v
(
l1
Ë+ _v(
l2
)Ë*  ((
v1
)[0]), 0, 0); \

822 
	`˛ib_mem˝y
 ((
v1
Ë+ 
	`_v
(
l1
), (
v2
), _v(
l2
) *  ((v2)[0])); \

823 } 0)

	)

831 
	#vec_≠≥nd_Æig√d
(
v1
,
v2
,
Æign
) \

833 
uw‹d
 
	`_v
(
l1
Ë
	`vec_Àn
 (
v1
); \

834 
uw‹d
 
	`_v
(
l2
Ë
	`vec_Àn
 (
v2
); \

836 
v1
 = 
	`_vec_ªsize
 ((v1), 
	`_v
(
l2
), \

837 (
	`_v
(
l1
Ë+ _v(
l2
)Ë*  ((
v1
)[0]), 0, 
Æign
); \

838 
	`˛ib_mem˝y
 ((
v1
Ë+ 
	`_v
(
l1
), (
v2
), _v(
l2
) *  ((v2)[0])); \

839 } 0)

	)

846 
	#vec_¥ïíd
(
v1
,
v2
) \

848 
uw‹d
 
	`_v
(
l1
Ë
	`vec_Àn
 (
v1
); \

849 
uw‹d
 
	`_v
(
l2
Ë
	`vec_Àn
 (
v2
); \

851 
v1
 = 
	`_vec_ªsize
 ((v1), 
	`_v
(
l2
), \

852 (
	`_v
(
l1
Ë+ _v(
l2
)Ë*  ((
v1
)[0]), 0, 0); \

853 
	`memmove
 ((
v1
Ë+ 
	`_v
(
l2
), (v1), _v(
l1
) *  ((v1)[0])); \

854 
	`˛ib_mem˝y
 ((
v1
), (
v2
), 
	`_v
(
l2
) *  ((v2)[0])); \

855 } 0)

	)

863 
	#vec_¥ïíd_Æig√d
(
v1
,
v2
,
Æign
) \

865 
uw‹d
 
	`_v
(
l1
Ë
	`vec_Àn
 (
v1
); \

866 
uw‹d
 
	`_v
(
l2
Ë
	`vec_Àn
 (
v2
); \

868 
v1
 = 
	`_vec_ªsize
 ((v1), 
	`_v
(
l2
), \

869 (
	`_v
(
l1
Ë+ _v(
l2
)Ë*  ((
v1
)[0]), 0, 
Æign
); \

870 
	`memmove
 ((
v1
Ë+ 
	`_v
(
l2
), (v1), _v(
l1
) *  ((v1)[0])); \

871 
	`˛ib_mem˝y
 ((
v1
), (
v2
), 
	`_v
(
l2
) *  ((v2)[0])); \

872 } 0)

	)

878 
	#vec_zîo
(
v¨
) \

880 i‡(
v¨
) \

881 
	`mem£t
 ((
v¨
), 0, 
	`vec_Àn
 (var) *  ((var)[0])); \

882 } 0)

	)

888 
	#vec_£t
(
v
,
vÆ
) \

890 
w‹d
 
	`_v
(
i
); \

891 
	`__ty≥of__
 ((
v
)[0]Ë
_vÆ
 = (
vÆ
); \

892 
	`_v
(
i
Ë0; _v(iË< 
	`vec_Àn
 (
v
); _v(i)++) \

893 (
v
)[
	`_v
(
i
)] = 
_vÆ
; \

894 } 0)

	)

896 #ifde‡
CLIB_UNIX


897 
	~<°dlib.h
>

906 
	#vec_is_equÆ
(
v1
,
v2
) \

907 (
	`vec_Àn
 (
v1
Ë=vec_À¿(
v2
Ë&& ! 
	`memcmp
 ((v1), (v2), vec_À¿(v1Ë*  ((v1)[0])))

	)

916 
	#vec_cmp
(
v1
,
v2
) \

918 
w‹d
 
	`_v
(
i
), _v(
cmp
), _v(
l
); \

919 
	`_v
(
l
Ë
	`˛ib_mö
 (
	`vec_Àn
 (
v1
), vec_À¿(
v2
)); \

920 
	`_v
(
cmp
) = 0; \

921 
	`_v
(
i
Ë0; _v(iË< _v(
l
); _v(i)++) { \

922 
	`_v
(
cmp
Ë(
v1
)[_v(
i
)] - (
v2
)[_v(i)]; \

923 i‡(
	`_v
(
cmp
)) \

926 i‡(
	`_v
(
cmp
Ë=0 && _v(
l
) > 0) \

927 
	`_v
(
cmp
Ë
	`vec_Àn
(
v1
Ë- vec_Àn(
v2
); \

928 (
	`_v
(
cmp
) < 0 ? -1 : (_v(cmp) > 0 ? +1 : 0)); \

929 })

	)

937 
	#vec_£¨ch
(
v
,
E
) \

939 
w‹d
 
	`_v
(
i
) = 0; \

940 
	`_v
(
i
Ë< 
	`vec_Àn
(
v
)) \

942 i‡((
v
)[
	`_v
(
i
)] =
E
) \

944 
	`_v
(
i
)++; \

946 i‡(
	`_v
(
i
Ë=
	`vec_Àn
(
v
)) \

947 
	`_v
(
i
) = ~0; \

948 
	`_v
(
i
); \

949 })

	)

956 
	#vec_s‹t_wôh_fun˘i⁄
(
vec
,
f
) \

958 
	`qs‹t
 (
vec
, 
	`vec_Àn
 (vec),  (vec[0]), (*Ë(
f
)); \

959 } 0)

	)

967 
	#vec_vÆid©e_öô_c_°rög
(
V
, 
S
, 
L
) \

969 
	`vec_ª£t_Àngth
 (
V
); \

970 
	`vec_vÆid©e
 ((
V
), (
L
)); \

971 i‡((
S
Ë&& (
L
)) \

972 
	`˛ib_mem˝y
 ((
V
), (
S
), (
L
)); \

973 (
V
)[(
L
)] = 0; \

974 } 0)

	)

982 
	#vec_c_°rög_is_ãrmö©ed
(
V
) \

983 (((
V
Ë!0Ë&& (
	`vec_Àn
 (VË!0Ë&& ((V)[vec_À¿((V)Ë- 1] =0))

	)

990 
	#vec_ãrmö©e_c_°rög
(
V
) \

992 
u32
 
vl
 = 
	`vec_Àn
 ((
V
)); \

993 i‡(!
	`vec_c_°rög_is_ãrmö©ed
(
V
)) \

995 
	`vec_vÆid©e
 ((
V
), 
vl
); \

996 (
V
)[
vl
] = 0; \

998 } 0)

	)

	@/usr/include/vppinfra/vector_altivec.h

38 #i‚de‡
ö˛uded_ve˘‹_Ætivec_h


39 
	#ö˛uded_ve˘‹_Ætivec_h


	)

42 
	#_
(
t
,
ti
,
Ã
,
f
) \

43 
Æways_ölöe
 
t
Å##
_
##
	`Ã
 (à
x
,Å 
y
) \

44 {  (
t
Ë
__buûtö_Ætivec_
##
	`f
 ((
ti
Ë
x
, (tiË
y
); } \

46 
Æways_ölöe
 
t
Å##
_i
##
	`Ã
 (à
x
, 
i
) \

48 
t
 
j
 = {
i
,i,i,i}; \

49  
t
##
_
##
	`Ã
 (
x
, 
j
); \

50 }

	)

52 
_
(
u16x8
, 
i16x8
, 
shi·_À·
, 
v¶h
);

53 
_
(
u32x4
, 
i32x4
, 
shi·_À·
, 
v¶w
);

54 
_
(
u16x8
, 
i16x8
, 
shi·_right
, 
v§h
);

55 
_
(
u32x4
, 
i32x4
, 
shi·_right
, 
v§w
);

56 
_
(
i16x8
, i16x8, 
shi·_right
, 
v§ah
);

57 
_
(
i32x4
, i32x4, 
shi·_right
, 
v§aw
);

58 
_
(
u16x8
, 
i16x8
, 
rŸ©e_À·
, 
væh
);

59 
_
(
i16x8
, i16x8, 
rŸ©e_À·
, 
væh
);

60 
_
(
u32x4
, 
i32x4
, 
rŸ©e_À·
, 
væw
);

61 
_
(
i32x4
, i32x4, 
rŸ©e_À·
, 
væw
);

63 #unde‡
_


65 
	#_
(
t
,
ô
,
Ã
,
f
) \

66 
Æways_ölöe
 
t
Å##
_w‹d_shi·_
##
	`Ã
 (à
x
, 
n_w‹ds
) \

68 
i32x4
 
n_bôs
 = {0,0,0,
n_w‹ds
 * 
	`BITS
 (
ô
)}; \

69  (
t
Ë
__buûtö_Ætivec_
##
	`f
 ((
i32x4
Ë
x
, 
n_bôs
); \

70 }

	)

72 
	$_
(
u32x4
, 
u32
, 
À·
, 
v¶o
)

73 
	$_
(
i32x4
, 
i32
, 
À·
, 
v¶o
)

74 
	$_
(
u32x4
, 
u32
, 
right
, 
v§o
)

75 
	$_
(
i32x4
, 
i32
, 
right
, 
v§o
)

76 
	$_
(
u16x8
, 
u16
, 
À·
, 
v¶o
)

77 
	$_
(
i16x8
, 
i16
, 
À·
, 
v¶o
)

78 
	$_
(
u16x8
, 
u16
, 
right
, 
v§o
Ë
	$_
(
i16x8
, 
i16
, 
right
, 
v§o
)

79 #unde‡
_


80 
Æways_ölöe


81 
u32


82 
	$u32x4_gë0
 (
u32x4
 
x
)

84 
u32x4_uni⁄_t
 
y
;

85 
y
.
as_u32x4
 = 
x
;

86  
y
.
as_u32
[3];

87 
	}
}

90 
	#_
(
t
,
ô
,
lh
,
f
) \

91 
Æways_ölöe
 
t
Å##
_öãæóve_
##
	`lh
 (à
x
,Å 
y
) \

92 {  (
t
Ë
__buûtö_Ætivec_
##
	`f
 ((
ô
Ë
x
, (ôË
y
); }

	)

94 
	$_
(
u32x4
, 
i32x4
, 
lo
, 
vmrglw
)

95 
	$_
(
i32x4
, i32x4, 
lo
, 
vmrglw
)

96 
	$_
(
u16x8
, 
i16x8
, 
lo
, 
vmrglh
)

97 
	$_
(
i16x8
, i16x8, 
lo
, 
vmrglh
)

98 
	$_
(
u32x4
, 
i32x4
, 
hi
, 
vmrghw
)

99 
	$_
(
i32x4
, i32x4, 
hi
, 
vmrghw
)

100 
	$_
(
u16x8
, 
i16x8
, 
hi
, 
vmrghh
Ë
	$_
(
i16x8
, i16x8, 
hi
, 
vmrghh
)

101 #unde‡
_


103 #i‚de‡
__˝lu•lus


104 
	#_
(
t
) \

105 
Æways_ölöe
 
t
##
	`_°‹e_u«lig√d
 (à
x
,Å * 
a
) \

106 { 
	`˛ib_mem_u«lig√d
 (
a
, 
t
Ë
x
; 
	}
} \

107 
Æways_ölöe
 
t
Å##
	`_lﬂd_u«lig√d
 (à* 
a
) \

108 {  
	`˛ib_mem_u«lig√d
 (
a
, 
t
); }

	)

109 
	$_
(
u8x16
Ë
	$_
(
u16x8
Ë
	$_
(
u32x4
Ë
	$_
(
u64x2
Ë
	$_
(
i8x16
Ë
	$_
(
i16x8
Ë
	$_
(
i32x4
Ë
	$_
(
i64x2
)

110 #unde‡
_


112 
	#_sig√d_bö›
(
n
,
m
,
f
,
g
) \

114 
Æways_ölöe
 
u
##
n
##
x
##
m
 \

115 
u
##
n
##
x
##
m
##
_
##
	`f
 (u##n##x##m x, u##n##x##m 
y
) \

116 {  (
u
##
n
##
x
##
m
Ë
__buûtö_Ætivec_
##
	`g
 ((
i
##n##x##mËx, (i##n##x##mË
y
); 
	}
} \

119 
Æways_ölöe
 
i
##
n
##
x
##
m
 \

120 
i
##
n
##
x
##
m
##
_
##
	`f
 (i##n##x##m x, i##n##x##m 
y
) \

121 {  (
i
##
n
##
x
##
m
Ë
__buûtö_Ætivec_
##
	`g
 ((i##n##x##mËx, (i##n##x##mË
y
); }

	)

123 
	$_sig√d_bö›
 (16, 8, 
is_equÆ
, 
vcm≥quh
)

124 
	$_sig√d_bö›
 (32, 4, 
is_equÆ
, 
vcm≥quw
)

125 #unde‡
_sig√d_bö›


126 
Æways_ölöe
 
u16x8
 
	$u16x8_is_zîo
 (
u16x8
 
x
)

128 
u16x8
 
zîo
 = { 0 };

129  
	`u16x8_is_equÆ
 (
x
, 
zîo
);

130 
	}
}

132 
Æways_ölöe
 
u32


133 
	$u32x4_zîo_byã_mask
 (
u32x4
 
x
)

135 
u32x4
 
cmp
 = 
	`u32x4_is_zîo
 (
x
);

136 
u32x4
 
tmp
 = { 0x000f, 0x00f0, 0x0f00, 0xf000, };

137 
cmp
 &
tmp
;

138 
cmp
 |
	`u32x4_w‹d_shi·_right
 (cmp, 2);

139 
cmp
 |
	`u32x4_w‹d_shi·_right
 (cmp, 1);

140  
	`u32x4_gë0
 (
cmp
);

141 
	}
}

	@/usr/include/vppinfra/vector_funcs.h

38 #i‚de‡
ö˛uded_ve˘‹_funcs_h


39 
	#ö˛uded_ve˘‹_funcs_h


	)

41 
	~<vµö‰a/byã_‹dî.h
>

44 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

45 
	#u8x_add
 
u8x16_add


	)

46 
	#u16x_add
 
u16x8_add


	)

47 
	#u32x_add
 
u32x4_add


	)

48 
	#u64x_add
 
u64x2_add


	)

49 
	#i8x_add
 
i8x16_add


	)

50 
	#i16x_add
 
i16x8_add


	)

51 
	#i32x_add
 
i32x4_add


	)

52 
	#i64x_add
 
i64x2_add


	)

53 
	#u8x_sub
 
u8x16_sub


	)

54 
	#u16x_sub
 
u16x8_sub


	)

55 
	#u32x_sub
 
u32x4_sub


	)

56 
	#u64x_sub
 
u64x2_sub


	)

57 
	#i8x_sub
 
i8x16_sub


	)

58 
	#i16x_sub
 
i16x8_sub


	)

59 
	#i32x_sub
 
i32x4_sub


	)

60 
	#i64x_sub
 
i64x2_sub


	)

63 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

64 
	#u8x_add
 
u8x8_add


	)

65 
	#u16x_add
 
u16x4_add


	)

66 
	#u32x_add
 
u32x2_add


	)

67 
	#i8x_add
 
i8x8_add


	)

68 
	#i16x_add
 
i16x4_add


	)

69 
	#i32x_add
 
i32x2_add


	)

70 
	#u8x_sub
 
u8x8_sub


	)

71 
	#u16x_sub
 
u16x4_sub


	)

72 
	#u32x_sub
 
u32x2_sub


	)

73 
	#i8x_sub
 
i8x8_sub


	)

74 
	#i16x_sub
 
i16x4_sub


	)

75 
	#i32x_sub
 
i32x2_sub


	)

79 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

80 
	#u8x_add_ßtuøã
 
u8x16_add_ßtuøã


	)

81 
	#u16x_add_ßtuøã
 
u16x8_add_ßtuøã


	)

82 
	#i8x_add_ßtuøã
 
i8x16_add_ßtuøã


	)

83 
	#i16x_add_ßtuøã
 
i16x8_add_ßtuøã


	)

84 
	#u8x_sub_ßtuøã
 
u8x16_sub_ßtuøã


	)

85 
	#u16x_sub_ßtuøã
 
u16x8_sub_ßtuøã


	)

86 
	#i8x_sub_ßtuøã
 
i8x16_sub_ßtuøã


	)

87 
	#i16x_sub_ßtuøã
 
i16x8_sub_ßtuøã


	)

90 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

91 
	#u8x_add_ßtuøã
 
u8x8_add_ßtuøã


	)

92 
	#u16x_add_ßtuøã
 
u16x4_add_ßtuøã


	)

93 
	#i8x_add_ßtuøã
 
i8x8_add_ßtuøã


	)

94 
	#i16x_add_ßtuøã
 
i16x4_add_ßtuøã


	)

95 
	#u8x_sub_ßtuøã
 
u8x8_sub_ßtuøã


	)

96 
	#u16x_sub_ßtuøã
 
u16x4_sub_ßtuøã


	)

97 
	#i8x_sub_ßtuøã
 
i8x8_sub_ßtuøã


	)

98 
	#i16x_sub_ßtuøã
 
i16x4_sub_ßtuøã


	)

101 
	#_ve˘‹_öãæóve
(
a
,
b
,
t
) \

103 
t
 
_tmp_lo
 =Å##
	`_öãæóve_lo
 (
a
, 
b
); \

104 
t
 
_tmp_hi
 =Å##
	`_öãæóve_hi
 (
a
, 
b
); \

105 i‡(
CLIB_ARCH_IS_LITTLE_ENDIAN
) \

106 (
a
Ë
_tmp_lo
, (
b
Ë
_tmp_hi
; \

108 (
a
Ë
_tmp_hi
, (
b
Ë
_tmp_lo
; \

109 } 0)

	)

112 
	#u8x16_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u8x16
)

	)

113 
	#i8x16_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i8x16
)

	)

114 
	#u16x8_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u16x8
)

	)

115 
	#i16x8_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i16x8
)

	)

116 
	#u32x4_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u32x4
)

	)

117 
	#i32x4_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i32x4
)

	)

118 
	#u64x2_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u64x2
)

	)

119 
	#i64x2_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i64x2
)

	)

122 
	#u8x8_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u8x8
)

	)

123 
	#i8x8_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i8x8
)

	)

124 
	#u16x4_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u16x4
)

	)

125 
	#i16x4_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i16x4
)

	)

126 
	#u32x2_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
u32x2
)

	)

127 
	#i32x2_öãæóve
(
a
,
b
Ë
	`_ve˘‹_öãæóve
◊,b,
i32x2
)

	)

130 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

131 
	#u8x_öãæóve
 
u8x16_öãæóve


	)

132 
	#u16x_öãæóve
 
u16x8_öãæóve


	)

133 
	#u32x_öãæóve
 
u32x4_öãæóve


	)

134 
	#u64x_öãæóve
 
u64x2_öãæóve


	)

137 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

138 
	#u8x_öãæóve
 
u8x8_öãæóve


	)

139 
	#u16x_öãæóve
 
u16x4_öãæóve


	)

140 
	#u32x_öãæóve
 
u32x2_öãæóve


	)

141 
	#u64x_öãæóve
(
a
,
b
Ë

	)

145 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

146 
	#u8x_shi·_À·
 
u8x16_shi·_À·


	)

147 
	#i8x_shi·_À·
 
i8x16_shi·_À·


	)

148 
	#u16x_shi·_À·
 
u16x8_shi·_À·


	)

149 
	#i16x_shi·_À·
 
i16x8_shi·_À·


	)

150 
	#u32x_shi·_À·
 
u32x4_shi·_À·


	)

151 
	#i32x_shi·_À·
 
i32x4_shi·_À·


	)

152 
	#u64x_shi·_À·
 
u64x2_shi·_À·


	)

153 
	#i64x_shi·_À·
 
i64x2_shi·_À·


	)

154 
	#u8x_shi·_right
 
u8x16_shi·_right


	)

155 
	#i8x_shi·_right
 
i8x16_shi·_right


	)

156 
	#u16x_shi·_right
 
u16x8_shi·_right


	)

157 
	#i16x_shi·_right
 
i16x8_shi·_right


	)

158 
	#u32x_shi·_right
 
u32x4_shi·_right


	)

159 
	#i32x_shi·_right
 
i32x4_shi·_right


	)

160 
	#u64x_shi·_right
 
u64x2_shi·_right


	)

161 
	#i64x_shi·_right
 
i64x2_shi·_right


	)

162 
	#u8x_rŸ©e_À·
 
u8x16_rŸ©e_À·


	)

163 
	#i8x_rŸ©e_À·
 
i8x16_rŸ©e_À·


	)

164 
	#u16x_rŸ©e_À·
 
u16x8_rŸ©e_À·


	)

165 
	#i16x_rŸ©e_À·
 
i16x8_rŸ©e_À·


	)

166 
	#u32x_rŸ©e_À·
 
u32x4_rŸ©e_À·


	)

167 
	#i32x_rŸ©e_À·
 
i32x4_rŸ©e_À·


	)

168 
	#u64x_rŸ©e_À·
 
u64x2_rŸ©e_À·


	)

169 
	#i64x_rŸ©e_À·
 
i64x2_rŸ©e_À·


	)

170 
	#u8x_rŸ©e_right
 
u8x16_rŸ©e_right


	)

171 
	#i8x_rŸ©e_right
 
i8x16_rŸ©e_right


	)

172 
	#u16x_rŸ©e_right
 
u16x8_rŸ©e_right


	)

173 
	#i16x_rŸ©e_right
 
i16x8_rŸ©e_right


	)

174 
	#u32x_rŸ©e_right
 
u32x4_rŸ©e_right


	)

175 
	#i32x_rŸ©e_right
 
i32x4_rŸ©e_right


	)

176 
	#u64x_rŸ©e_right
 
u64x2_rŸ©e_right


	)

177 
	#i64x_rŸ©e_right
 
i64x2_rŸ©e_right


	)

178 
	#u8x_ishi·_À·
 
u8x16_ishi·_À·


	)

179 
	#i8x_ishi·_À·
 
i8x16_ishi·_À·


	)

180 
	#u16x_ishi·_À·
 
u16x8_ishi·_À·


	)

181 
	#i16x_ishi·_À·
 
i16x8_ishi·_À·


	)

182 
	#u32x_ishi·_À·
 
u32x4_ishi·_À·


	)

183 
	#i32x_ishi·_À·
 
i32x4_ishi·_À·


	)

184 
	#u64x_ishi·_À·
 
u64x2_ishi·_À·


	)

185 
	#i64x_ishi·_À·
 
i64x2_ishi·_À·


	)

186 
	#u8x_ishi·_right
 
u8x16_ishi·_right


	)

187 
	#i8x_ishi·_right
 
i8x16_ishi·_right


	)

188 
	#u16x_ishi·_right
 
u16x8_ishi·_right


	)

189 
	#i16x_ishi·_right
 
i16x8_ishi·_right


	)

190 
	#u32x_ishi·_right
 
u32x4_ishi·_right


	)

191 
	#i32x_ishi·_right
 
i32x4_ishi·_right


	)

192 
	#u64x_ishi·_right
 
u64x2_ishi·_right


	)

193 
	#i64x_ishi·_right
 
i64x2_ishi·_right


	)

194 
	#u8x_úŸ©e_À·
 
u8x16_úŸ©e_À·


	)

195 
	#i8x_úŸ©e_À·
 
i8x16_úŸ©e_À·


	)

196 
	#u16x_úŸ©e_À·
 
u16x8_úŸ©e_À·


	)

197 
	#i16x_úŸ©e_À·
 
i16x8_úŸ©e_À·


	)

198 
	#u32x_úŸ©e_À·
 
u32x4_úŸ©e_À·


	)

199 
	#i32x_úŸ©e_À·
 
i32x4_úŸ©e_À·


	)

200 
	#u64x_úŸ©e_À·
 
u64x2_úŸ©e_À·


	)

201 
	#i64x_úŸ©e_À·
 
i64x2_úŸ©e_À·


	)

202 
	#u8x_úŸ©e_right
 
u8x16_úŸ©e_right


	)

203 
	#i8x_úŸ©e_right
 
i8x16_úŸ©e_right


	)

204 
	#u16x_úŸ©e_right
 
u16x8_úŸ©e_right


	)

205 
	#i16x_úŸ©e_right
 
i16x8_úŸ©e_right


	)

206 
	#u32x_úŸ©e_right
 
u32x4_úŸ©e_right


	)

207 
	#i32x_úŸ©e_right
 
i32x4_úŸ©e_right


	)

208 
	#u64x_úŸ©e_right
 
u64x2_úŸ©e_right


	)

209 
	#i64x_úŸ©e_right
 
i64x2_úŸ©e_right


	)

212 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

213 
	#u8x_shi·_À·
 
u8x8_shi·_À·


	)

214 
	#i8x_shi·_À·
 
i8x8_shi·_À·


	)

215 
	#u16x_shi·_À·
 
u16x4_shi·_À·


	)

216 
	#i16x_shi·_À·
 
i16x4_shi·_À·


	)

217 
	#u32x_shi·_À·
 
u32x2_shi·_À·


	)

218 
	#i32x_shi·_À·
 
i32x2_shi·_À·


	)

219 
	#u8x_shi·_right
 
u8x8_shi·_right


	)

220 
	#i8x_shi·_right
 
i8x8_shi·_right


	)

221 
	#u16x_shi·_right
 
u16x4_shi·_right


	)

222 
	#i16x_shi·_right
 
i16x4_shi·_right


	)

223 
	#u32x_shi·_right
 
u32x2_shi·_right


	)

224 
	#i32x_shi·_right
 
i32x2_shi·_right


	)

225 
	#u8x_rŸ©e_À·
 
u8x8_rŸ©e_À·


	)

226 
	#i8x_rŸ©e_À·
 
i8x8_rŸ©e_À·


	)

227 
	#u16x_rŸ©e_À·
 
u16x4_rŸ©e_À·


	)

228 
	#i16x_rŸ©e_À·
 
i16x4_rŸ©e_À·


	)

229 
	#u32x_rŸ©e_À·
 
u32x2_rŸ©e_À·


	)

230 
	#i32x_rŸ©e_À·
 
i32x2_rŸ©e_À·


	)

231 
	#u8x_rŸ©e_right
 
u8x8_rŸ©e_right


	)

232 
	#i8x_rŸ©e_right
 
i8x8_rŸ©e_right


	)

233 
	#u16x_rŸ©e_right
 
u16x4_rŸ©e_right


	)

234 
	#i16x_rŸ©e_right
 
i16x4_rŸ©e_right


	)

235 
	#u32x_rŸ©e_right
 
u32x2_rŸ©e_right


	)

236 
	#i32x_rŸ©e_right
 
i32x2_rŸ©e_right


	)

237 
	#u8x_ishi·_À·
 
u8x8_ishi·_À·


	)

238 
	#i8x_ishi·_À·
 
i8x8_ishi·_À·


	)

239 
	#u16x_ishi·_À·
 
u16x4_ishi·_À·


	)

240 
	#i16x_ishi·_À·
 
i16x4_ishi·_À·


	)

241 
	#u32x_ishi·_À·
 
u32x2_ishi·_À·


	)

242 
	#i32x_ishi·_À·
 
i32x2_ishi·_À·


	)

243 
	#u8x_ishi·_right
 
u8x8_ishi·_right


	)

244 
	#i8x_ishi·_right
 
i8x8_ishi·_right


	)

245 
	#u16x_ishi·_right
 
u16x4_ishi·_right


	)

246 
	#i16x_ishi·_right
 
i16x4_ishi·_right


	)

247 
	#u32x_ishi·_right
 
u32x2_ishi·_right


	)

248 
	#i32x_ishi·_right
 
i32x2_ishi·_right


	)

249 
	#u8x_úŸ©e_À·
 
u8x8_úŸ©e_À·


	)

250 
	#i8x_úŸ©e_À·
 
i8x8_úŸ©e_À·


	)

251 
	#u16x_úŸ©e_À·
 
u16x4_úŸ©e_À·


	)

252 
	#i16x_úŸ©e_À·
 
i16x4_úŸ©e_À·


	)

253 
	#u32x_úŸ©e_À·
 
u32x2_úŸ©e_À·


	)

254 
	#i32x_úŸ©e_À·
 
i32x2_úŸ©e_À·


	)

255 
	#u8x_úŸ©e_right
 
u8x8_úŸ©e_right


	)

256 
	#i8x_úŸ©e_right
 
i8x8_úŸ©e_right


	)

257 
	#u16x_úŸ©e_right
 
u16x4_úŸ©e_right


	)

258 
	#i16x_úŸ©e_right
 
i16x4_úŸ©e_right


	)

259 
	#u32x_úŸ©e_right
 
u32x2_úŸ©e_right


	)

260 
	#i32x_úŸ©e_right
 
i32x2_úŸ©e_right


	)

263 #i‡
CLIB_VECTOR_WORD_BITS
 == 128

264 
	#u8x_•œt
 
u8x16_•œt


	)

265 
	#i8x_•œt
 
i8x16_•œt


	)

266 
	#u16x_•œt
 
u16x8_•œt


	)

267 
	#i16x_•œt
 
i16x8_•œt


	)

268 
	#u32x_•œt
 
u32x4_•œt


	)

269 
	#i32x_•œt
 
i32x4_•œt


	)

270 
	#u64x_•œt
 
u64x2_•œt


	)

271 
	#i64x_•œt
 
i64x2_•œt


	)

274 #i‡
CLIB_VECTOR_WORD_BITS
 == 64

275 
	#u8x_•œt
 
u8x8_•œt


	)

276 
	#i8x_•œt
 
i8x8_•œt


	)

277 
	#u16x_•œt
 
u16x4_•œt


	)

278 
	#i16x_•œt
 
i16x4_•œt


	)

279 
	#u32x_•œt
 
u32x2_•œt


	)

280 
	#i32x_•œt
 
i32x2_•œt


	)

283 
	#u32x4_å™•o£_°ï
(
x
,
y
) \

285 
u32x4
 
_x
 = (
x
); \

286 
u32x4
 
_y
 = (
y
); \

287 (
x
Ë
	`u32x4_öãæóve_lo
 (
_x
, 
_y
); \

288 (
y
Ë
	`u32x4_öãæóve_hi
 (
_x
, 
_y
); \

289 } 0)

	)

292 
	#u32x4_å™•o£
(
x0
,
x1
,
x2
,
x3
) \

294 
u32x4
 
_x0
 = (u32x4Ë(
x0
); \

295 
u32x4
 
_x1
 = (u32x4Ë(
x1
); \

296 
u32x4
 
_x2
 = (u32x4Ë(
x2
); \

297 
u32x4
 
_x3
 = (u32x4Ë(
x3
); \

298 
	`u32x4_å™•o£_°ï
 (
_x0
, 
_x2
); \

299 
	`u32x4_å™•o£_°ï
 (
_x1
, 
_x3
); \

300 
	`u32x4_å™•o£_°ï
 (
_x0
, 
_x1
); \

301 
	`u32x4_å™•o£_°ï
 (
_x2
, 
_x3
); \

302 (
x0
Ë(
u32x4
Ë
_x0
; \

303 (
x1
Ë(
u32x4
Ë
_x1
; \

304 (
x2
Ë(
u32x4
Ë
_x2
; \

305 (
x3
Ë(
u32x4
Ë
_x3
; \

306 } 0)

	)

308 
	#i32x4_å™•o£
(
x0
,
x1
,
x2
,
x3
) \

310 
u32x4
 
_x0
 = (u32x4Ë(
x0
); \

311 
u32x4
 
_x1
 = (u32x4Ë(
x1
); \

312 
u32x4
 
_x2
 = (u32x4Ë(
x2
); \

313 
u32x4
 
_x3
 = (u32x4Ë(
x3
); \

314 
	`u32x4_å™•o£_°ï
 (
_x0
, 
_x2
); \

315 
	`u32x4_å™•o£_°ï
 (
_x1
, 
_x3
); \

316 
	`u32x4_å™•o£_°ï
 (
_x0
, 
_x1
); \

317 
	`u32x4_å™•o£_°ï
 (
_x2
, 
_x3
); \

318 (
x0
Ë(
i32x4
Ë
_x0
; \

319 (
x1
Ë(
i32x4
Ë
_x1
; \

320 (
x2
Ë(
i32x4
Ë
_x2
; \

321 (
x3
Ë(
i32x4
Ë
_x3
; \

322 } 0)

	)

324 #unde‡
_


	@/usr/include/vppinfra/vector_neon.h

16 #i‚de‡
ö˛uded_ve˘‹_√⁄_h


17 
	#ö˛uded_ve˘‹_√⁄_h


	)

18 
	~<¨m_√⁄.h
>

21 
	#u16x8_sub_ßtuøã
(
a
,
b
Ë
	`vsubq_u16
◊,b)

	)

22 
	#i16x8_sub_ßtuøã
(
a
,
b
Ë
	`vsubq_s16
◊,b)

	)

24 
Æways_ölöe
 

25 
	$u8x16_is_Æl_zîo
 (
u8x16
 
x
)

27  !(
	`vaddvq_u8
 (
x
));

28 
	}
}

30 
Æways_ölöe
 

31 
	$u16x8_is_Æl_zîo
 (
u16x8
 
x
)

33  !(
	`vaddvq_u16
 (
x
));

34 
	}
}

36 
Æways_ölöe
 

37 
	$u32x4_is_Æl_zîo
 (
u32x4
 
x
)

39  !(
	`vaddvq_u32
 (
x
));

40 
	}
}

42 
Æways_ölöe
 

43 
	$u64x2_is_Æl_zîo
 (
u64x2
 
x
)

45  !(
	`vaddvq_u64
 (
x
));

46 
	}
}

49 
Æways_ölöe
 
u32


50 
	$u8x16_com∑ª_byã_mask
 (
u8x16
 
x
)

52 
uöt8x16_t
 
mask_shi·
 =

54 
uöt8x16_t
 
mask_™d
 = 
	`vdupq_n_u8
 (0x80);

55 
x
 = 
	`v™dq_u8
 (x, 
mask_™d
);

56 
x
 = 
	`vshlq_u8
 (x, 
	`vªöãΩªtq_s8_u8
 (
mask_shi·
));

57 
x
 = 
	`v∑ddq_u8
 (x, x);

58 
x
 = 
	`v∑ddq_u8
 (x, x);

59 
x
 = 
	`v∑ddq_u8
 (x, x);

60  
	`vgëq_œ√_u8
 (
x
, 0) | (vgetq_lane_u8 (x, 1) << 8);

61 
	}
}

63 
Æways_ölöe
 
u32


64 
	$u16x8_zîo_byã_mask
 (
u16x8
 
öput
)

66 
u8x16
 
vÆl_⁄e
 = 
	`vdupq_n_u8
 (0x0);

67 
u8x16
 
ªs_vÆues
 = { 0x01, 0x02, 0x04, 0x08,

74 
u8x16
 
ã°_ªsu…
 =

75 
	`vªöãΩªtq_u8_u16
 (
	`v˚qq_u16
 (
öput
, 
	`vªöãΩªtq_u16_u8
 (
vÆl_⁄e
)));

76 
u8x16
 
bef‹e_mîge
 = 
	`vmöq_u8
 (
ã°_ªsu…
, 
ªs_vÆues
);

80 
u16x8
 
mîge1
 = 
	`v∑ddlq_u8
 (
bef‹e_mîge
);

82 
u32x4
 
mîge2
 = 
	`v∑ddlq_u16
 (
mîge1
);

84 
u64x2
 
mîge3
 = 
	`v∑ddlq_u32
 (
mîge2
);

86  (
u32
Ë(
	`vgëq_œ√_u64
 (
mîge3
, 1) << 8) + vgetq_lane_u64 (merge3, 0);

87 
	}
}

89 
Æways_ölöe
 
u32


90 
	$u8x16_zîo_byã_mask
 (
u8x16
 
öput
)

92  
	`u16x8_zîo_byã_mask
 ((
u16x8
Ë
öput
);

93 
	}
}

95 
Æways_ölöe
 
u32


96 
	$u32x4_zîo_byã_mask
 (
u32x4
 
öput
)

98  
	`u16x8_zîo_byã_mask
 ((
u16x8
Ë
öput
);

99 
	}
}

101 
Æways_ölöe
 
u32


102 
	$u64x2_zîo_byã_mask
 (
u64x2
 
öput
)

104  
	`u16x8_zîo_byã_mask
 ((
u16x8
Ë
öput
);

105 
	}
}

	@/usr/include/vppinfra/vector_sse42.h

38 #i‚de‡
ö˛uded_ve˘‹_s£2_h


39 
	#ö˛uded_ve˘‹_s£2_h


	)

41 
	~<vµö‰a/îr‹_boŸ°øp.h
>

42 
	~<x86öåö.h
>

45 
Æways_ölöe
 
u8x16


46 
	$u8x16_öãæóve_hi
 (
u8x16
 
a
, u8x16 
b
)

48  (
u8x16
Ë
	`_mm_u≈ackhi_ïi8
 ((
__m128i
Ë
a
, (__m128iË
b
);

49 
	}
}

51 
Æways_ölöe
 
u8x16


52 
	$u8x16_öãæóve_lo
 (
u8x16
 
a
, u8x16 
b
)

54  (
u8x16
Ë
	`_mm_u≈acklo_ïi8
 ((
__m128i
Ë
a
, (__m128iË
b
);

55 
	}
}

57 
Æways_ölöe
 
u16x8


58 
	$u16x8_öãæóve_hi
 (
u16x8
 
a
, u16x8 
b
)

60  (
u16x8
Ë
	`_mm_u≈ackhi_ïi16
 ((
__m128i
Ë
a
, (__m128iË
b
);

61 
	}
}

63 
Æways_ölöe
 
u16x8


64 
	$u16x8_öãæóve_lo
 (
u16x8
 
a
, u16x8 
b
)

66  (
u16x8
Ë
	`_mm_u≈acklo_ïi16
 ((
__m128i
Ë
a
, (__m128iË
b
);

67 
	}
}

69 
Æways_ölöe
 
u32x4


70 
	$u32x4_öãæóve_hi
 (
u32x4
 
a
, u32x4 
b
)

72  (
u32x4
Ë
	`_mm_u≈ackhi_ïi32
 ((
__m128i
Ë
a
, (__m128iË
b
);

73 
	}
}

75 
Æways_ölöe
 
u32x4


76 
	$u32x4_öãæóve_lo
 (
u32x4
 
a
, u32x4 
b
)

78  (
u32x4
Ë
	`_mm_u≈acklo_ïi32
 ((
__m128i
Ë
a
, (__m128iË
b
);

79 
	}
}

81 
Æways_ölöe
 
u64x2


82 
	$u64x2_öãæóve_hi
 (
u64x2
 
a
, u64x2 
b
)

84  (
u64x2
Ë
	`_mm_u≈ackhi_ïi64
 ((
__m128i
Ë
a
, (__m128iË
b
);

85 
	}
}

87 
Æways_ölöe
 
u64x2


88 
	$u64x2_öãæóve_lo
 (
u64x2
 
a
, u64x2 
b
)

90  (
u64x2
Ë
	`_mm_u≈acklo_ïi64
 ((
__m128i
Ë
a
, (__m128iË
b
);

91 
	}
}

94 
Æways_ölöe
 
u8x8


95 
	$u8x8_öãæóve_hi
 (
u8x8
 
a
, u8x8 
b
)

97  (
u8x8
Ë
	`_m_pu≈ckhbw
 ((
__m64
Ë
a
, (__m64Ë
b
);

98 
	}
}

100 
Æways_ölöe
 
u8x8


101 
	$u8x8_öãæóve_lo
 (
u8x8
 
a
, u8x8 
b
)

103  (
u8x8
Ë
	`_m_pu≈cklbw
 ((
__m64
Ë
a
, (__m64Ë
b
);

104 
	}
}

106 
Æways_ölöe
 
u16x4


107 
	$u16x4_öãæóve_hi
 (
u16x4
 
a
, u16x4 
b
)

109  (
u16x4
Ë
	`_m_pu≈ckhwd
 ((
__m64
Ë
a
, (__m64Ë
b
);

110 
	}
}

112 
Æways_ölöe
 
u16x4


113 
	$u16x4_öãæóve_lo
 (
u16x4
 
a
, u16x4 
b
)

115  (
u16x4
Ë
	`_m_pu≈cklwd
 ((
__m64
Ë
a
, (__m64Ë
b
);

116 
	}
}

118 
Æways_ölöe
 
u32x2


119 
	$u32x2_öãæóve_hi
 (
u32x2
 
a
, u32x2 
b
)

121  (
u32x2
Ë
	`_m_pu≈ckhdq
 ((
__m64
Ë
a
, (__m64Ë
b
);

122 
	}
}

124 
Æways_ölöe
 
u32x2


125 
	$u32x2_öãæóve_lo
 (
u32x2
 
a
, u32x2 
b
)

127  (
u32x2
Ë
	`_m_pu≈ckldq
 ((
__m64
Ë
a
, (__m64Ë
b
);

128 
	}
}

131 
Æways_ölöe
 
u8x16


132 
	$u16x8_∑ck
 (
u16x8
 
lo
, u16x8 
hi
)

134  (
u8x16
Ë
	`_mm_∑ckus_ïi16
 ((
__m128i
Ë
lo
, (__m128iË
hi
);

135 
	}
}

137 
Æways_ölöe
 
i8x16


138 
	$i16x8_∑ck
 (
i16x8
 
lo
, i16x8 
hi
)

140  (
i8x16
Ë
	`_mm_∑cks_ïi16
 ((
__m128i
Ë
lo
, (__m128iË
hi
);

141 
	}
}

143 
Æways_ölöe
 
u16x8


144 
	$u32x4_∑ck
 (
u32x4
 
lo
, u32x4 
hi
)

146  (
u16x8
Ë
	`_mm_∑cks_ïi32
 ((
__m128i
Ë
lo
, (__m128iË
hi
);

147 
	}
}

150 
Æways_ölöe
 
u8x8


151 
	$u16x4_∑ck
 (
u16x4
 
lo
, u16x4 
hi
)

153  (
u8x8
Ë
	`_m_∑ckuswb
 ((
__m64
Ë
lo
, (__m64Ë
hi
);

154 
	}
}

156 
Æways_ölöe
 
i8x8


157 
	$i16x4_∑ck
 (
i16x4
 
lo
, i16x4 
hi
)

159  (
i8x8
Ë
	`_m_∑cksswb
 ((
__m64
Ë
lo
, (__m64Ë
hi
);

160 
	}
}

162 
Æways_ölöe
 
u16x4


163 
	$u32x2_∑ck
 (
u32x2
 
lo
, u32x2 
hi
)

165  (
u16x4
Ë
	`_m_∑ckssdw
 ((
__m64
Ë
lo
, (__m64Ë
hi
);

166 
	}
}

168 
Æways_ölöe
 
i16x4


169 
	$i32x2_∑ck
 (
i32x2
 
lo
, i32x2 
hi
)

171  (
i16x4
Ë
	`_m_∑ckssdw
 ((
__m64
Ë
lo
, (__m64Ë
hi
);

172 
	}
}

174 #i‚de‡
__ICC


175 
Æways_ölöe
 
u64x2


176 
	$u64x2_ªad_lo
 (
u64x2
 
x
, 
u64
 * 
a
)

178  (
u64x2
Ë
	`_mm_lﬂdl_pi
 ((
__m128
Ë
x
, (
__m64
 *Ë
a
);

179 
	}
}

181 
Æways_ölöe
 
u64x2


182 
	$u64x2_ªad_hi
 (
u64x2
 
x
, 
u64
 * 
a
)

184  (
u64x2
Ë
	`_mm_lﬂdh_pi
 ((
__m128
Ë
x
, (
__m64
 *Ë
a
);

185 
	}
}

187 
Æways_ölöe
 

188 
	$u64x2_wrôe_lo
 (
u64x2
 
x
, 
u64
 * 
a
)

190 
	`_mm_°‹ñ_pi
 ((
__m64
 *Ë
a
, (
__m128
Ë
x
);

191 
	}
}

193 
Æways_ölöe
 

194 
	$u64x2_wrôe_hi
 (
u64x2
 
x
, 
u64
 * 
a
)

196 
	`_mm_°‹eh_pi
 ((
__m64
 *Ë
a
, (
__m128
Ë
x
);

197 
	}
}

202 
	#_
(
t
) \

203 
Æways_ölöe
 
t
##
	`_°‹e_u«lig√d
 (à
x
,Å * 
a
) \

204 { 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë
a
, (__m128iË
x
); } \

205 
Æways_ölöe
 
t
Å##
	`_lﬂd_u«lig√d
 (à* 
a
) \

206 {  (
t
Ë
	`_mm_lﬂdu_si128
 ((
__m128i
 *Ë
a
); }

	)

208 
	$_
(
u8x16
Ë
	$_
(
u16x8
Ë
	$_
(
u32x4
Ë
	$_
(
u64x2
Ë
	$_
(
i8x16
Ë
	$_
(
i16x8
Ë
	$_
(
i32x4
Ë
	$_
(
i64x2
)

209 #unde‡
_


210 
	#_sig√d_bö›
(
n
,
m
,
f
,
g
) \

212 
Æways_ölöe
 
u
##
n
##
x
##
m
 \

213 
u
##
n
##
x
##
m
##
_
##
	`f
 (u##n##x##m x, u##n##x##m 
y
) \

214 {  (
u
##
n
##
x
##
m
Ë
_mm_
##
g
##
	`n
 ((
__m128i
Ëx, (__m128iË
y
); 
	}
} \

217 
Æways_ölöe
 
i
##
n
##
x
##
m
 \

218 
i
##
n
##
x
##
m
##
_
##
	`f
 (i##n##x##m x, i##n##x##m 
y
) \

219 {  (
i
##
n
##
x
##
m
Ë
_mm_
##
g
##
	`n
 ((
__m128i
Ëx, (__m128iË
y
); }

	)

221 
	$_sig√d_bö›
 (8, 16, 
add_ßtuøã
, 
adds_ïu
)

222 
	$_sig√d_bö›
 (16, 8, 
add_ßtuøã
, 
adds_ïu
)

223 
	$_sig√d_bö›
 (8, 16, 
sub_ßtuøã
, 
subs_ïu
)

224 
	$_sig√d_bö›
 (16, 8, 
sub_ßtuøã
, 
subs_ïu
)

226 
Æways_ölöe
 
i16x8
 
	$i16x8_mul_lo
 (
i16x8
 
x
, i16x8 
y
)

228  (
i16x8
Ë
	`_mm_muŒo_ïi16
 ((
__m128i
Ë
x
, (__m128iË
y
);

229 
	}
}

231 
Æways_ölöe
 
u16x8


232 
	$u16x8_mul_lo
 (
u16x8
 
x
, u16x8 
y
)

234  (
u16x8
Ë
	`_mm_muŒo_ïi16
 ((
__m128i
Ë
x
, (__m128iË
y
);

235 
	}
}

237 
Æways_ölöe
 
i16x8


238 
	$i16x8_mul_hi
 (
i16x8
 
x
, i16x8 
y
)

240  (
i16x8
Ë
	`_mm_mulhi_ïu16
 ((
__m128i
Ë
x
, (__m128iË
y
);

241 
	}
}

243 
Æways_ölöe
 
u16x8


244 
	$u16x8_mul_hi
 (
u16x8
 
x
, u16x8 
y
)

246  (
u16x8
Ë
	`_mm_mulhi_ïu16
 ((
__m128i
Ë
x
, (__m128iË
y
);

247 
	}
}

251 
	#_
(
p
,
a
,
b
,
c
,
f
) \

252 
Æways_ölöe
 
p
##
a
##
x
##
b
Ö##a##x##b##
_ishi·_
##
	`c
 (p##a##x##b x, 
i
) \

253 {  (
p
##
a
##
x
##
b
Ë
_mm_
##
f
##
i_ïi
##
	`a
 ((
__m128i
Ëx, 
i
); } \

255 
Æways_ölöe
 
p
##
a
##
x
##
b
Ö##a##x##b##
_shi·_
##
	`c
 (p##a##x##b x,Ö##a##x##b 
y
) \

256 {  (
p
##
a
##
x
##
b
Ë
_mm_
##
f
##
_ïi
##
	`a
 ((
__m128i
Ëx, (__m128iË
y
); }

	)

258 
	$_
(
u
, 16, 8, 
À·
, 
¶l
)

259 
	$_
(
u
, 32, 4, 
À·
, 
¶l
)

260 
	$_
(
u
, 64, 2, 
À·
, 
¶l
)

261 
	$_
(
u
, 16, 8, 
right
, 
§l
)

262 
	$_
(
u
, 32, 4, 
right
, 
§l
)

263 
	$_
(
u
, 64, 2, 
right
, 
§l
)

264 
	$_
(
i
, 16, 8, 
À·
, 
¶l
)

265 
	$_
(
i
, 32, 4, 
À·
, 
¶l
)

266 
	$_
(
i
, 64, 2, 
À·
, 
¶l
Ë
	$_
(
i
, 16, 8, 
right
, 
§a
Ë
	$_
(
i
, 32, 4, 
right
, 
§a
)

267 #unde‡
_


269 
Æways_ölöe
 
u16x4


270 
	$u16x4_shi·_À·
 (
u16x4
 
x
, u16x4 
i
)

272  (
u16x4
Ë
	`_m_p¶lw
 ((
__m64
Ë
x
, (__m64Ë
i
);

273 
	}
};

275 
Æways_ölöe
 
u32x2


276 
	$u32x2_shi·_À·
 (
u32x2
 
x
, u32x2 
i
)

278  (
u32x2
Ë
	`_m_p¶ld
 ((
__m64
Ë
x
, (__m64Ë
i
);

279 
	}
};

281 
Æways_ölöe
 
u16x4


282 
	$u16x4_shi·_right
 (
u16x4
 
x
, u16x4 
i
)

284  (
u16x4
Ë
	`_m_p§lw
 ((
__m64
Ë
x
, (__m64Ë
i
);

285 
	}
};

287 
Æways_ölöe
 
u32x2


288 
	$u32x2_shi·_right
 (
u32x2
 
x
, u32x2 
i
)

290  (
u32x2
Ë
	`_m_p§ld
 ((
__m64
Ë
x
, (__m64Ë
i
);

291 
	}
};

293 
Æways_ölöe
 
i16x4


294 
	$i16x4_shi·_À·
 (
i16x4
 
x
, i16x4 
i
)

296  (
i16x4
Ë
	`_m_p¶lw
 ((
__m64
Ë
x
, (__m64Ë
i
);

297 
	}
};

299 
Æways_ölöe
 
i32x2


300 
	$i32x2_shi·_À·
 (
i32x2
 
x
, i32x2 
i
)

302  (
i32x2
Ë
	`_m_p¶ld
 ((
__m64
Ë
x
, (__m64Ë
i
);

303 
	}
};

305 
Æways_ölöe
 
i16x4


306 
	$i16x4_shi·_right
 (
i16x4
 
x
, i16x4 
i
)

308  (
i16x4
Ë
	`_m_p§aw
 ((
__m64
Ë
x
, (__m64Ë
i
);

309 
	}
};

311 
Æways_ölöe
 
i32x2


312 
	$i32x2_shi·_right
 (
i32x2
 
x
, i32x2 
i
)

314  (
i32x2
Ë
	`_m_p§ad
 ((
__m64
Ë
x
, (__m64Ë
i
);

315 
	}
};

317 
	#u8x16_w‹d_shi·_À·
(
a
,
n
Ë(
u8x16
Ë
	`_mm_¶li_si128
((
__m128i
Ëa,Ç)

	)

318 
	#u8x16_w‹d_shi·_right
(
a
,
n
Ë(
u8x16
Ë
	`_mm_§li_si128
((
__m128i
Ëa,Ç)

	)

320 
	#i8x16_w‹d_shi·_À·
(
a
,
n
) \

321 ((
i8x16
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
)))

	)

322 
	#i8x16_w‹d_shi·_right
(
a
,
n
) \

323 ((
i8x16
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
)))

	)

325 
	#u16x8_w‹d_shi·_À·
(
a
,
n
) \

326 ((
u16x8
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u16
)))

	)

327 
	#i16x8_w‹d_shi·_À·
(
a
,
n
) \

328 ((
u16x8
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u16
)))

	)

329 
	#u16x8_w‹d_shi·_right
(
a
,
n
) \

330 ((
u16x8
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u16
)))

	)

331 
	#i16x8_w‹d_shi·_right
(
a
,
n
) \

332 ((
i16x8
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u16
)))

	)

334 
	#u32x4_w‹d_shi·_À·
(
a
,
n
) \

335 ((
u32x4
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u32
)))

	)

336 
	#i32x4_w‹d_shi·_À·
(
a
,
n
) \

337 ((
u32x4
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u32
)))

	)

338 
	#u32x4_w‹d_shi·_right
(
a
,
n
) \

339 ((
u32x4
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u32
)))

	)

340 
	#i32x4_w‹d_shi·_right
(
a
,
n
) \

341 ((
i32x4
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u32
)))

	)

343 
	#u64x2_w‹d_shi·_À·
(
a
,
n
) \

344 ((
u64x2
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u64
)))

	)

345 
	#i64x2_w‹d_shi·_À·
(
a
,
n
) \

346 ((
u64x2
Ë
	`u8x16_w‹d_shi·_À·
((
u8x16
Ë(
a
), (
n
Ë*  (
u64
)))

	)

347 
	#u64x2_w‹d_shi·_right
(
a
,
n
) \

348 ((
u64x2
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u64
)))

	)

349 
	#i64x2_w‹d_shi·_right
(
a
,
n
) \

350 ((
i64x2
Ë
	`u8x16_w‹d_shi·_right
((
u8x16
Ë(
a
), (
n
Ë*  (
u64
)))

	)

353 
	#_
(
t
,
n
,
Ã1
,
Ã2
) \

354 
Æways_ölöe
 
t
##
x
##
n
 \

355 
t
##
x
##
n
##
_úŸ©e_
##
	`Ã1
 (t##x##¿
w
, 
i
) \

357 
	`ASSERT
 (
i
 >0 && i <
	`BITS
 (
t
)); \

358  (
t
##
x
##
n
##
_ishi·_
##
	`Ã1
 (
w
, 
i
) \

359 | 
t
##
x
##
n
##
_ishi·_
##
	`Ã2
 (
w
, 
	`BITS
 (tË- 
i
)); \

362 
Æways_ölöe
 
t
##
x
##
n
 \

363 
t
##
x
##
n
##
_rŸ©e_
##
	`Ã1
 (t##x##¿
w
,Å##x##¿
i
) \

365 
t
##
x
##
n
 
j
 =Å##x##n##
	`_•œt
 (
	`BITS
 (t)); \

366  (
t
##
x
##
n
##
_shi·_
##
	`Ã1
 (
w
, 
i
) \

367 | 
t
##
x
##
n
##
_shi·_
##
	`Ã2
 (
w
, 
j
 - 
i
)); \

368 }

	)

370 
_
(
u16
, 8, 
À·
, 
right
);

371 
_
(
u16
, 8, 
right
, 
À·
);

372 
_
(
u32
, 4, 
À·
, 
right
);

373 
_
(
u32
, 4, 
right
, 
À·
);

374 
_
(
u64
, 2, 
À·
, 
right
);

375 
_
(
u64
, 2, 
right
, 
À·
);

377 #unde‡
_


379 #i‚de‡
__˛™g__


380 
	#_
(
t
,
n
,
Ã1
,
Ã2
) \

381 
Æways_ölöe
 
t
##
x
##
n
 \

382 
t
##
x
##
n
##
_w‹d_rŸ©e2_
##
	`Ã1
 (t##x##¿
w0
,Å##x##¿
w1
, 
i
) \

384 
m
 =  (
t
##
x
##
n
) /  (t); \

385 
	`ASSERT
 (
i
 >0 && i < 
m
); \

386  (
t
##
x
##
n
##
_w‹d_shi·_
##
	`Ã1
 (
w0
, 
i
) \

387 | 
t
##
x
##
n
##
_w‹d_shi·_
##
	`Ã2
 (
w1
, 
m
 - 
i
)); \

390 
Æways_ölöe
 
t
##
x
##
n
 \

391 
t
##
x
##
n
##
_w‹d_rŸ©e_
##
	`Ã1
 (t##x##¿
w0
, 
i
) \

392 {  
t
##
x
##
n
##
_w‹d_rŸ©e2_
##
	`Ã1
 (
w0
, w0, 
i
); }

	)

394 
_
(
u8
, 16, 
À·
, 
right
);

395 
_
(
u8
, 16, 
right
, 
À·
);

396 
_
(
u16
, 8, 
À·
, 
right
);

397 
_
(
u16
, 8, 
right
, 
À·
);

398 
_
(
u32
, 4, 
À·
, 
right
);

399 
_
(
u32
, 4, 
right
, 
À·
);

400 
_
(
u64
, 2, 
À·
, 
right
);

401 
_
(
u64
, 2, 
right
, 
À·
);

403 #unde‡
_


406 
Æways_ölöe
 

407 
	$u8x16_is_Æl_zîo
 (
u8x16
 
x
)

409  
	`_mm_ã°z_si128
 ((
__m128i
Ë
x
, (__m128i) x);

410 
	}
}

412 
Æways_ölöe
 

413 
	$u16x8_is_Æl_zîo
 (
u16x8
 
x
)

415  
	`_mm_ã°z_si128
 ((
__m128i
Ë
x
, (__m128i) x);

416 
	}
}

418 
Æways_ölöe
 

419 
	$u32x4_is_Æl_zîo
 (
u32x4
 
x
)

421  
	`_mm_ã°z_si128
 ((
__m128i
Ë
x
, (__m128i) x);

422 
	}
}

424 
Æways_ölöe
 

425 
	$u64x2_is_Æl_zîo
 (
u64x2
 
x
)

427  
	`_mm_ã°z_si128
 ((
__m128i
Ë
x
, (__m128i) x);

428 
	}
}

430 
	#u32x4_£À˘
(
A
,
MASK
) \

432 
u32x4
 
_x
, 
_y
; \

433 
_x
 = (
A
); \

434 
asm
 volatile ("pshufd %[mask], %[x], %[y]" \

435 : [
y
] "=x" (
_y
) \

436 : [
x
] "x" (
_x
), [
mask
] "i" (
MASK
)); \

437 
_y
; \

438 })

	)

440 
	#u32x4_•œt_w‹d
(
x
,
i
) \

441 
	`u32x4_£À˘
 ((
x
), (((
i
) << (2*0)) \

442 | ((
i
) << (2*1)) \

443 | ((
i
) << (2*2)) \

444 | ((
i
Ë<< (2*3))))

	)

447 
Æways_ölöe
 
u32


448 
	$u32x4_gë0
 (
u32x4
 
x
)

450 
u32
 
ªsu…
;

451 
asm
 vﬁ©ûê("movd %[x], %[ªsu…]": [
ªsu…
] "=r" (result)

452 : [
x
] "x" (x));

453  
ªsu…
;

454 
	}
}

456 
Æways_ölöe
 
u32x4


457 
	$u32x4_£t0
 (
u32
 
x
)

459 
u32x4
 
ªsu…
;

460 
asm
 vﬁ©ûê("movd %[x], %[ªsu…]": [
ªsu…
] "=x" (result)

461 : [
x
] "r" (x));

462  
ªsu…
;

463 
	}
}

465 
Æways_ölöe
 
i32x4


466 
	$i32x4_£t0
 (
i32
 
x
)

468  (
i32x4
Ë
	`u32x4_£t0
 ((
u32
Ë
x
);

469 
	}
}

471 
Æways_ölöe
 
i32


472 
	$i32x4_gë0
 (
i32x4
 
x
)

474  (
i32
Ë
	`u32x4_gë0
 ((
u32x4
Ë
x
);

475 
	}
}

478 
Æways_ölöe
 
u32


479 
	$u8x16_com∑ª_byã_mask
 (
u8x16
 
x
)

481  
	`_mm_movemask_ïi8
 ((
__m128i
Ë
x
);

482 
	}
}

484 
u8
 
u32x4_com∑ª_w‹d_mask_èbÀ
[256];

486 
Æways_ölöe
 
u32


487 
	$u32x4_com∑ª_w‹d_mask
 (
u32x4
 
x
)

489 
u32
 
m
 = 
	`u8x16_com∑ª_byã_mask
 ((
u8x16
Ë
x
);

490  (
u32x4_com∑ª_w‹d_mask_èbÀ
[(
m
 >> 0) & 0xff]

491 | (
u32x4_com∑ª_w‹d_mask_èbÀ
[(
m
 >> 8) & 0xff] << 2));

492 
	}
}

494 
Æways_ölöe
 
u32


495 
	$u8x16_zîo_byã_mask
 (
u8x16
 
x
)

497 
u8x16
 
zîo
 = { 0 };

498  
	`u8x16_com∑ª_byã_mask
 (
	`u8x16_is_equÆ
 (
x
, 
zîo
));

499 
	}
}

501 
Æways_ölöe
 
u32


502 
	$u16x8_zîo_byã_mask
 (
u16x8
 
x
)

504 
u16x8
 
zîo
 = { 0 };

505  
	`u8x16_com∑ª_byã_mask
 ((
u8x16
Ë
	`u16x8_is_equÆ
 (
x
, 
zîo
));

506 
	}
}

508 
Æways_ölöe
 
u32


509 
	$u32x4_zîo_byã_mask
 (
u32x4
 
x
)

511 
u32x4
 
zîo
 = { 0 };

512  
	`u8x16_com∑ª_byã_mask
 ((
u8x16
Ë
	`u32x4_is_equÆ
 (
x
, 
zîo
));

513 
	}
}

515 
Æways_ölöe
 
u8x16


516 
	$u8x16_max
 (
u8x16
 
x
, u8x16 
y
)

518  (
u8x16
Ë
	`_mm_max_ïu8
 ((
__m128i
Ë
x
, (__m128iË
y
);

519 
	}
}

521 
Æways_ölöe
 
u32


522 
	$u8x16_max_sˇœr
 (
u8x16
 
x
)

524 
x
 = 
	`u8x16_max
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 8));

525 
x
 = 
	`u8x16_max
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 4));

526 
x
 = 
	`u8x16_max
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 2));

527 
x
 = 
	`u8x16_max
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 1));

528  
	`_mm_exåa˘_ïi16
 ((
__m128i
Ë
x
, 0) & 0xff;

529 
	}
}

531 
Æways_ölöe
 
u8x16


532 
	$u8x16_mö
 (
u8x16
 
x
, u8x16 
y
)

534  (
u8x16
Ë
	`_mm_mö_ïu8
 ((
__m128i
Ë
x
, (__m128iË
y
);

535 
	}
}

537 
Æways_ölöe
 
u8


538 
	$u8x16_mö_sˇœr
 (
u8x16
 
x
)

540 
x
 = 
	`u8x16_mö
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 8));

541 
x
 = 
	`u8x16_mö
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 4));

542 
x
 = 
	`u8x16_mö
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 2));

543 
x
 = 
	`u8x16_mö
 (x, 
	`u8x16_w‹d_shi·_right
 (x, 1));

544  
	`_mm_exåa˘_ïi16
 ((
__m128i
Ë
x
, 0) & 0xff;

545 
	}
}

547 
Æways_ölöe
 
i16x8


548 
	$i16x8_max
 (
i16x8
 
x
, i16x8 
y
)

550  (
i16x8
Ë
	`_mm_max_ïi16
 ((
__m128i
Ë
x
, (__m128iË
y
);

551 
	}
}

553 
Æways_ölöe
 
i16


554 
	$i16x8_max_sˇœr
 (
i16x8
 
x
)

556 
x
 = 
	`i16x8_max
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 4));

557 
x
 = 
	`i16x8_max
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 2));

558 
x
 = 
	`i16x8_max
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 1));

559  
	`_mm_exåa˘_ïi16
 ((
__m128i
Ë
x
, 0);

560 
	}
}

562 
Æways_ölöe
 
i16x8


563 
	$i16x8_mö
 (
i16x8
 
x
, i16x8 
y
)

565  (
i16x8
Ë
	`_mm_mö_ïi16
 ((
__m128i
Ë
x
, (__m128iË
y
);

566 
	}
}

568 
Æways_ölöe
 
i16


569 
	$i16x8_mö_sˇœr
 (
i16x8
 
x
)

571 
x
 = 
	`i16x8_mö
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 4));

572 
x
 = 
	`i16x8_mö
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 2));

573 
x
 = 
	`i16x8_mö
 (x, 
	`i16x8_w‹d_shi·_right
 (x, 1));

574  
	`_mm_exåa˘_ïi16
 ((
__m128i
Ë
x
, 0);

575 
	}
}

577 #unde‡
_sig√d_bö›


	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

23 
__off_t
 
	m__pos
;

24 
__mb°©e_t
 
	m__°©e
;

25 } 
	t_G_Âos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb°©e_t
 
	m__°©e
;

30 } 
	t_G_Âos64_t
;

31 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gc⁄v.h
>

35 
__gc⁄v_öfo
 
	m__cd
;

38 
__gc⁄v_öfo
 
	m__cd
;

39 
__gc⁄v_°ï_d©a
 
	m__d©a
;

40 } 
	m__comböed
;

41 } 
	t_G_ic⁄v_t
;

46 
	#_G_va_li°
 
__gnuc_va_li°


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kî√l_fd_£t
;

29 (*
	t__kî√l_sigh™dÀr_t
)();

32 
	t__kî√l_key_t
;

33 
	t__kî√l_mqd_t
;

35 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/string.h

1 #i‚de‡
_LINUX_STRING_H_


2 
	#_LINUX_STRING_H_


	)

6 
	~<°rög.h
>

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

34 
	g__BEGIN_DECLS


36 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


37 
	#_STDLIB_H
 1

	)

39 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


41 
	~<bôs/waôÊags.h
>

42 
	~<bôs/waô°©us.h
>

44 #ifde‡
__USE_MISC


49 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


50 
	#__WAIT_INT
(
°©us
) \

51 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

52 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

54 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

62 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
waô
 *
	m__u±r
;

70 *
	m__ùå
;

71 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

85 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

90 #ifde‡
__WIFCONTINUED


91 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquŸ
;

100 
	mªm
;

101 } 
	tdiv_t
;

104 #i‚de‡
__ldiv_t_deföed


107 
	mquŸ
;

108 
	mªm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_deföed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


115 
__BEGIN_NAMESPACE_C99


117 
__exãnsi⁄__
 struct

119 
	mquŸ
;

120 
	mªm
;

121 } 
	tŒdiv_t
;

122 
	#__Œdiv_t_deföed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

139 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (c⁄° *
__≈å
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

147 
	$©oi
 (c⁄° *
__≈å
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

150 
	$©ﬁ
 (c⁄° *
__≈å
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

152 
__END_NAMESPACE_STD


154 #ifde‡
__USE_ISOC99


155 
__BEGIN_NAMESPACE_C99


157 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

158 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

173 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

175 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

176 **
__ª°ri˘
 
__íd±r
)

177 
__THROW
 
	`__n⁄nuŒ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

184 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

185 
__THROW
 
	`__n⁄nuŒ
 ((1));

187 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifde‡
__USE_MISC


194 
__exãnsi⁄__


195 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

196 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

197 
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
__exãnsi⁄__


200 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

205 #ifde‡
__USE_ISOC99


206 
__BEGIN_NAMESPACE_C99


208 
__exãnsi⁄__


209 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

210 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

211 
__THROW
 
	`__n⁄nuŒ
 ((1));

213 
__exãnsi⁄__


214 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

215 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde‡
__USE_GNU


235 
	~<xloˇÀ.h
>

239 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

240 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

241 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

243 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

244 **
__ª°ri˘
 
__íd±r
,

245 
__ba£
, 
__loˇÀ_t
 
__loc
)

246 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

248 
__exãnsi⁄__


249 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

250 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

251 
__loˇÀ_t
 
__loc
)

252 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

254 
__exãnsi⁄__


255 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

256 **
__ª°ri˘
 
__íd±r
,

257 
__ba£
, 
__loˇÀ_t
 
__loc
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

260 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

261 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

262 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

264 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

265 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

266 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

268 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

269 **
__ª°ri˘
 
__íd±r
,

270 
__loˇÀ_t
 
__loc
)

271 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

275 #ifde‡
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__exã∫_ölöe
 

278 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

280  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

281 
	}
}

282 
__exã∫_ölöe
 

283 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

285  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ifde‡
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exãnsi⁄__
 
__exã∫_ölöe
 

292 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

294  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

308 
	$a64l
 (c⁄° *
__s
)

309 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

313 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


314 
	~<sys/ty≥s.h
>

321 
	$øndom
 (Ë
__THROW
;

324 
	$§™dom
 (
__£ed
Ë
__THROW
;

330 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

331 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

335 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

338 #ifde‡
__USE_MISC


343 
	søndom_d©a


345 
öt32_t
 *
Âå
;

346 
öt32_t
 *
Ωå
;

347 
öt32_t
 *
°©e
;

348 
ønd_ty≥
;

349 
ønd_deg
;

350 
ønd_£p
;

351 
öt32_t
 *
íd_±r
;

354 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

355 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

357 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

358 
__THROW
 
	`__n⁄nuŒ
 ((2));

360 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

361 
size_t
 
__°©ñí
,

362 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

363 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

365 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

366 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

367 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$ønd
 (Ë
__THROW
;

376 
	$§™d
 (
__£ed
Ë
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde‡
__USE_POSIX


381 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

385 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


389 
	$dønd48
 (Ë
__THROW
;

390 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 
	$Ã™d48
 (Ë
__THROW
;

394 
	$ƒ™d48
 (
__xsubi
[3])

395 
__THROW
 
	`__n⁄nuŒ
 ((1));

398 
	$mønd48
 (Ë
__THROW
;

399 
	$jønd48
 (
__xsubi
[3])

400 
__THROW
 
	`__n⁄nuŒ
 ((1));

403 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__n⁄nuŒ
 ((1));

406 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

408 #ifde‡
__USE_MISC


412 
	sdønd48_d©a


414 
__x
[3];

415 
__ﬁd_x
[3];

416 
__c
;

417 
__öô
;

418 
__exãnsi⁄__
 
__a
;

423 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

424 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

425 
	$î™d48_r
 (
__xsubi
[3],

426 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

427 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

431 *
__ª°ri˘
 
__ªsu…
)

432 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

433 
	$ƒ™d48_r
 (
__xsubi
[3],

434 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

435 *
__ª°ri˘
 
__ªsu…
)

436 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

439 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

442 
	$jønd48_r
 (
__xsubi
[3],

443 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

444 *
__ª°ri˘
 
__ªsu…
)

445 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

448 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

449 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$lc⁄g48_r
 (
__∑øm
[7],

455 
dønd48_d©a
 *
__buf„r
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

462 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


463 
	#__mÆloc_™d_ˇŒoc_deföed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

468 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

469 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

483 
	$‰ì
 (*
__±r
Ë
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$c‰ì
 (*
__±r
Ë
__THROW
;

491 #ifde‡
__USE_MISC


492 
	~<Æloˇ.h
>

495 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

496 || 
deföed
 
__USE_MISC


498 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

501 #ifde‡
__USE_XOPEN2K


503 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

504 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

507 #ifde‡
__USE_ISOC11


509 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

510 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

519 
	$©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

521 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


523 #ifde‡
__˝lu•lus


524 "C++" 
	$©_quick_exô
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

527 
	$©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	$⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

536 
__THROW
 
	`__n⁄nuŒ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

545 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


549 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

551 
__END_NAMESPACE_STD


553 #ifde‡
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

565 
__END_NAMESPACE_STD


567 #ifde‡
__USE_GNU


570 *
	$£cuª_gëív
 (c⁄° *
__«me
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

574 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


578 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

581 #ifde‡
__USE_XOPEN2K


584 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

585 
__THROW
 
	`__n⁄nuŒ
 ((2));

588 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$˛óªnv
 (Ë
__THROW
;

599 #i‡
deföed
 
__USE_MISC
 \

600 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

606 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

609 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


618 #i‚de‡
__USE_FILE_OFFSET64


619 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

621 #ifde‡
__REDIRECT


622 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

623 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

625 
	#mk°emp
 
mk°emp64


	)

628 #ifde‡
__USE_LARGEFILE64


629 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

633 #ifde‡
__USE_MISC


640 #i‚de‡
__USE_FILE_OFFSET64


641 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

643 #ifde‡
__REDIRECT


644 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

645 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

647 
	#mk°emps
 
mk°emps64


	)

650 #ifde‡
__USE_LARGEFILE64


651 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

652 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

656 #ifde‡
__USE_XOPEN2K8


662 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

665 #ifde‡
__USE_GNU


672 #i‚de‡
__USE_FILE_OFFSET64


673 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

675 #ifde‡
__REDIRECT


676 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

677 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

679 
	#mko°emp
 
mko°emp64


	)

682 #ifde‡
__USE_LARGEFILE64


683 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

692 #i‚de‡
__USE_FILE_OFFSET64


693 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

694 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

696 #ifde‡
__REDIRECT


697 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

698 
__Êags
), 
mko°emps64
)

699 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

701 
	#mko°emps
 
mko°emps64


	)

704 #ifde‡
__USE_LARGEFILE64


705 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

706 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

724 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

727 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


733 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

734 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

739 #i‚de‡
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com∑r_‚_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

747 #ifde‡
__USE_GNU


748 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

755 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

756 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

758 #ifde‡
__USE_EXTERN_INLINES


759 
	~<bôs/°dlib-b£¨ch.h
>

764 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

765 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

766 #ifde‡
__USE_GNU


767 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

768 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

769 
	`__n⁄nuŒ
 ((1, 4));

774 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

775 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

776 
__END_NAMESPACE_STD


778 #ifde‡
__USE_ISOC99


779 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

780 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

784 
__BEGIN_NAMESPACE_STD


788 
div_t
 
	$div
 (
__numî
, 
__díom
)

789 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

790 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

791 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

792 
__END_NAMESPACE_STD


794 #ifde‡
__USE_ISOC99


795 
__BEGIN_NAMESPACE_C99


796 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

797 
__díom
)

798 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

799 
__END_NAMESPACE_C99


803 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

804 || 
deföed
 
__USE_MISC


811 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

812 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

817 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

818 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

823 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

824 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

827 #ifde‡
__USE_MISC


829 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

830 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

831 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

832 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

833 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

834 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

835 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

836 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

841 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

842 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

843 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

844 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

845 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

846 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

848 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

849 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

850 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

851 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

852 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

853 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

854 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

855 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

859 
__BEGIN_NAMESPACE_STD


862 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
;

865 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

866 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

869 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
;

873 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

874 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

876 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

877 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

878 
__THROW
;

879 
__END_NAMESPACE_STD


882 #ifde‡
__USE_MISC


887 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

891 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


898 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

899 *c⁄° *
__ª°ri˘
 
__tokís
,

900 **
__ª°ri˘
 
__vÆuï
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

905 #ifde‡
__USE_XOPEN


907 
	$£tkey
 (c⁄° *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

913 #ifde‡
__USE_XOPEN2KXSI


915 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

918 #ifde‡
__USE_XOPEN


923 
	$gø¡±
 (
__fd
Ë
__THROW
;

927 
	$u∆ock±
 (
__fd
Ë
__THROW
;

932 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

935 #ifde‡
__USE_GNU


939 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

940 
__THROW
 
	`__n⁄nuŒ
 ((2));

943 
	`gë±
 ();

946 #ifde‡
__USE_MISC


950 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

951 
__THROW
 
	`__n⁄nuŒ
 ((1));

954 
	~<bôs/°dlib-Êﬂt.h
>

957 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


958 
	~<bôs/°dlib.h
>

960 #ifde‡
__LDBL_COMPAT


961 
	~<bôs/°dlib-ldbl.h
>

965 #unde‡
__√ed_mÆloc_™d_ˇŒoc


967 
__END_DECLS


	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


30 
	#__√ed_size_t


	)

31 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

35 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

43 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

46 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

47 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

65 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

69 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

74 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 #ifde‡
__OPTIMIZE__


78 
__exã∫_Æways_ölöe
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


81  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

84 
__exã∫_Æways_ölöe
 const *

85 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


87  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifde‡
__USE_GNU


100 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

103 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

106 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

107 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

111 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

114 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

126 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

128 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

129 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

130 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

133 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

136 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

137 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

140 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

141 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

143 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

150 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

151 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
 
	`__n⁄nuŒ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifde‡
__USE_XOPEN2K8


159 
	~<xloˇÀ.h
>

162 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

163 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

165 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

166 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

169 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


171 *
	$°rdup
 (c⁄° *
__s
)

172 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

178 #i‡
deföed
 
__USE_XOPEN2K8


179 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

180 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

183 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


185 
	#°rdu∑
(
s
) \

186 (
__exãnsi⁄__
 \

188 c⁄° *
__ﬁd
 = (
s
); \

189 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

190 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

191 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

192 
	}
}))

	)

195 
	#°∫du∑
(
s
, 
n
) \

196 (
__exãnsi⁄__
 \

198 c⁄° *
__ﬁd
 = (
s
); \

199 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

200 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

201 
__√w
[
__Àn
] = '\0'; \

202 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

203 }))

	)

206 
	g__BEGIN_NAMESPACE_STD


208 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


211 *
°rchr
 (*
__s
, 
__c
)

212 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

213 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

214 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

216 #ifde‡
__OPTIMIZE__


217 
__exã∫_Æways_ölöe
 *

218 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


220  
__buûtö_°rchr
 (
__s
, 
__c
);

223 
__exã∫_Æways_ölöe
 const *

224 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


226  
__buûtö_°rchr
 (
__s
, 
__c
);

231 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

232 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

235 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


238 *
	`°ºchr
 (*
__s
, 
__c
)

239 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

240 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

241 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

243 #ifde‡
__OPTIMIZE__


244 
__exã∫_Æways_ölöe
 *

245 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


247  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

250 
__exã∫_Æways_ölöe
 const *

251 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


253  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

256 
	}
}

258 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

259 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

261 
__END_NAMESPACE_STD


263 #ifde‡
__USE_GNU


266 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


267 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

268 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

269 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

270 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

272 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

273 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

277 
__BEGIN_NAMESPACE_STD


280 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

281 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

284 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

285 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

287 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


290 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

291 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

292 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

293 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

295 #ifde‡
__OPTIMIZE__


296 
__exã∫_Æways_ölöe
 *

297 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


299  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

302 
__exã∫_Æways_ölöe
 const *

303 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


305  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

308 
	}
}

310 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

311 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

314 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


317 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

318 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

319 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

320 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

322 #ifde‡
__OPTIMIZE__


323 
__exã∫_Æways_ölöe
 *

324 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


326  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

329 
__exã∫_Æways_ölöe
 const *

330 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


332  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

335 
	}
}

337 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

338 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

343 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

344 
__THROW
 
	`__n⁄nuŒ
 ((2));

345 
__END_NAMESPACE_STD


349 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

350 c⁄° *
__ª°ri˘
 
__dñim
,

351 **
__ª°ri˘
 
__ßve_±r
)

352 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

353 #ifde‡
__USE_POSIX


354 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

355 **
__ª°ri˘
 
__ßve_±r
)

356 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

359 #ifde‡
__USE_GNU


361 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


362 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

363 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

364 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

365 c⁄° *
__√edÀ
)

366 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

368 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

369 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

373 #ifde‡
__USE_GNU


377 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

378 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

379 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

383 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

384 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

385 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

386 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

387 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

388 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

392 
__BEGIN_NAMESPACE_STD


394 
size_t
 
	$°æí
 (c⁄° *
__s
)

395 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

396 
__END_NAMESPACE_STD


398 #ifdef 
__USE_XOPEN2K8


401 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

402 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

406 
__BEGIN_NAMESPACE_STD


408 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

409 
__END_NAMESPACE_STD


410 #ifde‡
__USE_XOPEN2K


418 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


421 #ifde‡
__REDIRECT_NTH


422 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

423 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

424 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

426 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

427 
__THROW
 
	`__n⁄nuŒ
 ((2));

428 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

433 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

434 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

438 #ifde‡
__USE_XOPEN2K8


440 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

446 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

448 #ifde‡
__USE_MISC


450 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

451 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

457 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

458 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

461 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


464 *
	`ödex
 (*
__s
, 
__c
)

465 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

466 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

467 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

469 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


470 
__exã∫_Æways_ölöe
 *

471 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


473  
	`__buûtö_ödex
 (
__s
, 
__c
);

476 
__exã∫_Æways_ölöe
 const *

477 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


479  
	`__buûtö_ödex
 (
__s
, 
__c
);

482 
	}
}

484 *
	$ödex
 (c⁄° *
__s
, 
__c
)

485 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

489 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


492 *
	`rödex
 (*
__s
, 
__c
)

493 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

494 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

495 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

497 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


498 
__exã∫_Æways_ölöe
 *

499 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


501  
	`__buûtö_rödex
 (
__s
, 
__c
);

504 
__exã∫_Æways_ölöe
 const *

505 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


507  
	`__buûtö_rödex
 (
__s
, 
__c
);

510 
	}
}

512 *
	$rödex
 (c⁄° *
__s
, 
__c
)

513 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

518 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

522 #ifdef 
__USE_GNU


523 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

524 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

525 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

529 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

530 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

533 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

534 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

537 #ifdef 
__USE_GNU


540 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

541 
__loˇÀ_t
 
__loc
)

542 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

544 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

545 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

546 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

549 #ifdef 
__USE_MISC


552 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

553 c⁄° *
__ª°ri˘
 
__dñim
)

554 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifdef 
__USE_XOPEN2K8


559 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

562 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

563 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

564 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

565 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

569 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

570 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

572 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

573 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

577 #ifdef 
__USE_GNU


579 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

580 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

583 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

586 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

588 #i‚de‡
ba£«me


593 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


594 "C++" *
	$ba£«me
 (*
__fûíame
)

595 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

596 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

597 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

599 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

605 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

606 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

607 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


627 
	~<bôs/°rög.h
>

630 
	~<bôs/°rög2.h
>

633 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


635 
	~<bôs/°rög3.h
>

639 #i‡
deföed
 
__USE_GNU
 && deföed 
__OPTIMIZE__
 \

640 && 
deföed
 
__exã∫_Æways_ölöe
 && 
	$__GNUC_PREREQ
 (3,2)

641 #i‡!
deföed
 
_FORCE_INLINES
 && !deföed 
_HAVE_STRING_ARCH_memp˝y


643 #unde‡
memp˝y


644 #unde‡
__memp˝y


645 
	#memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

646 
	#__memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

648 
__exã∫_Æways_ölöe
 *

649 
	$__memp˝y_ölöe
 (*
__ª°ri˘
 
__de°
,

650 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

652  (*Ë
	`mem˝y
 (
__de°
, 
__§c
, 
__n
) + __n;

653 
	}
}

658 
	g__END_DECLS


	@/usr/include/vppinfra/mem.h

38 #i‚de‡
_ö˛uded_˛ib_mem_h


39 
	#_ö˛uded_˛ib_mem_h


	)

41 
	~<°d¨g.h
>

42 
	~<uni°d.h
>

43 
	~<sys/mm™.h
>

45 
	~<vµö‰a/˛ib.h
>

46 
	~<vµö‰a/˛ib_îr‹.h
>

47 
	~<vµö‰a/mhóp_boŸ°øp.h
>

48 
	~<vµö‰a/os.h
>

49 
	~<vµö‰a/°rög.h
>

50 
	~<vµö‰a/vÆgröd.h
>

52 
	#CLIB_MAX_MHEAPS
 256

	)

55 *
˛ib_≥r_˝u_mhóps
[
CLIB_MAX_MHEAPS
];

57 
Æways_ölöe
 *

58 
	$˛ib_mem_gë_≥r_˝u_hóp
 ()

60 
˝u
 = 
	`os_gë_thªad_ödex
 ();

61  
˛ib_≥r_˝u_mhóps
[
˝u
];

62 
	}
}

64 
Æways_ölöe
 *

65 
	$˛ib_mem_£t_≥r_˝u_hóp
 (
u8
 * 
√w_hóp
)

67 
˝u
 = 
	`os_gë_thªad_ödex
 ();

68 *
ﬁd
 = 
˛ib_≥r_˝u_mhóps
[
˝u
];

69 
˛ib_≥r_˝u_mhóps
[
˝u
] = 
√w_hóp
;

70  
ﬁd
;

71 
	}
}

74 
Æways_ölöe
 *

75 
	$˛ib_mem_Æloc_Æig√d_©_off£t
 (
uw‹d
 
size
, uw‹d 
Æign
, uw‹d 
Æign_off£t
,

76 
os_out_of_mem‹y_⁄_Áûuª
)

78 *
hóp
, *
p
;

79 
uw‹d
 
off£t
, 
˝u
;

81 i‡(
Æign_off£t
 > 
Æign
)

83 i‡(
Æign
 > 0)

84 
Æign_off£t
 %
Æign
;

86 
Æign_off£t
 = 
Æign
;

89 
˝u
 = 
	`os_gë_thªad_ödex
 ();

90 
hóp
 = 
˛ib_≥r_˝u_mhóps
[
˝u
];

91 
hóp
 = 
	`mhóp_gë_Æig√d
 (hóp, 
size
, 
Æign
, 
Æign_off£t
, &
off£t
);

92 
˛ib_≥r_˝u_mhóps
[
˝u
] = 
hóp
;

94 i‡(
off£t
 != ~0)

96 
p
 = 
hóp
 + 
off£t
;

97 #i‡
CLIB_DEBUG
 > 0

98 
	`VALGRIND_MALLOCLIKE_BLOCK
 (
p
, 
	`mhóp_d©a_byãs
 (
hóp
, 
off£t
), 0, 0);

100  
p
;

104 i‡(
os_out_of_mem‹y_⁄_Áûuª
)

105 
	`os_out_of_mem‹y
 ();

108 
	}
}

111 
Æways_ölöe
 *

112 
	$˛ib_mem_Æloc
 (
uw‹d
 
size
)

114  
	`˛ib_mem_Æloc_Æig√d_©_off£t
 (
size
, 1,

117 
	}
}

119 
Æways_ölöe
 *

120 
	$˛ib_mem_Æloc_Æig√d
 (
uw‹d
 
size
, uw‹d 
Æign
)

122  
	`˛ib_mem_Æloc_Æig√d_©_off£t
 (
size
, 
Æign
, 0,

124 
	}
}

127 
Æways_ölöe
 *

128 
	$˛ib_mem_Æloc_‹_nuŒ
 (
uw‹d
 
size
)

130  
	`˛ib_mem_Æloc_Æig√d_©_off£t
 (
size
, 1,

133 
	}
}

135 
Æways_ölöe
 *

136 
	$˛ib_mem_Æloc_Æig√d_‹_nuŒ
 (
uw‹d
 
size
, uw‹d 
Æign
)

138  
	`˛ib_mem_Æloc_Æig√d_©_off£t
 (
size
, 
Æign
, 0,

140 
	}
}

146 
	#˛ib_mem_Æloc_Æig√d_no_Áû
(
size
,
Æign
) \

148 
uw‹d
 
_˛ib_mem_Æloc_size
 = (
size
); \

149 * 
_˛ib_mem_Æloc_p
; \

150 
_˛ib_mem_Æloc_p
 = 
	`˛ib_mem_Æloc_Æig√d
 (
_˛ib_mem_Æloc_size
, (
Æign
)); \

151 i‡(! 
_˛ib_mem_Æloc_p
) \

152 
	`˛ib_∑nic
 ("ÁûedÅÿÆloˇã %d byãs", 
_˛ib_mem_Æloc_size
); \

153 
_˛ib_mem_Æloc_p
; \

154 })

	)

156 
	#˛ib_mem_Æloc_no_Áû
(
size
Ë
	`˛ib_mem_Æloc_Æig√d_no_Áû
(size,1)

	)

159 
	#˛ib_mem_Æloc_°ack
(
byãs
Ë
	`__buûtö_Æloˇ
(byãs)

	)

161 
Æways_ölöe
 
uw‹d


162 
	$˛ib_mem_is_hóp_obje˘
 (*
p
)

164 *
hóp
 = 
	`˛ib_mem_gë_≥r_˝u_hóp
 ();

165 
uw‹d
 
off£t
 = (uw‹dË
p
 - (uw‹dË
hóp
;

166 
mhóp_ñt_t
 *
e
, *
n
;

168 i‡(
off£t
 >
	`vec_Àn
 (
hóp
))

171 
e
 = 
	`mhóp_ñt_©_uoff£t
 (
hóp
, 
off£t
);

172 
n
 = 
	`mhóp_√xt_ñt
 (
e
);

175  
e
->
n_u£r_d©a
 =
n
->
¥ev_n_u£r_d©a
;

176 
	}
}

178 
Æways_ölöe
 

179 
	$˛ib_mem_‰ì
 (*
p
)

181 
u8
 *
hóp
 = 
	`˛ib_mem_gë_≥r_˝u_hóp
 ();

184 
	`ASSERT
 (
	`˛ib_mem_is_hóp_obje˘
 (
p
));

186 
	`mhóp_put
 (
hóp
, (
u8
 *Ë
p
 - heap);

188 #i‡
CLIB_DEBUG
 > 0

189 
	`VALGRIND_FREELIKE_BLOCK
 (
p
, 0);

191 
	}
}

193 
Æways_ölöe
 *

194 
	$˛ib_mem_ªÆloc
 (*
p
, 
uw‹d
 
√w_size
, uw‹d 
ﬁd_size
)

197 *
q
 = 
	`˛ib_mem_Æloc
 (
√w_size
);

198 i‡(
q
)

200 
uw‹d
 
c›y_size
;

201 i‡(
ﬁd_size
 < 
√w_size
)

202 
c›y_size
 = 
ﬁd_size
;

204 
c›y_size
 = 
√w_size
;

205 
	`˛ib_mem˝y
 (
q
, 
p
, 
c›y_size
);

206 
	`˛ib_mem_‰ì
 (
p
);

208  
q
;

209 
	}
}

211 
Æways_ölöe
 
uw‹d


212 
	$˛ib_mem_size
 (*
p
)

214 
	`ASSERT
 (
	`˛ib_mem_is_hóp_obje˘
 (
p
));

215 
mhóp_ñt_t
 *
e
 = 
	`mhóp_u£r_poöãr_to_ñt
 (
p
);

216  
	`mhóp_ñt_d©a_byãs
 (
e
);

217 
	}
}

219 
Æways_ölöe
 *

220 
	$˛ib_mem_gë_hóp
 ()

222  
	`˛ib_mem_gë_≥r_˝u_hóp
 ();

223 
	}
}

225 
Æways_ölöe
 *

226 
	$˛ib_mem_£t_hóp
 (*
hóp
)

228  
	`˛ib_mem_£t_≥r_˝u_hóp
 (
hóp
);

229 
	}
}

231 *
˛ib_mem_öô
 (*
hóp
, 
uw‹d
 
size
);

233 
˛ib_mem_exô
 ();

235 
uw‹d
 
˛ib_mem_gë_∑ge_size
 ();

237 
˛ib_mem_vÆid©e
 ();

239 
˛ib_mem_åa˚
 (
íabÀ
);

244 
uw‹d
 
	mobje˘_cou¡
;

248 
uw‹d
 
	mbyãs_tŸÆ
, 
	mbyãs_u£d
, 
	mbyãs_‰ì
;

252 
uw‹d
 
	mbyãs_ovîhód
;

255 
uw‹d
 
	mbyãs_‰ì_ª˛aimed
;

259 
uw‹d
 
	mbyãs_u£d_sbrk
;

260 
uw‹d
 
	mbyãs_u£d_mm≠
;

263 
uw‹d
 
	mbyãs_max
;

264 } 
	t˛ib_mem_ußge_t
;

266 
˛ib_mem_ußge
 (
˛ib_mem_ußge_t
 * 
ußge
);

268 
u8
 *
f‹m©_˛ib_mem_ußge
 (u8 * 
s
, 
va_li°
 * 
¨gs
);

271 
Æways_ölöe
 *

272 
	$˛ib_mem_vm_Æloc
 (
uw‹d
 
size
)

274 *
mm≠_addr
;

275 
uw‹d
 
Êags
 = 
MAP_PRIVATE
;

277 #ifde‡
MAP_ANONYMOUS


278 
Êags
 |
MAP_ANONYMOUS
;

281 
mm≠_addr
 = 
	`mm≠
 (0, 
size
, 
PROT_READ
 | 
PROT_WRITE
, 
Êags
, -1, 0);

282 i‡(
mm≠_addr
 == (*) -1)

283 
mm≠_addr
 = 0;

285  
mm≠_addr
;

286 
	}
}

288 
Æways_ölöe
 

289 
	$˛ib_mem_vm_‰ì
 (*
addr
, 
uw‹d
 
size
)

291 
	`munm≠
 (
addr
, 
size
);

292 
	}
}

294 
Æways_ölöe
 *

295 
	$˛ib_mem_vm_unm≠
 (*
addr
, 
uw‹d
 
size
)

297 *
mm≠_addr
;

298 
uw‹d
 
Êags
 = 
MAP_PRIVATE
 | 
MAP_FIXED
;

304 
mm≠_addr
 = 
	`mm≠
 (
addr
, 
size
, 
PROT_NONE
, 
Êags
, -1, 0);

305 i‡(
mm≠_addr
 == (*) -1)

306 
mm≠_addr
 = 0;

308  
mm≠_addr
;

309 
	}
}

311 
Æways_ölöe
 *

312 
	$˛ib_mem_vm_m≠
 (*
addr
, 
uw‹d
 
size
)

314 *
mm≠_addr
;

315 
uw‹d
 
Êags
 = 
MAP_PRIVATE
 | 
MAP_FIXED
;

317 
mm≠_addr
 = 
	`mm≠
 (
addr
, 
size
, (
PROT_READ
 | 
PROT_WRITE
), 
Êags
, -1, 0);

318 i‡(
mm≠_addr
 == (*) -1)

319 
mm≠_addr
 = 0;

321  
mm≠_addr
;

322 
	}
}

326 
	#CLIB_MEM_VM_F_SHARED
 (1 << 0)

	)

327 
	#CLIB_MEM_VM_F_HUGETLB
 (1 << 1)

	)

328 
	#CLIB_MEM_VM_F_NUMA_PREFER
 (1 << 2)

	)

329 
	#CLIB_MEM_VM_F_NUMA_FORCE
 (1 << 3)

	)

330 
	#CLIB_MEM_VM_F_HUGETLB_PREALLOC
 (1 << 4)

	)

331 
	#CLIB_MEM_VM_F_LOCKED
 (1 << 5)

	)

332 
u32
 
	mÊags
;

343 *
	m«me
;

344 
uw‹d
 
	msize
;

345 
	mnuma_node
;

346 *
	maddr
;

347 
	mfd
;

348 
	mlog2_∑ge_size
;

349 
	mn_∑ges
;

350 
uw‹d
 
	mªque°ed_va
;

351 } 
	t˛ib_mem_vm_Æloc_t
;

353 
˛ib_îr‹_t
 *
˛ib_mem_vm_ext_Æloc
 (
˛ib_mem_vm_Æloc_t
 * 
a
);

354 
u64
 
˛ib_mem_vm_gë_∑ge_size
 (
fd
);

355 
˛ib_mem_vm_gë_log2_∑ge_size
 (
fd
);

356 
u64
 *
˛ib_mem_vm_gë_∑ddr
 (*
mem
, 
log2_∑ge_size
, 
n_∑ges
);

360 
uw‹d
 
	msize
;

361 
	mfd
;

362 
uw‹d
 
	mªque°ed_va
;

363 *
	maddr
;

364 } 
	t˛ib_mem_vm_m≠_t
;

366 
˛ib_îr‹_t
 *
˛ib_mem_vm_ext_m≠
 (
˛ib_mem_vm_m≠_t
 * 
a
);

367 
˛ib_mem_vm_øndomize_va
 (
uw‹d
 * 
ªque°ed_va
, 
u32
 
log2_∑ge_size
);

369 
	~<vµö‰a/îr‹.h
>

	@/usr/include/vppinfra/memcpy_avx2.h

48 #i‚de‡
ö˛uded_˛ib_mem˝y_avx2_h


49 
	#ö˛uded_˛ib_mem˝y_avx2_h


	)

51 
	~<°döt.h
>

52 
	~<x86öåö.h
>

54 
ölöe
 

55 
	$˛ib_mov16
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

57 
__m128i
 
xmm0
;

59 
xmm0
 = 
	`_mm_lﬂdu_si128
 ((c⁄° 
__m128i
 *Ë
§c
);

60 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë
d°
, 
xmm0
);

61 
	}
}

63 
ölöe
 

64 
	$˛ib_mov32
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

66 
__m256i
 
ymm0
;

68 
ymm0
 = 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë
§c
);

69 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë
d°
, 
ymm0
);

70 
	}
}

72 
ölöe
 

73 
	$˛ib_mov64
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

75 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 + 0 * 32, (c⁄° u8 *Ë
§c
 + 0 * 32);

76 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 + 1 * 32, (c⁄° u8 *Ë
§c
 + 1 * 32);

77 
	}
}

79 
ölöe
 

80 
	$˛ib_mov128
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

82 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 + 0 * 64, (c⁄° u8 *Ë
§c
 + 0 * 64);

83 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 + 1 * 64, (c⁄° u8 *Ë
§c
 + 1 * 64);

84 
	}
}

86 
ölöe
 

87 
	$˛ib_mov128blocks
 (
u8
 * 
d°
, c⁄° u8 * 
§c
, 
size_t
 
n
)

89 
__m256i
 
ymm0
, 
ymm1
, 
ymm2
, 
ymm3
;

91 
n
 >= 128)

93 
ymm0
 =

94 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë((c⁄° 
u8
 *Ë
§c
 + 0 * 32));

95 
n
 -= 128;

96 
ymm1
 =

97 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë((c⁄° 
u8
 *Ë
§c
 + 1 * 32));

98 
ymm2
 =

99 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë((c⁄° 
u8
 *Ë
§c
 + 2 * 32));

100 
ymm3
 =

101 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë((c⁄° 
u8
 *Ë
§c
 + 3 * 32));

102 
§c
 = (c⁄° 
u8
 *) src + 128;

103 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë((
u8
 *Ë
d°
 + 0 * 32), 
ymm0
);

104 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë((
u8
 *Ë
d°
 + 1 * 32), 
ymm1
);

105 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë((
u8
 *Ë
d°
 + 2 * 32), 
ymm2
);

106 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë((
u8
 *Ë
d°
 + 3 * 32), 
ymm3
);

107 
d°
 = (
u8
 *) dst + 128;

109 
	}
}

111 
ölöe
 *

112 
	$˛ib_mem˝y
 (*
d°
, c⁄° *
§c
, 
size_t
 
n
)

114 
uw‹d
 
d°u
 = (uw‹dË
d°
;

115 
uw‹d
 
§cu
 = (uw‹dË
§c
;

116 *
ªt
 = 
d°
;

117 
size_t
 
d°ofss
;

118 
size_t
 
bôs
;

123 i‡(
n
 < 16)

125 i‡(
n
 & 0x01)

127 *(
u8
 *Ë
d°u
 = *(c⁄° u8 *Ë
§cu
;

128 
§cu
 = (
uw‹d
Ë((c⁄° 
u8
 *) srcu + 1);

129 
d°u
 = (
uw‹d
Ë((
u8
 *) dstu + 1);

131 i‡(
n
 & 0x02)

133 *(
u16
 *Ë
d°u
 = *(c⁄° u16 *Ë
§cu
;

134 
§cu
 = (
uw‹d
Ë((c⁄° 
u16
 *) srcu + 1);

135 
d°u
 = (
uw‹d
Ë((
u16
 *) dstu + 1);

137 i‡(
n
 & 0x04)

139 *(
u32
 *Ë
d°u
 = *(c⁄° u32 *Ë
§cu
;

140 
§cu
 = (
uw‹d
Ë((c⁄° 
u32
 *) srcu + 1);

141 
d°u
 = (
uw‹d
Ë((
u32
 *) dstu + 1);

143 i‡(
n
 & 0x08)

145 *(
u64
 *Ë
d°u
 = *(c⁄° u64 *Ë
§cu
;

147  
ªt
;

153 i‡(
n
 <= 32)

155 
	`˛ib_mov16
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

156 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

157  
ªt
;

159 i‡(
n
 <= 48)

161 
	`˛ib_mov16
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

162 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 + 16, (c⁄° u8 *Ë
§c
 + 16);

163 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

164  
ªt
;

166 i‡(
n
 <= 64)

168 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

169 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 - 32 + 
n
, (c⁄° u8 *Ë
§c
 - 32 +Ç);

170  
ªt
;

172 i‡(
n
 <= 256)

174 i‡(
n
 >= 128)

176 
n
 -= 128;

177 
	`˛ib_mov128
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

178 
§c
 = (c⁄° 
u8
 *) src + 128;

179 
d°
 = (
u8
 *) dst + 128;

181 
COPY_BLOCK_128_BACK31
:

182 i‡(
n
 >= 64)

184 
n
 -= 64;

185 
	`˛ib_mov64
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

186 
§c
 = (c⁄° 
u8
 *) src + 64;

187 
d°
 = (
u8
 *) dst + 64;

189 i‡(
n
 > 32)

191 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

192 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 - 32 + 
n
, (c⁄° u8 *Ë
§c
 - 32 +Ç);

193  
ªt
;

195 i‡(
n
 > 0)

197 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 - 32 + 
n
, (c⁄° u8 *Ë
§c
 - 32 +Ç);

199  
ªt
;

205 
d°ofss
 = (
uw‹d
Ë
d°
 & 0x1F;

206 i‡(
d°ofss
 > 0)

208 
d°ofss
 = 32 - dstofss;

209 
n
 -
d°ofss
;

210 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

211 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
d°ofss
;

212 
d°
 = (
u8
 *Ëd° + 
d°ofss
;

218 
	`˛ib_mov128blocks
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
, 
n
);

219 
bôs
 = 
n
;

220 
n
 =Ç & 127;

221 
bôs
 -
n
;

222 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
bôs
;

223 
d°
 = (
u8
 *Ëd° + 
bôs
;

228 
COPY_BLOCK_128_BACK31
;

229 
	}
}

	@/usr/include/vppinfra/memcpy_avx512.h

48 #i‚de‡
ö˛uded_˛ib_mem˝y_avx512_h


49 
	#ö˛uded_˛ib_mem˝y_avx512_h


	)

51 
	~<°döt.h
>

52 
	~<x86öåö.h
>

54 
ölöe
 

55 
	$˛ib_mov16
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

57 
__m128i
 
xmm0
;

59 
xmm0
 = 
	`_mm_lﬂdu_si128
 ((c⁄° 
__m128i
 *Ë
§c
);

60 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë
d°
, 
xmm0
);

61 
	}
}

63 
ölöe
 

64 
	$˛ib_mov32
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

66 
__m256i
 
ymm0
;

68 
ymm0
 = 
	`_mm256_lﬂdu_si256
 ((c⁄° 
__m256i
 *Ë
§c
);

69 
	`_mm256_°‹eu_si256
 ((
__m256i
 *Ë
d°
, 
ymm0
);

70 
	}
}

72 
ölöe
 

73 
	$˛ib_mov64
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

75 
__m512i
 
zmm0
;

77 
zmm0
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë
§c
);

78 
	`_mm512_°‹eu_si512
 ((*Ë
d°
, 
zmm0
);

79 
	}
}

81 
ölöe
 

82 
	$˛ib_mov128
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

84 
	`˛ib_mov64
 (
d°
 + 0 * 64, 
§c
 + 0 * 64);

85 
	`˛ib_mov64
 (
d°
 + 1 * 64, 
§c
 + 1 * 64);

86 
	}
}

88 
ölöe
 

89 
	$˛ib_mov256
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

91 
	`˛ib_mov128
 (
d°
 + 0 * 128, 
§c
 + 0 * 128);

92 
	`˛ib_mov128
 (
d°
 + 1 * 128, 
§c
 + 1 * 128);

93 
	}
}

95 
ölöe
 

96 
	$˛ib_mov128blocks
 (
u8
 * 
d°
, c⁄° u8 * 
§c
, 
size_t
 
n
)

98 
__m512i
 
zmm0
, 
zmm1
;

100 
n
 >= 128)

102 
zmm0
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 0 * 64));

103 
n
 -= 128;

104 
zmm1
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 1 * 64));

105 
§c
 = src + 128;

106 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 0 * 64), 
zmm0
);

107 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 1 * 64), 
zmm1
);

108 
d°
 = dst + 128;

110 
	}
}

112 
ölöe
 

113 
	$˛ib_mov512blocks
 (
u8
 * 
d°
, c⁄° u8 * 
§c
, 
size_t
 
n
)

115 
__m512i
 
zmm0
, 
zmm1
, 
zmm2
, 
zmm3
, 
zmm4
, 
zmm5
, 
zmm6
, 
zmm7
;

117 
n
 >= 512)

119 
zmm0
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 0 * 64));

120 
n
 -= 512;

121 
zmm1
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 1 * 64));

122 
zmm2
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 2 * 64));

123 
zmm3
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 3 * 64));

124 
zmm4
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 4 * 64));

125 
zmm5
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 5 * 64));

126 
zmm6
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 6 * 64));

127 
zmm7
 = 
	`_mm512_lﬂdu_si512
 ((c⁄° *Ë(
§c
 + 7 * 64));

128 
§c
 = src + 512;

129 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 0 * 64), 
zmm0
);

130 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 1 * 64), 
zmm1
);

131 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 2 * 64), 
zmm2
);

132 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 3 * 64), 
zmm3
);

133 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 4 * 64), 
zmm4
);

134 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 5 * 64), 
zmm5
);

135 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 6 * 64), 
zmm6
);

136 
	`_mm512_°‹eu_si512
 ((*Ë(
d°
 + 7 * 64), 
zmm7
);

137 
d°
 = dst + 512;

139 
	}
}

141 
ölöe
 *

142 
	$˛ib_mem˝y
 (*
d°
, c⁄° *
§c
, 
size_t
 
n
)

144 
uw‹d
 
d°u
 = (uw‹dË
d°
;

145 
uw‹d
 
§cu
 = (uw‹dË
§c
;

146 *
ªt
 = 
d°
;

147 
size_t
 
d°ofss
;

148 
size_t
 
bôs
;

153 i‡(
n
 < 16)

155 i‡(
n
 & 0x01)

157 *(
u8
 *Ë
d°u
 = *(c⁄° u8 *Ë
§cu
;

158 
§cu
 = (
uw‹d
Ë((c⁄° 
u8
 *) srcu + 1);

159 
d°u
 = (
uw‹d
Ë((
u8
 *) dstu + 1);

161 i‡(
n
 & 0x02)

163 *(
u16
 *Ë
d°u
 = *(c⁄° u16 *Ë
§cu
;

164 
§cu
 = (
uw‹d
Ë((c⁄° 
u16
 *) srcu + 1);

165 
d°u
 = (
uw‹d
Ë((
u16
 *) dstu + 1);

167 i‡(
n
 & 0x04)

169 *(
u32
 *Ë
d°u
 = *(c⁄° u32 *Ë
§cu
;

170 
§cu
 = (
uw‹d
Ë((c⁄° 
u32
 *) srcu + 1);

171 
d°u
 = (
uw‹d
Ë((
u32
 *) dstu + 1);

173 i‡(
n
 & 0x08)

174 *(
u64
 *Ë
d°u
 = *(c⁄° u64 *Ë
§cu
;

175  
ªt
;

181 i‡(
n
 <= 32)

183 
	`˛ib_mov16
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

184 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

185  
ªt
;

187 i‡(
n
 <= 64)

189 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

190 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 - 32 + 
n
, (c⁄° u8 *Ë
§c
 - 32 +Ç);

191  
ªt
;

193 i‡(
n
 <= 512)

195 i‡(
n
 >= 256)

197 
n
 -= 256;

198 
	`˛ib_mov256
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

199 
§c
 = (c⁄° 
u8
 *) src + 256;

200 
d°
 = (
u8
 *) dst + 256;

202 i‡(
n
 >= 128)

204 
n
 -= 128;

205 
	`˛ib_mov128
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

206 
§c
 = (c⁄° 
u8
 *) src + 128;

207 
d°
 = (
u8
 *) dst + 128;

209 
COPY_BLOCK_128_BACK63
:

210 i‡(
n
 > 64)

212 
	`˛ib_mov64
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

213 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 - 64 + 
n
, (c⁄° u8 *Ë
§c
 - 64 +Ç);

214  
ªt
;

216 i‡(
n
 > 0)

217 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 - 64 + 
n
, (c⁄° u8 *Ë
§c
 - 64 +Ç);

218  
ªt
;

224 
d°ofss
 = (
uw‹d
Ë
d°
 & 0x3F;

225 i‡(
d°ofss
 > 0)

227 
d°ofss
 = 64 - dstofss;

228 
n
 -
d°ofss
;

229 
	`˛ib_mov64
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

230 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
d°ofss
;

231 
d°
 = (
u8
 *Ëd° + 
d°ofss
;

239 
	`˛ib_mov512blocks
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
, 
n
);

240 
bôs
 = 
n
;

241 
n
 =Ç & 511;

242 
bôs
 -
n
;

243 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
bôs
;

244 
d°
 = (
u8
 *Ëd° + 
bôs
;

251 i‡(
n
 >= 128)

253 
	`˛ib_mov128blocks
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
, 
n
);

254 
bôs
 = 
n
;

255 
n
 =Ç & 127;

256 
bôs
 -
n
;

257 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
bôs
;

258 
d°
 = (
u8
 *Ëd° + 
bôs
;

264 
COPY_BLOCK_128_BACK63
;

265 
	}
}

	@/usr/include/vppinfra/memcpy_sse3.h

48 #i‚de‡
ö˛uded_˛ib_mem˝y_s£3_h


49 
	#ö˛uded_˛ib_mem˝y_s£3_h


	)

51 
	~<°döt.h
>

52 
	~<x86öåö.h
>

54 
ölöe
 

55 
	$˛ib_mov16
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

57 
__m128i
 
xmm0
;

59 
xmm0
 = 
	`_mm_lﬂdu_si128
 ((c⁄° 
__m128i
 *Ë
§c
);

60 
	`_mm_°‹eu_si128
 ((
__m128i
 *Ë
d°
, 
xmm0
);

61 
	}
}

63 
ölöe
 

64 
	$˛ib_mov32
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

66 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 + 0 * 16, (c⁄° u8 *Ë
§c
 + 0 * 16);

67 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 + 1 * 16, (c⁄° u8 *Ë
§c
 + 1 * 16);

68 
	}
}

70 
ölöe
 

71 
	$˛ib_mov64
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

73 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 + 0 * 32, (c⁄° u8 *Ë
§c
 + 0 * 32);

74 
	`˛ib_mov32
 ((
u8
 *Ë
d°
 + 1 * 32, (c⁄° u8 *Ë
§c
 + 1 * 32);

75 
	}
}

77 
ölöe
 

78 
	$˛ib_mov128
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

80 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 + 0 * 64, (c⁄° u8 *Ë
§c
 + 0 * 64);

81 
	`˛ib_mov64
 ((
u8
 *Ë
d°
 + 1 * 64, (c⁄° u8 *Ë
§c
 + 1 * 64);

82 
	}
}

84 
ölöe
 

85 
	$˛ib_mov256
 (
u8
 * 
d°
, c⁄° u8 * 
§c
)

87 
	`˛ib_mov128
 ((
u8
 *Ë
d°
 + 0 * 128, (c⁄° u8 *Ë
§c
 + 0 * 128);

88 
	`˛ib_mov128
 ((
u8
 *Ë
d°
 + 1 * 128, (c⁄° u8 *Ë
§c
 + 1 * 128);

89 
	}
}

102 
	#CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
Àn
, 
off£t
) \

104 
tmp
; \

105 
Àn
 >128 + 16 - 
off£t
) { \

106 
xmm0
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 0 * 16)); \

107 
Àn
 -= 128; \

108 
xmm1
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 1 * 16)); \

109 
xmm2
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 2 * 16)); \

110 
xmm3
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 3 * 16)); \

111 
xmm4
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 4 * 16)); \

112 
xmm5
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 5 * 16)); \

113 
xmm6
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 6 * 16)); \

114 
xmm7
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 7 * 16)); \

115 
xmm8
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 8 * 16)); \

116 
§c
 = (c⁄° 
u8
 *)src + 128; \

117 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 0 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm1
, 
xmm0
, 
off£t
)); \

118 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 1 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm2
, 
xmm1
, 
off£t
)); \

119 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 2 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm3
, 
xmm2
, 
off£t
)); \

120 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 3 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm4
, 
xmm3
, 
off£t
)); \

121 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 4 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm5
, 
xmm4
, 
off£t
)); \

122 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 5 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm6
, 
xmm5
, 
off£t
)); \

123 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 6 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm7
, 
xmm6
, 
off£t
)); \

124 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 7 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm8
, 
xmm7
, 
off£t
)); \

125 
d°
 = (
u8
 *)dst + 128; \

127 
tmp
 = 
Àn
; \

128 
Àn
 = (÷í - 16 + 
off£t
) & 127) + 16 - offset; \

129 
tmp
 -
Àn
; \

130 
§c
 = (c⁄° 
u8
 *)§¯+ 
tmp
; \

131 
d°
 = (
u8
 *)d° + 
tmp
; \

132 i‡(
Àn
 >32 + 16 - 
off£t
) { \

133 
Àn
 >32 + 16 - 
off£t
) { \

134 
xmm0
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 0 * 16)); \

135 
Àn
 -= 32; \

136 
xmm1
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 1 * 16)); \

137 
xmm2
 = 
	`_mm_lﬂdu_si128
((c⁄° 
__m128i
 *)((c⁄° 
u8
 *)
§c
 - 
off£t
 + 2 * 16)); \

138 
§c
 = (c⁄° 
u8
 *)src + 32; \

139 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 0 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm1
, 
xmm0
, 
off£t
)); \

140 
	`_mm_°‹eu_si128
((
__m128i
 *)((
u8
 *)
d°
 + 1 * 16), 
	`_mm_Æigƒ_ïi8
(
xmm2
, 
xmm1
, 
off£t
)); \

141 
d°
 = (
u8
 *)dst + 32; \

143 
tmp
 = 
Àn
; \

144 
Àn
 = (÷í - 16 + 
off£t
) & 31) + 16 - offset; \

145 
tmp
 -
Àn
; \

146 
§c
 = (c⁄° 
u8
 *)§¯+ 
tmp
; \

147 
d°
 = (
u8
 *)d° + 
tmp
; \

149 })

	)

163 
	#CLIB_MVUNALIGN_LEFT47
(
d°
, 
§c
, 
Àn
, 
off£t
) \

165 
off£t
) { \

166 0x01: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x01); ; \

167 0x02: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x02); ; \

168 0x03: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x03); ; \

169 0x04: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x04); ; \

170 0x05: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x05); ; \

171 0x06: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x06); ; \

172 0x07: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x07); ; \

173 0x08: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x08); ; \

174 0x09: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x09); ; \

175 0x0A: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0A); ; \

176 0x0B: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0B); ; \

177 0x0C: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0C); ; \

178 0x0D: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0D); ; \

179 0x0E: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0E); ; \

180 0x0F: 
	`CLIB_MVUNALIGN_LEFT47_IMM
(
d°
, 
§c
, 
n
, 0x0F); ; \

183 })

	)

185 
ölöe
 *

186 
	$˛ib_mem˝y
 (*
d°
, c⁄° *
§c
, 
size_t
 
n
)

188 
__m128i
 
xmm0
, 
xmm1
, 
xmm2
, 
xmm3
, 
xmm4
, 
xmm5
, 
xmm6
, 
xmm7
, 
xmm8
;

189 
uw‹d
 
d°u
 = (uw‹dË
d°
;

190 
uw‹d
 
§cu
 = (uw‹dË
§c
;

191 *
ªt
 = 
d°
;

192 
size_t
 
d°ofss
;

193 
size_t
 
§cofs
;

198 i‡(
n
 < 16)

200 i‡(
n
 & 0x01)

202 *(
u8
 *Ë
d°u
 = *(c⁄° u8 *Ë
§cu
;

203 
§cu
 = (
uw‹d
Ë((c⁄° 
u8
 *) srcu + 1);

204 
d°u
 = (
uw‹d
Ë((
u8
 *) dstu + 1);

206 i‡(
n
 & 0x02)

208 *(
u16
 *Ë
d°u
 = *(c⁄° u16 *Ë
§cu
;

209 
§cu
 = (
uw‹d
Ë((c⁄° 
u16
 *) srcu + 1);

210 
d°u
 = (
uw‹d
Ë((
u16
 *) dstu + 1);

212 i‡(
n
 & 0x04)

214 *(
u32
 *Ë
d°u
 = *(c⁄° u32 *Ë
§cu
;

215 
§cu
 = (
uw‹d
Ë((c⁄° 
u32
 *) srcu + 1);

216 
d°u
 = (
uw‹d
Ë((
u32
 *) dstu + 1);

218 i‡(
n
 & 0x08)

220 *(
u64
 *Ë
d°u
 = *(c⁄° u64 *Ë
§cu
;

222  
ªt
;

228 i‡(
n
 <= 32)

230 
	`˛ib_mov16
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

231 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

232  
ªt
;

234 i‡(
n
 <= 48)

236 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

237 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

238  
ªt
;

240 i‡(
n
 <= 64)

242 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

243 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 + 32, (c⁄° u8 *Ë
§c
 + 32);

244 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

245  
ªt
;

247 i‡(
n
 <= 128)

249 
COPY_BLOCK_128_BACK15
;

251 i‡(
n
 <= 512)

253 i‡(
n
 >= 256)

255 
n
 -= 256;

256 
	`˛ib_mov128
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

257 
	`˛ib_mov128
 ((
u8
 *Ë
d°
 + 128, (c⁄° u8 *Ë
§c
 + 128);

258 
§c
 = (c⁄° 
u8
 *) src + 256;

259 
d°
 = (
u8
 *) dst + 256;

261 
COPY_BLOCK_255_BACK15
:

262 i‡(
n
 >= 128)

264 
n
 -= 128;

265 
	`˛ib_mov128
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

266 
§c
 = (c⁄° 
u8
 *) src + 128;

267 
d°
 = (
u8
 *) dst + 128;

269 
COPY_BLOCK_128_BACK15
:

270 i‡(
n
 >= 64)

272 
n
 -= 64;

273 
	`˛ib_mov64
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

274 
§c
 = (c⁄° 
u8
 *) src + 64;

275 
d°
 = (
u8
 *) dst + 64;

277 
COPY_BLOCK_64_BACK15
:

278 i‡(
n
 >= 32)

280 
n
 -= 32;

281 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

282 
§c
 = (c⁄° 
u8
 *) src + 32;

283 
d°
 = (
u8
 *) dst + 32;

285 i‡(
n
 > 16)

287 
	`˛ib_mov16
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

288 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

289  
ªt
;

291 i‡(
n
 > 0)

293 
	`˛ib_mov16
 ((
u8
 *Ë
d°
 - 16 + 
n
, (c⁄° u8 *Ë
§c
 - 16 +Ç);

295  
ªt
;

304 
d°ofss
 = (
uw‹d
Ë
d°
 & 0x0F;

305 i‡(
d°ofss
 > 0)

307 
d°ofss
 = 16 - dstofss + 16;

308 
n
 -
d°ofss
;

309 
	`˛ib_mov32
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

310 
§c
 = (c⁄° 
u8
 *Ë§¯+ 
d°ofss
;

311 
d°
 = (
u8
 *Ëd° + 
d°ofss
;

313 
§cofs
 = ((
uw‹d
Ë
§c
 & 0x0F);

318 i‡(
§cofs
 == 0)

323 ; 
n
 >= 256;Ç -= 256)

325 
	`˛ib_mov256
 ((
u8
 *Ë
d°
, (c⁄° u8 *Ë
§c
);

326 
d°
 = (
u8
 *) dst + 256;

327 
§c
 = (c⁄° 
u8
 *) src + 256;

333 
COPY_BLOCK_255_BACK15
;

339 
	`CLIB_MVUNALIGN_LEFT47
 (
d°
, 
§c
, 
n
, 
§cofs
);

344 
COPY_BLOCK_64_BACK15
;

345 
	}
}

348 #unde‡
CLIB_MVUNALIGN_LEFT47_IMM


349 #unde‡
CLIB_MVUNALIGN_LEFT47


	@/usr/include/vppinfra/vec_bootstrap.h

38 #i‚de‡
ö˛uded_˛ib_vec_boŸ°øp_h


39 
	#ö˛uded_˛ib_vec_boŸ°øp_h


	)

57 #i‡
CLIB_VEC64
 > 0

58 
u64
 
	mÀn
;

60 
u32
 
	mÀn
;

62 
u8
 
	mve˘‹_d©a
[0];

63 } 
	tvec_hódî_t
;

73 
	#_vec_föd
(
v
Ë((
vec_hódî_t
 *Ë(vË- 1)

	)

75 
	#_vec_round_size
(
s
) \

76 (((
s
Ë+  (
uw‹d
Ë- 1Ë&~ ( (uw‹dË- 1))

	)

78 
Æways_ölöe
 
uw‹d


79 
	$vec_hódî_byãs
 (
uw‹d
 
hódî_byãs
)

81  
	`round_pow2
 (
hódî_byãs
 +  (
vec_hódî_t
),

82  (
vec_hódî_t
));

83 
	}
}

91 
Æways_ölöe
 *

92 
	$vec_hódî
 (*
v
, 
uw‹d
 
hódî_byãs
)

94  
v
 - 
	`vec_hódî_byãs
 (
hódî_byãs
);

95 
	}
}

103 
Æways_ölöe
 *

104 
	$vec_hódî_íd
 (*
v
, 
uw‹d
 
hódî_byãs
)

106  
v
 + 
	`vec_hódî_byãs
 (
hódî_byãs
);

107 
	}
}

109 
Æways_ölöe
 
uw‹d


110 
	$vec_Æig√d_hódî_byãs
 (
uw‹d
 
hódî_byãs
, uw‹d 
Æign
)

112  
	`round_pow2
 (
hódî_byãs
 +  (
vec_hódî_t
), 
Æign
);

113 
	}
}

115 
Æways_ölöe
 *

116 
	$vec_Æig√d_hódî
 (*
v
, 
uw‹d
 
hódî_byãs
, uw‹d 
Æign
)

118  
v
 - 
	`vec_Æig√d_hódî_byãs
 (
hódî_byãs
, 
Æign
);

119 
	}
}

121 
Æways_ölöe
 *

122 
	$vec_Æig√d_hódî_íd
 (*
v
, 
uw‹d
 
hódî_byãs
, uw‹d 
Æign
)

124  
v
 + 
	`vec_Æig√d_hódî_byãs
 (
hódî_byãs
, 
Æign
);

125 
	}
}

134 
	#_vec_Àn
(
v
Ë(
	`_vec_föd
(v)->
Àn
)

	)

142 
	#vec_Àn
(
v
Ë((vË? 
	`_vec_Àn
(vË: 0)

	)

148 
	#vec_ª£t_Àngth
(
v
Ëdÿ{ i‡(vË
	`_vec_Àn
 (vË0; } 0)

	)

152 
	#vec_byãs
(
v
Ë(
	`vec_Àn
 (vË*  (v[0]))

	)

156 
	#vec_ˇ∑côy
(
v
,
b
) \

158 * 
_vec_ˇ∑côy_v
 = (*Ë(
v
); \

159 
uw‹d
 
_vec_ˇ∑côy_b
 = (
b
); \

160 
_vec_ˇ∑côy_b
 =  (
vec_hódî_t
Ë+ 
	`_vec_round_size
 (_vec_capacity_b); \

161 
_vec_ˇ∑côy_v
 ? 
	`˛ib_mem_size
 (_vec_ˇ∑côy_v - 
_vec_ˇ∑côy_b
) : 0; \

162 })

	)

165 
	#vec_max_Àn
(
v
Ë(
	`vec_ˇ∑côy
(v,0Ë/  (v[0]))

	)

168 
	#vec_íd
(
v
Ë((vË+ 
	`vec_Àn
 (v))

	)

171 
	#vec_is_membî
(
v
,
e
Ë(”Ë>(vË&& (eË< 
	`vec_íd
 (v))

	)

174 
	#vec_ñt_©_ödex
(
v
,
i
) \

176 
	`ASSERT
 ((
i
Ë< 
	`vec_Àn
 (
v
)); \

177 (
v
Ë+ (
i
); \

178 })

	)

181 
	#vec_ñt
(
v
,
i
Ë(
	`vec_ñt_©_ödex
(v,i))[0]

	)

184 
	#vec_f‹óch
(
v¨
,
vec
Ëv¨ = (vec); v¨ < 
	`vec_íd
 (vec); v¨++)

	)

187 
	#vec_f‹óch_backw¨ds
(
v¨
,
vec
) \

188 
v¨
 = 
	`vec_íd
 (
vec
Ë- 1; v¨ >(vec); v¨--)

	)

191 
	#vec_f‹óch_ödex
(
v¨
,
v
Ë(v¨Ë0; (v¨Ë< 
	`vec_Àn
 (v); (v¨)++)

	)

	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/gconv.h

22 #i‚de‡
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<„©uªs.h
>

26 
	#__√ed_mb°©e_t


	)

27 
	#__√ed_wöt_t


	)

28 
	~<wch¨.h
>

29 
	#__√ed_size_t


	)

30 
	#__√ed_wch¨_t


	)

31 
	~<°ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gc⁄v_°ï
;

66 
	g__gc⁄v_°ï_d©a
;

67 
	g__gc⁄v_lﬂded_obje˘
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 
	s__gc⁄v_°ï


86 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

87 c⁄° *
__mod«me
;

89 
__cou¡î
;

91 *
__‰om_«me
;

92 *
__to_«me
;

94 
__gc⁄v_f˘
 
__f˘
;

95 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

96 
__gc⁄v_öô_f˘
 
__öô_f˘
;

97 
__gc⁄v_íd_f˘
 
__íd_f˘
;

101 
__mö_√eded_‰om
;

102 
__max_√eded_‰om
;

103 
__mö_√eded_to
;

104 
__max_√eded_to
;

107 
__°©eful
;

109 *
__d©a
;

114 
	s__gc⁄v_°ï_d©a


116 *
__outbuf
;

117 *
__outbu„nd
;

121 
__Êags
;

125 
__övoˇti⁄_cou¡î
;

129 
__öã∫Æ_u£
;

131 
__mb°©e_t
 *
__°©ï
;

132 
__mb°©e_t
 
__°©e
;

138 
	s__gc⁄v_öfo


140 
size_t
 
__n°ïs
;

141 
__gc⁄v_°ï
 *
__°ïs
;

142 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

143 } *
	t__gc⁄v_t
;

146 
	`__gc⁄v_å™¶ôî©e
 (
__gc⁄v_°ï
 *
°ï
,

147 
__gc⁄v_°ï_d©a
 *
°ï_d©a
,

148 c⁄° *
öbuf°¨t
,

149 c⁄° **
öbuÂ
,

150 c⁄° *
öbu„nd
,

151 **
outbuf°¨t
,

152 
size_t
 *
úªvîsibÀ
);

	@/usr/include/linux/stddef.h

	@/usr/include/vppinfra/mheap_bootstrap.h

38 #i‚de‡
ö˛uded_mem_mhóp_h


39 
	#ö˛uded_mem_mhóp_h


	)

44 
	~<vµö‰a/vec_boŸ°øp.h
>

45 
	~<vµö‰a/îr‹_boŸ°øp.h
>

46 
	~<vµö‰a/os.h
>

47 
	~<vµö‰a/ve˘‹.h
>

54 #i‡
CLIB_VEC64
 > 0

55 
u64
 
	m¥ev_n_u£r_d©a
:63;

58 
	#MHEAP_N_USER_DATA_INVALID
 (0x7fffffffffffffffULL)

	)

59 
	#MHEAP_GROUNDED
 (~0ULL)

	)

62 
u64
 
	m¥ev_is_‰ì
:1;

65 
u64
 
	mn_u£r_d©a
:63;

69 
u64
 
	mis_‰ì
:1;

72 
u32
 
	m¥ev_n_u£r_d©a
:31;

75 
	#MHEAP_N_USER_DATA_INVALID
 (0x7fffffff)

	)

76 
	#MHEAP_GROUNDED
 (~0)

	)

79 
u32
 
	m¥ev_is_‰ì
:1;

82 
u32
 
	mn_u£r_d©a
:31;

86 
u32
 
	mis_‰ì
:1;

91 #i‡
CLIB_VEC64
 > 0

94 
u64
 
	mu£r_d©a
[0];

102 
u64
 
	m√xt_uoff£t
, 
	m¥ev_uoff£t
;

103 } 
	m‰ì_ñt
;

107 
u32
 
	mu£r_d©a
[0];

115 
u32
 
	m√xt_uoff£t
, 
	m¥ev_uoff£t
;

116 } 
	m‰ì_ñt
;

119 } 
	tmhóp_ñt_t
;

122 
	#MHEAP_ELT_OVERHEAD_BYTES
 ( (
mhóp_ñt_t
Ë- 
	`STRUCT_OFFSET_OF
 (mhóp_ñt_t, 
u£r_d©a
))

	)

125 
	#MHEAP_MIN_USER_DATA_BYTES
 
MHEAP_ELT_OVERHEAD_BYTES


	)

128 
	#MHEAP_USER_DATA_WORD_BYTES
 
	`STRUCT_SIZE_OF
 (
mhóp_ñt_t
, 
u£r_d©a
[0])

	)

133 
uw‹d
 
	mˇŒîs
[12];

136 #i‡
CLIB_VEC64
 > 0

137 
u64
 
	mn_Æloˇti⁄s
;

139 
u32
 
	mn_Æloˇti⁄s
;

143 
u32
 
	mn_byãs
;

146 
uw‹d
 
	moff£t
;

147 } 
	tmhóp_åa˚_t
;

151 
mhóp_åa˚_t
 *
	måa˚s
;

154 
u32
 *
	måa˚_‰ì_li°
;

157 
uw‹d
 *
	måa˚_by_ˇŒîs
;

160 
uw‹d
 *
	måa˚_ödex_by_off£t
;

161 } 
	tmhóp_åa˚_maö_t
;

164 #ifde‡
CLIB_HAVE_VEC128


165 
	#MHEAP_HAVE_SMALL_OBJECT_CACHE
 1

	)

167 
	#MHEAP_HAVE_SMALL_OBJECT_CACHE
 0

	)

173 #i‡
MHEAP_HAVE_SMALL_OBJECT_CACHE
 > 0

174 
	#MHEAP_LOG2_N_SMALL_OBJECT_BINS
 8

	)

175 
	#MHEAP_N_SMALL_OBJECT_BINS
 (1 << 
MHEAP_LOG2_N_SMALL_OBJECT_BINS
)

	)

177 
	#MHEAP_LOG2_N_SMALL_OBJECT_BINS
 0

	)

178 
	#MHEAP_N_SMALL_OBJECT_BINS
 0

	)

181 
	#MHEAP_N_BINS
 \

182 (
MHEAP_N_SMALL_OBJECT_BINS
 \

183 + (
	`STRUCT_BITS_OF
 (
mhóp_ñt_t
, 
u£r_d©a
[0]Ë- 
MHEAP_LOG2_N_SMALL_OBJECT_BINS
))

	)

189 
u64
 
	mn_£¨ch_©ãm±s
;

190 
u64
 
	mn_obje˘s_£¨ched
;

191 
u64
 
	mn_obje˘s_found
;

192 } 
	m‰ì_li°
;

194 
u64
 
	mn_ve˘‹_ex∑nds
;

196 
u64
 
	mn_smÆl_obje˘_ˇche_hôs
;

197 
u64
 
	mn_smÆl_obje˘_ˇche_©ãm±s
;

199 
u64
 
	mn_gës
, 
	mn_puts
;

200 
u64
 
	mn_˛ocks_gë
, 
	mn_˛ocks_put
;

201 } 
	tmhóp_°©s_t
;

208 #ifde‡
CLIB_HAVE_VEC128


209 
u8x16
 
	mas_u8x16
[
BITS
 (
uw‹d
) / 16];

213 
u8
 
	mas_u8
[
BITS
 (
uw‹d
)];

214 } 
	mbös
;

216 
uw‹d
 
	moff£ts
[
BITS
 (uword)];

218 
u32
 
	mª∂a˚mít_ödex
;

219 } 
	tmhóp_smÆl_obje˘_ˇche_t
;

225 #i‡
CLIB_VEC64
 > 0

226 
u64
 
	mfú°_‰ì_ñt_uoff£t_by_bö
[
MHEAP_N_BINS
];

228 
u32
 
	mfú°_‰ì_ñt_uoff£t_by_bö
[
MHEAP_N_BINS
];

232 
uw‹d
 
	mn⁄_em±y_‰ì_ñt_hóds
[(
MHEAP_N_BINS
 + 
BITS
 (uword) - 1) /

233 
BITS
 (
uw‹d
)];

235 
mhóp_smÆl_obje˘_ˇche_t
 
	msmÆl_obje˘_ˇche
;

237 
u32
 
	mÊags
;

238 
	#MHEAP_FLAG_TRACE
 (1 << 0)

	)

239 
	#MHEAP_FLAG_DISABLE_VM
 (1 << 1)

	)

240 
	#MHEAP_FLAG_THREAD_SAFE
 (1 << 2)

	)

241 
	#MHEAP_FLAG_SMALL_OBJECT_CACHE
 (1 << 3)

	)

242 
	#MHEAP_FLAG_VALIDATE
 (1 << 4)

	)

245 vﬁ©ûê
u32
 
	mlock
;

246 vﬁ©ûê
u32
 
	mow√r_˝u
;

247 
	mªcursi⁄_cou¡
;

250 
u64
 
	mn_ñts
;

254 
u64
 
	mmax_size
;

256 
uw‹d
 
	mvm_Æloc_off£t_‰om_hódî
;

257 
uw‹d
 
	mvm_Æloc_size
;

262 
u64
 
	mvÆid©e_£rül
;

264 
mhóp_åa˚_maö_t
 
	måa˚_maö
;

266 
mhóp_°©s_t
 
	m°©s
;

267 } 
	tmhóp_t
;

269 
Æways_ölöe
 
mhóp_t
 *

270 
	$mhóp_hódî
 (
u8
 * 
v
)

272  
	`vec_Æig√d_hódî
 (
v
,  (
mhóp_t
), 16);

273 
	}
}

275 
Æways_ölöe
 
u8
 *

276 
	$mhóp_ve˘‹
 (
mhóp_t
 * 
h
)

278  
	`vec_Æig√d_hódî_íd
 (
h
,  (
mhóp_t
), 16);

279 
	}
}

281 
Æways_ölöe
 
uw‹d


282 
	$mhóp_ñt_uoff£t
 (*
v
, 
mhóp_ñt_t
 * 
e
)

284  (
uw‹d
Ë
e
->
u£r_d©a
 - (uw‹dË
v
;

285 
	}
}

287 
Æways_ölöe
 
mhóp_ñt_t
 *

288 
	$mhóp_u£r_poöãr_to_ñt
 (*
v
)

290  
v
 - 
	`STRUCT_OFFSET_OF
 (
mhóp_ñt_t
, 
u£r_d©a
);

291 
	}
}

295 
Æways_ölöe
 
uw‹d


296 
	$mhóp_off£t_is_vÆid
 (*
v
, 
uw‹d
 
uo
)

298  
uo
 >
MHEAP_ELT_OVERHEAD_BYTES
 && uÿ<
	`vec_Àn
 (
v
);

299 
	}
}

301 
Æways_ölöe
 
mhóp_ñt_t
 *

302 
	$mhóp_ñt_©_uoff£t
 (*
v
, 
uw‹d
 
uo
)

304 
	`ASSERT
 (
	`mhóp_off£t_is_vÆid
 (
v
, 
uo
));

305  (
mhóp_ñt_t
 *Ë(
v
 + 
uo
 - 
	`STRUCT_OFFSET_OF
 (mhóp_ñt_t, 
u£r_d©a
));

306 
	}
}

308 
Æways_ölöe
 *

309 
	$mhóp_ñt_d©a
 (*
v
, 
mhóp_ñt_t
 * 
e
)

311  
v
 + 
	`mhóp_ñt_uoff£t
 (v, 
e
);

312 
	}
}

314 
Æways_ölöe
 
uw‹d


315 
	$mhóp_ñt_d©a_byãs
 (
mhóp_ñt_t
 * 
e
)

317  
e
->
n_u£r_d©a
 *  (e->
u£r_d©a
[0]);

318 
	}
}

320 
Æways_ölöe
 
uw‹d


321 
	$mhóp_d©a_byãs
 (*
v
, 
uw‹d
 
uo
)

323 
mhóp_ñt_t
 *
e
 = 
	`mhóp_ñt_©_uoff£t
 (
v
, 
uo
);

324  
	`mhóp_ñt_d©a_byãs
 (
e
);

325 
	}
}

327 
	#mhóp_Àn
(
v
,
d
Ë(
	`mhóp_d©a_byãs
((v),(*Ë(dË- (*Ë(v)Ë/  ((d)[0]))

	)

329 
Æways_ölöe
 
mhóp_ñt_t
 *

330 
	$mhóp_√xt_ñt
 (
mhóp_ñt_t
 * 
e
)

332 
	`ASSERT
 (
e
->
n_u£r_d©a
 < 
MHEAP_N_USER_DATA_INVALID
);

333  (
mhóp_ñt_t
 *Ë(
e
->
u£r_d©a
 +É->
n_u£r_d©a
);

334 
	}
}

336 
Æways_ölöe
 
mhóp_ñt_t
 *

337 
	$mhóp_¥ev_ñt
 (
mhóp_ñt_t
 * 
e
)

339 
	`ASSERT
 (
e
->
¥ev_n_u£r_d©a
 < 
MHEAP_N_USER_DATA_INVALID
);

340  ((*Ë
e


341 - 
e
->
¥ev_n_u£r_d©a
 *  (e->
u£r_d©a
[0])

342 - 
MHEAP_ELT_OVERHEAD_BYTES
);

343 
	}
}

347 
Æways_ölöe
 
uw‹d


348 
	$mhóp_ñts
 (*
v
)

350  
v
 ? 
	`mhóp_hódî
 (v)->
n_ñts
 : 0;

351 
	}
}

353 
Æways_ölöe
 
uw‹d


354 
	$mhóp_max_size
 (*
v
)

356  
v
 ? 
	`mhóp_hódî
 (v)->
max_size
 : ~0;

357 
	}
}

360 
mhóp_put
 (*
v
, 
uw‹d
 
off£t
);

363 *
mhóp_gë_Æig√d
 (*
v
, 
uw‹d
 
size
, uw‹d 
Æign
, uw‹d 
Æign_off£t
,

364 
uw‹d
 * 
off£t_ªtu∫
);

	@/usr/include/vppinfra/os.h

38 #i‚de‡
ö˛uded_os_h


39 
	#ö˛uded_os_h


	)

41 
	~<vµö‰a/˛ib.h
>

42 
	~<vµö‰a/ty≥s.h
>

45 
os_∑nic
 ();

48 
os_exô
 (
code
);

51 
os_puts
 (
u8
 * 
°rög
, 
uw‹d
 
Àngth
, uw‹d 
is_îr‹
);

54 
os_out_of_mem‹y
 ();

57 
f64
 
os_˝u_˛ock_‰equícy
 ();

59 
__thªad
 
uw‹d
 
__os_thªad_ödex
;

61 
°©ic_Æways_ölöe
 
uw‹d


62 
	$os_gë_thªad_ödex
 ()

64  
__os_thªad_ödex
;

65 
	}
}

67 
°©ic_Æways_ölöe
 
uw‹d


68 
	$os_gë_˝u_numbî
 (Ë
	`__©åibuã__
 ((
dïªˇãd
));

70 
°©ic_Æways_ölöe
 
uw‹d


71 
	$os_gë_˝u_numbî
 ()

73  
__os_thªad_ödex
;

74 
	}
}

76 
uw‹d
 
os_gë_¡hªads
 ();

78 
	~<vµö‰a/smp.h
>

	@/usr/include/vppinfra/valgrind.h

73 #i‚de‡
__VALGRIND_H


74 
	#__VALGRIND_H


	)

76 
	~<°d¨g.h
>

88 #unde‡
PLAT_x86_löux


89 #unde‡
PLAT_amd64_löux


90 #unde‡
PLAT_µc32_löux


91 #unde‡
PLAT_µc64_löux


92 #unde‡
PLAT_µc32_aix5


93 #unde‡
PLAT_µc64_aix5


96 #i‡
deföed
(
_AIX
Ë&& deföed(
__64BIT__
)

97 
	#PLAT_µc64_aix5
 1

	)

98 #ñi‡
deföed
(
_AIX
Ë&& !deföed(
__64BIT__
)

99 
	#PLAT_µc32_aix5
 1

	)

100 #ñi‡
deföed
(
__APPLE__
Ë&& deföed(
__i386__
)

101 
	#PLAT_x86_d¨wö
 1

	)

102 #ñi‡
deföed
(
__APPLE__
Ë&& deföed(
__x86_64__
)

103 
	#PLAT_amd64_d¨wö
 1

	)

104 #ñi‡
deföed
(
__i386__
)

105 
	#PLAT_x86_löux
 1

	)

106 #ñi‡
deföed
(
__x86_64__
)

107 
	#PLAT_amd64_löux
 1

	)

108 #ñi‡
deföed
(
__powîpc__
Ë&& !deföed(
__powîpc64__
)

109 
	#PLAT_µc32_löux
 1

	)

110 #ñi‡
deföed
(
__powîpc__
Ë&& deföed(
__powîpc64__
)

111 
	#PLAT_µc64_löux
 1

	)

115 #i‡!
deföed
(
NVALGRIND
)

116 
	#NVALGRIND
 1

	)

126 #i‡
deföed
(
NVALGRIND
)

131 
	#VALGRIND_DO_CLIENT_REQUEST
( \

132 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

133 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

135 (
_zzq_ævÆ
Ë(
_zzq_deÁu…
); \

136 }

	)

177 #i‡
deföed
(
PLAT_x86_löux
Ë|| deföed(
PLAT_x86_d¨wö
)

181 
	mƒaddr
;

183 
	tOrigFn
;

185 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

187 "rﬁ»$29, %%edò;Ñﬁ»$19, %%edi\n\t"

	)

189 
	#VALGRIND_DO_CLIENT_REQUEST
( \

190 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

191 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

192 { vﬁ©ûê
_zzq_¨gs
[6]; \

193 vﬁ©ûê
_zzq_ªsu…
; \

194 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

195 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

196 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

197 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

198 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

199 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

200 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

203 : "=d" (
_zzq_ªsu…
) \

204 : "a" (&
_zzq_¨gs
[0]), "0" (
_zzq_deÁu…
) \

207 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

208 }

	)

210 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

211 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

212 vﬁ©ûê
__addr
; \

213 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

216 : "˜" (
__addr
) \

220 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

221 }

	)

223 
	#VALGRIND_CALL_NOREDIR_EAX
 \

224 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

226 "xchg»%%edx,%%edx\n\t"

	)

231 #i‡
deföed
(
PLAT_amd64_löux
Ë|| deföed(
PLAT_amd64_d¨wö
)

235 
	mƒaddr
;

237 
	tOrigFn
;

239 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

241 "rﬁq $61, %%rdò;Ñﬁq $51, %%rdi\n\t"

	)

243 
	#VALGRIND_DO_CLIENT_REQUEST
( \

244 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

245 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

246 { vﬁ©ûê
_zzq_¨gs
[6]; \

247 vﬁ©ûê
_zzq_ªsu…
; \

248 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

249 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

250 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

251 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

252 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

253 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

254 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

257 : "=d" (
_zzq_ªsu…
) \

258 : "a" (&
_zzq_¨gs
[0]), "0" (
_zzq_deÁu…
) \

261 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

262 }

	)

264 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

265 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

266 vﬁ©ûê
__addr
; \

267 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

270 : "˜" (
__addr
) \

274 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

275 }

	)

277 
	#VALGRIND_CALL_NOREDIR_RAX
 \

278 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

280 "xchgq %%rdx,%%rdx\n\t"

	)

285 #i‡
deföed
(
PLAT_µc32_löux
)

289 
	mƒaddr
;

291 
	tOrigFn
;

293 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

295 "æwöm 0,0,29,0,0 ;Ñlwöm 0,0,19,0,0\n\t"

	)

297 
	#VALGRIND_DO_CLIENT_REQUEST
( \

298 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

299 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

301 { 
_zzq_¨gs
[6]; \

302 
_zzq_ªsu…
; \

303 * 
_zzq_±r
; \

304 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

305 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

306 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

307 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

308 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

309 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

310 
_zzq_±r
 = 
_zzq_¨gs
; \

311 
__asm__
 volatile("mr 3,%1\n\t" \

313 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

317 : "=b" (
_zzq_ªsu…
) \

318 : "b" (
_zzq_deÁu…
), "b" (
_zzq_±r
) \

320 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

321 }

	)

323 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

324 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

325 
__addr
; \

326 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

330 : "=b" (
__addr
) \

334 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

335 }

	)

337 
	#VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

338 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

340 "‹ 3,3,3\n\t"

	)

345 #i‡
deföed
(
PLAT_µc64_löux
)

349 
	mƒaddr
;

350 
	mr2
;

352 
	tOrigFn
;

354 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

356 "rŸldò0,0,61 ;ÑŸldò0,0,51\n\t"

	)

358 
	#VALGRIND_DO_CLIENT_REQUEST
( \

359 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

360 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

362 { 
_zzq_¨gs
[6]; \

363 
_zzq_ªsu…
 
	`__asm__
("r3"); \

364 * 
_zzq_±r
 
	`__asm__
("r4"); \

365 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

366 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

367 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

368 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

369 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

370 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

371 
_zzq_±r
 = 
_zzq_¨gs
; \

372 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

375 : "Ù" (
_zzq_ªsu…
) \

376 : "0" (
_zzq_deÁu…
), "r" (
_zzq_±r
) \

378 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

379 }

	)

381 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

382 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

383 
__addr
 
	`__asm__
("r3"); \

384 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

387 : "Ù" (
__addr
) \

391 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

392 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

395 : "Ù" (
__addr
) \

399 
_zzq_‹ig
->
r2
 = 
__addr
; \

400 }

	)

402 
	#VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

403 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

405 "‹ 3,3,3\n\t"

	)

411 #i‡
deföed
(
PLAT_µc32_aix5
)

415 
	mƒaddr
;

416 
	mr2
;

418 
	tOrigFn
;

420 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

422 "æwöm 0,0,29,0,0 ;Ñlwöm 0,0,19,0,0\n\t"

	)

424 
	#VALGRIND_DO_CLIENT_REQUEST
( \

425 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

426 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

428 { 
_zzq_¨gs
[7]; \

429 
_zzq_ªsu…
; \

430 * 
_zzq_±r
; \

431 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

432 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

433 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

434 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

435 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

436 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

437 
_zzq_¨gs
[6] = ()(
_zzq_deÁu…
); \

438 
_zzq_±r
 = 
_zzq_¨gs
; \

439 
__asm__
 volatile("mr 4,%1\n\t" \

441 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

445 : "=b" (
_zzq_ªsu…
) \

446 : "b" (
_zzq_±r
) \

448 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

449 }

	)

451 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

452 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

453 
__addr
; \

454 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

458 : "=b" (
__addr
) \

462 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

463 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

467 : "=b" (
__addr
) \

471 
_zzq_‹ig
->
r2
 = 
__addr
; \

472 }

	)

474 
	#VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

475 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

477 "‹ 3,3,3\n\t"

	)

483 #i‡
deföed
(
PLAT_µc64_aix5
)

487 
	mƒaddr
;

488 
	mr2
;

490 
	tOrigFn
;

492 
	#__SPECIAL_INSTRUCTION_PREAMBLE
 \

494 "rŸldò0,0,61 ;ÑŸldò0,0,51\n\t"

	)

496 
	#VALGRIND_DO_CLIENT_REQUEST
( \

497 
_zzq_ævÆ
, 
_zzq_deÁu…
, 
_zzq_ªque°
, \

498 
_zzq_¨g1
, 
_zzq_¨g2
, 
_zzq_¨g3
, 
_zzq_¨g4
, 
_zzq_¨g5
) \

500 { 
_zzq_¨gs
[7]; \

501 
_zzq_ªsu…
; \

502 * 
_zzq_±r
; \

503 
_zzq_¨gs
[0] = ()(
_zzq_ªque°
); \

504 
_zzq_¨gs
[1] = ()(
_zzq_¨g1
); \

505 
_zzq_¨gs
[2] = ()(
_zzq_¨g2
); \

506 
_zzq_¨gs
[3] = ()(
_zzq_¨g3
); \

507 
_zzq_¨gs
[4] = ()(
_zzq_¨g4
); \

508 
_zzq_¨gs
[5] = ()(
_zzq_¨g5
); \

509 
_zzq_¨gs
[6] = ()(
_zzq_deÁu…
); \

510 
_zzq_±r
 = 
_zzq_¨gs
; \

511 
__asm__
 volatile("mr 4,%1\n\t" \

513 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

517 : "=b" (
_zzq_ªsu…
) \

518 : "b" (
_zzq_±r
) \

520 
_zzq_ævÆ
 = 
_zzq_ªsu…
; \

521 }

	)

523 
	#VALGRIND_GET_NR_CONTEXT
(
_zzq_ævÆ
) \

524 { vﬁ©ûê
OrigFn
* 
_zzq_‹ig
 = &(
_zzq_ævÆ
); \

525 
__addr
; \

526 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

530 : "=b" (
__addr
) \

534 
_zzq_‹ig
->
ƒaddr
 = 
__addr
; \

535 
__asm__
 vﬁ©ûe(
__SPECIAL_INSTRUCTION_PREAMBLE
 \

539 : "=b" (
__addr
) \

543 
_zzq_‹ig
->
r2
 = 
__addr
; \

544 }

	)

546 
	#VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

547 
__SPECIAL_INSTRUCTION_PREAMBLE
 \

549 "‹ 3,3,3\n\t"

	)

586 
	#VG_CONCAT4
(
_Ø
,
_bb
,
_cc
,
_dd
Ë_Ø##_bb##_cc##
	)
_dd

588 
	#I_WRAP_SONAME_FNNAME_ZU
(
s⁄ame
,
‚«me
) \

589 
	`VG_CONCAT4
(
_vgwZU_
,
s⁄ame
,
_
,
‚«me
)

	)

591 
	#I_WRAP_SONAME_FNNAME_ZZ
(
s⁄ame
,
‚«me
) \

592 
	`VG_CONCAT4
(
_vgwZZ_
,
s⁄ame
,
_
,
‚«me
)

	)

598 
	#VALGRIND_GET_ORIG_FN
(
_lvÆ
Ë
	`VALGRIND_GET_NR_CONTEXT
(_lvÆ)

	)

603 
	#CALL_FN_v_v
(
‚±r
) \

604 dÿ{ vﬁ©ûê
_junk
; \

605 
	`CALL_FN_W_v
(
_junk
,
‚±r
); } 0)

	)

607 
	#CALL_FN_v_W
(
‚±r
, 
¨g1
) \

608 dÿ{ vﬁ©ûê
_junk
; \

609 
	`CALL_FN_W_W
(
_junk
,
‚±r
,
¨g1
); } 0)

	)

611 
	#CALL_FN_v_WW
(
‚±r
, 
¨g1
,
¨g2
) \

612 dÿ{ vﬁ©ûê
_junk
; \

613 
	`CALL_FN_W_WW
(
_junk
,
‚±r
,
¨g1
,
¨g2
); } 0)

	)

615 
	#CALL_FN_v_WWW
(
‚±r
, 
¨g1
,
¨g2
,
¨g3
) \

616 dÿ{ vﬁ©ûê
_junk
; \

617 
	`CALL_FN_W_WWW
(
_junk
,
‚±r
,
¨g1
,
¨g2
,
¨g3
); } 0)

	)

619 
	#CALL_FN_v_WWWW
(
‚±r
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

620 dÿ{ vﬁ©ûê
_junk
; \

621 
	`CALL_FN_W_WWWW
(
_junk
,
‚±r
,
¨g1
,
¨g2
,
¨g3
,
¨g4
); } 0)

	)

623 
	#CALL_FN_v_5W
(
‚±r
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

624 dÿ{ vﬁ©ûê
_junk
; \

625 
	`CALL_FN_W_5W
(
_junk
,
‚±r
,
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
); } 0)

	)

627 
	#CALL_FN_v_6W
(
‚±r
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

628 dÿ{ vﬁ©ûê
_junk
; \

629 
	`CALL_FN_W_6W
(
_junk
,
‚±r
,
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
); } 0)

	)

631 
	#CALL_FN_v_7W
(
‚±r
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
,
¨g7
) \

632 dÿ{ vﬁ©ûê
_junk
; \

633 
	`CALL_FN_W_7W
(
_junk
,
‚±r
,
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
,
¨g7
); } 0)

	)

637 #i‡
deföed
(
PLAT_x86_löux
Ë|| deföed(
PLAT_x86_d¨wö
)

641 
	#__CALLER_SAVED_REGS
 "ecx", "edx"

	)

646 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

648 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

649 vﬁ©ûê
_¨gvec
[1]; \

650 vﬁ©ûê
_ªs
; \

651 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

652 
__asm__
 volatile( \

654 
VALGRIND_CALL_NOREDIR_EAX
 \

655 : "˜" (
_ªs
) \

656 : "a" (&
_¨gvec
[0]) \

657 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

659 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

660 } 0)

	)

662 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

664 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

665 vﬁ©ûê
_¨gvec
[2]; \

666 vﬁ©ûê
_ªs
; \

667 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

668 
_¨gvec
[1] = ()(
¨g1
); \

669 
__asm__
 volatile( \

672 
VALGRIND_CALL_NOREDIR_EAX
 \

674 : "˜" (
_ªs
) \

675 : "a" (&
_¨gvec
[0]) \

676 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

678 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

679 } 0)

	)

681 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

683 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

684 vﬁ©ûê
_¨gvec
[3]; \

685 vﬁ©ûê
_ªs
; \

686 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

687 
_¨gvec
[1] = ()(
¨g1
); \

688 
_¨gvec
[2] = ()(
¨g2
); \

689 
__asm__
 volatile( \

693 
VALGRIND_CALL_NOREDIR_EAX
 \

695 : "˜" (
_ªs
) \

696 : "a" (&
_¨gvec
[0]) \

697 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

699 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

700 } 0)

	)

702 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

704 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

705 vﬁ©ûê
_¨gvec
[4]; \

706 vﬁ©ûê
_ªs
; \

707 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

708 
_¨gvec
[1] = ()(
¨g1
); \

709 
_¨gvec
[2] = ()(
¨g2
); \

710 
_¨gvec
[3] = ()(
¨g3
); \

711 
__asm__
 volatile( \

716 
VALGRIND_CALL_NOREDIR_EAX
 \

718 : "˜" (
_ªs
) \

719 : "a" (&
_¨gvec
[0]) \

720 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

722 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

723 } 0)

	)

725 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

727 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

728 vﬁ©ûê
_¨gvec
[5]; \

729 vﬁ©ûê
_ªs
; \

730 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

731 
_¨gvec
[1] = ()(
¨g1
); \

732 
_¨gvec
[2] = ()(
¨g2
); \

733 
_¨gvec
[3] = ()(
¨g3
); \

734 
_¨gvec
[4] = ()(
¨g4
); \

735 
__asm__
 volatile( \

741 
VALGRIND_CALL_NOREDIR_EAX
 \

743 : "˜" (
_ªs
) \

744 : "a" (&
_¨gvec
[0]) \

745 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

747 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

748 } 0)

	)

750 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

752 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

753 vﬁ©ûê
_¨gvec
[6]; \

754 vﬁ©ûê
_ªs
; \

755 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

756 
_¨gvec
[1] = ()(
¨g1
); \

757 
_¨gvec
[2] = ()(
¨g2
); \

758 
_¨gvec
[3] = ()(
¨g3
); \

759 
_¨gvec
[4] = ()(
¨g4
); \

760 
_¨gvec
[5] = ()(
¨g5
); \

761 
__asm__
 volatile( \

768 
VALGRIND_CALL_NOREDIR_EAX
 \

770 : "˜" (
_ªs
) \

771 : "a" (&
_¨gvec
[0]) \

772 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

774 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

775 } 0)

	)

777 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

779 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

780 vﬁ©ûê
_¨gvec
[7]; \

781 vﬁ©ûê
_ªs
; \

782 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

783 
_¨gvec
[1] = ()(
¨g1
); \

784 
_¨gvec
[2] = ()(
¨g2
); \

785 
_¨gvec
[3] = ()(
¨g3
); \

786 
_¨gvec
[4] = ()(
¨g4
); \

787 
_¨gvec
[5] = ()(
¨g5
); \

788 
_¨gvec
[6] = ()(
¨g6
); \

789 
__asm__
 volatile( \

797 
VALGRIND_CALL_NOREDIR_EAX
 \

799 : "˜" (
_ªs
) \

800 : "a" (&
_¨gvec
[0]) \

801 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

803 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

804 } 0)

	)

806 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

807 
¨g7
) \

809 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

810 vﬁ©ûê
_¨gvec
[8]; \

811 vﬁ©ûê
_ªs
; \

812 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

813 
_¨gvec
[1] = ()(
¨g1
); \

814 
_¨gvec
[2] = ()(
¨g2
); \

815 
_¨gvec
[3] = ()(
¨g3
); \

816 
_¨gvec
[4] = ()(
¨g4
); \

817 
_¨gvec
[5] = ()(
¨g5
); \

818 
_¨gvec
[6] = ()(
¨g6
); \

819 
_¨gvec
[7] = ()(
¨g7
); \

820 
__asm__
 volatile( \

829 
VALGRIND_CALL_NOREDIR_EAX
 \

831 : "˜" (
_ªs
) \

832 : "a" (&
_¨gvec
[0]) \

833 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

835 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

836 } 0)

	)

838 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

839 
¨g7
,
¨g8
) \

841 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

842 vﬁ©ûê
_¨gvec
[9]; \

843 vﬁ©ûê
_ªs
; \

844 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

845 
_¨gvec
[1] = ()(
¨g1
); \

846 
_¨gvec
[2] = ()(
¨g2
); \

847 
_¨gvec
[3] = ()(
¨g3
); \

848 
_¨gvec
[4] = ()(
¨g4
); \

849 
_¨gvec
[5] = ()(
¨g5
); \

850 
_¨gvec
[6] = ()(
¨g6
); \

851 
_¨gvec
[7] = ()(
¨g7
); \

852 
_¨gvec
[8] = ()(
¨g8
); \

853 
__asm__
 volatile( \

863 
VALGRIND_CALL_NOREDIR_EAX
 \

865 : "˜" (
_ªs
) \

866 : "a" (&
_¨gvec
[0]) \

867 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

869 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

870 } 0)

	)

872 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

873 
¨g7
,
¨g8
,
¨g9
) \

875 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

876 vﬁ©ûê
_¨gvec
[10]; \

877 vﬁ©ûê
_ªs
; \

878 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

879 
_¨gvec
[1] = ()(
¨g1
); \

880 
_¨gvec
[2] = ()(
¨g2
); \

881 
_¨gvec
[3] = ()(
¨g3
); \

882 
_¨gvec
[4] = ()(
¨g4
); \

883 
_¨gvec
[5] = ()(
¨g5
); \

884 
_¨gvec
[6] = ()(
¨g6
); \

885 
_¨gvec
[7] = ()(
¨g7
); \

886 
_¨gvec
[8] = ()(
¨g8
); \

887 
_¨gvec
[9] = ()(
¨g9
); \

888 
__asm__
 volatile( \

899 
VALGRIND_CALL_NOREDIR_EAX
 \

901 : "˜" (
_ªs
) \

902 : "a" (&
_¨gvec
[0]) \

903 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

905 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

906 } 0)

	)

908 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

909 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

911 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

912 vﬁ©ûê
_¨gvec
[11]; \

913 vﬁ©ûê
_ªs
; \

914 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

915 
_¨gvec
[1] = ()(
¨g1
); \

916 
_¨gvec
[2] = ()(
¨g2
); \

917 
_¨gvec
[3] = ()(
¨g3
); \

918 
_¨gvec
[4] = ()(
¨g4
); \

919 
_¨gvec
[5] = ()(
¨g5
); \

920 
_¨gvec
[6] = ()(
¨g6
); \

921 
_¨gvec
[7] = ()(
¨g7
); \

922 
_¨gvec
[8] = ()(
¨g8
); \

923 
_¨gvec
[9] = ()(
¨g9
); \

924 
_¨gvec
[10] = ()(
¨g10
); \

925 
__asm__
 volatile( \

937 
VALGRIND_CALL_NOREDIR_EAX
 \

939 : "˜" (
_ªs
) \

940 : "a" (&
_¨gvec
[0]) \

941 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

943 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

944 } 0)

	)

946 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
, \

947 
¨g6
,
¨g7
,
¨g8
,
¨g9
,
¨g10
, \

948 
¨g11
) \

950 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

951 vﬁ©ûê
_¨gvec
[12]; \

952 vﬁ©ûê
_ªs
; \

953 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

954 
_¨gvec
[1] = ()(
¨g1
); \

955 
_¨gvec
[2] = ()(
¨g2
); \

956 
_¨gvec
[3] = ()(
¨g3
); \

957 
_¨gvec
[4] = ()(
¨g4
); \

958 
_¨gvec
[5] = ()(
¨g5
); \

959 
_¨gvec
[6] = ()(
¨g6
); \

960 
_¨gvec
[7] = ()(
¨g7
); \

961 
_¨gvec
[8] = ()(
¨g8
); \

962 
_¨gvec
[9] = ()(
¨g9
); \

963 
_¨gvec
[10] = ()(
¨g10
); \

964 
_¨gvec
[11] = ()(
¨g11
); \

965 
__asm__
 volatile( \

978 
VALGRIND_CALL_NOREDIR_EAX
 \

980 : "˜" (
_ªs
) \

981 : "a" (&
_¨gvec
[0]) \

982 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

984 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

985 } 0)

	)

987 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
, \

988 
¨g6
,
¨g7
,
¨g8
,
¨g9
,
¨g10
, \

989 
¨g11
,
¨g12
) \

991 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

992 vﬁ©ûê
_¨gvec
[13]; \

993 vﬁ©ûê
_ªs
; \

994 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

995 
_¨gvec
[1] = ()(
¨g1
); \

996 
_¨gvec
[2] = ()(
¨g2
); \

997 
_¨gvec
[3] = ()(
¨g3
); \

998 
_¨gvec
[4] = ()(
¨g4
); \

999 
_¨gvec
[5] = ()(
¨g5
); \

1000 
_¨gvec
[6] = ()(
¨g6
); \

1001 
_¨gvec
[7] = ()(
¨g7
); \

1002 
_¨gvec
[8] = ()(
¨g8
); \

1003 
_¨gvec
[9] = ()(
¨g9
); \

1004 
_¨gvec
[10] = ()(
¨g10
); \

1005 
_¨gvec
[11] = ()(
¨g11
); \

1006 
_¨gvec
[12] = ()(
¨g12
); \

1007 
__asm__
 volatile( \

1021 
VALGRIND_CALL_NOREDIR_EAX
 \

1023 : "˜" (
_ªs
) \

1024 : "a" (&
_¨gvec
[0]) \

1025 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1027 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1028 } 0)

	)

1034 #i‡
deföed
(
PLAT_amd64_löux
Ë|| deföed(
PLAT_amd64_d¨wö
)

1039 
	#__CALLER_SAVED_REGS
 "rcx", "rdx", "rsi", \

1040 "rdi", "r8", "r9", "r10", "r11"

	)

1066 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

1068 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1069 vﬁ©ûê
_¨gvec
[1]; \

1070 vﬁ©ûê
_ªs
; \

1071 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1072 
__asm__
 volatile( \

1075 
VALGRIND_CALL_NOREDIR_RAX
 \

1077 : "˜" (
_ªs
) \

1078 : "a" (&
_¨gvec
[0]) \

1079 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1081 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1082 } 0)

	)

1084 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

1086 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1087 vﬁ©ûê
_¨gvec
[2]; \

1088 vﬁ©ûê
_ªs
; \

1089 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1090 
_¨gvec
[1] = ()(
¨g1
); \

1091 
__asm__
 volatile( \

1095 
VALGRIND_CALL_NOREDIR_RAX
 \

1097 : "˜" (
_ªs
) \

1098 : "a" (&
_¨gvec
[0]) \

1099 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1101 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1102 } 0)

	)

1104 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

1106 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1107 vﬁ©ûê
_¨gvec
[3]; \

1108 vﬁ©ûê
_ªs
; \

1109 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1110 
_¨gvec
[1] = ()(
¨g1
); \

1111 
_¨gvec
[2] = ()(
¨g2
); \

1112 
__asm__
 volatile( \

1117 
VALGRIND_CALL_NOREDIR_RAX
 \

1119 : "˜" (
_ªs
) \

1120 : "a" (&
_¨gvec
[0]) \

1121 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1123 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1124 } 0)

	)

1126 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

1128 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1129 vﬁ©ûê
_¨gvec
[4]; \

1130 vﬁ©ûê
_ªs
; \

1131 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1132 
_¨gvec
[1] = ()(
¨g1
); \

1133 
_¨gvec
[2] = ()(
¨g2
); \

1134 
_¨gvec
[3] = ()(
¨g3
); \

1135 
__asm__
 volatile( \

1141 
VALGRIND_CALL_NOREDIR_RAX
 \

1143 : "˜" (
_ªs
) \

1144 : "a" (&
_¨gvec
[0]) \

1145 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1147 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1148 } 0)

	)

1150 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

1152 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1153 vﬁ©ûê
_¨gvec
[5]; \

1154 vﬁ©ûê
_ªs
; \

1155 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1156 
_¨gvec
[1] = ()(
¨g1
); \

1157 
_¨gvec
[2] = ()(
¨g2
); \

1158 
_¨gvec
[3] = ()(
¨g3
); \

1159 
_¨gvec
[4] = ()(
¨g4
); \

1160 
__asm__
 volatile( \

1167 
VALGRIND_CALL_NOREDIR_RAX
 \

1169 : "˜" (
_ªs
) \

1170 : "a" (&
_¨gvec
[0]) \

1171 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1173 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1174 } 0)

	)

1176 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

1178 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1179 vﬁ©ûê
_¨gvec
[6]; \

1180 vﬁ©ûê
_ªs
; \

1181 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1182 
_¨gvec
[1] = ()(
¨g1
); \

1183 
_¨gvec
[2] = ()(
¨g2
); \

1184 
_¨gvec
[3] = ()(
¨g3
); \

1185 
_¨gvec
[4] = ()(
¨g4
); \

1186 
_¨gvec
[5] = ()(
¨g5
); \

1187 
__asm__
 volatile( \

1195 
VALGRIND_CALL_NOREDIR_RAX
 \

1197 : "˜" (
_ªs
) \

1198 : "a" (&
_¨gvec
[0]) \

1199 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1201 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1202 } 0)

	)

1204 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

1206 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1207 vﬁ©ûê
_¨gvec
[7]; \

1208 vﬁ©ûê
_ªs
; \

1209 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1210 
_¨gvec
[1] = ()(
¨g1
); \

1211 
_¨gvec
[2] = ()(
¨g2
); \

1212 
_¨gvec
[3] = ()(
¨g3
); \

1213 
_¨gvec
[4] = ()(
¨g4
); \

1214 
_¨gvec
[5] = ()(
¨g5
); \

1215 
_¨gvec
[6] = ()(
¨g6
); \

1216 
__asm__
 volatile( \

1226 
VALGRIND_CALL_NOREDIR_RAX
 \

1227 : "˜" (
_ªs
) \

1228 : "a" (&
_¨gvec
[0]) \

1229 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1231 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1232 } 0)

	)

1234 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1235 
¨g7
) \

1237 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1238 vﬁ©ûê
_¨gvec
[8]; \

1239 vﬁ©ûê
_ªs
; \

1240 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1241 
_¨gvec
[1] = ()(
¨g1
); \

1242 
_¨gvec
[2] = ()(
¨g2
); \

1243 
_¨gvec
[3] = ()(
¨g3
); \

1244 
_¨gvec
[4] = ()(
¨g4
); \

1245 
_¨gvec
[5] = ()(
¨g5
); \

1246 
_¨gvec
[6] = ()(
¨g6
); \

1247 
_¨gvec
[7] = ()(
¨g7
); \

1248 
__asm__
 volatile( \

1258 
VALGRIND_CALL_NOREDIR_RAX
 \

1261 : "˜" (
_ªs
) \

1262 : "a" (&
_¨gvec
[0]) \

1263 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1265 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1266 } 0)

	)

1268 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1269 
¨g7
,
¨g8
) \

1271 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1272 vﬁ©ûê
_¨gvec
[9]; \

1273 vﬁ©ûê
_ªs
; \

1274 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1275 
_¨gvec
[1] = ()(
¨g1
); \

1276 
_¨gvec
[2] = ()(
¨g2
); \

1277 
_¨gvec
[3] = ()(
¨g3
); \

1278 
_¨gvec
[4] = ()(
¨g4
); \

1279 
_¨gvec
[5] = ()(
¨g5
); \

1280 
_¨gvec
[6] = ()(
¨g6
); \

1281 
_¨gvec
[7] = ()(
¨g7
); \

1282 
_¨gvec
[8] = ()(
¨g8
); \

1283 
__asm__
 volatile( \

1294 
VALGRIND_CALL_NOREDIR_RAX
 \

1297 : "˜" (
_ªs
) \

1298 : "a" (&
_¨gvec
[0]) \

1299 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1301 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1302 } 0)

	)

1304 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1305 
¨g7
,
¨g8
,
¨g9
) \

1307 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1308 vﬁ©ûê
_¨gvec
[10]; \

1309 vﬁ©ûê
_ªs
; \

1310 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1311 
_¨gvec
[1] = ()(
¨g1
); \

1312 
_¨gvec
[2] = ()(
¨g2
); \

1313 
_¨gvec
[3] = ()(
¨g3
); \

1314 
_¨gvec
[4] = ()(
¨g4
); \

1315 
_¨gvec
[5] = ()(
¨g5
); \

1316 
_¨gvec
[6] = ()(
¨g6
); \

1317 
_¨gvec
[7] = ()(
¨g7
); \

1318 
_¨gvec
[8] = ()(
¨g8
); \

1319 
_¨gvec
[9] = ()(
¨g9
); \

1320 
__asm__
 volatile( \

1332 
VALGRIND_CALL_NOREDIR_RAX
 \

1335 : "˜" (
_ªs
) \

1336 : "a" (&
_¨gvec
[0]) \

1337 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1339 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1340 } 0)

	)

1342 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1343 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

1345 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1346 vﬁ©ûê
_¨gvec
[11]; \

1347 vﬁ©ûê
_ªs
; \

1348 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1349 
_¨gvec
[1] = ()(
¨g1
); \

1350 
_¨gvec
[2] = ()(
¨g2
); \

1351 
_¨gvec
[3] = ()(
¨g3
); \

1352 
_¨gvec
[4] = ()(
¨g4
); \

1353 
_¨gvec
[5] = ()(
¨g5
); \

1354 
_¨gvec
[6] = ()(
¨g6
); \

1355 
_¨gvec
[7] = ()(
¨g7
); \

1356 
_¨gvec
[8] = ()(
¨g8
); \

1357 
_¨gvec
[9] = ()(
¨g9
); \

1358 
_¨gvec
[10] = ()(
¨g10
); \

1359 
__asm__
 volatile( \

1372 
VALGRIND_CALL_NOREDIR_RAX
 \

1375 : "˜" (
_ªs
) \

1376 : "a" (&
_¨gvec
[0]) \

1377 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1379 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1380 } 0)

	)

1382 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1383 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
) \

1385 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1386 vﬁ©ûê
_¨gvec
[12]; \

1387 vﬁ©ûê
_ªs
; \

1388 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1389 
_¨gvec
[1] = ()(
¨g1
); \

1390 
_¨gvec
[2] = ()(
¨g2
); \

1391 
_¨gvec
[3] = ()(
¨g3
); \

1392 
_¨gvec
[4] = ()(
¨g4
); \

1393 
_¨gvec
[5] = ()(
¨g5
); \

1394 
_¨gvec
[6] = ()(
¨g6
); \

1395 
_¨gvec
[7] = ()(
¨g7
); \

1396 
_¨gvec
[8] = ()(
¨g8
); \

1397 
_¨gvec
[9] = ()(
¨g9
); \

1398 
_¨gvec
[10] = ()(
¨g10
); \

1399 
_¨gvec
[11] = ()(
¨g11
); \

1400 
__asm__
 volatile( \

1414 
VALGRIND_CALL_NOREDIR_RAX
 \

1417 : "˜" (
_ªs
) \

1418 : "a" (&
_¨gvec
[0]) \

1419 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1421 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1422 } 0)

	)

1424 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1425 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
,
¨g12
) \

1427 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1428 vﬁ©ûê
_¨gvec
[13]; \

1429 vﬁ©ûê
_ªs
; \

1430 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1431 
_¨gvec
[1] = ()(
¨g1
); \

1432 
_¨gvec
[2] = ()(
¨g2
); \

1433 
_¨gvec
[3] = ()(
¨g3
); \

1434 
_¨gvec
[4] = ()(
¨g4
); \

1435 
_¨gvec
[5] = ()(
¨g5
); \

1436 
_¨gvec
[6] = ()(
¨g6
); \

1437 
_¨gvec
[7] = ()(
¨g7
); \

1438 
_¨gvec
[8] = ()(
¨g8
); \

1439 
_¨gvec
[9] = ()(
¨g9
); \

1440 
_¨gvec
[10] = ()(
¨g10
); \

1441 
_¨gvec
[11] = ()(
¨g11
); \

1442 
_¨gvec
[12] = ()(
¨g12
); \

1443 
__asm__
 volatile( \

1458 
VALGRIND_CALL_NOREDIR_RAX
 \

1461 : "˜" (
_ªs
) \

1462 : "a" (&
_¨gvec
[0]) \

1463 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1465 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1466 } 0)

	)

1472 #i‡
deföed
(
PLAT_µc32_löux
)

1498 
	#__CALLER_SAVED_REGS
 \

1502 "r11", "r12", "r13"

	)

1507 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

1509 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1510 vﬁ©ûê
_¨gvec
[1]; \

1511 vﬁ©ûê
_ªs
; \

1512 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1513 
__asm__
 volatile( \

1516 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1518 : "Ù" (
_ªs
) \

1519 : "r" (&
_¨gvec
[0]) \

1520 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1522 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1523 } 0)

	)

1525 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

1527 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1528 vﬁ©ûê
_¨gvec
[2]; \

1529 vﬁ©ûê
_ªs
; \

1530 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1531 
_¨gvec
[1] = ()
¨g1
; \

1532 
__asm__
 volatile( \

1536 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1538 : "Ù" (
_ªs
) \

1539 : "r" (&
_¨gvec
[0]) \

1540 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1542 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1543 } 0)

	)

1545 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

1547 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1548 vﬁ©ûê
_¨gvec
[3]; \

1549 vﬁ©ûê
_ªs
; \

1550 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1551 
_¨gvec
[1] = ()
¨g1
; \

1552 
_¨gvec
[2] = ()
¨g2
; \

1553 
__asm__
 volatile( \

1558 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1560 : "Ù" (
_ªs
) \

1561 : "r" (&
_¨gvec
[0]) \

1562 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1564 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1565 } 0)

	)

1567 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

1569 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1570 vﬁ©ûê
_¨gvec
[4]; \

1571 vﬁ©ûê
_ªs
; \

1572 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1573 
_¨gvec
[1] = ()
¨g1
; \

1574 
_¨gvec
[2] = ()
¨g2
; \

1575 
_¨gvec
[3] = ()
¨g3
; \

1576 
__asm__
 volatile( \

1582 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1584 : "Ù" (
_ªs
) \

1585 : "r" (&
_¨gvec
[0]) \

1586 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1588 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1589 } 0)

	)

1591 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

1593 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1594 vﬁ©ûê
_¨gvec
[5]; \

1595 vﬁ©ûê
_ªs
; \

1596 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1597 
_¨gvec
[1] = ()
¨g1
; \

1598 
_¨gvec
[2] = ()
¨g2
; \

1599 
_¨gvec
[3] = ()
¨g3
; \

1600 
_¨gvec
[4] = ()
¨g4
; \

1601 
__asm__
 volatile( \

1608 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1610 : "Ù" (
_ªs
) \

1611 : "r" (&
_¨gvec
[0]) \

1612 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1614 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1615 } 0)

	)

1617 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

1619 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1620 vﬁ©ûê
_¨gvec
[6]; \

1621 vﬁ©ûê
_ªs
; \

1622 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1623 
_¨gvec
[1] = ()
¨g1
; \

1624 
_¨gvec
[2] = ()
¨g2
; \

1625 
_¨gvec
[3] = ()
¨g3
; \

1626 
_¨gvec
[4] = ()
¨g4
; \

1627 
_¨gvec
[5] = ()
¨g5
; \

1628 
__asm__
 volatile( \

1636 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1638 : "Ù" (
_ªs
) \

1639 : "r" (&
_¨gvec
[0]) \

1640 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1642 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1643 } 0)

	)

1645 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

1647 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1648 vﬁ©ûê
_¨gvec
[7]; \

1649 vﬁ©ûê
_ªs
; \

1650 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1651 
_¨gvec
[1] = ()
¨g1
; \

1652 
_¨gvec
[2] = ()
¨g2
; \

1653 
_¨gvec
[3] = ()
¨g3
; \

1654 
_¨gvec
[4] = ()
¨g4
; \

1655 
_¨gvec
[5] = ()
¨g5
; \

1656 
_¨gvec
[6] = ()
¨g6
; \

1657 
__asm__
 volatile( \

1666 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1668 : "Ù" (
_ªs
) \

1669 : "r" (&
_¨gvec
[0]) \

1670 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1672 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1673 } 0)

	)

1675 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1676 
¨g7
) \

1678 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1679 vﬁ©ûê
_¨gvec
[8]; \

1680 vﬁ©ûê
_ªs
; \

1681 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1682 
_¨gvec
[1] = ()
¨g1
; \

1683 
_¨gvec
[2] = ()
¨g2
; \

1684 
_¨gvec
[3] = ()
¨g3
; \

1685 
_¨gvec
[4] = ()
¨g4
; \

1686 
_¨gvec
[5] = ()
¨g5
; \

1687 
_¨gvec
[6] = ()
¨g6
; \

1688 
_¨gvec
[7] = ()
¨g7
; \

1689 
__asm__
 volatile( \

1699 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1701 : "Ù" (
_ªs
) \

1702 : "r" (&
_¨gvec
[0]) \

1703 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1705 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1706 } 0)

	)

1708 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1709 
¨g7
,
¨g8
) \

1711 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1712 vﬁ©ûê
_¨gvec
[9]; \

1713 vﬁ©ûê
_ªs
; \

1714 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1715 
_¨gvec
[1] = ()
¨g1
; \

1716 
_¨gvec
[2] = ()
¨g2
; \

1717 
_¨gvec
[3] = ()
¨g3
; \

1718 
_¨gvec
[4] = ()
¨g4
; \

1719 
_¨gvec
[5] = ()
¨g5
; \

1720 
_¨gvec
[6] = ()
¨g6
; \

1721 
_¨gvec
[7] = ()
¨g7
; \

1722 
_¨gvec
[8] = ()
¨g8
; \

1723 
__asm__
 volatile( \

1734 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1736 : "Ù" (
_ªs
) \

1737 : "r" (&
_¨gvec
[0]) \

1738 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1740 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1741 } 0)

	)

1743 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1744 
¨g7
,
¨g8
,
¨g9
) \

1746 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1747 vﬁ©ûê
_¨gvec
[10]; \

1748 vﬁ©ûê
_ªs
; \

1749 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1750 
_¨gvec
[1] = ()
¨g1
; \

1751 
_¨gvec
[2] = ()
¨g2
; \

1752 
_¨gvec
[3] = ()
¨g3
; \

1753 
_¨gvec
[4] = ()
¨g4
; \

1754 
_¨gvec
[5] = ()
¨g5
; \

1755 
_¨gvec
[6] = ()
¨g6
; \

1756 
_¨gvec
[7] = ()
¨g7
; \

1757 
_¨gvec
[8] = ()
¨g8
; \

1758 
_¨gvec
[9] = ()
¨g9
; \

1759 
__asm__
 volatile( \

1775 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1778 : "Ù" (
_ªs
) \

1779 : "r" (&
_¨gvec
[0]) \

1780 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1782 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1783 } 0)

	)

1785 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1786 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

1788 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1789 vﬁ©ûê
_¨gvec
[11]; \

1790 vﬁ©ûê
_ªs
; \

1791 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1792 
_¨gvec
[1] = ()
¨g1
; \

1793 
_¨gvec
[2] = ()
¨g2
; \

1794 
_¨gvec
[3] = ()
¨g3
; \

1795 
_¨gvec
[4] = ()
¨g4
; \

1796 
_¨gvec
[5] = ()
¨g5
; \

1797 
_¨gvec
[6] = ()
¨g6
; \

1798 
_¨gvec
[7] = ()
¨g7
; \

1799 
_¨gvec
[8] = ()
¨g8
; \

1800 
_¨gvec
[9] = ()
¨g9
; \

1801 
_¨gvec
[10] = ()
¨g10
; \

1802 
__asm__
 volatile( \

1821 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1824 : "Ù" (
_ªs
) \

1825 : "r" (&
_¨gvec
[0]) \

1826 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1828 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1829 } 0)

	)

1831 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1832 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
) \

1834 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1835 vﬁ©ûê
_¨gvec
[12]; \

1836 vﬁ©ûê
_ªs
; \

1837 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1838 
_¨gvec
[1] = ()
¨g1
; \

1839 
_¨gvec
[2] = ()
¨g2
; \

1840 
_¨gvec
[3] = ()
¨g3
; \

1841 
_¨gvec
[4] = ()
¨g4
; \

1842 
_¨gvec
[5] = ()
¨g5
; \

1843 
_¨gvec
[6] = ()
¨g6
; \

1844 
_¨gvec
[7] = ()
¨g7
; \

1845 
_¨gvec
[8] = ()
¨g8
; \

1846 
_¨gvec
[9] = ()
¨g9
; \

1847 
_¨gvec
[10] = ()
¨g10
; \

1848 
_¨gvec
[11] = ()
¨g11
; \

1849 
__asm__
 volatile( \

1871 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1874 : "Ù" (
_ªs
) \

1875 : "r" (&
_¨gvec
[0]) \

1876 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1878 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1879 } 0)

	)

1881 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

1882 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
,
¨g12
) \

1884 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1885 vﬁ©ûê
_¨gvec
[13]; \

1886 vﬁ©ûê
_ªs
; \

1887 
_¨gvec
[0] = ()
_‹ig
.
ƒaddr
; \

1888 
_¨gvec
[1] = ()
¨g1
; \

1889 
_¨gvec
[2] = ()
¨g2
; \

1890 
_¨gvec
[3] = ()
¨g3
; \

1891 
_¨gvec
[4] = ()
¨g4
; \

1892 
_¨gvec
[5] = ()
¨g5
; \

1893 
_¨gvec
[6] = ()
¨g6
; \

1894 
_¨gvec
[7] = ()
¨g7
; \

1895 
_¨gvec
[8] = ()
¨g8
; \

1896 
_¨gvec
[9] = ()
¨g9
; \

1897 
_¨gvec
[10] = ()
¨g10
; \

1898 
_¨gvec
[11] = ()
¨g11
; \

1899 
_¨gvec
[12] = ()
¨g12
; \

1900 
__asm__
 volatile( \

1925 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1928 : "Ù" (
_ªs
) \

1929 : "r" (&
_¨gvec
[0]) \

1930 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1932 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1933 } 0)

	)

1939 #i‡
deföed
(
PLAT_µc64_löux
)

1944 
	#__CALLER_SAVED_REGS
 \

1948 "r11", "r12", "r13"

	)

1953 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

1955 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1956 vﬁ©ûê
_¨gvec
[3+0]; \

1957 vﬁ©ûê
_ªs
; \

1959 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

1960 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

1961 
__asm__
 volatile( \

1966 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1970 : "Ù" (
_ªs
) \

1971 : "r" (&
_¨gvec
[2]) \

1972 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

1974 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

1975 } 0)

	)

1977 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

1979 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

1980 vﬁ©ûê
_¨gvec
[3+1]; \

1981 vﬁ©ûê
_ªs
; \

1983 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

1984 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

1985 
_¨gvec
[2+1] = ()
¨g1
; \

1986 
__asm__
 volatile( \

1992 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

1996 : "Ù" (
_ªs
) \

1997 : "r" (&
_¨gvec
[2]) \

1998 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2000 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2001 } 0)

	)

2003 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

2005 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2006 vﬁ©ûê
_¨gvec
[3+2]; \

2007 vﬁ©ûê
_ªs
; \

2009 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2010 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2011 
_¨gvec
[2+1] = ()
¨g1
; \

2012 
_¨gvec
[2+2] = ()
¨g2
; \

2013 
__asm__
 volatile( \

2020 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2024 : "Ù" (
_ªs
) \

2025 : "r" (&
_¨gvec
[2]) \

2026 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2028 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2029 } 0)

	)

2031 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

2033 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2034 vﬁ©ûê
_¨gvec
[3+3]; \

2035 vﬁ©ûê
_ªs
; \

2037 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2038 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2039 
_¨gvec
[2+1] = ()
¨g1
; \

2040 
_¨gvec
[2+2] = ()
¨g2
; \

2041 
_¨gvec
[2+3] = ()
¨g3
; \

2042 
__asm__
 volatile( \

2050 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2054 : "Ù" (
_ªs
) \

2055 : "r" (&
_¨gvec
[2]) \

2056 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2058 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2059 } 0)

	)

2061 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

2063 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2064 vﬁ©ûê
_¨gvec
[3+4]; \

2065 vﬁ©ûê
_ªs
; \

2067 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2068 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2069 
_¨gvec
[2+1] = ()
¨g1
; \

2070 
_¨gvec
[2+2] = ()
¨g2
; \

2071 
_¨gvec
[2+3] = ()
¨g3
; \

2072 
_¨gvec
[2+4] = ()
¨g4
; \

2073 
__asm__
 volatile( \

2082 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2086 : "Ù" (
_ªs
) \

2087 : "r" (&
_¨gvec
[2]) \

2088 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2090 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2091 } 0)

	)

2093 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

2095 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2096 vﬁ©ûê
_¨gvec
[3+5]; \

2097 vﬁ©ûê
_ªs
; \

2099 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2100 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2101 
_¨gvec
[2+1] = ()
¨g1
; \

2102 
_¨gvec
[2+2] = ()
¨g2
; \

2103 
_¨gvec
[2+3] = ()
¨g3
; \

2104 
_¨gvec
[2+4] = ()
¨g4
; \

2105 
_¨gvec
[2+5] = ()
¨g5
; \

2106 
__asm__
 volatile( \

2116 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2120 : "Ù" (
_ªs
) \

2121 : "r" (&
_¨gvec
[2]) \

2122 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2124 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2125 } 0)

	)

2127 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

2129 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2130 vﬁ©ûê
_¨gvec
[3+6]; \

2131 vﬁ©ûê
_ªs
; \

2133 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2134 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2135 
_¨gvec
[2+1] = ()
¨g1
; \

2136 
_¨gvec
[2+2] = ()
¨g2
; \

2137 
_¨gvec
[2+3] = ()
¨g3
; \

2138 
_¨gvec
[2+4] = ()
¨g4
; \

2139 
_¨gvec
[2+5] = ()
¨g5
; \

2140 
_¨gvec
[2+6] = ()
¨g6
; \

2141 
__asm__
 volatile( \

2152 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2156 : "Ù" (
_ªs
) \

2157 : "r" (&
_¨gvec
[2]) \

2158 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2160 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2161 } 0)

	)

2163 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2164 
¨g7
) \

2166 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2167 vﬁ©ûê
_¨gvec
[3+7]; \

2168 vﬁ©ûê
_ªs
; \

2170 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2171 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2172 
_¨gvec
[2+1] = ()
¨g1
; \

2173 
_¨gvec
[2+2] = ()
¨g2
; \

2174 
_¨gvec
[2+3] = ()
¨g3
; \

2175 
_¨gvec
[2+4] = ()
¨g4
; \

2176 
_¨gvec
[2+5] = ()
¨g5
; \

2177 
_¨gvec
[2+6] = ()
¨g6
; \

2178 
_¨gvec
[2+7] = ()
¨g7
; \

2179 
__asm__
 volatile( \

2191 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2195 : "Ù" (
_ªs
) \

2196 : "r" (&
_¨gvec
[2]) \

2197 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2199 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2200 } 0)

	)

2202 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2203 
¨g7
,
¨g8
) \

2205 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2206 vﬁ©ûê
_¨gvec
[3+8]; \

2207 vﬁ©ûê
_ªs
; \

2209 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2210 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2211 
_¨gvec
[2+1] = ()
¨g1
; \

2212 
_¨gvec
[2+2] = ()
¨g2
; \

2213 
_¨gvec
[2+3] = ()
¨g3
; \

2214 
_¨gvec
[2+4] = ()
¨g4
; \

2215 
_¨gvec
[2+5] = ()
¨g5
; \

2216 
_¨gvec
[2+6] = ()
¨g6
; \

2217 
_¨gvec
[2+7] = ()
¨g7
; \

2218 
_¨gvec
[2+8] = ()
¨g8
; \

2219 
__asm__
 volatile( \

2232 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2236 : "Ù" (
_ªs
) \

2237 : "r" (&
_¨gvec
[2]) \

2238 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2240 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2241 } 0)

	)

2243 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2244 
¨g7
,
¨g8
,
¨g9
) \

2246 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2247 vﬁ©ûê
_¨gvec
[3+9]; \

2248 vﬁ©ûê
_ªs
; \

2250 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2251 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2252 
_¨gvec
[2+1] = ()
¨g1
; \

2253 
_¨gvec
[2+2] = ()
¨g2
; \

2254 
_¨gvec
[2+3] = ()
¨g3
; \

2255 
_¨gvec
[2+4] = ()
¨g4
; \

2256 
_¨gvec
[2+5] = ()
¨g5
; \

2257 
_¨gvec
[2+6] = ()
¨g6
; \

2258 
_¨gvec
[2+7] = ()
¨g7
; \

2259 
_¨gvec
[2+8] = ()
¨g8
; \

2260 
_¨gvec
[2+9] = ()
¨g9
; \

2261 
__asm__
 volatile( \

2279 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2284 : "Ù" (
_ªs
) \

2285 : "r" (&
_¨gvec
[2]) \

2286 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2288 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2289 } 0)

	)

2291 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2292 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

2294 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2295 vﬁ©ûê
_¨gvec
[3+10]; \

2296 vﬁ©ûê
_ªs
; \

2298 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2299 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2300 
_¨gvec
[2+1] = ()
¨g1
; \

2301 
_¨gvec
[2+2] = ()
¨g2
; \

2302 
_¨gvec
[2+3] = ()
¨g3
; \

2303 
_¨gvec
[2+4] = ()
¨g4
; \

2304 
_¨gvec
[2+5] = ()
¨g5
; \

2305 
_¨gvec
[2+6] = ()
¨g6
; \

2306 
_¨gvec
[2+7] = ()
¨g7
; \

2307 
_¨gvec
[2+8] = ()
¨g8
; \

2308 
_¨gvec
[2+9] = ()
¨g9
; \

2309 
_¨gvec
[2+10] = ()
¨g10
; \

2310 
__asm__
 volatile( \

2331 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2336 : "Ù" (
_ªs
) \

2337 : "r" (&
_¨gvec
[2]) \

2338 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2340 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2341 } 0)

	)

2343 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2344 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
) \

2346 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2347 vﬁ©ûê
_¨gvec
[3+11]; \

2348 vﬁ©ûê
_ªs
; \

2350 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2351 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2352 
_¨gvec
[2+1] = ()
¨g1
; \

2353 
_¨gvec
[2+2] = ()
¨g2
; \

2354 
_¨gvec
[2+3] = ()
¨g3
; \

2355 
_¨gvec
[2+4] = ()
¨g4
; \

2356 
_¨gvec
[2+5] = ()
¨g5
; \

2357 
_¨gvec
[2+6] = ()
¨g6
; \

2358 
_¨gvec
[2+7] = ()
¨g7
; \

2359 
_¨gvec
[2+8] = ()
¨g8
; \

2360 
_¨gvec
[2+9] = ()
¨g9
; \

2361 
_¨gvec
[2+10] = ()
¨g10
; \

2362 
_¨gvec
[2+11] = ()
¨g11
; \

2363 
__asm__
 volatile( \

2387 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2392 : "Ù" (
_ªs
) \

2393 : "r" (&
_¨gvec
[2]) \

2394 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2396 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2397 } 0)

	)

2399 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2400 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
,
¨g12
) \

2402 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2403 vﬁ©ûê
_¨gvec
[3+12]; \

2404 vﬁ©ûê
_ªs
; \

2406 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2407 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2408 
_¨gvec
[2+1] = ()
¨g1
; \

2409 
_¨gvec
[2+2] = ()
¨g2
; \

2410 
_¨gvec
[2+3] = ()
¨g3
; \

2411 
_¨gvec
[2+4] = ()
¨g4
; \

2412 
_¨gvec
[2+5] = ()
¨g5
; \

2413 
_¨gvec
[2+6] = ()
¨g6
; \

2414 
_¨gvec
[2+7] = ()
¨g7
; \

2415 
_¨gvec
[2+8] = ()
¨g8
; \

2416 
_¨gvec
[2+9] = ()
¨g9
; \

2417 
_¨gvec
[2+10] = ()
¨g10
; \

2418 
_¨gvec
[2+11] = ()
¨g11
; \

2419 
_¨gvec
[2+12] = ()
¨g12
; \

2420 
__asm__
 volatile( \

2447 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2452 : "Ù" (
_ªs
) \

2453 : "r" (&
_¨gvec
[2]) \

2454 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2456 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2457 } 0)

	)

2463 #i‡
deföed
(
PLAT_µc32_aix5
)

2468 
	#__CALLER_SAVED_REGS
 \

2472 "r11", "r12", "r13"

	)

2477 
	#VG_EXPAND_FRAME_BY_åashes_r3
(
_n_‰
) \

2480 "°w 3,0(1)\n\t"

	)

2482 
	#VG_CONTRACT_FRAME_BY
(
_n_‰
) \

2483 "addò1,1," #_n_‰ "\n\t"

	)

2488 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

2490 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2491 vﬁ©ûê
_¨gvec
[3+0]; \

2492 vﬁ©ûê
_ªs
; \

2494 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2495 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2496 
__asm__
 volatile( \

2498 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2502 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2506 
	`VG_CONTRACT_FRAME_BY
(512) \

2507 : "Ù" (
_ªs
) \

2508 : "r" (&
_¨gvec
[2]) \

2509 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2511 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2512 } 0)

	)

2514 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

2516 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2517 vﬁ©ûê
_¨gvec
[3+1]; \

2518 vﬁ©ûê
_ªs
; \

2520 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2521 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2522 
_¨gvec
[2+1] = ()
¨g1
; \

2523 
__asm__
 volatile( \

2525 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2530 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2534 
	`VG_CONTRACT_FRAME_BY
(512) \

2535 : "Ù" (
_ªs
) \

2536 : "r" (&
_¨gvec
[2]) \

2537 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2539 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2540 } 0)

	)

2542 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

2544 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2545 vﬁ©ûê
_¨gvec
[3+2]; \

2546 vﬁ©ûê
_ªs
; \

2548 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2549 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2550 
_¨gvec
[2+1] = ()
¨g1
; \

2551 
_¨gvec
[2+2] = ()
¨g2
; \

2552 
__asm__
 volatile( \

2554 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2560 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2564 
	`VG_CONTRACT_FRAME_BY
(512) \

2565 : "Ù" (
_ªs
) \

2566 : "r" (&
_¨gvec
[2]) \

2567 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2569 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2570 } 0)

	)

2572 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

2574 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2575 vﬁ©ûê
_¨gvec
[3+3]; \

2576 vﬁ©ûê
_ªs
; \

2578 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2579 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2580 
_¨gvec
[2+1] = ()
¨g1
; \

2581 
_¨gvec
[2+2] = ()
¨g2
; \

2582 
_¨gvec
[2+3] = ()
¨g3
; \

2583 
__asm__
 volatile( \

2585 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2592 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2596 
	`VG_CONTRACT_FRAME_BY
(512) \

2597 : "Ù" (
_ªs
) \

2598 : "r" (&
_¨gvec
[2]) \

2599 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2601 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2602 } 0)

	)

2604 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

2606 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2607 vﬁ©ûê
_¨gvec
[3+4]; \

2608 vﬁ©ûê
_ªs
; \

2610 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2611 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2612 
_¨gvec
[2+1] = ()
¨g1
; \

2613 
_¨gvec
[2+2] = ()
¨g2
; \

2614 
_¨gvec
[2+3] = ()
¨g3
; \

2615 
_¨gvec
[2+4] = ()
¨g4
; \

2616 
__asm__
 volatile( \

2618 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2626 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2630 
	`VG_CONTRACT_FRAME_BY
(512) \

2631 : "Ù" (
_ªs
) \

2632 : "r" (&
_¨gvec
[2]) \

2633 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2635 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2636 } 0)

	)

2638 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

2640 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2641 vﬁ©ûê
_¨gvec
[3+5]; \

2642 vﬁ©ûê
_ªs
; \

2644 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2645 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2646 
_¨gvec
[2+1] = ()
¨g1
; \

2647 
_¨gvec
[2+2] = ()
¨g2
; \

2648 
_¨gvec
[2+3] = ()
¨g3
; \

2649 
_¨gvec
[2+4] = ()
¨g4
; \

2650 
_¨gvec
[2+5] = ()
¨g5
; \

2651 
__asm__
 volatile( \

2653 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2662 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2666 
	`VG_CONTRACT_FRAME_BY
(512) \

2667 : "Ù" (
_ªs
) \

2668 : "r" (&
_¨gvec
[2]) \

2669 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2671 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2672 } 0)

	)

2674 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

2676 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2677 vﬁ©ûê
_¨gvec
[3+6]; \

2678 vﬁ©ûê
_ªs
; \

2680 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2681 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2682 
_¨gvec
[2+1] = ()
¨g1
; \

2683 
_¨gvec
[2+2] = ()
¨g2
; \

2684 
_¨gvec
[2+3] = ()
¨g3
; \

2685 
_¨gvec
[2+4] = ()
¨g4
; \

2686 
_¨gvec
[2+5] = ()
¨g5
; \

2687 
_¨gvec
[2+6] = ()
¨g6
; \

2688 
__asm__
 volatile( \

2690 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2700 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2704 
	`VG_CONTRACT_FRAME_BY
(512) \

2705 : "Ù" (
_ªs
) \

2706 : "r" (&
_¨gvec
[2]) \

2707 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2709 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2710 } 0)

	)

2712 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2713 
¨g7
) \

2715 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2716 vﬁ©ûê
_¨gvec
[3+7]; \

2717 vﬁ©ûê
_ªs
; \

2719 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2720 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2721 
_¨gvec
[2+1] = ()
¨g1
; \

2722 
_¨gvec
[2+2] = ()
¨g2
; \

2723 
_¨gvec
[2+3] = ()
¨g3
; \

2724 
_¨gvec
[2+4] = ()
¨g4
; \

2725 
_¨gvec
[2+5] = ()
¨g5
; \

2726 
_¨gvec
[2+6] = ()
¨g6
; \

2727 
_¨gvec
[2+7] = ()
¨g7
; \

2728 
__asm__
 volatile( \

2730 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2741 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2745 
	`VG_CONTRACT_FRAME_BY
(512) \

2746 : "Ù" (
_ªs
) \

2747 : "r" (&
_¨gvec
[2]) \

2748 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2750 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2751 } 0)

	)

2753 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2754 
¨g7
,
¨g8
) \

2756 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2757 vﬁ©ûê
_¨gvec
[3+8]; \

2758 vﬁ©ûê
_ªs
; \

2760 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2761 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2762 
_¨gvec
[2+1] = ()
¨g1
; \

2763 
_¨gvec
[2+2] = ()
¨g2
; \

2764 
_¨gvec
[2+3] = ()
¨g3
; \

2765 
_¨gvec
[2+4] = ()
¨g4
; \

2766 
_¨gvec
[2+5] = ()
¨g5
; \

2767 
_¨gvec
[2+6] = ()
¨g6
; \

2768 
_¨gvec
[2+7] = ()
¨g7
; \

2769 
_¨gvec
[2+8] = ()
¨g8
; \

2770 
__asm__
 volatile( \

2772 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2784 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2788 
	`VG_CONTRACT_FRAME_BY
(512) \

2789 : "Ù" (
_ªs
) \

2790 : "r" (&
_¨gvec
[2]) \

2791 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2793 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2794 } 0)

	)

2796 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2797 
¨g7
,
¨g8
,
¨g9
) \

2799 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2800 vﬁ©ûê
_¨gvec
[3+9]; \

2801 vﬁ©ûê
_ªs
; \

2803 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2804 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2805 
_¨gvec
[2+1] = ()
¨g1
; \

2806 
_¨gvec
[2+2] = ()
¨g2
; \

2807 
_¨gvec
[2+3] = ()
¨g3
; \

2808 
_¨gvec
[2+4] = ()
¨g4
; \

2809 
_¨gvec
[2+5] = ()
¨g5
; \

2810 
_¨gvec
[2+6] = ()
¨g6
; \

2811 
_¨gvec
[2+7] = ()
¨g7
; \

2812 
_¨gvec
[2+8] = ()
¨g8
; \

2813 
_¨gvec
[2+9] = ()
¨g9
; \

2814 
__asm__
 volatile( \

2816 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2819 
	`VG_EXPAND_FRAME_BY_åashes_r3
(64) \

2833 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2837 
	`VG_CONTRACT_FRAME_BY
(64) \

2838 
	`VG_CONTRACT_FRAME_BY
(512) \

2839 : "Ù" (
_ªs
) \

2840 : "r" (&
_¨gvec
[2]) \

2841 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2843 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2844 } 0)

	)

2846 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2847 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

2849 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2850 vﬁ©ûê
_¨gvec
[3+10]; \

2851 vﬁ©ûê
_ªs
; \

2853 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2854 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2855 
_¨gvec
[2+1] = ()
¨g1
; \

2856 
_¨gvec
[2+2] = ()
¨g2
; \

2857 
_¨gvec
[2+3] = ()
¨g3
; \

2858 
_¨gvec
[2+4] = ()
¨g4
; \

2859 
_¨gvec
[2+5] = ()
¨g5
; \

2860 
_¨gvec
[2+6] = ()
¨g6
; \

2861 
_¨gvec
[2+7] = ()
¨g7
; \

2862 
_¨gvec
[2+8] = ()
¨g8
; \

2863 
_¨gvec
[2+9] = ()
¨g9
; \

2864 
_¨gvec
[2+10] = ()
¨g10
; \

2865 
__asm__
 volatile( \

2867 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2870 
	`VG_EXPAND_FRAME_BY_åashes_r3
(64) \

2887 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2891 
	`VG_CONTRACT_FRAME_BY
(64) \

2892 
	`VG_CONTRACT_FRAME_BY
(512) \

2893 : "Ù" (
_ªs
) \

2894 : "r" (&
_¨gvec
[2]) \

2895 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2897 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2898 } 0)

	)

2900 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2901 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
) \

2903 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2904 vﬁ©ûê
_¨gvec
[3+11]; \

2905 vﬁ©ûê
_ªs
; \

2907 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2908 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2909 
_¨gvec
[2+1] = ()
¨g1
; \

2910 
_¨gvec
[2+2] = ()
¨g2
; \

2911 
_¨gvec
[2+3] = ()
¨g3
; \

2912 
_¨gvec
[2+4] = ()
¨g4
; \

2913 
_¨gvec
[2+5] = ()
¨g5
; \

2914 
_¨gvec
[2+6] = ()
¨g6
; \

2915 
_¨gvec
[2+7] = ()
¨g7
; \

2916 
_¨gvec
[2+8] = ()
¨g8
; \

2917 
_¨gvec
[2+9] = ()
¨g9
; \

2918 
_¨gvec
[2+10] = ()
¨g10
; \

2919 
_¨gvec
[2+11] = ()
¨g11
; \

2920 
__asm__
 volatile( \

2922 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2925 
	`VG_EXPAND_FRAME_BY_åashes_r3
(72) \

2945 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

2949 
	`VG_CONTRACT_FRAME_BY
(72) \

2950 
	`VG_CONTRACT_FRAME_BY
(512) \

2951 : "Ù" (
_ªs
) \

2952 : "r" (&
_¨gvec
[2]) \

2953 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

2955 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

2956 } 0)

	)

2958 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

2959 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
,
¨g12
) \

2961 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

2962 vﬁ©ûê
_¨gvec
[3+12]; \

2963 vﬁ©ûê
_ªs
; \

2965 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

2966 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

2967 
_¨gvec
[2+1] = ()
¨g1
; \

2968 
_¨gvec
[2+2] = ()
¨g2
; \

2969 
_¨gvec
[2+3] = ()
¨g3
; \

2970 
_¨gvec
[2+4] = ()
¨g4
; \

2971 
_¨gvec
[2+5] = ()
¨g5
; \

2972 
_¨gvec
[2+6] = ()
¨g6
; \

2973 
_¨gvec
[2+7] = ()
¨g7
; \

2974 
_¨gvec
[2+8] = ()
¨g8
; \

2975 
_¨gvec
[2+9] = ()
¨g9
; \

2976 
_¨gvec
[2+10] = ()
¨g10
; \

2977 
_¨gvec
[2+11] = ()
¨g11
; \

2978 
_¨gvec
[2+12] = ()
¨g12
; \

2979 
__asm__
 volatile( \

2981 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

2984 
	`VG_EXPAND_FRAME_BY_åashes_r3
(72) \

3007 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3011 
	`VG_CONTRACT_FRAME_BY
(72) \

3012 
	`VG_CONTRACT_FRAME_BY
(512) \

3013 : "Ù" (
_ªs
) \

3014 : "r" (&
_¨gvec
[2]) \

3015 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3017 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3018 } 0)

	)

3024 #i‡
deföed
(
PLAT_µc64_aix5
)

3029 
	#__CALLER_SAVED_REGS
 \

3033 "r11", "r12", "r13"

	)

3038 
	#VG_EXPAND_FRAME_BY_åashes_r3
(
_n_‰
) \

3041 "°d 3,0(1)\n\t"

	)

3043 
	#VG_CONTRACT_FRAME_BY
(
_n_‰
) \

3044 "addò1,1," #_n_‰ "\n\t"

	)

3049 
	#CALL_FN_W_v
(
lvÆ
, 
‹ig
) \

3051 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3052 vﬁ©ûê
_¨gvec
[3+0]; \

3053 vﬁ©ûê
_ªs
; \

3055 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3056 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3057 
__asm__
 volatile( \

3059 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3063 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3067 
	`VG_CONTRACT_FRAME_BY
(512) \

3068 : "Ù" (
_ªs
) \

3069 : "r" (&
_¨gvec
[2]) \

3070 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3072 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3073 } 0)

	)

3075 
	#CALL_FN_W_W
(
lvÆ
, 
‹ig
, 
¨g1
) \

3077 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3078 vﬁ©ûê
_¨gvec
[3+1]; \

3079 vﬁ©ûê
_ªs
; \

3081 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3082 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3083 
_¨gvec
[2+1] = ()
¨g1
; \

3084 
__asm__
 volatile( \

3086 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3091 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3095 
	`VG_CONTRACT_FRAME_BY
(512) \

3096 : "Ù" (
_ªs
) \

3097 : "r" (&
_¨gvec
[2]) \

3098 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3100 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3101 } 0)

	)

3103 
	#CALL_FN_W_WW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
) \

3105 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3106 vﬁ©ûê
_¨gvec
[3+2]; \

3107 vﬁ©ûê
_ªs
; \

3109 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3110 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3111 
_¨gvec
[2+1] = ()
¨g1
; \

3112 
_¨gvec
[2+2] = ()
¨g2
; \

3113 
__asm__
 volatile( \

3115 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3121 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3125 
	`VG_CONTRACT_FRAME_BY
(512) \

3126 : "Ù" (
_ªs
) \

3127 : "r" (&
_¨gvec
[2]) \

3128 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3130 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3131 } 0)

	)

3133 
	#CALL_FN_W_WWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
) \

3135 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3136 vﬁ©ûê
_¨gvec
[3+3]; \

3137 vﬁ©ûê
_ªs
; \

3139 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3140 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3141 
_¨gvec
[2+1] = ()
¨g1
; \

3142 
_¨gvec
[2+2] = ()
¨g2
; \

3143 
_¨gvec
[2+3] = ()
¨g3
; \

3144 
__asm__
 volatile( \

3146 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3153 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3157 
	`VG_CONTRACT_FRAME_BY
(512) \

3158 : "Ù" (
_ªs
) \

3159 : "r" (&
_¨gvec
[2]) \

3160 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3162 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3163 } 0)

	)

3165 
	#CALL_FN_W_WWWW
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
) \

3167 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3168 vﬁ©ûê
_¨gvec
[3+4]; \

3169 vﬁ©ûê
_ªs
; \

3171 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3172 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3173 
_¨gvec
[2+1] = ()
¨g1
; \

3174 
_¨gvec
[2+2] = ()
¨g2
; \

3175 
_¨gvec
[2+3] = ()
¨g3
; \

3176 
_¨gvec
[2+4] = ()
¨g4
; \

3177 
__asm__
 volatile( \

3179 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3187 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3191 
	`VG_CONTRACT_FRAME_BY
(512) \

3192 : "Ù" (
_ªs
) \

3193 : "r" (&
_¨gvec
[2]) \

3194 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3196 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3197 } 0)

	)

3199 
	#CALL_FN_W_5W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
) \

3201 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3202 vﬁ©ûê
_¨gvec
[3+5]; \

3203 vﬁ©ûê
_ªs
; \

3205 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3206 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3207 
_¨gvec
[2+1] = ()
¨g1
; \

3208 
_¨gvec
[2+2] = ()
¨g2
; \

3209 
_¨gvec
[2+3] = ()
¨g3
; \

3210 
_¨gvec
[2+4] = ()
¨g4
; \

3211 
_¨gvec
[2+5] = ()
¨g5
; \

3212 
__asm__
 volatile( \

3214 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3223 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3227 
	`VG_CONTRACT_FRAME_BY
(512) \

3228 : "Ù" (
_ªs
) \

3229 : "r" (&
_¨gvec
[2]) \

3230 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3232 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3233 } 0)

	)

3235 
	#CALL_FN_W_6W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
) \

3237 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3238 vﬁ©ûê
_¨gvec
[3+6]; \

3239 vﬁ©ûê
_ªs
; \

3241 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3242 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3243 
_¨gvec
[2+1] = ()
¨g1
; \

3244 
_¨gvec
[2+2] = ()
¨g2
; \

3245 
_¨gvec
[2+3] = ()
¨g3
; \

3246 
_¨gvec
[2+4] = ()
¨g4
; \

3247 
_¨gvec
[2+5] = ()
¨g5
; \

3248 
_¨gvec
[2+6] = ()
¨g6
; \

3249 
__asm__
 volatile( \

3251 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3261 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3265 
	`VG_CONTRACT_FRAME_BY
(512) \

3266 : "Ù" (
_ªs
) \

3267 : "r" (&
_¨gvec
[2]) \

3268 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3270 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3271 } 0)

	)

3273 
	#CALL_FN_W_7W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3274 
¨g7
) \

3276 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3277 vﬁ©ûê
_¨gvec
[3+7]; \

3278 vﬁ©ûê
_ªs
; \

3280 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3281 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3282 
_¨gvec
[2+1] = ()
¨g1
; \

3283 
_¨gvec
[2+2] = ()
¨g2
; \

3284 
_¨gvec
[2+3] = ()
¨g3
; \

3285 
_¨gvec
[2+4] = ()
¨g4
; \

3286 
_¨gvec
[2+5] = ()
¨g5
; \

3287 
_¨gvec
[2+6] = ()
¨g6
; \

3288 
_¨gvec
[2+7] = ()
¨g7
; \

3289 
__asm__
 volatile( \

3291 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3302 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3306 
	`VG_CONTRACT_FRAME_BY
(512) \

3307 : "Ù" (
_ªs
) \

3308 : "r" (&
_¨gvec
[2]) \

3309 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3311 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3312 } 0)

	)

3314 
	#CALL_FN_W_8W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3315 
¨g7
,
¨g8
) \

3317 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3318 vﬁ©ûê
_¨gvec
[3+8]; \

3319 vﬁ©ûê
_ªs
; \

3321 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3322 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3323 
_¨gvec
[2+1] = ()
¨g1
; \

3324 
_¨gvec
[2+2] = ()
¨g2
; \

3325 
_¨gvec
[2+3] = ()
¨g3
; \

3326 
_¨gvec
[2+4] = ()
¨g4
; \

3327 
_¨gvec
[2+5] = ()
¨g5
; \

3328 
_¨gvec
[2+6] = ()
¨g6
; \

3329 
_¨gvec
[2+7] = ()
¨g7
; \

3330 
_¨gvec
[2+8] = ()
¨g8
; \

3331 
__asm__
 volatile( \

3333 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3345 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3349 
	`VG_CONTRACT_FRAME_BY
(512) \

3350 : "Ù" (
_ªs
) \

3351 : "r" (&
_¨gvec
[2]) \

3352 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3354 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3355 } 0)

	)

3357 
	#CALL_FN_W_9W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3358 
¨g7
,
¨g8
,
¨g9
) \

3360 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3361 vﬁ©ûê
_¨gvec
[3+9]; \

3362 vﬁ©ûê
_ªs
; \

3364 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3365 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3366 
_¨gvec
[2+1] = ()
¨g1
; \

3367 
_¨gvec
[2+2] = ()
¨g2
; \

3368 
_¨gvec
[2+3] = ()
¨g3
; \

3369 
_¨gvec
[2+4] = ()
¨g4
; \

3370 
_¨gvec
[2+5] = ()
¨g5
; \

3371 
_¨gvec
[2+6] = ()
¨g6
; \

3372 
_¨gvec
[2+7] = ()
¨g7
; \

3373 
_¨gvec
[2+8] = ()
¨g8
; \

3374 
_¨gvec
[2+9] = ()
¨g9
; \

3375 
__asm__
 volatile( \

3377 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3380 
	`VG_EXPAND_FRAME_BY_åashes_r3
(128) \

3394 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3398 
	`VG_CONTRACT_FRAME_BY
(128) \

3399 
	`VG_CONTRACT_FRAME_BY
(512) \

3400 : "Ù" (
_ªs
) \

3401 : "r" (&
_¨gvec
[2]) \

3402 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3404 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3405 } 0)

	)

3407 
	#CALL_FN_W_10W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3408 
¨g7
,
¨g8
,
¨g9
,
¨g10
) \

3410 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3411 vﬁ©ûê
_¨gvec
[3+10]; \

3412 vﬁ©ûê
_ªs
; \

3414 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3415 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3416 
_¨gvec
[2+1] = ()
¨g1
; \

3417 
_¨gvec
[2+2] = ()
¨g2
; \

3418 
_¨gvec
[2+3] = ()
¨g3
; \

3419 
_¨gvec
[2+4] = ()
¨g4
; \

3420 
_¨gvec
[2+5] = ()
¨g5
; \

3421 
_¨gvec
[2+6] = ()
¨g6
; \

3422 
_¨gvec
[2+7] = ()
¨g7
; \

3423 
_¨gvec
[2+8] = ()
¨g8
; \

3424 
_¨gvec
[2+9] = ()
¨g9
; \

3425 
_¨gvec
[2+10] = ()
¨g10
; \

3426 
__asm__
 volatile( \

3428 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3431 
	`VG_EXPAND_FRAME_BY_åashes_r3
(128) \

3448 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3452 
	`VG_CONTRACT_FRAME_BY
(128) \

3453 
	`VG_CONTRACT_FRAME_BY
(512) \

3454 : "Ù" (
_ªs
) \

3455 : "r" (&
_¨gvec
[2]) \

3456 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3458 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3459 } 0)

	)

3461 
	#CALL_FN_W_11W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3462 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
) \

3464 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3465 vﬁ©ûê
_¨gvec
[3+11]; \

3466 vﬁ©ûê
_ªs
; \

3468 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3469 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3470 
_¨gvec
[2+1] = ()
¨g1
; \

3471 
_¨gvec
[2+2] = ()
¨g2
; \

3472 
_¨gvec
[2+3] = ()
¨g3
; \

3473 
_¨gvec
[2+4] = ()
¨g4
; \

3474 
_¨gvec
[2+5] = ()
¨g5
; \

3475 
_¨gvec
[2+6] = ()
¨g6
; \

3476 
_¨gvec
[2+7] = ()
¨g7
; \

3477 
_¨gvec
[2+8] = ()
¨g8
; \

3478 
_¨gvec
[2+9] = ()
¨g9
; \

3479 
_¨gvec
[2+10] = ()
¨g10
; \

3480 
_¨gvec
[2+11] = ()
¨g11
; \

3481 
__asm__
 volatile( \

3483 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3486 
	`VG_EXPAND_FRAME_BY_åashes_r3
(144) \

3506 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3510 
	`VG_CONTRACT_FRAME_BY
(144) \

3511 
	`VG_CONTRACT_FRAME_BY
(512) \

3512 : "Ù" (
_ªs
) \

3513 : "r" (&
_¨gvec
[2]) \

3514 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3516 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3517 } 0)

	)

3519 
	#CALL_FN_W_12W
(
lvÆ
, 
‹ig
, 
¨g1
,
¨g2
,
¨g3
,
¨g4
,
¨g5
,
¨g6
, \

3520 
¨g7
,
¨g8
,
¨g9
,
¨g10
,
¨g11
,
¨g12
) \

3522 vﬁ©ûê
OrigFn
 
_‹ig
 = (
‹ig
); \

3523 vﬁ©ûê
_¨gvec
[3+12]; \

3524 vﬁ©ûê
_ªs
; \

3526 
_¨gvec
[1] = ()
_‹ig
.
r2
; \

3527 
_¨gvec
[2] = ()
_‹ig
.
ƒaddr
; \

3528 
_¨gvec
[2+1] = ()
¨g1
; \

3529 
_¨gvec
[2+2] = ()
¨g2
; \

3530 
_¨gvec
[2+3] = ()
¨g3
; \

3531 
_¨gvec
[2+4] = ()
¨g4
; \

3532 
_¨gvec
[2+5] = ()
¨g5
; \

3533 
_¨gvec
[2+6] = ()
¨g6
; \

3534 
_¨gvec
[2+7] = ()
¨g7
; \

3535 
_¨gvec
[2+8] = ()
¨g8
; \

3536 
_¨gvec
[2+9] = ()
¨g9
; \

3537 
_¨gvec
[2+10] = ()
¨g10
; \

3538 
_¨gvec
[2+11] = ()
¨g11
; \

3539 
_¨gvec
[2+12] = ()
¨g12
; \

3540 
__asm__
 volatile( \

3542 
	`VG_EXPAND_FRAME_BY_åashes_r3
(512) \

3545 
	`VG_EXPAND_FRAME_BY_åashes_r3
(144) \

3568 
VALGRIND_BRANCH_AND_LINK_TO_NOREDIR_R11
 \

3572 
	`VG_CONTRACT_FRAME_BY
(144) \

3573 
	`VG_CONTRACT_FRAME_BY
(512) \

3574 : "Ù" (
_ªs
) \

3575 : "r" (&
_¨gvec
[2]) \

3576 : "cc", "mem‹y", 
__CALLER_SAVED_REGS
 \

3578 
lvÆ
 = (
	`__ty≥of__
÷vÆ)Ë
_ªs
; \

3579 } 0)

	)

3599 
	#VG_USERREQ_TOOL_BASE
(
a
,
b
) \

3600 (()(((
a
)&0xffË<< 24 | ((
b
)&0xffË<< 16))

	)

3601 
	#VG_IS_TOOL_USERREQ
(
a
, 
b
, 
v
) \

3602 (
	`VG_USERREQ_TOOL_BASE
(
a
,
b
Ë=((
v
Ë& 0xffff0000))

	)

3609 { 
	mVG_USERREQ__RUNNING_ON_VALGRIND
 = 0x1001,

3610 
	mVG_USERREQ__DISCARD_TRANSLATIONS
 = 0x1002,

3617 
	mVG_USERREQ__CLIENT_CALL0
 = 0x1101,

3618 
	mVG_USERREQ__CLIENT_CALL1
 = 0x1102,

3619 
	mVG_USERREQ__CLIENT_CALL2
 = 0x1103,

3620 
	mVG_USERREQ__CLIENT_CALL3
 = 0x1104,

3625 
	mVG_USERREQ__COUNT_ERRORS
 = 0x1201,

3629 
	mVG_USERREQ__MALLOCLIKE_BLOCK
 = 0x1301,

3630 
	mVG_USERREQ__FREELIKE_BLOCK
 = 0x1302,

3632 
	mVG_USERREQ__CREATE_MEMPOOL
 = 0x1303,

3633 
	mVG_USERREQ__DESTROY_MEMPOOL
 = 0x1304,

3634 
	mVG_USERREQ__MEMPOOL_ALLOC
 = 0x1305,

3635 
	mVG_USERREQ__MEMPOOL_FREE
 = 0x1306,

3636 
	mVG_USERREQ__MEMPOOL_TRIM
 = 0x1307,

3637 
	mVG_USERREQ__MOVE_MEMPOOL
 = 0x1308,

3638 
	mVG_USERREQ__MEMPOOL_CHANGE
 = 0x1309,

3639 
	mVG_USERREQ__MEMPOOL_EXISTS
 = 0x130a,

3642 
	mVG_USERREQ__PRINTF
 = 0x1401,

3643 
	mVG_USERREQ__PRINTF_BACKTRACE
 = 0x1402,

3646 
	mVG_USERREQ__STACK_REGISTER
 = 0x1501,

3647 
	mVG_USERREQ__STACK_DEREGISTER
 = 0x1502,

3648 
	mVG_USERREQ__STACK_CHANGE
 = 0x1503,

3651 
	mVG_USERREQ__LOAD_PDB_DEBUGINFO
 = 0x1601

3652 } 
	tVg_Clõ¡Reque°
;

3654 #i‡!
deföed
(
__GNUC__
)

3655 
	#__exãnsi⁄__


	)

3662 
	#RUNNING_ON_VALGRIND
 
__exãnsi⁄__
 \

3663 ({
_qzz_ªs
; \

3664 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0 , \

3665 
VG_USERREQ__RUNNING_ON_VALGRIND
, \

3667 
_qzz_ªs
; \

3668 })

	)

3675 
	#VALGRIND_DISCARD_TRANSLATIONS
(
_qzz_addr
,
_qzz_Àn
) \

3676 {
_qzz_ªs
; \

3677 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3678 
VG_USERREQ__DISCARD_TRANSLATIONS
, \

3679 
_qzz_addr
, 
_qzz_Àn
, 0, 0, 0); \

3680 }

	)

3688 #i‡
deföed
(
NVALGRIND
)

3690 
	#VALGRIND_PRINTF
(...)

	)

3691 
	#VALGRIND_PRINTF_BACKTRACE
(...)

	)

3697 
	$VALGRIND_PRINTF
 (c⁄° *
f‹m©
, ...)

3698 
	`__©åibuã__
 ((
	`f‹m©
 (
__¥ötf__
, 1, 2), 
__unu£d__
));

3700 
	$VALGRIND_PRINTF
 (c⁄° *
f‹m©
, ...)

3702 
_qzz_ªs
;

3703 
va_li°
 
v¨gs
;

3704 
	`va_°¨t
 (
v¨gs
, 
f‹m©
);

3705 
	`VALGRIND_DO_CLIENT_REQUEST
 (
_qzz_ªs
, 0, 
VG_USERREQ__PRINTF
,

3706 (Ë
f‹m©
, (Ë
v¨gs
,

3708 
	`va_íd
 (
v¨gs
);

3709  (Ë
_qzz_ªs
;

3710 
	}
}

3712 
	$VALGRIND_PRINTF_BACKTRACE
 (c⁄° *
f‹m©
, ...)

3713 
	`__©åibuã__
 ((
	`f‹m©
 (
__¥ötf__
, 1, 2), 
__unu£d__
));

3715 
	$VALGRIND_PRINTF_BACKTRACE
 (c⁄° *
f‹m©
, ...)

3717 
_qzz_ªs
;

3718 
va_li°
 
v¨gs
;

3719 
	`va_°¨t
 (
v¨gs
, 
f‹m©
);

3720 
	`VALGRIND_DO_CLIENT_REQUEST
 (
_qzz_ªs
, 0, 
VG_USERREQ__PRINTF_BACKTRACE
,

3721 (Ë
f‹m©
, (Ë
v¨gs
,

3723 
	`va_íd
 (
v¨gs
);

3724  (Ë
_qzz_ªs
;

3725 
	}
}

3753 
	#VALGRIND_NON_SIMD_CALL0
(
_qyy_‚
) \

3754 
__exãnsi⁄__
 \

3755 ({
_qyy_ªs
; \

3756 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qyy_ªs
, 0 , \

3757 
VG_USERREQ__CLIENT_CALL0
, \

3758 
_qyy_‚
, \

3760 
_qyy_ªs
; \

3761 })

	)

3763 
	#VALGRIND_NON_SIMD_CALL1
(
_qyy_‚
, 
_qyy_¨g1
) \

3764 
__exãnsi⁄__
 \

3765 ({
_qyy_ªs
; \

3766 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qyy_ªs
, 0 , \

3767 
VG_USERREQ__CLIENT_CALL1
, \

3768 
_qyy_‚
, \

3769 
_qyy_¨g1
, 0, 0, 0); \

3770 
_qyy_ªs
; \

3771 })

	)

3773 
	#VALGRIND_NON_SIMD_CALL2
(
_qyy_‚
, 
_qyy_¨g1
, 
_qyy_¨g2
) \

3774 
__exãnsi⁄__
 \

3775 ({
_qyy_ªs
; \

3776 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qyy_ªs
, 0 , \

3777 
VG_USERREQ__CLIENT_CALL2
, \

3778 
_qyy_‚
, \

3779 
_qyy_¨g1
, 
_qyy_¨g2
, 0, 0); \

3780 
_qyy_ªs
; \

3781 })

	)

3783 
	#VALGRIND_NON_SIMD_CALL3
(
_qyy_‚
, 
_qyy_¨g1
, 
_qyy_¨g2
, 
_qyy_¨g3
) \

3784 
__exãnsi⁄__
 \

3785 ({
_qyy_ªs
; \

3786 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qyy_ªs
, 0 , \

3787 
VG_USERREQ__CLIENT_CALL3
, \

3788 
_qyy_‚
, \

3789 
_qyy_¨g1
, 
_qyy_¨g2
, \

3790 
_qyy_¨g3
, 0); \

3791 
_qyy_ªs
; \

3792 })

	)

3798 
	#VALGRIND_COUNT_ERRORS
 \

3799 
__exãnsi⁄__
 \

3800 ({
_qyy_ªs
; \

3801 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qyy_ªs
, 0 , \

3802 
VG_USERREQ__COUNT_ERRORS
, \

3804 
_qyy_ªs
; \

3805 })

	)

3894 
	#VALGRIND_MALLOCLIKE_BLOCK
(
addr
, 
sizeB
, 
rzB
, 
is_zî€d
) \

3895 {
_qzz_ªs
; \

3896 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3897 
VG_USERREQ__MALLOCLIKE_BLOCK
, \

3898 
addr
, 
sizeB
, 
rzB
, 
is_zî€d
, 0); \

3899 (Ë
_qzz_ªs
; \

3900 }

	)

3905 
	#VALGRIND_FREELIKE_BLOCK
(
addr
, 
rzB
) \

3906 {
_qzz_ªs
; \

3907 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3908 
VG_USERREQ__FREELIKE_BLOCK
, \

3909 
addr
, 
rzB
, 0, 0, 0); \

3910 (Ë
_qzz_ªs
; \

3911 }

	)

3914 
	#VALGRIND_CREATE_MEMPOOL
(
poﬁ
, 
rzB
, 
is_zî€d
) \

3915 {
_qzz_ªs
; \

3916 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3917 
VG_USERREQ__CREATE_MEMPOOL
, \

3918 
poﬁ
, 
rzB
, 
is_zî€d
, 0, 0); \

3919 }

	)

3922 
	#VALGRIND_DESTROY_MEMPOOL
(
poﬁ
) \

3923 {
_qzz_ªs
; \

3924 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3925 
VG_USERREQ__DESTROY_MEMPOOL
, \

3926 
poﬁ
, 0, 0, 0, 0); \

3927 }

	)

3930 
	#VALGRIND_MEMPOOL_ALLOC
(
poﬁ
, 
addr
, 
size
) \

3931 {
_qzz_ªs
; \

3932 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3933 
VG_USERREQ__MEMPOOL_ALLOC
, \

3934 
poﬁ
, 
addr
, 
size
, 0, 0); \

3935 }

	)

3938 
	#VALGRIND_MEMPOOL_FREE
(
poﬁ
, 
addr
) \

3939 {
_qzz_ªs
; \

3940 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3941 
VG_USERREQ__MEMPOOL_FREE
, \

3942 
poﬁ
, 
addr
, 0, 0, 0); \

3943 }

	)

3946 
	#VALGRIND_MEMPOOL_TRIM
(
poﬁ
, 
addr
, 
size
) \

3947 {
_qzz_ªs
; \

3948 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3949 
VG_USERREQ__MEMPOOL_TRIM
, \

3950 
poﬁ
, 
addr
, 
size
, 0, 0); \

3951 }

	)

3954 
	#VALGRIND_MOVE_MEMPOOL
(
poﬁA
, 
poﬁB
) \

3955 {
_qzz_ªs
; \

3956 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3957 
VG_USERREQ__MOVE_MEMPOOL
, \

3958 
poﬁA
, 
poﬁB
, 0, 0, 0); \

3959 }

	)

3962 
	#VALGRIND_MEMPOOL_CHANGE
(
poﬁ
, 
addrA
, 
addrB
, 
size
) \

3963 {
_qzz_ªs
; \

3964 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3965 
VG_USERREQ__MEMPOOL_CHANGE
, \

3966 
poﬁ
, 
addrA
, 
addrB
, 
size
, 0); \

3967 }

	)

3970 
	#VALGRIND_MEMPOOL_EXISTS
(
poﬁ
) \

3971 
__exãnsi⁄__
 \

3972 ({
_qzz_ªs
; \

3973 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3974 
VG_USERREQ__MEMPOOL_EXISTS
, \

3975 
poﬁ
, 0, 0, 0, 0); \

3976 
_qzz_ªs
; \

3977 })

	)

3980 
	#VALGRIND_STACK_REGISTER
(
°¨t
, 
íd
) \

3981 
__exãnsi⁄__
 \

3982 ({
_qzz_ªs
; \

3983 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3984 
VG_USERREQ__STACK_REGISTER
, \

3985 
°¨t
, 
íd
, 0, 0, 0); \

3986 
_qzz_ªs
; \

3987 })

	)

3991 
	#VALGRIND_STACK_DEREGISTER
(
id
) \

3992 {
_qzz_ªs
; \

3993 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

3994 
VG_USERREQ__STACK_DEREGISTER
, \

3995 
id
, 0, 0, 0, 0); \

3996 }

	)

3999 
	#VALGRIND_STACK_CHANGE
(
id
, 
°¨t
, 
íd
) \

4000 {
_qzz_ªs
; \

4001 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

4002 
VG_USERREQ__STACK_CHANGE
, \

4003 
id
, 
°¨t
, 
íd
, 0, 0); \

4004 }

	)

4007 
	#VALGRIND_LOAD_PDB_DEBUGINFO
(
fd
, 
±r
, 
tŸÆ_size
, 
dñè
) \

4008 {
_qzz_ªs
; \

4009 
	`VALGRIND_DO_CLIENT_REQUEST
(
_qzz_ªs
, 0, \

4010 
VG_USERREQ__LOAD_PDB_DEBUGINFO
, \

4011 
fd
, 
±r
, 
tŸÆ_size
, 
dñè
, 0); \

4012 }

	)

4015 #unde‡
PLAT_x86_löux


4016 #unde‡
PLAT_amd64_löux


4017 #unde‡
PLAT_µc32_löux


4018 #unde‡
PLAT_µc64_löux


4019 #unde‡
PLAT_µc32_aix5


4020 #unde‡
PLAT_µc64_aix5


	@/usr/include/wchar.h

23 #i‚de‡
_WCHAR_H


25 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<„©uªs.h
>

30 #ifde‡
_WCHAR_H


32 
	#__√ed___FILE


	)

33 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_FILE


	)

36 
	~<°dio.h
>

38 
	#__√ed___va_li°


	)

39 
	~<°d¨g.h
>

41 
	~<bôs/wch¨.h
>

44 
	#__√ed_size_t


	)

45 
	#__√ed_wch¨_t


	)

46 
	#__√ed_NULL


	)

48 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


49 #unde‡
__√ed_wöt_t


50 
	#__√ed_wöt_t


	)

51 
	~<°ddef.h
>

55 #i‚de‡
_WINT_T


60 
	#_WINT_T


	)

61 
	twöt_t
;

65 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
deföed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twöt_t
;

69 
	g__END_NAMESPACE_STD


74 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
____mb°©e_t_deföed


80 
	#____mb°©e_t_deföed
 1

	)

84 
	m__cou¡
;

87 #ifde‡
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wöt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vÆue
;

94 } 
	t__mb°©e_t
;

96 #unde‡
__√ed_mb°©e_t


101 #ifde‡
_WCHAR_H


103 #i‚de‡
__mb°©e_t_deföed


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb°©e_t_deföed
 1

	)

111 #ifde‡
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

115 #i‚de‡
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #i‚de‡
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


128 
	~<w˘y≥.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

149 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

152 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

153 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

154 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

157 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

158 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

159 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

161 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

162 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

163 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

166 
	$wcscmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
)

167 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

169 
	$wc¢cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifde‡
__USE_XOPEN2K8


175 
	$wcsˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

178 
	$wc¢ˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

179 
size_t
 
__n
Ë
__THROW
;

183 
	~<xloˇÀ.h
>

185 
	$wcsˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

186 
__loˇÀ_t
 
__loc
Ë
__THROW
;

188 
	$wc¢ˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

189 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscﬁl
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

199 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

200 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifde‡
__USE_XOPEN2K8


209 
	$wcscﬁl_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

210 
__loˇÀ_t
 
__loc
Ë
__THROW
;

215 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

216 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

219 
wch¨_t
 *
	$wcsdup
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

227 "C++" c⁄° 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

230 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

231 
__THROW
 
__©åibuã_puª__
;

234 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

236 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

237 "C++" c⁄° 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

238 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

240 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

241 
__THROW
 
__©åibuã_puª__
;

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_GNU


248 
wch¨_t
 *
	$wcsch∫ul
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__wc
)

249 
__THROW
 
__©åibuã_puª__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ªje˘
)

256 
__THROW
 
__©åibuã_puª__
;

259 
size_t
 
	$wcs•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

260 
__THROW
 
__©åibuã_puª__
;

262 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

264 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

265 "C++" c⁄° 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
,

266 c⁄° 
wch¨_t
 *
__ac˚±
)

267 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

269 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

270 
__THROW
 
__©åibuã_puª__
;

273 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

275 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

276 "C++" c⁄° 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
,

277 c⁄° 
wch¨_t
 *
__√edÀ
)

278 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

280 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

281 
__THROW
 
__©åibuã_puª__
;

285 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

286 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

287 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

290 
size_t
 
	$wc¶í
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

291 
__END_NAMESPACE_STD


293 #ifde‡
__USE_XOPEN


295 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

297 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

298 "C++" c⁄° 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
,

299 c⁄° 
wch¨_t
 *
__√edÀ
)

300 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

302 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

303 
__THROW
 
__©åibuã_puª__
;

307 #ifde‡
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Àn
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

310 
__THROW
 
__©åibuã_puª__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

319 "C++" c⁄° 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

323 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©åibuã_puª__
;

328 
	$wmemcmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©åibuã_puª__
;

332 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

333 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

337 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifde‡
__USE_GNU


347 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

348 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

360 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

364 
	$mbsöô
 (c⁄° 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

368 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

369 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

370 
mb°©e_t
 *
__ª°ri˘
 
__p
Ë
__THROW
;

373 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

374 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

377 
size_t
 
	$__mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

378 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

379 
size_t
 
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

380 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifde‡
__USE_EXTERN_INLINES


389 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

390 
__exã∫_ölöe
 
wöt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

395 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

396 
__exã∫_ölöe
 

397 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

398 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

399 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

401 
__exã∫_ölöe
 
size_t


402 
__NTH
 (
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

403 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

404 {  (
__ps
 !
NULL


405 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

412 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

413 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

417 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

418 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

419 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

427 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

428 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

432 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

433 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
,

434 
size_t
 
__nwc
, size_à
__Àn
,

435 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

440 #ifde‡
__USE_XOPEN


442 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

446 
	$wcswidth
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc°od
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

454 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifde‡
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc°of
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

461 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

462 
	$wc°ﬁd
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

463 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc°ﬁ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

472 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

476 
	$wc°oul
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

477 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifde‡
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__exãnsi⁄__


486 
	$wc°ﬁl
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

487 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

488 
__THROW
;

492 
__exãnsi⁄__


493 
	$wc°ouŒ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

494 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

495 
__ba£
Ë
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifde‡
__USE_GNU


502 
__exãnsi⁄__


503 
	$wc°oq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

504 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

505 
__THROW
;

509 
__exãnsi⁄__


510 
	$wc°ouq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

511 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

512 
__ba£
Ë
__THROW
;

515 #ifde‡
__USE_GNU


529 
	~<xloˇÀ.h
>

533 
	$wc°ﬁ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

534 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

535 
__loˇÀ_t
 
__loc
Ë
__THROW
;

537 
	$wc°oul_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

538 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

539 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

541 
__exãnsi⁄__


542 
	$wc°ﬁl_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

543 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

544 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

546 
__exãnsi⁄__


547 
	$wc°ouŒ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

548 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

549 
__ba£
, 
__loˇÀ_t
 
__loc
)

550 
__THROW
;

552 
	$wc°od_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

553 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

554 
__THROW
;

556 
	$wc°of_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

557 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

558 
__THROW
;

560 
	$wc°ﬁd_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

561 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

562 
__loˇÀ_t
 
__loc
Ë
__THROW
;

566 #ifde‡
__USE_XOPEN2K8


569 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

570 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

574 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

575 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

586 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

597 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

598 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
	`w¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

607 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

608 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

609 
__THROW
 ;

615 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

616 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

617 
__gnuc_va_li°
 
__¨g
)

623 
	`vw¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

624 
__gnuc_va_li°
 
__¨g
)

628 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

629 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

630 
__gnuc_va_li°
 
__¨g
)

631 
__THROW
 ;

638 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

639 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
	`wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

648 
	$swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

649 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

650 
__THROW
 ;

652 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

653 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

654 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

655 #ifde‡
__REDIRECT


659 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

660 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

661 
__isoc99_fwsˇnf
)

663 
	`__REDIRECT
 (
wsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

664 
__isoc99_wsˇnf
)

666 
	`__REDIRECT_NTH
 (
swsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

667 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

668 ...), 
__isoc99_swsˇnf
)

671 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

672 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

673 
	`__isoc99_wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

674 
	$__isoc99_swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

675 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

676 
__THROW
;

677 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

678 
	#wsˇnf
 
__isoc99_wsˇnf


	)

679 
	#swsˇnf
 
__isoc99_swsˇnf


	)

683 
__END_NAMESPACE_STD


686 #ifde‡
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

693 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

694 
__gnuc_va_li°
 
__¨g
)

700 
	`vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

701 
__gnuc_va_li°
 
__¨g
)

704 
	$vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

705 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

706 
__gnuc_va_li°
 
__¨g
)

707 
__THROW
 ;

709 #i‡!
deföed
 
__USE_GNU
 \

710 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

711 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

712 #ifde‡
__REDIRECT


713 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

714 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

715 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

717 
	`__REDIRECT
 (
vwsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

718 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

720 
	`__REDIRECT_NTH
 (
vswsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

721 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

722 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

725 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

726 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

727 
__gnuc_va_li°
 
__¨g
);

728 
	`__isoc99_vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

729 
__gnuc_va_li°
 
__¨g
);

730 
	$__isoc99_vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

731 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

732 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

733 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

734 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

735 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

749 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

755 
wöt_t
 
	`gëwch¨
 ();

762 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

763 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

769 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

777 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

778 
__FILE
 *
__ª°ri˘
 
__°ªam
);

784 
	`Âutws
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

785 
__FILE
 *
__ª°ri˘
 
__°ªam
);

792 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

793 
__END_NAMESPACE_STD


796 #ifde‡
__USE_GNU


804 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

805 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

813 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

821 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

830 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

831 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

840 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

841 
__FILE
 *
__ª°ri˘
 
__°ªam
);

849 
	`Âutws_u∆ocked
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

850 
__FILE
 *
__ª°ri˘
 
__°ªam
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

859 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

860 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifde‡
__USE_GNU


864 
	~<xloˇÀ.h
>

868 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

869 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

870 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

871 
__loˇÀ_t
 
__loc
Ë
__THROW
;

880 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


881 
	#__√ed_iswxxx


	)

882 
	~<w˘y≥.h
>

886 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


887 
	~<bôs/wch¨2.h
>

890 #ifde‡
__LDBL_COMPAT


891 
	~<bôs/wch¨-ldbl.h
>

894 
__END_DECLS


902 #unde‡
__√ed_mb°©e_t


903 #unde‡
__√ed_wöt_t


	@/usr/include/vppinfra/smp.h

38 #i‚de‡
ö˛uded_˛ib_smp_h


39 
	#ö˛uded_˛ib_smp_h


	)

41 
	~<vµö‰a/ˇche.h
>

42 
	~<vµö‰a/os.h
>

44 
	#˛ib_smp_com∑ª_™d_sw≠
(
addr
,
√w
,
ﬁd
Ë
	`__sync_vÆ_com∑ª_™d_sw≠
◊ddr,ﬁd,√w)

	)

45 
	#˛ib_smp_sw≠
(
addr
,
√w
Ë
	`__sync_lock_ã°_™d_£t
◊ddr,√w)

	)

46 
	#˛ib_smp_©omic_add
(
addr
,
ö¸emít
Ë
	`__sync_„tch_™d_add
◊ddr,ö¸emít)

	)

48 #i‡
deföed
 (
i386
Ë|| deföed (
__x86_64__
)

49 
	#˛ib_smp_∑u£
(Ëdÿ{ 
asm
 vﬁ©ûê("∑u£"); } 0)

	)

50 #ñi‡
deföed
 (
__Ørch64__
Ë|| deföed (
__¨m__
)

51 
	#˛ib_smp_∑u£
(Ëdÿ{ 
asm
 vﬁ©ûê("isb" ::: "mem‹y"); } 0)

	)

54 #i‚de‡
˛ib_smp_∑u£


55 
	#˛ib_smp_∑u£
(Ëdÿ{ } 0)

	)

58 #ifde‡
CLIB_UNIX


59 
	~<sched.h
>

61 
Æways_ölöe
 

62 
	$os_sched_yõld
 ()

64 
	`sched_yõld
 ();

65 
	}
}

67 
Æways_ölöe
 

68 
	$os_sched_yõld
 ()

70 
	`˛ib_smp_∑u£
 ();

71 
	}
}

	@/usr/include/wctype.h

23 #i‚de‡
_WCTYPE_H


25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 #i‚de‡
__√ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__√ed_wöt_t


	)

33 
	~<wch¨.h
>

37 #i‚de‡
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde‡
__√ed_iswxxx


46 #i‚de‡
__iswxxx_deföed


47 
	#__iswxxx_deföed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	tw˘y≥_t
;

53 
	g__END_NAMESPACE_C99


55 #i‚de‡
_ISwbô


60 
	~<ídün.h
>

61 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

64 
	#_ISwbô
(
bô
) \

65 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

73 
	m__ISwuµî
 = 0,

74 
	m__ISwlowî
 = 1,

75 
	m__ISwÆpha
 = 2,

76 
	m__ISwdigô
 = 3,

77 
	m__ISwxdigô
 = 4,

78 
	m__ISw•a˚
 = 5,

79 
	m__ISw¥öt
 = 6,

80 
	m__ISwgøph
 = 7,

81 
	m__ISwbœnk
 = 8,

82 
	m__ISw˙ål
 = 9,

83 
	m__ISwpun˘
 = 10,

84 
	m__ISwÆnum
 = 11,

86 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

87 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

88 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

89 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

90 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

91 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

92 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

93 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

94 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

95 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

96 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

97 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

117 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

120 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

124 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

128 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

133 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

136 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

141 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

146 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

151 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

156 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

161 #ifde‡
__USE_ISOC99


162 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

171 
w˘y≥_t
 
	$w˘y≥
 (c⁄° *
__¥›îty
Ë
__THROW
;

175 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 c⁄° 
	t__öt32_t
 *
	tw˘øns_t
;

187 
__END_NAMESPACE_C99


188 #ifde‡
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

197 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde‡
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
w˘øns_t
 
	$w˘øns
 (c⁄° *
__¥›îty
Ë
__THROW
;

221 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde‡
__USE_XOPEN2K8


226 
	~<xloˇÀ.h
>

230 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

236 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

239 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

243 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

247 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

252 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

255 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

260 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

265 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

270 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

275 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

280 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

284 
w˘y≥_t
 
	$w˘y≥_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

285 
__THROW
;

289 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

290 
__THROW
;

298 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

301 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

305 
w˘øns_t
 
	$w˘øns_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

306 
__THROW
;

309 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

310 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
184
4194
buffer.c
buffer.h
buffer_funcs.h
buffer_node.h
buffer_serialize.c
cli.c
cli.h
cli_funcs.h
counter.c
counter.h
defs.h
error.c
error.h
error_funcs.h
format.c
format_funcs.h
global_funcs.h
i2c.c
i2c.h
init.c
init.h
lex.c
lex.h
linux/pci.c
linux/physmem.c
linux/vfio.c
linux/vfio.h
main.c
main.h
mc.c
mc.h
node.c
node.h
node_cli.c
node_format.c
node_funcs.h
parse.h
pci/pci.c
pci/pci.h
pci/pci_config.h
physmem.h
physmem_funcs.h
threads.c
threads.h
threads_cli.c
trace.c
trace.h
trace_funcs.h
unix/cj.c
unix/cj.h
unix/cli.c
unix/input.c
unix/main.c
unix/mc_socket.c
unix/mc_socket.h
unix/plugin.c
unix/plugin.h
unix/unix.h
unix/util.c
vlib.h
vlib_process_doc.h
/usr/include/arpa/telnet.h
/usr/include/ctype.h
/usr/include/dirent.h
/usr/include/dlfcn.h
/usr/include/fcntl.h
/usr/include/limits.h
/usr/include/linux/ethtool.h
/usr/include/linux/sched.h
/usr/include/linux/sockios.h
/usr/include/math.h
/usr/include/net/if.h
/usr/include/netinet/in.h
/usr/include/netinet/tcp.h
/usr/include/pthread.h
/usr/include/signal.h
/usr/include/stdio.h
/usr/include/syslog.h
/usr/include/termios.h
/usr/include/unistd.h
/usr/include/vlib/buffer.h
/usr/include/vlib/buffer_funcs.h
/usr/include/vlib/buffer_node.h
/usr/include/vlib/cli.h
/usr/include/vlib/cli_funcs.h
/usr/include/vlib/config.h
/usr/include/vlib/counter.h
/usr/include/vlib/defs.h
/usr/include/vlib/error.h
/usr/include/vlib/error_funcs.h
/usr/include/vlib/format_funcs.h
/usr/include/vlib/global_funcs.h
/usr/include/vlib/i2c.h
/usr/include/vlib/init.h
/usr/include/vlib/linux/vfio.h
/usr/include/vlib/main.h
/usr/include/vlib/mc.h
/usr/include/vlib/node.h
/usr/include/vlib/node_funcs.h
/usr/include/vlib/pci/pci.h
/usr/include/vlib/pci/pci_config.h
/usr/include/vlib/physmem.h
/usr/include/vlib/physmem_funcs.h
/usr/include/vlib/threads.h
/usr/include/vlib/trace.h
/usr/include/vlib/trace_funcs.h
/usr/include/vlib/unix/cj.h
/usr/include/vlib/unix/mc_socket.h
/usr/include/vlib/unix/plugin.h
/usr/include/vlib/unix/unix.h
/usr/include/vlib/vlib.h
/usr/include/vppinfra/bitmap.h
/usr/include/vppinfra/byte_order.h
/usr/include/vppinfra/cache.h
/usr/include/vppinfra/clib.h
/usr/include/vppinfra/cpu.h
/usr/include/vppinfra/elf.h
/usr/include/vppinfra/elf_clib.h
/usr/include/vppinfra/elog.h
/usr/include/vppinfra/error.h
/usr/include/vppinfra/fifo.h
/usr/include/vppinfra/file.h
/usr/include/vppinfra/format.h
/usr/include/vppinfra/hash.h
/usr/include/vppinfra/heap.h
/usr/include/vppinfra/linux/syscall.h
/usr/include/vppinfra/linux/sysfs.h
/usr/include/vppinfra/lock.h
/usr/include/vppinfra/longjmp.h
/usr/include/vppinfra/mhash.h
/usr/include/vppinfra/pool.h
/usr/include/vppinfra/random_buffer.h
/usr/include/vppinfra/serialize.h
/usr/include/vppinfra/socket.h
/usr/include/vppinfra/time.h
/usr/include/vppinfra/timer.h
/usr/include/vppinfra/tw_timer_1t_3w_1024sl_ov.h
/usr/include/vppinfra/types.h
/usr/include/vppinfra/vector.h
/usr/include/endian.h
/usr/include/errno.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/linux/errno.h
/usr/include/linux/if_ether.h
/usr/include/linux/types.h
/usr/include/sched.h
/usr/include/stdint.h
/usr/include/time.h
/usr/include/vppinfra/bitops.h
/usr/include/vppinfra/clib_error.h
/usr/include/vppinfra/error_bootstrap.h
/usr/include/vppinfra/mheap.h
/usr/include/vppinfra/random.h
/usr/include/vppinfra/random_isaac.h
/usr/include/vppinfra/string.h
/usr/include/vppinfra/tw_timer_template.h
/usr/include/vppinfra/vec.h
/usr/include/vppinfra/vector_altivec.h
/usr/include/vppinfra/vector_funcs.h
/usr/include/vppinfra/vector_neon.h
/usr/include/vppinfra/vector_sse42.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/linux/posix_types.h
/usr/include/linux/string.h
/usr/include/stdc-predef.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/vppinfra/mem.h
/usr/include/vppinfra/memcpy_avx2.h
/usr/include/vppinfra/memcpy_avx512.h
/usr/include/vppinfra/memcpy_sse3.h
/usr/include/vppinfra/vec_bootstrap.h
/usr/include/alloca.h
/usr/include/gconv.h
/usr/include/linux/stddef.h
/usr/include/vppinfra/mheap_bootstrap.h
/usr/include/vppinfra/os.h
/usr/include/vppinfra/valgrind.h
/usr/include/wchar.h
/usr/include/vppinfra/smp.h
/usr/include/wctype.h
